var originalMaxPPDeduction=0,selectedFreeMenuItem,couponFreeMenuItemRequired=!1;function handle_ltd_round_up(){$("#add_ltd_round_up").prop("disabled",!1),"SAVED"==orderState&&!$("#add_ltd_round_up").is(":checked")&&GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value>0&&""==orderInfo.ltd_round_up_value?($("#add_ltd_round_up").prop("checked",!0),1==GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value?($("#ltd_round_up_select option[id='round_up_nearest_dollar']").attr("selected","selected"),$("#ltd_round_up_select").prop("disabled",!1)):$("#ltd_round_up_select").prop("disabled",!1).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger("change")):$("#add_ltd_round_up").is(":checked")&&$("#ltd_round_up_select").prop("disabled",!1),$("#add_ltd_round_up").on("change",(function(e){$(this).is(":checked")?($("#ltd_round_up_select").prop("disabled",!1),""!=GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value||$.cookie("ltdru")&&$.cookie("ltdru")==user_id+"."+session_id||dd_message({title:"My Preferences",message:'Would <span style="font-weight: bold; color: red;">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style="font-weight: bold;">My Preferences</span>.<div style="text-align: center; margin-top: 10px;"><select id="ltd-round_up_opt_in"><option>Select a Round Up value</option><option value="1">Nearest Dollar</option></select></div>',modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide();var n=$(this);$("#ltd-round_up_opt_in").on("change",(function(e){var t=$(this).val();t>0&&dd_message({div_id:"rup_confirm",title:"My Preferences",message:"You have chosen to set your auto Round Up to "+(1==t?"the nearest dollar.":"$"+t),confirm:function(){$(n).remove(),set_user_pref("LTD_AUTO_ROUND_UP",t,user_id),(0==orderInfo.ltd_round_up_value&&1!=t||0==$("#ltd_round_up_select option:selected").index()&&!$.cookie("ltdru"))&&dd_message({title:"My Preferences",message:"Preference saved. Would you like to use the selected Round Up value on this order?",modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{Yes:function(){1==t?$("#ltd_round_up_select option:eq(0)").prop("selected",!0).trigger("change"):$("#ltd_round_up_select").val(t).trigger("change"),$(this).remove()},No:function(){$(this).remove()}}})}})}))},buttons:{No:function(){$(this).remove(),set_user_pref("LTD_AUTO_ROUND_UP",0,user_id)},"Ask Again Later":function(){$(this).remove(),$.cookie("ltdru",user_id+"."+session_id)}}})):$("#ltd_round_up_select").prop("disabled",!0),$("#ltd_round_up_select").trigger("change"),calculateTotal()})),$("#ltd_round_up_select").on("change",(function(e){var t=$(this).val();$("#checkout_total-roundup_donation").text(formatAsMoney(t)),$("#add_ltd_round_up").is(":checked")?$("#ltd_round_up_div").slideDown():($("#ltd_round_up_div").slideUp(),t=0),calculateTotal()})),calculateTotal()}function handleCouponCodeResult(e){if(e.validation_errors){for(anError in printString="",e.validation_errors)""!=e.validation_errors[anError]&&null!=e.validation_errors[anError]&&(printString+=e.validation_errors[anError]+"<br />");$("#coupon_error").html(printString),$("#coupon_error").show(),$("#couponCodeSubmitter").show(),$("#proc_mess").hide()}else{if($("#coupon_error").hide(),$("#coupon_error").html(""),$("#proc_mess").hide(),$("#couponDeleter").show(),$("#coupon_code").prop("disabled",!0),$("#couponValue").val(e.coupon_code_discount_total),$("#coupon_id").val(e.code_id),$("#coupon_type").val(e.discount_method),"FREE_MEAL"==e.discount_method?($("#coupon_free_meal_row").show(),$("#free_entree").html(e.entree_title),$("#free_entree_servings").val(e.entree_servings)):"FREE_MENU_ITEM"==e.discount_method?handleFreeMenuItem(e.coupon_obj.coupon_code):"BONUS_CREDIT"==e.discount_method&&createBonusCredit(0),coupon=e.coupon,couponDiscountMethod=e.discount_method,couponDiscountVar=e.discount_var,couponlimitedToFT=e.limit_to_finishing_touch,couponIsValidWithPlatePoints=e.valid_with_plate_points_credits,couponFreeMenuItemRequired=!0,couponlimitedToFT){var t=1*$("#max_plate_points_deduction").html();originalMaxPPDeduction=t,(t-=e.coupon_code_discount_total)<0&&(t=0),$("#max_plate_points_deduction").html(formatAsMoney(t))}calculateTotal()}}function processCode(){var e=$("#coupon_code").val();$("#couponCodeSubmitter").hide();var t=$("#editorForm").get()[0],n=!1,a=document.getElementById("selectedBundle");a&&!a.checked&&(n=!0);var o="";for(i=0;i<t.elements.length;i++)n&&"selectedBundle"==t.elements[i].name||(o+=t.elements[i].name+"="+t.elements[i].value,i+1!=t.elements.length&&(o+="&"));o=o+"&store_id="+STORE_DETAILS.id;var d=new Date;$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_orderMgrCouponCodeProcessorDelivered",user_id:user_id,op:"add",org_ts:"org_order_time",order_id:order_id,unique:d.getTime(),coupon_code:e,order_state:orderState,params:o},success:function(e){e.processor_success?handleCouponCodeResult(e):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#coupon_error").html(""),$("#coupon_error").hide(),$("#couponCodeSubmitter").show(),$("#proc_mess").hide(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function removeCode(){var e=$("#editorForm").get()[0],t=!1,n=document.getElementById("selectedBundle");n&&!n.checked&&(t=!0);var a="";for(i=0;i<e.elements.length;i++)t&&"selectedBundle"==e.elements[i].name||(a+=e.elements[i].name+"="+e.elements[i].value,i+1!=e.elements[i]&&(a+="&"));a=a+"&store_id="+STORE_DETAILS.id;var o=new Date;$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_orderMgrCouponCodeProcessorDelivered",op:"remove",user_id:user_id,org_ts:"org_order_time",order_id:order_id,unique:o.getTime(),order_state:orderState,params:a},success:function(e){"BONUS_CREDIT"==$("#coupon_type").val()&&removeBonusCredit(),$("#couponCodeSubmitter").show(),$("#proc_mess").hide(),$("#couponDeleter").hide(),$("#coupon_code").prop("disabled",!1),$("#coupon_error").hide(),$("#coupon_error").html(""),$("#couponValue").val(0),$("#coupon_free_meal_row").hide(),$("#free_entree").html(""),$("#coupon_id").val(""),$("#coupon_type").val(""),$("#coupon_select_free_menu_item_row").hide(),$("#free_menu_item_coupon option:not([value])").attr("data-dd_required",!1),couponFreeMenuItem=!1,couponFreeMenuItemRequired=!1,couponDiscountMethod="NONE",couponDiscountVar=0,couponlimitedToFT=!1,couponIsValidWithPlatePoints=!0,calculateTotal()},error:function(e,t){$("#coupon_error").html(""),$("#coupon_error").hide(),$("#couponCodeSubmitter").show(),$("#proc_mess").hide(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function handle_free_menu_item_edit(){couponFreeMenuItem&&handleFreeMenuItem($("#coupon_code").val())}function handleFreeMenuItem(e){var t=0;"SRDessert"==e?t=buildFreeMenuItemList("menu_item.menu_category_id == 9"):"SRDinner"==e?t=buildFreeMenuItemList("menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'"):"CC3RDFREE"==e?t=buildFreeMenuItemList("(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00"):"SCFinishingTouch"==e?t=buildFreeMenuItemList("menu_item.menu_category_id == 9 && menu_item.price <= 15.00"):"HCFastLane"==e?t=buildFreeMenuItemList("menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'"):"SCFriendDinner"==e&&(t=buildFreeMenuItemList("menu_item.menu_class == 'Specials' && menu_item.intro_item == true")),t>0?($("#coupon_select_free_menu_item_row").show(),$("#free_menu_item_coupon").attr("data-dd_required",!0).on("change",(function(e){var t=$(this).find(":selected").data("menu_item"),n=$(this).find(":selected").data("price");$("#couponValue").val(n),selectedFreeMenuItem=t,calculateTotal()}))):(dd_message({title:"Alert",message:"No valid free items found in cart for this coupon, please add the desired item and then submit the coupon."}),removeCode())}function buildFreeMenuItemList(expression){rebuildOrderItemsArray();var menu_item_in_list=!1,selected_menu_item_in_list=!1,menu_item_count=0,s=$("#free_menu_item_coupon").html("").attr("disabled",!!couponFreeMenuItem);return $("<option />").val("").text("Select Free Item").appendTo(s),$.each(orderItems,(function(index,menu_item){menu_item_in_list||(menu_item_in_list=couponFreeMenuItem==menu_item.id),selected_menu_item_in_list||(selected_menu_item_in_list=selectedFreeMenuItem==menu_item.id),eval(expression)&&(menu_item_count++,$("<option />").val(menu_item.id).attr("data-menu_item",menu_item.id).attr("data-price",menu_item.price).attr("selected",couponFreeMenuItem==menu_item.id||selectedFreeMenuItem==menu_item.id).text(menu_item.item_title+" ("+menu_item.price+")").appendTo(s))})),menu_item_in_list||($("#couponValue").val("0.00"),$("#free_menu_item_coupon").attr("disabled",!1)),calculateTotal(),menu_item_count}function stripLeadingZeroes(e){for(var t=0,n=e,a=0,o=e.length;a<o&&"0"==e[a];a++)t++;return t>0&&(n=e.slice(t)),n}function handlePlatePointsDiscount(e){if(couponIsValidWithPlatePoints||(document.getElementById("plate_points_discount").value=formatAsMoney(0),dd_message({title:"Alert",message:"PLATEPOINTS cannot be used with the attached coupon."})),(isNaN(e)||e<=0)&&"."!=e)return $("#plate_points_discount").val("0"),$("#OEH_plate_points_order_discount_fee").html(formatAsMoney(0)),void calculateTotal();needPlatePointsMaxDiscountChangeWarning=!1,e=1*formatAsMoney(Math.abs(e));var t=1*$("#plate_points_available").html(),n=1*$("#max_plate_points_deduction").html();n<1*$("#plate_points_discount").val()&&$("#plate_points_discount").val(n),t>n?$("#tbody_max_plate_points_deduction").show():$("#tbody_max_plate_points_deduction").hide();var a=t;a>n&&(a=n),e>a&&(e=a,$("#plate_points_discount").val(e)),$("#OEH_plate_points_order_discount_fee").html(formatAsMoney(e)),calculateTotal()}function editCashCheckAmount(e,t){$("#check_total_input_"+e).show(),$("#check_payment_number_input_"+e).show(),$("#check_total_"+e).hide(),$("#check_payment_number_"+e).hide(),$("#check_editlink_"+e).hide()}function editCashCheckUpdate(e,t){$("#payment_sum_value_"+e).html($("#check_total_input_form_"+e).val()),$("#payment_sum_name_"+e).html("Check (#"+$("#check_payment_number_input_form_"+e).val()+")"),new_total=0,$('[id^="payment_sum_value_"]').each((function(e){new_total+=Number($(this).text())})),$('[id^="refund_payment_sum_value_"]').each((function(e){new_total-=Number($(this).text())})),$("#OEH_paymentsTotal").html(formatAsMoney(new_total)),calculateTotal()}function getGiftCardBalance(){$("#gc_proc_anim").show(),$("#balance_target").hide(),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"giftCardBalance",card_number:$("#debit_gift_card_number").val(),output:"json"},success:function(e){e.processor_success?($("#balance_target").show(),$("#balance_target").html(e.card_balance),$("#gc_proc_anim").hide()):"Not logged in"==e.message?($("#balance_target").show(),$("#balance_target").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+request_uri+'">[login]</a> again.</span>'),$("#gc_proc_anim").hide()):($("#balance_target").show(),$("#balance_target").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>"),$("#gc_proc_anim").hide())},error:function(e,t){$("#balance_target").show(),$("#balance_target").html("Error: "+t+'. Please <a href="javascript:getGiftCardBalance();">[try again]</a>.')}})}function editCashCheckAmountCommit(e,t){alert("You are only modifying the "+t+" details.\nNo other modifications will be made."),$("#check_total_mess_"+e).hide(),new_total=$("#check_total_input_form_"+e).val(),new_number=$("#check_payment_number_input_form_"+e).val(),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_editCashCheckAmount",id:e,type:t,new_total:new_total,new_number:new_number,order_id:order_id},success:function(t){t.processor_success?($("#check_total_input_"+e).hide(),$("#check_payment_number_input_"+e).hide(),$("#check_total_"+e).show(),$("#check_payment_number_"+e).show(),$("#check_editlink_"+e).show(),$("#check_total_"+e).html(new_total),$("#check_payment_number_"+e).html(new_number),$("#check_total_mess_"+e).show(),$("#check_total_mess_"+e).show().html('<img src="'+PATH.image_admin+'/icon/accept.png" alt="Accept" />').fadeOut(2e3)):"Not logged in"==t.message?($("#check_total_mess_"+e).show(),$("#check_total_mess_"+e).html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="NaN')):($("#check_total_mess_"+e).show(),$("#check_total_mess_"+e).html('<span style="color:red;font-weight:bold;">'+t.processor_message+"</span>"))},error:function(n,a){$("#check_total_mess_"+e).show(),$("#check_total_mess_"+e).html("Error: "+a+'. Please <a href="javascript:editCashCheckAmountCommit('+e+",'"+t+"');\">[try again]</a>.")}})}function showButtonProcessDelayedPaymentNow(e){"PENDING"==PendingDPOriginalStatus?($("#payment_proc_mess").show(),$("#payment_proc_mess").html('<input type="button" class="button" name="process_payment" value="Process delayed payment now" onclick="processPayment();">')):e?($("#payment_proc_mess").show(),$("#payment_proc_mess").html(e)):$("#payment_proc_mess").hide()}function processPayment(){confirm("Are you sure you wish to process the delayed payment now? Click OK to process.")&&($("#payment_proc_mess").show(),$("#payment_proc_mess").html('<img src="'+PATH.image_admin+'/throbber_processing_noborder.gif" alt="Processing" />'),$.ajax({url:"/processor",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_delayedPaymentProcessor",order_number:order_id},success:function(e){if(e.success){if($("#point_to_transaction").length){var t=$("#point_to_transaction option:selected").text();$("#cc_payment_number_other").html("XXXXXXXXXXXX"+t.substr(-4))}$("#cc_delayed_tran_num_other").html(e.transaction_id),$("#cc_delayed_date_other").html(e.transaction_date),$("#cc_delayed_status_other").html("Status: Payment Processed"),$("#payment_sum_row_"+e.payment_id).css({color:""}),$("#payment_sum_type_"+e.payment_id).css({color:""}),$("#payment_sum_name_"+e.payment_id).css({color:""}),$("#payment_sum_value_"+e.payment_id).css({color:""}),$("#payment_sum_date_"+e.payment_id).css({color:""}),$("#payment_sum_date_"+e.payment_id).html(e.summary_date),canAdjustDelayedPayment=!1,$("#payment_proc_mess").html('<span style="color:green;font-weight:bold;">Payment Processed.</span>').fadeOut(4e3)}else"Not logged in"==e.message?$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+back_path()+'">[login]</a> again.</span>'):$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>")},error:function(e,t){$("#payment_proc_mess").show(),$("#payment_proc_mess").html("Error: "+t+'. Please <a href="javascript:processPayment();">[try again]</a>.')}}))}function setDelayedPaymentStatusTo(){if("FAIL"==$("#change_delayed_payment_status").val()&&"FAIL"!=PendingDPOriginalStatus)return alert("Can not change transaction back to Fail. Please choose pending or canceled."),$("#change_delayed_payment_status").val(PendingDPOriginalStatus),!1;$("#change_delayed_payment_status")&&$("#point_to_transaction").val(PendingDPOriginalTransActionID),$("#change_delayed_payment_status").val()==PendingDPOriginalStatus?showButtonProcessDelayedPaymentNow():($("#payment_proc_mess").show(),$("#payment_proc_mess").html('<input type="button" class="button" name="set_delayed_payment_status" value="Set delayed payment status to '+$("#change_delayed_payment_status").val().toLowerCase()+'" onClick="processDelayedPaymentStatus();">'))}function setupCouponState(){coupon&&(document.getElementById("couponCodeSubmitter").style.display="none",document.getElementById("couponDeleter").style.display="inline",document.getElementById("coupon_code").value=coupon.coupon_code,document.getElementById("coupon_code").disabled=!0)}function processDelayedPaymentStatus(){$("#payment_proc_mess").show(),$("#payment_proc_mess").html('<img src="'+PATH.image_admin+'/throbber_processing_noborder.gif" alt="Processing" />'),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_delayedPaymentStatusProcessor",order_number:order_id,old_status:PendingDPOriginalStatus,new_status:$("#change_delayed_payment_status").val(),store_id:store_id},success:function(e){e.success?(PendingDPOriginalStatus=e.status,$("#change_delayed_payment_status").val(PendingDPOriginalStatus),$("#change_delayed_payment_status")&&$("#point_to_transaction").val(PendingDPOriginalTransActionID),"CANCELLED"==e.status&&$("#payment_sum_value_"+e.payment_id)?$("#payment_sum_value_"+e.payment_id).attr("id","cancelled_payment_sum_value_"+e.payment_id):"PENDING"==e.status&&$("#cancelled_payment_sum_value_"+e.payment_id)&&$("#cancelled_payment_sum_value_"+e.payment_id).attr("id","payment_sum_value_"+e.payment_id),"CANCELLED"==e.status?(canAdjustDelayedPayment=!1,$("#payment_sum_row_"+e.payment_id).css({"text-decoration":"line-through"}),$("#payment_sum_type_"+e.payment_id).css({"text-decoration":"line-through"}),$("#payment_sum_name_"+e.payment_id).css({"text-decoration":"line-through"}),$("#cancelled_payment_sum_value_"+e.payment_id).css({"text-decoration":"line-through"}),$("#payment_sum_date_"+e.payment_id).css({"text-decoration":"line-through"}),$("#OEH_paymentsTotal").html(formatAsMoney(Number($("#OEH_paymentsTotal").html())-Number($("#cancelled_payment_sum_value_"+e.payment_id).html()))),$("#dp_adjust_div").hide()):(canAdjustDelayedPayment=!0,$("#payment_sum_row_"+e.payment_id).css({"text-decoration":"none"}),$("#payment_sum_type_"+e.payment_id).css({"text-decoration":"none"}),$("#payment_sum_name_"+e.payment_id).css({"text-decoration":"none"}),$("#payment_sum_value_"+e.payment_id).css({"text-decoration":"none"}),$("#payment_sum_date_"+e.payment_id).css({"text-decoration":"none"}),$("#OEH_paymentsTotal").html(formatAsMoney(Number($("#OEH_paymentsTotal").html())+Number($("#payment_sum_value_"+e.payment_id).html()))),canAutoAdjust=!0),calculateTotal(),showButtonProcessDelayedPaymentNow('<span style="color:green;font-weight:bold;">Delayed Payment set to '+PendingDPOriginalStatus+".</span>"),$("#change_delayed_payment_status_img").attr({src:PATH.image_admin+"/icon/accept.png",alt:"Accept"}),$("#change_delayed_payment_status_img").css({display:"inline"}).fadeOut(2e3)):"Not logged in"==e.message?$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+back_path()+'">[login]</a> again.</span>'):$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>")},error:function(e,t){$("#payment_proc_mess").show(),$("#payment_proc_mess").html("Error: "+t+'. Please <a href="javascript:processDelayedPaymentStatus();">[try again]</a>.')}})}function pointToTransaction(){$("#change_delayed_payment_status").val(PendingDPOriginalStatus),$("#point_to_transaction").val()==PendingDPOriginalTransActionID?($("#payment_proc_mess").show(),showButtonProcessDelayedPaymentNow()):($("#payment_proc_mess").show(),$("#payment_proc_mess").html('<input type="button" class="button" name="point_to_payment" value="Point payment to selected Credit Card Number" onClick="processPointToTransaction();">'))}function processPointToTransaction(){$("#payment_proc_mess").show(),$("#payment_proc_mess").html('<img src="'+PATH.image_admin+'/throbber_processing_noborder.gif" alt="Processing" />'),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_processPointToTransaction",order_number:order_id,store_id:store_id,old_ref_number:PendingDPOriginalTransActionID,new_ref_number:$("#point_to_transaction").val(),new_card_number:$("#point_to_transaction option:selected").text()},success:function(e){e.success?(PendingDPOriginalTransActionID=e.transactionid,$("#point_to_transaction").val(PendingDPOriginalTransActionID),$("#change_delayed_payment_status").val(PendingDPOriginalStatus),$("#payment_sum_type_"+e.payment_id).html(e.new_card_type),$("#payment_sum_name_"+e.payment_id).html("Delayed CC Payment (#"+e.new_card_number+")"),$("#cc_credit_card_type_other").html(e.new_card_type),$("#cc_payment_transaction_number_other").html(e.transactionid),showButtonProcessDelayedPaymentNow('<span style="color:green;font-weight:bold;">Credit card set to '+e.new_card_type+".</span>"),$("#point_to_transaction_img").css({display:"inline"}).fadeOut(2e3)):"Not logged in"==e.message?$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+back_path()+'">[login]</a> again.</span>'):$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>")},error:function(e,t){$("#payment_proc_mess").show(),$("#payment_proc_mess").html("Error: "+t+'. Please <a href="javascript:processPointToTransaction();">[try again]</a>.')}})}function unsetAutoAdjust(){$("#autoAdjust").length&&(document.getElementById("autoAdjust").checked=!1)}function setAllPaymentFieldsToUnrequired(){var e;(e=document.getElementById("payment1_gc_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_gc_payment_number"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_ccNameOnCard"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_ccNumber"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_ccType"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_ccMonth"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_ccYear"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_cash_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_cash_total_number"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_refund_cash_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_refund_cash_total_number"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_check_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_check_total_number"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_cc_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_reference_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment1_ref_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_ccType"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_ccMonth"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_ccYear"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_gc_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_gc_payment_number"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_ccNameOnCard"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_ccNumber"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_cash_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_check_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_cc_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("payment2_ref_total_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("debit_gift_card_amount"))&&e.setAttribute("data-dd_required","false"),(e=document.getElementById("debit_gift_card_number"))&&e.setAttribute("data-dd_required","false")}var lastPayment1Type=!1;function changePayment1(e){lastPayment1Type&&lastPayment1Type!=e&&("CC"==lastPayment1Type?$("#payment1_gc_total_amount").val(""):"REFERENCE"==lastPayment1Type&&$("#payment1_reference_total_amount").val("")),lastPayment1Type=e;var t=document.getElementById("payment1_gc"),n=document.getElementById("payment1_cash"),a=document.getElementById("payment1_refund_cash"),o=document.getElementById("payment1_check"),d=document.getElementById("payment1_cc"),s=document.getElementById("payment1_credit"),r=document.getElementById("payment1_reference"),l=document.getElementById("payment1_ref"),m=document.getElementById("payment1RefundCCDiv"),u=document.getElementById("dp_adjust_div");document.getElementById("new_payments_total").value=0,document.getElementById("use_store_credits")&&document.getElementById("use_store_credits").checked&&(document.getElementById("new_payments_total").value=formatAsMoney(document.getElementById("store_credits_amount").value));var i=document.getElementById("payment1_debit_gift_card"),_=document.getElementById("payment2"),c=!1;"REF_"==e.substr(0,4)&&(c=e.substr(4),e="REFERENCE_OTHER"),resetPendingDelayedPayment();var y,p=document.getElementById("payment1_cc_total_amount");switch(p.value="",(y=document.getElementById("payment1_gc_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_gc_payment_number"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_ccNameOnCard"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_ccNumber"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_cash_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_refund_cash_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_check_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_cash_total_number"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_refund_cash_total_number"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_check_total_number"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_cc_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_reference_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("debit_gift_card_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("debit_gift_card_number"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_ref_total_amount"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_ccType"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_ccMonth"))&&y.setAttribute("data-dd_required","false"),(y=document.getElementById("payment1_ccYear"))&&y.setAttribute("data-dd_required","false"),e){case"REFERENCE":m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",r.style.display="block",s.style.display="none",d.style.display="none",l.style.display="none",i.style.display="none",u&&canAdjustDelayedPayment&&(u.style.display="none",unsetAutoAdjust()),_.style.display="none",(y=document.getElementById("payment1_reference_total_amount"))&&y.setAttribute("data-dd_required","true"),changePayment2(""),onPaymentSelected();break;case"GIFT_CERT":unsetAutoAdjust(),m.style.display="none",t.style.display="block",n.style.display="none",a.style.display="none",o.style.display="none",r.style.display="none",d.style.display="none",s.style.display="none",u&&(u.style.display="none"),"ACTIVE"!=orderState&&(_.style.display="block"),i.style.display="none",l.style.display="none",(y=document.getElementById("payment1_gc_total_amount"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_gc_payment_number"))&&y.setAttribute("data-dd_required","true"),onPaymentSelected();break;case"CASH":unsetAutoAdjust(),t.style.display="none",m.style.display="none",n.style.display="block",a.style.display="none",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="none",u&&(u.style.display="none"),_.style.display="none",i.style.display="none",l.style.display="none","ACTIVE"==orderState?(p=document.getElementById("payment1_cash_total_amount"),balance=Number(document.getElementById("OEH_remaing_balance").innerHTML),p.value=formatAsMoney(balance-document.getElementById("new_payments_total").value)):(p=document.getElementById("payment1_cash_total_amount")).value=formatAsMoney(0),(y=document.getElementById("payment1_cash_total_amount"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_cash_total_number"))&&y.setAttribute("data-dd_required","false"),changePayment2(""),onPaymentSelected();break;case"REFUND_CASH":unsetAutoAdjust(),m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="block",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="none",u&&(u.style.display="none"),_.style.display="none",i.style.display="none",l.style.display="none",(y=document.getElementById("payment1_refund_cash_total_amount"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_refund_cash_total_number"))&&y.setAttribute("data-dd_required","false"),changePayment2(""),onPaymentSelected();break;case"CHECK":unsetAutoAdjust(),m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="block",d.style.display="none",r.style.display="none",s.style.display="none",u&&(u.style.display="none"),_.style.display="none",i.style.display="none",l.style.display="none",p=document.getElementById("payment1_check_total_amount"),balance=Number(document.getElementById("OEH_remaing_balance").innerHTML),p.value=formatAsMoney(balance-document.getElementById("new_payments_total").value),(y=document.getElementById("payment1_check_total_amount"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_check_total_number"))&&y.setAttribute("data-dd_required","false"),changePayment2(""),onPaymentSelected();break;case"CREDIT":if(m.style.display="none",paymentsTotal=Number(document.getElementById("OEH_paymentsTotal").innerHTML),0!=paymentsTotal)return alert("'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away."),paySel=document.getElementById("payment1_type"),paySel.value="",void changePayment1("");unsetAutoAdjust(),t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="block",u&&(u.style.display="none"),_.style.display="none",i.style.display="none",l.style.display="none",changePayment2(""),onPaymentSelected();break;case"CC":unsetAutoAdjust(),m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="block",r.style.display="none",s.style.display="none",u&&(u.style.display="none"),_.style.display="none",i.style.display="none",l.style.display="none",p=document.getElementById("payment1_cc_total_amount"),balance=Number(document.getElementById("OEH_remaing_balance").innerHTML),p.value=formatAsMoney(balance-document.getElementById("new_payments_total").value),(y=document.getElementById("payment1_ccNameOnCard"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_ccNumber"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_cc_total_amount"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_ccType"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_ccMonth"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("payment1_ccYear"))&&y.setAttribute("data-dd_required","true"),changePayment2(""),onPaymentSelected();break;case"GIFT_CARD":unsetAutoAdjust(),m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="none",u&&(u.style.display="none"),_.style.display="none",i.style.display="block",l.style.display="none",(y=document.getElementById("debit_gift_card_amount"))&&y.setAttribute("data-dd_required","true"),(y=document.getElementById("debit_gift_card_number"))&&y.setAttribute("data-dd_required","true"),"ACTIVE"!=orderState&&(_.style.display="block"),onPaymentSelected();break;case"DPADJUST":if(!u)return;if(!canAdjustDelayedPayment)return alert("Can not adjust delayed payment.\n\nDelayed payment status: "+PendingDPOriginalStatus),autoAdjBox=document.getElementById("autoAdjust"),forceManualAutoAdjust||(autoAdjBox.checked=!0,handleAutoAdjust(autoAdjBox)),!1;m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="none",_.style.display="none",u.style.display="block",i.style.display="none",l.style.display="none",balance=Number(document.getElementById("OEH_remaing_balance").innerHTML),balance=formatAsMoney(balance-document.getElementById("new_payments_total").value),adjustPendingDelayedPayment(balance),changePayment2(""),onPaymentSelected();break;case"REFERENCE_OTHER":m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="none",_.style.display="none",i.style.display="none",l.style.display="block",document.getElementById("p1_card_num").innerHTML=externalPaymentAmountArray[c].cc_number,document.getElementById("p1_ref_id").innerHTML=c,(y=document.getElementById("payment1_ref_total_amount"))&&(y.setAttribute("data-dd_required","true"),balance=Number(document.getElementById("OEH_remaing_balance").innerHTML),y.value=formatAsMoney(balance-document.getElementById("new_payments_total").value)),changePayment2(""),onPaymentSelected();break;case"CC_REFUND":unsetAutoAdjust(),m.style.display="block",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="none",r.style.display="none",s.style.display="none",u&&(u.style.display="none"),_.style.display="none",i.style.display="none",l.style.display="none",onPaymentSelected();break;default:unsetAutoAdjust(),m.style.display="none",t.style.display="none",n.style.display="none",a.style.display="none",o.style.display="none",d.style.display="none",s.style.display="none",_.style.display="none",r.style.display="none",l.style.display="none",i.style.display="none",resetPendingDelayedPayment(),u&&(u.style.display="none"),onPaymentDeselected()}reportPaymentStatus(!1)}function changePayment2(e){reportPaymentStatus(!0);$("#bal_due").html();var t=Number($("#bal_due").html());isNaN(t.valueOf())&&(t=""),0==t.valueOf()&&(t="");var n,a=document.getElementById("payment2_cash"),o=(document.getElementById("payment2_refund)_cash"),document.getElementById("payment2_check")),d=document.getElementById("payment2_cc"),s=document.getElementById("payment2_ref");(n=document.getElementById("payment2_gc_total_amount"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_gc_payment_number"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_ccNameOnCard"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_ccNumber"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_cash_total_amount"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_cc_total_amount"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_ref_total_amount"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_ccType"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_ccMonth"))&&n.setAttribute("data-dd_required","false"),(n=document.getElementById("payment2_ccYear"))&&n.setAttribute("data-dd_required","false");var r=!1;switch("REF_"==e.substr(0,4)&&(r=e.substr(4),e="REFERENCE_OTHER"),e){case"CASH":a.style.display="block",o.style.display="none",d.style.display="none",s.style.display="none",(n=document.getElementById("payment2_cash_total_amount"))&&n.setAttribute("data-dd_required","true"),$("#payment2_cash_total_amount").val(t);break;case"CHECK":a.style.display="none",o.style.display="block",d.style.display="none",s.style.display="none",(n=document.getElementById("payment2_check_total_amount"))&&n.setAttribute("data-dd_required","true"),$("#payment2_check_total_amount").val(t);break;case"CC":a.style.display="none",o.style.display="none",d.style.display="block",s.style.display="none",(n=document.getElementById("payment2_ccNameOnCard"))&&n.setAttribute("data-dd_required","true"),(n=document.getElementById("payment2_ccNumber"))&&n.setAttribute("data-dd_required","true"),(n=document.getElementById("payment2_ccType"))&&n.setAttribute("data-dd_required","true"),(n=document.getElementById("payment2_ccMonth"))&&n.setAttribute("data-dd_required","true"),(n=document.getElementById("payment2_ccYear"))&&n.setAttribute("data-dd_required","true"),$("#payment2_cc_total_amount").val(t);break;case"REFERENCE_OTHER":a.style.display="none",o.style.display="none",d.style.display="none",s.style.display="block",document.getElementById("p2_card_num").innerHTML=externalPaymentAmountArray[r].cc_number,document.getElementById("p2_ref_id").innerHTML=r,n=document.getElementById("payment2_ref_total_amount"),$("#payment2_ref_total_amount").val(t),n&&n.setAttribute("data-dd_required","true");break;default:(n=document.getElementById("payment2_type")).selectedItem=0,a.style.display="none",o.style.display="none",d.style.display="none"}reportPaymentStatus(!1)}function validateRefTrans(e,t){e.value>t&&(alert("Limited to "+t+"."),e.value=t),e.value<0&&(alert("Must be a positive number."),e.value=0),reportPaymentStatus(!1)}function payAmountChange(e){reportPaymentStatus(!1)}function resetPendingDelayedPayment(e){if(document.getElementById("PendingDP")){var t=Number(document.getElementById("OriginalPendingDPAmount").value);document.getElementById("PendingDPAmount").value=formatAsMoney(t),document.getElementById("adj_dp_amount_up").value=formatAsMoney(t),document.getElementById("adjustment_amount_up").innerHTML=formatAsMoney(0),document.getElementById("adj_dp_amount_down").value=formatAsMoney(t),document.getElementById("adjustment_amount_down").innerHTML=formatAsMoney(0)}}function adjustPendingDelayedPayment(e){if(document.getElementById("PendingDP")){var t=Number(document.getElementById("OriginalPendingDPAmount").value)+1*e;t<0?(e=-1*t,t=0):e=0,document.getElementById("PendingDPAmount").value=formatAsMoney(t);var n=getPendingDPAdjustment();return n>0?(document.getElementById("adj_dp_amount_up").value=formatAsMoney(t),document.getElementById("adjustment_amount_up").innerHTML=formatAsMoney(n)):(document.getElementById("adj_dp_amount_down").value=formatAsMoney(t),document.getElementById("adjustment_amount_down").innerHTML=formatAsMoney(-1*n)),e}return e}function getPendingDPAdjustment(){if(document.getElementById("PendingDP")){var e=Number(document.getElementById("OriginalPendingDPAmount").value),t=Number(document.getElementById("PendingDPAmount").value);return formatAsMoney(t-e)}return 0}function assignBalanceToRefTransactions(e){var t=0,n="RT_";for(ident in e<0&&(n="Cr_RT_"),existingPaymentAmountArray){ident;t++,document.getElementById("RT_"+ident).value=""}for(ident in existingPaymentAmountArray){ident;document.getElementById("Cr_RT_"+ident).value=""}if(0!=e){if(e>0){if(document.getElementById("use_store_credits")&&document.getElementById("use_store_credits").checked){var a=0,o=Number($("#eoTotalStoreCredit").html());a=e>o?o:e,document.getElementById("store_credits_amount").value=formatAsMoney(a),e-=a}for(ident in existingPaymentAmountArray)if(e<=existingPaymentAmountArray[ident].amount)return refTransField=document.getElementById(n+ident),refTransField.value=formatAsMoney(e),void reportPaymentStatus(!1);for(ident in existingPaymentAmountArray){document.getElementById(n+ident).value=formatAsMoney(e);break}}else{for(ident in existingPaymentAmountArray){var d=existingPaymentAmountArray[ident].amount;if(existingPaymentAmountArray[ident].current_refunded_amount&&(d=existingPaymentAmountArray[ident].amount-existingPaymentAmountArray[ident].current_refunded_amount),e>=-1*d)return refTransField=document.getElementById(n+ident),refTransField.value=formatAsMoney(Math.abs(e)),void reportPaymentStatus(!1)}if(t>1)for(ident in existingPaymentAmountArray){d=existingPaymentAmountArray[ident].amount;existingPaymentAmountArray[ident].current_refunded_amount&&(d=existingPaymentAmountArray[ident].amount-existingPaymentAmountArray[ident].current_refunded_amount);var s=-1*d;if(s<e&&(s=e),document.getElementById(n+ident).value=formatAsMoney(Math.abs(s)),(e-=s)>=0)break}else if(1==t)for(ident in existingPaymentAmountArray){d=existingPaymentAmountArray[ident].amount;existingPaymentAmountArray[ident].current_refunded_amount&&(d=existingPaymentAmountArray[ident].amount-existingPaymentAmountArray[ident].current_refunded_amount),document.getElementById(n+ident).value=formatAsMoney(d);break}}reportPaymentStatus(!1)}else reportPaymentStatus(!1)}function storeCreditAmountChange(e){var t=Number($("#eoTotalStoreCredit").html());t.valueOf()<e&&$("#store_credits_amount").val(t.valueOf()),payAmountChange()}function storeCreditClick(e){var t=document.getElementById("store_credits_amount"),n=Number($("#eoTotalStoreCredit").html());if(e.checked&&n>0){t.disabled=!1;var a=document.getElementById("OEH_remaing_balance");a&&(balance=Number(a.innerHTML)),Number(t.value)>balance&&balance>0&&(t.value=formatAsMoney(balance)),updateChangeList()}else t.disabled=!0;calculateTotal(),reportPaymentStatus(!1)}function reportPaymentStatus(e){var t=document.getElementById("OEH_remaing_balance"),n=0;t&&(n=Number(t.innerHTML));var a=Number(0);document.getElementById("use_store_credits")&&document.getElementById("use_store_credits").checked&&(a=1*a+1*formatAsMoney(document.getElementById("store_credits_amount").value));var o=document.getElementById("payment1_type");if(o){var d=o.value,s=Number(0);switch(d){case"REFERENCE":for(ident in existingPaymentAmountArray)s+=Number(document.getElementById("RT_"+ident).value);break;case"CC":s=Number(document.getElementById("payment1_cc_total_amount").value);break;case"CC_REFUND":var r=Number(0);for(ident in existingPaymentAmountArray)r+=Number(document.getElementById("Dir_Cr_RT_"+ident).value);s=-1*r;break;case"CASH":s=Number(document.getElementById("payment1_cash_total_amount").value);break;case"REFUND_CASH":s=-(s=Number(document.getElementById("payment1_refund_cash_total_amount").value));break;case"CHECK":s=Number(document.getElementById("payment1_check_total_amount").value);break;case"GIFT_CERT":s=Number(document.getElementById("payment1_gc_total_amount").value);break;case"GIFT_CARD":case"CREDIT":s=Number(document.getElementById("debit_gift_card_amount").value)}if(e)l=Number(0);else{paySel2=document.getElementById("payment2_type").value;var l=Number(0);switch(paySel2){case"CC":l=Number(document.getElementById("payment2_cc_total_amount").value);break;case"CASH":l=Number(document.getElementById("payment2_cash_total_amount").value);break;case"CHECK":l=Number(document.getElementById("payment2_check_total_amount").value)}}var m=document.getElementById("storeCreditRefund");returnToStoreCredit=Number(m?-1*m.value:0);var u=document.getElementById("credit_to_customer_refund_cash_amount");u=Number(u?-1*u.value:0);var i=Number(0);for(ident in existingPaymentAmountArray)i+=Number(document.getElementById("Cr_RT_"+ident).value);i=isNaN(i)?Number(0):Number(-1*i);var _,c=Number(getPendingDPAdjustment());a=Number(a+s+l+returnToStoreCredit+i+c+u);if($("#payment_help_msg").removeClass("overpaid"),"CANCELLED"!=orderState)(_=Number(-1*a+n))<0?$("#payment_help_msg").addClass("overpaid").html('Overpaid by: $<span id="bal_due">'+formatAsMoney(Math.abs(_))).show():_>0?$("#payment_help_msg").html('Balance Due: $<span id="bal_due">'+formatAsMoney(Math.abs(_))).show():$("#payment_help_msg").html("").hide();else(_=Number(a+n))>0?$("#payment_help_msg").addClass("overpaid").html('Overpaid by: $<span id="bal_due">'+formatAsMoney(Math.abs(_))).show():_<0?$("#payment_help_msg").html('Balance Due: $<span id="bal_due">'+formatAsMoney(Math.abs(_))).show():$("#payment_help_msg").html("").hide();updateChangeList()}}function toggle(e){var t=document.getElementById(e);t.style.display="none"!=t.style.display?"none":""}var target_prefix="payment1_",scanPosition=0,charIndex=0,codes=[];function keyHandler2(e){var t=(e=e||event).charCode?e.charCode:e.which?e.which:e.keyCode;if(13==t)return!1;codes[charIndex++]=String.fromCharCode(t),"%"==String.fromCharCode(t)&&0==scanPosition?scanPosition=1:"B"==String.fromCharCode(t)&&1==scanPosition?scanPosition=2:"?"==String.fromCharCode(t)&&2==scanPosition?scanPosition=3:"?"==String.fromCharCode(t)&&3==scanPosition&&(scanPosition=0,charIndex=0,handleSwipeCompletion())}function endScanHandling(){document.getElementById("scanArea").style.display="none",codes.length=0,scanPosition=0,charIndex=0,document.getElementById("hidden_text_store").value="",document.onkeypress=OMDefaultKeyHandler}function prepareForCCSwipe(e){target_prefix=2==e?"payment2_":"payment1_",document.onkeypress=keyHandler2,document.getElementById("scanArea").style.display="block",document.getElementById("hidden_text_store").focus(),document.getElementById("hidden_text_store").value=""}function handleSwipeCompletion(){var e=codes.join(""),t=new SwipeParserObj(e),n=(t.dump(),!1);/^4[0-9]{12}([0-9]{3})?$/.test(t.account)?n="Visa":/^5[1-5][0-9]{14}$/.test(t.account)?n="Mastercard":/^3[47][0-9]{13}$/.test(t.account)?n="American Express":/^6011[0-9]{12}$/.test(t.account)&&(n="Discover"),n&&(document.getElementById(target_prefix+"ccType").value=n),document.getElementById(target_prefix+"ccNumber").value=t.account,document.getElementById(target_prefix+"ccNameOnCard").value=t.firstname+" "+t.surname,document.getElementById(target_prefix+"ccMonth").value=t.exp_month;var a=t.exp_year;2==a.length?document.getElementById(target_prefix+"ccYear").value=a:4==a.length&&(document.getElementById(target_prefix+"ccYear").value=a.substr(2)),endScanHandling()}
//# sourceMappingURL=order_mgr_payments_delivered.min.js.map
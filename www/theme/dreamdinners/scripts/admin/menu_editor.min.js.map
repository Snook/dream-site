{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["menu_editor.js"],"sourcesContent":["let numberOfCustomerFacingCTSItems = 0;\r\nlet numberOfCustomerFacingEFLItems = 0;\r\nlet sidesDataArray = [];\r\nlet gNumOptionalsAdded = 0;\r\nlet notShown = true;\r\nlet dp_processing = false;\r\nlet xmlHttp = null;\r\nlet noOverrideUnderBase = true;\r\n\r\nfunction resetPage()\r\n{\r\n\tdocument.getElementById('action').value = \"menuChange\";\r\n\tdocument.getElementById('menu_editor_form').submit();\r\n}\r\n\r\nfunction getPreviewItemPrice(itemID)\r\n{\r\n\t// does not exist so return the current price\r\n\tlet ovrPrice = Number($(\"#ovr_\" + itemID).val());\r\n\r\n\tif (isNaN(ovrPrice) || ovrPrice.valueOf() == 0)\r\n\t{\r\n\t\t// does not exist so return the markup price\r\n\t\treturn Number($(\"#row_\" + itemID + \" > .preview-price\").text());\r\n\t}\r\n\r\n\treturn ovrPrice;\r\n}\r\n\r\nfunction removeOptionSelected()\r\n{\r\n\tlet elSel = document.getElementById('sides');\r\n\tfor (let i = elSel.length - 1; i >= 1; i--)\r\n\t{\r\n\t\tif (elSel.options[i].selected)\r\n\t\t{\r\n\t\t\telSel.remove(i);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction removeItem(itemNum)\r\n{\r\n\tgNumOptionalsAdded--;\r\n\tlet rowID = \"row_\" + itemNum;\r\n\tlet rowObj = document.getElementById(rowID);\r\n\trowObj.parentNode.removeChild(rowObj);\r\n\r\n\tlet sidesData = sidesDataArray[itemNum];\r\n\tlet sideName = \"(\" + sidesData['SUPC_number'] + \") \" + sidesData['name'];\r\n\r\n\tlet selObj = document.getElementById('sides');\r\n\r\n\tselObj.options[selObj.length] = new Option(sideName, itemNum);\r\n\r\n\tcalculatePage();\r\n}\r\n\r\nfunction displayValidationErrorMsg(msg)\r\n{\r\n\tmsg = \"<span style='color:red; font-size:larger;'>\" + msg + \"</span>\";\r\n\r\n\tdd_message({\r\n\t\ttitle: 'Error',\r\n\t\tmessage: msg\r\n\t});\r\n}\r\n\r\nfunction clearErrors()\r\n{\r\n\tlet statusDiv = document.getElementById('errorMsg');\r\n\tstatusDiv.style.display = 'none';\r\n\tlet statusTextDiv = document.getElementById('errorMsgText');\r\n\tstatusTextDiv.innerHTML = \"\";\r\n}\r\n\r\nfunction storeChange(obj)\r\n{\r\n\tdocument.getElementById('action').value = \"storeChange\";\r\n\tdocument.getElementById('menu_editor_form').submit();\r\n}\r\n\r\nfunction menuChange(obj)\r\n{\r\n\tdocument.getElementById('action').value = \"menuChange\";\r\n\tdocument.getElementById('menu_editor_form').submit();\r\n}\r\n\r\nfunction confirm_and_round_form(tab)\r\n{\r\n\tconst finalizeMessage = \"Are you sure want to update all Override Prices with rounded Markup Prices? \" +\r\n\t\t\"This action will replace existing override prices with the newly calculated price.\";\r\n\tlet hasOverridePrice = false;\r\n\t$('.' + tab + '-override-price-input').each(function () {\r\n\t\t\thasOverridePrice = $(this).val().trim() !== '';\r\n\t\t}\r\n\t);\r\n\r\n\tif (hasOverridePrice)\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Attention',\r\n\t\t\tmessage: finalizeMessage,\r\n\t\t\tmodal: true,\r\n\t\t\tconfirm: function () {\r\n\t\t\t\tround_markup_to_override(tab);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tcancel: function () {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\tround_markup_to_override(tab);\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfunction round_markup_to_override(tab)\r\n{\r\n\tlet dirty = false;\r\n\t$('.markup-price').each(function (index) {\r\n\t\tif ($(this).is('[readonly]'))\r\n\t\t{\r\n\t\t\t//nothing;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlet o_input = $(this).parent().find('.' + tab + '-override-price-input');\r\n\t\t\tif (o_input.length)\r\n\t\t\t{\r\n\t\t\t\tlet price = parseFloat($(this).text());\r\n\t\t\t\tlet o_price = Math.ceil(price * 2) / 2;\r\n\t\t\t\to_input.val(o_price.toFixed(2));\r\n\t\t\t\tdirty = true;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tif (dirty)\r\n\t{\r\n\t\tcalculatePage();\r\n\t\t$('#saved_message, #saved_message_2').showFlex();\r\n\t}\r\n\r\n}\r\n\r\nfunction selectedDefault()\r\n{\r\n\tif (notShown)\r\n\t{\r\n\t\tbootbox.alert(\"Any Menus that do not currently have their own specific settings finalized will inherit these default settings.\");\r\n\t\tnotShown = false;\r\n\t}\r\n\r\n\tcalculatePage();\r\n}\r\n\r\nfunction getXmlHttpObject()\r\n{\r\n\tlet objXMLHttp = null;\r\n\r\n\ttry\r\n\t{\r\n\t\t// Opera 8.0+, Firefox, Safari\r\n\t\tobjXMLHttp = new XMLHttpRequest();\r\n\t}\r\n\tcatch (e)\r\n\t{\r\n\t\t// Internet Explorer Browsers\r\n\t\ttry\r\n\t\t{\r\n\t\t\tobjXMLHttp = new ActiveXObject(\"Msxml2.XMLHTTP\");\r\n\t\t}\r\n\t\tcatch (e)\r\n\t\t{\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tobjXMLHttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t\t}\r\n\t\t\tcatch (e)\r\n\t\t\t{\r\n\t\t\t\t// Something went wrong\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn objXMLHttp;\r\n}\r\n\r\nfunction def_price_save_handleTimeout()\r\n{\r\n\tif (dp_processing)\r\n\t{\r\n\t\tdp_processing = false;\r\n\r\n\t\tlet printString = \"The server has not responded. Please try again.\";\r\n\r\n\t\tdocument.getElementById(\"dp_error\").style.display = 'block';\r\n\r\n\t\tdocument.getElementById(\"dp_error\").innerHTML = printString;\r\n\t\tdocument.getElementById('dp_proc_mess').style.display = \"none\";\r\n\t}\r\n}\r\n\r\nfunction def_price_retreive_handleTimeout()\r\n{\r\n\tif (dp_processing)\r\n\t{\r\n\t\tdp_processing = false;\r\n\r\n\t\tlet printString = \"The server has not responded. Please try again.\";\r\n\r\n\t\tdocument.getElementById(\"dp_error\").style.display = 'block';\r\n\r\n\t\tdocument.getElementById(\"dp_error\").innerHTML = printString;\r\n\t\tdocument.getElementById('dp_proc_mess').style.display = \"none\";\r\n\t}\r\n}\r\n\r\nfunction SaveDefPricingComplete()\r\n{\r\n\tif ((xmlHttp.readyState == 4 || xmlHttp.readyState == \"complete\") && dp_processing)\r\n\t{\r\n\t\tdp_processing = false;\r\n\t\tdocument.getElementById('dp_proc_mess').style.display = \"none\";\r\n\t\tlet printString = \"Sides &amp; Sweets default pricing has been saved\";\r\n\t\tdocument.getElementById(\"dp_error\").style.display = 'block';\r\n\t\tdocument.getElementById(\"dp_error\").innerHTML = printString;\r\n\t}\r\n}\r\n\r\nfunction RetrieveDefPricingComplete()\r\n{\r\n\tif ((xmlHttp.readyState == 4 || xmlHttp.readyState == \"complete\") && dp_processing)\r\n\t{\r\n\t\tdp_processing = false;\r\n\r\n\t\tif (xmlHttp.responseText && xmlHttp.responseText != \"error\" && xmlHttp.responseText != \"\")\r\n\t\t{\r\n\t\t\tlet pricingArray = xmlHttp.responseText.split(\"|\");\r\n\t\t\tlet RidMap = [];\r\n\t\t\tfor (let key in pricingArray)\r\n\t\t\t{\r\n\t\t\t\tvar item = pricingArray[key].split(\"~\");\r\n\t\t\t\tif (item[0])\r\n\t\t\t\t{\r\n\t\t\t\t\tRidMap[item[0]] = [\r\n\t\t\t\t\t\titem[1],\r\n\t\t\t\t\t\titem[2],\r\n\t\t\t\t\t\titem[3]\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcalculatePage();\r\n\r\n\t\t\tlet totalCurrentlyWebVisible = numberOfCustomerFacingCTSItems;\r\n\r\n\t\t\tlet ctsItemRows = document.getElementById('ctsItemsTbl').rows;\r\n\r\n\t\t\tfor (let i = 0; i < ctsItemRows.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ctsItemRows[i].id.indexOf('row_') == -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet itemNumber = null;\r\n\t\t\t\titemNumber = ctsItemRows[i].id.substr(4);\r\n\r\n\t\t\t\tlet rid = document.getElementById('rec_id_' + itemNumber).innerHTML;\r\n\r\n\t\t\t\tif (RidMap[rid])\r\n\t\t\t\t{\r\n\t\t\t\t\tlet overrideElemName = 'ovr_' + itemNumber;\r\n\t\t\t\t\tlet overrideElem = document.getElementById(overrideElemName);\r\n\t\t\t\t\tif (overrideElem)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toverrideElem.value = RidMap[rid][2];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet showCustomerBox = document.getElementById('vis_' + itemNumber);\r\n\r\n\t\t\t\t\tlet is_web_visible = showCustomerBox.checked;\r\n\r\n\t\t\t\t\tif (showCustomerBox)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (RidMap[rid][0] == \"1\")\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (!is_web_visible && totalCurrentlyWebVisible < 20)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tshowCustomerBox.checked = true;\r\n\t\t\t\t\t\t\t\ttotalCurrentlyWebVisible++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (is_web_visible)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tshowCustomerBox.checked = false;\r\n\t\t\t\t\t\t\t\ttotalCurrentlyWebVisible--;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet hideEverywhereBox = document.getElementById('hid_' + itemNumber);\r\n\t\t\t\t\tif (hideEverywhereBox)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (RidMap[rid][1] == \"1\")\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\thideEverywhereBox.checked = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\thideEverywhereBox.checked = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcalculatePage();\r\n\r\n\t\t\tdocument.getElementById('dp_proc_mess').style.display = \"none\";\r\n\t\t\tdocument.getElementById(\"dp_error\").style.display = 'none';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdocument.getElementById('dp_proc_mess').style.display = \"none\";\r\n\t\t\tlet printString = \"There was an error when retrieving the default prices. Please try again.\";\r\n\t\t\tdocument.getElementById(\"dp_error\").style.display = 'block';\r\n\t\t\tdocument.getElementById(\"dp_error\").innerHTML = printString;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction SavePricing()\r\n{\r\n\tdd_message({\r\n\t\ttitle: 'Save Default Pricing and Visibility',\r\n\t\tmessage: 'Are you sure you want to save the default Sides and Sweets pricing and visibility? This cannot be undone.',\r\n\t\tconfirm: function () {\r\n\t\t\tlet payLoad = \"data=\";\r\n\t\t\t// Chef Touched Selections\r\n\t\t\tlet ctsItemRows = document.getElementById('ctsItemsTbl').rows;\r\n\t\t\tfor (let i = 0; i < ctsItemRows.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ctsItemRows[i].id.indexOf('row_') == -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet itemNumber = null;\r\n\t\t\t\titemNumber = ctsItemRows[i].id.substr(4);\r\n\r\n\t\t\t\tlet rid = document.getElementById('rec_id_' + itemNumber).innerHTML;\r\n\r\n\t\t\t\tlet currentPrice = Number(menuInfo.mid[itemNumber].price);\r\n\t\t\t\tlet previewPrice = Number($(\"#row_\" + itemNumber + \" > .preview-price\").text());\r\n\t\t\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\r\n\t\t\t\tif (previewPrice != \"\" && previewPrice != 0 && !isNaN(previewPrice))\r\n\t\t\t\t{\r\n\t\t\t\t\tcurrentPrice = previewPrice;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (currentPrice < basePrice)\r\n\t\t\t\t{\r\n\t\t\t\t\tdocument.getElementById('dp_proc_mess').style.display = \"none\";\r\n\t\t\t\t\tdocument.getElementById(\"dp_error\").style.display = \"block\";\r\n\t\t\t\t\tdocument.getElementById(\"dp_error\").innerHTML = \"Override price must be greater than the price.\";\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet show_to_customer = \"0\";\r\n\r\n\t\t\t\tif (document.getElementById('vis_' + itemNumber) && document.getElementById('vis_' + itemNumber).checked)\r\n\t\t\t\t{\r\n\t\t\t\t\tshow_to_customer = \"1\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hide_completely = \"0\";\r\n\t\t\t\tif (document.getElementById('hid_' + itemNumber) && document.getElementById('hid_' + itemNumber).checked)\r\n\t\t\t\t{\r\n\t\t\t\t\thide_completely = \"1\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpayLoad += rid + \"~\" + show_to_customer + \"~\" + hide_completely + \"~\" + currentPrice + \"|\";\r\n\t\t\t}\r\n\r\n\t\t\txmlHttp = getXmlHttpObject();\r\n\t\t\tif (xmlHttp == null)\r\n\t\t\t{\r\n\t\t\t\t// temporary\r\n\t\t\t\tbootbox.alert(\"The Default Pricing function is not compatible with your browser. Please contact your store for assistance.\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdocument.getElementById('dp_proc_mess').style.display = \"inline\";\r\n\t\t\tdocument.getElementById(\"dp_error\").style.display = \"none\";\r\n\t\t\tdocument.getElementById(\"dp_error\").innerHTML = \"\";\r\n\r\n\t\t\tlet url = \"ddproc.php?processor=admin_defaultPricingProcessor&action=save&store_id=\" + storeInfo.id;\r\n\t\t\t//\tvar url = \"ddproc.php?processor=admin_defaultPricingProcessor&action=save&data=\" + payLoad + \"&store_id=<?=$this->store_id?>\";\r\n\t\t\txmlHttp.onreadystatechange = SaveDefPricingComplete;\r\n\r\n\t\t\txmlHttp.open(\"POST\", url, true);\r\n\t\t\txmlHttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n\t\t\txmlHttp.setRequestHeader(\"Content-length\", payLoad.length);\r\n\t\t\txmlHttp.setRequestHeader(\"Connection\", \"close\");\r\n\t\t\txmlHttp.send(payLoad);\r\n\r\n\t\t\tsetTimeout(\"def_price_save_handleTimeout();\", 20000);\r\n\t\t\tdp_processing = true;\r\n\t\t},\r\n\t\tcancel: function () {\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nfunction RetrievePricing()\r\n{\r\n\tif (dp_processing)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\txmlHttp = getXmlHttpObject();\r\n\tif (xmlHttp == null)\r\n\t{\r\n\t\t// temporary\r\n\t\tbootbox.alert(\"The Default Pricing function is not compatible with your browser. Please contact your store for assistance.\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tdd_message({\r\n\t\ttitle: 'Retrieve Default Pricing and Visibility',\r\n\t\tmessage: 'Are you sure you want to retrieve the default Sides and Sweets pricing and visibility? This cannot be undone.',\r\n\t\tconfirm: function () {\r\n\r\n\t\t\tdocument.getElementById('dp_proc_mess').style.display = \"inline\";\r\n\t\t\tdocument.getElementById(\"dp_error\").style.display = \"none\";\r\n\t\t\tdocument.getElementById(\"dp_error\").innerHTML = \"\";\r\n\r\n\t\t\tvar url = \"ddproc.php?processor=admin_defaultPricingProcessor&action=retrieve&store_id=\" + storeInfo.id;\r\n\t\t\t//\tvar url = \"ddproc.php?processor=admin_defaultPricingProcessor&action=save&data=\" + payLoad + \"&store_id=<?=$this->store_id?>\";\r\n\t\t\txmlHttp.onreadystatechange = RetrieveDefPricingComplete;\r\n\r\n\t\t\txmlHttp.open(\"GET\", url, true);\r\n\t\t\txmlHttp.send(null);\r\n\r\n\t\t\tsetTimeout(\"def_price_retreive_handleTimeout();\", 20000);\r\n\t\t\tdp_processing = true;\r\n\t\t},\r\n\t\tcancel: function () {\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nfunction calculatePage()\r\n{\r\n\tnumberOfCustomerFacingCTSItems = 0;\r\n\tnumberOfCustomerFacingEFLItems = 0;\r\n\r\n\tlet uniqueEFLEntreeId = [];\r\n\tlet is_unsaved = false;\r\n\r\n\tlet sidesCount = 0;\r\n\r\n\tlet current2ServMarkup = ((!$('#markup_2_serving').val()) ? null : $('#markup_2_serving').val());\r\n\tlet current3ServMarkup = ((!$('#markup_3_serving').val()) ? null : $('#markup_3_serving').val());\r\n\tlet current4ServMarkup = ((!$('#markup_4_serving').val()) ? null : $('#markup_4_serving').val());\r\n\tlet current6ServMarkup = ((!$('#markup_6_serving').val()) ? null : $('#markup_6_serving').val());\r\n\tlet currentSidesMarkup = ((!$('#markup_sides').val()) ? null : $('#markup_sides').val());\r\n\tlet currentAssemblyFee = ((!$('#assembly_fee').val()) ? null : $('#assembly_fee').val());\r\n\tlet currentDeliveryAssemblyFee = ((!$('#delivery_assembly_fee').val()) ? null : $('#delivery_assembly_fee').val());\r\n\r\n\tlet currentDefaultStatus = document.getElementById('is_default_markupno').checked ? 0 : 1;\r\n\r\n\tif ($('#delivery_assembly_fee').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.delivery_assembly_fee) != formatAsMoney(currentDeliveryAssemblyFee))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 1\");\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#assembly_fee').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.assembly_fee) != formatAsMoney(currentAssemblyFee))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 2\");\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#markup_2_serving').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.markup_value_2_serving) != formatAsMoney(current2ServMarkup))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 3\");\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#markup_3_serving').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.markup_value_3_serving) != formatAsMoney(current3ServMarkup))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 4\");\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#markup_4_serving').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.markup_value_4_serving) != formatAsMoney(current4ServMarkup))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 5\");\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#markup_6_serving').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.markup_value_6_serving) != formatAsMoney(current6ServMarkup))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 6\");\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#markup_sides').length != 0)\r\n\t{\r\n\t\tif (formatAsMoney(markupData.markup_value_sides) != formatAsMoney(currentSidesMarkup))\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 7\");\r\n\t\t}\r\n\t}\r\n\r\n\tif (menuInfo.menu_id != '100')\r\n\t{\r\n\t\tif (markupData.is_default != currentDefaultStatus)\r\n\t\t{\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 8\");\r\n\t\t}\r\n\t}\r\n\r\n\tlet itemRows = document.getElementById('itemsTbl').rows;\r\n\r\n\tfor (let i = 0; i < itemRows.length; i++)\r\n\t{\r\n\t\tif (itemRows[i].id.indexOf('row_') == -1 && itemRows[i].id != 'addonEditorRow')\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tlet itemNumber = null;\r\n\r\n\t\tif (itemRows[i].id == 'addonEditorRow')\r\n\t\t{\r\n\t\t\titemNumber = itemRows[i].getAttribute('item_id');\r\n\t\t\tif (!itemNumber)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\titemNumber = itemRows[i].id.substr(4);\r\n\t\t}\r\n\r\n\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\t\tlet currentPrice = Number(menuInfo.mid[itemNumber].price);\r\n\r\n\t\tlet ltd_menu_item_value = 0;\r\n\t\tif (storeInfo.supports_ltd_roundup == 1)\r\n\t\t{\r\n\t\t\tltd_menu_item_value = Number(formatAsMoney(menuInfo.mid[itemNumber].ltd_menu_item_value));\r\n\t\t}\r\n\r\n\t\tif (menuInfo.mid[itemNumber].is_chef_touched == '1')\r\n\t\t{\r\n\t\t\tsidesCount++;\r\n\t\t}\r\n\r\n\t\tlet overridePrice = Number(0);\r\n\t\tlet orgOverridePrice = Number(0);\r\n\r\n\t\tif (document.getElementById('ovr_' + itemNumber))\r\n\t\t{\r\n\t\t\toverridePrice = Number(formatAsMoney(document.getElementById('ovr_' + itemNumber).value));\r\n\t\t\torgOverridePrice = Number(formatAsMoney(document.getElementById('ovr_' + itemNumber).getAttribute('data-orgval')));\r\n\t\t}\r\n\r\n\t\tif (overridePrice > 0 && ltd_menu_item_value > 0)\r\n\t\t{\r\n\t\t\toverridePrice = Number(formatAsMoney((overridePrice * 1) + (ltd_menu_item_value * 1)));\r\n\t\t}\r\n\r\n\t\tlet markupPrice = null;\r\n\r\n\t\t// if current markup then update markup column\r\n\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html();\r\n\r\n\t\tif (menuInfo.mid[itemNumber].pricing_type == \"HALF\")\r\n\t\t{\r\n\t\t\tif (current3ServMarkup == 0 || current3ServMarkup == null || current3ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current3ServMarkup) + 0.000000001) / 100));\r\n\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (menuInfo.mid[itemNumber].pricing_type == \"TWO\")\r\n\t\t{\r\n\t\t\tif (current2ServMarkup == 0 || current2ServMarkup == null || current2ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current2ServMarkup) + 0.000000001) / 100));\r\n\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (menuInfo.mid[itemNumber].pricing_type == \"FOUR\")\r\n\t\t{\r\n\t\t\tif (current4ServMarkup == 0 || current4ServMarkup == null || current4ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current4ServMarkup) + 0.000000001) / 100));\r\n\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse // menuInfo.mid[itemNumber].pricing_type == \"FULL\"\r\n\t\t{\r\n\t\t\tif (current6ServMarkup == 0 || current6ServMarkup == null || current6ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current6ServMarkup) + 0.00000001) / 100));\r\n\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\r\n\t\t\t\tif (ltd_menu_item_value > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkupPrice = Number((markupPrice * 1) + (ltd_menu_item_value * 1));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmarkupPrice = formatAsMoney(markupPrice) * 1;\r\n\r\n\t\tlet ORdelta = overridePrice - currentPrice;\r\n\t\tlet MUdelta = markupPrice - currentPrice;\r\n\r\n\t\tlet newPriceByMarkUp = false;\r\n\t\tif (MUdelta != 0 && ORdelta != 0)\r\n\t\t{\r\n\t\t\tnewPriceByMarkUp = true;\r\n\t\t}\r\n\r\n\t\tif (isEnabled_Markup && newPriceByMarkUp > 0 && overridePrice == 0)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(markupPrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 9\");\r\n\t\t}\r\n\t\telse if (overridePrice > 0 && ORdelta != 0)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(overridePrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 10\");\r\n\t\t}\r\n\t\telse if (isEnabled_Markup && overridePrice > 0 && newPriceByMarkUp)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(markupPrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 11\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text('');\r\n\t\t}\r\n\r\n\t\tlet visFlag = document.getElementById(\"vis_\" + itemNumber);\r\n\t\tif (visFlag)\r\n\t\t{\r\n\t\t\torgState = visFlag.getAttribute('data-orgval');\r\n\t\t\tif ((visFlag.checked && orgState != 'CHECKED') || (!visFlag.checked && orgState == 'CHECKED'))\r\n\t\t\t{\r\n\t\t\t\tis_unsaved = true;\r\n\t\t\t\t//dd_console_log(\"Unsaved 12\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// EFL Items\r\n\r\n\tlet EFL_itemRows = document.getElementById('EFLitemsTbl').rows;\r\n\r\n\tfor (let i = 0; i < EFL_itemRows.length; i++)\r\n\t{\r\n\t\tif (EFL_itemRows[i].id.indexOf('row_') == -1 && EFL_itemRows[i].id != 'addonEditorRow')\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tlet itemNumber = null;\r\n\t\tif (EFL_itemRows[i].id == 'addonEditorRow')\r\n\t\t{\r\n\t\t\titemNumber = EFL_itemRows[i].getAttribute('item_id');\r\n\t\t\tif (!itemNumber)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\titemNumber = EFL_itemRows[i].id.substr(4);\r\n\t\t}\r\n\r\n\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\t\tlet currentPrice = Number(menuInfo.mid[itemNumber].price);\r\n\r\n\t\tif (!$('#vis_' + itemNumber).is(':checked'))\r\n\t\t{\r\n\t\t\tlet entreeId = $('#vis_' + itemNumber).data('entree_id');\r\n\r\n\t\t\tif (!uniqueEFLEntreeId.includes(entreeId))\r\n\t\t\t{\r\n\t\t\t\tnumberOfCustomerFacingEFLItems++;\r\n\t\t\t\tuniqueEFLEntreeId.push(entreeId);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (menuInfo.mid[itemNumber].is_chef_touched == '1')\r\n\t\t{\r\n\t\t\tsidesCount++;\r\n\t\t}\r\n\r\n\t\tif (itemNumber == 13944)\r\n\t\t{\r\n\t\t\tlet x = 1;\r\n\t\t}\r\n\r\n\t\tlet overridePrice = Number(0);\r\n\t\tlet orgOverridePrice = Number(0);\r\n\r\n\t\tif (document.getElementById('ovr_' + itemNumber))\r\n\t\t{\r\n\t\t\toverridePrice = Number(formatAsMoney(document.getElementById('ovr_' + itemNumber).value));\r\n\t\t\torgOverridePrice = Number(formatAsMoney(document.getElementById('ovr_' + itemNumber).getAttribute('data-orgval')));\r\n\t\t}\r\n\r\n\t\tlet markupPrice = null;\r\n\r\n\t\t// if current markup then update markup column\r\n\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html();\r\n\r\n\t\tif (menuInfo.mid[itemNumber].pricing_type == \"HALF\")\r\n\t\t{\r\n\t\t\tif (current3ServMarkup == 0 || current3ServMarkup == null || current3ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current3ServMarkup) + 0.00000001) / 100));\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (menuInfo.mid[itemNumber].pricing_type == \"TWO\")\r\n\t\t{\r\n\t\t\tif (current2ServMarkup == 0 || current2ServMarkup == null || current2ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current2ServMarkup) + 0.00000001) / 100));\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (menuInfo.mid[itemNumber].pricing_type == \"FOUR\")\r\n\t\t{\r\n\t\t\tif (current4ServMarkup == 0 || current4ServMarkup == null || current4ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t}\r\n\t\t\telse // menuInfo.mid[itemNumber].pricing_type == \"FULL\"\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current4ServMarkup) + 0.00000001) / 100));\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse // servingSize == \"FULL\"\r\n\t\t{\r\n\t\t\tif (current6ServMarkup == 0 || current6ServMarkup == null || current6ServMarkup == \"\")\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = basePrice;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * current6ServMarkup) + 0.00000001) / 100));\r\n\t\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet markdown_change = false;\r\n\t\t// At this point we know the new price... apply the markdown if it exists\r\n\t\tif (isEnabled_Markup && $('#mkdn_' + itemNumber)[0])\r\n\t\t{\r\n\t\t\tlet markdown = $('#mkdn_' + itemNumber);\r\n\t\t\tlet markdown_value = formatAsMoney(markdown.data('markdown_value'));\r\n\t\t\tlet original_markdown = markdown.data('org_val');\r\n\t\t\tlet markedDownPrice = 0;\r\n\t\t\tif (overridePrice > 0)\r\n\t\t\t{\r\n\t\t\t\toverridePrice -= formatAsMoney(overridePrice * (markdown_value / 100));\r\n\t\t\t\tmarkedDownPrice = overridePrice;\r\n\t\t\t}\r\n\t\t\telse if (markupPrice > 0)\r\n\t\t\t{\r\n\t\t\t\tlet discount = Number(formatAsMoney(markupPrice * (markdown_value / 100)));\r\n\t\t\t\tmarkupPrice = formatAsMoney((markupPrice * 100) / 100);\r\n\t\t\t\tmarkupPrice = Math.round((markupPrice - discount.valueOf()) * 100) / 100;\r\n\t\t\t\tmarkedDownPrice = markupPrice;\r\n\t\t\t}\r\n\r\n\t\t\tif (original_markdown != markdown_value)\r\n\t\t\t{\r\n\t\t\t\tmarkdown_change = true;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet ORdelta = overridePrice - currentPrice;\r\n\t\tlet MUdelta = markupPrice - currentPrice;\r\n\r\n\t\tif (Math.abs(ORdelta) < .005)\r\n\t\t{\r\n\t\t\tORdelta = 0;\r\n\t\t}\r\n\t\tif (Math.abs(MUdelta) < .005)\r\n\t\t{\r\n\t\t\tMUdelta = 0;\r\n\t\t}\r\n\r\n\t\tlet newPriceByMarkUp = false;\r\n\t\tif (MUdelta != 0 && ORdelta != 0)\r\n\t\t{\r\n\t\t\tnewPriceByMarkUp = true;\r\n\t\t}\r\n\r\n\t\tif (overridePrice > 0 && ORdelta != 0)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(overridePrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 13\");\r\n\t\t}\r\n\t\telse if (isEnabled_Markup && newPriceByMarkUp)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(markupPrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 14\");\r\n\t\t}\r\n\t\telse if (markdown_change)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(markedDownPrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text('');\r\n\t\t}\r\n\r\n\t\tlet visFlag = document.getElementById(\"vis_\" + itemNumber);\r\n\t\tif (visFlag)\r\n\t\t{\r\n\t\t\tlet orgState = visFlag.getAttribute('data-orgval');\r\n\t\t\tif ((visFlag.checked && orgState != 'CHECKED') || (!visFlag.checked && orgState == 'CHECKED'))\r\n\t\t\t{\r\n\t\t\t\tis_unsaved = true;\r\n\t\t\t\t//dd_console_log(\"Unsaved 15\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet picFlag = document.getElementById(\"pic_\" + itemNumber);\r\n\t\tif (picFlag)\r\n\t\t{\r\n\t\t\tlet orgState = picFlag.getAttribute('data-orgval');\r\n\t\t\tif ((picFlag.checked && orgState != 'CHECKED') || (!picFlag.checked && orgState == 'CHECKED'))\r\n\t\t\t{\r\n\t\t\t\tis_unsaved = true;\r\n\t\t\t\t//dd_console_log(\"Unsaved 16\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Chef Touched Selections\r\n\tlet ctsItemRows = document.getElementById('ctsItemsTbl').rows;\r\n\tfor (let i = 0; i < ctsItemRows.length; i++)\r\n\t{\r\n\t\tif (ctsItemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tlet itemNumber = null;\r\n\t\titemNumber = ctsItemRows[i].id.substr(4);\r\n\r\n\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\t\tlet currentPrice = Number(menuInfo.mid[itemNumber].price);\r\n\r\n\t\tif (menuInfo.mid[itemNumber].is_chef_touched == '1')\r\n\t\t{\r\n\t\t\tsidesCount++;\r\n\t\t}\r\n\r\n\t\tlet overridePrice = Number(0);\r\n\t\tlet orgOverridePrice = Number(0);\r\n\r\n\t\tif (document.getElementById('ovr_' + itemNumber))\r\n\t\t{\r\n\t\t\toverridePrice = Number(formatAsMoney(document.getElementById('ovr_' + itemNumber).value));\r\n\t\t\torgOverridePrice = Number(formatAsMoney(document.getElementById('ovr_' + itemNumber).getAttribute('data-orgval')));\r\n\t\t}\r\n\r\n\t\tlet markupPrice = null;\r\n\r\n\t\tif ($('#vis_' + itemNumber).is(':checked'))\r\n\t\t{\r\n\t\t\tnumberOfCustomerFacingCTSItems++;\r\n\t\t}\r\n\r\n\t\tif (currentSidesMarkup == 0 || currentSidesMarkup == null || currentSidesMarkup == \"\")\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html();\r\n\t\t\tmarkupPrice = basePrice;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmarkupPrice = formatAsMoney(basePrice + (Math.round((basePrice * currentSidesMarkup) + 0.00000001) / 100));\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .markup-price\").html(markupPrice);\r\n\t\t}\r\n\r\n\t\tmarkupPrice = formatAsMoney(markupPrice) * 1;\r\n\r\n\t\tlet ORdelta = overridePrice - currentPrice;\r\n\t\tlet MUdelta = markupPrice - currentPrice;\r\n\r\n\t\tlet newPriceByMarkUp = false;\r\n\t\tif (MUdelta != 0 && ORdelta != 0)\r\n\t\t{\r\n\t\t\tnewPriceByMarkUp = true;\r\n\t\t}\r\n\r\n\t\tif (overridePrice > 0 && ORdelta != 0)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(overridePrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 17\");\r\n\t\t}\r\n\t\telse if (isEnabled_Markup && newPriceByMarkUp)\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text(formatAsMoney(markupPrice));\r\n\t\t\tis_unsaved = true;\r\n\t\t\t//dd_console_log(\"Unsaved 18\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"#row_\" + itemNumber + \" > .preview-price\").text('');\r\n\t\t}\r\n\r\n\t\tlet visFlag = document.getElementById(\"vis_\" + itemNumber);\r\n\t\tif (visFlag)\r\n\t\t{\r\n\t\t\tlet orgState = visFlag.getAttribute('data-orgval');\r\n\t\t\tif ((visFlag.checked && orgState != 'CHECKED') || (!visFlag.checked && orgState == 'CHECKED'))\r\n\t\t\t{\r\n\t\t\t\tis_unsaved = true;\r\n\t\t\t\t//dd_console_log(\"Unsaved 19\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet hidFlag = document.getElementById(\"hid_\" + itemNumber);\r\n\t\tif (hidFlag)\r\n\t\t{\r\n\t\t\tlet orgState = hidFlag.getAttribute('data-orgval');\r\n\t\t\tif ((hidFlag.checked && orgState != 'CHECKED') || (!hidFlag.checked && orgState == 'CHECKED'))\r\n\t\t\t{\r\n\t\t\t\tis_unsaved = true;\r\n\t\t\t\t//dd_console_log(\"Unsaved 20\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet formFlag = document.getElementById(\"form_\" + itemNumber);\r\n\t\tif (formFlag)\r\n\t\t{\r\n\t\t\tlet orgState = formFlag.getAttribute('data-orgval');\r\n\t\t\tif ((formFlag.checked && orgState != 'CHECKED') || (!formFlag.checked && orgState == 'CHECKED'))\r\n\t\t\t{\r\n\t\t\t\tis_unsaved = true;\r\n\t\t\t\t//dd_console_log(\"Unsaved 21\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif (gNumOptionalsAdded != 0)\r\n\t{\r\n\t\tis_unsaved = true;\r\n\t\t//dd_console_log(\"Unsaved 22\");\r\n\t}\r\n\r\n\tif (is_unsaved)\r\n\t{\r\n\t\t$('#saved_message, #saved_message_2').showFlex();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#saved_message, #saved_message_2').hideFlex();\r\n\t}\r\n}\r\n\r\nfunction confirm_and_check_form()\r\n{\r\n\tlet form = $(\"#menu_editor_form\")[0];\r\n\r\n\tclearErrors();\r\n\r\n\tlet validated = _check_form(form);\r\n\r\n\tlet current2ServMarkup = ((!$('#markup_2_serving').val()) ? null : $('#markup_2_serving').val());\r\n\tlet current3ServMarkup = ((!$('#markup_3_serving').val()) ? null : $('#markup_3_serving').val());\r\n\tlet current4ServMarkup = ((!$('#markup_4_serving').val()) ? null : $('#markup_4_serving').val());\r\n\tlet current6ServMarkup = ((!$('#markup_6_serving').val()) ? null : $('#markup_6_serving').val());\r\n\tlet currentSidesMarkup = ((!$('#markup_sides').val()) ? null : $('#markup_sides').val());\r\n\tlet warnOffOfEmptyMarkups = false;\r\n\r\n\tlet currentVolumeReward = \"0\";\r\n\r\n\tlet message = \"\";\r\n\r\n\tif (validated)\r\n\t{\r\n\t\tif (current2ServMarkup < 0 || current4ServMarkup < 0 || current3ServMarkup < 0 || current6ServMarkup < 0 || currentSidesMarkup < 0)\r\n\t\t{\r\n\t\t\tmessage = \"Negative per cent markups are not currently permitted.<br />\";\r\n\t\t}\r\n\r\n\t\tif (current2ServMarkup > 70 || current4ServMarkup > 70 || current3ServMarkup > 70 || current6ServMarkup > 70 || currentSidesMarkup > 70)\r\n\t\t{\r\n\t\t\tmessage += \"Markups greater than 70% are not currently permitted.<br />\";\r\n\t\t}\r\n\r\n\t\tif (currentVolumeReward < 0)\r\n\t\t{\r\n\t\t\tmessage += \"Negative volume discounts are not permitted.<br />\";\r\n\t\t}\r\n\r\n\t\tif (currentVolumeReward > 75)\r\n\t\t{\r\n\t\t\tmessage += \"Volume Dscounts greater than $75.00 are not currently permitted.<br />\";\r\n\t\t}\r\n\r\n\t\tif (currentVolumeReward == \"\")\r\n\t\t{\r\n\t\t\tmessage += \"Please supply a valid volume discount. Use zero if you want no volume discount applied.<br />\";\r\n\t\t}\r\n\r\n\t\tif (($('#markup_2_serving').length != 0 && current2ServMarkup == null) || ($('#markup_4_serving').length != 0 && current4ServMarkup == null) || ($('#markup_3_serving').length != 0 && current3ServMarkup == null) || ($('#markup_6_serving').length != 0 && current6ServMarkup == null) || ($('#markup_sides').length != 0 && currentSidesMarkup == null))\r\n\t\t{\r\n\t\t\twarnOffOfEmptyMarkups = true;\r\n\t\t}\r\n\r\n\t\tlet assembly_fee = ((!$('#assembly_fee').val()) ? 0 : $('#assembly_fee').val());\r\n\t\tif (assembly_fee < 0)\r\n\t\t{\r\n\t\t\tmessage += \"The Assembly Fee must be greater than or equal to 0.<br />\";\r\n\t\t}\r\n\r\n\t\tlet delivery_assembly_fee = ((!$('#delivery_assembly_fee').val()) ? 0 : $('#delivery_assembly_fee').val())\r\n\t\tif (delivery_assembly_fee < 0)\r\n\t\t{\r\n\t\t\tmessage += \"The Delivery Assembly Fee must be greater than or equal to 0.<br />\";\r\n\t\t}\r\n\r\n\t\tlet itemRows = document.getElementById('itemsTbl').rows;\r\n\r\n\t\tlet encounteredBasePriceIssue = false;\r\n\t\tlet problemItemList = \"\";\r\n\r\n\t\tfor (let i = 0; i < itemRows.length; i++)\r\n\t\t{\r\n\t\t\tif (itemRows[i].id.indexOf('row_') == -1)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet itemNumber = itemRows[i].id.substr(4);\r\n\t\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\t\t\tlet overridePrice = \"\";\r\n\r\n\t\t\tif (document.getElementById('ovr_' + itemNumber))\r\n\t\t\t{\r\n\t\t\t\toverridePrice = Number(document.getElementById('ovr_' + itemNumber).value);\r\n\t\t\t}\r\n\r\n\t\t\tif (overridePrice && overridePrice != \"\")\r\n\t\t\t{\r\n\t\t\t\tif (noOverrideUnderBase && overridePrice < basePrice)\r\n\t\t\t\t{\r\n\t\t\t\t\tencounteredBasePriceIssue = true;\r\n\r\n\t\t\t\t\tproblemItemList += menuInfo.mid[itemNumber].menu_item_name + \"<br />\";\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (overridePrice > 999)\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += \"The Override Price must be less than $999.00<br />\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet EFL_itemRows = document.getElementById('EFLitemsTbl').rows;\r\n\r\n\t\tfor (let i = 0; i < EFL_itemRows.length; i++)\r\n\t\t{\r\n\t\t\tif (EFL_itemRows[i].id.indexOf('row_') == -1)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet itemNumber = EFL_itemRows[i].id.substr(4);\r\n\t\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\r\n\t\t\tlet markdownObj = $(\"#mkdn_\" + itemNumber)[0];\r\n\t\t\tlet markDownPostObj = $(\"#upd_mkdn_\" + itemNumber)[0];\r\n\r\n\t\t\tif (markdownObj)\r\n\t\t\t{\r\n\t\t\t\tlet value = $(markdownObj).data(\"markdown_id\") + \"|\" + $(markdownObj).data(\"markdown_value\");\r\n\r\n\t\t\t\tif (!markDownPostObj)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet el = document.createElement('input');\r\n\t\t\t\t\tel.setAttribute(\"type\", \"hidden\");\r\n\t\t\t\t\tel.setAttribute(\"value\", value);\r\n\t\t\t\t\tlet idStr = \"upd_mkdn_\" + itemNumber;\r\n\t\t\t\t\tel.setAttribute(\"id\", idStr);\r\n\t\t\t\t\tel.setAttribute(\"name\", idStr);\r\n\t\t\t\t\tmarkdownObj.appendChild(el);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmarkDownPostObj.val(value);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet overridePrice = \"\";\r\n\r\n\t\t\tif (document.getElementById('ovr_' + itemNumber))\r\n\t\t\t{\r\n\t\t\t\toverridePrice = Number(document.getElementById('ovr_' + itemNumber).value);\r\n\t\t\t}\r\n\r\n\t\t\tif (overridePrice && overridePrice != \"\")\r\n\t\t\t{\r\n\t\t\t\tif (noOverrideUnderBase && overridePrice < basePrice)\r\n\t\t\t\t{\r\n\t\t\t\t\tencounteredBasePriceIssue = true;\r\n\t\t\t\t\tproblemItemList += menuInfo.mid[itemNumber].menu_item_name + \"<br />\";\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (overridePrice > 999)\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += \"The Override Price must be less than $999.00<br />\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet ctsItemRows = document.getElementById('ctsItemsTbl').rows;\r\n\r\n\t\tfor (let i = 0; i < ctsItemRows.length; i++)\r\n\t\t{\r\n\t\t\tif (ctsItemRows[i].id.indexOf('row_') == -1)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet itemNumber = ctsItemRows[i].id.substr(4);\r\n\t\t\tlet basePrice = Number(menuInfo.mid[itemNumber].base_price);\r\n\t\t\tlet overridePrice = \"\";\r\n\r\n\t\t\tif (document.getElementById('ovr_' + itemNumber))\r\n\t\t\t{\r\n\t\t\t\toverridePrice = Number(document.getElementById('ovr_' + itemNumber).value);\r\n\t\t\t}\r\n\r\n\t\t\tif (overridePrice && overridePrice != \"\")\r\n\t\t\t{\r\n\t\t\t\tif (noOverrideUnderBase && overridePrice < basePrice)\r\n\t\t\t\t{\r\n\t\t\t\t\tencounteredBasePriceIssue = true;\r\n\t\t\t\t\tproblemItemList += menuInfo.mid[itemNumber].menu_item_name + \"<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (overridePrice > 999)\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += \"The Override Price must be less than $999.00<br />\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (encounteredBasePriceIssue)\r\n\t\t{\r\n\t\t\tmessage += \"The Override Price must be greater than the base price for:<br />\";\r\n\t\t\tmessage += problemItemList;\r\n\r\n\t\t}\r\n\r\n\t\tif (message != \"\")\r\n\t\t{\r\n\t\t\tvalidated = false;\r\n\t\t\tdisplayValidationErrorMsg(message);\r\n\t\t}\r\n\t}\r\n\r\n\tif (validated)\r\n\t{\r\n\t\tlet finalizeMessage = \"Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.\";\r\n\r\n\t\tif (warnOffOfEmptyMarkups)\r\n\t\t{\r\n\t\t\tfinalizeMessage += \"<br /><br /><span class='text-red font-weight-bold'>One or more of the Percentage MarkUp values is empty or 0. Please review and correct if this was unintentional.</span><br />\";\r\n\t\t}\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Attention',\r\n\t\t\tmessage: finalizeMessage,\r\n\t\t\tmodal: true,\r\n\t\t\tconfirm: function () {\r\n\t\t\t\tdocument.getElementById('action').value = \"finalize\";\r\n\t\t\t\t$(\"#menu_editor_form\").submit();\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tcancel: function () {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/*\r\n\t\tif (confirm(finalizeMessage))\r\n\t\t{\r\n\t\t\tdocument.getElementById('action').value = \"finalize\";\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfunction getMarkUpPrice(servingsSize, basePrice)\r\n{\r\n\r\n\tlet markupPrice = Number(basePrice);\r\n\tbasePrice = Number(basePrice);\r\n\r\n\tlet current2ServMarkup = ((!$('#markup_2_serving').val()) ? null : $('#markup_2_serving').val());\r\n\tlet current3ServMarkup = ((!$('#markup_3_serving').val()) ? null : $('#markup_3_serving').val());\r\n\tlet current4ServMarkup = ((!$('#markup_4_serving').val()) ? null : $('#markup_4_serving').val());\r\n\tlet current6ServMarkup = ((!$('#markup_6_serving').val()) ? null : $('#markup_6_serving').val());\r\n\r\n\t// if current markup then update markup column\r\n\tif (servingsSize == \"Sm (2)\")\r\n\t{\r\n\t\tif (current2ServMarkup == 0 || current2ServMarkup == null || current2ServMarkup == \"\")\r\n\t\t{\r\n\t\t\tmarkupPrice = basePrice.valueOf();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmarkupPrice = formatAsMoney(basePrice.valueOf() + (Math.round(basePrice.valueOf() * current2ServMarkup) / 100));\r\n\t\t}\r\n\t}\r\n\telse if (servingsSize == \"Md (4)\")\r\n\t{\r\n\t\tif (current4ServMarkup == 0 || current4ServMarkup == null || current4ServMarkup == \"\")\r\n\t\t{\r\n\t\t\tmarkupPrice = basePrice.valueOf();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmarkupPrice = formatAsMoney(basePrice.valueOf() + (Math.round(basePrice.valueOf() * current4ServMarkup) / 100));\r\n\t\t}\r\n\t}\r\n\telse if (servingsSize == \"Md (3)\")\r\n\t{\r\n\t\tif (current3ServMarkup == 0 || current3ServMarkup == null || current3ServMarkup == \"\")\r\n\t\t{\r\n\t\t\tmarkupPrice = basePrice.valueOf();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmarkupPrice = formatAsMoney(basePrice.valueOf() + (Math.round(basePrice.valueOf() * current3ServMarkup) / 100));\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif (current6ServMarkup == 0 || current6ServMarkup == null || current6ServMarkup == \"\")\r\n\t\t{\r\n\t\t\tmarkupPrice = basePrice.valueOf();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmarkupPrice = formatAsMoney(basePrice.valueOf() + (Math.round(basePrice.valueOf() * current6ServMarkup) / 100));\r\n\t\t}\r\n\t}\r\n\r\n\treturn markupPrice;\r\n}\r\n\r\nfunction addUnsavedEFLItem(item_id, name, size, base_price, thisItemCount, countItemsInRecipe)\r\n{\r\n\tlet insertCellNum = 0;\r\n\r\n\tif (item_id == 0)\r\n\t{\r\n\t\treturn;\r\n\t} // do nothing\r\n\r\n\tvar tbl = document.getElementById('EFLitemsTbl');\r\n\r\n\tvar row = tbl.insertRow(-1);\r\n\trow.setAttribute(\"id\", \"row_\" + item_id);\r\n\r\n\t// visibility cell\r\n\tvar cellLeft = row.insertCell(0);\r\n\r\n\tvar visBox = document.createElement(\"input\");\r\n\r\n\tvisBox.setAttribute(\"type\", \"checkbox\");\r\n\tvar idStr = \"vis_\" + item_id;\r\n\tvisBox.setAttribute(\"id\", idStr);\r\n\tvisBox.setAttribute(\"name\", idStr);\r\n\tvisBox.setAttribute(\"class\", \"align-middle\");\r\n\tvisBox.setAttribute(\"data-orgval\", \"CHECKED\");\r\n\tvisBox.setAttribute(\"data-menu_item_id\", item_id);\r\n\tvisBox.setAttribute(\"checked\", \"checked\");\r\n\tcellLeft.appendChild(visBox);\r\n\r\n\t// picksheet cell\r\n\tvar cellLeft2 = row.insertCell(++insertCellNum);\r\n\r\n\tvar pickBox = document.createElement(\"input\");\r\n\r\n\tpickBox.setAttribute(\"type\", \"checkbox\");\r\n\tvar idStr = \"pic_\" + item_id;\r\n\tpickBox.setAttribute(\"id\", idStr);\r\n\tpickBox.setAttribute(\"name\", idStr);\r\n\tpickBox.setAttribute(\"class\", \"align-middle\");\r\n\tpickBox.setAttribute(\"data-orgval\", \"\");\r\n\tpickBox.setAttribute(\"step\", \"any\");\r\n\r\n\tcellLeft2.appendChild(pickBox);\r\n\r\n\t// name cell\r\n\tvar cellName = row.insertCell(++insertCellNum);\r\n\tcellName.setAttribute(\"class\", \"align-middle text-left\");\r\n\r\n\tvar nameNode = document.createTextNode(name);\r\n\tcellName.appendChild(nameNode);\r\n\r\n\t// size cell\r\n\tvar cellSize = row.insertCell(++insertCellNum);\r\n\tcellSize.setAttribute(\"class\", \"align-middle\");\r\n\r\n\tvar el = document.createTextNode(size);\r\n\tcellSize.appendChild(el);\r\n\r\n\tif (isEnabled_Markup)\r\n\t{\r\n\t\t// basePrice cell\r\n\t\tvar cellbase = row.insertCell(++insertCellNum);\r\n\t\tcellbase.setAttribute(\"class\", \"align-middle\");\r\n\r\n\t\tvar el = document.createTextNode(formatAsMoney(base_price));\r\n\t\tcellbase.appendChild(el);\r\n\r\n\t\tvar markup_price = getMarkUpPrice(size, base_price);\r\n\t}\r\n\r\n\t// currentPrice cell\r\n\tvar cellcurrent = row.insertCell(++insertCellNum);\r\n\tcellcurrent.setAttribute(\"class\", \"align-middle\");\r\n\r\n\tif (isEnabled_Markup)\r\n\t{\r\n\t\tvar el = document.createTextNode(markup_price);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar el = document.createTextNode(formatAsMoney(base_price));\r\n\t}\r\n\tcellcurrent.appendChild(el);\r\n\r\n\tif (isEnabled_Markup)\r\n\t{\r\n\t\t// markupPrice cell\r\n\t\tvar cellmarkup = row.insertCell(++insertCellNum);\r\n\t\tcellmarkup.setAttribute(\"class\", \"align-middle markup-price\");\r\n\r\n\t\tvar el = document.createTextNode(markup_price);\r\n\t\tcellmarkup.appendChild(el);\r\n\t}\r\n\r\n\t// overridePrice cell\r\n\tvar celloverride = row.insertCell(++insertCellNum);\r\n\r\n\tvar el = document.createElement('input');\r\n\tel.setAttribute(\"type\", \"number\");\r\n\tel.setAttribute(\"size\", \"3\");\r\n\tel.setAttribute(\"step\", \"any\");\r\n\r\n\tel.setAttribute(\"class\", \"form-control form-control-sm no-spin-button\");\r\n\r\n\tel.setAttribute(\"maxlength\", \"6\");\r\n\tel.setAttribute(\"data-orgval\", \"\");\r\n\r\n\tvar idStr = \"ovr_\" + item_id;\r\n\tel.setAttribute(\"id\", idStr);\r\n\tel.setAttribute(\"name\", idStr);\r\n\tif (!isEnabled_Markup)\r\n\t{\r\n\t\tel.setAttribute(\"value\", formatAsMoney(base_price));\r\n\t}\r\n\tcelloverride.appendChild(el);\r\n\r\n\t// markdown\r\n\tvar cellmarkdown = row.insertCell(++insertCellNum);\r\n\r\n\tvar el = document.createElement('button');\r\n\tvar idStr = \"add-mkdn_\" + item_id;\r\n\tel.setAttribute(\"id\", idStr);\r\n\tel.setAttribute(\"class\", \"button\");\r\n\tvar buttonTextNode = document.createTextNode(\"Add\");\r\n\tel.appendChild(buttonTextNode);\r\n\r\n\tcellmarkdown.appendChild(el);\r\n\r\n\t// previewPrice cell\r\n\tvar cellpreview = row.insertCell(++insertCellNum);\r\n\tcellpreview.setAttribute(\"class\", \"align-middle preview-price\");\r\n}\r\n\r\nfunction addUnsavedSideItem(item_id, name, size, base_price, category_label)\r\n{\r\n\tlet insertCellNum = 0;\r\n\r\n\tif (item_id == 0)\r\n\t{\r\n\t\treturn;\r\n\t} // do nothing\r\n\r\n\tvar tbl = document.getElementById('ctsItemsTbl');\r\n\r\n\tif ($('#temp_category').length == 0)\r\n\t{\r\n\t\tvar row = tbl.insertRow(-1);\r\n\t\trow.setAttribute(\"id\", \"temp_category\");\r\n\r\n\t\tvar cellName = row.insertCell(0);\r\n\t\tcellName.setAttribute(\"class\", \"font-weight-bold py-3\");\r\n\t\tcellName.setAttribute(\"colspan\", \"11\");\r\n\t\tvar nameNode = document.createTextNode('Newly Added Items');\r\n\t\tcellName.appendChild(nameNode);\r\n\t}\r\n\r\n\tvar row = tbl.insertRow(-1);\r\n\trow.setAttribute(\"id\", \"row_\" + item_id);\r\n\r\n\t// visibility cell\r\n\tvar cellLeft = row.insertCell(insertCellNum++);\r\n\r\n\tvar visBox = document.createElement(\"input\");\r\n\r\n\tvisBox.setAttribute(\"type\", \"checkbox\");\r\n\tvar idStr = \"vis_\" + item_id;\r\n\tvisBox.setAttribute(\"id\", idStr);\r\n\tvisBox.setAttribute(\"name\", idStr);\r\n\tvisBox.setAttribute(\"class\", \"align-middle\");\r\n\tvisBox.setAttribute(\"data-orgval\", \"CHECKED\");\r\n\tvisBox.setAttribute(\"data-menu_item_id\", item_id);\r\n\tvisBox.setAttribute(\"checked\", \"checked\");\r\n\tcellLeft.appendChild(visBox);\r\n\r\n\t// picksheet cell\r\n\tvar cellLeft2 = row.insertCell(insertCellNum++);\r\n\r\n\tvar pickBox = document.createElement(\"input\");\r\n\r\n\tpickBox.setAttribute(\"type\", \"checkbox\");\r\n\tvar idStr = \"form_\" + item_id;\r\n\tpickBox.setAttribute(\"id\", idStr);\r\n\tpickBox.setAttribute(\"name\", idStr);\r\n\tpickBox.setAttribute(\"class\", \"align-middle\");\r\n\tpickBox.setAttribute(\"data-orgval\", \"\");\r\n\tpickBox.setAttribute(\"step\", \"any\");\r\n\r\n\tcellLeft2.appendChild(pickBox);\r\n\r\n\t// hide everywhere cell\r\n\tvar cellLeft3 = row.insertCell(insertCellNum++);\r\n\r\n\tvar pickBox = document.createElement(\"input\");\r\n\r\n\tpickBox.setAttribute(\"type\", \"checkbox\");\r\n\tvar idStr = \"hid_\" + item_id;\r\n\tpickBox.setAttribute(\"id\", idStr);\r\n\tpickBox.setAttribute(\"name\", idStr);\r\n\tpickBox.setAttribute(\"class\", \"align-middle\");\r\n\tpickBox.setAttribute(\"data-orgval\", \"\");\r\n\tpickBox.setAttribute(\"step\", \"any\");\r\n\r\n\tcellLeft3.appendChild(pickBox);\r\n\r\n\t// name cell\r\n\tvar cellName = row.insertCell(insertCellNum++);\r\n\tcellName.setAttribute(\"class\", \"align-middle text-left\");\r\n\tvar nameNode = document.createTextNode(name);\r\n\tcellName.appendChild(nameNode);\r\n\r\n\t// size cell\r\n\tvar cellSize = row.insertCell(insertCellNum++);\r\n\tcellSize.setAttribute(\"class\", \"align-middle\");\r\n\tvar el = document.createTextNode(size);\r\n\tcellSize.appendChild(el);\r\n\r\n\t// basePrice cell\r\n\tvar cellbase = row.insertCell(insertCellNum++);\r\n\tcellbase.setAttribute(\"class\", \"align-middle\");\r\n\tvar el = document.createTextNode(formatAsMoney(base_price));\r\n\tcellbase.appendChild(el);\r\n\r\n\tvar markup_price = getMarkUpPrice(size, base_price);\r\n\r\n\t// currentPrice cell\r\n\tvar cellcurrent = row.insertCell(insertCellNum++);\r\n\tcellcurrent.setAttribute(\"class\", \"align-middle\");\r\n\tvar el = document.createTextNode(markup_price);\r\n\tcellcurrent.appendChild(el);\r\n\r\n\t// markupPrice cell\r\n\tvar cellmarkup = row.insertCell(insertCellNum++);\r\n\tcellmarkup.setAttribute(\"class\", \"align-middle markup-price\");\r\n\tvar el = document.createTextNode(markup_price);\r\n\tcellmarkup.appendChild(el);\r\n\r\n\t// overridePrice cell\r\n\tvar celloverride = row.insertCell(insertCellNum++);\r\n\tvar el = document.createElement('input');\r\n\tel.setAttribute(\"type\", \"number\");\r\n\tel.setAttribute(\"size\", \"3\");\r\n\tel.setAttribute(\"step\", \"any\");\r\n\r\n\tel.setAttribute(\"class\", \"form-control form-control-sm no-spin-button\");\r\n\r\n\tel.setAttribute(\"maxlength\", \"6\");\r\n\tel.setAttribute(\"data-orgval\", \"\");\r\n\r\n\tvar idStr = \"ovr_\" + item_id;\r\n\tel.setAttribute(\"id\", idStr);\r\n\tel.setAttribute(\"name\", idStr);\r\n\tcelloverride.appendChild(el);\r\n\r\n\t// previewPrice cell\r\n\tvar cellpreview = row.insertCell(insertCellNum++);\r\n\tcellpreview.setAttribute(\"class\", \"align-middle preview-price\");\r\n\tvar el = document.createTextNode('');\r\n\tcellpreview.appendChild(el);\r\n\r\n\t// remianingInventory cell\r\n\tvar cellremaining = row.insertCell(insertCellNum++);\r\n\tcellremaining.setAttribute(\"class\", \"align-middle remaining-price\");\r\n\tvar el = document.createTextNode('0');\r\n\tcellremaining.appendChild(el);\r\n}\r\n\r\nfunction giveTabFocus()\r\n{\r\n\tconst params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\tget: (searchParams, prop) => searchParams.get(prop)\r\n\t});\r\n\tlet value = params.tabs; // \"some_value\"\r\n\tif (typeof value != 'undefined' && value != null)\r\n\t{\r\n\t\tvalue = value.substring(value.indexOf('menu.') + 5);\r\n\t\t$(document).find(\"[data-nav='\" + value + \"']\").click();\r\n\t}\r\n\r\n}\r\n\r\nfunction initNavTab()\r\n{\r\n\r\n\tvar oldUrl = $('#inv-nav-button').attr(\"href\"); // Get current url\r\n\tvar newUrl = oldUrl.substring(0, oldUrl.indexOf('&tabs'));\r\n\tconst params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\tget: (searchParams, prop) => searchParams.get(prop)\r\n\t});\r\n\r\n\tif (typeof params.tabs != 'undefined' && params.tabs != null)\r\n\t{\r\n\t\tnewUrl = newUrl + '&tabs=' + params.tabs;\r\n\t\t$('#inv-nav-button').attr(\"href\", newUrl);\r\n\t}\r\n\r\n\t$('.nav-tab').each(function () {\r\n\t\t$(this).on('click', function () {\r\n\t\t\tvar oldUrl = $('#inv-nav-button').attr(\"href\"); // Get current url\r\n\t\t\tvar newUrl = oldUrl.substring(0, oldUrl.indexOf('&tabs'));\r\n\t\t\tnewUrl = newUrl + '&tabs=menu.' + $(this).data('nav');\r\n\t\t\t$('#inv-nav-button').attr(\"href\", newUrl);\r\n\t\t});\r\n\t});\r\n}\r\n\r\n$(function () {\r\n\r\n\t$(document).ready(function () {\r\n\t\tcalculatePage()\r\n\t\tgiveTabFocus();\r\n\t\tinitNavTab();\r\n\t});\r\n\r\n\t$(document).on('change keyup', '#markup_6_serving, #markup_4_serving, #markup_3_serving, #markup_2_serving, #markup_sides, #assembly_fee, #delivery_assembly_fee, #volume_reward, [name=\"is_default_markup\"], [id^=pic_], [id^=form_], [id^=ovr_], [id^=vis_], [id^=hid_]', function (e) {\r\n\t\tcalculatePage();\r\n\t});\r\n\r\n\t$(document).on('change keyup', '[id^=vis_]', function (e) {\r\n\r\n\t\tlet menu_item_id = $(this).data('menu_item_id');\r\n\t\tlet checkedState = $(this).is(':checked');\r\n\r\n\t\t// Sides & Sweets\r\n\t\tif (menuInfo.mid[menu_item_id].is_chef_touched == '1')\r\n\t\t{\r\n\t\t\tif (checkedState && numberOfCustomerFacingCTSItems > 20)\r\n\t\t\t{\r\n\t\t\t\t$(this).prop({'checked': false});\r\n\r\n\t\t\t\tbootbox.alert('You can only display 20 Sides &amp; Sweets items on the customer facing menu.');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#hid_' + menu_item_id).prop({'checked': false});\r\n\t\t\t}\r\n\t\t}\r\n\t\t// EFL\r\n\t\telse if (menuInfo.mid[menu_item_id].is_store_special == '1')\r\n\t\t{\r\n\t\t\tif (!checkedState && numberOfCustomerFacingEFLItems > 10)\r\n\t\t\t{\r\n\t\t\t\t$(this).prop({'checked': true});\r\n\r\n\t\t\t\tbootbox.alert(\"You can only make 10 Fast Lane items visible at a time. Please hide another store special if you wish to make this item visible.\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$(document).on('change keyup', '[id^=form_]', function (e) {\r\n\r\n\t\tlet menu_item_id = $(this).data('menu_item_id');\r\n\r\n\t\t$('#hid_' + menu_item_id).prop({'checked': false});\r\n\r\n\t});\r\n\r\n\t$(document).on('change keyup', '[id^=hid_]', function (e) {\r\n\r\n\t\tlet menu_item_id = $(this).data('menu_item_id');\r\n\r\n\t\t$('#vis_' + menu_item_id).prop({'checked': false});\r\n\t\t$('#form_' + menu_item_id).prop({'checked': false});\r\n\r\n\t});\r\n\r\n\t$(document).on('keyup change', '#filter', function (e) {\r\n\t\t$.uiTableFilter($('#recipe_list'), this.value);\r\n\t});\r\n\r\n\t$(document).on('click', '#clear_filter', function (e) {\r\n\r\n\t\t$('#filter').val('').change();\r\n\r\n\t\tif (!Modernizr.input.placeholder)\r\n\t\t{\r\n\t\t\t// trick to restore placeholder on IE\r\n\t\t\t$('#filter').focus().blur();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// handle markdowns\r\n\t$(document).on('click', '[id^=mkdn_]', function (e) {\r\n\r\n\t\ttempArr = this.id.split(\"_\");\r\n\t\tlet itemID = tempArr[1];\r\n\r\n\t\tlet markdownVal = $(this).data('markdown_value');\r\n\t\tlet markdownID = $(this).data('markdown_id');\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Edit Markdown',\r\n\t\t\tdiv_id: \"edit_mkdn\",\r\n\t\t\tmessage: $(\"#markdown_editor\").html(),\r\n\t\t\theight: 350,\r\n\t\t\twidth: 400,\r\n\t\t\tresizable: true,\r\n\t\t\tnoOk: true,\r\n\t\t\topen: function () {\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_amount\").val(markdownVal);\r\n\r\n\t\t\t\tlet start_price = getPreviewItemPrice(itemID);\r\n\r\n\t\t\t\tlet price = start_price;\r\n\t\t\t\tprice -= (price * (markdownVal / 100));\r\n\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_price\").val(formatAsMoney(price));\r\n\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_amount\").on('keyup', function (e) {\r\n\t\t\t\t\tprice = start_price;\r\n\r\n\t\t\t\t\tnewDiscount = $(this).val();\r\n\r\n\t\t\t\t\tif (newDiscount < 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewDiscount = 0;\r\n\t\t\t\t\t\t$(this).val(newDiscount);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (newDiscount > 20)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewDiscount = 20;\r\n\t\t\t\t\t\t$(this).val(newDiscount);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprice -= (price * (newDiscount / 100));\r\n\t\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_price\").val(formatAsMoney(price));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_price\").on('keyup', function (e) {\r\n\r\n\t\t\t\t\tlet targetPrice = $(this).val();\r\n\t\t\t\t\tlet newPercentage = ((start_price - targetPrice) / start_price) * 100;\r\n\r\n\t\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(newPercentage));\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#current_price\").html(\"$\" + formatAsMoney(menuInfo.mid[itemID].price));\r\n\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#base_price\").html(\"$\" + formatAsMoney(menuInfo.mid[itemID].base_price));\r\n\r\n\t\t\t\t$(\"#edit_mkdn\").find(\"#item_title\").html(menuInfo.mid[itemID].menu_item_name);\r\n\r\n\t\t\t},\r\n\t\t\tbuttons: {\r\n\t\t\t\tAccept: function () {\r\n\r\n\t\t\t\t\tlet start_price = getPreviewItemPrice(itemID);\r\n\r\n\t\t\t\t\tlet newPercentage = $(\"#edit_mkdn\").find(\"#markdown_amount\").val();\r\n\t\t\t\t\tif (newPercentage > 20)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewPercentage = 20;\r\n\t\t\t\t\t\tprice = (start_price * (newPercentage / 100));\r\n\t\t\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(newPercentage));\r\n\t\t\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_price\").val(formatAsMoney(start_price - price));\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: \"The percentage of discount is limited to 20%. The amounts have been adjusted. Please review and re-submit.\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (newPercentage < 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewPercentage = 0;\r\n\t\t\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(newPercentage));\r\n\t\t\t\t\t\t$(\"#edit_mkdn\").find(\"#markdown_price\").val(formatAsMoney(start_price));\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: \"The percentage of discount cannot be negative. The amounts have been adjusted. Please review and re-submit.\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$('#mkdn_' + itemID).html(formatAsMoney(newPercentage) + \"%\");\r\n\t\t\t\t\t$('#mkdn_' + itemID).data('markdown_value', newPercentage);\r\n\t\t\t\t\tcalculatePage();\r\n\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function () {\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\t// handle_add_new_markdown\r\n\t$(document).on('click', '[id^=add-mkdn_]', function (e) {\r\n\r\n\t\ttempArr = this.id.split(\"_\");\r\n\t\tlet itemID = tempArr[1];\r\n\r\n\t\tlet markdownVal = $(this).data('markdown_value');\r\n\t\tlet markdownID = $(this).data('markdown_id');\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Add Markdown',\r\n\t\t\tdiv_id: \"new_mkdn\",\r\n\t\t\tmessage: $(\"#markdown_editor\").html(),\r\n\t\t\theight: 350,\r\n\t\t\twidth: 400,\r\n\t\t\tresizable: true,\r\n\t\t\tnoOk: true,\r\n\t\t\topen: function () {\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_amount\").val(markdownVal);\r\n\r\n\t\t\t\tlet start_price = getPreviewItemPrice(itemID);\r\n\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_price\").val(formatAsMoney(start_price));\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(0));\r\n\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_amount\").on('keyup', function (e) {\r\n\t\t\t\t\tprice = start_price;\r\n\t\t\t\t\tnewDiscount = $(this).val();\r\n\r\n\t\t\t\t\tif (newDiscount < 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewDiscount = 0;\r\n\t\t\t\t\t\t$(this).val(newDiscount);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (newDiscount > 20)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewDiscount = 20;\r\n\t\t\t\t\t\t$(this).val(newDiscount);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tprice -= (price * (newDiscount / 100));\r\n\t\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_price\").val(formatAsMoney(price));\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_price\").on('keyup', function (e) {\r\n\r\n\t\t\t\t\tlet targetPrice = $(this).val();\r\n\t\t\t\t\tlet newPercentage = ((start_price - targetPrice) / start_price) * 100;\r\n\r\n\t\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(newPercentage));\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#current_price\").html(\"$\" + formatAsMoney(menuInfo.mid[itemID].price));\r\n\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#base_price\").html(\"$\" + formatAsMoney(menuInfo.mid[itemID].base_price));\r\n\r\n\t\t\t\t$(\"#new_mkdn\").find(\"#item_title\").html(menuInfo.mid[itemID].menu_item_name);\r\n\r\n\t\t\t},\r\n\t\t\tbuttons: {\r\n\t\t\t\tAccept: function () {\r\n\t\t\t\t\tlet start_price = getPreviewItemPrice(itemID);\r\n\r\n\t\t\t\t\tlet newPercentage = $(\"#new_mkdn\").find(\"#markdown_amount\").val();\r\n\t\t\t\t\tif (newPercentage > 20)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewPercentage = 20;\r\n\t\t\t\t\t\tprice = (start_price * (newPercentage / 100));\r\n\t\t\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(newPercentage));\r\n\t\t\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_price\").val(formatAsMoney(start_price - price));\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: \"The percentage of discount is limited to 20%. The amounts have been adjusted. Please review and re-submit.\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (newPercentage < 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tnewPercentage = 0;\r\n\t\t\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_amount\").val(formatAsMoney(newPercentage));\r\n\t\t\t\t\t\t$(\"#new_mkdn\").find(\"#markdown_price\").val(formatAsMoney(start_price));\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: \"The percentage of discount cannot be negative. The amounts have been adjusted. Please review and re-submit.\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet new_button = '<button class=\"button\" id=\"mkdn_' + itemID + '\" data-org_val=\"0\" data-markdown_id=\"new\" data-markdown_value=\"' + newDiscount + '\" >' + formatAsMoney(newDiscount) + '%</button>';\r\n\t\t\t\t\t$('#add-mkdn_' + itemID).replaceWith(new_button);\r\n\t\t\t\t\tcalculatePage();\r\n\r\n\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function () {\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\t$(document).on('click', '#add_past_menu_item:not(.disabled)', function (e) {\r\n\r\n\t\tdisplayModalWaitDialog('wait_for_adding_item_div', \"Retrieving items. Please wait ...\");\r\n\r\n\t\tshowPopup({\r\n\t\t\tmodal: true,\r\n\t\t\ttitle: 'Add EFL Item',\r\n\t\t\tnoOk: true,\r\n\t\t\tcloseOnEscape: false,\r\n\t\t\theight: 720,\r\n\t\t\tdiv_id: 'add_menu_item_popup_div',\r\n\t\t\tmodule: 'page=admin_menu_editor_add_item&menu_id=' + menuInfo.menu_id,\r\n\t\t\topen: function (event, ui) {\r\n\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t$(\"#wait_for_adding_item_div\").remove();\r\n\t\t\t},\r\n\t\t\tbuttons: {\r\n\t\t\t\tCancel: function () {\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t},\r\n\t\t\t\tOkay: function () {\r\n\r\n\t\t\t\t\tlet entreeList = {};\r\n\r\n\t\t\t\t\t$('#sel_list').find('[data-rmv_menu_item]').each(function () {\r\n\r\n\t\t\t\t\t\tlet thisEntree = $(this).data('entree_id');\r\n\t\t\t\t\t\tentreeList[thisEntree] = thisEntree;\r\n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: '',\r\n\t\t\t\t\t\tmessage: 'This will immediately add the listed items to the menu. Are you sure?',\r\n\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\theight: 180,\r\n\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t'Add Items to Menu': function () {\r\n\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\t\t\t\t\t\top: 'add_menu_item',\r\n\t\t\t\t\t\t\t\t\t\tmenu_id: menuInfo.menu_id,\r\n\t\t\t\t\t\t\t\t\t\tentree_ids: entreeList\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tfor (let entree_id in json.results)\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet count = json.results[entree_id]['count'];\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet items = json.results[entree_id]['items'];\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet handledCount = 1;\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (let id in items)\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// update json array with latest data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmenuInfo = json.menuInfo;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taddUnsavedEFLItem(items[id].item_id, items[id].name, items[id].size, items[id].base_price, handledCount, count);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\thandledCount++;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tcalculatePage();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (handledCount > 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#empty_menu_message\").remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t$('#add_menu_item_popup_div').remove();\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t'Cancel': function () {\r\n\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tclose: function () {\r\n\t\t\t\tbounce('main.php?page=admin_menu_editor&tabs=menu.efl');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t$(document).on('click', '[data-add_menu_item]', function (e) {\r\n\t\t// prevent multiple submissions\r\n\t\tif ($(this).hasClass('disabled'))\r\n\t\t{\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).addClass('disabled');\r\n\r\n\t\t\tlet entree_id = $(this).data('entree_id');\r\n\t\t\tlet recipe_id = $(this).data('recipe_id');\r\n\r\n\t\t\tlet tr = $('[data-recipe_id_row=\"' + recipe_id + '\"]').clone();\r\n\r\n\t\t\ttr.find(\"[data-rmv_menu_item=\" + entree_id + \"]\").show();\r\n\t\t\ttr.find(\"[data-add_menu_item=\" + entree_id + \"]\").remove();\r\n\r\n\t\t\t$(\"#selected_items tbody\").append(tr);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$(document).on('click', '[data-rmv_menu_item]', function (e) {\r\n\r\n\t\tlet entree_id = $(this).data('entree_id');\r\n\t\tlet recipe_id = $(this).data('recipe_id');\r\n\r\n\t\t$('#selected_items tbody [data-recipe_id_row=\"' + recipe_id + '\"]').remove();\r\n\t\tlet org_tr = $('#recipe_list tbody [data-recipe_id_row=\"' + recipe_id + '\"]');\r\n\t\torg_tr.find('[data-add_menu_item=\"' + entree_id + '\"]').removeClass('disabled');\r\n\r\n\t});\r\n\r\n\t$(document).on('click', '[data-info_menu_item]', function (e) {\r\n\r\n\t\tlet entree_id = $(this).data('entree_id');\r\n\t\tlet recipe_id = $(this).data('recipe_id');\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\top: 'menu_item_info',\r\n\t\t\t\tmenu_id: menuInfo.menu_id,\r\n\t\t\t\tentree_id: entree_id,\r\n\t\t\t\trecipe_id: recipe_id\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\ttitle: 'Item Information',\r\n\t\t\t\t\theight: 720,\r\n\t\t\t\t\twidth: 720,\r\n\t\t\t\t\tmessage: json.data,\r\n\t\t\t\t\topen: function () {\r\n\t\t\t\t\t\thandle_tabbed_content();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t});\r\n\r\n\t//////---------Add past Sides & Sweets\r\n\r\n\t$(document).on('click', '#add_past_menu_item_sides', function (e) {\r\n\r\n\t\tdisplayModalWaitDialog('wait_for_adding_item_div', \"Retrieving Sides & Sweets. Please wait ...\");\r\n\r\n\t\tshowPopup({\r\n\t\t\tmodal: true,\r\n\t\t\ttitle: 'Add Sides & Sweets',\r\n\t\t\tnoOk: true,\r\n\t\t\tcloseOnEscape: false,\r\n\t\t\theight: 720,\r\n\t\t\tdiv_id: 'add_menu_item_popup_div',\r\n\t\t\tmodule: 'page=admin_menu_editor_add_sides_sweets&menu_id=' + menuInfo.menu_id,\r\n\t\t\topen: function (event, ui) {\r\n\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t$(\"#wait_for_adding_item_div\").remove();\r\n\t\t\t},\r\n\t\t\tbuttons: {\r\n\t\t\t\tCancel: function () {\r\n\t\t\t\t\t$(this).remove();\r\n\t\t\t\t},\r\n\t\t\t\tOkay: function () {\r\n\r\n\t\t\t\t\tlet entreeList = {};\r\n\r\n\t\t\t\t\tlet errorMissingCategory = false;\r\n\t\t\t\t\t$('#sel_list').find('[data-rmv_menu_side]').each(function () {\r\n\r\n\t\t\t\t\t\tlet thisEntree = $(this).data('entree_id');\r\n\t\t\t\t\t\tentreeList[thisEntree] = thisEntree;\r\n\t\t\t\t\t\tlet categoryLabel = $(\"[data-recipe_category=\" + thisEntree + \"]:visible\").find(\":selected\").val();\r\n\t\t\t\t\t\tif (typeof categoryLabel == 'undefined'){\r\n\t\t\t\t\t\t\tcategoryLabel = $(\"[data-recipe_category=\" + thisEntree + \"]:visible\").html();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (typeof categoryLabel == 'undefined')\r\n\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t$(\"[data-recipe_category=\" + thisEntree + \"]\").css(\"border-color\", \"red\");\r\n\t\t\t\t\t\t\terrorMissingCategory = true;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tentreeList[thisEntree] = categoryLabel;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (errorMissingCategory)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconsole.log('Missing');\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Please select a category for all items',\r\n\t\t\t\t\t\t\tmessage: 'Please select a category for all items'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: '',\r\n\t\t\t\t\t\t\tmessage: 'This will immediately add the listed Sides & Sweets to the menu. Are you sure?',\r\n\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\theight: 180,\r\n\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t'Add Sides & Sweets to Menu': function () {\r\n\r\n\t\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\t\t\t\t\t\t\top: 'add_menu_side',\r\n\t\t\t\t\t\t\t\t\t\t\tmenu_id: menuInfo.menu_id,\r\n\t\t\t\t\t\t\t\t\t\t\tentree_ids: entreeList\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet handledCount = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (let entree_id in json.results)\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet count = json.results[entree_id]['count'];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet items = json.results[entree_id]['items'];\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet handledCount = 1;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor (let id in items)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// update json array with latest data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmenuInfo = json.menuInfo;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taddUnsavedSideItem(items[id].item_id, items[id].name, items[id].size, items[id].base_price, items[id].subcategory_label);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thandledCount++;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tcalculatePage();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (handledCount > 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#empty_menu_message\").remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$([\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdocument.documentElement,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdocument.body\r\n\t\t\t\t\t\t\t\t\t\t\t\t]).animate({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tscrollTop: $(\"#temp_category\").offset().top\r\n\t\t\t\t\t\t\t\t\t\t\t\t}, 2000);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error adding Sides & Sweets',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Network Error adding Sides and Sweets',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t$('#add_menu_item_popup_div').remove();\r\n\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t'Cancel': function () {\r\n\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tclose: function () {\r\n\t\t\t\tbounce('main.php?page=admin_menu_editor&tabs=menu.efl');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t$(document).on('change', '[data-recipe_category]', function (e) {\r\n\t\tlet categoryLabel = $(this).find(\":selected\").val();\r\n\r\n\t\tif (typeof categoryLabel == 'undefined')\r\n\t\t{\r\n\t\t\t$(this).css(\"border-color\", \"red\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).css(\"border-color\", \"black\");\r\n\t\t}\r\n\t});\r\n\r\n\t$(document).on('click', '[data-add_menu_side]', function (e) {\r\n\t\t// prevent multiple submissions\r\n\t\tif ($(this).hasClass('disabled'))\r\n\t\t{\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).addClass('disabled');\r\n\r\n\t\t\tlet entree_id = $(this).data('entree_id');\r\n\t\t\tlet recipe_id = $(this).data('recipe_id');\r\n\r\n\t\t\tlet tr = $('[data-recipe_id_row=\"' + recipe_id + '\"]').clone();\r\n\r\n\t\t\ttr.find(\"[data-rmv_menu_side=\" + entree_id + \"]\").show();\r\n\t\t\ttr.find(\"[data-add_menu_side=\" + entree_id + \"]\").remove();\r\n\r\n\t\t\ttr.find(\"[data-recipe_category=\" + entree_id + \"]\").show();\r\n\r\n\t\t\tlet oldCategory = tr.find(\"[data-old_category=\" + entree_id + \"]\").html();\r\n\r\n\t\t\ttr.find(\"[data-old_category=\" + entree_id + \"]\").remove();\r\n\r\n\t\t\t$(\"#selected_items tbody\").append(tr);\r\n\r\n\t\t\t$(\"[data-recipe_category=\" + entree_id + \"]\").val(oldCategory);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$(document).on('click', '[data-rmv_menu_side]', function (e) {\r\n\r\n\t\tlet entree_id = $(this).data('entree_id');\r\n\t\tlet recipe_id = $(this).data('recipe_id');\r\n\r\n\t\t$('#selected_items tbody [data-recipe_id_row=\"' + recipe_id + '\"]').remove();\r\n\t\tlet org_tr = $('#recipe_list tbody [data-recipe_id_row=\"' + recipe_id + '\"]');\r\n\t\torg_tr.find('[data-add_menu_side=\"' + entree_id + '\"]').removeClass('disabled');\r\n\r\n\t});\r\n\r\n\t$(document).on('click', '[data-info_menu_side]', function (e) {\r\n\r\n\t\tlet entree_id = $(this).data('entree_id');\r\n\t\tlet recipe_id = $(this).data('recipe_id');\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\top: 'menu_item_info',\r\n\t\t\t\tmenu_id: menuInfo.menu_id,\r\n\t\t\t\tentree_id: entree_id,\r\n\t\t\t\trecipe_id: recipe_id\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\ttitle: 'Item Information',\r\n\t\t\t\t\theight: 720,\r\n\t\t\t\t\twidth: 720,\r\n\t\t\t\t\tmessage: json.data,\r\n\t\t\t\t\topen: function () {\r\n\t\t\t\t\t\thandle_tabbed_content();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t});\r\n});"],"names":["let","numberOfCustomerFacingCTSItems","numberOfCustomerFacingEFLItems","sidesDataArray","gNumOptionalsAdded","notShown","dp_processing","xmlHttp","noOverrideUnderBase","resetPage","document","getElementById","value","submit","getPreviewItemPrice","itemID","ovrPrice","Number","$","val","isNaN","valueOf","text","removeOptionSelected","elSel","i","length","options","selected","remove","removeItem","itemNum","rowID","rowObj","parentNode","removeChild","sidesData","sideName","selObj","Option","calculatePage","displayValidationErrorMsg","msg","dd_message","title","message","clearErrors","statusDiv","style","display","statusTextDiv","innerHTML","storeChange","obj","menuChange","confirm_and_round_form","tab","finalizeMessage","hasOverridePrice","each","this","trim","modal","confirm","round_markup_to_override","cancel","dirty","index","is","o_input","parent","find","price","parseFloat","o_price","Math","ceil","toFixed","showFlex","selectedDefault","bootbox","alert","getXmlHttpObject","objXMLHttp","XMLHttpRequest","e","ActiveXObject","def_price_save_handleTimeout","printString","def_price_retreive_handleTimeout","SaveDefPricingComplete","readyState","RetrieveDefPricingComplete","responseText","pricingArray","split","RidMap","key","item","totalCurrentlyWebVisible","ctsItemRows","rows","id","indexOf","itemNumber","substr","rid","overrideElemName","overrideElem","showCustomerBox","is_web_visible","checked","hideEverywhereBox","SavePricing","payLoad","currentPrice","menuInfo","mid","previewPrice","basePrice","base_price","show_to_customer","hide_completely","url","storeInfo","onreadystatechange","open","setRequestHeader","send","setTimeout","RetrievePricing","uniqueEFLEntreeId","is_unsaved","sidesCount","current2ServMarkup","current3ServMarkup","current4ServMarkup","current6ServMarkup","currentSidesMarkup","currentAssemblyFee","currentDeliveryAssemblyFee","currentDefaultStatus","formatAsMoney","markupData","delivery_assembly_fee","assembly_fee","markup_value_2_serving","markup_value_3_serving","markup_value_4_serving","markup_value_6_serving","markup_value_sides","menu_id","is_default","itemRows","getAttribute","ltd_menu_item_value","supports_ltd_roundup","is_chef_touched","overridePrice","orgOverridePrice","markupPrice","html","pricing_type","round","ORdelta","MUdelta","newPriceByMarkUp","isEnabled_Markup","visFlag","orgState","EFL_itemRows","entreeId","data","includes","push","x","markdown_change","markdown","markdown_value","original_markdown","markedDownPrice","discount","abs","picFlag","hidFlag","formFlag","hideFlex","confirm_and_check_form","form","validated","_check_form","warnOffOfEmptyMarkups","currentVolumeReward","encounteredBasePriceIssue","problemItemList","menu_item_name","markdownObj","markDownPostObj","el","createElement","setAttribute","idStr","appendChild","getMarkUpPrice","servingsSize","addUnsavedEFLItem","item_id","name","size","thisItemCount","countItemsInRecipe","insertCellNum","tbl","row","insertRow","cellLeft","insertCell","visBox","cellLeft2","pickBox","cellName","nameNode","createTextNode","cellSize","cellbase","markup_price","cellcurrent","cellmarkup","celloverride","cellmarkdown","buttonTextNode","cellpreview","addUnsavedSideItem","category_label","cellLeft3","cellremaining","giveTabFocus","params","Proxy","URLSearchParams","window","location","search","get","searchParams","prop","tabs","substring","click","initNavTab","oldUrl","attr","newUrl","on","ready","menu_item_id","checkedState","is_store_special","uiTableFilter","change","Modernizr","input","placeholder","focus","blur","tempArr","markdownVal","markdownID","div_id","height","width","resizable","noOk","start_price","newDiscount","targetPrice","newPercentage","buttons","Accept","Cancel","new_button","replaceWith","displayModalWaitDialog","showPopup","closeOnEscape","module","event","ui","hide","Okay","entreeList","thisEntree","Add Items to Menu","ajax","type","timeout","dataType","processor","store_id","STORE_DETAILS","op","entree_ids","success","json","processor_success","entree_id","results","count","items","handledCount","processor_message","error","objAJAXRequest","strError","response","close","bounce","hasClass","addClass","recipe_id","tr","clone","show","append","org_tr","removeClass","handle_tabbed_content","errorMissingCategory","categoryLabel","css","console","log","Add Sides & Sweets to Menu","subcategory_label","documentElement","body","animate","scrollTop","offset","top","oldCategory"],"mappings":"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"}
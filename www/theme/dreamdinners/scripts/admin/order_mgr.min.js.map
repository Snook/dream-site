{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_mgr.js"],"sourcesContent":["var itemChanges = false;\nvar feeChanges = false;\nvar discountOrPaymentChanges = false;\nvar deliveryChanges = false;\nvar discountChanges = false;\nvar reportingChanges = false;\nvar paymentChanges = false;\nvar initialSessionDiscountSetting = \"noSD\";\nvar initialPreferredUserDiscountSetting = \"noUP\";\nvar changeList = null;\nvar isFactoringCredit = false;\nvar currentCreditAvailable = 0;\nvar stationNeedsAttention = false;\nvar relatedOrdersAreLoaded = false;\nvar currentlySavingOrder = false;\nvar onTimeShotAtSupplyingZeroPaymentHasOccurred = false;\nvar needPlatePointsMaxDiscountChangeWarning = false;\nvar needRefferalRewardMaxDiscountChangeWarning = false;\nvar lastMaxPPDiscountAmount = -1;\nvar lastMaxReferralRewardDiscountAmount = -1;\nlet feesTabIsDirty = false;\n\nfunction admin_order_mgr_init()\n{\n\n\tif (store_id != STORE_DETAILS.id)\n\t{\n\t\tSTORE_DETAILS.id = store_id;\n\n\t\t//STORE_DETAILS.id is either the current fadmin store - in which case a match is guaranteed or\n\t\t// is the current Site Admin store (last selection from a store drop down.) However in this case if the order was accessed by the address\n\t\t// bar a match is not guaranteed so force STORE_DETAILS.id to store_id which is always the store of the order\n\t}\n\n\tif (orderState == 'NEW')\n\t{\n\t\tsetupForNewOrder();\n\t}\n\telse if (orderState == 'SAVED')\n\t{\n\t\tsetupForSavedOrder();\n\t}\n\telse\n\t{\n\t\tsetupForActiveOrder();\n\t}\n\n\tif (hasBundle)\n\t{\n\t\tbundleSetup();\n\t}\n\n\tsetupSiteAdminFunctions();\n\n\tinitChangeList();\n\n\tif (orderState != 'NEW')\n\t{\n\t\tcalculateTotal();\n\n\t\tsetAllPaymentFieldsToUnrequired();\n\n\t\tsetupCouponState();\n\t}\n\n\tsetUpKeyHandlers();\n\n\tif (getQueryVariable(\"session_full\") == \"true\")\n\t{\n\t\tvar query = window.location.search.substring(1);\n\t\tvar vars = query.split(\"&\");\n\t\tvar newQueryString = \"main.php?\";\n\n\t\tvar first = true;\n\t\tfor (var i = 0; i < vars.length; i++)\n\t\t{\n\n\t\t\tvar pair = vars[i].split(\"=\");\n\t\t\tif (pair[0] != 'session_full')\n\t\t\t{\n\t\t\t\tif (!first)\n\t\t\t\t{\n\t\t\t\t\tnewQueryString += \"&\";\n\t\t\t\t}\n\n\t\t\t\tnewQueryString += vars[i];\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\thistoryPush({url: newQueryString});\n\t}\n\n\thandle_special_instruction_notes();\n\thandle_cancel_order();\n\thandle_delete_saved_order();\n\n\thandle_free_menu_item_edit();\n\thandle_fundraiser_selection();\n\thandle_ltd_round_up();\n\thandleDirectOrderDiscountFocusing();\n\n\t$('#shipping_phone_number').trigger('change');\n\n\thandleAutoOrderButtons();\n\n\t$('#selectedBundle').trigger('change');\n\n\tinitNoInventoryRows();\n\n\thandleDinnerDollarAccordion();\n\thandleAdminNoteAccordion();\n\n\tsetMealCustomizationDefault();\n\n}\nfunction setMealCustomizationDefault()\n{\n\tif( $('#opted_to_customize_recipes').length && default_meal_customization_to_selected == true && $('#opted_to_customize_recipes').prop('checked'))\n\t{\n\t\t$('#opted_to_customize_recipes').click();\n\t}\n}\n\nfunction handleDinnerDollarAccordion()\n{\n\t$(\".dd_accordion_header\").click(function () {\n\n\t\t$header = $(this);\n\t\t$content = $(\".dd_accordion_content\");\n\t\t$header.html(function () {\n\t\t\treturn ($content.is(\":visible\") ? \"Show \" : \"Hide \") + \"Recent Dinner Dollar History\" + ($content.is(\":visible\") ? \" &#8744;\" : \" &#8743;\");\n\t\t});\n\t\t$content.slideToggle(500, function () {\n\t\t});\n\n\t});\n}\n\nfunction handleAdminNoteAccordion()\n{\n\t$(\".dod_accordion_header\").click(function () {\n\n\t\t$header = $(this);\n\t\t$content = $(\".dod_accordion_content\");\n\t\t$header.html(function () {\n\t\t\treturn ($content.is(\":visible\") ? \"Show \" : \"Hide \") + \"Admin Order Notes\" + ($content.is(\":visible\") ? \" &#8744;\" : \" &#8743;\");\n\t\t});\n\t\t$content.slideToggle(500, function () {\n\t\t});\n\n\t});\n}\n\nfunction initNoInventoryRows()\n{\n\t$('.inventory-row').each(function () {\n\t\tlet remaining = $(this).data('orig-remaining');\n\t\tlet servings = $(this).data('servings');\n\t\tlet entree_id = $(this).data('entree');\n\t\tif (remaining < servings)\n\t\t{\n\n\t\t\t$itemCount = $('input[name=\"qty_' + entree_id + '\"]').val();\n\t\t\tif ($itemCount == 0)\n\t\t\t{\n\t\t\t\t$(this).find(\"input,button,textarea,select,a,td\").addClass('text-muted');\n\t\t\t\t$(this).find(\"img\").hide();\n\t\t\t}\n\t\t}\n\t})\n}\n\nfunction handleAutoOrderButtons(e, size)\n{\n\n\t$(\"#selectMediumStarterPackEntrees\").on('click', function (e) {\n\n\t\tvar countMissedMeals = 0;\n\n\t\t$(\"[id^='bnd_'] input\").each(function () {\n\n\t\t\tif ($(this).data('pricing_type') == 'HALF')\n\t\t\t{\n\t\t\t\tvar id = this.id.split(\"_\")[1];\n\n\t\t\t\t$(\"#qty_\" + id).each(function () {\n\n\t\t\t\t\tvar entreeID = $(this).data('entreeid');\n\n\t\t\t\t\tvar curInventory = entreeIDToInventoryMap[entreeID].remaining;\n\n\t\t\t\t\tif (3 > curInventory)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountMissedMeals++;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).val(1);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t});\n\n\t$(\"#selectLargeStarterPackEntrees\").on('click', function (e) {\n\t\tvar countMissedMeals = 0;\n\n\t\t$(\"[id^='bnd_'] input\").each(function () {\n\n\t\t\tif ($(this).data('pricing_type') == 'FULL')\n\t\t\t{\n\t\t\t\tvar id = this.id.split(\"_\")[1];\n\n\t\t\t\t$(\"#qty_\" + id).each(function () {\n\n\t\t\t\t\tvar entreeID = $(this).data('entreeid');\n\n\t\t\t\t\tvar curInventory = entreeIDToInventoryMap[entreeID].remaining;\n\n\t\t\t\t\tif (6 > curInventory)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountMissedMeals++;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).val(1);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (countMissedMeals > 0)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: '1 or more items could not be selected due to lack of inventory.  Please review the selections and adjust to select a full 12 item order.'\n\t\t\t});\n\t\t}\n\n\t\tcalculateTotal();\n\t\tsetItemTabAsDirty();\n\n\t\te.preventDefault();\n\n\t});\n\n}\n\nvar intenseLoggingOn = true;\n\nfunction handleDirectOrderDiscountFocusing()\n{\n\n\t$(\"#plate_points_discount, #direct_order_discount\").focus(function (e) {\n\n\t\tif ($(this).val() == 0)\n\t\t{\n\t\t\t$(this).val(\"\");\n\t\t}\n\t\tif ($(this).val().length > 0)\n\t\t{\n\t\t\t$(this).select();\n\t\t}\n\t});\n\n\t$(\"#plate_points_discount, #direct_order_discount\").blur(function (e) {\n\n\t\tvar curVal = $(this).val();\n\t\tcurVal = (curVal.trim());\n\n\t\tif (curVal == \"\" || isNaN(curVal))\n\t\t{\n\t\t\t$(this).val(\"0\");\n\t\t}\n\n\t});\n\n}\n\nfunction intenseLogging(message)\n{\n\tif (window.console && intenseLoggingOn)\n\t{\n\t\tconsole.log('OM Intense logging: ' + message);\n\t}\n}\n\nfunction saveSpecialInstructions()\n{\n\n\tvar special_instructions = strip_tags($(\"#order_user_notes\").val());\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_special_instructions',\n\t\t\torder_id: order_id,\n\t\t\tspecial_instructions: special_instructions\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tupdateInstructionsOrgValues();\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveSpecialInstructions: \" + json.processor_message);\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tintenseLogging(\"saveSpecialInstructions: \" + strError + \" | \" + objAJAXRequest.responseText);\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\t});\n}\n\nfunction handle_special_instruction_notes()\n{\n\t$('[id^=\"gd_special_instruction_note_button-\"]').each(function () {\n\n\t\t$(this).on('click', function (e) {\n\n\t\t\tvar booking_id = $(this).data('booking_id');\n\t\t\tvar user_id = $(this).data('user_id');\n\t\t\tvar do_op = 'get';\n\t\t\tvar special_instructions = '';\n\n\t\t\tif ($(this).data('edit_mode') == true)\n\t\t\t{\n\t\t\t\tdo_op = 'save';\n\n\t\t\t\tspecial_instructions = strip_tags($('#gd_special_instruction_note-' + booking_id + ' > textarea').val());\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\turl: 'ddproc.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\ttimeout: 20000,\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\t\top: 'update_special_instructions',\n\t\t\t\t\t'do': do_op,\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\t\tuser_id: user_id,\n\t\t\t\t\torder_id: order_id,\n\t\t\t\t\tnote: special_instructions\n\t\t\t\t},\n\t\t\t\tsuccess: function (json) {\n\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (do_op == 'get')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar textarea_elem = $('<textarea></textarea>').addClass('form-control').val((json.special_instruction_note ? json.special_instruction_note : \"\")).on('keyup', function (e) {\n\n\t\t\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).addClass('special_instruction_note_edit').html(textarea_elem);\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', true).html('Save Note');\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).data('special_instruction_note_value', (json.special_instruction_note ? json.special_instruction_note : \"\")).on('click', function (e) {\n\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + $(this).data('booking_id')).removeClass('special_instruction_note_edit').html($(this).data('special_instruction_note_value'));\n\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + $(this).data('booking_id')).data('edit_mode', false).html('Special Instructions');\n\n\t\t\t\t\t\t\t\t$(this).hide();\n\n\t\t\t\t\t\t\t}).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).removeClass('special_instruction_note_edit').html(nl2br(json.special_instruction_note));\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).hide();\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', false).html('Special Instructions');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t\tintenseLogging(\"handle_special_instruction_notes: \" + strError + \" | \" + objAJAXRequest.responseText);\n\t\t\t\t\tresponse = 'Unexpected error';\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\n\t});\n}\n\nvar lastCheckedGiftCertNumber = null;\n\nfunction setUpKeyHandlers()\n{\n\tdocument.onkeypress = OMDefaultKeyHandler;\n\n\t$(\"#coupon_code\").on('keypress', function (evt) {\n\t\t// the enter key will submit a coupon code\n\t\tevt = (evt) ? evt : event;\n\t\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\t\tif (charCode == 13)\n\t\t{\n\t\t\tprocessCode();\n\t\t\tevt.stopPropagation();\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t});\n\n\t$(\"#order_user_notes\").on('keypress', function (evt) {\n\t\tevt.stopPropagation();\n\t\treturn true;\n\t});\n\n\t$(\"#payment1_gc_payment_number\").on('keyup', function (evt) {\n\n\t\tif ($(this).val().length == 15 && !isNaN($(this).val()) && $(this).val() != lastCheckedGiftCertNumber)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Warning',\n\t\t\t\tmessage: \"It appears that you may be entering a gift Card number. If so, select Gift Card from payment selector. This is the Certificate (Gift Certificate) payment type.\"\n\t\t\t});\n\t\t}\n\n\t\tlastCheckedGiftCertNumber = $(this).val();\n\n\t\treturn true;\n\t});\n\n}\n\nfunction OMDefaultKeyHandler(evt)\n{\n\t// by default the document just eats the enter key\n\n\tevt = (evt) ? evt : event;\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n\n}\n\nfunction initChangeList()\n{\n\t$(\"#changeListTab\").on('click', function () {\n\n\t\tlet html = getChangeListHTML();\n\n\t\tif (!html || html == \"\")\n\t\t{\n\t\t\thtml = \"<h3><i>No Changes</i></h3>\"\n\t\t}\n\n\t\tdd_message({\n\t\t\ttitle: 'Change List',\n\t\t\tmessage: html,\n\t\t\theight: 620,\n\t\t\twidth: 300,\n\t\t\tmodal: false,\n\t\t\tdiv_id: 'changelist',\n\t\t\tdialogClass: 'fixedDialog',\n\t\t\tnoOk: true,\n\t\t\tposition: {\n\t\t\t\tmy: \"left top\",\n\t\t\t\tat: \"left bottom\",\n\t\t\t\tof: this\n\t\t\t},\n\t\t\tclose: function (event, ui) {\n\t\t\t\t$(\"#changelist\").remove();\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction setupSiteAdminFunctions()\n{\n\t$(\"#in-store_status, #plate_points_status\").on('click', function () {\n\n\t\tvar flagName = this.id;\n\t\tvar checkbox = $(this);\n\t\tif (orderState != 'ACTIVE')\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: \"These flags can only be set on ACTIVE orders.\"\n\t\t\t});\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar newState = \"off\";\n\t\t\tif ($(this).is(\":checked\"))\n\t\t\t{\n\t\t\t\tnewState = \"on\";\n\t\t\t}\n\n\t\t\tvar oldState = 1;\n\t\t\tif (newState == \"on\")\n\t\t\t{\n\t\t\t\toldState = 0;\n\t\t\t}\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Status Update',\n\t\t\t\tmessage: \"Are you sure you want to update the order status?\",\n\t\t\t\tcancel: function () {\n\t\t\t\t\tcheckbox.prop('checked', oldState ? true : false)\n\n\t\t\t\t},\n\t\t\t\tconfirm: function () {\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: 'ddproc.php',\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\ttimeout: 20000,\n\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\t\t\t\tuser_id: user_id,\n\t\t\t\t\t\t\top: 'update_status_flag',\n\t\t\t\t\t\t\torder_id: order_id,\n\t\t\t\t\t\t\tflag: flagName,\n\t\t\t\t\t\t\tnew_state: newState\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsuccess: function (json) {\n\t\t\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\ttitle: 'Update Success',\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t\tintenseLogging(\"update_status_flag: \" + json.processor_message);\n\n\t\t\t\t\t\t\t\t$(this).attr(\"checked\", oldState);\n\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t\t\t\t\tintenseLogging(\"update_status_flag: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\t\t\t\t$(this).attr(\"checked\", oldState);\n\n\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\t\tmessage: response\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction updateMealCustomizationOrgValues()\n{\n\tdd_toast({\n\t\tmessage: 'Meal Customization Fee Saved',\n\t\tposition: 'topcenter'\n\t});\n\t$(\"#subtotal_meal_customization_fee\").data('org_value', $(\"#subtotal_meal_customization_fee\").val());\n\n}\nfunction updateItemsOrgValues()\n{\n\n\t$(\"[id^='qty_']\").each(function () {\n\t\t$(this).data('org_value', $(this).val());\n\t});\n\n\t$(\"[data-dd_type='item_field']\").each(function () {\n\t\t$(this).data('org_value', $(this).val());\n\t});\n\n\t$('#selectedBundle').data('org_value', $('#selectedBundle').is(':checked') ? \"1\" : \"0\");\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\t$(\"[id^='bnd_']\").each(function () {\n\t\t\t$(this).data('org_value', $(this).val());\n\t\t});\n\t}\n\telse\n\t{\n\t\t$(\"[id^='bnd_']\").each(function () {\n\t\t\t$(this).data('org_value', $(this).is(':checked') ? \"1\" : \"0\");\n\t\t});\n\t}\n\n\tupdateChangeList();\n\n}\n\nfunction saveAll()\n{\n\tsaveItems(true, false, true);\n}\n\nfunction saveItems(saveDiscountsUponCompletion, activateOnSaveDiscountsCompletion, saveDeliveryAddressUponCompletion)\n{\n\n\tintenseLogging(\"saveItems() called\");\n\n\tif (currentlySavingOrder)\n\t{\n\t\tdd_toast({\n\t\t\tmessage: 'Items are still being saved',\n\t\t\tposition: 'topcenter'\n\t\t});\n\t\treturn;\n\t}\n\n\tdd_toast({\n\t\tmessage: 'Items Saved',\n\t\tposition: 'topcenter'\n\t});\n\n\tvar itemsList = {};\n\tvar introItemsList = {};\n\tvar subItemsList = {};\n\n\tvar is_intro = \"false\";\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\t$(\"[id^=bnd_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t// this will pick up any FT items\n\t\t$(\"[id^=qty_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\telse\n\t{\n\n\t\tif ($(\"#selectedBundle\").is(\":checked\"))\n\t\t{\n\n\t\t\tis_intro = \"true\";\n\n\t\t\t$(\"[id^=bnd_]\").each(function () {\n\n\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t{\n\t\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\t\tintroItemsList[item_id] = \"on\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t\t$(\"[id^=qty_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\n\t\t});\n\n\t\t$(\"[id^=sbi_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\tsubItemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\n\tvar misc_food_subtotal = $(\"#misc_food_subtotal\").val();\n\tif (isNaN(misc_food_subtotal))\n\t{\n\t\tmisc_food_subtotal = \"0.00\";\n\t}\n\n\tvar misc_nonfood_subtotal = $(\"#misc_nonfood_subtotal\").val();\n\tif (isNaN(misc_nonfood_subtotal))\n\t{\n\t\tmisc_nonfood_subtotal = \"0.00\";\n\t}\n\n\tvar subtotal_service_fee = $(\"#subtotal_service_fee\").val();\n\tif (isNaN(subtotal_service_fee))\n\t{\n\t\tsubtotal_service_fee = \"0.00\";\n\t}\n\n\tvar subtotal_delivery_fee = $(\"#subtotal_delivery_fee\").val();\n\tif (isNaN(subtotal_delivery_fee))\n\t{\n\t\tsubtotal_delivery_fee = \"0.00\";\n\t}\n\n\tvar misc_food_subtotal_desc = $(\"#misc_food_subtotal_desc\").val();\n\tvar misc_nonfood_subtotal_desc = $(\"#misc_nonfood_subtotal_desc\").val();\n\tvar service_fee_description = $(\"#service_fee_description\").val();\n\n\tvar special_instructions = $(\"#order_user_notes\").val();\n\n\tvar ltdOrderedMealsArray = $(\"#ltdOrderedMealsArray\").val();\n\n\tvar bagFeeTotal = 0;\n\tvar bagFeeCount = 0;\n\tif (storeSupportsBagFees)\n\t{\n\t\tvar bagFeeCount = $(\"#total_bag_count\").val();\n\n\t\tif (isNaN(bagFeeCount))\n\t\t{\n\t\t\tbagFeeCount = 0;\n\t\t}\n\n\t\tbagFeeTotal = storeDefaultBagFee * bagFeeCount;\n\t}\n\n\tlet opted_to_bring_bags = $(\"#opted_to_bring_bags\").is(\":checked\");\n\n\tlet manual_customization_fee = $(\"#manual_customization_fee\").val();\n\tlet opted_to_customize = ($(\"#opted_to_customize_recipes\").length > 0 && !$(\"#opted_to_customize_recipes\").is(\":checked\"));\n\tlet mealCustomizationFee = $(\"#subtotal_meal_customization_fee\").val();\n\n\tcurrentlySavingOrder = true;\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_items',\n\t\t\torder_id: order_id,\n\t\t\titems: itemsList,\n\t\t\tmisc_food_subtotal: misc_food_subtotal,\n\t\t\tmisc_nonfood_subtotal: misc_nonfood_subtotal,\n\t\t\tsubtotal_service_fee: subtotal_service_fee,\n\t\t\tmisc_food_subtotal_desc: misc_food_subtotal_desc,\n\t\t\tmisc_nonfood_subtotal_desc: misc_nonfood_subtotal_desc,\n\t\t\tservice_fee_description: service_fee_description,\n\t\t\tsubtotal_delivery_fee: subtotal_delivery_fee,\n\t\t\tmanual_customization_fee: manual_customization_fee,\n\t\t\topted_to_customize: opted_to_customize,\n\t\t\tmeal_customization_fee: mealCustomizationFee,\n\t\t\tis_intro: is_intro,\n\t\t\tintro_items: introItemsList,\n\t\t\tsub_items: subItemsList,\n\t\t\tltdOrderedMealsArray: ltdOrderedMealsArray,\n\t\t\tspecial_instructions: special_instructions,\n\t\t\tstoreSupportsBagFees: storeSupportsBagFees,\n\t\t\tbagFeeTotal: bagFeeTotal,\n\t\t\tbagFeeCount: bagFeeCount,\n\t\t\topted_to_bring_bags: opted_to_bring_bags\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\titemTabIsDirty = false;\n\t\t\t\tfeesTabIsDirty = false;\n\t\t\t\tif(opted_to_customize){\n\t\t\t\t\tupdateMealCustomizationOrgValues();\n\t\t\t\t}\n\t\t\t\tupdateItemsOrgValues();\n\n\t\t\t\tcurrentlySavingOrder = false;\n\n\t\t\t\tintenseLogging(\"saveItems() successful\");\n\n\t\t\t\tif (saveDiscountsUponCompletion)\n\t\t\t\t{\n\t\t\t\t\tsaveDiscounts(activateOnSaveDiscountsCompletion, saveDeliveryAddressUponCompletion);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcurrentlySavingOrder = false;\n\n\t\t\t\tintenseLogging(\"update_items: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tcurrentlySavingOrder = false;\n\t\t\tintenseLogging(\"update_items: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction setSessionAndSave(session_id)\n{\n\n\tintenseLogging(\"setSessionAndSave() called\");\n\n\tdisplayModalWaitDialog('saving_div', \"Setting session. Please wait ...\");\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 90000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'set_session_and_save',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val()\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"setSessionAndSave() successful\");\n\n\t\t\t\tif (json.full_session_warning_required)\n\t\t\t\t{\n\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr&order=\" + json.order_id + \"&session_full=true\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr&order=\" + json.order_id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\t$(\"#saving_div\").remove();\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tintenseLogging(\"set_session_and_save: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$(\"#saving_div\").remove();\n\n\t\t\tintenseLogging(\"set_session_and_save: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction Reschedule(org_session_id, transition_type, suppressEmail)\n{\n\n\tintenseLogging(\"Reschedule() called\");\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'reschedule',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\torder_id: order_id,\n\t\t\tsaved_booking_id: saved_booking_id,\n\t\t\torg_session_id: org_session_id,\n\t\t\torder_state: orderState,\n\t\t\ttransition_type: transition_type,\n\t\t\tsuppressEmail: suppressEmail\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"Reschedule() successful\");\n\n\t\t\t\tsession_id = json.new_session_id;\n\t\t\t\t$(\"#curSessionDate\").html(json.new_session_time);\n\n\t\t\t\t$(\"#session\").val(json.new_session_id);\n\n\t\t\t\tRetrieveCalendar(0);\n\n\t\t\t\tif (!json.canDelayPayment)\n\t\t\t\t{\n\t\t\t\t\t$(\".delayedPaymentSection\").hideFlex();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\".delayedPaymentSection\").showFlex();\n\t\t\t\t}\n\n\t\t\t\tif (json.session_discount)\n\t\t\t\t{\n\t\t\t\t\t$(\"#noSessionDiscountRow\").hide();\n\t\t\t\t\t$(\"#newSessionDiscountBody\").show();\n\t\t\t\t\t$(\"#sessionDiscountTypeSpan\").html(json.session_discount.type);\n\t\t\t\t\t$(\"#sessionDiscountValueSpan\").html(json.session_discount.value);\n\t\t\t\t\tactiveSessionDiscount.id = json.session_discount.id;\n\t\t\t\t\tactiveSessionDiscount.type = json.session_discount.type;\n\t\t\t\t\tactiveSessionDiscount.value = json.session_discount.value;\n\t\t\t\t\tcalculateTotal();\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#noSessionDiscountRow\").show();\n\t\t\t\t\t$(\"#newSessionDiscountBody\").hide();\n\t\t\t\t\tactiveSessionDiscount.id = 0;\n\t\t\t\t\tactiveSessionDiscount.type = 'none';\n\t\t\t\t\tactiveSessionDiscount.value = 0;\n\n\t\t\t\t}\n\n\t\t\t\t$(\"#curSessionTypeSpan\").html(json.session_info.session_type_title);\n\t\t\t\t$(\"#curSessionRemainingSlotsSpan\").html(json.session_info.remaining_slots);\n\t\t\t\t$(\"#curSessionRemainingIntroSlotsSpan\").html(json.session_info.remaining_intro_slots);\n\n\t\t\t\tif (json.client_ops.hasOwnProperty('require_delivery_address') && !$(\"#shipping_address_line1\").length)\n\t\t\t\t{\n\t\t\t\t\t// rather than load a new tab for now just reload the page\n\t\t\t\t\tbounce(window.location.href);\n\n\t\t\t\t}\n\n\t\t\t\tfor (var key in json.client_ops)\n\t\t\t\t{\n\t\t\t\t\tif (json.client_ops.hasOwnProperty(key))\n\t\t\t\t\t{\n\t\t\t\t\t\tswitch (key)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'adj_service_fee':\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(\"#subtotal_service_fee\").val(json.client_ops[key]);\n\t\t\t\t\t\t\t\t$(\"#OEH_subtotal_service_fee_org\").html(formatAsMoney(json.client_ops[key]));\n\t\t\t\t\t\t\t\tid = \"OEH_subtotal_service_fee_org\"\n\t\t\t\t\t\t\t\tcalculateTotal();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'update_svc_fee_desc':\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(\"#service_fee_description\").val(json.client_ops[key]);\n\t\t\t\t\t\t\t\tcalculateTotal();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'adj_delivery_fee':\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!$(\"#subtotal_delivery_fee\").length)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t// The current DOM has no delivery fee field so for now causea refresh\n\t\t\t\t\t\t\t\t\tbounce(window.location.href);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$(\"#subtotal_delivery_fee\").val(json.client_ops[key]);\n\t\t\t\t\t\t\t\t$(\"#OEH_subtotal_delivery_fee_org\").html(formatAsMoney(json.client_ops[key]));\n\t\t\t\t\t\t\t\tcalculateTotal();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'require_delivery_address':\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(\"[id^='shipping_']\").each(function () {\n\t\t\t\t\t\t\t\t\t$(this).attr('required', 'required');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'delete_delivery_address':\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(\"#delivery_tab_li\").remove();\n\t\t\t\t\t\t\t\t$(\"#delivery\").remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"reschedule: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\n\t\t\tintenseLogging(\"reschedule: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction onSetSessionAndSave(obj)\n{\n\tintenseLogging(\"onSetSessionAndSave() called\");\n\n\tvar session_id = $(\"#selected_session\").attr(\"data-session_id\");\n\tsetSessionAndSave(session_id);\n\treturn false;\n}\n\nfunction onSaveItems()\n{\n\tintenseLogging(\"onSaveItems() called\");\n\n\tsaveItems(false, false, false);\n\treturn false;\n\n}\n\nfunction setupForNewOrder()\n{\n\tHideLineItemsIfZero();\n\tvar timestamp = getQueryVariable('month');\n\tif (!timestamp)\n\t{\n\t\ttimestamp = \"0\";\n\t}\n\tRetrieveCalendar(timestamp);\n\t$(\"#addPaymentAndActivate\").show();\n\n}\n\nfunction setupForSavedOrder()\n{\n\t$(\"#addPaymentAndActivate\").show();\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tinitialSessionDiscountSetting = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tinitialPreferredUserDiscountSetting = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\t}\n}\n\nfunction setupForActiveOrder()\n{\n\tif (discountEligable.limited_access)\n\t{\n\t\t$(\"#payments_tab_li\").click();\n\n\t\t$(\"#items_tab_li\").addClass(\"disabled\");\n\t\t$(\"#fees_tab_li\").addClass(\"disabled\");\n\t\t$(\"#sessions_tab_li\").addClass(\"disabled\");\n\t\t$(\"#discountsDiv\").find(\":input\").prop(\"disabled\", true);\n\t\t$(\"#discountsDiv\").find(\"*\").addClass(\"om_disabled\");\n\n\t}\n\n\t$(\"#addPaymentAndActivate\").hide();\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tinitialSessionDiscountSetting = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tinitialPreferredUserDiscountSetting = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\t}\n\n}\n\nfunction isDeliveryAddressComplete()\n{\n\tvar validated = true;\n\n\t$(\"[id^='shipping_']\").each(function () {\n\n\t\tif (!$(this).val() && $(this).attr('required'))\n\t\t{\n\t\t\tvalidated = false;\n\t\t}\n\t});\n\treturn validated;\n}\n\nfunction saveDeliveryAddress(payOnCompletion, token)\n{\n\n\tvar shipping_data = {};\n\t$(\"[id^='shipping_']\").each(function () {\n\t\tshipping_data[this.id] = $(this).val();\n\t});\n\n\tintenseLogging(\"saveDeliveryAddress() called\");\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 200000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'save_delivery_address',\n\t\t\torder_id: order_id,\n\t\t\tshipping_data: shipping_data\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveDeliveryAddress() successful\");\n\n\t\t\t\tdd_toast({\n\t\t\t\t\tmessage: 'Delivery Address Saved',\n\t\t\t\t\tposition: 'topcenter'\n\t\t\t\t});\n\n\t\t\t\tif (payOnCompletion)\n\t\t\t\t{\n\t\t\t\t\tonAddPaymentAndActivate(false, true, token);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"save_delivery_address: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tintenseLogging(\"save_delivery_address: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onDeliveryTabSelected()\n{\n\n}\n\nfunction onDeliveryTabDeselected()\n{\n\tif (!isDeliveryAddressComplete())\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please check the Delivery Address and phone number fields for completeness.'\n\t\t});\n\n\t\treturn false;\n\t}\n\telse\n\t{\n\t\tsaveDeliveryAddress(false, false);\n\t\treturn true;\n\t}\n\n}\n\nfunction onSessionTabSelected()\n{\n\tRetrieveCalendar(0);\n}\n\nfunction onSessionTabDeselected()\n{\n\treturn true;\n}\n\nfunction onItemsTabSelected()\n{\n\n}\n\nfunction onItemsTabDeselected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\tif (itemTabIsDirty)\n\t\t{\n\t\t\t/*\n\t\t\t dd_message({\n\t\t\t title: 'Attention',\n\t\t\t message: 'You have unsaved changes. Do you wish to save changes to the items tab?',\n\t\t\t confirm: function() {\n\t\t\t }\n\t\t\t });\n\t\t\t */\n\n\t\t\tsaveItems(false, false, false);\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction onFeesTabSelected()\n{\n\n}\n\nfunction onFeesTabDeselected()\n{\n\treturn true;\n}\n\nfunction onPaymentTabSelected()\n{\n\thandle_admin_order_notes();\n\thandle_free_menu_item_edit();\n}\n\nfunction onPaymentTabDeselected()\n{\n\tif (orderState != 'ACTIVE' && (discountChanges || reportingChanges))\n\t{\n\t\tsaveDiscounts(false, false);\n\t}\n\n\treturn true;\n}\n\nfunction onRelatedOrdersTabSelected()\n{\n\tif (!relatedOrdersAreLoaded)\n\t{\n\n\t\tintenseLogging(\"Loading related Orders\");\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'retrieve_related_orders',\n\t\t\t\tsession_id: session_id,\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\n\t\t\t\tintenseLogging(\"Loading related Orders successful\");\n\n\t\t\t\t$(\"#related_orders\").html(json.data);\n\t\t\t\t$(\"#loading_related_orders\").remove();\n\t\t\t\trelatedOrdersAreLoaded = true;\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#loading_related_orders\").remove();\n\n\t\t\t\tintenseLogging(\"retrieve_related_orders: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t});\n\t}\n\n}\n\nfunction onRelatedOrdersTabDeselected()\n{\n\treturn true;\n}\n\nfunction onNotesTabSelected()\n{\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'get_history',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\t$(\"#history_div\").html(json.html);\n\n\t\t\thandle_guest_account_notes();\n\n\t\t\thandle_admin_carryover_notes();\n\n\t\t\thandle_admin_order_notes();\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\n\t\t\tintenseLogging(\"get_history: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onNotesTabDeselected()\n{\n\treturn true;\n}\n\nfunction onPaymentSelected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\n\t\tpaymentChanges = true;\n\t\tupdateChangeList();\n\t}\n\telse\n\t{\n\t\tpaymentChanges = true;\n\t\tupdateChangeList();\n\t}\n}\n\nfunction onPaymentDeselected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\n\t\tupdateChangeList();\n\t\tpaymentChanges = false;\n\t}\n\telse\n\t{\n\t\tpaymentChanges = false;\n\t\tupdateChangeList();\n\t}\n\n\treturn true;\n\n}\n\nfunction onSiteAdminTabSelected()\n{\n\n}\n\nfunction onSiteAdminTabDeselected()\n{\n\treturn true;\n}\n\nfunction updateDiscountOrgValues()\n{\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tinitialSessionDiscountSetting = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tinitialPreferredUserDiscountSetting = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\t}\n\n\t$(\"#org_coupon_id\").val($(\"#coupon_id\").val());\n\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\n\t\t$(this).data('org_value', $(this).val());\n\t});\n\n\tupdateChangeList();\n\n}\n\nfunction updateActiveOrder(payOnCompletion, go_to_confirm)\n{\n\tintenseLogging(\"updateActiveOrder() called\");\n\n\tvar itemsList = {};\n\tvar introItemsList = {};\n\tvar subItemsList = {};\n\n\tvar is_intro = \"false\";\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\t$(\"[id^=bnd_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t//pick up any sides\n\t\t$(\"[id^=qty_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\telse\n\t{\n\n\t\tif ($(\"#selectedBundle\").is(\":checked\"))\n\t\t{\n\n\t\t\tis_intro = \"true\";\n\n\t\t\t$(\"[id^=bnd_]\").each(function () {\n\n\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t{\n\t\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\t\tintroItemsList[item_id] = \"on\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t\t$(\"[id^=qty_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t$(\"[id^=sbi_]\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\tsubItemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\n\tvar misc_food_subtotal = $(\"#misc_food_subtotal\").val();\n\tif (isNaN(misc_food_subtotal))\n\t{\n\t\tmisc_food_subtotal = \"0.00\";\n\t}\n\n\tvar misc_nonfood_subtotal = $(\"#misc_nonfood_subtotal\").val();\n\tif (isNaN(misc_nonfood_subtotal))\n\t{\n\t\tmisc_nonfood_subtotal = \"0.00\";\n\t}\n\n\tvar subtotal_service_fee = $(\"#subtotal_service_fee\").val();\n\tif (isNaN(subtotal_service_fee))\n\t{\n\t\tsubtotal_service_fee = \"0.00\";\n\t}\n\n\tvar subtotal_delivery_fee = $(\"#subtotal_delivery_fee\").val();\n\tif (isNaN(subtotal_delivery_fee))\n\t{\n\t\tsubtotal_delivery_fee = \"0.00\";\n\t}\n\n\tvar misc_food_subtotal_desc = $(\"#misc_food_subtotal_desc\").val();\n\tvar misc_nonfood_subtotal_desc = $(\"#misc_nonfood_subtotal_desc\").val();\n\tvar service_fee_description = $(\"#service_fee_description\").val();\n\n\tvar direct_order_discount = $(\"#direct_order_discount\").val();\n\tif (isNaN(direct_order_discount))\n\t{\n\t\tdirect_order_discount = \"0.00\";\n\t}\n\n\tvar PUDSetting = $('input[name=PUD]:checked', '#editorForm').val();\n\n\tif (PUDSetting == null || PUDSetting == \"\")\n\t{\n\t\tPUDSetting = \"noUP\";\n\t}\n\n\tvar plate_points_discount = $(\"#plate_points_discount\").val();\n\tif (isNaN(plate_points_discount))\n\t{\n\t\tplate_points_discount = \"0.00\";\n\t}\n\n\tvar SessDiscSetting = $('input[name=SessDisc]:checked', '#editorForm').val();\n\n\tif (SessDiscSetting == null || SessDiscSetting == \"\")\n\t{\n\t\tSessDiscSetting = \"noSD\";\n\t}\n\n\tvar DR_level = 0;\n\tif ($(\"#dr_level_for_order\").length)\n\t{\n\t\tvar curOrderLevel = $(\"#dr_level_for_order\").val();\n\t\tif (curOrderLevel > 0)\n\t\t{\n\t\t\tDR_level = curOrderLevel;\n\t\t}\n\t}\n\n\tvar ltdOrderedMealsArray = $(\"#ltdOrderedMealsArray\").val();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_active_order',\n\t\t\torder_id: order_id,\n\t\t\titems: itemsList,\n\t\t\tmisc_food_subtotal: misc_food_subtotal,\n\t\t\tmisc_nonfood_subtotal: misc_nonfood_subtotal,\n\t\t\tsubtotal_service_fee: subtotal_service_fee,\n\t\t\tsubtotal_delivery_fee: subtotal_delivery_fee,\n\t\t\tmisc_food_subtotal_desc: misc_food_subtotal_desc,\n\t\t\tmisc_nonfood_subtotal_desc: misc_nonfood_subtotal_desc,\n\t\t\tservice_fee_description: service_fee_description,\n\t\t\tis_intro: is_intro,\n\t\t\tintro_items: introItemsList,\n\t\t\tsub_items: subItemsList,\n\t\t\tdirect_order_discount: direct_order_discount,\n\t\t\tPUDSetting: PUDSetting,\n\t\t\tplate_points_discount: plate_points_discount,\n\t\t\tSessDiscSetting: SessDiscSetting,\n\t\t\tdream_rewards_level: DR_level,\n\t\t\tchangeList: JSON.stringify(changeList),\n\t\t\tchangeListStr: getChangeListHTML(),\n\t\t\tltdOrderedMealsArray: ltdOrderedMealsArray,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val()\n\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"updateActiveOrder() successful\");\n\n\t\t\t\titemTabIsDirty = false;\n\t\t\t\tupdateItemsOrgValues();\n\t\t\t\tupdateDiscountOrgValues();\n\n\t\t\t\tif (payOnCompletion)\n\t\t\t\t{\n\t\t\t\t\tonAddPaymentAndActivate(payOnCompletion, go_to_confirm, json.getTokenToken);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"update_active_order: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tintenseLogging(\"update_active_order: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction _validate_discounts()\n{\n\t// check to see if coupon requires free menu selection\n\tif (couponFreeMenuItemRequired)\n\t{\n\t\treturn _check_elements([$('#free_menu_item_coupon').get(0)]);\n\t}\n\n\treturn true;\n}\n\nfunction saveDiscounts(payOnCompletion, saveDeliveryAddressUponCompletion)\n{\n\tintenseLogging(\"saveDiscounts() called\");\n\n\tif (!_validate_discounts())\n\t{\n\t\treturn false;\n\t}\n\n\tif (!payOnCompletion)\n\t{\n\t\tdd_toast({\n\t\t\tmessage: 'Discounts Saved',\n\t\t\tposition: 'topcenter'\n\t\t});\n\t}\n\n\tvar direct_order_discount = $(\"#direct_order_discount\").val();\n\tif (isNaN(direct_order_discount))\n\t{\n\t\tdirect_order_discount = \"0.00\";\n\t}\n\n\tvar PUDSetting = $('input[name=PUD]:checked', '#editorForm').val();\n\n\tif (PUDSetting == null || PUDSetting == \"\")\n\t{\n\t\tPUDSetting = \"noUP\";\n\t}\n\n\tvar plate_points_discount = $(\"#plate_points_discount\").val();\n\tif (isNaN(plate_points_discount))\n\t{\n\t\tplate_points_discount = \"0.00\";\n\t}\n\n\tlet referral_reward_discount = $(\"#referral_reward_discount\").val();\n\tif (isNaN(referral_reward_discount))\n\t{\n\t\treferral_reward_discount = \"0.00\";\n\t}\n\n\tvar SessDiscSetting = $('input[name=SessDisc]:checked', '#editorForm').val();\n\n\tif (SessDiscSetting == null || SessDiscSetting == \"\")\n\t{\n\t\tSessDiscSetting = \"noSD\";\n\t}\n\n\tvar DR_level = 0;\n\tif ($(\"#dr_level_for_order\").length)\n\t{\n\t\tvar curOrderLevel = $(\"#dr_level_for_order\").val();\n\t\tif (curOrderLevel > 0)\n\t\t{\n\t\t\tDR_level = curOrderLevel;\n\t\t}\n\t}\n\n\tvar coupon_id = 0;\n\tvar coupon_free_menu_item = 0;\n\tif ($(\"#coupon_id\").val())\n\t{\n\t\tif (couponFreeMenuItemRequired)\n\t\t{\n\t\t\tif ($('#free_menu_item_coupon').val())\n\t\t\t{\n\t\t\t\tcoupon_free_menu_item = $('#free_menu_item_coupon').val();\n\t\t\t}\n\t\t}\n\n\t\tcoupon_id = $(\"#coupon_id\").val();\n\t}\n\n\tvar fundraiser_id = $('#fundraiser_id').val();\n\tvar fundraiser_value = $('#fundraiser_value').val();\n\tvar add_ltd_round_up = ($('#add_ltd_round_up').is(':checked') ? true : false);\n\tvar ltd_round_up_select = $('#ltd_round_up_select').val();\n\n\tvar bagFeeTotal = 0;\n\tvar bagFeeCount = 0;\n\tif (storeSupportsBagFees)\n\t{\n\t\tvar bagFeeCount = $(\"#total_bag_count\").val();\n\n\t\tif (isNaN(bagFeeCount))\n\t\t{\n\t\t\tbagFeeCount = 0;\n\t\t}\n\n\t\tbagFeeTotal = storeDefaultBagFee * bagFeeCount;\n\t}\n\n\tlet opted_to_bring_bags = $(\"#opted_to_bring_bags\").is(\":checked\");\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'update_discounts',\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id,\n\t\t\tdirect_order_discount: direct_order_discount,\n\t\t\tPUDSetting: PUDSetting,\n\t\t\tplate_points_discount: plate_points_discount,\n\t\t\treferral_reward_discount: referral_reward_discount,\n\t\t\tSessDiscSetting: SessDiscSetting,\n\t\t\tcoupon_id: coupon_id,\n\t\t\tcoupon_free_menu_item: coupon_free_menu_item,\n\t\t\tdream_rewards_level: DR_level,\n\t\t\tfundraiser_id: fundraiser_id,\n\t\t\tfundraiser_value: fundraiser_value,\n\t\t\tadd_ltd_round_up: add_ltd_round_up,\n\t\t\tltd_round_up_select: ltd_round_up_select,\n\t\t\tstoreSupportsBagFees: storeSupportsBagFees,\n\t\t\tbagFeeTotal: bagFeeTotal,\n\t\t\tbagFeeCount: bagFeeCount,\n\t\t\topted_to_bring_bags: opted_to_bring_bags\n\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveDiscounts() successful\");\n\n\t\t\t\tupdateDiscountOrgValues();\n\t\t\t\tupdateReportingOrgValues();\n\n\t\t\t\tif (coupon_free_menu_item)\n\t\t\t\t{\n\t\t\t\t\t$('#free_menu_item_coupon').attr('disabled', true);\n\t\t\t\t\tcouponFreeMenuItem = coupon_free_menu_item;\n\t\t\t\t}\n\n\t\t\t\tif (saveDeliveryAddressUponCompletion && $(\"#shipping_firstname\")[0])\n\t\t\t\t{\n\t\t\t\t\tsaveDeliveryAddress(payOnCompletion, json.paymentToken);\n\t\t\t\t}\n\t\t\t\telse if (payOnCompletion)\n\t\t\t\t{\n\t\t\t\t\tonAddPaymentAndActivate(false, true, json.paymentToken);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"update_discounts: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tintenseLogging(\"update_discounts: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction updateReportingOrgValues()\n{\n\t$('#fundraiser_id').data('org_value', $('#fundraiser_id').val());\n\t$('#fundraiser_value').data('org_value', $('#fundraiser_value').val());\n\t$('#ltd_round_up_select').data('org_value', $('#ltd_round_up_select').val());\n\t$('#OEH_ltd_round_up_org').data('org_value', $('#ltd_round_up_select').val());\n\n\tif ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\t$('#add_ltd_round_up').data('org_value', true);\n\t}\n\telse\n\t{\n\t\t$('#add_ltd_round_up').data('org_value', false);\n\t}\n\n\tupdateChangeList();\n}\n\nfunction send(token, paymentNumber, warnOfOutstandingSavedOrdersOnFullSession, addOnly, go_to_confirm, payment1Data)\n{\n\n\tintenseLogging(\"send() called for payment# \" + paymentNumber);\n\n\t$('#paypal-result').on(\"load\", function () {\n\n\t\tintenseLogging(\"result iFrame loading\");\n\n\t\ttry\n\t\t{\n\t\t\tvar next_dest = $('#paypal-result').get(0).contentWindow.next_dest;\n\t\t\tvar success = $('#paypal-result').get(0).contentWindow.pp_success;\n\n\t\t}\n\t\tcatch (e)\n\t\t{\n\n\t\t\tintenseLogging(\"exception occurred accessing result iframe\");\n\n\t\t\t$(\"#paying_div\").remove();\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Exception',\n\t\t\t\tmessage: 'We are sorry but an unexpected error occurred during payment processing. Please try again or contact support.'\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t// in Safari - exception is not thrown and success is undefined\n\t\t// the test is false and we drop into the success = false block\n\t\t// then error_code and message also are set to undefined\n\n\t\tif (success)\n\t\t{\n\t\t\tintenseLogging(\"success found in iframe\");\n\n\t\t\tbounce(next_dest);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar error_code = $('#paypal-result').get(0).contentWindow.error_code;\n\t\t\tvar message = $('#paypal-result').get(0).contentWindow.message;\n\n\t\t\tintenseLogging(\"error found in iframe: #\" + error_code + \" | \" + message);\n\n\t\t\tif (typeof error_code == 'undefined')\n\t\t\t{\n\t\t\t\terror_code = \"Generic\";\n\t\t\t\tmessage = 'Some required information is missing or incorrect. Please correct the fields below and try again.';\n\n\t\t\t\tintenseLogging(\"error code undefined in iframe\");\n\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\n\t\t\t}\n\t\t\telse if (next_dest && next_dest.length > 0)\n\t\t\t{\n\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"Okay\": function () {\n\t\t\t\t\t\t\tbounce(next_dest);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tvar reload = $('#paypal-result').get(0).contentWindow.reloadOnFailure;\n\n\t\t\t\tif (reload)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"reloadOnFailure found in iframe: reloading\");\n\n\t\t\t\t\tmessage += \"<br /><br /><span style='color:red'>The credit card payment failed however the order was booked with the gift certificate. The page will now reload.</span>\";\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\tnoOk: true,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\"Okay\": function () {\n\t\t\t\t\t\t\t\tbounce(window.location.href);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\t\tmessage: message\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t});\n\n\tvar comment_payload = new PayFlow_Payload();\n\n\tcomment_payload.addNameValuePair('UserID', user_id);\n\tcomment_payload.addNameValuePair('StoreID', STORE_DETAILS.id);\n\tcomment_payload.addNameValuePair('OrderID', order_id); // TODO: need id here of somekind so the payment can be tracked to an order. Either we create a \"blank\" order\n\t// or we use another id that is tied to the order when it is later inserted.\n\tcomment_payload.addNameValuePair('Email', user_email);\n\n\tif (paymentNumber == 1)\n\t{\n\t\tvar expdate = $(\"#payment1_ccMonth\").val();\n\t\texpdate += $(\"#payment1_ccYear\").val();\n\t\tvar csc = $(\"#payment1_cc_security_code\").val();\n\t\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t\tvar payload = new PayFlow_Payload();\n\n\t\tpayload.addNameValuePair('admin_user_id', USER_DETAILS.id);\n\t\tpayload.addNameValuePair('user_id', user_id);\n\t\tpayload.addNameValuePair('store_id', STORE_DETAILS.id);\n\t\tpayload.addNameValuePair('order_id', order_id);\n\t\tpayload.addNameValuePair('caller_id', 'fadmin_order');\n\t\tif (addOnly)\n\t\t{\n\t\t\tpayload.addNameValuePair('add_only', 'true');\n\t\t}\n\t\tif (go_to_confirm)\n\t\t{\n\t\t\tpayload.addNameValuePair('go_to_confirm', 'true');\n\t\t}\n\t\tpayload.addNameValuePair('is_second_payment', 'false');\n\n\t\tvar use_store_credits = false;\n\t\tvar store_credit_amount = 0;\n\t\tif ($(\"#use_store_credits\").length)\n\t\t{\n\t\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t\t{\n\t\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\t\tpayload.addNameValuePair('use_sc', 'true');\n\t\t\t\tpayload.addNameValuePair('sc_amt', store_credit_amount);\n\t\t\t}\n\t\t}\n\n\t\tvar DP_State = 0;\n\t\tif ($('#payment1_is_store_specific_flat_rate_deposit_delayed_payment1').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\tpayload.addNameValuePair('DP_State', DP_State);\n\t\t\t\tpayload.addNameValuePair('org_amount', amt);\n\n\t\t\t\tvar depositAmount = 20;\n\t\t\t\tif (DP_State == 1 && store_specific_deposit && store_specific_deposit > 20)\n\t\t\t\t{\n\t\t\t\t\tdepositAmount = store_specific_deposit;\n\t\t\t\t}\n\n\t\t\t\tif (amt * 1 <= depositAmount * 1)\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Delayed Payment Error',\n\t\t\t\t\t\tmessage: \"The amount of the payment is less than or equal to the deposit. Delayed Payment cannot be used.\"\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tamt = depositAmount;\n\n\t\t\t}\n\t\t}\n\n\t\tif (typeof payflowErrorURL == 'undefined')\n\t\t{\n\t\t\tpayflowErrorURL = \"https://dreamdinners.com/ddproc.php?processor=admin_payflow_callback\";\n\t\t}\n\n\t\t// make PARMLIST\n\t\tvar parmList = 'ERRORURL=' + payflowErrorURL + \"&ACCT=\" + $(\"#payment1_ccNumber\").val() + \"&EXPDATE=\" + expdate + \"&CSC=\" + csc + \"&AMT=\" + amt + \"&USER1=\" + payload.retrieveEncodedString() + \"&COMMENT1=\" + comment_payload.retrieveEncodedString();\n\t}\n\telse\n\t{\n\t\tvar expdate = $(\"#payment2_ccMonth\").val();\n\t\texpdate += $(\"#payment2_ccYear\").val();\n\t\tvar csc = $(\"#payment2_cc_security_code\").val();\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\tvar payload = new PayFlow_Payload();\n\n\t\tpayload.addNameValuePair('user_id', user_id);\n\t\tpayload.addNameValuePair('store_id', STORE_DETAILS.id);\n\t\tpayload.addNameValuePair('order_id', order_id);\n\t\tpayload.addNameValuePair('caller_id', 'fadmin_order');\n\t\tpayload.addNameValuePair('add_only', 'false');\n\t\tpayload.addNameValuePair('is_second_payment', 'true');\n\t\tif (go_to_confirm)\n\t\t{\n\t\t\tpayload.addNameValuePair('go_to_confirm', 'true');\n\t\t}\n\n\t\tif (payment1Data)\n\t\t{\n\t\t\tpayload.addNameValuePair(\"hasPayment1\", true);\n\n\t\t\tfor (var key in payment1Data)\n\t\t\t{\n\t\t\t\tif (payment1Data.hasOwnProperty(key))\n\t\t\t\t{\n\t\t\t\t\tpayload.addNameValuePair(\"p1_\" + key, payment1Data[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar DP_State = 0;\n\t\tif ($('#payment2_is_store_specific_flat_rate_deposit_delayed_payment1').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\tpayload.addNameValuePair('DP_State', DP_State);\n\t\t\t\tpayload.addNameValuePair('org_amount', amt);\n\n\t\t\t\tvar depositAmount = 20;\n\t\t\t\tif (DP_State == 1 && store_specific_deposit && store_specific_deposit > 20)\n\t\t\t\t{\n\t\t\t\t\tdepositAmount = store_specific_deposit;\n\t\t\t\t}\n\n\t\t\t\tif (amt * 1 <= depositAmount * 1)\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Delayed Payment Error',\n\t\t\t\t\t\tmessage: \"The amount of the payment is less than or equal to the deposit. Delayed Payment cannot be used.\"\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tamt = depositAmount;\n\n\t\t\t}\n\t\t}\n\n\t\tif (typeof payflowErrorURL == 'undefined')\n\t\t{\n\t\t\tpayflowErrorURL = \"https://dreamdinners.com/ddproc.php?processor=admin_payflow_callback\";\n\t\t}\n\n\t\t// make PARMLIST\n\t\tvar parmList = 'ERRORURL=' + payflowErrorURL + \"&ACCT=\" + $(\"#payment2_ccNumber\").val() + \"&EXPDATE=\" + expdate + \"&CSC=\" + csc + \"&AMT=\" + amt + \"&USER1=\" + payload.retrieveEncodedString() + \"&COMMENT1=\" + comment_payload.retrieveEncodedString();\n\t}\n\n\tvar tr_action = 'https://payflowlink.paypal.com';\n\tif (typeof pfp_test_mode != 'undefined' && pfp_test_mode)\n\t{\n\t\tvar tr_action = 'https://pilot-payflowlink.paypal.com';\n\t}\n\n\tif (typeof transparent_redirect_link != 'undefined')\n\t{\n\t\ttr_action = transparent_redirect_link;\n\t}\n\n\tintenseLogging(\"posting to PayFlow\");\n\n\t// Create dynamic form to post and redirect to session_menu\n\tcreate_and_submit_form({\n\t\taction: tr_action,\n\t\ttarget: \"paypal-result\",\n\t\tinput: ({\n\t\t\tSECURETOKEN: token.token,\n\t\t\tSECURETOKENID: token.tokenID,\n\t\t\tPARMLIST: parmList\n\t\t})\n\t});\n\n}\n\nfunction getPaymentData(type, payment_number)\n{\n\n\tif (type != 'CC')\n\t{\n\t\tvar paymentData = {\n\t\t\ttype: type,\n\t\t\tnumber: 0,\n\t\t\tamount: 0,\n\t\t\tcert_type: '',\n\t\t\tnote: $(\"#payment_note\").val()\n\t\t}\n\t}\n\telse\n\t{\n\t\tvar paymentData = {\n\t\t\ttype: type,\n\t\t\tnumber: 0,\n\t\t\tamount: 0,\n\t\t\tcert_type: '',\n\t\t\tnote: $(\"#payment_note\").val(),\n\t\t\tccNameOnCard: \"\",\n\t\t\tccType: 'CC',\n\t\t\tccMonth: \"\",\n\t\t\tccYear: \"\",\n\t\t\tcc_security_code: \"\",\n\t\t\tbilling_address: \"\",\n\t\t\tbilling_city: \"\",\n\t\t\tbilling_state_id: \"\",\n\t\t\tbilling_postal_code: \"\",\n\t\t\tis_store_specific_flat_rate_deposit_delayed_payment: 0,\n\t\t\tdo_not_ref: 0\n\t\t}\n\t}\n\n\tif (payment_number == 1)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase \"REFERENCE\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_reference_total_amount\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"GIFT_CERT\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_gc_total_amount\").val();\n\t\t\t\tpaymentData.cert_type = $(\"#payment1_gift_cert_type\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_gc_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFUND_CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_refund_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_refund_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_check_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_check_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CREDIT\":\n\t\t\t\tpaymentData.amount = $(\"#OEH_remaing_balance\").html();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CC\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_cc_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_ccNumber\").val();\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment1_ccNameOnCard\").val();\n\t\t\t\tpaymentData.ccType = $(\"#payment1_ccType\").val();\n\t\t\t\tpaymentData.ccMonth = $(\"#payment1_ccMonth\").val();\n\t\t\t\tpaymentData.ccYear = $(\"#payment1_ccYear\").val();\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment1_cc_security_code\").val();\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_1\").val();\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_1\").val();\n\t\t\t\tpaymentData.billing_city = $(\"#billing_city_1\").val();\n\t\t\t\tpaymentData.billing_state_id = $(\"#billing_state_id_1\").val();\n\n\t\t\t\tif ($('#save_cc_as_ref_1').is(':checked'))\n\t\t\t\t{\n\t\t\t\t\tpaymentData.save_card = true;\n\t\t\t\t}\n\n\t\t\t\tvar DPSetting = $('input[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"GIFT_CARD\":\n\t\t\t\tpaymentData.amount = $(\"#debit_gift_card_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#debit_gift_card_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"DPADJUST\":\n\t\t\t\t// TODO: ???\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFERENCE_OTHER\":\n\t\t\t\talert('investigate REFERENCE_OTHER');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\n\t\t\t\t{\n\t\t\t\t\tpaymentData.amount = $(\"#payment1_ref_total_amount\").val();\n\t\t\t\t\tpaymentData.reference_id = $(\"#p1_ref_id\").html();\n\t\t\t\t}\n\n\t\t}\n\n\t\treturn paymentData;\n\n\t}\n\telse if (payment_number == 2)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase \"CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_check_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_check_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CC\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_cc_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_ccNumber\").val();\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment2_ccNameOnCard\").val();\n\t\t\t\tpaymentData.ccType = $(\"#payment2_ccType\").val();\n\t\t\t\tpaymentData.ccMonth = $(\"#payment2_ccMonth\").val();\n\t\t\t\tpaymentData.ccYear = $(\"#payment2_ccYear\").val();\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment2_cc_security_code\").val();\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_2\").val();\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_2\").val();\n\n\t\t\t\tif ($('#save_cc_as_ref_2').is(':checked'))\n\t\t\t\t{\n\t\t\t\t\tpaymentData.save_card = true;\n\t\t\t\t}\n\n\t\t\t\tvar DPSetting = $('input[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFERENCE_OTHER\":\n\t\t\t\talert('investigate REFERENCE_OTHER');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\n\t\t\t\t{\n\t\t\t\t\tpaymentData.amount = $(\"#payment2_ref_total_amount\").val();\n\t\t\t\t\tpaymentData.reference_id = $(\"#p2_ref_id\").html();\n\t\t\t\t}\n\n\t\t}\n\n\t\treturn paymentData;\n\t}\n\n}\n\nfunction validatePayment1(type)\n{\n\n\tvar inputArray = null;\n\tvar validates = true;\n\n\tif (type.substr(0, 4) == \"REF_\")\n\t{\n\t\ttype = \"REFERENCE_OTHER\";\n\t}\n\n\tswitch (type)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\tinputArray = $(\"#payment1_reference :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tinputArray = $(\"#payment1_gc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tinputArray = $(\"#payment1_cash :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tinputArray = $(\"#payment1_refund_cash :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tinputArray = $(\"#payment1_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\tinputArray = $(\"#payment1_credit :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tinputArray = $(\"#payment1_cc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment1_cc_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tinputArray = $(\"#payment1_debit_gift_card :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"DPADJUST\":\n\t\t\tinputArray = $(\"#dp_adjust_div :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tinputArray = $(\"#payment1_ref :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment1_ref_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t}\n\n\treturn validates;\n\n}\n\nfunction validatePayment2(type)\n{\n\n\tvar inputArray = null;\n\tvar validates = true;\n\n\tif (type.substr(0, 4) == \"REF_\")\n\t{\n\t\ttype = \"REFERENCE_OTHER\";\n\t}\n\n\tswitch (type)\n\t{\n\n\t\tcase \"CASH\":\n\t\t\tinputArray = $(\"#payment2_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tinputArray = $(\"#payment2_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tinputArray = $(\"#payment2_cc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment2_cc_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tinputArray = $(\"#payment2_ref :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment2_ref_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\t}\n\n\treturn validates;\n}\n\nfunction addPaymentAndActivate()\n{\n\tlet minimumVal = null;\n\tlet minimumType = null;\n\n\tif (typeof order_minimum !== 'undefined' && typeof order_minimum.minimum !== 'undefined')\n\t{\n\t\tminimumVal = order_minimum.minimum;\n\t\tminimumType = order_minimum.minimum_type\n\t}\n\n\tintenseLogging(\"addPaymentAndActivate() called\");\n\tlet servingsCount = 0;\n\tlet enforce36ServingMinimum = false;\n\tlet underFilledMessage = 'This order is for less than 36 servings. Do you wish to continue?';\n\n\tif (minimumVal != null)\n\t{\n\t\tunderFilledMessage = 'This order is for less than ' + minimumVal + ' ' + minimumType.toLowerCase() + 's. Do you wish to continue?';\n\t}\n\n\tservingsCount = Number($('#OEH_number_servings').html());\n\tlet itemCount = Number($('#OEH_number_core_servings').html());\n\n\tif (orderIsEligibleForMembershipDiscount && storeSupportsMembership)\n\t{\n\t\tif (membership_status.eligible_menus[menu_id].number_qualifying_orders == 0)\n\t\t{\n\t\t\tunderFilledMessage = 'This Meal Prep+ order has less than 36 core servings. Because this guest does not have a consecutive standard order for this menu month, this order is required to have at least 36 servings before a smaller order can be added.';\n\t\t\tenforce36ServingMinimum = true;\n\t\t}\n\t}\n\n\tlet quantityOrdered = servingsCount.valueOf();\n\tlet requiredMinimum = 36;\n\tif (minimumVal != null)\n\t{\n\t\trequiredMinimum = minimumVal;\n\t\tif (minimumType === 'ITEM')\n\t\t{\n\t\t\tquantityOrdered = itemCount.valueOf();\n\t\t}\n\t}\n\n\tif (quantityOrdered < requiredMinimum && enforce36ServingMinimum)\n\t{\n\t\tintenseLogging(\"addPaymentAndActivate() - warning for less than \" + requiredMinimum + '' + minimumType);\n\n\t\tdd_message({\n\t\t\ttitle: 'Warning',\n\t\t\tmessage: underFilledMessage\n\t\t});\n\n\t\treturn false;\n\n\t}\n\telse if (quantityOrdered < requiredMinimum && !isDreamTaste && !isFundraiser && !$(\"#selectedBundle\").is(\":checked\"))\n\t{\n\n\t\tintenseLogging(\"addPaymentAndActivate() - warning for less than \" + requiredMinimum + '' + minimumType);\n\n\t\tdd_message({\n\t\t\ttitle: 'Warning',\n\t\t\tmessage: underFilledMessage,\n\t\t\tconfirm: function () {\n\t\t\t\t// always first ensure that discounts are updated on server\n\t\t\t\tintenseLogging(\"addPaymentAndActivate() - confirm dialog\");\n\n\t\t\t\tlet message = \"You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?\";\n\t\t\t\tlet changesBlurb = getAbbreviatedSummaryString();\n\t\t\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Add Payment and Book Order',\n\t\t\t\t\tdiv_id: 'aPaBO',\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tmodal: true,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 460,\n\t\t\t\t\tconfirm: function () {\n\t\t\t\t\t\tvar discounts_are_valid = saveItems(true, true, true);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n\telse\n\t{\n\n\t\tintenseLogging(\"addPaymentAndActivate() - confirm dialog\");\n\n\t\tif (hasBundle)\n\t\t{\n\t\t\tlet bundleIsSelected = false;\n\t\t\tif ($('#selectedBundle').is(':checked'))\n\t\t\t{\n\t\t\t\tbundleIsSelected = true;\n\t\t\t}\n\n\t\t\tif (bundleIsSelected)\n\t\t\t{\n\n\t\t\t\tlet numBundItems = countSelectedBundleItems();\n\t\t\t\tif (numBundItems < intro_servings_required)\n\t\t\t\t{\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: 'Please select at least ' + intro_servings_required + ' servings of Meal Prep Starter Pack items.'\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse if (numBundItems > 18)\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: 'Please select no more than 18 servings of Meal Prep Starter Pack items.'\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (stationNeedsAttention)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Please review the Side Station and ensure the correct number of items are selected.'\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\t// always first ensure that discounts are updated on server\n\t\tlet message = \"You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?\";\n\t\tlet changesBlurb = getAbbreviatedSummaryString();\n\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\tdd_message({\n\t\t\ttitle: 'Add Payment and Book Order',\n\t\t\tmessage: message,\n\t\t\tmodal: true,\n\t\t\twidth: 400,\n\t\t\theight: 460,\n\t\t\tconfirm: function () {\n\t\t\t\tlet discounts_are_valid = saveItems(true, true, true);\n\t\t\t}\n\t\t});\n\n\t}\n\n\treturn true;\n}\n\nfunction save2PaymentsAndBookOrder(payment2Type, payment1Data, token)\n{\n\n\tintenseLogging(\"save2PaymentsAndBookOrder() called\");\n\n\tvar payment2Data = getPaymentData(payment2Type, 2);\n\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\n\t{\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\n\t\tif (!max_plate_points_deduction)\n\t\t{\n\t\t\tmax_plate_points_deduction = 0;\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'save_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tsession_id: session_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment1Data,\n\t\t\t\tadd_payment_data: payment2Data,\n\t\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() save_payment successful\");\n\n\t\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\telse if (payment2Type == \"CC\")\n\t{\n\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_2\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\n\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 2, json.warnOfOutstandingSavedOrdersOnFullSession, false, false, payment1Data);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction savePayment2(payment2Type, warnOfOutstandingSavedOrdersOnFullSession, token)\n{\n\n\tintenseLogging(\"savePayment2() called\");\n\n\tvar payment2Data = getPaymentData(payment2Type, 2);\n\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\n\t{\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'add_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment2Data,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"savePayment2() add_payment successful\");\n\n\t\t\t\t\tif (warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\telse if (payment2Type == \"CC\")\n\t{\n\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_2\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\n\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"savePayment2() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 2, warnOfOutstandingSavedOrdersOnFullSession, false, false);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction handleDirectPayment(addOnly, go_to_confirm, token)\n{\n\n\tintenseLogging(\"handleDirectPayment() called\");\n\n\tvar payment1Type = $(\"#payment1_type\").val();\n\tvar payment2Type = false;\n\n\tif (payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD')\n\t{\n\t\tpayment2Type = $(\"#payment2_type\").val();\n\t}\n\n\t// validation\n\tif (!validatePayment1(payment1Type))\n\t{\n\t\treturn false;\n\t}\n\n\t// validation\n\tif (payment2Type && payment2Type != \"\" && !validatePayment2(payment2Type))\n\t{\n\t\treturn false;\n\t}\n\n\tdisplayModalWaitDialog('paying_div', \"Sending Payment. Please wait ...\");\n\n\tvar payment1Data = getPaymentData(payment1Type, 1);\n\n\t// Handle Payment 1 for certain\n\t// Then handle Payment 2 unless it's a CC payment.\n\n\tvar DP_State = 0;\n\tif ($('#ref_payment1_is_store_specific_flat_rate_deposit_delayed0').length)\n\t{\n\t\tDP_State = $('input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\tif (DP_State == 1)\n\t\t{\n\t\t\tDP_State = 4;\n\t\t} // translate to CPayment constants - for now\n\t\tif (DP_State == 2)\n\t\t{\n\t\t\tDP_State = 5;\n\t\t}\n\n\t\tif (DP_State > 0)\n\t\t{\n\t\t\t// TODO: validate amounts\n\t\t}\n\t}\n\n\tvar use_store_credits = false;\n\tvar store_credit_amount = 0;\n\tif ($(\"#use_store_credits\").length)\n\t{\n\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t{\n\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\tuse_store_credits = true;\n\t\t}\n\t}\n\n\tvar mainPaymentData = null;\n\tvar additionalPaymentData = null;\n\n\tif (payment2Type)\n\t{\n\t\tmainPaymentData = getPaymentData(payment2Type, 2);\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t}\n\t\t}\n\t\tadditionalPaymentData = payment1Data;\n\t}\n\telse\n\t{\n\t\tmainPaymentData = payment1Data;\n\t}\n\n\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\n\tif (!max_plate_points_deduction)\n\t{\n\t\tmax_plate_points_deduction = 0;\n\t}\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 90000,\n\t\tasync: true,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: store_id,\n\t\t\top: 'save_payment',\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id,\n\t\t\tpayment_data: mainPaymentData,\n\t\t\tadd_payment_data: additionalPaymentData,\n\t\t\tdelay_remainder: DP_State,\n\t\t\tuse_store_credits: use_store_credits,\n\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\n\t\t\tstore_credits_amount: store_credit_amount,\n\t\t\tdd_csrf_token: token,\n\t\t\tpayment2Type: payment2Type\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"handleDirectPayment() save_payment successful\");\n\n\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t{\n\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tif (strError == 'timeout')\n\t\t\t{\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Order Processing Timed Out',\n\t\t\t\t\tmessage: \"The request to finalized the order has timed out. This may be due to network congestion. The order may have been successful. The page will refresh and show the actual current status.\",\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t'Refresh': function () {\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\tbounce(window.location.href);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction onAddPaymentAndActivate(addOnly, go_to_confirm, token)\n{\n\n\tintenseLogging(\"onAddPaymentAndActivate() called\");\n\n\tif (!supports_transparent_redirect)\n\t{\n\t\treturn handleDirectPayment(addOnly, go_to_confirm, token);\n\t}\n\n\tvar payment1Type = $(\"#payment1_type\").val();\n\tvar payment2Type = false;\n\n\tif (payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD')\n\t{\n\t\tpayment2Type = $(\"#payment2_type\").val();\n\t}\n\n\t// validation\n\tif (!validatePayment1(payment1Type))\n\t{\n\t\treturn false;\n\t}\n\n\t// validation\n\tif (payment2Type && payment2Type != \"\" && !validatePayment2(payment2Type))\n\t{\n\t\treturn false;\n\t}\n\n\tdisplayModalWaitDialog('paying_div', \"Sending Payment. Please wait ...\");\n\n\tvar payment1Data = getPaymentData(payment1Type, 1);\n\n\tif (payment2Type && payment2Type != \"\")\n\t{\n\t\tsave2PaymentsAndBookOrder(payment2Type, payment1Data, token);\n\t\treturn;\n\t}\n\n\tif (payment1Type != \"\" && payment1Type != \"CC\")\n\t{\n\t\t// Handle Payment 1 for certain\n\t\t// Then handle Payment 2 unless it's a CC payment.\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment1_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\tvar use_store_credits = false;\n\t\tvar store_credit_amount = 0;\n\t\tif ($(\"#use_store_credits\").length)\n\t\t{\n\t\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t\t{\n\t\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\t\tuse_store_credits = true;\n\t\t\t}\n\t\t}\n\n\t\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\n\t\tif (!max_plate_points_deduction)\n\t\t{\n\t\t\tmax_plate_points_deduction = 0;\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'save_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment1Data,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tuse_store_credits: use_store_credits,\n\t\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\n\t\t\t\tstore_credits_amount: store_credit_amount,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate() save_payment successful\");\n\n\t\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate save_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"onAddPaymentAndActivate save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t}\n\telse if (payment1Type != \"\" && payment1Type == \"CC\")\n\t{\n\t\t/*\n\n\t\t '#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t ' #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2, ' +\n\t\t ' #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t ' #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2'\n\t\t */\n\n\t\tvar billing_name = $(\"#payment1_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_1\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_1\").val();\n\t\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 1, false, addOnly, go_to_confirm, false);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"onAddPaymentAndActivate get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t});\n\t}\n}\n\nfunction RetrieveCalendar(timestamp)\n{\n\n\tintenseLogging(\"RetrieveCalendar() called\");\n\n\tvar op = 'retrieve';\n\tif (orderState != 'NEW')\n\t{\n\t\top = 'retrieve_for_reschedule';\n\t}\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'GET',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_calendarProcessor',\n\t\t\tstore_id: store_id,\n\t\t\taction: op,\n\t\t\tcur_session_id: session_id,\n\t\t\ttimestamp: timestamp\n\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"RetrieveCalendar() successful\");\n\n\t\t\t\t$(\"#calendar_holder\").html(json.data);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"RetrieveCalendar: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tintenseLogging(\"RetrieveCalendar: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onDayClick(obj)\n{\n}\n\nfunction doReschedule(id, sessionTime, transition_type)\n{\n\tvar curSessionDate = $(\"#curSessionDate\").html();\n\n\tdd_message({\n\t\ttitle: 'Reschedule',\n\t\tmessage: '<div style=\"text-align: center;\"><div>From</div><div style=\"font-weight: bold;\">' + curSessionDate + '</div><div>to</div><div style=\"font-weight: bold;\">' + sessionTime + '</div>'\n\t\t\t+ '<div style=\"margin-top:5px;\"><input type=\"checkbox\" name=\"reschedule_suppress_email\" id=\"reschedule_suppress_email\" />&nbsp;<label for=\"reschedule_suppress_email\">Suppress Sending Reschedule Email to Guest</label></div>',\n\t\tmodal: true,\n\t\tconfirm: function () {\n\t\t\tvar suppressEmail = false;\n\t\t\tif ($(\"#reschedule_suppress_email\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tsuppressEmail = true;\n\t\t\t}\n\n\t\t\tvar org_session_id = session_id;\n\t\t\tsession_id = id;\n\t\t\tReschedule(org_session_id, transition_type, suppressEmail);\n\n\t\t},\n\t\topen: function () {\n\n\t\t\t$(this).siblings('.ui-dialog-buttonpane').find(\"button:contains('Confirm')\").focus();\n\t\t}\n\n\t});\n\n}\n\nfunction onRescheduleClick(id, sessionTime, isDiscounted, control_message)\n{\n\tif (orderState != 'NEW')\n\t{\n\t\tif (control_message == \"locked\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"This order cannot be rescheduled as it is in the previous calendar month and that month has been locked and finalized.\"\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"MFY_to_Assembled\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Pick Up to an Assembly.</span><br /><br />The Service Fee will be removed. \" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"tononpreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"MFY_to_Assembled\");\n\t\t\t\t\t\t$(\"#tononpreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"Assembly_to_MFY\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Assembly to Pickup.</span><br /><br />The Service Fee will be applied. \" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"Assembly_to_MFY\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"MFY_to_HD\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Pick Up to Home Delivery.</span><br /><br />The Service Fee will be adjusted, the Delivery Fee will be added and a Delivery Address is now required.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments, Add the Delivery Address and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"MFY_to_HD\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"MFY_to_CPU\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Pick Up to Community Pick Up.</span><br />\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"MFY_to_CPU\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"CPU_to_MFY\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Community Pick Up to Pick Up.</span><br />\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"CPU_to_MFY\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"HD_to_Assembled\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Home Delivery to Assembly.</span><br /><br />The Delivery Fee, Service Fee, and Delivery Address will be removed.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"HD_to_Assembled\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"HD_to_MFY\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Home Delivery to Pick Up.</span><br /><br />The Delivery Fee will be removed. The Service Fee will be adjusted. The Delivery Address will be removed.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"HD_to_MFY\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"HD_to_CPU\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Home Delivery to Community Pick Up.</span><br /><br />The Delivery Address will be removed and the Delivery Fee and Service Fee may be adjusted.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"HD_to_CPU\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"CPU_to_Assembled\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Community Pick Up to Assembly.</span><br /><br />The Delivery Fee and Service Fee will be removed.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"CPU_to_Assembled\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"CPU_to_HD\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Community Pick Up to Home Delivery.</span><br /><br />The Delivery Fee and Service Fee may be adjusted. The Delivery Address is now required.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments, Add the Delivery Address and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"CPU_to_HD\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"Assembly_to_CPU\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Assembly to Community Pick Up.</span><br /><br />A Delivery Fee and Service Fee may be added.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"Assembly_to_CPU\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"Assembly_to_HD\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Assembly to Home Delivery.</span><br /><br />The Service and Delivery Fees will be added. The Delivery Address is now required.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments, Add the Delivery Address and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, \"Assembly_to_HD\");\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"MFY_to_WI\")\n\t\t{\n\t\t\tsessionTime = sessionTime.substring(0, sessionTime.indexOf(' - '));\n\t\t\tsessionTime = 'Walk-In on ' + sessionTime;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Pick Up to Walk-in.</span><br /><br /> \" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"Assembly_to_WI\")\n\t\t{\n\t\t\tsessionTime = sessionTime.substring(0, sessionTime.indexOf(' - '));\n\t\t\tsessionTime = 'Walk-In on ' + sessionTime;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Assembly to Walk-in.</span><br /><br /> \" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"HD_to_WI\")\n\t\t{\n\t\t\tsessionTime = sessionTime.substring(0, sessionTime.indexOf(' - '));\n\t\t\tsessionTime = 'Walk-In on ' + sessionTime;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Home Delivery to Walk-in.</span><br /><br />The Delivery Fee will be removed. The Service Fee will be adjusted. The Delivery Address will be removed.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"WI_to_Assembled\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Walk-in to Pickup.</span><br /><br />The Service Fee will be adjusted. \" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"WI_to_MFY\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Walk-in to Pick Up.</span><br /><br />The Service Fee will be adjusted. \" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"WI_to_CPU\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Walk-In to Community Pick Up.</span><br />\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"WI_to_HD\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"<br /><span style='font-weight:bold;'>You are rescheduling from Walk-in to Home Delivery.</span><br /><br />The Service Fee will be adjusted, the Delivery Fee will be added and a Delivery Address is now required.\" +\n\t\t\t\t\t\"<br /><br /><span style='color:red; font-weight:bold;'>After Rescheduling this Order, Please Review this Order, Adjust Payments, Add the Delivery Address and Finalize to complete the Reschedule.</span>\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tnoOk: true,\n\t\t\t\tbuttons: {\n\t\t\t\t\tContinue: function () {\n\t\t\t\t\t\tdoReschedule(id, sessionTime, control_message);\n\t\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t\t},\n\t\t\t\t\tCancel: function () {\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse if (control_message == \"none_wi\")\n\t\t{\n\t\t\tsessionTime = sessionTime.substring(0, sessionTime.indexOf(' - '));\n\t\t\tsessionTime = 'Walk-In on ' + sessionTime;\n\t\t\tdoReschedule(id, sessionTime, \"None\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdoReschedule(id, sessionTime, \"None\");\n\t\t}\n\t}\n}\n\nfunction onSessionClick(id, sessionTime, isDiscounted)\n{\n\tif (orderState == 'NEW')\n\t{\n\t\tsetSessionAndSave(id);\n\t}\n}\n\nfunction monthChange(monthVal)\n{\n\tRetrieveCalendar(monthVal);\n}\n\nfunction handle_delayed_payment()\n{\n\tif (GUEST_PREFERENCES[user_id].TC_DELAYED_PAYMENT_AGREE.value == 1)\n\t{\n\t\treturn;\n\t}\n\n\t$('#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t' #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2, ' +\n\t\t' #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t' #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2').on('click', function (e) {\n\n\t\tdd_message({\n\t\t\ttitle: lang.en.tc.terms_and_conditions,\n\t\t\tmessage: lang.en.tc.delayed_payment,\n\t\t\tmodal: true,\n\t\t\tnoOk: true,\n\t\t\tcloseOnEscape: false,\n\t\t\topen: function (event, ui) {\n\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t},\n\t\t\tbuttons: {\n\t\t\t\t'Agree': function () {\n\n\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t$('#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t\t\t\t\t' #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2, ' +\n\t\t\t\t\t\t' #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t\t\t\t\t' #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2').off('click');\n\n\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 1, user_id);\n\n\t\t\t\t},\n\t\t\t\t'Decline': function () {\n\n\t\t\t\t\t$('#payment1_is_store_specific_flat_rate_deposit_delayed_payment0, #payment2_is_store_specific_flat_rate_deposit_delayed_payment0, ' +\n\t\t\t\t\t\t'#ref_payment1_is_store_specific_flat_rate_deposit_delayed0, #ref_payment2_is_store_specific_flat_rate_deposit_delayed0').trigger('click');\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\n\t\t\t\t\t\tmessage: lang.en.tc.delayed_payment_decline\n\t\t\t\t\t});\n\n\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 0, user_id);\n\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t});\n}\n\nfunction createBonusCredit(creditConsumed)\n{\n\tisFactoringCredit = true;\n\tcurrentCreditAvailable = creditBasis * 0.10;\n\n\tif (creditConsumed > currentCreditAvailable)\n\t{\n\t\tcreditConsumed = currentCreditAvailable;\n\t\tcurrentCreditAvailable = 0;\n\t}\n\telse\n\t{\n\t\tcurrentCreditAvailable -= creditConsumed;\n\n\t}\n\n\t$('#couponValue').val(creditConsumed);\n\t$(\"#OEH_bonus_credit\").html(\" ( Bonus Credit: \" + formatAsMoney(currentCreditAvailable) + \" )\");\n}\n\nfunction removeBonusCredit()\n{\n\tisFactoringCredit = false;\n\t$(\"#OEH_bonus_credit\").html(\"\");\n}\n\nfunction handleSummaryDisplayChange(obj)\n{\n\tif (obj.checked)\n\t{\n\t\tShowAllLineItems();\n\t}\n\telse\n\t{\n\t\tHideLineItemsIfZero();\n\t}\n}\n\nfunction HideLineItemsIfZero()\n{\n\tvar bagFeeOrg = Number($('#OEH_subtotal_bag_fee_org').html());\n\tvar bagFee = Number($('#OEH_subtotal_bag_fee').html());\n\n\tif (bagFeeOrg == 0 && bagFee == 0)\n\t{\n\t\t$('#BagFeeRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#BagFeeRow').show();\n\t}\n\n\tvar bagFeeTaxOrg = Number($('#OEH_bag_fee_tax_subtotal_org').html());\n\tvar bagFeeTax = Number($('#OEH_bag_fee_tax_subtotal').html());\n\n\tif (bagFeeTaxOrg == 0 && bagFeeTax == 0)\n\t{\n\t\t$('#BagFeeTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#BagFeeTaxRow').show();\n\t}\n\n\tvar serviceFeeOrg = Number($('#OEH_subtotal_service_fee_org').html());\n\tvar serviceFee = Number($('#OEH_subtotal_service_fee').html());\n\n\tif (serviceFeeOrg == 0 && serviceFee == 0)\n\t{\n\t\t$('#ServiceFeeRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#ServiceFeeRow').show();\n\t}\n\n\tvar deliveryFeeOrg = Number($('#OEH_subtotal_delivery_fee_org').html());\n\tvar deliveryFee = Number($('#OEH_subtotal_delivery_fee').html());\n\n\tif (deliveryFeeOrg == 0 && deliveryFee == 0)\n\t{\n\t\t$('#DeliveryFeeRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#DeliveryFeeRow').show();\n\t}\n\n\tvar serviceTaxOrg = Number($('#OEH_service_tax_subtotal_org').html());\n\tvar serviceTax = Number($('#OEH_service_tax_subtotal').html());\n\n\tif (serviceTaxOrg == 0 && serviceTax == 0)\n\t{\n\t\t$('#ServiceTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#ServiceTaxRow').show();\n\t}\n\n\tvar miscFoodOrg = Number($('#OEH_misc_food_subtotal_org').html());\n\tvar miscFood = Number($('#OEH_misc_food_subtotal').html());\n\n\tif (miscFoodOrg == 0 && miscFood == 0)\n\t{\n\t\t$('#miscFoodRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#miscFoodRow').show();\n\t}\n\n\tvar miscNonFoodOrg = Number($('#OEH_misc_nonfood_subtotal_org').html());\n\tvar miscNonFood = Number($('#OEH_misc_nonfood_subtotal').html());\n\n\tif (miscNonFoodOrg == 0 && miscNonFood == 0)\n\t{\n\t\t$('#miscNonFoodRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#miscNonFoodRow').show();\n\t}\n\n\tvar miscMealCustomizationFeeOrg = Number($('#OEH_subtotal_meal_customization_fee').html());\n\tvar miscMealCustomizationFee = Number($('#OEH_subtotal_meal_customization_fee_org').html());\n\n\tif (miscMealCustomizationFeeOrg == 0 && miscMealCustomizationFee == 0)\n\t{\n\t\t$('#MealCustomizationFeeRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#MealCustomizationFeeRow').show();\n\t}\n\n\n\tvar doDiscountOrg = Number($('#OEH_direct_order_discount_org').html());\n\tvar doDiscount = Number($('#OEH_direct_order_discount').html());\n\n\tif (doDiscountOrg == 0 && doDiscount == 0)\n\t{\n\t\t$('#directDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#directDiscountRow').show();\n\t}\n\n\tvar couponDiscountOrg = Number($('#OEH_coupon_discount_org').html());\n\tvar couponDiscount = Number($('#OEH_coupon_discount').html());\n\n\tif (couponDiscountOrg == 0 && couponDiscount == 0)\n\t{\n\t\t$('#couponDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#couponDiscountRow').show();\n\t}\n\n\tvar platePointsDiscountOrg = Number($('#OEH_plate_points_discount_org_food').html());\n\tvar platePointsDiscount = Number($('#OEH_plate_points_order_discount_food').html());\n\n\tif (platePointsDiscountOrg == 0 && platePointsDiscount == 0)\n\t{\n\t\t$('#platePointsDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#platePointsDiscountRow').show();\n\t}\n\n\tvar referralRewardDiscountOrg = Number($('#OEH_referral_reward_order_discount_orig').html());\n\tvar referralRewardDiscount = Number($('#OEH_referral_reward_order_discount').html());\n\n\tif (referralRewardDiscountOrg == 0 && referralRewardDiscount == 0)\n\t{\n\t\t$('#referralRewardDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#referralRewardDiscountRow').show();\n\t}\n\n\tvar platePointsDiscountOrg = Number($('#OEH_plate_points_discount_org_fee').html());\n\tvar platePointsDiscount = Number($('#OEH_plate_points_order_discount_fee').html());\n\n\tif (platePointsDiscountOrg == 0 && platePointsDiscount == 0)\n\t{\n\t\t$('#platePointsFeeDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#platePointsFeeDiscountRow').show();\n\t}\n\n\tvar membershipDiscountOrg = Number($('#OEH_membership_discount_org').html());\n\tvar membershipDiscount = Number($('#OEH_membership_discount').html());\n\n\tif (membershipDiscountOrg == 0 && membershipDiscount == 0)\n\t{\n\t\t$('#membershipDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#membershipDiscountRow').show();\n\t}\n\n\tvar sessionDiscountOrg = Number($('#OEH_session_discount').html());\n\n\tif (sessionDiscountOrg == 0)\n\t{\n\t\t$('#sessionDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#sessionDiscountRow').show();\n\t}\n\n\tvar pudDiscount = Number($('#OEH_preferred').html());\n\n\tif (pudDiscount == 0)\n\t{\n\t\t$('#preferredUserDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#preferredUserDiscountRow').show();\n\t}\n\n\tvar foodTaxOrg = Number($('#OEH_food_tax_subtotal_org').html());\n\tvar foodTax = Number($('#OEH_food_tax_subtotal').html());\n\n\tif (foodTaxOrg == 0 && foodTax == 0)\n\t{\n\t\t$('#foodTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#foodTaxRow').show();\n\t}\n\n\tvar nonFoodTaxOrg = Number($('#OEH_tax_subtotal_org').html());\n\tvar nonFoodTax = Number($('#OEH_tax_subtotal').html());\n\n\tif (nonFoodTaxOrg == 0 && nonFoodTax == 0)\n\t{\n\t\t$('#nonFoodTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#nonFoodTaxRow').show();\n\t}\n\n\tlet deliveryTaxOrg = Number($('#OEH_delivery_tax_subtotal_org').html());\n\tlet deliveryTax = Number($('#OEH_delivery_tax_subtotal').html());\n\n\tif (deliveryTaxOrg == 0 && deliveryTax == 0)\n\t{\n\t\t$('#DeliveryTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#DeliveryTaxRow').show();\n\t}\n\n\tlet productsSubtotalOrg = Number($('#OEH_products_subtotal_org').html());\n\tlet productsSubtotal = Number($('#OEH_products_subtotal').html());\n\n\tif (productsSubtotalOrg == 0 && productsSubtotal == 0)\n\t{\n\t\t$('#productSubtotalRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#productSubtotalRow').show();\n\t}\n\n\tif (!$('#add_ltd_round_up').is(':checked'))\n\t{\n\t\t$('#LTDRoundUpRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#LTDRoundUpRow').show();\n\t}\n}\n\nfunction ShowAllLineItems()\n{\n\t$('#ServiceFeeRow').show();\n\t$('#DeliveryFeeRow').show();\n\t$('#ServiceTaxRow').show();\n\t$('#miscFoodRow').show();\n\t$('#miscNonFoodRow').show();\n\t$('#directDiscountRow').show();\n\t$('#couponDiscountRow').show();\n\t$('#foodTaxRow').show();\n\t$('#nonFoodTaxRow').show();\n\t$('#productSubtotalRow').show();\n\t$('#platePointsDiscountRow').show();\n\t$('#referralRewardDiscountRow').show();\n\t$('#preferredUserDiscountRow').show();\n\t$('#sessionDiscountRow').show();\n\t$('#LTDRoundUpRow').show();\n\t$('#MealCustomizationFeeRow').show();\n\t$('#BagFeeRow').show();\n}\n\nfunction sort_by_price(a, b)\n{\n\tif (a.price == b.price)\n\t{\n\t\treturn 0;\n\t}\n\n\treturn (a.price < b.price) ? 1 : -1;\n}\n\nfunction drawChangeList()\n{\n\tvar html = getChangeListHTML();\n\t$(\"#changelist\").html(html);\n\n}\n\nfunction getChangeListHTML()\n{\n\n\tlet htmlStr = \"\";\n\tlet first = true;\n\n\tfor (let item in changeList.stdMenuItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Standard Items <span id='changed-item-count'> - \" + localStorage.getItem('core-item-count') + \" total</span></h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.stdMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tlet title = $(\"#qty_\" + item).data(\"item_title\");\n\n\t\t\tlet pricing_type = translateServingSize($(\"#qty_\" + item).data(\"servings\"));\n\n\t\t\tpricing_type = \"(\" + pricing_type + \")\";\n\n\t\t\tif (changeList.stdMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.stdMenuItems[item] + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.stdMenuItems[item] * -1 + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\n\tlet indexedItems = [];\n\tfor (let item in changeList.FTMenuItems)\n\t{\n\t\tif (changeList.FTMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tvar index = $(\"#qty_\" + item).data(\"index\");\n\t\t\tindexedItems[index] = item;\n\n\t\t}\n\t}\n\n\tfor (let key in indexedItems)\n\t{\n\t\tlet item = indexedItems[key];\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Sides <span id='changed-sides-count'> - \" + localStorage.getItem('side-item-count') + \" total</span></h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.FTMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tlet title = $(\"#qty_\" + item).data(\"item_title\");\n\n\t\t\tif (changeList.FTMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.FTMenuItems[item] + \" <i>\" + title + \"</i>\";\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.FTMenuItems[item] * -1 + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tlet hadMiscCostChanges = false;\n\tfor (let item in changeList.miscCosts)\n\t{\n\t\thadMiscCostChanges = true;\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tfor (let item in changeList.sideBundleItem)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Sides Bundle Item List</h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.sideBundleItem.hasOwnProperty(item))\n\t\t{\n\t\t\tlet title = $(\"#sbi_\" + item).data(\"item_title\");\n\n\t\t\tif (changeList.sideBundleItem[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.sideBundleItem[item] + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.sideBundleItem[item] * -1 + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tfor (let item in changeList.miscDescs)\n\t{\n\t\tif (!hadMiscCostChanges && first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\n\t\t{\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\n\t\t}\n\t}\n\n\tif (changeList.order_type != \"\")\n\t{\n\t\thtmlStr += \"<h3>Order changed \" + changeList.order_type + \"</h3>\";\n\t}\n\n\tfirst = true;\n\tfor (let item in changeList.bundleItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\tif (isDreamTaste)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Meal Prep Workshop Items List</h3><ul style='margin: 4px;'>\";\n\n\t\t\t}\n\t\t\telse if (isFundraiser)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Fundraiser Event Items List</h3><ul style='margin: 4px;'>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Intro Items List</h3><ul style='margin: 4px;'>\";\n\t\t\t}\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.bundleItems.hasOwnProperty(item))\n\t\t{\n\n\t\t\tlet title = $(\"#bnd_\" + item).data(\"item_title\");\n\t\t\tlet pricing_type = \"(\" + $(\"#bnd_\" + item).data(\"servings\") + \" Serving)\";\n\n\t\t\tif (changeList.bundleItems[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.bundleItems[item] + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.bundleItems[item] * -1 + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tfor (let item in changeList.discounts)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.discounts.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfirst = true;\n\tfor (let item in changeList.reporting)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Reporting</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.reporting.hasOwnProperty(item))\n\t\t{\n\t\t\tif (item == 'fundraiser')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse if (changeList.reporting[item][\"orgVal\"] > 0 && changeList.reporting[item][\"orgVal\"] != changeList.reporting[item][\"newVal\"])\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Changed \" + getHumanReadableName(item) + \" to \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (item == 'fundraiser_value')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item == 'ltd_roundup')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == false)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + ' was removed from the order.'\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + ' was added to the order.'\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item == 'ltd_roundup_value')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (changeList.coupon)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.coupon.change_type == 'added')\n\t\t{\n\t\t\thtmlStr += \"Added coupon code: \" + changeList.coupon.code + \"<br />\";\n\t\t}\n\t\telse if (changeList.coupon.change_type == 'removed')\n\t\t{\n\t\t\thtmlStr += \"Removed coupon code: \" + changeList.coupon.code + \"<br />\";\n\t\t}\n\t\telse if (changeList.coupon.change_type == 'added')\n\t\t{\n\t\t\thtmlStr += \"Change coupon code to: \" + changeList.coupon.code + \"<br />\";\n\t\t}\n\t}\n\n\tif (changeList.bagFee['Bag Count'])\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Bag Fee</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"Updated Bag Count: Was \" + changeList.bagFee['Bag Count']['orgVal'] + \" bags. Updated to \" + changeList.bagFee['Bag Count']['newVal'] + \" bags<br />\";\n\t}\n\n\tif (changeList.mealCustomizationFee['Meal Customization Fee'] != null)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Meal Customization Fee</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"Meal Customization Fee: Was $\" + changeList.mealCustomizationFee['Meal Customization Fee']['orgVal'] + \". Updated to $\" + changeList.mealCustomizationFee['Meal Customization Fee']['newVal'] + \"<br />\";\n\t}\n\n\tif (typeof changeList.mealCustomizationFee['Meal Customization Selection'] != 'undefined' && typeof changeList.mealCustomizationFee['Meal Customization Selection']['newVal'] != 'undefined' && changeList.mealCustomizationFee['Meal Customization Selection']['newVal'] != null)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Meal Customization Selection</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tlet previous = changeList.mealCustomizationFee['Meal Customization Selection']['orgVal'] == 1 ? \" not selected\" : \" selected\";\n\t\tlet newVal = changeList.mealCustomizationFee['Meal Customization Selection']['newVal'] == \"on\" ? \" selected\" : \" not selected\";\n\n\n\t\thtmlStr += \"Meal Customization was\" + previous + \". Updated to \" + newVal+ \".<br />\";\n\t}\n\n\n\n\tif (changeList.mealCustomizationFee['Meal Customization'] != null)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Meal Customization</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tfor (let key in changeList.mealCustomizationFee['Meal Customization'])\n\t\t{\n\t\t\tif(typeof changeList.mealCustomizationFee['Meal Customization'][key] !== 'undefined' && typeof changeList.mealCustomizationFee['Meal Customization'][key]['name'] !== 'undefined')\n\t\t\t{\n\t\t\t\tif(changeList.mealCustomizationFee['Meal Customization'][key]['newVal'].toUpperCase() == 'OPTED IN')\n\t\t\t\t{\n\t\t\t\t\thtmlStr += changeList.mealCustomizationFee['Meal Customization'][key]['newVal'] + \" to \"+changeList.mealCustomizationFee['Meal Customization'][key]['name'] +\"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += changeList.mealCustomizationFee['Meal Customization'][key]['newVal'] + \" of \"+changeList.mealCustomizationFee['Meal Customization'][key]['name'] +\"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\n\t{\n\t\thtmlStr += \"<h3>Payments</h3>\";\n\n\t\tlet payment1Type = $('#payment1_type').val();\n\n\t\tif (payment1Type != '')\n\t\t{\n\t\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').is(\":visible\");\n\t\t\t{\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\n\t\t\t\t}\n\n\t\t\t\tlet ccRefundTotal = 0;\n\t\t\t\t$(\"[id^='Cr_RT_']\").each(function () {\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\n\t\t\t\t});\n\n\t\t\t\tif (ccRefundTotal > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment2_type').val() != \"\")\n\t\t{\n\t\t\tlet payment2Type = $('#payment2_type').val();\n\t\t\tif (payment2Type && payment2Type != \"\")\n\t\t\t{\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\n\t\t\t}\n\t\t}\n\n\t\tif ($('#use_store_credit').is(':checked'))\n\t\t{\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\n\t\t}\n\t}\n\treturn htmlStr;\n}\n\nfunction translateServingSize(servings)\n{\n\tvar result = '';\n\tswitch (servings)\n\t{\n\t\tcase 6:\n\t\t\tresult = 'Large - ' + servings + '';\n\t\t\tbreak;\n\t\tcase 3:\n\t\tcase 4:\n\t\t\tresult = 'Medium - ' + servings + '';\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tresult = 'Small - ' + servings + '';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tresult = servings;\n\t}\n\n\treturn result;\n\n}\n\nfunction getHumanReadableName(id)\n{\n\tswitch (id)\n\t{\n\t\tcase 'direct_order_discount':\n\t\t\treturn \"Direct Order Discount\";\n\t\tcase 'plate_points_discount':\n\t\t\treturn \"Dinner Dollars\";\n\t\tcase \"misc_food_subtotal\":\n\t\t\treturn \"Miscellaneous Food Cost\";\n\t\tcase \"misc_nonfood_subtotal\":\n\t\t\treturn \"Miscellaneous Non-food Cost\";\n\t\tcase \"subtotal_service_fee\":\n\t\t\treturn \"Service Fee\";\n\t\tcase \"subtotal_delivery_fee\":\n\t\t\treturn \"Delivery Fee\";\n\t\tcase 'misc_food_subtotal_desc':\n\t\t\treturn 'Misc Food Description';\n\t\tcase 'misc_nonfood_subtotal_desc':\n\t\t\treturn 'Misc Non-food Description';\n\t\tcase 'service_fee_description':\n\t\t\treturn 'Service Fee Description';\n\t\tcase 'session_discount':\n\t\t\treturn 'Session Discount';\n\t\tcase 'fundraiser':\n\t\t\treturn 'Fundraiser';\n\t\tcase 'fundraiser_value':\n\t\t\treturn 'Fundraiser Value';\n\t\tcase 'ltd_roundup_value':\n\t\t\treturn 'Dream Dinners Foundation Round Up Value';\n\t\tcase 'ltd_roundup':\n\t\t\treturn 'Dream Dinners Foundation Round Up';\n\t\tdefault:\n\t\t\treturn 'error';\n\t}\n}\n\nfunction getAbbreviatedSummaryString()\n{\n\tvar htmlStr = \"\";\n\n\tvar bundleChecked = $('#selectedBundle').is(':checked');\n\n\tif (isDreamTaste)\n\t{\n\t\thtmlStr += \"<h3>Meal Prep Workshop Order</h3>\";\n\t}\n\telse if (isFundraiser)\n\t{\n\t\thtmlStr += \"<h3>Fundraiser Order</h3>\";\n\t}\n\telse if (bundleChecked)\n\t{\n\t\thtmlStr += \"<h3>Starter Pack Order</h3>\";\n\t}\n\telse\n\t{\n\t\thtmlStr += \"<h3>Standard Order</h3>\";\n\t}\n\n\tvar stdItemCount = 0;\n\tvar FTItemCount = 0;\n\t// Items\n\t$(\"[id^='qty_']\").each(function () {\n\t\tif ($(this).val() > 0)\n\t\t{\n\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t{\n\t\t\t\tFTItemCount += ($(this).val() * 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstdItemCount += ($(this).val() * 1);\n\t\t\t}\n\t\t}\n\t});\n\n\tif (stdItemCount > 0)\n\t{\n\t\thtmlStr += stdItemCount + \" Standard Items Selected.<br />\"\n\t}\n\tif (FTItemCount > 0)\n\t{\n\t\thtmlStr += FTItemCount + \" Sides &amp; Sweets Items Selected.<br />\"\n\t}\n\n\t$(\"[data-dd_type='item_field']\").each(function () {\n\t\tvar curVal = $(this).val();\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\n\t\t\tif (curVal > 0)\n\t\t\t{\n\t\t\t\thtmlStr += getHumanReadableName(this.id) + \" costs of $\" + formatAsMoney(curVal);\n\n\t\t\t\tvar descIDStr = \"\";\n\n\t\t\t\tswitch (this.id)\n\t\t\t\t{\n\t\t\t\t\tcase \"misc_food_subtotal\":\n\t\t\t\t\t\tdescIDStr = \"misc_food_subtotal_desc\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"misc_nonfood_subtotal\":\n\t\t\t\t\t\tdescIDStr = \"misc_nonfood_subtotal_desc\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"subtotal_service_fee\":\n\t\t\t\t\t\tdescIDStr = \"service_fee_description\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar desc = null;\n\t\t\t\tif (descIDStr != \"\")\n\t\t\t\t{\n\t\t\t\t\tdesc = $(\"#\" + descIDStr).val();\n\t\t\t\t}\n\n\t\t\t\tif (desc)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \". <span>( \" + desc + \" )</span><br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \".<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tvar bundleChecked = $('#selectedBundle').is(':checked');\n\tvar bundleOrgVal = $('#selectedBundle').data('org_value');\n\n\tvar bundleItems = 0;\n\t$(\"[id^='bnd_']\").each(function () {\n\n\t\tif ($(this).is(\":checked\"))\n\t\t{\n\t\t\tbundleItems++;\n\t\t}\n\t});\n\n\tif (bundleItems > 0)\n\t{\n\t\thtmlStr += bundleItems + \" Intro Items Selected.<br />\"\n\t}\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\tvar bundleItems = 0;\n\t\t$(\"[id^='bnd_']\").each(function () {\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tbundleItems += ($(this).val() * 1);\n\t\t\t}\n\t\t});\n\n\t\tif (bundleItems > 0)\n\t\t{\n\t\t\thtmlStr += bundleItems + \" Items Selected.<br />\"\n\t\t}\n\t}\n\n\t// Discounts\n\n\tvar discountsHTML = \"\";\n\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\n\n\t\tvar curVal = $(this).val();\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() > 0)\n\t\t{\n\t\t\tdiscountsHTML += getHumanReadableName(this.id) + \" applied.<br />\";\n\t\t}\n\t});\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\n\t\tvar newSDValue = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\n\t\tif (newSDValue && newSDValue != \"noSD\")\n\t\t{\n\t\t\tdiscountsHTML += \"Session discount is applied.<br />\";\n\t\t}\n\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tvar newPUDValue = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\n\t\tif (newPUDValue && newPUDValue != \"noUP\")\n\t\t{\n\t\t\tdiscountsHTML += \"Preferred User Discount is applied.<br />\";\n\t\t}\n\t}\n\n\tif (discountsHTML != \"\")\n\t{\n\t\thtmlStr += \"<h3>Discounts</h3>\" + discountsHTML;\n\t}\n\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\n\t{\n\t\thtmlStr += \"<h3>Payments</h3>\";\n\n\t\tvar payment1Type = $('#payment1_type').val();\n\n\t\tif (payment1Type != '')\n\t\t{\n\t\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').is(\":visible\");\n\t\t\t{\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\n\t\t\t\t}\n\n\t\t\t\tvar ccRefundTotal = 0;\n\t\t\t\t$(\"[id^='Cr_RT_']\").each(function () {\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\n\t\t\t\t});\n\n\t\t\t\tif (ccRefundTotal > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment1_type').val() != \"\")\n\t\t{\n\t\t\tvar payment2Type = $('#payment2_type').val();\n\t\t\tif (payment2Type && payment2Type != \"\")\n\t\t\t{\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\n\t\t\t}\n\t\t}\n\n\t\tif (changeList.bagFee['Bag Count'])\n\t\t{\n\t\t\thtmlStr += \"Bag Count set to \" + changeList.bagFee['Bag Count']['newVal'] + \" bags<br />\";\n\t\t}\n\n\t\tif ($('#use_store_credit').is(':checked'))\n\t\t{\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\n\t\t}\n\n\t}\n\n\treturn htmlStr;\n}\n\nfunction updateChangeList()\n{\n\n\titemChanges = false;\n\tdiscountChanges = false;\n\treportingChanges = false;\n\tfeeChanges = false;\n\n\tdiscountOrPaymentChanges = false;\n\tlet showSaveButton = false;\n\n\tchangeList = {};\n\tchangeList.stdMenuItems = {};\n\tchangeList.FTMenuItems = {};\n\tchangeList.miscCosts = {};\n\tchangeList.miscDescs = {};\n\tchangeList.bundleItems = {};\n\tchangeList.order_type = \"\";\n\tchangeList.discounts = {};\n\tchangeList.reporting = {};\n\tchangeList.delivery = {};\n\tchangeList.bagFee = {};\n\tchangeList.mealCustomizationFee = {'Meal Customization':null,'Meal Customization Fee':null};\n\n\n\tchangeList.sideBundleItem = {};\n\n\t// Items\n\t$(\"[id^='qty_']\").each(function () {\n\t\tif ($(this).val() != $(this).data('org_value'))\n\t\t{\n\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t{\n\t\t\t\tchangeList.FTMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.stdMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t}\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t// bundle items\n\t$(\"[name^='sbi_']\").each(function () {\n\t\tif ($(this).val() != $(this).data('lastqty'))\n\t\t{\n\t\t\tchangeList.sideBundleItem[$(this).attr('id').split(\"_\")[1]] = $(this).val() - $(this).data('lastqty');\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t// Misc Costs\n\t$(\"[data-dd_type='item_field']\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\t$(this).addClass('unsaved_data');\n\n\t\t\tif ($(this).data(\"number\") == true)\n\t\t\t{\n\t\t\t\t// we're not tracking description fields for now\n\t\t\t\tchangeList.miscCosts[this.id] = {\n\t\t\t\t\tnewVal: $(this).val(),\n\t\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t\t};\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.miscDescs[this.id] = 1;\n\t\t\t}\n\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\tvar bundleChecked = $('#selectedBundle').is(':checked');\n\tvar bundleOrgVal = $('#selectedBundle').data('org_value');\n\n\tif (bundleChecked)\n\t{\n\t\tif (bundleOrgVal == \"0\")\n\t\t{\n\t\t\t$('#bundle_header_div').addClass('unsaved_data_cb');\n\t\t\tchangeList.order_type = \"to Intro\";\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#bundle_header_div').removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\telse\n\t{\n\t\tif (bundleOrgVal == \"1\")\n\t\t{\n\t\t\t$('#bundle_header_div').addClass('unsaved_data_cb');\n\t\t\tchangeList.order_type = \"to Standard\";\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#bundle_header_div').removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\n\t\t$(\"[id^='bnd_']\").each(function () {\n\n\t\t\tif ($(this).val() != $(this).data('org_value'))\n\t\t\t{\n\t\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t\t{\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t\t}\n\n\t\t\t\t$(this).addClass('unsaved_data');\n\t\t\t\titemChanges = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(this).removeClass('unsaved_data');\n\t\t\t}\n\t\t});\n\n\t}\n\telse\n\t{\n\n\t\t$(\"[id^='bnd_']\").each(function () {\n\n\t\t\tif ($(this).is(\":checked\"))\n\t\t\t{\n\t\t\t\tif ($(this).data('org_value') == \"0\")\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().addClass('unsaved_data_cb');\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = 1;\n\t\t\t\t\titemChanges = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().removeClass('unsaved_data_cb');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ($(this).data('org_value') == \"1\")\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().addClass('unsaved_data_cb');\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = -1;\n\t\t\t\t\titemChanges = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().removeClass('unsaved_data_cb');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\t// bag fees\n\tif ($(\"#total_bag_count\").length)\n\t{\n\t\tif ($(\"#total_bag_count\").val() != $(\"#total_bag_count\").data(\"org_value\"))\n\t\t{\n\t\t\tchangeList.bagFee['Bag Count'] = {\n\t\t\t\tnewVal: $(\"#total_bag_count\").val(),\n\t\t\t\torgVal: $(\"#total_bag_count\").data(\"org_value\")\n\t\t\t}\n\t\t\tfeeChanges = true;\n\t\t\t$(\"#total_bag_count\").addClass('unsaved_data');\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#total_bag_count\").removeClass('unsaved_data');\n\t\t}\n\n\t}\n\n\t// meal customization fees\n\tif ($(\"#subtotal_meal_customization_fee\").length)\n\t{\n\t\tif($(\"#subtotal_meal_customization_fee\").val() == ''){\n\t\t\t$(\"#subtotal_meal_customization_fee\").val('0.00');\n\t\t}\n\t\tif ($(\"#subtotal_meal_customization_fee\").val() != $(\"#subtotal_meal_customization_fee\").data(\"org_value\"))\n\t\t{\n\t\t\tchangeList.mealCustomizationFee['Meal Customization Fee'] = {\n\t\t\t\tnewVal: $(\"#subtotal_meal_customization_fee\").val(),\n\t\t\t\torgVal: $(\"#subtotal_meal_customization_fee\").data(\"org_value\")\n\t\t\t}\n\t\t\tfeeChanges = true;\n\t\t\t$(\"#subtotal_meal_customization_fee\").addClass('unsaved_data');\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#subtotal_meal_customization_fee\").removeClass('unsaved_data');\n\t\t}\n\t}\n\n\tlet customizationSelection = $(\"#opted_to_customize_recipes\").is(\":checked\")  ? '1':'0';\n\tlet origCustomizationSelection = (typeof $(\"#opted_to_customize_recipes\").data(\"org_value\") == 'undefined' || $(\"#opted_to_customize_recipes\").data(\"org_value\") == '' || $(\"#opted_to_customize_recipes\").data(\"org_value\") == '0') ? '0':'1';\n\tif( origCustomizationSelection != customizationSelection){\n\t\tchangeList.mealCustomizationFee['Meal Customization Selection'] = {\n\t\t\tnewVal: $(\"#opted_to_customize_recipes\").val(),\n\t\t\torgVal: $(\"#opted_to_customize_recipes\").data(\"org_value\")\n\t\t}\n\t\tfeeChanges = true;\n\t\t$(\"#opted_to_customize_recipes\").addClass('unsaved_data');\n\t}\n\n\t$(\"[data-dd_type='fee_field']\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\t$(this).addClass('unsaved_data');\n\n\t\t\tif ($(this).data(\"number\") == true)\n\t\t\t{\n\t\t\t\t// we're not tracking description fields for now\n\t\t\t\tchangeList.miscCosts[this.id] = {\n\t\t\t\t\tnewVal: $(this).val(),\n\t\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t\t};\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.miscDescs[this.id] = 1;\n\t\t\t}\n\n\t\t\tfeeChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t$(\"[data-dd_type='customization_fee_toggle']\").each(function () {\n\t\tvar curVal = $(this).is(\":checked\") ? 'Opted in' : 'Opted out';\n\t\tvar orgVal = $(this).data('org_value');\n\t\tvar name = $(this).data('name');\n\n\n\t\tif (curVal.toLowerCase() != orgVal.toLowerCase() )\n\t\t{\n\t\t\t//$(this).addClass('unsaved_data');\n\t\t\tif( changeList.mealCustomizationFee['Meal Customization'] == null){\n\t\t\t\tchangeList.mealCustomizationFee['Meal Customization'] = [];\n\t\t\t}\n\n\n\t\t\tchangeList.mealCustomizationFee['Meal Customization'][this.id] = {\n\t\t\t\tname : name,\n\t\t\t\tnewVal: curVal,\n\t\t\t\torgVal: orgVal\n\t\t\t}\n\n\t\t\t//feeChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif( changeList.mealCustomizationFee['Meal Customization'] != null)\n\t\t\t{\n\t\t\t\tchangeList.mealCustomizationFee['Meal Customization'][this.id] = '';\n\t\t\t}\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t$(\"[data-dd_type='customization_fee_detail']\").each(function () {\n\t\tlet curVal = $.trim($(this).val());\n\t\tlet orgVal = $(this).data('org_value');\n\t\tlet name = $(this).data('name');\n\n\t\tlet key = this.id + 'detail';\n\n\t\tif (curVal.toLowerCase() != orgVal.toLowerCase() )\n\t\t{\n\t\t\tif( changeList.mealCustomizationFee['Meal Customization'] == null){\n\t\t\t\tchangeList.mealCustomizationFee['Meal Customization'] = [];\n\t\t\t}\n\n\n\t\t\tchangeList.mealCustomizationFee['Meal Customization'][key] = {\n\t\t\t\tname : name,\n\t\t\t\tnewVal: curVal,\n\t\t\t\torgVal: orgVal\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif( changeList.mealCustomizationFee['Meal Customization'] != null)\n\t\t\t{\n\t\t\t\tchangeList.mealCustomizationFee['Meal Customization'][key] = '';\n\t\t\t}\n\t\t}\n\t});\n\n\n\tif (feeChanges)\n\t{\n\t\t$(\"#fees_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#fees_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\tif (itemChanges)\n\t{\n\t\t$(\"#items_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#items_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\t// Reporting Fundraising\n\t$(\"#fundraiser_id\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\tchangeList.reporting['fundraiser'] = {\n\t\t\t\tnewVal: $(this).val(),\n\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\ttitle: $(this).find(':selected').text()\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\treportingChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t$(\"#fundraiser_value\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\tchangeList.reporting['fundraiser_value'] = {\n\t\t\t\tnewVal: curVal,\n\t\t\t\torgVal: orgVal,\n\t\t\t\tdiff: curVal - orgVal\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\treportingChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t// Reporting, LTD Roundup\n\t$(\"#add_ltd_round_up\").each(function () {\n\t\tvar curVal = false;\n\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\tcurVal = true;\n\t\t}\n\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif (curVal != orgVal)\n\t\t{\n\t\t\tchangeList.reporting['ltd_roundup'] = {\n\t\t\t\tnewVal: curVal,\n\t\t\t\torgVal: orgVal\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\treportingChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t$(\"#ltd_round_up_select\").each(function () {\n\t\tif (!$(\"#add_ltd_round_up\").is(':checked'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal).toFixed(2);\n\t\t\torgVal = parseFloat(orgVal).toFixed(2);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\tchangeList.reporting['ltd_roundup_value'] = {\n\t\t\t\tnewVal: $(this).val(),\n\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\tdiff: curVal - orgVal\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\treportingChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t// Discounts\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\tcurVal = parseFloat(curVal);\n\t\torgVal = parseFloat(orgVal);\n\t\tif (isNaN(curVal))\n\t\t{\n\t\t\tcurVal = Number(0);\n\t\t}\n\t\tif (isNaN(orgVal))\n\t\t{\n\t\t\torgVal = Number(0);\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\t// we're not  tracking description fields for now\n\t\t\tchangeList.discounts[this.id] = {\n\t\t\t\tnewVal: $(this).val(),\n\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tif (initialSessionDiscountSetting != $(\"input[name='SessDisc']:checked\", '#editorForm').val())\n\t\t{\n\t\t\t$(\".SD_area\").addClass('unsaved_data_cb');\n\n\t\t\tvar newSDValue = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\n\t\t\tif (newSDValue == \"noSD\")\n\t\t\t{\n\t\t\t\tchangeList.discounts['session_discount'] = {\n\t\t\t\t\tnewVal: 0,\n\t\t\t\t\torgVal: $(\"#OEH_session_discount_org\").html(),\n\t\t\t\t\tdiff: $(\"#OEH_session_discount_org\").html() * -1\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.discounts['session_discount'] = {\n\t\t\t\t\tnewVal: $(\"#OEH_session_discount\").html(),\n\t\t\t\t\torgVal: 0,\n\t\t\t\t\tdiff: $(\"#OEH_session_discount\").html()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\".SD_area\").removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tif (initialPreferredUserDiscountSetting != $(\"input[name='PUD']:checked\", '#editorForm').val())\n\t\t{\n\t\t\t$(\"#PUD_area\").addClass('unsaved_data_cb');\n\n\t\t\tvar newPUDValue = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\n\t\t\tif (newPUDValue == \"noUP\")\n\t\t\t{\n\t\t\t\tchangeList.discounts['preferred_user_discount'] = {\n\t\t\t\t\tnewVal: 0,\n\t\t\t\t\torgVal: $(\"#OEH_preferred_org\").html(),\n\t\t\t\t\tdiff: $(\"#OEH_preferred_org\").html() * -1\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.discounts['preferred_user_discount'] = {\n\t\t\t\t\tnewVal: $(\"#OEH_preferred\").html(),\n\t\t\t\t\torgVal: 0,\n\t\t\t\t\tdiff: $(\"#OEH_preferred\").html()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#PUD_area\").removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\n\t// coupons\n\tvar orgCouponVal = $(\"#org_coupon_id\").val();\n\tvar curCouponVal = $(\"#coupon_id\").val();\n\tvar curCouponCode = $(\"#coupon_code\").val();\n\n\tif (orgCouponVal != curCouponVal)\n\t{\n\t\tdiscountOrPaymentChanges = true;\n\n\t\tif (orgCouponVal == \"\")\n\t\t{\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tcode: curCouponCode,\n\t\t\t\tchange_type: \"added\"\n\t\t\t};\n\t\t}\n\t\telse if (curCouponVal == \"\")\n\t\t{\n\t\t\t//removed\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tcode: curCouponCode,\n\t\t\t\tchange_type: \"removed\"\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tcode: curCouponCode,\n\t\t\t\tchange_type: \"changed\"\n\t\t\t};\n\t\t}\n\n\t}\n\n\tif (deliveryChanges)\n\t{\n\t\t$(\"#delivery_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#delivery_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\tif (discountOrPaymentChanges)\n\t{\n\t\t$(\"#payments_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#payments_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\tif (orderState == 'SAVED' && (showSaveButton || $('#use_store_credit').is(':checked')))\n\t{\n\t\t$(\"#saveOrderSpan\").show();\n\t}\n\telse\n\t{\n\t\t$(\"#saveOrderSpan\").hide();\n\t}\n\n\tif (orderState == 'SAVED' && ($('#use_store_credit').is(':checked') || paymentChanges))\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\n\t}\n\telse\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\n\n\t}\n\n\tif (orderState == 'ACTIVE' || discountEligable.limited_access)\n\t{\n\t\t$(\"#finalizeOrderSpan\").show();\n\t\tif (showSaveButton || paymentChanges || $('#use_store_credits').is(':checked'))\n\t\t{\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\t$(\"#submit_button\").attr(\"disabled\", false);\n\t\t\t$(\"#finalize_msg\").show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#submit_button\").attr(\"disabled\", true);\n\t\t\t$(\"#finalize_msg\").hide();\n\t\t}\n\t}\n\telse\n\t{\n\t\t$(\"#finalizeOrderSpan\").hide();\n\t}\n\n\tif (itemChanges || discountOrPaymentChanges)\n\t{\n\t\t$(\"#changeListTab\").addClass('unsaved_data_list');\n\t}\n\telse\n\t{\n\t\t$(\"#changeListTab\").removeClass('unsaved_data_list');\n\t}\n\n\tdrawChangeList();\n}\n\nfunction handleAutoAdjust(obj)\n{\n\t// called when the document is loaded or when the \"autoAdjust\" check box changes\n\n\t// if checked then setup the amounts to be credited/debited\n\tif (obj.checked)\n\t{\n\t\tvar balance = Number($('#OEH_remaing_balance').html());\n\n\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || balance > 0))\n\t\t{\n\t\t\tif (balance > 0)\n\t\t\t{\n\t\t\t\t$('#payment1_type').val('DPADJUST');\n\t\t\t\tchangePayment1('DPADJUST');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tadjustPendingDelayedPayment(balance);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tif (balance > 0)\n\t\t\t{\n\t\t\t\t$('#payment1_type').val('REFERENCE');\n\t\t\t\tchangePayment1('REFERENCE');\n\t\t\t}\n\n\t\t\tassignBalanceToRefTransactions(balance);\n\t\t}\n\t}\n\telse\n\t{\n\n\t\tif ($('#payment1_type').val() != \"\")\n\t\t{\n\t\t\t$('#payment1_type').val('');\n\t\t\tchangePayment1('');\n\t\t}\n\n\t\t// also clear any credits\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\t$('#Cr_RT_' + ident).val(\"\");\n\t\t}\n\n\t\t// or if trying to credit\n\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction getAbbreviatedChangeString()\n{\n\tvar htmlStr = \"\";\n\tvar addedStd = 0;\n\tvar removedStd = 0;\n\n\tif (needPlatePointsMaxDiscountChangeWarning)\n\t{\n\t\thtmlStr += \"<div style='color:red;'>Warning: The amount discountable by Dinner Dollars has changed. You may wish to review and adjust the Dinner Dollars discount.</div>\";\n\n\t}\n\n\tif (needRefferalRewardMaxDiscountChangeWarning)\n\t{\n\t\thtmlStr += \"<div style='color:red;'>Warning: The amount discountable by Referral Rewards has changed. You may wish to review and adjust the Referral Rewards discount.</div>\";\n\n\t}\n\n\n\tfor (var item in changeList.stdMenuItems)\n\t{\n\t\tif (changeList.stdMenuItems.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.stdMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\taddedStd += (changeList.stdMenuItems[item] * 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedStd += (changeList.stdMenuItems[item] * -1);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (addedStd)\n\t{\n\t\thtmlStr += addedStd + \" Standard items were added.<br />\"\n\t}\n\tif (removedStd)\n\t{\n\t\thtmlStr += removedStd + \" Standard items were removed.<br />\"\n\t}\n\n\tvar addedFT = 0;\n\tvar removedFT = 0;\n\n\tfor (var item in changeList.FTMenuItems)\n\t{\n\t\tif (changeList.FTMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.FTMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\taddedFT += (changeList.FTMenuItems[item] * 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedFT += (changeList.FTMenuItems[item] * -1);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (addedFT)\n\t{\n\t\thtmlStr += addedFT + \" Sides &amp; Sweets items were added.<br />\"\n\t}\n\tif (removedFT)\n\t{\n\t\thtmlStr += removedFT + \" Sides &amp; Sweets items were removed.<br />\"\n\t}\n\n\tvar addedSBI = 0;\n\tvar removedSBI = 0;\n\n\tfor (var item in changeList.sideBundleItem)\n\t{\n\t\tif (changeList.sideBundleItem.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.sideBundleItem[item] > 0)\n\t\t\t{\n\t\t\t\taddedSBI += (changeList.sideBundleItem[item] * 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedSBI += (changeList.sideBundleItem[item] * -1);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (addedSBI)\n\t{\n\t\thtmlStr += addedSBI + \" Sides &amp; Sweets bundle items were added.<br />\"\n\t}\n\tif (removedSBI)\n\t{\n\t\thtmlStr += removedSBI + \" Sides &amp; Sweets bundle items were removed.<br />\"\n\t}\n\n\tfor (var item in changeList.miscCosts)\n\t{\n\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfor (var item in changeList.miscDescs)\n\t{\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\n\t\t{\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\n\t\t}\n\t}\n\n\tif (changeList.order_type != \"\")\n\t{\n\t\thtmlStr += \"<h3>Order changed \" + changeList.order_type + \"</h3>\";\n\t}\n\n\tvar addedBI = 0;\n\tvar removedBI = 0;\n\n\tfirst = true;\n\tfor (var item in changeList.bundleItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\tif (isDreamTaste)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Meal Prep Workshop Items List</h3>\";\n\t\t\t}\n\t\t\telse if (isFundraiser)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Fundraiser Event Items List</h3>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Intro Items List</h3>\";\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.bundleItems.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.bundleItems[item] > 0)\n\t\t\t{\n\t\t\t\taddedBI += (changeList.bundleItems[item] * 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedBI += (changeList.bundleItems[item] * -1);\n\t\t\t}\n\t\t}\n\t}\n\tif (addedBI)\n\t{\n\t\thtmlStr += addedBI + \" items were added.<br />\"\n\t}\n\tif (removedBI)\n\t{\n\t\thtmlStr += removedBI + \" items were removed.<br />\"\n\t}\n\n\tif (htmlStr != \"\")\n\t{\n\t\thtmlStr = \"<h3>Purchase Changes</h3>\" + htmlStr;\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.discounts)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.discounts.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tif (changeList.bagFee['Bag Count'])\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Bag Fee</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"Updated Bag Count: Was \" + changeList.bagFee['Bag Count']['orgVal'] + \" bags. Updated to \" + changeList.bagFee['Bag Count']['newVal'] + \" bags<br />\";\n\t}\n\n\tif (typeof changeList.mealCustomizationFee['Meal Customization Selection'] != 'undefined' && changeList.mealCustomizationFee['Meal Customization Selection']['newVal'] != null)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Meal Customization Selection</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tlet previous = changeList.mealCustomizationFee['Meal Customization Selection']['orgVal'] == 1 ? \" not selected\" : \" selected\";\n\t\tlet newVal = changeList.mealCustomizationFee['Meal Customization Selection']['newVal'] == \"on\" ? \" selected\" : \" not selected\";\n\n\n\t\thtmlStr += \"Meal Customization was\" + previous + \". Updated to \" + newVal+ \".<br />\";\n\n\t}\n\tif (changeList.mealCustomizationFee['Meal Customization Fee'] != null)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Meal Customization Fee</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"Updated Meal Customization Fee: Was $\" + changeList.mealCustomizationFee['Meal Customization Fee']['orgVal'] + \". Updated to $\" + changeList.mealCustomizationFee['Meal Customization Fee']['newVal'] + \"<br />\";\n\t}\n\tif (changeList.mealCustomizationFee['Meal Customization'] != null)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Meal Customization</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tfor (let key in changeList.mealCustomizationFee['Meal Customization'])\n\t\t{\n\t\t\tif(typeof changeList.mealCustomizationFee['Meal Customization'][key] !== 'undefined' && typeof changeList.mealCustomizationFee['Meal Customization'][key]['name'] !== 'undefined')\n\t\t\t{\n\t\t\t\tif(changeList.mealCustomizationFee['Meal Customization'][key]['newVal'].toUpperCase() == 'OPTED IN')\n\t\t\t\t{\n\t\t\t\t\thtmlStr += changeList.mealCustomizationFee['Meal Customization'][key]['newVal'] + \" to \"+changeList.mealCustomizationFee['Meal Customization'][key]['name'] +\"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += changeList.mealCustomizationFee['Meal Customization'][key]['newVal'] + \" of \"+changeList.mealCustomizationFee['Meal Customization'][key]['name'] +\"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif ($('#autoAdjust').is(\":checked\"))\n\t{\n\t\thtmlStr += \"<span style='color:red'>Auto-Adjust is checked and will \" + $(\"#adj_action\").html() + \"</span>\";\n\n\t}\n\n\thtmlStr = \"<div id='finalize_changes_div'>\" + htmlStr + \"</div>\";\n\treturn htmlStr;\n}\n\nfunction addPaymentToLockedOrder()\n{\n\tvar billing_name = $(\"#payment1_ccNameOnCard\").val();\n\tvar billing_address = $(\"#billing_address_1\").val();\n\tvar billing_zip = $(\"#billing_postal_code_1\").val();\n\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tasync: true,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'get_token',\n\t\t\torder_id: order_id,\n\t\t\tamount: amt,\n\t\t\tuser_id: user_id,\n\t\t\tbilling_name: billing_name,\n\t\t\tbilling_address: billing_address,\n\t\t\tbilling_zip: billing_zip,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val(),\n\t\t\tchain_token: true\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder() get_token successful\");\n\n\t\t\t\tvar token = json.token;\n\n\t\t\t\tsend(token, 1, false, true, true, false);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$(\"#paying_div\").remove();\n\n\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction submitPage()\n{\n\tintenseLogging(\"submitPage() called\");\n\n\tvar form = $(\"#editorForm\")[0];\n\n\tvar is_valid = confirm_and_check_form(form);\n\n\tif (is_valid)\n\t{\n\t\tvar message = \"This can not be undone. Are you sure you want to submit the changes?\";\n\t\tvar changesBlurb = getAbbreviatedChangeString();\n\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\tvar dialogHeight = 460;\n\n\t\tif (message.length < 128)\n\t\t{\n\t\t\tdialogHeight = 160;\n\t\t}\n\t\telse if (message.length < 256)\n\t\t{\n\t\t\tdialogHeight = 260;\n\t\t}\n\n\t\tdd_message({\n\t\t\ttitle: 'Finalize',\n\t\t\tmessage: message,\n\t\t\tmodal: true,\n\t\t\twidth: 400,\n\t\t\theight: dialogHeight,\n\t\t\tconfirm: function () {\n\n\t\t\t\tif (supports_transparent_redirect && $(\"#payment1_type\").val() == 'CC')\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"submitPage() confirmed\");\n\n\t\t\t\t\tif (!discountEligable.limited_access)\n\t\t\t\t\t{\n\t\t\t\t\t\tupdateActiveOrder(true, true);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\taddPaymentToLockedOrder(true, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('<input>').attr({\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'changeList',\n\t\t\t\t\t\tvalue: JSON.stringify(changeList)\n\t\t\t\t\t}).appendTo($(form));\n\n\t\t\t\t\t$('<input>').attr({\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'changeListStr',\n\t\t\t\t\t\tvalue: getChangeListHTML()\n\t\t\t\t\t}).appendTo($(form));\n\n\t\t\t\t\t$(\"#submit_changes\").val(\"true\");\n\t\t\t\t\t$(\"#editorForm\").submit();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n}\n\nfunction resetPage()\n{\n\tintenseLogging(\"resetPage() called\");\n\n\tbounce(window.location.href);\n}\n\nfunction confirm_and_check_form(form)\n{\n\n\tintenseLogging(\"confirm_and_check_form() called\");\n\n\tif (orderState == 'NEW' || orderState == 'SAVED')\n\t{\n\t\treturn false;\n\t}\n\n\tif (hasBundle)\n\t{\n\t\tvar bundleIsSelected = false;\n\t\tif ($('#selectedBundle').is(':checked'))\n\t\t{\n\t\t\tbundleIsSelected = true;\n\t\t}\n\n\t\tif (bundleIsSelected)\n\t\t{\n\n\t\t\tvar numBundItems = countSelectedBundleItems();\n\t\t\tif (numBundItems < intro_servings_required)\n\t\t\t{\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Please select at least ' + intro_servings_required + ' servings of Meal Prep Starter Pack items.'\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse if (numBundItems > 18)\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Please select no more than 18 servings of Meal Prep Starter Pack items.'\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (stationNeedsAttention)\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please review the Side Station and ensure the correct number of items are selected.'\n\t\t});\n\t\treturn false;\n\t}\n\n\treturn _check_form(form);\n}\n\n// rounds to the nearest penny\n// move to global once this is found to be reliable\nfunction dd_round_amount(inAmount)\n{\n\tinAmount += .000005;\n\n\tvar tempVal = inAmount * 1000.0;\n\ttempVal = parseInt(tempVal);\n\ttempVal = tempVal / 10;\n\tvar pennyFraction = tempVal - Math.floor(tempVal);\n\tif (pennyFraction >= .5)\n\t{\n\t\ttempVal = Math.floor(tempVal) + 1;\n\t}\n\telse\n\t{\n\t\ttempVal = Math.floor(tempVal);\n\t}\n\n\treturn tempVal / 100;\n}\n\n/*\n\n function reportTestFailure(testNum, actual, correct)\n {\n if (actual != correct)\n {\n alert(\"Test #: \" + testNum + \" actual: \" + actual + \" correct: \" + correct);\n }\n }\n\n function doTests()\n {\n\n var testmultiplier = \".5\";\n\n var testNum = \"260.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(1, newResult, 130.05);\n\n var testNum = \"209.10\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(2, newResult, 104.55);\n\n testNum = \"209.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(3, newResult, 104.55);\n\n testNum = \"209\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(4, newResult, 104.5);\n\n testNum = \"1\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(5, newResult, .5);\n\n testNum = \"0\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(6, newResult, 0);\n\n testNum = \".05\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(7, newResult, .03);\n\n testNum = \".005\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(8, newResult, 0);\n\n testNum = \"499.99\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(9, newResult, 250);\n\n var testNum = \"209.10\";\n var testmultiplier = \".12\";\n\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(10, newResult, 25.09);\n\n testNum = \"209.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(11, newResult, 25.09);\n\n testNum = \"209\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(12, newResult, 25.08);\n\n testNum = \"1\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(13, newResult, .12);\n\n testNum = \"0\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(14, newResult, 0);\n\n testNum = \".05\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(15, newResult, .01);\n\n testNum = \".005\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(16, newResult, 0);\n\n testNum = \"499.99\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(17, newResult, 60);\n\n }\n\n doTests();\n\n */\n\nfunction updateSideStationStatus(entree_id, qty)\n{\n\tqty = Number(qty);\n\tstationNeedsAttention = false;\n\n\tif (qty == 0)\n\t{\n\t\t$('#desc' + entree_id).slideUp();\n\t\t$(\"#sidestation_help_\" + entree_id).css('color', \"#b00\").html(\"You must set the Bundle quantity to greater than zero.\");\n\t\t$('.bundle-subitem-qty[data-parent_item=\"' + entree_id + '\"]').val(0);\n\t\treturn;\n\t}\n\telse\n\t{\n\t\t$('#desc' + entree_id).slideDown();\n\t}\n\n\tlet requiredItemCount = qty * sideStationBundleInfo[entree_id].number_items_required;\n\t$(\"#required_items_station_\" + entree_id).text(requiredItemCount);\n\n\tlet numSelected = 0;\n\n\t$.each(sideStationBundleInfo[entree_id].bundle, function (mid, menu_item) {\n\n\t\tlet itemQty = $('#sbi_' + mid);\n\n\t\tif (itemQty && itemQty.val() != \"\")\n\t\t{\n\t\t\tif (isNaN(itemQty.val()) == true || itemQty.val() - parseInt(itemQty.val()) != 0)\n\t\t\t{\n\t\t\t\titemQty.val(0);\n\t\t\t}\n\n\t\t\t// if it is a fixed quantity, the input is read only so update the value times the master quantity\n\t\t\tif (menu_item.fixed_quantity !== '0')\n\t\t\t{\n\t\t\t\titemQty.val(qty * Number(menu_item.fixed_quantity));\n\t\t\t}\n\n\t\t\tif (itemQty.val() > 0)\n\t\t\t{\n\t\t\t\titemQty.val(parseInt(itemQty.val()));\n\t\t\t\tnumSelected += (itemQty.val() * 1);\n\t\t\t}\n\n\t\t\tlet inv_qty = entreeIDToInventoryMap[menu_item.entree_id].remaining;\n\t\t\tinv_qty -= (itemQty.val() * menu_item.servings_per_item);\n\n\t\t\t$('[data-entree_inventory_remaining=\"' + menu_item.entree_id + '\"]').text(inv_qty);\n\n\t\t\tentreeIDToInventoryMap[menu_item.entree_id].remaining = inv_qty;\n\t\t}\n\n\t});\n\n\t$.each(sideStationBundleInfo[entree_id].bundle_groups, function (bid, group_info) {\n\t\t$('.group-select-num[data-group_id=\"' + group_info.id + '\"]').text(parseInt(group_info.number_items_required) * parseInt(qty));\n\t});\n\n\t$(\"#selected_items_station_\" + entree_id).html(numSelected);\n\n\tlet stationHelpElem = $(\"#sidestation_help_\" + entree_id);\n\tlet help_message = \"\";\n\tif (numSelected == 0)\n\t{\n\t\thelp_message = \"Please select \" + requiredItemCount + \" items.\";\n\t\tstationHelpElem.css('color', \"#b00\");\n\t\tstationNeedsAttention = true;\n\t}\n\telse if (numSelected > requiredItemCount)\n\t{\n\t\thelp_message = \"You have selected \" + (numSelected - requiredItemCount) + \" items more than the required amount. Please remove \" + (numSelected - requiredItemCount) + \" items.\";\n\t\tstationHelpElem.css('color', \"#b00\");\n\t\tstationNeedsAttention = true;\n\t}\n\telse if (numSelected < requiredItemCount)\n\t{\n\t\thelp_message = \"You have selected \" + (requiredItemCount - numSelected) + \" items less than the required amount. Please add \" + (requiredItemCount - numSelected) + \" items.\";\n\t\tstationHelpElem.css('color', \"#b00\");\n\t\tstationNeedsAttention = true;\n\t}\n\telse\n\t{\n\t\thelp_message = \"You have selected the correct number of sidestation items. You may continue with item selection or checkout.\";\n\t\tstationHelpElem.css('color', \"#0b0\");\n\t\tstationNeedsAttention = false;\n\t}\n\n\tstationHelpElem.html(help_message);\n}\n\nfunction handleMealCustomizationFeeInput()\n{\n\t$('#manual_customization_fee').val('true');\n\tcalculateTotal();\n}\n\n\nfunction handleBagCountInput()\n{\n\tbagCountLockedToField = true;\n\tcalculateTotal();\n}\n\nfunction handleBagWaiverInput()\n{\n\tif (!$(\"#opted_to_bring_bags\").is(\":checked\"))\n\t{\n\t\tbagCountLockedToField = false;\n\t}\n\tcalculateTotal();\n}\n\nfunction handleMealCustomizationWaiverInput()\n{\n\tif ($(\"#opted_to_customize_recipes\").is(\":checked\"))\n\t{\n\t\tmealCustomizationFeeFieldLocked = true;\n\n\t\t$('.icon-customize').hide();\n\n\t}else{\n\t\tlet mealCustomizationFeeTotal = $(\"#subtotal_meal_customization_fee\").data('org_value');\n\t\t$(\"#subtotal_meal_customization_fee\").prop(\"disabled\", false);\n\t\t$(\"#subtotal_meal_customization_fee\").val(formatAsMoney(mealCustomizationFeeTotal));\n\n\t\t$(\"#customization-row-container\").show();\n\t\tmealCustomizationFeeFieldLocked = false;\n\t\t$('.icon-customize').show();\n\n\t\tif (true)\n\t\t{\n\t\t\tfeeChanges = true;\n\t\t\t$(\"#submit_button\").attr(\"disabled\", false);\n\t\t\t$(\"#finalize_msg\").show();\n\t\t}\n\t}\n\tcalculateTotal();\n}\n\nfunction calculateMealCustomizationFee(customizableMealQty){\n\tlet priceConfig = meal_customization_cost;\n\n\tif(typeof priceConfig === 'undefined' || priceConfig.length == 0){\n\t\treturn 0;\n\t}\n\n\tlet fee = 0;\n\tfor (var key in priceConfig) {\n\n\t\tswitch(priceConfig[key].operator) {\n\t\t\tcase 'EQUAL_OR_LESS':\n\t\t\t\tif(customizableMealQty <= parseInt(priceConfig[key].value)){\n\t\t\t\t\tfee = priceConfig[key].cost;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'BETWEEN_INCLUSIVE':\n\t\t\t\tlet limit = priceConfig[key].value.split('-');\n\t\t\t\tlet limitLow = parseInt(limit[0]);\n\t\t\t\tlet limitHigh = parseInt(limit[1]);\n\t\t\t\tif(customizableMealQty >= limitLow && customizableMealQty <= limitHigh ){\n\t\t\t\t\tfee = priceConfig[key].cost;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'GREATER':\n\t\t\t\tif(customizableMealQty > parseInt(priceConfig[key].value)){\n\t\t\t\t\tfee = priceConfig[key].cost;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t// code block\n\t\t}\n\t}\n\n\treturn fee;\n\n}\n\nfunction getNumberBagsRequiredFromItems(entreeCount, sidesCount)\n{\n\n\tlet entreesPerBag = 4;\n\t//\tlet sidesPerBag = 6;\n\n\tlet bagsRequired = Math.floor(entreeCount / entreesPerBag);\n\tlet entreeRemainder = 0;\n\tif (entreeCount % entreesPerBag > 0)\n\t{\n\t\tentreeRemainder = entreesPerBag - (entreeCount % entreesPerBag);\n\t}\n\n\tif (entreeRemainder > 0)\n\t{\n\t\tbagsRequired++;\n\t}\n\t/*\n\t\t// simple for now since we are assuming 2 sides fit the space of 1 entree. this could change\n\n\t\tlet sidesCapacityOfRemainder = entreeRemainder * 2;\n\t\tsidesCount -= sidesCapacityOfRemainder;\n\n\t\tif (sidesCount <= 0)\n\t\t{\n\t\t\treturn bagsRequired;\n\t\t}\n\n\t\tlet sidesBagsRequired = Math.floor(sidesCount / sidesPerBag);\n\t\tlet sidesRemainder = 0;\n\t\tif (sidesCount % sidesPerBag > 0)\n\t\t{\n\t\t\tsidesRemainder = sidesPerBag - (sidesCount % sidesPerBag);\n\t\t}\n\n\t\tif (sidesRemainder > 0)\n\t\t{\n\t\t\tsidesBagsRequired++;\n\t\t}\n\t*/\n\n\t//return bagsRequired + sidesBagsRequired;\n\n\treturn bagsRequired;\n}\n\n// this massive function is called anytime something that affects costs or payments is altered\nfunction calculateTotal()\n{\n\tlet total = 0;\n\tlet entrees = 0;\n\tlet servings = 0;\n\tlet core_servings = 0;\n\tlet halfQty = 0;\n\tlet wholeQty = 0;\n\tlet customizableMealQty = 0;\n\tlet introQty = 0;\n\tlet sideDishQty = 0;\n\tlet sideDishSubTotal = 0;\n\tlet bundlesSubTotal = 0;\n\tlet productsSubTotal = 0;\n\tlet coreItemsSubtotal = 0;\n\tlet bundlesQty = 0;\n\tlet discounted_total = 0;\n\tlet creditContribution = 0;\n\tlet main_items_count = 0;\n\tlet bundleIsSelected = false;\n\tlet PUDExcludedItemsTotal = 0;\n\tlet PUDExcludedFullItemsCount = 0;\n\tlet PUDExcludedHalfItemsCount = 0;\n\tlet creditConsumed = 0;\n\tlet hasServiceFeeWithMFYCoupon = false;\n\tlet hasDeliveryFeeWithCoupon = false;\n\n\tlet sortedCoreItemList = [];\n\n\tlet itemsSelected = [];\n\n\tif (hasBundle)\n\t{\n\t\tif ($('#selectedBundle').is(':checked'))\n\t\t{\n\t\t\tbundleIsSelected = true;\n\t\t}\n\t}\n\n\tfor (let x in entreeIDToInventoryMap)\n\t{\n\t\tentreeIDToInventoryMap[x].remaining = entreeIDToInventoryMap[x].org_remaining;\n\t\t$('[data-entree_inventory_remaining=\"' + x + '\"]').text(entreeIDToInventoryMap[x].org_remaining);\n\n\t}\n\n\t// ---------------------------------------------------------- Items\n\t// loop through all the quantity input boxes and gather up the totals\n\n\t// var count = 0;\n\t$(\"[id^='qty_']\").each(function () {\n\t\t//  count++;\n\n\t\tif ($(this).val() != \"\")\n\t\t{\n\t\t\tif (isNaN($(this).val()) == true || $(this).val() - parseInt($(this).val(), 10) != 0)\n\t\t\t{\n\t\t\t\t$(this).val(0);\n\t\t\t}\n\n\t\t\tlet itemQty = Number($(this).val());\n\t\t\tlet itemId = this.id.split(\"_\")[1];\n\n\t\t\tif (isFactoringCredit)\n\t\t\t{\n\t\t\t\tlet orgAmount = $(this).data('org_value');\n\t\t\t\tif ($(this).data('dd_type') == 'std')\n\t\t\t\t{\n\t\t\t\t\tif (orgAmount < itemQty)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = itemQty - orgAmount;\n\t\t\t\t\t\tcreditContribution += (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t\telse if (itemQty < orgAmount)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = orgAmount - itemQty;\n\t\t\t\t\t\tcreditContribution -= (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse // addon\n\t\t\t\t{\n\t\t\t\t\tlet orgAmount = itemQty.getAttribute('data-org_value');\n\t\t\t\t\tif (orgAmount < itemQty)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = itemQty - orgAmount;\n\t\t\t\t\t\tcreditConsumed += (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t\telse if (itemQty < orgAmount)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = orgAmount - itemQty;\n\t\t\t\t\t\tcreditContribution -= (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ((isNaN(itemQty) == false))\n\t\t\t{\n\t\t\t\tlet entree_id = $(this).data('entreeid');\n\t\t\t\tlet inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\tlet temp_servings = Number($(this).data('servings'));\n\t\t\t\tinv_qty = inv_qty - (itemQty * temp_servings);\n\t\t\t\t$('[data-entree_inventory_remaining=\"' + entree_id + '\"]').text(inv_qty);\n\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\n\t\t\t\tif ($(this).data('dd_type') != 'cts' && ($(this).data('menu_class') != 'Extended Fast Lane' || PlatePointsRulesVersion == 1))\n\t\t\t\t{\n\n\t\t\t\t\tif (itemQty > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet obj = {\n\t\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\t\tqty: itemQty,\n\t\t\t\t\t\t\tprice: $(this).data('price'),\n\t\t\t\t\t\t\tserving_size: $(this).data('servings')\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tsortedCoreItemList.push(obj)\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttotal += itemQty * $(this).data('price');\n\n\t\t\t\tif ($(this).data('dd_type') != 'cts')\n\t\t\t\t{\n\t\t\t\t\tentrees += itemQty * $(this).data('item_count_per_item');\n\t\t\t\t\tservings += itemQty * $(this).data('servings');\n\n\t\t\t\t\tif ($(this).data('menu_class') != 'Extended Fast Lane' || PlatePointsRulesVersion == 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcore_servings += itemQty * $(this).data('servings');\n\t\t\t\t\t\tcoreItemsSubtotal += itemQty * $(this).data('price');\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(this).data('pricing_type') == 'FULL')\n\t\t\t\t\t{\n\t\t\t\t\t\twholeQty += itemQty * $(this).data('item_count_per_item');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thalfQty += itemQty * $(this).data('item_count_per_item');\n\t\t\t\t\t}\n\n\t\t\t\t\tif($(this).data('item_is_customizable') == '1'){\n\t\t\t\t\t\tcustomizableMealQty += itemQty * $(this).data('item_count_per_item');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsideDishQty += itemQty;\n\t\t\t\t\tsideDishSubTotal += itemQty * $(this).data('price');\n\t\t\t\t}\n\n\t\t\t\tif ($(this).data('is_bundle') == true)\n\t\t\t\t{\n\t\t\t\t\tbundlesSubTotal += itemQty * $(this).data('price');\n\t\t\t\t\tbundlesQty += itemQty;\n\t\t\t\t}\n\n\t\t\t\titemsSelected[itemId] = itemQty;\n\n\t\t\t\t$('#sbi_inv_' + entree_id).html(inv_qty);\n\t\t\t}\n\n\t\t\tif ($(this).data('is_bundle') == true)\n\t\t\t{\n\t\t\t\tupdateSideStationStatus(itemId, itemQty);\n\t\t\t}\n\t\t}\n\t});\n\n\n\tif (hasBundle)\n\t{\n\t\t// bundle support\n\t\tlet selectedBundleItemCount = 0;\n\t\tlet selectedBundleServingsCount = 0;\n\n\t\tif (originallyHadBundle)\n\t\t{\n\t\t\tif (bundleIsSelected)\n\t\t\t{\n\t\t\t\t$(\"[id^='bnd_']\").each(function () {\n\t\t\t\t\tif ($(this).data('org_value') == \"1\") //was initially chosen\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!$(this).is(\":checked\"))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet entree_id = $(this).data('entreeid');\n\t\t\t\t\t\t\tlet inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\t\t\t\tinv_qty = inv_qty + $(this).data('servings');\n\t\t\t\t\t\t\t$('[data-entree_inventory_remaining=\"' + entree_id + '\"]').text(inv_qty);\n\n\t\t\t\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselectedBundleItemCount++;\n\t\t\t\t\t\t\tselectedBundleServingsCount += $(this).data('servings');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet entree_id = $(this).data('entreeid');\n\t\t\t\t\t\t\tlet inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\t\t\t\tinv_qty = inv_qty - $(this).data('servings');\n\t\t\t\t\t\t\t$('[data-entree_inventory_remaining=\"' + entree_id + '\"]').text(inv_qty);\n\n\t\t\t\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\t\t\t\t\t\t\tselectedBundleItemCount++;\n\t\t\t\t\t\t\tselectedBundleServingsCount += $(this).data('servings');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{ //bundle is not selected\n\n\t\t\t\t$(\"[id^='bnd_']\").each(function () {\n\t\t\t\t\tif ($(this).data('org_value') == \"1\") //was initially chosen\n\t\t\t\t\t{\n\t\t\t\t\t\tlet entree_id = $(this).data('entreeid');\n\t\t\t\t\t\tlet inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\t\t\tinv_qty = inv_qty + $(this).data('servings');\n\t\t\t\t\t\t$('[data-entree_inventory_remaining=\"' + entree_id + '\"]').text(inv_qty);\n\t\t\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (bundleIsSelected)\n\t\t\t{\n\t\t\t\t$(\"[id^='bnd_']\").each(function () {\n\t\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t\t{\n\t\t\t\t\t\tlet entree_id = $(this).data('entreeid');\n\t\t\t\t\t\tlet inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\t\t\tinv_qty = inv_qty - $(this).data('servings');\n\t\t\t\t\t\t$('[data-entree_inventory_remaining=\"' + entree_id + '\"]').text(inv_qty);\n\t\t\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\t\t\t\t\t\tselectedBundleItemCount++;\n\t\t\t\t\t\tselectedBundleServingsCount += $(this).data('servings');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// bundle support\n\t\tif (bundleIsSelected)\n\t\t{\n\t\t\ttotal += (bundleInfo.price * 1);\n\t\t\twholeQty += selectedBundleItemCount;\n\t\t\tservings += selectedBundleServingsCount;\n\t\t}\n\t}\n\n\tif (tasteBundleMenuData)\n\t{\n\t\tif (isDreamTaste || isFundraiser)\n\t\t{\n\n\t\t\t$(\"#OEH_number_core_servings\").html(bundleInfo.number_servings_required);\n\n\t\t\t// bundle support\n\t\t\tlet selectedWholeBundleItemCount = 0;\n\t\t\tlet selectedHalfBundleItemCount = 0;\n\t\t\tlet selectedBundleServingsCount = 0;\n\n\t\t\ttotal += Number(bundleInfo.price);\n\n\t\t\t$(\"[id^='bnd_']\").each(function () {\n\n\t\t\t\tlet tasteItemQty = $(this).val();\n\t\t\t\tif (tasteItemQty > 0)\n\t\t\t\t{\n\t\t\t\t\tservings += ($(this).data('servings') * tasteItemQty);\n\t\t\t\t\tif ($(this).data('servings') == 3)\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedHalfBundleItemCount += (tasteItemQty * 1);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedWholeBundleItemCount += (tasteItemQty * 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet entree_id = $(this).data('entreeid');\n\t\t\t\t\tlet inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\t\tinv_qty = inv_qty - (tasteItemQty * 3);\n\t\t\t\t\t$('[data-entree_inventory_remaining=\"' + entree_id + '\"]').text(inv_qty);\n\t\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twholeQty += (selectedWholeBundleItemCount * 1);\n\t\t\thalfQty += (selectedHalfBundleItemCount * 1);\n\n\t\t}\n\t}\n\n\tlet discountablePlatePointsAmount = 0;\n\n\tif ($(\"#selectedBundle\").is(':checked'))\n\t{\n\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(0));\n\n\t\tif (typeof coupon != 'undefined' && coupon.limit_to_mfy_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\t\t\tlet currentServiceFee = $(\"#subtotal_service_fee\").val();\n\n\t\t\tif (currentServiceFee > 0)\n\t\t\t{\n\t\t\t\thasServiceFeeWithMFYCoupon = true;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof coupon != 'undefined' && coupon.limit_to_delivery_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\t\t\tlet currentDeliveryFee = $(\"#subtotal_delivery_fee\").val();\n\n\t\t\tif (currentDeliveryFee > 0)\n\t\t\t{\n\t\t\t\thasDeliveryFeeWithCoupon = true;\n\t\t\t}\n\t\t}\n\n\t}\n\telse\n\t{\n\t\tlet serviceFee = Number(document.getElementById('subtotal_service_fee').value);\n\t\tdiscountablePlatePointsAmount = total + serviceFee.valueOf();\n\n\t\tif (typeof coupon != 'undefined' && coupon.limit_to_mfy_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\n\t\t\tlet currentServiceFee = $(\"#subtotal_service_fee\").val();\n\n\t\t\t// adjust the discountablePlatePointsAmount and service to match coupon\n\t\t\tdiscountablePlatePointsAmount = formatAsMoney(discountablePlatePointsAmount - currentServiceFee);\n\t\t\t$(\"#OEH_subtotal_service_fee\").val(currentServiceFee);\n\n\t\t\thasServiceFeeWithMFYCoupon = true;\n\t\t\tif (discountablePlatePointsAmount < 0)\n\t\t\t{\n\t\t\t\tdiscountablePlatePointsAmount = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (typeof coupon != 'undefined' && coupon.limit_to_delivery_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\t\t\tlet currentDeliveryFee = $(\"#subtotal_delivery_fee\").val();\n\t\t\thasDeliveryFeeWithCoupon = true;\n\t\t}\n\n\t\tneedPlatePointsMaxDiscountChangeWarning = false;\n\n\t\tif (discountablePlatePointsAmount != lastMaxPPDiscountAmount && lastMaxPPDiscountAmount != -1)\n\t\t{\n\t\t\tneedPlatePointsMaxDiscountChangeWarning = true;\n\t\t}\n\n\t\tlastMaxPPDiscountAmount = discountablePlatePointsAmount;\n\n\t\tif (couponlimitedToFT)\n\t\t{\n\t\t\tlet tempCouponVal = Number(document.getElementById('couponValue').value);\n\t\t\tdiscountablePlatePointsAmount -= tempCouponVal;\n\t\t\tif (discountablePlatePointsAmount < 0)\n\t\t\t{\n\t\t\t\tdiscountablePlatePointsAmount = 0;\n\t\t\t}\n\n\t\t}\n\n\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(discountablePlatePointsAmount))\n\t}\n\n\tif (discountablePlatePointsAmount <= 0)\n\t{\n\t\t$(\"#plate_points_discount\").attr(\"disabled\", \"disabled\");\n\t\t$(\"#plate_points_discount\").css({\n\t\t\t\"background-color\": \"#c0c0c0\",\n\t\t\t\"color\": \"#060606\"\n\t\t});\n\t\t$(\"#pp_discountable_cost_msg\").show();\n\n\t}\n\telse if (!discountEligable.limited_access)\n\t{\n\t\t$(\"#plate_points_discount\").removeAttr(\"disabled\");\n\t\t$(\"#plate_points_discount\").css({\n\t\t\t\"background-color\": \"#fff\",\n\t\t\t\"color\": \"#000\"\n\t\t});\n\t}\n\n\n\tlet discountableReferralRewardAmount = total + Number(document.getElementById('subtotal_service_fee').value);\n\n\tif (typeof coupon != 'undefined' && coupon.limit_to_mfy_fee == '1' && coupon.discount_method == 'FLAT')\n\t{\n\n\t\tlet currentServiceFee = $(\"#subtotal_service_fee\").val();\n\n\t\t// adjust the discountablePlatePointsAmount and service to match coupon\n\t\tdiscountableReferralRewardAmount = formatAsMoney(discountableReferralRewardAmount - currentServiceFee);\n\t\t$(\"#OEH_subtotal_service_fee\").val(currentServiceFee);\n\n\t\thasServiceFeeWithMFYCoupon = true;\n\t\tif (discountableReferralRewardAmount < 0)\n\t\t{\n\t\t\tdiscountableReferralRewardAmount = 0;\n\t\t}\n\n\t}\n\n\tneedRefferalRewardMaxDiscountChangeWarning = false;\n\n\tif (discountableReferralRewardAmount != lastMaxReferralRewardDiscountAmount && lastMaxReferralRewardDiscountAmount != -1)\n\t{\n\t\tneedRefferalRewardMaxDiscountChangeWarning = true;\n\t}\n\n\tlastMaxReferralRewardDiscountAmount = discountableReferralRewardAmount;\n\n\tif (couponlimitedToFT)\n\t{\n\t\tlet tempCouponVal = Number(document.getElementById('couponValue').value);\n\t\tdiscountableReferralRewardAmount -= tempCouponVal;\n\t\tif (discountableReferralRewardAmount < 0)\n\t\t{\n\t\t\tdiscountableReferralRewardAmount = 0;\n\t\t}\n\n\t}\n\n\t$(\"#referral_reward_discount\").html(formatAsMoney(discountableReferralRewardAmount))\n\n\n\tif (discountableReferralRewardAmount <= 0)\n\t{\n\t\t$(\"#referral_reward_discount\").attr(\"disabled\", \"disabled\");\n\t\t$(\"#referral_reward_discount\").css({\n\t\t\t\"background-color\": \"#c0c0c0\",\n\t\t\t\"color\": \"#060606\"\n\t\t});\n\t\t$(\"#rr_discountable_cost_msg\").show();\n\n\t}\n\telse if (!discountEligable.limited_access)\n\t{\n\t\t$(\"#referral_reward_discount\").removeAttr(\"disabled\");\n\t\t$(\"#referral_reward_discount\").css({\n\t\t\t\"background-color\": \"#fff\",\n\t\t\t\"color\": \"#000\"\n\t\t});\n\t\t$(\"#rr_discountable_cost_msg\").hide();\n\n\t}\n\n\tlet maxPPCredit = $(\"#plate_points_available\").html() * 1;\n\tlet maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\tlet curPPDiscount = $(\"#plate_points_discount\").val() * 1;\n\n\tif (maxPPDeduction < curPPDiscount)\n\t{\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\n\t}\n\n\tif (maxPPCredit > maxPPDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tlet maxRRCredit = $(\"#referral_reward_available\").html() * 1;\n\tlet maxRRDeduction = $(\"#max_referral_reward_deduction\").html() * 1;\n\tlet curRRDiscount = $(\"#referral_reward_discount\").val() * 1;\n\n\tif (maxRRDeduction < curRRDiscount)\n\t{\n\t\t$(\"#referral_reward_discount\").val(maxRRDeduction);\n\t}\n\n\tif (maxRRCredit > maxRRDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tdiscounted_total = total;\n\n\tlet addonsSubtotal = 0;\n\tlet addonsQty = 0;\n\n\t//var itemRows = document.getElementById('itemsTbl').rows;\n\t//for (i = 0; i < itemRows.length; i++)\n\n\t$(\"#itemsTbl tr\").each(function () {\n\n\t\tif (this.id.indexOf('row_') != -1)\n\t\t{\n\t\t\tlet itemNumber = this.id.substr(4);\n\n\t\t\tlet qty_str = 'qna_' + itemNumber;\n\t\t\tlet prc_str = 'prc_' + itemNumber;\n\n\t\t\tlet addQty = $('#' + qty_str).val();\n\t\t\tlet addonsQtyNumber = Number(addQty);\n\t\t\tlet addPrc = $(\"#\" + prc_str).html();\n\t\t\tlet addPrcNumber = Number(addPrc);\n\t\t\taddonsSubtotal += (Number(addPrc) * addQty);\n\t\t\taddonsQty += addonsQtyNumber;\n\n\t\t\t/// var inv_qty =  Number(document.getElementById('inv_org_' + itemNumber).innerHTML);\n\t\t\tlet inv_qty = entreeIDToInventoryMap[itemNumber].remaining;\n\n\t\t\tinv_qty = inv_qty - addQty;\n\t\t\t$('[data-entree_inventory_remaining=\"' + itemNumber + '\"]').text(inv_qty);\n\t\t\tentreeIDToInventoryMap[itemNumber].remaining = inv_qty;\n\n\t\t\tif (isFactoringCredit)\n\t\t\t{\n\t\t\t\torgAmount = document.getElementById(qty_str).getAttribute('data-org_value');\n\t\t\t\tif (orgAmount < addonsQtyNumber)\n\t\t\t\t{\n\t\t\t\t\tdiff = addonsQtyNumber - orgAmount;\n\t\t\t\t\tcreditConsumed += (diff * addPrcNumber);\n\t\t\t\t}\n\t\t\t\telse if (addQty < orgAmount)\n\t\t\t\t{\n\t\t\t\t\tdiff = orgAmount - addQty;\n\t\t\t\t\tcreditContribution -= (diff * addPrcNumber);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tmain_items_count = halfQty + wholeQty + sideDishQty;\n\tcore_items_count = halfQty + wholeQty;\n\n\tlet totalMealQuantity = Number(halfQty + wholeQty);\n\n\tlet itemCountLabel = $('#OEH_item_count_label');\n\n\tlet itemCountAdjustmentAmount = 0;\n\tlet displayServingsAdjustment = 0;\n\n\t// coupon code free meal count contribution\n\tlet couponTypeElem = $('#coupon_type');\n\tif (couponTypeElem.length && couponTypeElem.val() == 'FREE_MEAL')\n\t{\n\t\tcfm_size = Number($('#free_entree_servings').val());\n\n\t\tif (cfm_size > 0)\n\t\t{\n\t\t\tdisplayServingsAdjustment += cfm_size;\n\t\t\titemCountAdjustmentAmount++;\n\t\t}\n\t}\n\n\tif (itemCountAdjustmentAmount == 0)\n\t{\n\t\tdisplayMealCount = introQty + wholeQty + halfQty + sideDishQty + addonsQty;\n\t\tdisplayServingCount = servings;\n\t\titemCountLabel.html(\"Total Item Count\");\n\t}\n\telse\n\t{\n\t\tdisplayMealCount = introQty + wholeQty + sideDishQty + halfQty + itemCountAdjustmentAmount + addonsQty;\n\t\tdisplayServingCount = servings + displayServingsAdjustment;\n\t\titemCountLabel.html(\"Total # Items (incl. free meals)\");\n\t}\n\n\tif (orderEditSuccess)\n\t{\n\t\tdisplayMealCount += newAddonQty;\n\t}\n\n\t// update the entree and serving totals display\n\t$('#OEH_item_count').html(displayMealCount);\n\t$('#OEH_number_servings').html(displayServingCount);\n\n\tif (typeof (order_minimum) !== 'undefined' && order_minimum.minimum_type == 'ITEM')\n\t{\n\t\tcore_servings = core_items_count;\n\t}\n\tlocalStorage.setItem('core-item-count', core_items_count);\n\tlocalStorage.setItem('side-item-count', sideDishQty);\n\n\tif (PlatePointsRulesVersion > 1)\n\t{\n\t\t$('#OEH_number_core_servings').html(core_servings);\n\t}\n\n\tlet premarkup_total = 0;\n\n\tlet freeMealValue = 0;\n\n\t// also must add coupon code free meal\n\t// coupon code free meal count contribution\n\tcouponTypeElem = $('#coupon_type');\n\tif (couponTypeElem.length && couponTypeElem.val() == 'FREE_MEAL')\n\t{\n\t\tfreeMealValue = Number($('#couponValue').val());\n\n\t\tif (freeMealValue > 0)\n\t\t{\n\t\t\tdiscounted_total += freeMealValue;\n\t\t}\n\t}\n\n\tdiscounted_total += addonsSubtotal;\n\n\tif (orderEditSuccess)\n\t{\n\t\tdiscounted_total += newAddonAmount;\n\t}\n\n\tdiscounted_total = Math.round(discounted_total * 100) / 100;\n\n\t// --------------------------------------------------------------------- menu items subtotal\n\t$('#orderSubTotal').val(formatAsMoney(Math.round(total * 100) / 100));\n\t$('#OEH_menu_subtotal').html(formatAsMoney(discounted_total));\n\t$('#orderTotal').val(formatAsMoney(discounted_total));\n\n\t// ------------------------------------------------------ food subtotal\n\n\tlet miscFoodSubtotal = Number(document.getElementById('misc_food_subtotal').value);\n\n\t// menu items total plus misc food cost\n\tlet food_costs = (discounted_total * 1) + (miscFoodSubtotal * 1);\n\t$('#OEH_food_cost_subtotal').html(formatAsMoney((discounted_total * 1) + (miscFoodSubtotal * 1)));\n\n\tlet newGrandTotal = discounted_total;\n\tlet pre_discounts_grand_total = newGrandTotal;\n\n\t// -------------------------------DISCOUNTS-----------------------------------------\n\n\tcurPPDiscount = 0;\n\t// ----------------------------------------------  PLATEPOINTS Discount\n\tif ($('#plate_points_discount').length)\n\t{\n\t\tcurPPDiscount = $('#plate_points_discount').val();\n\t\tif (curPPDiscount * 1 > discountablePlatePointsAmount * 1)\n\t\t{\n\t\t\tcurPPDiscount = discountablePlatePointsAmount;\n\n\t\t\tif (curPPDiscount == 0)\n\t\t\t{\n\t\t\t\t$('#plate_points_discount').val(\"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#plate_points_discount').val(formatAsMoney(curPPDiscount));\n\t\t\t}\n\t\t}\n\n\t\t//$('#OEH_plate_points_order_discount').html(formatAsMoney(curPPDiscount));\n\t\t// This is now done in the taxesd section\n\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - curPPDiscount);\n\t}\n\n\tlet curReferralRewardDiscount = 0;\n\t// ----------------------------------------------  Referral Reward Discount\n\tif ($('#referral_reward_discount').length)\n\t{\n\t\tcurReferralRewardDiscount = $('#referral_reward_discount').val();\n\t\tif (curReferralRewardDiscount * 1 > discountablePlatePointsAmount * 1)\n\t\t{\n\t\t\tcurReferralRewardDiscount = discountablePlatePointsAmount;\n\n\t\t\tif (curReferralRewardDiscount == 0)\n\t\t\t{\n\t\t\t\t$('#referral_reward_discount').val(\"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#referral_reward_discount').val(formatAsMoney(curReferralRewardDiscount));\n\t\t\t}\n\t\t}\n\n\t\t$('#OEH_referral_reward_order_discount').html(formatAsMoney(curReferralRewardDiscount));\n\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - curReferralRewardDiscount);\n\t}\n\n\t// ---------------------------------------------- Direct Order\n\tlet directDiscountVal = Number(0);\n\n\tdirectDiscount = $('#direct_order_discount');\n\n\tif (directDiscount.length)\n\t{\n\t\tdirectDiscountVal = directDiscount.val();\n\n\t\tif (isNaN(directDiscountVal))\n\t\t{\n\t\t\tdirectDiscountVal = 0;\n\t\t}\n\n\t\tif (directDiscountVal > food_costs)\n\t\t{\n\t\t\tdirectDiscountVal = food_costs;\n\t\t\tdirectDiscount.val(directDiscountVal);\n\t\t}\n\n\t\tif (directDiscountVal)\n\t\t{\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - directDiscountVal);\n\t\t}\n\n\t\t$('#OEH_direct_order_discount').html(formatAsMoney(directDiscountVal));\n\n\t}\n\n\t// Adjust Bonus Credit and discount\n\tif (isFactoringCredit)\n\t{\n\t\t//alert(creditContribution);\n\t\t//alert(creditConsumed);\n\t\tcreditBasis += creditContribution;\n\t\tcreateBonusCredit(creditConsumed);\n\t}\n\n\t// ------------------------------------------------------------------- coupon Discount\n\n\tif (couponDiscountMethod == 'PERCENT')\n\t{\n\n\t\tlet CouponCodeStr = $('#coupon_code').val();\n\t\tvar newDiscountAmount = 0;\n\t\ttry\n\t\t{\n\t\t\t//this method correctly handles rounding in a way that matches server side\n\t\t\tlet formatterUSD = new Intl.NumberFormat('en-US', {\n\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\tmaximumFractionDigits: 2\n\t\t\t});\n\t\t\tif (CouponCodeStr == 'VOLUME' || couponlimitedToCore)\n\t\t\t{\n\t\t\t\tnewDiscountAmount =  formatterUSD.format(coreItemsSubtotal * (couponDiscountVar / 100))\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewDiscountAmount = formatterUSD.format(pre_discounts_grand_total * (couponDiscountVar / 100))\n\t\t\t}\n\t\t}\n\t\tcatch(e)\n\t\t{\n\t\t\t//original way which lead to off-by-one issue compared to server's method of rounding\n\t\t\tif (CouponCodeStr == 'VOLUME' || couponlimitedToCore )\n\t\t\t{\n\t\t\t\tnewDiscountAmount = Math.floor(coreItemsSubtotal * (couponDiscountVar));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewDiscountAmount = Math.floor(pre_discounts_grand_total * (couponDiscountVar));\n\t\t\t}\n\n\t\t\tnewDiscountAmount /= 100;\n\t\t}\n\n\n\t\t$('#couponValue').val(newDiscountAmount);\n\t}\n\n\tif (couponlimitedToFT)\n\t{\n\t\tif (couponDiscountMethod == 'FLAT')\n\t\t{\n\t\t\tlet newDiscountVal = sideDishSubTotal;\n\n\t\t\tif (newDiscountVal > couponDiscountVar)\n\t\t\t{\n\t\t\t\tnewDiscountAmount = couponDiscountVar;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewDiscountAmount = newDiscountVal;\n\t\t\t}\n\t\t}\n\n\t\tif (couponDiscountMethod == 'PERCENT')\n\t\t{\n\t\t\tlet newDiscountVal = sideDishSubTotal;\n\n\t\t\tvar newDiscountAmount = Math.floor(newDiscountVal * (couponDiscountVar));\n\n\t\t\tnewDiscountAmount /= 100;\n\t\t}\n\n\t\t$('#couponValue').val(newDiscountAmount);\n\t}\n\n\tlet couponDiscountVal = Number(0);\n\tcouponDiscount = $('#couponValue');\n\n\tif (couponDiscount.length)\n\t{\n\t\tif (couponDiscount.val() == \"\")\n\t\t{\n\t\t\tcouponDiscount.val('0.00');\n\t\t}\n\t\tcouponDiscountVal = couponDiscount.val();\n\t}\n\n\tlet couponDiscountValIsServiceFee = false;\n\tlet couponDiscountValIsDeliveryFee = false;\n\n\tif (typeof coupon != 'undefined')\n\t{\n\t\tif (coupon.limit_to_mfy_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\t\t\tlet currentServiceFee = $(\"#subtotal_service_fee\").val();\n\t\t\tif (couponDiscountVal != currentServiceFee)\n\t\t\t{\n\t\t\t\tcouponDiscountVal = currentServiceFee;\n\t\t\t}\n\n\t\t\tcouponDiscountValIsServiceFee = true;\n\t\t}\n\n\t\tif (coupon.limit_to_delivery_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\t\t\tlet currentDeliveryFee = $(\"#subtotal_delivery_fee\").val();\n\t\t\tif (couponDiscountVal != currentDeliveryFee)\n\t\t\t{\n\t\t\t\tif(parseFloat(couponDiscountVal) > parseFloat(currentDeliveryFee)){\n\t\t\t\t\tcouponDiscountVal = currentDeliveryFee;\n\t\t\t\t\tcouponDiscountValIsDeliveryFee = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//couponDiscountValIsDeliveryFee = true;\n\t\t}\n\n\t\tif (coupon.limit_to_recipe_id == '1')\n\t\t{\n\t\t\tlet prc_str = $('#prc_' + coupon.menu_item_id).text();\n\n\t\t\tif (coupon.discount_method == 'FLAT')\n\t\t\t{\n\t\t\t\tif (prc_str > coupon.discount_var)\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(prc_str - coupon.discount_var);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(prc_str);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (coupon.discount_method == 'PERCENT')\n\t\t\t{\n\t\t\t\tcouponDiscountVal = formatAsMoney(prc_str * (coupon.discount_var / 100));\n\t\t\t}\n\t\t}\n\n\t\t$('#couponValue').val(couponDiscountVal);\n\t}\n\n\tif (couponDiscountVal)\n\t{\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - couponDiscountVal);\n\t\t$('#OEH_coupon_discount').html(formatAsMoney(couponDiscountVal));\n\t}\n\n\t// ------------------------------------------------ Preferred Customer\n\tlet PUDElem = $('#PUDnoUP');\n\tlet UPDiscountElem;\n\tif (PUDElem.length && !bundleIsSelected)\n\t{\n\t\tlet selectedUP = $('input[name=PUD]:checked', '#editorForm').val();\n\n\t\tif (selectedUP == null || selectedUP == \"\")\n\t\t{\n\t\t\tselectedUP = \"noUP\";\n\t\t}\n\n\t\tlet UPDiscount = -1;\n\n\t\tlet UPType = 'none';\n\t\tlet PcntTypeValue = 0.0;\n\n\t\tif (originalUP != false || activeUP != false)\n\t\t{\n\t\t\tlet preferredData = false;\n\n\t\t\tif (selectedUP == \"activeUP\")\n\t\t\t{\n\t\t\t\tpreferredData = activeUP;\n\t\t\t}\n\t\t\telse if (selectedUP == \"originalUP\")\n\t\t\t{\n\t\t\t\tpreferredData = originalUP;\n\t\t\t}\n\n\t\t\tlet preferredCapRemaining = preferredData.preferred_cap_value;\n\n\t\t\tif (capacityUP.remainingObj.countRemaining !== null)\n\t\t\t{\n\t\t\t\tpreferredCapRemaining = capacityUP.remainingObj.countRemaining\n\t\t\t}\n\n\t\t\tif (preferredData.type == \"FLAT\")//Only allows ITEMS type\n\t\t\t{\n\n\t\t\t\tif ((preferredData.preferred_cap_type == 'ITEMS' && totalMealQuantity <= preferredCapRemaining) ||\n\t\t\t\t\tpreferredData.preferred_cap_type == 'NONE')\n\t\t\t\t{\n\t\t\t\t\tlet cost = (wholeQty - PUDExcludedFullItemsCount) * preferredData.value;\n\t\t\t\t\tlet halfCost = Number(formatAsMoney(((halfQty - PUDExcludedHalfItemsCount) * (preferredData.value / 2))));\n\t\t\t\t\tcost += halfCost;\n\t\t\t\t\tlet basis = discounted_total - cost - addonsSubtotal - productsSubTotal - PUDExcludedItemsTotal;\n\t\t\t\t\tif (preferredData.include_sides === '0')\n\t\t\t\t\t{\n\t\t\t\t\t\tbasis -= sideDishSubTotal;\n\t\t\t\t\t}\n\t\t\t\t\tUPDiscount = formatAsMoney(basis);\n\t\t\t\t\tUPType = 'flat';\n\t\t\t\t}else if((preferredData.preferred_cap_type == 'ITEMS' && totalMealQuantity > preferredCapRemaining)){\n\n\t\t\t\t\tlet cost = 0;\n\t\t\t\t\tlet halfCost = 0;\n\t\t\t\t\tlet itemCount = 0;\n\t\t\t\t\tsortedCoreItemList.sort((a, b) => (a.price < b.price) ? 1 : -1);\n\t\t\t\t\tfor(let i = 0; i < totalMealQuantity; i++){\n\t\t\t\t\t\titemCount += sortedCoreItemList[i].qty;\n\t\t\t\t\t\tif(itemCount <= preferredCapRemaining){\n\t\t\t\t\t\t\tif(sortedCoreItemList[i].serving_size > 5)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcost += sortedCoreItemList[i].qty * preferredData.value;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\thalfCost += Number(formatAsMoney(((sortedCoreItemList[i].qty - PUDExcludedHalfItemsCount) * (preferredData.value / 2))))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcost += sortedCoreItemList[i].qty * sortedCoreItemList[i].price;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcost += halfCost;\n\n\n\t\t\t\t\tlet basis = discounted_total - cost - addonsSubtotal - productsSubTotal - PUDExcludedItemsTotal;\n\t\t\t\t\tif (preferredData.include_sides === '0')\n\t\t\t\t\t{\n\t\t\t\t\t\tbasis -= sideDishSubTotal;\n\t\t\t\t\t}\n\t\t\t\t\tUPDiscount = formatAsMoney(basis);\n\t\t\t\t\tUPType = 'flat';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (preferredData.type == \"PERCENT\")\n\t\t\t{\n\t\t\t\tif ((preferredData.preferred_cap_type == 'ITEMS' && totalMealQuantity <= preferredCapRemaining) ||\n\t\t\t\t\t(preferredData.preferred_cap_type == 'SERVINGS' && servings <= preferredCapRemaining) ||\n\t\t\t\t\tpreferredData.preferred_cap_type == 'NONE')\n\t\t\t\t{\n\t\t\t\t\tlet basis = pre_discounts_grand_total - addonsSubtotal - productsSubTotal;\n\t\t\t\t\tif (preferredData.include_sides === '0')\n\t\t\t\t\t{\n\t\t\t\t\t\tbasis -= sideDishSubTotal;\n\t\t\t\t\t}\n\t\t\t\t\tlet multiplier = preferredData.value / 100;\n\t\t\t\t\tlet pud_result = basis * multiplier;\n\t\t\t\t\tlet rounded_pud_result = dd_round_amount(pud_result);\n\t\t\t\t\tUPDiscount = formatAsMoney(rounded_pud_result);\n\t\t\t\t\tUPType = 'pcnt';\n\t\t\t\t\tPcntTypeValue = preferredData.value / 100;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif (selectedUP == \"noUP\")\n\t\t{\n\t\t\tUPDiscount = 0;\n\t\t}\n\n\t\tif (UPType == 'flat')\n\t\t{\n\t\t\tif (typeof promoVal != 'undefined' && promoVal > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= promoVal;\n\t\t\t}\n\n\t\t\tif (freeMealValue > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= freeMealValue;\n\t\t\t}\n\t\t}\n\t\telse if (UPType == 'pcnt')\n\t\t{\n\t\t\tif (typeof promoVal != 'undefined' && promoVal > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= (promoVal * PcntTypeValue);\n\t\t\t\tUPDiscount = Math.round(UPDiscount * 100) / 100;\n\t\t\t}\n\n\t\t\tif (freeMealValue > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= (freeMealValue * PcntTypeValue);\n\t\t\t\tUPDiscount = Math.round(UPDiscount * 100) / 100;\n\t\t\t}\n\t\t}\n\n\t\tif (UPDiscount != -1)\n\t\t{\n\t\t\tUPDiscountElem = $('#OEH_preferred');\n\t\t\tif (UPDiscountElem.length)\n\t\t\t{\n\t\t\t\tUPDiscountElem.html(formatAsMoney(UPDiscount));\n\t\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - UPDiscount);\n\t\t\t}\n\t\t}\n\n\t}\n\n\t// ----------------------------------------------------------Membership Discount\n\n\tif (orderIsEligibleForMembershipDiscount && storeSupportsMembership)\n\t{\n\t\tlet couponAdjustment = Number(0);\n\t\tif (couponDiscountValIsServiceFee || couponDiscountValIsDeliveryFee)\n\t\t{\n\t\t\tcouponAdjustment = couponDiscountVal;\n\t\t}\n\n\t\tlet membership_discount_basis = Number((newGrandTotal * 1) + (couponAdjustment * 1));\n\t\tlet memberDiscountAmount = Number(membership_discount_basis * (membership_status.discount_var / 100));\n\t\tmemberDiscountAmount = Math.round(memberDiscountAmount * 100) / 100;\n\n\t\t$(\"#OEH_membership_discount\").html(formatAsMoney(memberDiscountAmount));\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - memberDiscountAmount);\n\n\t}\n\n\t// -------------------------------------------------------- Session Discount\n\n\tSessDisc = $('#SessDiscnoSD');\n\tif (SessDisc.length && !orderIsEligibleForMembershipDiscount)\n\t{\n\t\tlet couponAdjustment = Number(0);\n\t\tif (couponDiscountValIsServiceFee || couponDiscountValIsDeliveryFee)\n\t\t{\n\t\t\tcouponAdjustment = couponDiscountVal;\n\t\t}\n\n\t\tlet session_discount_basis = Number((newGrandTotal * 1) + (directDiscountVal * 1) + (miscFoodSubtotal * 1) + (couponAdjustment * 1));\n\n\t\tlet selectedSD = $('input[name=SessDisc]:checked', '#editorForm').val();\n\n\t\tif (selectedSD == null || selectedSD == \"\")\n\t\t{\n\t\t\tselectedSD = \"noSD\";\n\t\t}\n\n\t\tlet sessionDiscount = -1;\n\n\t\tif (selectedSD == \"originalSD\")\n\t\t{\n\n\t\t\tlet rawAmount = (session_discount_basis * originalSD.value) / 100;\n\t\t\trawAmount += .00000001; // salt to avoid rounding error\n\t\t\t// can't do this in formatAsMoney without a full validation of order manager as odd things happen\n\t\t\tsessionDiscount = formatAsMoney(rawAmount);\n\t\t}\n\t\telse if (selectedSD == \"activeSD\")\n\t\t{\n\t\t\tsessionDiscount = formatAsMoney((session_discount_basis * activeSessionDiscount.value) / 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsessionDiscount = 0;\n\t\t}\n\n\t\tSDiscountElem = $('#OEH_session_discount');\n\t\tif (SDiscountElem.length)\n\t\t{\n\t\t\tSDiscountElem.html(formatAsMoney(sessionDiscount));\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - sessionDiscount);\n\t\t}\n\n\t}\n\n\tnewGrandTotal = Number((newGrandTotal * 1) + (miscFoodSubtotal * 1));\n\t$('#OEH_misc_food_subtotal').html(formatAsMoney(miscFoodSubtotal));\n\n\tlet miscNonFoodSubtotal = Number($('#misc_nonfood_subtotal').val());\n\t$('#OEH_misc_nonfood_subtotal').html(formatAsMoney(miscNonFoodSubtotal));\n\tnewGrandTotal = Number((newGrandTotal * 1) + (miscNonFoodSubtotal * 1));\n\n\tlet serviceFee = Number($('#subtotal_service_fee').val());\n\t$('#OEH_subtotal_service_fee').html(formatAsMoney(serviceFee));\n\n\tnewGrandTotal = Number((newGrandTotal * 1) + (serviceFee * 1));\n\n\tlet deliveryFee = Number(0);\n\tif ($('#subtotal_delivery_fee')[0])\n\t{\n\t\tdeliveryFee = Number($('#subtotal_delivery_fee').val());\n\t\t$('#OEH_subtotal_delivery_fee').html(formatAsMoney(deliveryFee));\n\n\t\tnewGrandTotal = Number((newGrandTotal * 1) + (deliveryFee * 1));\n\t}\n\n\tlet BagFeeTotal = Number(0);\n\t// Bag Fees\n\tif (storeSupportsBagFees)\n\t{\n\t\tlet calculatedBagCount = getNumberBagsRequiredFromItems(halfQty + wholeQty, sideDishQty);\n\n\t\tif (!$(\"#opted_to_bring_bags\").is(\":checked\"))\n\t\t{\n\t\t\t$(\"#total_bag_count\").prop(\"disabled\", false);\n\n\t\t\tif (bagCountLockedToField)\n\t\t\t{\n\t\t\t\tnumBagsRequired = $(\"#total_bag_count\").val();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnumBagsRequired = calculatedBagCount;\n\t\t\t\t$(\"#total_bag_count\").val(calculatedBagCount);\n\t\t\t}\n\n\t\t\tif (isNaN(numBagsRequired))\n\t\t\t{\n\t\t\t\tnumBagsRequired = 0;\n\t\t\t}\n\n\t\t\tBagFeeTotal = storeDefaultBagFee * numBagsRequired;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#total_bag_count\").prop(\"disabled\", \"disabled\");\n\t\t\t$(\"#total_bag_count\").val(\"0\");\n\t\t}\n\n\t\t$(\"#OEH_subtotal_bag_fee\").html(formatAsMoney(BagFeeTotal));\n\n\t}\n\tlet mealCustomizationFeeTotal = 0;\n\t// Meal Customization Fees\n\tif (storeSupportsMealCustomization)\n\t{\n\n\t\tif($('#manual_customization_fee').val() == 'true')\n\t\t{\n\t\t\t//use manually entered value\n\t\t\tmealCustomizationFeeTotal = Number($(\"#subtotal_meal_customization_fee\").val());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmealCustomizationFeeTotal =  calculateMealCustomizationFee(customizableMealQty);\n\t\t\t$(\"#subtotal_meal_customization_fee\").val(formatAsMoney(mealCustomizationFeeTotal));\n\t\t}\n\n\t\tif ($(\"#opted_to_customize_recipes\").is(\":checked\"))\n\t\t{\n\t\t\t$(\"#subtotal_meal_customization_fee\").prop(\"disabled\", \"disabled\");\n\t\t\t$(\"#subtotal_meal_customization_fee\").val(\"\");\n\t\t\tmealCustomizationFeeTotal = 0;\n\t\t\t$(\"#customization-row-container\").hide();\n\t\t}\n\n\t\t$(\"#OEH_subtotal_meal_customization_fee\").html(formatAsMoney(mealCustomizationFeeTotal));\n\t}\n\n\t// --------------------------------------------------------------------- tax\n\n\t// Currently the only taxed product is the enrollment fee which is taxed at a special rate\n\tlet newNonFoodTax = formatAsMoney(miscNonFoodSubtotal * (curNonFoodTax / 100));\n\tlet enrollmentTax = formatAsMoney(productsSubTotal * (curEnrollmentTax / 100));\n\n\tlet newDeliveryTax = 0;\n\tif (!hasDeliveryFeeWithCoupon)\n\t{\n\t\tnewDeliveryTax = formatAsMoney(deliveryFee * (curDeliveryTax / 100));\n\t}\n\n\tnewNonFoodTax *= 1; // convert to float\n\tnewNonFoodTax += (enrollmentTax * 1);\n\t//TODO: will have other products than enrollment someday.\n\tif (productsSubTotal)\n\t{\n\t\t$('#nonFoodTaxLabel').html('Non-Food & Enrollment Tax');\n\t}\n\telse\n\t{\n\t\t$('#nonFoodTaxLabel').html('Non-Food Tax');\n\n\t}\n\n\tlet newFoodTax = 0;\n\tlet newServiceTax = 0;\n\n\tif (curPPDiscount > 0)\n\t{\n\t\tlet food_portion_of_points_credit = 0;\n\t\tlet fee_portion_of_points_credit = 0;\n\n\t\tif (hasServiceFeeWithMFYCoupon)\n\t\t{\n\t\t\tfood_portion_of_points_credit = curPPDiscount;\n\t\t\tfee_portion_of_points_credit = 0;\n\t\t}\n\t\telse if (discountMFYFeeFirst && serviceFee > 0)\n\t\t{\n\n\t\t\tif (curPPDiscount > serviceFee)\n\t\t\t{\n\t\t\t\tfood_portion_of_points_credit = curPPDiscount - serviceFee;\n\t\t\t\tfee_portion_of_points_credit = serviceFee;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfee_portion_of_points_credit = curPPDiscount;\n\t\t\t\tfood_portion_of_points_credit = 0;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet foodPortionOfMaxDeduction = discountablePlatePointsAmount - serviceFee;\n\n\t\t\tif (curPPDiscount > foodPortionOfMaxDeduction)\n\t\t\t{\n\t\t\t\tlet remainderAfterFoodDiscount = curPPDiscount - foodPortionOfMaxDeduction;\n\t\t\t\tfood_portion_of_points_credit = foodPortionOfMaxDeduction;\n\t\t\t\tfee_portion_of_points_credit = remainderAfterFoodDiscount;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfood_portion_of_points_credit = curPPDiscount;\n\t\t\t\tfee_portion_of_points_credit = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (hasServiceFeeWithMFYCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - food_portion_of_points_credit - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewServiceTax = 0;\n\t\t}\n\t\telse if (hasDeliveryFeeWithCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - food_portion_of_points_credit - serviceFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewDeliveryTax = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - serviceFee - food_portion_of_points_credit - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tlet mealCustomizationFee = Number($('#subtotal_meal_customization_fee').val())\n\t\t\tif (isNaN(mealCustomizationFee)) { mealCustomizationFee = 0;}\n\t\t\tnewServiceTax = formatAsMoney(((((serviceFee + mealCustomizationFee) - fee_portion_of_points_credit)) * (curServiceTax / 100)) + .000001);\n\t\t}\n\n\t\t$('#OEH_plate_points_order_discount_food').html(formatAsMoney(food_portion_of_points_credit));\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(fee_portion_of_points_credit));\n\t}\n\telse\n\t{\n\t\tif (hasServiceFeeWithMFYCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewServiceTax = 0;\n\t\t}\n\t\telse if (hasDeliveryFeeWithCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - serviceFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewDeliveryTax = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - serviceFee - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tlet mealCustomizationFee = Number($('#subtotal_meal_customization_fee').val())\n\t\t\tif (isNaN(mealCustomizationFee)) { mealCustomizationFee = 0;}\n\t\t\tnewServiceTax = formatAsMoney((serviceFee + mealCustomizationFee) * (curServiceTax / 100) + .000001);\n\t\t}\n\n\t\t$('#OEH_plate_points_order_discount_food').html(formatAsMoney(0));\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(0));\n\t}\n\n\tlet newBagFeeTax = formatAsMoney(BagFeeTotal * (curBagFeeTax / 100) + .000001);\n\n\ttaxElem = document.getElementById('OEH_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newNonFoodTax);\n\t}\n\n\ttaxElem = document.getElementById('OEH_food_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newFoodTax);\n\t}\n\n\ttaxElem = document.getElementById('OEH_service_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newServiceTax);\n\t}\n\n\ttaxElem = document.getElementById('OEH_delivery_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newDeliveryTax);\n\t}\n\n\ttaxElem = document.getElementById('OEH_bag_fee_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newBagFeeTax);\n\t}\n\n\tnewGrandTotal = Number((newGrandTotal * 1) + (BagFeeTotal * 1) + (mealCustomizationFeeTotal * 1));\n\n\tlet preTaxTotal = Number(newGrandTotal);\n\tnewGrandTotal = (newGrandTotal * 1) + (newFoodTax * 1) + (newNonFoodTax * 1) + (newServiceTax * 1) + (newDeliveryTax * 1) + (newBagFeeTax * 1);\n\n\t/*\n\t * *\n\t * LTD ROUND UP, MUST BE AFTER GRAND TOTAL\n\t * *\n\t */\n\tlet round_up_donation = 0;\n\n\tlet subtotal_round_up = Math.ceil(newGrandTotal);\n\tlet subtotal_round_up_diff = parseFloat((subtotal_round_up - (newGrandTotal)).toFixed(2));\n\n\tif (subtotal_round_up_diff == 0)\n\t{\n\t\tsubtotal_round_up_diff = 1.00;\n\t}\n\n\tif ($('#round_up_nearest_dollar').val() != subtotal_round_up_diff)\n\t{\n\t\t$('#round_up_nearest_dollar').val(subtotal_round_up_diff).text('$ ' + formatAsMoney(subtotal_round_up_diff));\n\t\t$('#add_ltd_round_up').trigger('change');\n\t}\n\n\tif ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\tif ($('#ltd_round_up_select').find(':selected').attr('id') == 'round_up_nearest_dollar')\n\t\t{\n\t\t\tround_up_donation = subtotal_round_up_diff;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tround_up_donation = parseFloat($('#ltd_round_up_select').val());\n\t\t}\n\t}\n\n\tif (isNaN(round_up_donation))\n\t{\n\t\tround_up_donation = 0;\n\t}\n\n\t$('#OEH_ltd_round_up').html(formatAsMoney(round_up_donation));\n\n\tnewGrandTotal += Number(round_up_donation);\n\t/*\n\t * end Round UP\n\t */\n\n\t// -------------------------------------------------------------------- grand total\n\t$('#OEH_grandtotal').html(formatAsMoney(newGrandTotal));\n\t$('#OEH_new_total').html(formatAsMoney(newGrandTotal));\n\t$('#OEH_delta').html(formatAsMoney((orderInfoGrandTotal - newGrandTotal) * -1));\n\n\tlet paymentTotal = 0;\n\tif ($('#OEH_paymentsTotal').length)\n\t{\n\t\tpaymentTotal = $('#OEH_paymentsTotal').html();\n\t}\n\n\tlet remainingBalance = Number(formatAsMoney(paymentTotal - newGrandTotal));\n\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance * -1));\n\n\t// Values are now calculated and the summary display updated\n\t// Next Display \"balance\" messages and set up payments\n\n\tif (orderState == 'CANCELLED')\n\t{\n\t\tremainingBalance = paymentTotal;\n\t\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance));\n\n\t}\n\n\tif (remainingBalance > 0)\n\t{\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to the customer.\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_customer_owed');\n\t\t$(\"#newPaymentDiv\").hide();\n\n\t\tif (canAdjustDelayedPayment && currentDPAmount > 0)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').show();\n\t\t}\n\n\t\t$('#payment1_type').val('');\n\t\t$('#payment2_type').val('');\n\t\tchangePayment1('');\n\t\tchangePayment2('');\n\n\t\tpaymentChanges = true;\n\n\t\t$(\"#use_store_credits\").prop('checked', false);\n\t\t$(\"#use_store_credits\").prop('disabled', true);\n\n\t}\n\telse if (remainingBalance < 0)\n\t{\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to your store.\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_store_owed');\n\t\t$(\"#newPaymentDiv\").show();\n\t\t$('#creditDiv').hide();\n\n\t\tif (canAdjustDelayedPayment)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').hide();\n\t\t}\n\n\t\t$(\"#use_store_credits\").prop('disabled', false);\n\n\t\tlet doNewLivePaymentAdjustments = true;\n\t\tif (doNewLivePaymentAdjustments)\n\t\t{\n\n\t\t\tlet defaultPaymentAmount = remainingBalance * -1;\n\n\t\t\tif ($(\"#use_store_credits\").is(\":checked\"))\n\t\t\t{\n\n\t\t\t\tlet amountStoreCredit = Number($(\"#store_credits_amount\").val());\n\t\t\t\tif (isNaN(amountStoreCredit.valueOf()))\n\t\t\t\t{\n\t\t\t\t\tamountStoreCredit = Number(0);\n\t\t\t\t}\n\n\t\t\t\tdefaultPaymentAmount -= amountStoreCredit.valueOf();\n\t\t\t}\n\n\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount);\n\n\t\t\tif ($('#payment1_type').val() == 'CC')\n\t\t\t{\n\t\t\t\t$('#payment1_cc_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if ($('#payment1_type').val() == 'CHECK')\n\t\t\t{\n\t\t\t\t$('#payment1_check_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if ($('#payment1_type').val().split(\"_\")[0] == 'REF')\n\t\t\t{\n\t\t\t\t$('#payment1_ref_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if (($('#payment1_type').val() == 'GIFT_CERT' || $('#payment1_type').val() == \"GIFT_CARD\") && $('#payment2_type').val() != \"\")\n\t\t\t{\n\t\t\t\tlet payment1Amount = null;\n\t\t\t\tif ($('#payment1_type').val() == 'GIFT_CERT')\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number($('#payment1_gc_total_amount').val());\n\t\t\t\t}\n\t\t\t\telse if ($('#payment1_type').val() == 'GIFT_CARD')\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number($('#debit_gift_card_amount').val());\n\t\t\t\t}\n\n\t\t\t\tif (isNaN(payment1Amount.valueOf()))\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number(0);\n\t\t\t\t}\n\n\t\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount - payment1Amount.valueOf());\n\t\t\t\tif ($('#payment2_type').val() == 'CC')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_cc_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\t\t\t\telse if ($('#payment2_type').val() == 'CHECK')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_check_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\t\t\t\telse if ($('#payment2_type').val() == 'CASH')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_cash_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\t\t\t\telse if ($('#payment2_type').val().split(\"_\")[0] == 'REF')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_ref_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t}\n\telse // == 0\n\t{\n\t\t$(\"#balance_msg\").html(\"0.00\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_balanced');\n\t\t$(\"#newPaymentDiv\").show();\n\t\t$('#creditDiv').hide();\n\n\t\tif (canAdjustDelayedPayment)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').hide();\n\t\t}\n\n\t\t$(\"#use_store_credits\").prop('disabled', false);\n\n\t\tassignBalanceToRefTransactions(0);\n\t}\n\n\tif (newGrandTotal == 0 && $('#payment1_type').val() == \"\" && $('#payment2_type').val() == \"\" && !onTimeShotAtSupplyingZeroPaymentHasOccurred && orderState == 'SAVED')\n\t{\n\t\t$('#payment1_type').val('CASH');\n\t\tchangePayment1('CASH');\n\t\t$('#payment1_cash_total_amount').val(\"0.00\");\n\n\t\tonTimeShotAtSupplyingZeroPaymentHasOccurred = true;\n\t}\n\n\tlet autoAdjustDiv = $('#autoAdjustDiv');\n\tif (autoAdjustDiv.length)\n\t{\n\n\t\tif (remainingBalance != 0 && canAutoAdjust)\n\t\t{\n\t\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || remainingBalance < 0))\n\t\t\t{\n\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>adjust customer's delayed payment.</b></span>\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (remainingBalance > 0)\n\t\t\t\t{\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>credit customer's credit card now.</b></span>\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>charge original credit card now.</b></span>\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tautoAdjustDiv.show();\n\t\t\tif (!forceManualAutoAdjust)\n\t\t\t{\n\t\t\t\t$('#autoAdjust').prop('checked', true);\n\t\t\t\thandleAutoAdjust($('#autoAdjust').get()[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// if the div is hidden skip these steps\n\n\t\t\tif (autoAdjustDiv.is(\":visible\"))\n\t\t\t{\n\t\t\t\tautoAdjustDiv.hide();\n\t\t\t\t$('#autoAdjust').prop('checked', false);\n\t\t\t\t$('#payment1_type').val('');\n\t\t\t\t$('#payment2_type').val('');\n\t\t\t\tchangePayment1('');\n\t\t\t\tchangePayment2('');\n\t\t\t}\n\t\t}\n\t}\n\n\t$('#help_msg').html(\"\");\n\n\t// enforce a few rules by disallowing checkout\n\tif ($('#submit_changes').length)\n\t{\n\n\t\tif (servings > 0 || sideDishQty > 0 || addonsSubtotal > 0)\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\n\t\t}\n\n\t\tif (directDiscountVal >= (Number(preTaxTotal) + Number(directDiscountVal)) && preTaxTotal != 0)\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\n\t\t\t$('#help_msg').html($('#help_msg').html() + \"You cannot use a Direct Order Discount that is equal to or greater than the food cost total. Please use the \\\"No Charge\\\" payment type to give away an order.\");\n\t\t}\n\n\t}\n\n\tif ($('#help_msg').length)\n\t{\n\t\tif ($('#help_msg').html() != \"\")\n\t\t{\n\t\t\t$('#help_msg').show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#help_msg').hide();\n\t\t}\n\t}\n\n\treportPaymentStatus(false);\n\n\tHideLineItemsIfZero();\n\n\tif (orderState != 'NEW')\n\t{\n\t\tupdateChangeList();\n\t}\n\n}\n\n$(document).on('focusin', '.bundle-subitem-qty', function (e) {\n\n\t$(this).data('org_val', $(this).val());\n\n}).on('keyup change', '.bundle-subitem-qty', function (e) {\n\n\tlet canIncrement = canIncrementBundleSubItem($(this), '.bundle-subitem-qty');\n\n\tif (canIncrement !== true)\n\t{\n\t\t$(this).val($(this).data('org_val'));\n\n\t\tdd_message({\n\t\t\ttitle: 'Max Items Reached',\n\t\t\tmessage: canIncrement\n\t\t});\n\t}\n\telse\n\t{\n\t\t$(this).data('org_val', $(this).val());\n\n\t\tqtyUpdate(this);\n\t}\n\n\tcalculateTotal();\n\n});\n\nfunction canIncrementBundleSubItem(input, selector)\n{\n\tlet mid = $(input).data('menu_item_id');\n\tlet pid = $(input).data('parent_item');\n\n\tlet itemInfo = sideStationBundleInfo[pid].bundle[mid];\n\tlet parentItemInfo = sideStationBundleInfo[pid];\n\tlet parentNumItemsRequired = parseInt(parentItemInfo.number_items_required);\n\tlet groupID = parseInt(itemInfo.bundle_to_menu_item_group_id) || 0;\n\n\t// check that we aren't going over the total\n\tlet total_org = 0;\n\tlet total_current = 0;\n\tlet groupInfo = [];\n\n\t$(selector + '[data-parent_item=\"' + pid + '\"]').each(function () {\n\n\t\tlet mid = $(this).data('menu_item_id');\n\t\tlet pid = $(this).data('parent_item');\n\n\t\tlet inputItemInfo = sideStationBundleInfo[pid].bundle[mid];\n\t\tlet inputGroupID = parseInt(inputItemInfo.bundle_to_menu_item_group_id) || 0;\n\n\t\tlet this_org = parseInt($(this).data('org_val')) || 0;\n\t\tlet this_cur = parseInt($(this).val()) || 0;\n\n\t\ttotal_org += this_org;\n\t\ttotal_current += this_cur;\n\n\t\tif (typeof groupInfo[inputGroupID] == 'undefined')\n\t\t{\n\t\t\tgroupInfo[inputGroupID] = {\n\t\t\t\ttotal_org: 0,\n\t\t\t\ttotal_current: 0\n\t\t\t}\n\t\t}\n\n\t\tgroupInfo[inputGroupID].total_org += this_org;\n\t\tgroupInfo[inputGroupID].total_current += this_cur;\n\n\t});\n\n\t// check if over the bundle total\n\tif (total_current > (parentNumItemsRequired * parseInt($('#qty_' + pid).val())))\n\t{\n\t\treturn 'Number of items for the bundle has been reached';\n\t}\n\n\t// check if over the group total\n\tif (parentItemInfo.bundle_groups.length > 0)\n\t{\n\t\tif (groupInfo[groupID].total_current > (parseInt(parentItemInfo.bundle_groups[groupID].number_items_required) * parseInt($('#qty_' + pid).val())))\n\t\t{\n\t\t\treturn 'Number of items for the group has been reached';\n\t\t}\n\t}\n\n\t// all else\n\treturn true;\n\n}\n\n\nfunction preferenceChangeListener(pref, setting, user, callback){\n\n\tpref = pref.toUpperCase();\n\tlet pref_value = USER_PREFERENCES[pref].value;\n\n\tif ($.isPlainObject(pref_value) && $.isPlainObject(setting))\n\t{\n\t\tsetting = JSON.stringify($.extend(USER_PREFERENCES[pref].value, setting));\n\t}\n\telse\n\t{\n\t\tsetting = setting.toString()\n\t}\n\n\tif(pref.includes('_DETAILS')){\n\t\tlet key = 'MEAL_EXCLUDE_'+pref.replace('MEAL_','').replace('_DETAILS','');\n\t\tmeal_customization_preferences[key].details = setting;\n\t}else{\n\t\tmeal_customization_preferences[pref].value = setting;\n\t}\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderCustomization',\n\t\t\top: 'update_order_meal_customization',\n\t\t\torder_id: order_id,\n\t\t\tcustomizations: JSON.stringify(meal_customization_preferences)\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tif(json.cost > 0){\n\t\t\t\t\t$('#customization-fee-row').show();\n\t\t\t\t\t$('#MealCustomizationFeeRow').show();\n\t\t\t\t}else{\n\t\t\t\t\t$('#customization-fee-row').hide();\n\t\t\t\t\t$('#MealCustomizationFeeRow').hide();\n\t\t\t\t}\n\n\t\t\t\tif($('#manual_customization_fee').val() != 'true')\n\t\t\t\t{\n\t\t\t\t\t$('#subtotal_meal_customization_fee').val(formatAsMoney(json.cost));\n\t\t\t\t\t$(\"#OEH_subtotal_meal_customization_fee\").html(formatAsMoney(json.cost));\n\t\t\t\t}\n\t\t\t\thandleMealCustomizationFeeInput();\n\n\t\t\t\tif(typeof callback !== 'undefined'){\n\t\t\t\t\tcallback(json);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\n$(document).on('change', '#shipping_phone_number', function (e) {\n\n\t$('.shipping_phone_number_new_div').hideFlex();\n\t$('#shipping_phone_number_new').prop('required', false);\n\n\tif ($(this).val() == 'new')\n\t{\n\t\t$('.shipping_phone_number_new_div').showFlex();\n\t\t$('#shipping_phone_number_new').prop('required', true);\n\n\t}\n});\n\n$(document).on('change', '#hide-zero-sides', function (e) {\n\n\tif ($(this).is(':checked'))\n\t{\n\t\t$('#sidesTbl [data-orig-remaining=\"0\"]').hideFlex();\n\t}\n\telse\n\t{\n\t\t$('#sidesTbl [data-orig-remaining]').showFlex();\n\t}\n});\n\n$(document).on('change keyup', '.delivery-input', function (e) {\n\n\tdeliveryChanges = false;\n\n\t$('.delivery-input').each(function () {\n\n\t\tif ($(this).data('org_value'))\n\t\t{\n\t\t\tlet val = $(this).val();\n\t\t\tlet org_value = $(this).data('org_value');\n\n\t\t\tif (val != org_value)\n\t\t\t{\n\t\t\t\tdeliveryChanges = true;\n\n\t\t\t}\n\t\t}\n\n\t});\n\n\tupdateChangeList();\n\n});\n\nfunction costInputFeesTab(obj)\n{\n\t// TODO: validation\n\n\tsetFeesTabAsDirty();\n\n\tcalculateTotal();\n}\n\nfunction setFeesTabAsDirty()\n{\n\tfeesTabIsDirty = true;\n}"],"names":["itemChanges","feeChanges","discountOrPaymentChanges","deliveryChanges","discountChanges","reportingChanges","paymentChanges","initialSessionDiscountSetting","initialPreferredUserDiscountSetting","changeList","isFactoringCredit","currentCreditAvailable","stationNeedsAttention","relatedOrdersAreLoaded","currentlySavingOrder","onTimeShotAtSupplyingZeroPaymentHasOccurred","needPlatePointsMaxDiscountChangeWarning","needRefferalRewardMaxDiscountChangeWarning","lastMaxPPDiscountAmount","lastMaxReferralRewardDiscountAmount","feesTabIsDirty","admin_order_mgr_init","store_id","STORE_DETAILS","id","orderState","setupForNewOrder","setupForSavedOrder","setupForActiveOrder","hasBundle","bundleSetup","setupSiteAdminFunctions","initChangeList","calculateTotal","setAllPaymentFieldsToUnrequired","setupCouponState","setUpKeyHandlers","getQueryVariable","query","window","location","search","substring","vars","split","newQueryString","first","i","length","pair","historyPush","url","handle_special_instruction_notes","handle_cancel_order","handle_delete_saved_order","handle_free_menu_item_edit","handle_fundraiser_selection","handle_ltd_round_up","handleDirectOrderDiscountFocusing","$","trigger","handleAutoOrderButtons","initNoInventoryRows","handleDinnerDollarAccordion","handleAdminNoteAccordion","setMealCustomizationDefault","default_meal_customization_to_selected","prop","click","$header","this","$content","html","is","slideToggle","each","remaining","data","servings","entree_id","$itemCount","val","find","addClass","hide","e","size","on","countMissedMeals","entreeID","curInventory","entreeIDToInventoryMap","dd_message","title","message","setItemTabAsDirty","preventDefault","intenseLoggingOn","focus","select","blur","curVal","trim","isNaN","intenseLogging","console","log","saveSpecialInstructions","special_instructions","strip_tags","ajax","type","timeout","dataType","processor","user_id","op","order_id","success","json","processor_success","updateInstructionsOrgValues","processor_message","error","objAJAXRequest","strError","responseText","response","booking_id","do_op","do","note","textarea_elem","special_instruction_note","removeClass","show","nl2br","lastCheckedGiftCertNumber","document","onkeypress","OMDefaultKeyHandler","evt","event","charCode","which","keyCode","processCode","stopPropagation","getChangeListHTML","height","width","modal","div_id","dialogClass","noOk","position","my","at","of","close","ui","remove","flagName","checkbox","newState","oldState","cancel","confirm","flag","new_state","attr","updateMealCustomizationOrgValues","dd_toast","updateItemsOrgValues","isDreamTaste","isFundraiser","updateChangeList","saveAll","saveItems","saveDiscountsUponCompletion","activateOnSaveDiscountsCompletion","saveDeliveryAddressUponCompletion","itemsList","introItemsList","subItemsList","is_intro","item_id","misc_food_subtotal","misc_nonfood_subtotal","subtotal_service_fee","subtotal_delivery_fee","misc_food_subtotal_desc","misc_nonfood_subtotal_desc","service_fee_description","ltdOrderedMealsArray","bagFeeTotal","bagFeeCount","storeSupportsBagFees","storeDefaultBagFee","opted_to_bring_bags","manual_customization_fee","opted_to_customize","mealCustomizationFee","items","meal_customization_fee","intro_items","sub_items","itemTabIsDirty","saveDiscounts","setSessionAndSave","session_id","displayModalWaitDialog","dd_csrf_token","full_session_warning_required","bounce","getTokenToken","Reschedule","org_session_id","transition_type","suppressEmail","saved_booking_id","order_state","new_session_id","new_session_time","RetrieveCalendar","canDelayPayment","hideFlex","showFlex","session_discount","value","activeSessionDiscount","session_info","session_type_title","remaining_slots","remaining_intro_slots","client_ops","hasOwnProperty","href","key","formatAsMoney","onSetSessionAndSave","obj","onSaveItems","HideLineItemsIfZero","timestamp","discountEligable","limited_access","isDeliveryAddressComplete","validated","saveDeliveryAddress","payOnCompletion","token","shipping_data","onAddPaymentAndActivate","onDeliveryTabSelected","onDeliveryTabDeselected","onSessionTabSelected","onSessionTabDeselected","onItemsTabSelected","onItemsTabDeselected","onFeesTabSelected","onFeesTabDeselected","onPaymentTabSelected","handle_admin_order_notes","onPaymentTabDeselected","onRelatedOrdersTabSelected","onRelatedOrdersTabDeselected","onNotesTabSelected","handle_guest_account_notes","handle_admin_carryover_notes","onNotesTabDeselected","onPaymentSelected","onPaymentDeselected","onSiteAdminTabSelected","onSiteAdminTabDeselected","updateDiscountOrgValues","updateActiveOrder","go_to_confirm","direct_order_discount","PUDSetting","plate_points_discount","SessDiscSetting","DR_level","curOrderLevel","dream_rewards_level","JSON","stringify","changeListStr","_validate_discounts","couponFreeMenuItemRequired","_check_elements","get","referral_reward_discount","coupon_id","coupon_free_menu_item","fundraiser_id","fundraiser_value","add_ltd_round_up","ltd_round_up_select","updateReportingOrgValues","couponFreeMenuItem","paymentToken","send","paymentNumber","warnOfOutstandingSavedOrdersOnFullSession","addOnly","payment1Data","next_dest","contentWindow","pp_success","error_code","buttons","Okay","reload","reloadOnFailure","comment_payload","PayFlow_Payload","addNameValuePair","user_email","expdate","csc","amt","payload","USER_DETAILS","use_store_credits","store_credit_amount","DP_State","depositAmount","store_specific_deposit","payflowErrorURL","parmList","retrieveEncodedString","tr_action","pfp_test_mode","transparent_redirect_link","create_and_submit_form","action","target","input","SECURETOKEN","SECURETOKENID","tokenID","PARMLIST","getPaymentData","payment_number","paymentData","number","amount","cert_type","ccNameOnCard","ccType","ccMonth","ccYear","cc_security_code","billing_address","billing_city","billing_state_id","billing_postal_code","is_store_specific_flat_rate_deposit_delayed_payment","do_not_ref","save_card","DPSetting","alert","indexOf","reference_id","validatePayment1","inputArray","validates","substr","depositWarningStr","CC1Amount","validatePayment2","addPaymentAndActivate","minimumVal","minimumType","order_minimum","minimum","minimum_type","servingsCount","enforce36ServingMinimum","underFilledMessage","toLowerCase","Number","itemCount","orderIsEligibleForMembershipDiscount","storeSupportsMembership","membership_status","eligible_menus","menu_id","number_qualifying_orders","quantityOrdered","valueOf","requiredMinimum","changesBlurb","getAbbreviatedSummaryString","discounts_are_valid","bundleIsSelected","numBundItems","countSelectedBundleItems","intro_servings_required","save2PaymentsAndBookOrder","payment2Type","payment2Data","supports_transparent_redirect","max_plate_points_deduction","async","payment_data","add_payment_data","delay_remainder","billing_name","billing_zip","chain_token","savePayment2","handleDirectPayment","payment1Type","mainPaymentData","additionalPaymentData","store_credits_amount","closeOnEscape","Refresh","cur_session_id","onDayClick","doReschedule","sessionTime","curSessionDate","open","siblings","onRescheduleClick","isDiscounted","control_message","Continue","Cancel","onSessionClick","monthChange","monthVal","handle_delayed_payment","GUEST_PREFERENCES","TC_DELAYED_PAYMENT_AGREE","lang","en","tc","terms_and_conditions","delayed_payment","parent","Agree","off","set_user_pref","Decline","delayed_payment_decline","createBonusCredit","creditConsumed","creditBasis","removeBonusCredit","handleSummaryDisplayChange","checked","ShowAllLineItems","bagFeeOrg","bagFee","bagFeeTaxOrg","bagFeeTax","serviceFeeOrg","serviceFee","deliveryFeeOrg","deliveryFee","serviceTaxOrg","serviceTax","miscFoodOrg","miscFood","miscNonFoodOrg","miscNonFood","miscMealCustomizationFeeOrg","miscMealCustomizationFee","doDiscountOrg","doDiscount","couponDiscountOrg","couponDiscount","platePointsDiscountOrg","platePointsDiscount","referralRewardDiscountOrg","referralRewardDiscount","membershipDiscountOrg","membershipDiscount","sessionDiscountOrg","pudDiscount","foodTaxOrg","foodTax","nonFoodTaxOrg","nonFoodTax","deliveryTaxOrg","deliveryTax","productsSubtotalOrg","productsSubtotal","sort_by_price","a","b","price","drawChangeList","htmlStr","item","stdMenuItems","localStorage","getItem","pricing_type","translateServingSize","indexedItems","FTMenuItems","index","hadMiscCostChanges","miscCosts","getHumanReadableName","sideBundleItem","miscDescs","order_type","bundleItems","discounts","reporting","coupon","change_type","code","previous","newVal","toUpperCase","ccRefundTotal","parseFloat","result","bundleChecked","stdItemCount","FTItemCount","descIDStr","desc","bundleOrgVal","discountsHTML","newSDValue","newPUDValue","showSaveButton","delivery","Meal Customization","Meal Customization Fee","orgVal","diff","customizationSelection","origCustomizationSelection","name","text","toFixed","orgCouponVal","curCouponVal","curCouponCode","handleAutoAdjust","balance","canAdjustDelayedPayment","currentDPAmount","changePayment1","adjustPendingDelayedPayment","assignBalanceToRefTransactions","ident","existingPaymentAmountArray","reportPaymentStatus","getAbbreviatedChangeString","addedStd","removedStd","addedFT","removedFT","addedSBI","removedSBI","addedBI","removedBI","addPaymentToLockedOrder","submitPage","form","is_valid","confirm_and_check_form","dialogHeight","appendTo","submit","resetPage","_check_form","dd_round_amount","inAmount","tempVal","parseInt","pennyFraction","Math","floor","updateSideStationStatus","qty","slideUp","css","slideDown","requiredItemCount","sideStationBundleInfo","number_items_required","numSelected","bundle","mid","menu_item","itemQty","fixed_quantity","inv_qty","servings_per_item","bundle_groups","bid","group_info","stationHelpElem","help_message","handleMealCustomizationFeeInput","handleBagCountInput","bagCountLockedToField","handleBagWaiverInput","handleMealCustomizationWaiverInput","mealCustomizationFeeFieldLocked","mealCustomizationFeeTotal","calculateMealCustomizationFee","customizableMealQty","priceConfig","meal_customization_cost","fee","operator","cost","limit","limitLow","limitHigh","getNumberBagsRequiredFromItems","entreeCount","sidesCount","entreesPerBag","bagsRequired","entreeRemainder","total","entrees","core_servings","halfQty","wholeQty","introQty","sideDishQty","sideDishSubTotal","bundlesSubTotal","productsSubTotal","coreItemsSubtotal","bundlesQty","discounted_total","creditContribution","main_items_count","PUDExcludedItemsTotal","PUDExcludedFullItemsCount","PUDExcludedHalfItemsCount","hasServiceFeeWithMFYCoupon","hasDeliveryFeeWithCoupon","sortedCoreItemList","itemsSelected","x","org_remaining","itemId","orgAmount","getAttribute","temp_servings","PlatePointsRulesVersion","serving_size","push","selectedBundleItemCount","selectedBundleServingsCount","originallyHadBundle","bundleInfo","tasteBundleMenuData","number_servings_required","selectedWholeBundleItemCount","selectedHalfBundleItemCount","tasteItemQty","discountablePlatePointsAmount","limit_to_mfy_fee","discount_method","currentServiceFee","limit_to_delivery_fee","currentDeliveryFee","getElementById","couponlimitedToFT","tempCouponVal","background-color","color","removeAttr","discountableReferralRewardAmount","maxPPCredit","maxPPDeduction","curPPDiscount","maxRRCredit","maxRRDeduction","curRRDiscount","addonsSubtotal","addonsQty","itemNumber","qty_str","prc_str","addQty","addonsQtyNumber","addPrc","addPrcNumber","core_items_count","totalMealQuantity","itemCountLabel","itemCountAdjustmentAmount","displayServingsAdjustment","couponTypeElem","cfm_size","displayMealCount","displayServingCount","orderEditSuccess","newAddonQty","setItem","premarkup_total","freeMealValue","newAddonAmount","round","miscFoodSubtotal","food_costs","newGrandTotal","pre_discounts_grand_total","curReferralRewardDiscount","directDiscountVal","directDiscount","couponDiscountMethod","CouponCodeStr","newDiscountAmount","formatterUSD","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","couponlimitedToCore","format","couponDiscountVar","newDiscountVal","couponDiscountVal","couponDiscountValIsServiceFee","couponDiscountValIsDeliveryFee","limit_to_recipe_id","menu_item_id","discount_var","PUDElem","UPDiscountElem","selectedUP","UPDiscount","UPType","PcntTypeValue","originalUP","activeUP","preferredData","preferredCapRemaining","preferred_cap_value","capacityUP","remainingObj","countRemaining","preferred_cap_type","halfCost","basis","include_sides","sort","multiplier","pud_result","rounded_pud_result","promoVal","couponAdjustment","membership_discount_basis","memberDiscountAmount","SessDisc","session_discount_basis","selectedSD","sessionDiscount","rawAmount","originalSD","SDiscountElem","miscNonFoodSubtotal","BagFeeTotal","calculatedBagCount","numBagsRequired","storeSupportsMealCustomization","newNonFoodTax","curNonFoodTax","enrollmentTax","curEnrollmentTax","newDeliveryTax","curDeliveryTax","newFoodTax","newServiceTax","food_portion_of_points_credit","fee_portion_of_points_credit","discountMFYFeeFirst","foodPortionOfMaxDeduction","remainderAfterFoodDiscount","curFoodTax","curServiceTax","newBagFeeTax","curBagFeeTax","taxElem","innerHTML","preTaxTotal","round_up_donation","subtotal_round_up","ceil","subtotal_round_up_diff","orderInfoGrandTotal","paymentTotal","remainingBalance","changePayment2","doNewLivePaymentAdjustments","defaultPaymentAmount","amountStoreCredit","payment1Amount","autoAdjustDiv","canAutoAdjust","forceManualAutoAdjust","canIncrement","canIncrementBundleSubItem","qtyUpdate","selector","pid","itemInfo","parentItemInfo","parentNumItemsRequired","groupID","bundle_to_menu_item_group_id","total_org","total_current","groupInfo","inputItemInfo","inputGroupID","this_org","this_cur","preferenceChangeListener","pref","setting","user","callback","pref_value","USER_PREFERENCES","isPlainObject","extend","toString","includes","replace","meal_customization_preferences","details","customizations","org_value","costInputFeesTab","setFeesTabAsDirty"],"mappings":"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"}
var itemChanges=!1,discountOrPaymentChanges=!1,discountChanges=!1,reportingChanges=!1,paymentChanges=!1,initialSessionDiscountSetting="noSD",initialPreferredUserDiscountSetting="noUP",changeList=null,isFactoringCredit=!1,currentCreditAvailable=0,stationNeedsAttention=!1,relatedOrdersAreLoaded=!1,currentlySavingOrder=!1,onTimeShotAtSupplyingZeroPaymentHasOccurred=!1,needPlatePointsMaxDiscountChangeWarning=!1,lastMaxPPDiscountAmount=-1;function admin_order_mgr_init(){if(store_id!=STORE_DETAILS.id&&(STORE_DETAILS.id=store_id),"NEW"==orderState?setupForNewOrder():"SAVED"==orderState?setupForSavedOrder():setupForActiveOrder(),hasBundle&&bundleSetup(),setupSiteAdminFunctions(),initChangeList(),"NEW"!=orderState&&(calculateTotal(),setAllPaymentFieldsToUnrequired(),setupCouponState()),setUpKeyHandlers(),"true"==getQueryVariable("session_full")){for(var e=window.location.search.substring(1).split("&"),t="?",a=!0,s=0;s<e.length;s++){"session_full"!=e[s].split("=")[0]&&(a||(t+="&"),t+=e[s]),a=!1}historyPush({url:t})}handle_special_instruction_notes(),handle_cancel_order(),handle_delete_saved_order(),handle_free_menu_item_edit(),handle_fundraiser_selection()}var intenseLoggingOn=!0;function intenseLogging(e){window.console&&intenseLoggingOn&&console.log("OM Intense logging: "+e)}function saveSpecialInstructions(){var e=strip_tags($("#order_user_notes").val());$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,user_id:user_id,op:"update_special_instructions",order_id:order_id,special_instructions:e},success:function(e){e.processor_success?updateInstructionsOrgValues():(intenseLogging("saveSpecialInstructions: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){intenseLogging("saveSpecialInstructions: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function handle_special_instruction_notes(){$('[id^="gd_special_instruction_note_button-"]').each((function(){$(this).on("click",(function(e){var t=$(this).data("booking_id"),a=$(this).data("user_id"),s="get",n="";1==$(this).data("edit_mode")&&(s="save",n=strip_tags($("#gd_special_instruction_note-"+t+" > textarea").val())),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",op:"update_special_instructions",do:s,store_id:STORE_DETAILS.id,user_id:a,order_id:order_id,note:n},success:function(e){if(e.processor_success)if("get"==s){var a=$("<textarea></textarea>").addClass("form-control").val(e.special_instruction_note?e.special_instruction_note:"").on("keyup",(function(e){$(this).val()!=strip_tags($(this).val())&&$(this).val(strip_tags($(this).val()))}));$("#gd_special_instruction_note-"+t).addClass("special_instruction_note_edit").html(a),$("#gd_special_instruction_note_button-"+t).data("edit_mode",!0).html("Save Note"),$("#gd_special_instruction_note_cancel_button-"+t).data("special_instruction_note_value",e.special_instruction_note?e.special_instruction_note:"").on("click",(function(e){$("#gd_special_instruction_note-"+$(this).data("booking_id")).removeClass("special_instruction_note_edit").html($(this).data("special_instruction_note_value")),$("#gd_special_instruction_note_button-"+$(this).data("booking_id")).data("edit_mode",!1).html("Special Instructions"),$(this).hide()})).show()}else $("#gd_special_instruction_note-"+t).removeClass("special_instruction_note_edit").html(nl2br(e.special_instruction_note)),$("#gd_special_instruction_note_cancel_button-"+t).hide(),$("#gd_special_instruction_note_button-"+t).data("edit_mode",!1).html("Special Instructions")},error:function(e,t){intenseLogging("handle_special_instruction_notes: "+t+" | "+e.responseText),response="Unexpected error"}})}))}))}var lastCheckedGiftCertNumber=null;function setUpKeyHandlers(){document.onkeypress=OMDefaultKeyHandler,$("#coupon_code").on("keypress",(function(e){return 13!=((e=e||event).charCode?e.charCode:e.which?e.which:e.keyCode)||(processCode(),e.stopPropagation(),!1)})),$("#order_user_notes").on("keypress",(function(e){return e.stopPropagation(),!0})),$("#payment1_gc_payment_number").on("keyup",(function(e){return 15!=$(this).val().length||isNaN($(this).val())||$(this).val()==lastCheckedGiftCertNumber||dd_message({title:"Warning",message:"It appears that you may be entering a gift Card number. If so, select Gift Card from payment selector. This is the Certificate (Gift Certificate) payment type."}),lastCheckedGiftCertNumber=$(this).val(),!0}))}function OMDefaultKeyHandler(e){return 13!=((e=e||event).charCode?e.charCode:e.which?e.which:e.keyCode)}function initChangeList(){$("#changeListTab").on("click",(function(){var e=getChangeListHTML();e&&""!=e||(e="<h3><i>No Changes</i></h3>"),dd_message({title:"Change List",message:e,height:620,width:300,modal:!1,div_id:"changelist",dialogClass:"fixedDialog",noOk:!0,position:{my:"left top",at:"left bottom",of:this},close:function(e,t){$("#changelist").remove()}})}))}function setupSiteAdminFunctions(){$("#in-store_status, #plate_points_status").on("click",(function(){var e=this.id,t=$(this);if("ACTIVE"!=orderState)dd_message({title:"Error",message:"These flags can only be set on ACTIVE orders."});else{var a="off";$(this).is(":checked")&&(a="on");var s=1;"on"==a&&(s=0),dd_message({title:"Status Update",message:"Are you sure you want to update the order status?",cancel:function(){t.prop("checked",!!s)},confirm:function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,user_id:user_id,op:"update_status_flag",order_id:order_id,flag:e,new_state:a},success:function(e){e.processor_success?dd_message({title:"Update Success",message:e.processor_message}):(intenseLogging("update_status_flag: "+e.processor_message),$(this).attr("checked",s),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){intenseLogging("update_status_flag: "+t+" | "+e.responseText),$(this).attr("checked",s),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}})}}))}function updateItemsOrgValues(){$("[id^='qty_']").each((function(){$(this).data("org_value",$(this).val())})),$("[data-dd_type='item_field']").each((function(){$(this).data("org_value",$(this).val())})),$("#selectedBundle").data("org_value",$("#selectedBundle").is(":checked")?"1":"0"),isDreamTaste||isFundraiser?$("[id^='bnd_']").each((function(){$(this).data("org_value",$(this).val())})):$("[id^='bnd_']").each((function(){$(this).data("org_value",$(this).is(":checked")?"1":"0")})),updateChangeList()}function saveAll(){saveItems(!0)}function saveItems(e){if(intenseLogging("saveItems() called"),currentlySavingOrder)dd_toast({message:"Items are still being saved",position:"topcenter"});else{dd_toast({message:"Items Saved",position:"topcenter"});var t={},a={},s={},n="false";isDreamTaste||isFundraiser?($("[id^=bnd_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];t[e]=$(this).val()}})),$("[id^=qty_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];t[e]=$(this).val()}}))):($("#selectedBundle").is(":checked")&&(n="true",$("[id^=bnd_]").each((function(){if($(this).is(":checked")){var e=this.id.split("_")[1];a[e]="on"}}))),$("[id^=qty_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];t[e]=$(this).val()}})),$("[id^=sbi_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];s[e]=$(this).val()}})));var i=$("#misc_food_subtotal").val();isNaN(i)&&(i="0.00");var o=$("#misc_nonfood_subtotal").val();isNaN(o)&&(o="0.00");var r=$("#subtotal_service_fee").val();isNaN(r)&&(r="0.00");var d=$("#misc_food_subtotal_desc").val(),c=$("#misc_nonfood_subtotal_desc").val(),_=$("#service_fee_description").val(),l=$("#order_user_notes").val();currentlySavingOrder=!0,$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,user_id:user_id,op:"update_items",order_id:order_id,items:t,misc_food_subtotal:i,misc_nonfood_subtotal:o,subtotal_service_fee:r,misc_food_subtotal_desc:d,misc_nonfood_subtotal_desc:c,service_fee_description:_,is_intro:n,intro_items:a,sub_items:s,special_instructions:l},success:function(t){t.processor_success?(itemTabIsDirty=!1,updateItemsOrgValues(),currentlySavingOrder=!1,intenseLogging("saveItems() successful"),e&&saveDiscounts(!1)):(currentlySavingOrder=!1,intenseLogging("update_items: "+t.processor_message),dd_message({title:"Error",message:t.processor_message}))},error:function(e,t){currentlySavingOrder=!1,intenseLogging("update_items: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}}function setSessionAndSave(e){intenseLogging("setSessionAndSave() called"),displayModalWaitDialog("saving_div","Setting session. Please wait ..."),$.ajax({url:"/processor",type:"POST",timeout:9e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"set_session_and_save",session_id:e,user_id:user_id,dd_csrf_token:$("input[name=dd_csrf_token]","#editorForm").val()},success:function(e){e.processor_success?(intenseLogging("setSessionAndSave() successful"),e.full_session_warning_required?bounce("/?page=admin_order_mgr&order="+e.order_id+"&session_full=true"):bounce("/?page=admin_order_mgr&order="+e.order_id)):($("#saving_div").remove(),$("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken),intenseLogging("set_session_and_save: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#saving_div").remove(),intenseLogging("set_session_and_save: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function Reschedule(e){intenseLogging("Reschedule() called"),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"reschedule",session_id:session_id,user_id:user_id,order_id:order_id,saved_booking_id:saved_booking_id,org_session_id:e},success:function(e){e.processor_success?(intenseLogging("Reschedule() successful"),session_id=e.new_session_id,$("#curSessionDate").html(e.new_session_time),RetrieveCalendar(0),e.canDelayPayment?$(".delayedPaymentSection").showFlex():$(".delayedPaymentSection").hideFlex(),e.session_discount?($("#noSessionDiscountRow").hide(),$("#newSessionDiscountBody").show(),$("#sessionDiscountTypeSpan").html(e.session_discount.type),$("#sessionDiscountValueSpan").html(e.session_discount.value),activeSessionDiscount.id=e.session_discount.id,activeSessionDiscount.type=e.session_discount.type,activeSessionDiscount.value=e.session_discount.value):($("#noSessionDiscountRow").show(),$("#newSessionDiscountBody").hide(),activeSessionDiscount.id=0,activeSessionDiscount.type="none",activeSessionDiscount.value=0),$("#curSessionTypeSpan").html(e.session_info.session_type_text),$("#curSessionRemainingSlotsSpan").html(e.session_info.remaining_slots),$("#curSessionRemainingIntroSlotsSpan").html(e.session_info.remaining_intro_slots),-1!=e.serviceFeeUpdate&&($("#subtotal_service_fee").val(formatAsMoney(e.serviceFeeUpdate)),$("#service_fee_description").val(e.serviceFeeDescUpdate),calculateTotal())):(intenseLogging("reschedule: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){response="Unexpected error: "+t,intenseLogging("reschedule: "+t+" | "+e.responseText),dd_message({title:"Error",message:response})}})}function onSetSessionAndSave(e){return intenseLogging("onSetSessionAndSave() called"),setSessionAndSave($("#selected_session").attr("data-session_id")),!1}function onSaveItems(){return intenseLogging("onSaveItems() called"),saveItems(),!1}function setupForNewOrder(){HideLineItemsIfZero();var e=getQueryVariable("month");e||(e="0"),RetrieveCalendar(e),$("#addPaymentAndActivate").show()}function setupForSavedOrder(){$("#addPaymentAndActivate").show(),$("#SessDiscnoSD").length&&(initialSessionDiscountSetting=$("input[name='SessDisc']:checked","#editorForm").val()),$("#PUDnoUP").length&&(initialPreferredUserDiscountSetting=$("input[name='PUD']:checked","#editorForm").val())}function setupForActiveOrder(){discountEligable.limited_access&&($("#payments_tab_li").click(),$("#items_tab_li").addClass("disabled"),$("#sessions_tab_li").addClass("disabled"),$("#discountsDiv").find(":input").prop("disabled",!0),$("#discountsDiv").find("*").addClass("om_disabled")),$("#addPaymentAndActivate").hide(),$("#SessDiscnoSD").length&&(initialSessionDiscountSetting=$("input[name='SessDisc']:checked","#editorForm").val()),$("#PUDnoUP").length&&(initialPreferredUserDiscountSetting=$("input[name='PUD']:checked","#editorForm").val())}function onSessionTabSelected(){RetrieveCalendar(0)}function onSessionTabDeselected(){return!0}function onItemsTabSelected(){}function onItemsTabDeselected(){return"ACTIVE"!=orderState&&itemTabIsDirty&&saveItems(),!0}function onPaymentTabSelected(){handle_free_menu_item_edit()}function onPaymentTabDeselected(){return"ACTIVE"!=orderState&&(discountChanges||reportingChanges)&&saveDiscounts(!1),!0}function onRelatedOrdersTabSelected(){relatedOrdersAreLoaded||(intenseLogging("Loading related Orders"),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"retrieve_related_orders",session_id:session_id,order_id:order_id,user_id:user_id},success:function(e){intenseLogging("Loading related Orders successful"),$("#related_orders").html(e.data),$("#loading_related_orders").remove(),relatedOrdersAreLoaded=!0},error:function(e,t){$("#loading_related_orders").remove(),intenseLogging("retrieve_related_orders: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}}))}function onRelatedOrdersTabDeselected(){return!0}function onNotesTabSelected(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"get_history",session_id:session_id,user_id:user_id,order_id:order_id},success:function(e){$("#history_div").html(e.html),handle_guest_account_notes(),handle_admin_carryover_notes(),handle_admin_order_notes()},error:function(e,t){response="Unexpected error: "+t,intenseLogging("get_history: "+t+" | "+e.responseText),dd_message({title:"Error",message:response})}})}function onNotesTabDeselected(){return!0}function onPaymentSelected(){"ACTIVE"!=orderState?($("#addPaymentAndActivateButton").attr("disabled",!1),paymentChanges=!0,updateChangeList()):(paymentChanges=!0,updateChangeList())}function onPaymentDeselected(){return"ACTIVE"!=orderState?($("#addPaymentAndActivateButton").attr("disabled",!0),updateChangeList(),paymentChanges=!1):(paymentChanges=!1,updateChangeList()),!0}function onSiteAdminTabSelected(){}function onSiteAdminTabDeselected(){return!0}function updateDiscountOrgValues(){$("#SessDiscnoSD").length&&(initialSessionDiscountSetting=$("input[name='SessDisc']:checked","#editorForm").val()),$("#PUDnoUP").length&&(initialPreferredUserDiscountSetting=$("input[name='PUD']:checked","#editorForm").val()),$("#org_coupon_id").val($("#coupon_id").val()),$("#plate_points_discount, #direct_order_discount").each((function(){$(this).data("org_value",$(this).val())})),updateChangeList()}function updateActiveOrder(e,t){intenseLogging("updateActiveOrder() called");var a={},s={},n={},i="false";isDreamTaste||isFundraiser?($("[id^=bnd_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];a[e]=$(this).val()}})),$("[id^=qty_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];a[e]=$(this).val()}}))):($("#selectedBundle").is(":checked")&&(i="true",$("[id^=bnd_]").each((function(){if($(this).is(":checked")){var e=this.id.split("_")[1];s[e]="on"}}))),$("[id^=qty_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];a[e]=$(this).val()}})),$("[id^=sbi_]").each((function(){if($(this).val()>0){var e=this.id.split("_")[1];n[e]=$(this).val()}})));var o=$("#misc_food_subtotal").val();isNaN(o)&&(o="0.00");var r=$("#misc_nonfood_subtotal").val();isNaN(r)&&(r="0.00");var d=$("#subtotal_service_fee").val();isNaN(d)&&(d="0.00");var c=$("#misc_food_subtotal_desc").val(),_=$("#misc_nonfood_subtotal_desc").val(),l=$("#service_fee_description").val(),u=$("#direct_order_discount").val();isNaN(u)&&(u="0.00");var m=$("input[name=PUD]:checked","#editorForm").val();null!=m&&""!=m||(m="noUP");var p=$("#plate_points_discount").val();isNaN(p)&&(p="0.00");var g=$("input[name=SessDisc]:checked","#editorForm").val();null!=g&&""!=g||(g="noSD");var h=0;if($("#dr_level_for_order").length){var v=$("#dr_level_for_order").val();v>0&&(h=v)}$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,user_id:user_id,op:"update_active_order",order_id:order_id,items:a,misc_food_subtotal:o,misc_nonfood_subtotal:r,subtotal_service_fee:d,misc_food_subtotal_desc:c,misc_nonfood_subtotal_desc:_,service_fee_description:l,is_intro:i,intro_items:s,sub_items:n,direct_order_discount:u,PUDSetting:m,plate_points_discount:p,SessDiscSetting:g,dream_rewards_level:h,changeList:JSON.stringify(changeList),changeListStr:getChangeListHTML(),dd_csrf_token:$("input[name=dd_csrf_token]","#editorForm").val()},success:function(a){a.processor_success?(intenseLogging("updateActiveOrder() successful"),itemTabIsDirty=!1,updateItemsOrgValues(),updateDiscountOrgValues(),e&&onAddPaymentAndActivate(e,t,a.getTokenToken)):(intenseLogging("update_active_order: "+a.processor_message),dd_message({title:"Error",message:a.processor_message}))},error:function(e,t){intenseLogging("update_active_order: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function _validate_discounts(){return!couponFreeMenuItemRequired||_check_elements([$("#free_menu_item_coupon").get(0)])}function saveDiscounts(e){if(intenseLogging("saveDiscounts() called"),!_validate_discounts())return!1;e||dd_toast({message:"Discounts Saved",position:"topcenter"});var t=$("#direct_order_discount").val();isNaN(t)&&(t="0.00");var a=$("input[name=PUD]:checked","#editorForm").val();null!=a&&""!=a||(a="noUP");var s=$("#plate_points_discount").val();isNaN(s)&&(s="0.00");var n=$("input[name=SessDisc]:checked","#editorForm").val();null!=n&&""!=n||(n="noSD");var i=0;if($("#dr_level_for_order").length){var o=$("#dr_level_for_order").val();o>0&&(i=o)}var r=0,d=0;$("#coupon_id").val()&&(couponFreeMenuItemRequired&&$("#free_menu_item_coupon").val()&&(d=$("#free_menu_item_coupon").val()),r=$("#coupon_id").val());var c=$("#fundraiser_id").val(),_=$("#fundraiser_value").val();$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"update_discounts",order_id:order_id,user_id:user_id,direct_order_discount:t,PUDSetting:a,plate_points_discount:s,SessDiscSetting:n,coupon_id:r,coupon_free_menu_item:d,dream_rewards_level:i,fundraiser_id:c,fundraiser_value:_},success:function(t){t.processor_success?(intenseLogging("saveDiscounts() successful"),updateDiscountOrgValues(),updateReportingOrgValues(),d&&($("#free_menu_item_coupon").attr("disabled",!0),couponFreeMenuItem=d),e&&onAddPaymentAndActivate(!1,!0,t.paymentToken)):(intenseLogging("update_discounts: "+t.processor_message),dd_message({title:"Error",message:t.processor_message}))},error:function(e,t){intenseLogging("update_discounts: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function updateReportingOrgValues(){$("#fundraiser_id").data("org_value",$("#fundraiser_id").val()),$("#fundraiser_value").data("org_value",$("#fundraiser_value").val()),updateChangeList()}function send(e,t,a,s,n,i){intenseLogging("send() called for payment# "+t),$("#paypal-result").on("load",(function(){intenseLogging("result iFrame loading");try{var e=$("#paypal-result").get(0).contentWindow.next_dest,t=$("#paypal-result").get(0).contentWindow.pp_success}catch(e){return intenseLogging("exception occurred accessing result iframe"),$("#paying_div").remove(),void dd_message({title:"Exception",message:"We are sorry but an unexpected error occurred during payment processing. Please try again or contact support."})}if(t)intenseLogging("success found in iframe"),bounce(e);else{var a=$("#paypal-result").get(0).contentWindow.error_code,s=$("#paypal-result").get(0).contentWindow.message;if(intenseLogging("error found in iframe: #"+a+" | "+s),void 0===a)a="Generic",s="Some required information is missing or incorrect. Please correct the fields below and try again.",intenseLogging("error code undefined in iframe"),$("#paying_div").remove(),dd_message({title:"Error: "+a,message:s});else if(e&&e.length>0)$("#paying_div").remove(),dd_message({title:"Error: "+a,message:s,noOk:!0,buttons:{Okay:function(){bounce(e)}}});else{$("#paying_div").remove(),$("#paypal-result").get(0).contentWindow.reloadOnFailure?(intenseLogging("reloadOnFailure found in iframe: reloading"),s+="<br /><br /><span style='color:red'>The credit card payment failed however the order was booked with the gift certificate. The page will now reload.</span>",dd_message({title:"Error: "+a,message:s,noOk:!0,buttons:{Okay:function(){bounce(window.location.href)}}})):dd_message({title:"Error: "+a,message:s})}}}));var o=new PayFlow_Payload;if(o.addNameValuePair("UserID",user_id),o.addNameValuePair("StoreID",STORE_DETAILS.id),o.addNameValuePair("OrderID",order_id),o.addNameValuePair("Email",user_email),1==t){var r=$("#payment1_ccMonth").val();r+=$("#payment1_ccYear").val();var d=$("#payment1_cc_security_code").val(),c=$("#payment1_cc_total_amount").val();(p=new PayFlow_Payload).addNameValuePair("admin_user_id",USER_DETAILS.id),p.addNameValuePair("user_id",user_id),p.addNameValuePair("store_id",STORE_DETAILS.id),p.addNameValuePair("order_id",order_id),p.addNameValuePair("caller_id","fadmin_order"),s&&p.addNameValuePair("add_only","true"),n&&p.addNameValuePair("go_to_confirm","true"),p.addNameValuePair("is_second_payment","false");var _=0;$("#use_store_credits").length&&$("#use_store_credits").is(":checked")&&(_=$("#store_credits_amount").val(),p.addNameValuePair("use_sc","true"),p.addNameValuePair("sc_amt",_));var l=0;if($("#payment1_is_store_specific_flat_rate_deposit_delayed_payment1").length&&(l=$("input:radio[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked").val())>0){p.addNameValuePair("DP_State",l),p.addNameValuePair("org_amount",c);var u=20;if(1==l&&store_specific_deposit&&store_specific_deposit>20&&(u=store_specific_deposit),1*c<=1*u)return void dd_message({title:"Delayed Payment Error",message:"The amount of the payment is less than or equal to the deposit. Delayed Payment cannot be used."});c=u}"undefined"==typeof payflowErrorURL&&(payflowErrorURL="https://dreamdinners.com/processor?processor=admin_payflow_callback");var m="ERRORURL="+payflowErrorURL+"&ACCT="+$("#payment1_ccNumber").val()+"&EXPDATE="+r+"&CSC="+d+"&AMT="+c+"&USER1="+p.retrieveEncodedString()+"&COMMENT1="+o.retrieveEncodedString()}else{r=$("#payment2_ccMonth").val();r+=$("#payment2_ccYear").val();var p;d=$("#payment2_cc_security_code").val(),c=$("#payment2_cc_total_amount").val();if((p=new PayFlow_Payload).addNameValuePair("user_id",user_id),p.addNameValuePair("store_id",STORE_DETAILS.id),p.addNameValuePair("order_id",order_id),p.addNameValuePair("caller_id","fadmin_order"),p.addNameValuePair("add_only","false"),p.addNameValuePair("is_second_payment","true"),n&&p.addNameValuePair("go_to_confirm","true"),i)for(var g in p.addNameValuePair("hasPayment1",!0),i)i.hasOwnProperty(g)&&p.addNameValuePair("p1_"+g,i[g]);l=0;if($("#payment2_is_store_specific_flat_rate_deposit_delayed_payment1").length&&(l=$("input:radio[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked").val())>0){p.addNameValuePair("DP_State",l),p.addNameValuePair("org_amount",c);u=20;if(1==l&&store_specific_deposit&&store_specific_deposit>20&&(u=store_specific_deposit),1*c<=1*u)return void dd_message({title:"Delayed Payment Error",message:"The amount of the payment is less than or equal to the deposit. Delayed Payment cannot be used."});c=u}"undefined"==typeof payflowErrorURL&&(payflowErrorURL="https://dreamdinners.com/processor?processor=admin_payflow_callback");m="ERRORURL="+payflowErrorURL+"&ACCT="+$("#payment2_ccNumber").val()+"&EXPDATE="+r+"&CSC="+d+"&AMT="+c+"&USER1="+p.retrieveEncodedString()+"&COMMENT1="+o.retrieveEncodedString()}var h="https://payflowlink.paypal.com";if("undefined"!=typeof pfp_test_mode&&pfp_test_mode)h="https://pilot-payflowlink.paypal.com";"undefined"!=typeof transparent_redirect_link&&(h=transparent_redirect_link),intenseLogging("posting to PayFlow"),create_and_submit_form({action:h,target:"paypal-result",input:{SECURETOKEN:e.token,SECURETOKENID:e.tokenID,PARMLIST:m}})}function getPaymentData(e,t){if("CC"!=e)var a={type:e,number:0,amount:0,cert_type:"",note:$("#payment_note").val()};else a={type:e,number:0,amount:0,cert_type:"",note:$("#payment_note").val(),ccNameOnCard:"",ccType:"CC",ccMonth:"",ccYear:"",cc_security_code:"",billing_address:"",billing_postal_code:"",is_store_specific_flat_rate_deposit_delayed_payment:0,do_not_ref:0};if(1==t){switch(e){case"REFERENCE":a.amount=$("#payment1_reference_total_amount").val();break;case"GIFT_CERT":a.amount=$("#payment1_gc_total_amount").val(),a.cert_type=$("#payment1_gift_cert_type").val(),a.number=$("#payment1_gc_payment_number").val();break;case"CASH":a.amount=$("#payment1_cash_total_amount").val(),a.number=$("#payment1_cash_payment_number").val();break;case"REFUND_CASH":a.amount=$("#payment1_refund_cash_total_amount").val(),a.number=$("#payment1_refund_cash_payment_number").val();break;case"CHECK":a.amount=$("#payment1_check_total_amount").val(),a.number=$("#payment1_check_payment_number").val();break;case"CREDIT":a.amount=$("#OEH_remaing_balance").html();break;case"CC":a.amount=$("#payment1_cc_total_amount").val(),a.number=$("#payment1_ccNumber").val(),a.ccNameOnCard=$("#payment1_ccNameOnCard").val(),a.ccType=$("#payment1_ccType").val(),a.ccMonth=$("#payment1_ccMonth").val(),a.ccYear=$("#payment1_ccYear").val(),a.cc_security_code=$("#payment1_cc_security_code").val(),a.billing_address=$("#billing_address_1").val(),a.billing_postal_code=$("#billing_postal_code_1").val();var s=$("input[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked").val();a.is_store_specific_flat_rate_deposit_delayed_payment=s;break;case"GIFT_CARD":a.amount=$("#debit_gift_card_amount").val(),a.number=$("#debit_gift_card_number").val();break;case"DPADJUST":break;case"REFERENCE_OTHER":alert("investigate REFERENCE_OTHER");break;default:0==e.indexOf("REF_")&&(a.amount=$("#payment1_ref_total_amount").val(),a.reference_id=$("#p1_ref_id").html())}return a}if(2==t){switch(e){case"CASH":a.amount=$("#payment2_cash_total_amount").val(),a.number=$("#payment2_cash_payment_number").val();break;case"CHECK":a.amount=$("#payment2_check_total_amount").val(),a.number=$("#payment2_check_payment_number").val();break;case"CC":a.amount=$("#payment2_cc_total_amount").val(),a.number=$("#payment2_ccNumber").val(),a.ccNameOnCard=$("#payment2_ccNameOnCard").val(),a.ccType=$("#payment2_ccType").val(),a.ccMonth=$("#payment2_ccMonth").val(),a.ccYear=$("#payment2_ccYear").val(),a.cc_security_code=$("#payment2_cc_security_code").val(),a.billing_address=$("#billing_address_2").val(),a.billing_postal_code=$("#billing_postal_code_2").val();s=$("input[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked").val();a.is_store_specific_flat_rate_deposit_delayed_payment=s;break;case"REFERENCE_OTHER":alert("investigate REFERENCE_OTHER");break;default:0==e.indexOf("REF_")&&(a.amount=$("#payment2_ref_total_amount").val(),a.reference_id=$("#p2_ref_id").html())}return a}}function validatePayment1(e){var t=null,a=!0;switch("REF_"==e.substr(0,4)&&(e="REFERENCE_OTHER"),e){case"REFERENCE":t=$("#payment1_reference :input"),a=_check_elements(t);break;case"GIFT_CERT":t=$("#payment1_gc :input"),a=_check_elements(t);break;case"CASH":t=$("#payment1_cash :input"),a=_check_elements(t);break;case"REFUND_CASH":t=$("#payment1_refund_cash :input"),a=_check_elements(t);break;case"CHECK":t=$("#payment1_check :input"),a=_check_elements(t);break;case"CREDIT":t=$("#payment1_credit :input"),a=_check_elements(t);break;case"CC":t=$("#payment1_cc :input"),a=_check_elements(t);var s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#payment1_is_store_specific_flat_rate_deposit_delayed_payment1").is(":checked")||$("#payment1_is_store_specific_flat_rate_deposit_delayed_payment2").is(":checked"))1*$("#payment1_cc_total_amount").val()<=1*store_specific_deposit&&($("#payment1_CC_DP_note").html(s),$("#payment1_CC_DP_note").show(),a=!1);break;case"GIFT_CARD":t=$("#payment1_debit_gift_card :input"),a=_check_elements(t);break;case"DPADJUST":t=$("#dp_adjust_div :input"),a=_check_elements(t);break;case"REFERENCE_OTHER":t=$("#payment1_ref :input"),a=_check_elements(t);s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#ref_payment1_is_store_specific_flat_rate_deposit_delayed1").is(":checked")||$("#ref_payment1_is_store_specific_flat_rate_deposit_delayed2").is(":checked"))1*$("#payment1_ref_total_amount").val()<=1*store_specific_deposit&&($("#payment1_Ref_DP_note").html(s),$("#payment1_Ref_DP_note").show(),a=!1)}return a}function validatePayment2(e){var t=null,a=!0;switch("REF_"==e.substr(0,4)&&(e="REFERENCE_OTHER"),e){case"CASH":case"CHECK":t=$("#payment2_check :input"),a=_check_elements(t);break;case"CC":t=$("#payment2_cc :input"),a=_check_elements(t);var s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#payment2_is_store_specific_flat_rate_deposit_delayed_payment1").is(":checked")||$("#payment2_is_store_specific_flat_rate_deposit_delayed_payment2").is(":checked"))1*$("#payment2_cc_total_amount").val()<=1*store_specific_deposit&&($("#payment2_CC_DP_note").html(s),$("#payment2_CC_DP_note").show(),a=!1);break;case"REFERENCE_OTHER":t=$("#payment2_ref :input"),a=_check_elements(t);s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#ref_payment2_is_store_specific_flat_rate_deposit_delayed1").is(":checked")||$("#ref_payment2_is_store_specific_flat_rate_deposit_delayed2").is(":checked"))1*$("#payment2_ref_total_amount").val()<=1*store_specific_deposit&&($("#payment2_Ref_DP_note").html(s),$("#payment2_Ref_DP_note").show(),a=!1)}return a}function addPaymentAndActivate(){if(intenseLogging("addPaymentAndActivate() called"),Number($("#OEH_number_servings").html()).valueOf()<36&&!isDreamTaste&&!isFundraiser&&!$("#selectedBundle").is(":checked"))intenseLogging("addPaymentAndActivate() - warning for less than 36 servings"),dd_message({title:"Warning",message:"This order is for less than 36 servings. Do you wish to continue?",confirm:function(){intenseLogging("addPaymentAndActivate() - confirm dialog");var e="You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?",t=getAbbreviatedSummaryString();dd_message({title:"Add Payment and Book Order",div_id:"aPaBO",message:e+="<br /><br />"+t,modal:!0,width:400,height:460,confirm:function(){saveDiscounts(!0)}})}});else{if(intenseLogging("addPaymentAndActivate() - confirm dialog"),hasBundle){var e=!1;if($("#selectedBundle").is(":checked")&&(e=!0),e){var t=countSelectedBundleItems();if(t<18)return dd_message({title:"Error",message:"Please select at least 18-servings of Meal Prep Starter Pack items."}),!1;if(t>18)return dd_message({title:"Error",message:"Please select no more than 18 servings of Meal Prep Starter Pack items."}),!1}}if(stationNeedsAttention)return dd_message({title:"Error",message:"Please review the Side Station and ensure the correct number of items are selected."}),!1;var a="You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?",s=getAbbreviatedSummaryString();dd_message({title:"Add Payment and Book Order",message:a+="<br /><br />"+s,modal:!0,width:400,height:460,confirm:function(){saveDiscounts(!0)}})}return!0}function save2PaymentsAndBookOrder(e,t,a){intenseLogging("save2PaymentsAndBookOrder() called");var s=getPaymentData(e,2);if("CC"==e&&supports_transparent_redirect){if("CC"==e){var n=$("#payment2_ccNameOnCard").val(),i=$("#billing_address_2").val(),o=$("#billing_postal_code_2").val(),r=$("#payment2_cc_total_amount").val();$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,user_id:user_id,op:"get_token",order_id:order_id,amount:r,billing_name:n,billing_address:i,billing_zip:o,dd_csrf_token:a,chain_token:!0},success:function(e){($("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken),e.processor_success)?(intenseLogging("save2PaymentsAndBookOrder() get_token successful"),send(e.token,2,e.warnOfOutstandingSavedOrdersOnFullSession,!1,!1,t)):($("#paying_div").remove(),intenseLogging("save2PaymentsAndBookOrder get_token: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("save2PaymentsAndBookOrder get_token: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}}else{var d=0;$("#ref_payment2_is_store_specific_flat_rate_deposit_delayed0").length&&(1==(d=$("input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked").val())&&(d=4),2==d&&(d=5)),$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"save_payment",order_id:order_id,session_id:session_id,user_id:user_id,payment_data:t,add_payment_data:s,delay_remainder:d,dd_csrf_token:a},success:function(e){e.processor_success?(intenseLogging("save2PaymentsAndBookOrder() save_payment successful"),e.warnOfOutstandingSavedOrdersOnFullSession?bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true"):bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id)):($("#paying_div").remove(),intenseLogging("save2PaymentsAndBookOrder save_payment: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("save2PaymentsAndBookOrder save_payment: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}}function savePayment2(e,t,a){intenseLogging("savePayment2() called");var s=getPaymentData(e,2);if("CC"==e&&supports_transparent_redirect){if("CC"==e){var n=$("#payment2_ccNameOnCard").val(),i=$("#billing_address_2").val(),o=$("#billing_postal_code_2").val(),r=$("#payment2_cc_total_amount").val();$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,user_id:user_id,op:"get_token",order_id:order_id,amount:r,billing_name:n,billing_address:i,billing_zip:o,dd_csrf_token:a,chain_token:!0},success:function(e){($("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken),e.processor_success)?(intenseLogging("savePayment2() get_token successful"),send(e.token,2,t,!1,!1)):($("#paying_div").remove(),intenseLogging("savePayment2 get_token: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("savePayment2 get_token: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}}else{var d=0;$("#ref_payment2_is_store_specific_flat_rate_deposit_delayed0").length&&(1==(d=$("input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked").val())&&(d=4),2==d&&(d=5)),$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"add_payment",order_id:order_id,user_id:user_id,payment_data:s,delay_remainder:d,dd_csrf_token:a},success:function(e){e.processor_success?(intenseLogging("savePayment2() add_payment successful"),t?bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true"):bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id)):($("#paying_div").remove(),intenseLogging("savePayment2 add_payment: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("savePayment2 add_payment: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}}function handleDirectPayment(e,t,a){intenseLogging("handleDirectPayment() called");var s=$("#payment1_type").val(),n=!1;if("GIFT_CERT"!=s&&"GIFT_CARD"!=s||(n=$("#payment2_type").val()),!validatePayment1(s))return!1;if(n&&""!=n&&!validatePayment2(n))return!1;displayModalWaitDialog("paying_div","Sending Payment. Please wait ...");var i=getPaymentData(s,1),o=0;$("#ref_payment1_is_store_specific_flat_rate_deposit_delayed0").length&&(1==(o=$("input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked").val())&&(o=4),2==o&&(o=5));var r=!1,d=0;$("#use_store_credits").length&&$("#use_store_credits").is(":checked")&&(d=$("#store_credits_amount").val(),r=!0);var c=null,_=null;n?(c=getPaymentData(n,2),_=i):c=i,$.ajax({url:"/processor",type:"POST",timeout:9e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:store_id,op:"save_payment",order_id:order_id,user_id:user_id,payment_data:c,add_payment_data:_,delay_remainder:o,use_store_credits:r,store_credits_amount:d,dd_csrf_token:a,payment2Type:n},success:function(e){e.processor_success?(intenseLogging("handleDirectPayment() save_payment successful"),e.warnOfOutstandingSavedOrdersOnFullSession?bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true"):bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id)):($("#paying_div").remove(),intenseLogging("handleDirectPayment save_payment: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){"timeout"==t?dd_message({title:"Order Processing Timed Out",message:"The request to finalized the order has timed out. This may be due to network congestion. The order may have been successful. The page will refresh and show the actual current status.",modal:!0,noOk:!0,closeOnEscape:!1,buttons:{Refresh:function(){$(this).remove(),bounce(window.location.href)}}}):($("#paying_div").remove(),intenseLogging("handleDirectPayment save_payment: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response}))}})}function onAddPaymentAndActivate(e,t,a){if(intenseLogging("onAddPaymentAndActivate() called"),!supports_transparent_redirect)return handleDirectPayment(e,t,a);var s=$("#payment1_type").val(),n=!1;if("GIFT_CERT"!=s&&"GIFT_CARD"!=s||(n=$("#payment2_type").val()),!validatePayment1(s))return!1;if(n&&""!=n&&!validatePayment2(n))return!1;displayModalWaitDialog("paying_div","Sending Payment. Please wait ...");var i=getPaymentData(s,1);if(n&&""!=n)save2PaymentsAndBookOrder(n,i,a);else if(""!=s&&"CC"!=s){var o=0;$("#ref_payment1_is_store_specific_flat_rate_deposit_delayed0").length&&(1==(o=$("input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked").val())&&(o=4),2==o&&(o=5));var r=!1,d=0;$("#use_store_credits").length&&$("#use_store_credits").is(":checked")&&(d=$("#store_credits_amount").val(),r=!0),$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"save_payment",order_id:order_id,user_id:user_id,payment_data:i,delay_remainder:o,use_store_credits:r,store_credits_amount:d,dd_csrf_token:a},success:function(e){e.processor_success?(intenseLogging("onAddPaymentAndActivate() save_payment successful"),e.warnOfOutstandingSavedOrdersOnFullSession?bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true"):bounce("/?page=admin_order_mgr_thankyou&order="+e.order_id)):($("#paying_div").remove(),intenseLogging("onAddPaymentAndActivate save_payment: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("onAddPaymentAndActivate save_payment: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}else if(""!=s&&"CC"==s){var c=$("#payment1_ccNameOnCard").val(),_=$("#billing_address_1").val(),l=$("#billing_postal_code_1").val(),u=$("#payment1_cc_total_amount").val();$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"get_token",order_id:order_id,amount:u,user_id:user_id,billing_name:c,billing_address:_,billing_zip:l,dd_csrf_token:a,chain_token:!0},success:function(a){($("input[name=dd_csrf_token]","#editorForm").val(a.getTokenToken),a.processor_success)?(intenseLogging("onAddPaymentAndActivate() get_token successful"),send(a.token,1,!1,e,t,!1)):($("#paying_div").remove(),intenseLogging("onAddPaymentAndActivate get_token: "+a.processor_message),dd_message({title:"Error",message:a.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("onAddPaymentAndActivate get_token: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}}function RetrieveCalendar(e){intenseLogging("RetrieveCalendar() called");var t="retrieve";"NEW"!=orderState&&(t="retrieve_for_reschedule"),$.ajax({url:"/processor",type:"GET",timeout:2e4,dataType:"json",data:{processor:"admin_calendarProcessor",store_id:store_id,action:t,cur_session_id:session_id,timestamp:e},success:function(e){e.processor_success?(intenseLogging("RetrieveCalendar() successful"),$("#calendar_holder").html(e.data)):(intenseLogging("RetrieveCalendar: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){intenseLogging("RetrieveCalendar: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function onDayClick(e){}function doReschedule(e,t){var a=$("#curSessionDate").html();dd_message({title:"Reschedule",message:'<div style="text-align: center;"><div>From</div><div style="font-weight: bold;">'+a+'</div><div>to</div><div style="font-weight: bold;">'+t+"</div>",modal:!0,confirm:function(){var t=session_id;session_id=e,Reschedule(t)},open:function(){$(this).siblings(".ui-dialog-buttonpane").find("button:contains('Confirm')").focus()}})}function onRescheduleClick(e,t,a,s){"NEW"!=orderState&&("locked"==s?dd_message({title:"Reschedule",message:"You cannot reschedule to this session as it is in the previous calendar month and all activity for that month has been locked and finalized."}):"tononpreasm"==s?dd_message({title:"Reschedule",message:"This session is a standard customer assembly session; your order is for Made for You items. Are you sure you want to select a Standard session? The service fee will be removed.",modal:!0,div_id:"tononpreasm_div",confirm:function(){doReschedule(e,t),$("#tononpreasm_div").remove()}}):"topreasm"==s?dd_message({title:"Reschedule",message:"This session is a Made for You session; your order is for standard customer assembly items. Are you sure you want to select a Special Event session? A service fee will be applied.",modal:!0,div_id:"topreasm_div",confirm:function(){doReschedule(e,t),$("#topreasm_div").remove()}}):doReschedule(e,t))}function onSessionClick(e,t,a){"NEW"==orderState&&setSessionAndSave(e)}function monthChange(e){RetrieveCalendar(e)}function handle_delayed_payment(){tc_delayed_payment_agree||$("#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2,  #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2,  #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2,  #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2").on("click",(function(e){dd_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment,modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{Agree:function(){$(this).remove(),$("#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2,  #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2,  #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2,  #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2").off("click"),set_user_pref("TC_DELAYED_PAYMENT_AGREE",1,user_id)},Decline:function(){$("#payment1_is_store_specific_flat_rate_deposit_delayed_payment0, #payment2_is_store_specific_flat_rate_deposit_delayed_payment0, #ref_payment1_is_store_specific_flat_rate_deposit_delayed0, #ref_payment2_is_store_specific_flat_rate_deposit_delayed0").trigger("click"),dd_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment_decline}),set_user_pref("TC_DELAYED_PAYMENT_AGREE",0,user_id)}}})}))}function createBonusCredit(e){isFactoringCredit=!0,e>(currentCreditAvailable=.1*creditBasis)?(e=currentCreditAvailable,currentCreditAvailable=0):currentCreditAvailable-=e,$("#couponValue").val(e),$("#OEH_bonus_credit").html(" ( Bonus Credit: "+formatAsMoney(currentCreditAvailable)+" )")}function removeBonusCredit(){isFactoringCredit=!1,$("#OEH_bonus_credit").html("")}function handleSummaryDisplayChange(e){e.checked?ShowAllLineItems():HideLineItemsIfZero()}function HideLineItemsIfZero(){var e=Number($("#OEH_subtotal_service_fee_org").html()),t=Number($("#OEH_subtotal_service_fee").html());0==e&&0==t?$("#ServiceFeeRow").hide():$("#ServiceFeeRow").show();var a=Number($("#OEH_service_tax_subtotal_org").html()),s=Number($("#OEH_service_tax_subtotal").html());0==a&&0==s?$("#ServiceTaxRow").hide():$("#ServiceTaxRow").show();var n=Number($("#OEH_misc_food_subtotal_org").html()),i=Number($("#OEH_misc_food_subtotal").html());0==n&&0==i?$("#miscFoodRow").hide():$("#miscFoodRow").show();var o=Number($("#OEH_misc_nonfood_subtotal_org").html()),r=Number($("#OEH_misc_nonfood_subtotal").html());0==o&&0==r?$("#miscNonFoodRow").hide():$("#miscNonFoodRow").show();var d=Number($("#OEH_direct_order_discount_org").html()),c=Number($("#OEH_direct_order_discount").html());0==d&&0==c?$("#directDiscountRow").hide():$("#directDiscountRow").show();var _=Number($("#OEH_coupon_discount_org").html()),l=Number($("#OEH_coupon_discount").html());0==_&&0==l?$("#couponDiscountRow").hide():$("#couponDiscountRow").show();var u=Number($("#OEH_plate_points_discount_org_food").html()),m=Number($("#OEH_plate_points_order_discount_food").html());0==u&&0==m?$("#platePointsDiscountRow").hide():$("#platePointsDiscountRow").show();u=Number($("#OEH_plate_points_discount_org_fee").html()),m=Number($("#OEH_plate_points_order_discount_fee").html());0==u&&0==m?$("#platePointsFeeDiscountRow").hide():$("#platePointsFeeDiscountRow").show(),0==Number($("#OEH_session_discount").html())?$("#sessionDiscountRow").hide():$("#sessionDiscountRow").show(),0==Number($("#OEH_preferred").html())?$("#preferredUserDiscountRow").hide():$("#preferredUserDiscountRow").show();var p=Number($("#OEH_food_tax_subtotal_org").html()),g=Number($("#OEH_food_tax_subtotal").html());0==p&&0==g?$("#foodTaxRow").hide():$("#foodTaxRow").show();var h=Number($("#OEH_tax_subtotal_org").html()),v=Number($("#OEH_tax_subtotal").html());0==h&&0==v?$("#nonFoodTaxRow").hide():$("#nonFoodTaxRow").show();var f=Number($("#OEH_products_subtotal_org").html()),y=Number($("#OEH_products_subtotal").html());0==f&&0==y?$("#productSubtotalRow").hide():$("#productSubtotalRow").show()}function ShowAllLineItems(){$("#ServiceFeeRow").show(),$("#ServiceTaxRow").show(),$("#miscFoodRow").show(),$("#miscNonFoodRow").show(),$("#directDiscountRow").show(),$("#couponDiscountRow").show(),$("#foodTaxRow").show(),$("#nonFoodTaxRow").show(),$("#productSubtotalRow").show(),$("#platePointsDiscountRow").show(),$("#preferredUserDiscountRow").show(),$("#sessionDiscountRow").show()}function sort_by_price(e,t){return e.price==t.price?0:e.price<t.price?1:-1}function getPlatePointsDiscountableAmount(e,t){retVal=0;var a=0,s=0;if(e.length>0){e.sort(sort_by_price);for(var n=0;n<e.length;n++){var i=e[n],o=i.qty*i.serving_size,r=i.qty*i.price;if(36==(s+=o)){a+=r;break}if(s>36){a+=(36-(s-o))/i.serving_size*i.price;break}a+=r}retVal=t-a}if(s<36)return 0;var d=Number(document.getElementById("subtotal_service_fee").value);retVal+=d.valueOf();var c=Number(document.getElementById("misc_food_subtotal").value);return retVal+=c.valueOf(),retVal}function drawChangeList(){var e=getChangeListHTML();$("#changelist").html(e)}function getChangeListHTML(){var e="",t=!0;for(var a in changeList.stdMenuItems){if(t&&(e+="<h3>Standard Items List</h3><ul style='margin: 4px;'>",t=!1),e+="<li>",changeList.stdMenuItems.hasOwnProperty(a)){var s=$("#qty_"+a).data("item_title"),n="("+$("#qty_"+a).data("servings")+" Serving)";changeList.stdMenuItems[a]>0?e+="Added "+changeList.stdMenuItems[a]+" "+n+" <i>"+s+"</i>":e+="Removed "+-1*changeList.stdMenuItems[a]+" "+n+" <i>"+s+"</i>"}e+="</li>"}for(var a in t||(e+="</ul>"),t=!0,changeList.FTMenuItems){if(t&&(e+="<h3>Sides List</h3><ul style='margin: 4px;'>",t=!1),e+="<li>",changeList.FTMenuItems.hasOwnProperty(a)){s=$("#qty_"+a).data("item_title");changeList.FTMenuItems[a]>0?e+="Added "+changeList.FTMenuItems[a]+" <i>"+s+"</i>":e+="Removed "+-1*changeList.FTMenuItems[a]+" <i>"+s+"</i>"}e+="</li>"}t||(e+="</ul>"),t=!0;var i=!1;for(var a in changeList.miscCosts)i=!0,t&&(e+="<h3>Misc Costs</h3>",t=!1),changeList.miscCosts.hasOwnProperty(a)&&(changeList.miscCosts[a].newVal>changeList.miscCosts[a].orgVal?0==changeList.miscCosts[a].orgVal?e+="Added "+getHumanReadableName(a)+" of $"+formatAsMoney(changeList.miscCosts[a].newVal)+"<br />":e+=getHumanReadableName(a)+" was increased by $"+formatAsMoney(changeList.miscCosts[a].diff)+" to $"+formatAsMoney(changeList.miscCosts[a].newVal)+"<br />":0==changeList.miscCosts[a].newVal?e+="Removed "+getHumanReadableName(a)+" of $"+formatAsMoney(changeList.miscCosts[a].orgVal)+"<br />":e+=getHumanReadableName(a)+" was decreased by $"+formatAsMoney(-1*changeList.miscCosts[a].diff)+" to $"+formatAsMoney(changeList.miscCosts[a].newVal)+"<br />");for(var a in t=!0,changeList.miscDescs)!i&&t&&(e+="<h3>Misc Costs</h3>",t=!1),changeList.miscDescs.hasOwnProperty(a)&&(e+=getHumanReadableName(a)+" updated<br />");for(var a in""!=changeList.order_type&&(e+="<h3>Order changed "+changeList.order_type+"</h3>"),t=!0,changeList.bundleItems){if(t&&(isDreamTaste?e+="<h3>Meal Prep Workshop Items List</h3><ul style='margin: 4px;'>":isFundraiser?e+="<h3>Fundraiser Event Items List</h3><ul style='margin: 4px;'>":e+="<h3>Intro Items List</h3><ul style='margin: 4px;'>",t=!1),e+="<li>",changeList.bundleItems.hasOwnProperty(a)){s=$("#bnd_"+a).data("item_title"),n="("+$("#bnd_"+a).data("servings")+" Serving)";changeList.bundleItems[a]>0?e+="Added "+changeList.bundleItems[a]+" "+n+" <i>"+s+"</i>":e+="Removed "+-1*changeList.bundleItems[a]+" "+n+" <i>"+s+"</i>"}e+="</li>"}for(var a in t||(e+="</ul>"),t=!0,changeList.discounts)t&&(e+="<h3>Discounts</h3>",t=!1),changeList.discounts.hasOwnProperty(a)&&(changeList.discounts[a].newVal>changeList.discounts[a].orgVal?0==changeList.discounts[a].orgVal?e+="Added "+getHumanReadableName(a)+" of $"+formatAsMoney(changeList.discounts[a].newVal)+"<br />":e+=getHumanReadableName(a)+" was increased by $"+formatAsMoney(changeList.discounts[a].diff)+" to $"+formatAsMoney(changeList.discounts[a].newVal)+"<br />":0==changeList.discounts[a].newVal?e+="Removed "+getHumanReadableName(a)+" of $"+formatAsMoney(changeList.discounts[a].orgVal)+"<br />":e+=getHumanReadableName(a)+" was decreased by $"+formatAsMoney(-1*changeList.discounts[a].diff)+" to $"+formatAsMoney(changeList.discounts[a].newVal)+"<br />");for(var a in t=!0,changeList.reporting)t&&(e+="<h3>Reporting</h3>",t=!1),changeList.reporting.hasOwnProperty(a)&&("fundraiser"==a?0==changeList.reporting[a].newVal?e+="Removed "+getHumanReadableName(a)+" "+changeList.reporting[a].title+"<br />":changeList.reporting[a].orgVal>0&&changeList.reporting[a].orgVal!=changeList.reporting[a].newVal?e+="Changed "+getHumanReadableName(a)+" to "+changeList.reporting[a].title+"<br />":e+="Added "+getHumanReadableName(a)+" "+changeList.reporting[a].title+"<br />":"fundraiser_value"==a&&(changeList.reporting[a].diff>0?e+=getHumanReadableName(a)+" was increased by $"+formatAsMoney(changeList.reporting[a].diff)+" to $"+formatAsMoney(changeList.reporting[a].newVal)+"<br />":e+=getHumanReadableName(a)+" was decreased by $"+formatAsMoney(-1*changeList.reporting[a].diff)+" to $"+formatAsMoney(changeList.reporting[a].newVal)+"<br />"));if(changeList.coupon&&(t&&(e+="<h3>Discounts</h3>",t=!1),(changeList.coupon.change_type="added")?e+="Added coupon code: <br />":(changeList.coupon.change_type="removed")?e+="Removed coupon code: <br />":(changeList.coupon.change_type="added")&&(e+="Change coupon code to: <br />")),paymentChanges||$("#use_store_credit").is(":checked")){e+="<h3>Payments</h3>";var o=$("#payment1_type").val();if(""!=o)e+="Payment of type "+o+" selected.<br />";else{$("#creditDiv").is(":visible"),$("#credit_to_customer_refund_cash_amount").val()>0&&(e+="Refunding Cash to customer.<br />");var r=0;$("[id^='Cr_RT_'").each((function(){r+=parseFloat($(this).val())})),r>0&&(e+="Refunding to customer credit card(s).<br />")}if(("GIFT_CERT"==o||"GIFT_CARD"==o)&&""!=$("#payment2_type").val()){var d=$("#payment2_type").val();d&&""!=d&&(e+="Payment of type "+d+" selected.<br />")}$("#use_store_credit").is(":checked")&&(e+="Store Credit selected for payment.<br />")}return e}function getHumanReadableName(e){switch(e){case"direct_order_discount":return"Direct Order Discount";case"plate_points_discount":return"Dinner Dollars";case"misc_food_subtotal":return"Miscellaneous Food Cost";case"misc_nonfood_subtotal":return"Miscellaneous Non-food Cost";case"subtotal_service_fee":return"Service Fee";case"misc_food_subtotal_desc":return"Misc Food Description";case"misc_nonfood_subtotal_desc":return"Misc Non-food Description";case"service_fee_description":return"Service Fee Description";case"session_discount":return"Session Discount";default:return"error"}}function getAbbreviatedSummaryString(){var e="",t=$("#selectedBundle").is(":checked");isDreamTaste?e+="<h3>Meal Prep Workshop Order</h3>":e+=t?"<h3>Starter Pack Order</h3>":"<h3>Standard Order</h3>";var a=0,s=0;$("[id^='qty_']").each((function(){$(this).val()>0&&("cts"==$(this).data("dd_type")?s+=1*$(this).val():a+=1*$(this).val())})),a>0&&(e+=a+" Standard Items Selected.<br />"),s>0&&(e+=s+" Sides &amp; Sweets Items Selected.<br />"),$("[data-dd_type='item_field']").each((function(){var t=$(this).val();if(1==$(this).data("number")&&(t=parseFloat(t),isNaN(t)&&(t=0),t>0)){e+=getHumanReadableName(this.id)+" costs of $"+formatAsMoney(t);var a="";switch(this.id){case"misc_food_subtotal":a="misc_food_subtotal_desc";break;case"misc_nonfood_subtotal":a="misc_nonfood_subtotal_desc";break;case"subtotal_service_fee":a="service_fee_description"}var s=$("#"+a).val();e+=s?". <span>( "+s+" )</span><br />":".<br />"}}));t=$("#selectedBundle").is(":checked"),$("#selectedBundle").data("org_value");var n=0;if($("[id^='bnd_']").each((function(){$(this).is(":checked")&&n++})),n>0&&(e+=n+" Intro Items Selected.<br />"),isDreamTaste){n=0;$("[id^='bnd_']").each((function(){$(this).val()>0&&(n+=1*$(this).val())})),n>0&&(e+=n+" Items Selected.<br />")}var i="";if($("#plate_points_discount, #direct_order_discount").each((function(){var e=$(this).val();1==$(this).data("number")&&(e=parseFloat(e),isNaN(e)&&(e=0)),e.valueOf()>0&&(i+=getHumanReadableName(this.id)+" applied.<br />")})),$("#SessDiscnoSD").length){var o=$("input[name='SessDisc']:checked","#editorForm").val();o&&"noSD"!=o&&(i+="Session discount is applied.<br />")}if($("#PUDnoUP").length){var r=$("input[name='PUD']:checked","#editorForm").val();r&&"noUP"!=r&&(i+="Preferred User Discount is applied.<br />")}if(""!=i&&(e+="<h3>Discounts</h3>"+i),paymentChanges||$("#use_store_credit").is(":checked")){e+="<h3>Payments</h3>";var d=$("#payment1_type").val();if(e+="Payment of type "+d+" selected.<br />",("GIFT_CERT"==d||"GIFT_CARD"==d)&&""!=$("#payment1_type").val()){var c=$("#payment2_type").val();c&&""!=c&&(e+="Payment of type "+c+" selected.<br />")}$("#use_store_credit").is(":checked")&&(e+="Store Credit selected for payment.<br />")}return e}function updateChangeList(){itemChanges=!1,discountChanges=!1,discountOrPaymentChanges=!1;var e=!1;(changeList={}).stdMenuItems={},changeList.FTMenuItems={},changeList.miscCosts={},changeList.miscDescs={},changeList.bundleItems={},changeList.order_type="",changeList.discounts={},$("[id^='qty_']").each((function(){$(this).val()!=$(this).data("org_value")?("cts"==$(this).data("dd_type")?changeList.FTMenuItems[this.id.split("_")[1]]=$(this).val()-$(this).data("org_value"):changeList.stdMenuItems[this.id.split("_")[1]]=$(this).val()-$(this).data("org_value"),$(this).addClass("unsaved_data"),itemChanges=!0):$(this).removeClass("unsaved_data")})),$("[data-dd_type='item_field']").each((function(){var e=$(this).val(),t=$(this).data("org_value");1==$(this).data("number")&&(e=parseFloat(e),t=parseFloat(t),isNaN(e)&&(e=0),isNaN(t)&&(t=0)),e.valueOf()!=t.valueOf()?($(this).addClass("unsaved_data"),1==$(this).data("number")?changeList.miscCosts[this.id]={newVal:$(this).val(),orgVal:$(this).data("org_value"),diff:$(this).val()-$(this).data("org_value")}:changeList.miscDescs[this.id]=1,itemChanges=!0):$(this).removeClass("unsaved_data")}));var t=$("#selectedBundle").is(":checked"),a=$("#selectedBundle").data("org_value");if(t?"0"==a?($("#bundle_header_div").addClass("unsaved_data_cb"),changeList.order_type="to Intro",itemChanges=!0):$("#bundle_header_div").removeClass("unsaved_data_cb"):"1"==a?($("#bundle_header_div").addClass("unsaved_data_cb"),changeList.order_type="to Standard",itemChanges=!0):$("#bundle_header_div").removeClass("unsaved_data_cb"),isDreamTaste?$("[id^='bnd_']").each((function(){$(this).val()!=$(this).data("org_value")?($(this).data("dd_type"),changeList.bundleItems[this.id.split("_")[1]]=$(this).val()-$(this).data("org_value"),$(this).addClass("unsaved_data"),itemChanges=!0):$(this).removeClass("unsaved_data")})):$("[id^='bnd_']").each((function(){$(this).is(":checked")?"0"==$(this).data("org_value")?($(this).parent().addClass("unsaved_data_cb"),changeList.bundleItems[this.id.split("_")[1]]=1,itemChanges=!0):$(this).parent().removeClass("unsaved_data_cb"):"1"==$(this).data("org_value")?($(this).parent().addClass("unsaved_data_cb"),changeList.bundleItems[this.id.split("_")[1]]=-1,itemChanges=!0):$(this).parent().removeClass("unsaved_data_cb")})),itemChanges?($("#items_tab_li").addClass("unsaved_data_on_tab"),e=!0):$("#items_tab_li").removeClass("unsaved_data_on_tab"),$("#plate_points_discount, #direct_order_discount").each((function(){var e=$(this).val(),t=$(this).data("org_value");1==$(this).data("number")&&(e=parseFloat(e),t=parseFloat(t),isNaN(e)&&(e=0),isNaN(t)&&(t=0)),e.valueOf()!=t.valueOf()?(changeList.discounts[this.id]={newVal:$(this).val(),orgVal:$(this).data("org_value"),diff:$(this).val()-$(this).data("org_value")},$(this).addClass("unsaved_data"),discountOrPaymentChanges=!0,discountChanges=!0):$(this).removeClass("unsaved_data")})),$("#SessDiscnoSD").length)if(initialSessionDiscountSetting!=$("input[name='SessDisc']:checked","#editorForm").val()){$(".SD_area").addClass("unsaved_data_cb");var s=$("input[name='SessDisc']:checked","#editorForm").val();changeList.discounts.session_discount="noSD"==s?{newVal:0,orgVal:$("#OEH_session_discount_org").html(),diff:-1*$("#OEH_session_discount_org").html()}:{newVal:$("#OEH_session_discount").html(),orgVal:0,diff:$("#OEH_session_discount").html()},discountOrPaymentChanges=!0,discountChanges=!0}else $(".SD_area").removeClass("unsaved_data_cb");if($("#PUDnoUP").length)if(initialPreferredUserDiscountSetting!=$("input[name='PUD']:checked","#editorForm").val()){$("#PUD_area").addClass("unsaved_data_cb");var n=$("input[name='PUD']:checked","#editorForm").val();changeList.discounts.preferred_user_discount="noUP"==n?{newVal:0,orgVal:$("#OEH_preferred_org").html(),diff:-1*$("#OEH_preferred_org").html()}:{newVal:$("#OEH_preferred").html(),orgVal:0,diff:$("#OEH_preferred").html()},discountOrPaymentChanges=!0,discountChanges=!0}else $("#PUD_area").removeClass("unsaved_data_cb");var i=$("#org_coupon_id").val(),o=$("#coupon_id").val();i!=o&&(discountOrPaymentChanges=!0,changeList.coupon=""==i?{newVal:o,orgVal:i,change_type:"added"}:""==o?{newVal:o,orgVal:i,change_type:"removed"}:{newVal:o,orgVal:i,change_type:"changed"}),discountOrPaymentChanges?($("#payments_tab_li").addClass("unsaved_data_on_tab"),e=!0):$("#payments_tab_li").removeClass("unsaved_data_on_tab"),"SAVED"==orderState&&(e||$("#use_store_credit").is(":checked"))?$("#saveOrderSpan").show():$("#saveOrderSpan").hide(),"SAVED"==orderState&&($("#use_store_credit").is(":checked")||paymentChanges)?$("#addPaymentAndActivateButton").attr("disabled",!1):$("#addPaymentAndActivateButton").attr("disabled",!0),"ACTIVE"==orderState||allowLimitedAccess?($("#finalizeOrderSpan").show(),e||paymentChanges||$("#use_store_credits").is(":checked")?(discountOrPaymentChanges=!0,$("#submit_button").attr("disabled",!1),$("#finalize_msg").show()):($("#submit_button").attr("disabled",!0),$("#finalize_msg").hide())):$("#finalizeOrderSpan").hide(),itemChanges||discountOrPaymentChanges?$("#changeListTab").addClass("unsaved_data_list"):$("#changeListTab").removeClass("unsaved_data_list"),drawChangeList()}function handleAutoAdjust(e){if(e.checked){var t=Number($("#OEH_remaing_balance").html());canAdjustDelayedPayment&&(currentDPAmount>0||t>0)?t>0?($("#payment1_type").val("DPADJUST"),changePayment1("DPADJUST")):adjustPendingDelayedPayment(t):(t>0&&($("#payment1_type").val("REFERENCE"),changePayment1("REFERENCE")),assignBalanceToRefTransactions(t))}else for(ident in""!=$("#payment1_type").val()&&($("#payment1_type").val(""),changePayment1("")),existingPaymentAmountArray)$("#Cr_RT_"+ident).val("");reportPaymentStatus(!1)}function getAbbreviatedChangeString(){var e="",t=0,a=0;for(var s in needPlatePointsMaxDiscountChangeWarning&&(e+="<div style='color:red;'>Warning: The amount discountable by Dinner Dollars has changed. You may wish to review and adjust the Dinner Dollars discount.</div>"),changeList.stdMenuItems)changeList.stdMenuItems.hasOwnProperty(s)&&(changeList.stdMenuItems[s]>0?t++:a++);t&&(e+=t+" Standard items were added.<br />"),a&&(e+=a+" Standard items were removed.<br />");var n=0,i=0;for(var s in changeList.FTMenuItems)changeList.FTMenuItems.hasOwnProperty(s)&&(changeList.FTMenuItems[s]>0?n++:i++);for(var s in n&&(e+=n+" Sides &amp; Sweets items were added.<br />"),i&&(e+=i+" Sides &amp; Sweets items were removed.<br />"),changeList.miscCosts)changeList.miscCosts.hasOwnProperty(s)&&(changeList.miscCosts[s].newVal>changeList.miscCosts[s].orgVal?0==changeList.miscCosts[s].orgVal?e+="Added "+getHumanReadableName(s)+" of $"+formatAsMoney(changeList.miscCosts[s].newVal)+"<br />":e+=getHumanReadableName(s)+" was increased by $"+formatAsMoney(changeList.miscCosts[s].diff)+" to $"+formatAsMoney(changeList.miscCosts[s].newVal)+"<br />":0==changeList.miscCosts[s].newVal?e+="Removed "+getHumanReadableName(s)+" of $"+formatAsMoney(changeList.miscCosts[s].orgVal)+"<br />":e+=getHumanReadableName(s)+" was decreased by $"+formatAsMoney(-1*changeList.miscCosts[s].diff)+" to $"+formatAsMoney(changeList.miscCosts[s].newVal)+"<br />");for(var s in changeList.miscDescs)changeList.miscDescs.hasOwnProperty(s)&&(e+=getHumanReadableName(s)+" updated<br />");""!=changeList.order_type&&(e+="<h3>Order changed "+changeList.order_type+"</h3>");var o=0,r=0;for(var s in first=!0,changeList.bundleItems)first&&(isDreamTaste?e+="<h3>Meal Prep Workshop Items List</h3>":e+="<h3>Intro Items List</h3>",first=!1),changeList.bundleItems.hasOwnProperty(s)&&(changeList.bundleItems[s]>0?o++:r++);for(var s in o&&(e+=o+" items were added.<br />"),r&&(e+=r+" items were removed.<br />"),""!=e&&(e="<h3>Purchase Changes</h3>"+e),first=!0,changeList.discounts)first&&(e+="<h3>Discounts</h3>",first=!1),changeList.discounts.hasOwnProperty(s)&&(changeList.discounts[s].newVal>changeList.discounts[s].orgVal?0==changeList.discounts[s].orgVal?e+="Added "+getHumanReadableName(s)+" of $"+formatAsMoney(changeList.discounts[s].newVal)+"<br />":e+=getHumanReadableName(s)+" was increased by $"+formatAsMoney(changeList.discounts[s].diff)+" to $"+formatAsMoney(changeList.discounts[s].newVal)+"<br />":0==changeList.discounts[s].newVal?e+="Removed "+getHumanReadableName(s)+" of $"+formatAsMoney(changeList.discounts[s].orgVal)+"<br />":e+=getHumanReadableName(s)+" was decreased by $"+formatAsMoney(-1*changeList.discounts[s].diff)+" to $"+formatAsMoney(changeList.discounts[s].newVal)+"<br />");return $("#autoAdjust").is(":checked")&&(e+="<span style='color:red'>Auto-Adjust is checked and will "+$("#adj_action").html()+"</span>"),e="<div id='finalize_changes_div'>"+e+"</div>"}function addPaymentToLockedOrder(){var e=$("#payment1_ccNameOnCard").val(),t=$("#billing_address_1").val(),a=$("#billing_postal_code_1").val(),s=$("#payment1_cc_total_amount").val();$.ajax({url:"/processor",type:"POST",timeout:2e4,async:!0,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"get_token",order_id:order_id,amount:s,user_id:user_id,billing_name:e,billing_address:t,billing_zip:a,dd_csrf_token:$("input[name=dd_csrf_token]","#editorForm").val(),chain_token:!0},success:function(e){($("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken),e.processor_success)?(intenseLogging("addPaymentToLockedOrder() get_token successful"),send(e.token,1,!1,!0,!0,!1)):($("#paying_div").remove(),intenseLogging("addPaymentToLockedOrder get_token: "+e.processor_message),dd_message({title:"Error",message:e.processor_message}))},error:function(e,t){$("#paying_div").remove(),intenseLogging("addPaymentToLockedOrder get_token: "+t+" | "+e.responseText),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function submitPage(){intenseLogging("submitPage() called");var e=$("#editorForm")[0];if(confirm_and_check_form(e)){var t="This can not be undone. Are you sure you want to submit the changes?",a=460;(t+="<br /><br />"+getAbbreviatedChangeString()).length<128?a=160:t.length<256&&(a=260),dd_message({title:"Finalize",message:t,modal:!0,width:400,height:a,confirm:function(){supports_transparent_redirect&&"CC"==$("#payment1_type").val()?(intenseLogging("submitPage() confirmed"),allowLimitedAccess?addPaymentToLockedOrder(!0,!0):updateActiveOrder(!0,!0)):($("<input>").attr({type:"hidden",name:"changeList",value:JSON.stringify(changeList)}).appendTo($(e)),$("<input>").attr({type:"hidden",name:"changeListStr",value:getChangeListHTML()}).appendTo($(e)),$("#submit_changes").val("true"),$("#editorForm").submit())}})}}function resetPage(){intenseLogging("resetPage() called"),bounce(window.location.href)}function confirm_and_check_form(e){if(intenseLogging("confirm_and_check_form() called"),"NEW"==orderState||"SAVED"==orderState)return!1;if(hasBundle){var t=!1;if($("#selectedBundle").is(":checked")&&(t=!0),t){var a=countSelectedBundleItems();if(a<18)return dd_message({title:"Error",message:"Please select at least 18-servings of Meal Prep Starter Pack items."}),!1;if(a>18)return dd_message({title:"Error",message:"Please select no more than 18 servings of Meal Prep Starter Pack items."}),!1}}return stationNeedsAttention?(dd_message({title:"Error",message:"Please review the Side Station and ensure the correct number of items are selected."}),!1):_check_form(e)}function dd_round_amount(e){var t=1e3*(e+=5e-6);return t=parseInt(t),(t=(t/=10)-Math.floor(t)>=.5?Math.floor(t)+1:Math.floor(t))/100}function updateSideStationStatus(e,t){if(0==t){stationNeedsAttention=!1,o="You must set the Bundle quantity to greater than zero.";var a="sidestation_help_"+e;return(i=$("#"+a)).css("color","#bb0000"),void i.html(o)}var s=t*sideStationBundleInfo[e].number_items_required;$("#"+("required_items_station_"+e)).html(s);var n=0;$.each(sideStationBundleInfo[e].bundle,(function(e,t){var a=$("#sbi_"+e);if(a&&""!=a.val()){1!=isNaN(a.val())&&a.val()-parseInt(a.val())==0||a.val(0),a.val()>0&&(a.val(parseInt(a.val())),n+=1*a.val());var s=entreeIDToInventoryMap[e].remaining;s-=a.val()*t.servings_per_item,$("#sbi_inv_"+e).html(s),$("#inv_"+e).html(s),entreeIDToInventoryMap[e].remaining=s}})),$("#"+("selected_items_station_"+e)).html(n);a="sidestation_help_"+e;var i=$("#"+a),o="";0==n?(o="Please select "+s+" items.",i.css("color","#bb0000"),stationNeedsAttention=!0):n>s?(o="You have selected "+(n-s)+" items more than the required amount. Please remove "+(n-s)+" items.",i.css("color","#bb0000"),stationNeedsAttention=!0):n<s?(o="You have selected "+(s-n)+" items less than the required amount. Please add "+(s-n)+" items.",i.css("color","#bb0000"),stationNeedsAttention=!0):(o="You have selected the correct number of sidestation items. You may continue with item selection or checkout.",i.css("color","#00bb00"),stationNeedsAttention=!1),i.html(o)}function calculateTotal(){var e=0,t=0,a=0,s=0,n=0,i=0,o=0,r=0,d=!1,c=0,_=[],l=[];for(var u in hasBundle&&$("#selectedBundle").is(":checked")&&(d=!0),entreeIDToInventoryMap)entreeIDToInventoryMap[u].remaining=entreeIDToInventoryMap[u].org_remaining,$("#inv_"+u).html(entreeIDToInventoryMap[u].org_remaining);if($("[id^='qty_']").each((function(){if(""!=$(this).val()){1!=isNaN($(this).val())&&$(this).val()-parseInt($(this).val(),10)==0||$(this).val(0);var o=$(this).val(),d=this.id.split("_")[1];if(isFactoringCredit){var u=$(this).data("org_value");if("std"==$(this).data("dd_type"))u<o?(diff=o-u,r+=diff*$(this).data("price")):o<u&&(diff=u-o,r-=diff*$(this).data("price"));else(u=o.getAttribute("data-org_value"))<o?(diff=o-u,c+=diff*$(this).data("price")):o<u&&(diff=u-o,r-=diff*$(this).data("price"))}if(0==isNaN(o)){var m=$(this).data("entreeid"),p=entreeIDToInventoryMap[m].remaining;if(p-=o*Number($(this).data("servings")),$("#inv_"+m).html(p),entreeIDToInventoryMap[m].remaining=p,"cts"!=$(this).data("dd_type")&&o>0){var g={id:d,qty:o,price:$(this).data("price"),serving_size:$(this).data("servings")};_.push(g)}e+=o*$(this).data("price"),"cts"!=$(this).data("dd_type")?(1*o,t+=o*$(this).data("servings"),"FULL"==$(this).data("pricing_type")?s+=1*o:a+=1*o):(n+=1*o,i+=o*$(this).data("price")),"true"==$(this).data("is_bundle")&&(o*$(this).data("price"),1*o),l[d]=o,$("#sbi_inv_"+m).html(p)}"true"==$(this).data("is_bundle")&&updateSideStationStatus(m,o)}})),a+s+n,hasBundle)if(originallyHadBundle){var m=0,p=0;d?$("[id^='bnd_']").each((function(){if("1"==$(this).data("org_value"))if($(this).is(":checked"))m++,p+=$(this).data("servings");else{var e=entreeIDToInventoryMap[$(this).data("entreeid")].remaining;e+=$(this).data("servings"),$("#inv_"+$(this).data("entreeid")).html(e),entreeIDToInventoryMap[$(this).data("entreeid")].remaining=e}else if($(this).is(":checked")){e=entreeIDToInventoryMap[$(this).data("entreeid")].remaining;e-=$(this).data("servings"),$("#inv_ "+$(this).data("entreeid")).html(e),entreeIDToInventoryMap[$(this).data("entreeid")].remaining=e,m++,p+=$(this).data("servings")}})):$("[id^='bnd_']").each((function(){if("1"==$(this).data("org_value")){var e=entreeIDToInventoryMap[$(this).data("entreeid")].remaining;e+=$(this).data("servings"),$("#inv_"+$(this).data("entreeid")).html(e),entreeIDToInventoryMap[$(this).data("entreeid")].remaining=e}}))}else{m=0,p=0;d&&$("[id^='bnd_']").each((function(){if($(this).is(":checked")){var e=entreeIDToInventoryMap[$(this).data("entreeid")].remaining;e-=$(this).data("servings"),$("#inv_"+$(this).data("entreeid")).html(e),entreeIDToInventoryMap[$(this).data("entreeid")].remaining=e,m++,p+=$(this).data("servings")}}))}if(hasBundle&&d&&(e+=1*bundleInfo.price,s+=m,t+=p),tasteBundleMenuData&&hasDreamTasteBundle){var g=0,h=0;p=0;e+=dreamTastePrice,$("[id^='bnd_']").each((function(){var e=$(this).val();if(e>0){t+=$(this).data("servings")*e,3==$(this).data("servings")?h+=1*e:g+=1*e;var a=entreeIDToInventoryMap[$(this).data("entreeid")].remaining;a-=3*e,$("#inv_"+$(this).data("entreeid")).html(a),entreeIDToInventoryMap[$(this).data("entreeid")].remaining=a}})),s+=1*g,a+=1*h}var v=0;if($("#selectedBundle").is(":checked"))$("#max_plate_points_deduction").html(formatAsMoney(0));else{if(v=getPlatePointsDiscountableAmount(_,e),needPlatePointsMaxDiscountChangeWarning=!1,v!=lastMaxPPDiscountAmount&&-1!=lastMaxPPDiscountAmount&&(needPlatePointsMaxDiscountChangeWarning=!0),lastMaxPPDiscountAmount=v,couponlimitedToFT)(v-=Number(document.getElementById("couponValue").value))<0&&(v=0);$("#max_plate_points_deduction").html(formatAsMoney(v))}v<=0?($("#plate_points_discount").attr("disabled","disabled"),$("#plate_points_discount").css({"background-color":"#c0c0c0",color:"#060606"}),$("#pp_discountable_cost_msg").show()):allowLimitedAccess||($("#plate_points_discount").removeAttr("disabled"),$("#plate_points_discount").css({"background-color":"#ffffff",color:"#000000"}),$("#pp_discountable_cost_msg").hide());var f=1*$("#plate_points_available").html(),y=1*$("#max_plate_points_deduction").html();y<(N=1*$("#plate_points_discount").val())&&$("#plate_points_discount").val(y),f>y?$("#tbody_max_plate_points_deduction").show():$("#tbody_max_plate_points_deduction").hide(),o=e;var b=0,S=0;$("#itemsTbl tr").each((function(){if(-1!=this.id.indexOf("row_")){var e=this.id.substr(4),t="qna_"+e,a="prc_"+e,s=$("#"+t).val(),n=Number(s),i=$("#"+a).html(),o=Number(i);b+=Number(i)*s,S+=n;var d=entreeIDToInventoryMap[e].remaining;d-=s,$("#inv_"+e).html(d.toString()),entreeIDToInventoryMap[e].remaining=d,isFactoringCredit&&(orgAmount=document.getElementById(t).getAttribute("data-org_value"),orgAmount<n?(diff=n-orgAmount,c+=diff*o):s<orgAmount&&(diff=orgAmount-s,r-=diff*o))}}));Number(a+s);var E=$("#OEH_item_count_label"),P=0,T=0,A=$("#coupon_type");A.length&&"FREE_MEAL"==A.val()&&(cfm_size=Number($("#free_entree_servings").val()),cfm_size>0&&(T+=cfm_size,P++)),0==P?(displayMealCount=0+s+a+n+S,displayServingCount=t,E.html("Total Item Count")):(displayMealCount=0+s+n+a+P+S,displayServingCount=t+T,E.html("Total # Items (incl. free meals)")),orderEditSuccess&&(displayMealCount+=newAddonQty),$("#OEH_item_count").html(displayMealCount),$("#OEH_number_servings").html(displayServingCount);var D=0;(A=$("#coupon_type")).length&&"FREE_MEAL"==A.val()&&(D=Number($("#couponValue").val()))>0&&(o+=D),o+=b,orderEditSuccess&&(o+=newAddonAmount),o=Math.round(100*o)/100,$("#orderSubTotal").val(formatAsMoney(Math.round(100*e)/100)),$("#OEH_menu_subtotal").html(formatAsMoney(o)),$("#orderTotal").val(formatAsMoney(o));var C=Number(document.getElementById("misc_food_subtotal").value),L=1*o+1*C,w=L;$("#OEH_food_cost_subtotal").html(formatAsMoney(1*o+1*C));var k=o,O=k,N=0;$("#plate_points_discount").length&&((N=$("#plate_points_discount").val())>v&&(N=v,$("#plate_points_discount").val(formatAsMoney(N))),k=formatAsMoney(k-N));var R=Number(0);if(directDiscount=$("#direct_order_discount"),""==directDiscount.val()&&directDiscount.val("0.00"),directDiscount.length&&((R=directDiscount.val())>L&&(R=L,directDiscount.val(R)),R&&(k=formatAsMoney(k-R),$("#OEH_direct_order_discount").html(formatAsMoney(R)))),isFactoringCredit&&(creditBasis+=r,createBonusCredit(c)),"PERCENT"==couponDiscountMethod){var I=O*(couponDiscountVar/100);$("#couponValue").val(I)}if(couponlimitedToFT){var M=i;M>couponDiscountVar&&(M=couponDiscountVar),$("#couponValue").val(M)}var F=Number(0);if(couponDiscount=$("#couponValue"),couponDiscount.length&&(""==couponDiscount.val()&&couponDiscount.val("0.00"),(F=couponDiscount.val())&&(k=formatAsMoney(k-F),$("#OEH_coupon_discount").html(formatAsMoney(F)),w-=F)),PUDElem=$("#PUDnoUP"),PUDElem.length){var H=$("input[name=PUD]:checked","#editorForm").val();null!=H&&""!=H||(H="noUP");var V=-1;premarkup_discounted_total=0-(e-o);var x="none",U=0;if(0!=originalUP&&"originalUP"==H)if("FLAT"==originalUP.type){var j=(s-0)*originalUP.value;j+=Number(formatAsMoney((a-0)*(originalUP.value/2))),V=formatAsMoney(o-j-i-b-0-0),x="flat"}else if("PERCENT"==originalUP.type){var B=dd_round_amount((O-i-b-0)*(originalUP.value/100));V=formatAsMoney(B),x="pcnt",U=originalUP.value/100}if(0!=activeUP&&"activeUP"==H)if("FLAT"==activeUP.type){j=(s-0)*activeUP.value;j+=Number(formatAsMoney((a-0)*(originalUP.value/2))),V=formatAsMoney(-1*(premarkup_discounted_total-j-i-b-0-0)),x="flat"}else if("PERCENT"==activeUP.type){B=dd_round_amount((O-i-b-0)*(activeUP.value/100));V=formatAsMoney(B),x="pcnt",U=activeUP.value/100}"noUP"==H&&(V=0),"flat"==x?("undefined"!=typeof promoVal&&promoVal>0&&V>0&&(V-=promoVal),D>0&&V>0&&(V-=D)):"pcnt"==x&&("undefined"!=typeof promoVal&&promoVal>0&&V>0&&(V-=promoVal*U,V=Math.round(100*V)/100),D>0&&V>0&&(V-=D*U,V=Math.round(100*V)/100)),-1!=V&&(UPDiscountElem=$("#OEH_preferred"),UPDiscountElem.length&&(UPDiscountElem.html(formatAsMoney(V)),k=formatAsMoney(k-V),w-=V))}k=Number(1*k+1*C),$("#OEH_misc_food_subtotal").html(formatAsMoney(C));var q=Number($("#subtotal_service_fee").val());if($("#OEH_subtotal_service_fee").html(formatAsMoney(q)),k=Number(1*k+1*q),N>0){var G=0,W=0;if(discountMFYFeeFirst&&q>0)N>q?(G=N-q,W=q):(W=N,G=0);else{var Y=v-q;if(N>Y)G=Y,W=N-Y;else G=N,W=0}$("#OEH_plate_points_order_discount_food").html(formatAsMoney(G)),$("#OEH_plate_points_order_discount_fee").html(formatAsMoney(W))}else $("#OEH_plate_points_order_discount_food").html(formatAsMoney(0)),$("#OEH_plate_points_order_discount_fee").html(formatAsMoney(0));if(SessDisc=$("#SessDiscnoSD"),SessDisc.length){w=Number(1*w-1*R-1*G);var z=$("input[name=SessDisc]:checked","#editorForm").val();null!=z&&""!=z||(z="noSD");var K=-1;K="originalSD"==z?formatAsMoney((w*originalSD?originalSD.value:"0")/100):"activeSD"==z?formatAsMoney(w*activeSessionDiscount.value/100):0,SDiscountElem=$("#OEH_session_discount"),SDiscountElem.length&&(SDiscountElem.html(formatAsMoney(K)),k=formatAsMoney(k-K))}var Z=Number($("#misc_nonfood_subtotal").val());$("#OEH_misc_nonfood_subtotal").html(formatAsMoney(Z)),k=Number(1*k+1*Z);var J=formatAsMoney(Z*(curNonFoodTax/100));J*=1,J+=1*formatAsMoney(curEnrollmentTax/100*0),$("#nonFoodTaxLabel").html("Non-Food Tax");var Q=0,X=0;N>0?(Q=formatAsMoney((k+1*N-Z-q-G)*(curFoodTax/100)+1e-6),X=formatAsMoney((q-W)*(curServiceTax/100)+1e-6)):(Q=formatAsMoney((k-Z-q)*(curFoodTax/100)+1e-6),X=formatAsMoney(q*(curServiceTax/100)+1e-6)),taxElem=document.getElementById("OEH_tax_subtotal"),taxElem&&(taxElem.innerHTML=formatAsMoney(J)),taxElem=document.getElementById("OEH_food_tax_subtotal"),taxElem&&(taxElem.innerHTML=formatAsMoney(Q)),taxElem=document.getElementById("OEH_service_tax_subtotal"),taxElem&&(taxElem.innerHTML=formatAsMoney(X));var ee=Number(k);k=1*k+1*Q+1*J+1*X,$("#OEH_grandtotal").html(formatAsMoney(k)),$("#OEH_new_total").html(formatAsMoney(k)),$("#OEH_delta").html(formatAsMoney(-1*(orderInfoGrandTotal-k)));var te=0;$("#OEH_paymentsTotal").length&&(te=$("#OEH_paymentsTotal").html());var ae=Number(formatAsMoney(te-k));if($("#OEH_remaing_balance").html(formatAsMoney(-1*ae)),"CANCELLED"==orderState&&(ae=te,$("#OEH_remaing_balance").html(formatAsMoney(ae))),ae>0)$("#balance_msg").html(formatAsMoney(-1*ae)+" owed to the customer."),$("#balanceRow").addClass("balance_msg_customer_owed"),$("#newPaymentDiv").hide(),canAdjustDelayedPayment&&currentDPAmount>0?$("#dp_adjust_down_div").show():$("#creditDiv").show(),$("#payment1_type").val(""),$("#payment2_type").val(""),changePayment1(""),changePayment2(""),paymentChanges=!0,$("#use_store_credits").prop("checked",!1),$("#use_store_credits").prop("disabled",!0);else if(ae<0){$("#balance_msg").html(formatAsMoney(-1*ae)+" owed to your store."),$("#balanceRow").addClass("balance_msg_store_owed"),$("#newPaymentDiv").show(),$("#creditDiv").hide(),canAdjustDelayedPayment&&$("#dp_adjust_down_div").hide(),$("#use_store_credits").prop("disabled",!1);var se=-1*ae;if($("#use_store_credits").is(":checked")){var ne=Number($("#store_credits_amount").val());isNaN(ne.valueOf())&&(ne=Number(0)),se-=ne.valueOf()}if(se=formatAsMoney(se),"CC"==$("#payment1_type").val())$("#payment1_cc_total_amount").val(se);else if("CHECK"==$("#payment1_type").val())$("#payment1_check_total_amount").val(se);else if("REF"==$("#payment1_type").val().split("_")[0])$("#payment1_ref_total_amount").val(se);else if(("GIFT_CERT"==$("#payment1_type").val()||"GIFT_CARD"==$("#payment1_type").val())&&""!=$("#payment2_type").val()){var ie=null;"GIFT_CERT"==$("#payment1_type").val()?ie=Number($("#payment1_gc_total_amount").val()):"GIFT_CARD"==$("#payment1_type").val()&&(ie=Number($("#debit_gift_card_amount").val())),isNaN(ie.valueOf())&&(ie=Number(0)),se=formatAsMoney(se-ie.valueOf()),"CC"==$("#payment2_type").val()?$("#payment2_cc_total_amount").val(se):"CHECK"==$("#payment2_type").val()?$("#payment2_check_total_amount").val(se):"CASH"==$("#payment2_type").val()?$("#payment2_cash_total_amount").val(se):"REF"==$("#payment2_type").val().split("_")[0]&&$("#payment2_ref_total_amount").val(se)}}else $("#balance_msg").html("0.00"),$("#balanceRow").addClass("balance_msg_balanced"),$("#newPaymentDiv").show(),$("#creditDiv").hide(),canAdjustDelayedPayment&&$("#dp_adjust_down_div").hide(),$("#use_store_credits").prop("disabled",!1),assignBalanceToRefTransactions(0);0!=k||""!=$("#payment1_type").val()||""!=$("#payment2_type").val()||onTimeShotAtSupplyingZeroPaymentHasOccurred||"SAVED"!=orderState||($("#payment1_type").val("CASH"),changePayment1("CASH"),$("#payment1_cash_total_amount").val("0.00"),onTimeShotAtSupplyingZeroPaymentHasOccurred=!0);var oe=$("#autoAdjustDiv");oe.length&&(0!=ae&&canAutoAdjust?(canAdjustDelayedPayment&&(currentDPAmount>0||ae<0)?$("#OEH_auto_pay_msg").html("Check this to <span id='adj_action'><b>adjust customer's delayed payment.</b></span>"):ae>0?$("#OEH_auto_pay_msg").html("Check this to <span id='adj_action'><b>credit customer's credit card now.</b></span>"):$("#OEH_auto_pay_msg").html("Check this to <span id='adj_action'><b>charge original credit card now.</b></span>"),oe.show(),forceManualAutoAdjust||($("#autoAdjust").prop("checked",!0),handleAutoAdjust($("#autoAdjust").get()[0]))):oe.is(":visible")&&(oe.hide(),$("#autoAdjust").prop("checked",!1),$("#payment1_type").val(""),$("#payment2_type").val(""),changePayment1(""),changePayment2(""))),$("#help_msg").html(""),$("#submit_changes").length&&(t>0||n>0||b>0?$("#submit_changes").prop("disabled",!1):$("#submit_changes").prop("disabled",!0),R>=Number(ee)+Number(R)&&0!=ee&&($("#submit_changes").prop("disabled",!0),$("#help_msg").html($("#help_msg").html()+'You cannot use a Direct Order Discount that is equal to or greater than the new grand total. Please use the "No Charge" payment type to give away an order.'))),$("#help_msg").length&&(""!=$("#help_msg").html()?$("#help_msg").show():$("#help_msg").hide()),reportPaymentStatus(!1),HideLineItemsIfZero(),"NEW"!=orderState&&updateChangeList()}
//# sourceMappingURL=order_mgr_test.min.js.map
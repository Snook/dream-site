{"version":3,"names":["originalMaxPPDeduction","selectedFreeMenuItem","couponFreeMenuItemRequired","handle_ltd_round_up","$","prop","orderState","is","GUEST_PREFERENCES","user_id","LTD_AUTO_ROUND_UP","value","orderInfo","ltd_round_up_value","attr","val","trigger","on","e","this","cookie","session_id","dd_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","div_id","confirm","remove","set_user_pref","index","buttons","Yes","No","calculateTotal","round_up_val","text","formatAsMoney","slideDown","slideUp","handle_fundraiser_selection","isFundraiser","Number","data","parseFloat","manually_adjusted","description","disabled","toFixed","half_grand_total","handleCouponCodeResult","json","validation_errors","anError","printString","html","show","coupon_code_discount_total","code_id","discount_method","entree_title","entree_servings","handleFreeMenuItem","coupon_obj","coupon_code","createBonusCredit","limit_to_recipe_id","current_item_qty","order_item_array","menu_item_id","coupon","couponDiscountMethod","couponDiscountVar","discount_var","couponlimitedToFT","limit_to_finishing_touch","couponIsValidWithPlatePoints","valid_with_plate_points_credits","length","maxPPDeduction","processCode","isDreamRewardsOrder","code","theForm","get","filterBundle","bundleBox","document","getElementById","checked","parameters","i","elements","name","STORE_DETAILS","id","d","Date","ajax","url","type","timeout","dataType","processor","op","org_ts","order_id","unique","getTime","order_state","params","success","processor_success","processor_message","error","objAJAXRequest","strError","response","removeCode","removeBonusCredit","Object","keys","couponFreeMenuItem","handle_free_menu_item_edit","menu_item_count","buildFreeMenuItemList","menu_item","price","expression","rebuildOrderItemsArray","menu_item_in_list","selected_menu_item_in_list","s","appendTo","each","orderItems","eval","item_title","stripLeadingZeroes","leadingZeroCount","retVal","len","slice","handlePlatePointsDiscount","isNaN","needPlatePointsMaxDiscountChangeWarning","Math","abs","maxPPCredit","cap","editCashCheckAmount","editCashCheckUpdate","new_total","getGiftCardBalance","card_number","output","card_balance","request_uri","editCashCheckAmountCommit","alert","new_number","PATH","image_admin","fadeOut","showButtonProcessDelayedPaymentNow","PendingDPOriginalStatus","processPayment","order_number","credit_card_number","substr","transaction_id","transaction_date","payment_id","css","color","summary_date","canAdjustDelayedPayment","back_path","setDelayedPaymentStatusTo","PendingDPOriginalTransActionID","toLowerCase","setupCouponState","style","display","processDelayedPaymentStatus","old_status","new_status","store_id","status","canAutoAdjust","src","alt","pointToTransaction","processPointToTransaction","old_ref_number","new_ref_number","new_card_number","transactionid","new_card_type","unsetAutoAdjust","setAllPaymentFieldsToUnrequired","reqField","setAttribute","lastPayment1Type","changePayment1","mySelect","divGC","divCash","divRefundCash","divCheck","divCC","divCredit","divRef","divRefOther","refundDiv","dpAdjust","divDebitGiftCard","payment2","selected_ref","resetPendingDelayedPayment","amount","changePayment2","onPaymentSelected","balance","innerHTML","paymentsTotal","paySel","autoAdjBox","forceManualAutoAdjust","handleAutoAdjust","adjustPendingDelayedPayment","externalPaymentAmountArray","onPaymentDeselected","reportPaymentStatus","valueOf","divref2","selectedItem","validateRefTrans","field","limit","payAmountChange","org_dp_amount","adjVal","adjustmentAmount","getPendingDPAdjustment","adj_dp_amount","assignBalanceToRefTransactions","paymentCount","prefix","ident","existingPaymentAmountArray","amountCredit","maxStoreCredit","refTransField","remainingFundsThisPayment","current_refunded_amount","thisAmount","storeCreditAmountChange","storeCreditClick","obj","amountElem","balance_elem","updateChangeList","ignorePayment2","paySelElem","pay1Amount","DirCreditCCAmount","pay2Amount","paySel2","storeCreditRefundElem","returnToStoreCredit","cashRefund","CreditCCAmount","diff","PenndingDPAdjustment","removeClass","addClass","toggle","el","target_prefix","scanPosition","charIndex","codes","keyHandler2","evt","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","onkeypress","OMDefaultKeyHandler","prepareForCCSwipe","paymentNumber","focus","receivedText","join","p","SwipeParserObj","card_type","dump","test","account","firstname","surname","exp_month","exp_year"],"sourceRoot":"js/src/admin","sources":["order_mgr_payments.js"],"sourcesContent":["var originalMaxPPDeduction = 0;\r\nvar selectedFreeMenuItem;\r\nvar couponFreeMenuItemRequired = false;\r\n\r\nfunction handle_ltd_round_up()\r\n{\r\n\t$('#add_ltd_round_up').prop('disabled', false);\r\n\r\n\tif (orderState == 'SAVED' && !$('#add_ltd_round_up').is(':checked') && GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value > 0 && orderInfo.ltd_round_up_value == '')\r\n\t{\r\n\t\t$('#add_ltd_round_up').prop('checked', true);\r\n\r\n\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == 1)\r\n\t\t{\r\n\t\t\t$(\"#ltd_round_up_select option[id='round_up_nearest_dollar']\").attr(\"selected\", \"selected\");\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger('change');\r\n\t\t}\r\n\t}\r\n\telse if ($('#add_ltd_round_up').is(':checked'))\r\n\t{\r\n\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\t}\r\n\r\n\t$('#add_ltd_round_up').on('change', function (e) {\r\n\t\tif ($(this).is(':checked'))\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\r\n\t\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != user_id + '.' + session_id))\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\tmessage: 'Would <span style=\"font-weight: bold; color: red;\">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style=\"font-weight: bold;\">My Preferences</span>.<div style=\"text-align: center; margin-top: 10px;\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option></select></div>',\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\r\n\t\t\t\t\t\tvar rup_dialog = $(this);\r\n\r\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e) {\r\n\r\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\r\n\r\n\t\t\t\t\t\t\tif (rup_value > 0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\r\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\r\n\t\t\t\t\t\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\r\n\r\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value, user_id);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (orderInfo.ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use the selected Round Up value on this order?',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\"No\": function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0, user_id);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"Ask Again Later\": function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t\t\t$.cookie('ltdru', user_id + '.' + session_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\r\n\t\t}\r\n\r\n\t\t$('#ltd_round_up_select').trigger('change');\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n\r\n\t$('#ltd_round_up_select').on('change', function (e) {\r\n\r\n\t\tvar round_up_val = $(this).val();\r\n\r\n\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\r\n\r\n\t\tif ($('#add_ltd_round_up').is(':checked'))\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_div').slideDown();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_div').slideUp();\r\n\r\n\t\t\tround_up_val = 0;\r\n\t\t}\r\n\r\n\t\t/*\r\n\r\n\t\t $.ajax({\r\n\t\t url: 'ddproc.php',\r\n\t\t type: 'POST',\r\n\t\t timeout: 20000,\r\n\t\t dataType: 'json',\r\n\t\t data: {\r\n\t\t processor: 'cart_add_payment',\r\n\t\t payment_type: 'ltd_round_up',\r\n\t\t ltd_round_up_value: round_up_val\r\n\t\t },\r\n\t\t success: function (json)\r\n\t\t {\r\n\t\t if (json.processor_success)\r\n\t\t {\r\n\r\n\t\t }\r\n\t\t else\r\n\t\t {\r\n\t\t dd_message({\r\n\t\t title: 'Error',\r\n\t\t message: json.processor_message\r\n\t\t });\r\n\t\t }\r\n\t\t },\r\n\t\t error: function (objAJAXRequest, strError)\r\n\t\t {\r\n\t\t dd_message({\r\n\t\t title: 'Error',\r\n\t\t message: 'Unexpected error: ' + strError\r\n\t\t });\r\n\t\t }\r\n\t\t });\r\n\r\n\t\t */\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n\r\n\tcalculateTotal();\r\n}\r\n\r\nfunction handle_fundraiser_selection()\r\n{\r\n\tif (isFundraiser)\r\n\t{\r\n\t\t$('#fundraiser_id').prop('disabled', true);\r\n\r\n\t\t$('#fundraiser_value').on('blur', function () {\r\n\t\t\tif (Number($(this).val()) < Number($(this).data('donation_value')))\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Alert',\r\n\t\t\t\t\tmessage: 'Fundraiser value can not be less than $' + $(this).data('donation_value')\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(this).val($(this).data('org_value'));\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tif (parseFloat($('#fundraiser_value').val()) > 0)\r\n\t{\r\n\t\tvar manually_adjusted = true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar manually_adjusted = false;\r\n\t}\r\n\r\n\t$('#fundraiser_id').on('change', function () {\r\n\t\tvar value = 0;\r\n\t\tvar description = '';\r\n\t\tvar disabled = true;\r\n\r\n\t\tif ($(this).find(':selected').val() != '')\r\n\t\t{\r\n\t\t\tif ($(this).find(':selected').data('active') == 1)\r\n\t\t\t{\r\n\t\t\t\tdisabled = false;\r\n\t\t\t}\r\n\r\n\t\t\tvalue = $(this).find(':selected').data('value');\r\n\t\t\tdescription = $(this).find(':selected').data('description');\r\n\t\t}\r\n\r\n\t\t$('#fundraiser_description_div').text(description);\r\n\r\n\t\t$('#fundraiser_value').prop('disabled', disabled);\r\n\r\n\t\tif ((!manually_adjusted && !disabled) || value == 0)\r\n\t\t{\r\n\t\t\t$('#fundraiser_value').val(parseFloat(value).toFixed(2));\r\n\t\t}\r\n\t\telse if (disabled)\r\n\t\t{\r\n\t\t\t$('#fundraiser_value').val($('#fundraiser_value').data('org_value'));\r\n\t\t}\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n\r\n\t$('#fundraiser_value').on('keyup', function () {\r\n\t\tmanually_adjusted = true;\r\n\t\tvar half_grand_total = parseFloat(($('#OEH_grandtotal').text() / 2).toFixed(2));\r\n\t\tvar value = 0;\r\n\r\n\t\tif ($('#fundraiser_value').val())\r\n\t\t{\r\n\t\t\tvalue = parseFloat($('#fundraiser_value').val());\r\n\t\t}\r\n\r\n\t\tif (value > half_grand_total)\r\n\t\t{\r\n\t\t\t$('#fundraiser_value').val(half_grand_total);\r\n\t\t}\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n}\r\n\r\nfunction handleCouponCodeResult(json)\r\n{\r\n\tif (json.validation_errors)\r\n\t{\r\n\t\tprintString = \"\";\r\n\t\tfor (anError in json.validation_errors)\r\n\t\t{\r\n\t\t\tif (json.validation_errors[anError] != \"\" && json.validation_errors[anError] != null)\r\n\t\t\t{\r\n\t\t\t\tprintString += json.validation_errors[anError] + \"<br />\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#coupon_error\").html(printString);\r\n\t\t$(\"#coupon_error\").show();\r\n\t\t$('#couponCodeSubmitter').show();\r\n\t\t$('#proc_mess').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#coupon_error\").hide();\r\n\t\t$(\"#coupon_error\").html(\"\");\r\n\r\n\t\t$('#proc_mess').hide();\r\n\t\t$('#couponDeleter').show();\r\n\t\t$('#coupon_code').prop('disabled', true);\r\n\r\n\t\t$(\"#couponValue\").val(json.coupon_code_discount_total);\r\n\t\t$(\"#coupon_id\").val(json.code_id);\r\n\r\n\t\t$(\"#coupon_type\").val(json.discount_method);\r\n\r\n\t\tif (json.discount_method == \"FREE_MEAL\")\r\n\t\t{\r\n\t\t\t$('#coupon_free_meal_row').show();\r\n\t\t\t$(\"#free_entree\").html(json.entree_title);\r\n\t\t\t$('#free_entree_servings').val(json.entree_servings);\r\n\t\t}\r\n\t\telse if (json.discount_method == \"FREE_MENU_ITEM\")\r\n\t\t{\r\n\t\t\thandleFreeMenuItem(json.coupon_obj.coupon_code);\r\n\t\t}\r\n\t\telse if (json.discount_method == \"BONUS_CREDIT\")\r\n\t\t{\r\n\t\t\tcreateBonusCredit(0);\r\n\t\t}\r\n\t\telse if (json.coupon_obj.limit_to_recipe_id == \"1\")\r\n\t\t{\r\n\t\t\tlet current_item_qty = json.order_item_array[json.coupon_obj.menu_item_id][0];\r\n\t\t\t$('#qty_' + json.coupon_obj.menu_item_id).val(current_item_qty).trigger('keyup');\r\n\t\t}\r\n\r\n\t\tcoupon = json.coupon;\r\n\t\tcouponDiscountMethod = json.discount_method;\r\n\t\tcouponDiscountVar = json.discount_var;\r\n\t\tcouponlimitedToFT = json.limit_to_finishing_touch;\r\n\t\tcouponIsValidWithPlatePoints = json.valid_with_plate_points_credits;\r\n\t\tcouponFreeMenuItemRequired = true;\r\n\r\n\t\tif (couponlimitedToFT && $(\"#max_plate_points_deduction\").length)\r\n\t\t{\r\n\t\t\tlet maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\r\n\r\n\t\t\toriginalMaxPPDeduction = maxPPDeduction;\r\n\r\n\t\t\tmaxPPDeduction -= json.coupon_code_discount_total;\r\n\t\t\tif (maxPPDeduction < 0)\r\n\t\t\t{\r\n\t\t\t\tmaxPPDeduction = 0;\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(maxPPDeduction));\r\n\t\t}\r\n\r\n\t\tcalculateTotal();\r\n\t}\r\n\r\n}\r\n\r\nfunction processCode()\r\n{\r\n\tif (isDreamRewardsOrder)\r\n\t{\r\n\t\tvar shouldContinue = true;\r\n\t\tshouldContinue = confirm(\"Coupon Codes should not be used with a Dream Rewards Order. Do you want to continue?\");\r\n\t\tif (!shouldContinue)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tvar code = $(\"#coupon_code\").val();\r\n\t$(\"#couponCodeSubmitter\").hide();\r\n\r\n\tvar theForm = $('#editorForm').get()[0];\r\n\r\n\tvar filterBundle = false;\r\n\tvar bundleBox = document.getElementById('selectedBundle');\r\n\tif (bundleBox && !bundleBox.checked)\r\n\t{\r\n\t\tfilterBundle = true;\r\n\t}\r\n\r\n\tvar parameters = \"\";\r\n\tfor (i = 0; i < theForm.elements.length; i++)\r\n\t{\r\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\r\n\t\t{\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\r\n\t\t\tif (i + 1 != theForm.elements.length)\r\n\t\t\t{\r\n\t\t\t\tparameters += \"&\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\r\n\r\n\tvar d = new Date();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessor',\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'add',\r\n\t\t\torg_ts: 'org_order_time',\r\n\t\t\torder_id: order_id,\r\n\t\t\tunique: d.getTime(),\r\n\t\t\tcoupon_code: code,\r\n\t\t\torder_state: orderState,\r\n\t\t\tparams: parameters\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\thandleCouponCodeResult(json);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t$(\"#coupon_error\").html(\"\");\r\n\t\t\t$(\"#coupon_error\").hide();\r\n\t\t\t$('#couponCodeSubmitter').show();\r\n\t\t\t$('#proc_mess').hide();\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction removeCode()\r\n{\r\n\tvar theForm = $('#editorForm').get()[0];\r\n\r\n\tvar filterBundle = false;\r\n\tvar bundleBox = document.getElementById('selectedBundle');\r\n\tif (bundleBox && !bundleBox.checked)\r\n\t{\r\n\t\tfilterBundle = true;\r\n\t}\r\n\r\n\tvar parameters = \"\";\r\n\tfor (i = 0; i < theForm.elements.length; i++)\r\n\t{\r\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\r\n\t\t{\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\r\n\t\t\tif (i + 1 != theForm.elements[i])\r\n\t\t\t{\r\n\t\t\t\tparameters += \"&\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\r\n\r\n\tvar d = new Date();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessor',\r\n\t\t\top: 'remove',\r\n\t\t\tuser_id: user_id,\r\n\t\t\torg_ts: 'org_order_time',\r\n\t\t\torder_id: order_id,\r\n\t\t\tunique: d.getTime(),\r\n\t\t\torder_state: orderState,\r\n\t\t\tparams: parameters\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif ($(\"#coupon_type\").val() == \"BONUS_CREDIT\")\r\n\t\t\t{\r\n\t\t\t\tremoveBonusCredit();\r\n\t\t\t}\r\n\r\n\t\t\t$('#couponCodeSubmitter').show();\r\n\t\t\t$('#proc_mess').hide();\r\n\t\t\t$('#couponDeleter').hide();\r\n\t\t\t$('#coupon_code').prop('disabled', false);\r\n\t\t\t$(\"#coupon_error\").hide();\r\n\t\t\t$(\"#coupon_error\").html(\"\");\r\n\t\t\t$(\"#couponValue\").val(0);\r\n\t\t\t$('#coupon_free_meal_row').hide();\r\n\t\t\t$(\"#free_entree\").html(\"\");\r\n\t\t\t$(\"#coupon_id\").val(\"\");\r\n\t\t\t$(\"#coupon_type\").val(\"\");\r\n\r\n\t\t\t$('#coupon_select_free_menu_item_row').hide();\r\n\t\t\t$('#free_menu_item_coupon option:not([value])').attr('data-dd_required', false);\r\n\r\n\t\t\tif (coupon && coupon.limit_to_recipe_id == \"1\")\r\n\t\t\t{\r\n\t\t\t\tlet current_item_qty = 0;\r\n\r\n\t\t\t\tif (Object.keys(json.order_item_array).length && json.order_item_array[coupon.menu_item_id])\r\n\t\t\t\t{\r\n\t\t\t\t\tcurrent_item_qty = json.order_item_array[coupon.menu_item_id][0];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('#qty_' + coupon.menu_item_id).val(current_item_qty);\r\n\t\t\t}\r\n\r\n\t\t\tcoupon = false;\r\n\t\t\tcouponFreeMenuItem = false;\r\n\t\t\tcouponFreeMenuItemRequired = false;\r\n\r\n\t\t\tcouponDiscountMethod = 'NONE';\r\n\t\t\tcouponDiscountVar = 0;\r\n\t\t\tcouponlimitedToFT = false;\r\n\t\t\tcouponIsValidWithPlatePoints = true;\r\n\r\n\t\t\tcalculateTotal();\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t$(\"#coupon_error\").html(\"\");\r\n\t\t\t$(\"#coupon_error\").hide();\r\n\t\t\t$('#couponCodeSubmitter').show();\r\n\t\t\t$('#proc_mess').hide();\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nfunction handle_free_menu_item_edit()\r\n{\r\n\tif (couponFreeMenuItem)\r\n\t{\r\n\t\thandleFreeMenuItem($('#coupon_code').val());\r\n\t}\r\n}\r\n\r\nfunction handleFreeMenuItem(coupon_code)\r\n{\r\n\tvar menu_item_count = 0;\r\n\r\n\tif (coupon_code == 'SRDessert')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9\");\r\n\t}\r\n\telse if (coupon_code == 'SRDinner')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'\");\r\n\t}\r\n\telse if (coupon_code == 'CC3RDFREE')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00\");\r\n\t}\r\n\telse if (coupon_code == 'SCFinishingTouch')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9 && menu_item.price <= 15.00\");\r\n\t}\r\n\telse if (coupon_code == 'HCFastLane')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'\");\r\n\t}\r\n\telse if (coupon_code == 'SCFriendDinner')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' && menu_item.intro_item == true\");\r\n\t}\r\n\r\n\tif (menu_item_count > 0)\r\n\t{\r\n\t\t$('#coupon_select_free_menu_item_row').show();\r\n\r\n\t\t$('#free_menu_item_coupon').attr('data-dd_required', true).on('change', function (e) {\r\n\t\t\tvar menu_item = $(this).find(':selected').data('menu_item');\r\n\t\t\tvar price = $(this).find(':selected').data('price');\r\n\r\n\t\t\t$('#couponValue').val(price);\r\n\t\t\tselectedFreeMenuItem = menu_item;\r\n\r\n\t\t\tcalculateTotal();\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Alert',\r\n\t\t\tmessage: 'No valid free items found in cart for this coupon, please add the desired item and then submit the coupon.'\r\n\t\t});\r\n\r\n\t\tremoveCode();\r\n\t}\r\n}\r\n\r\nfunction buildFreeMenuItemList(expression)\r\n{\r\n\trebuildOrderItemsArray();\r\n\r\n\tvar menu_item_in_list = false;\r\n\tvar selected_menu_item_in_list = false; // temp store, used for tab switching\r\n\tvar menu_item_count = 0;\r\n\r\n\t// setup efl free item select\r\n\tvar s = $('#free_menu_item_coupon').html('').attr('disabled', ((couponFreeMenuItem) ? true : false));\r\n\r\n\t$(\"<option />\").val('').text('Select Free Item').appendTo(s);\r\n\r\n\t$.each(orderItems, function (index, menu_item) {\r\n\t\tif (!menu_item_in_list)\r\n\t\t{\r\n\t\t\tmenu_item_in_list = ((couponFreeMenuItem == menu_item.id) ? true : false);\r\n\t\t}\r\n\r\n\t\tif (!selected_menu_item_in_list)\r\n\t\t{\r\n\t\t\tselected_menu_item_in_list = ((selectedFreeMenuItem == menu_item.id) ? true : false);\r\n\t\t}\r\n\r\n\t\tif (eval(expression))\r\n\t\t{\r\n\t\t\tmenu_item_count++;\r\n\r\n\t\t\t$(\"<option />\")\r\n\t\t\t\t.val(menu_item.id)\r\n\t\t\t\t.attr('data-menu_item', menu_item.id)\r\n\t\t\t\t.attr('data-price', menu_item.price)\r\n\t\t\t\t.attr('selected', ((couponFreeMenuItem == menu_item.id || selectedFreeMenuItem == menu_item.id) ? true : false))\r\n\t\t\t\t.text(menu_item.item_title + ' (' + menu_item.price + ')').appendTo(s);\r\n\t\t}\r\n\t});\r\n\r\n\tif (!menu_item_in_list)\r\n\t{\r\n\t\t$('#couponValue').val('0.00');\r\n\r\n\t\t$('#free_menu_item_coupon').attr('disabled', false);\r\n\t}\r\n\r\n\tcalculateTotal();\r\n\r\n\treturn menu_item_count;\r\n}\r\n\r\nfunction stripLeadingZeroes(val)\r\n{\r\n\tvar leadingZeroCount = 0;\r\n\tvar retVal = val;\r\n\r\n\tfor (var i = 0, len = val.length; i < len; i++)\r\n\t{\r\n\t\tif (val[i] != '0')\r\n\t\t{\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tleadingZeroCount++;\r\n\t}\r\n\r\n\tif (leadingZeroCount > 0)\r\n\t{\r\n\t\tretVal = val.slice(leadingZeroCount)\r\n\t}\r\n\r\n\treturn retVal;\r\n\r\n}\r\n\r\nfunction handlePlatePointsDiscount(val)\r\n{\r\n\tif (!couponIsValidWithPlatePoints)\r\n\t{\r\n\t\tdocument.getElementById('plate_points_discount').value = formatAsMoney(0);\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Alert',\r\n\t\t\tmessage: 'PLATEPOINTS cannot be used with the attached coupon.'\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tif ((isNaN(val) || val <= 0) && val != \".\")\r\n\t{\r\n\t\t$('#plate_points_discount').val(\"0\");\r\n\t\tcalculateTotal();\r\n\t\treturn;\r\n\t}\r\n\r\n\tneedPlatePointsMaxDiscountChangeWarning = false;\r\n\r\n\tval = formatAsMoney(Math.abs(val)) * 1;\r\n\r\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\r\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\r\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\r\n\r\n\tif (maxPPDeduction < curPPDiscount)\r\n\t{\r\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\r\n\t}\r\n\r\n\tif (maxPPCredit > maxPPDeduction)\r\n\t{\r\n\t\t$('#tbody_max_plate_points_deduction').show();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#tbody_max_plate_points_deduction').hide();\r\n\t}\r\n\r\n\tvar cap = maxPPCredit;\r\n\tif (cap > maxPPDeduction)\r\n\t{\r\n\t\tcap = maxPPDeduction;\r\n\t}\r\n\r\n\tif (val > cap)\r\n\t{\r\n\t\tval = cap;\r\n\t\t$('#plate_points_discount').val(val);\r\n\r\n\t}\r\n\r\n\tcalculateTotal();\r\n}\r\n\r\nfunction editCashCheckAmount(id, type)\r\n{\r\n\t// Show input form\r\n\t$('#check_total_input_' + id).show();\r\n\t$('#check_payment_number_input_' + id).show();\r\n\t// Hide edit link and text\r\n\t$('#check_total_' + id).hide();\r\n\t$('#check_payment_number_' + id).hide();\r\n\t$('#check_editlink_' + id).hide();\r\n}\r\n\r\nfunction editCashCheckUpdate(id, type)\r\n{\r\n\t$('#payment_sum_value_' + id).html($('#check_total_input_form_' + id).val());\r\n\t$('#payment_sum_name_' + id).html('Check (#' + $('#check_payment_number_input_form_' + id).val() + ')');\r\n\r\n\t// Loop through payment summary to get new total\r\n\tnew_total = 0;\r\n\t$('[id^=\"payment_sum_value_\"]').each(function (index) {\r\n\t\tnew_total = new_total + Number($(this).text());\r\n\t});\r\n\r\n\t// loop through and subtract refunds\r\n\t$('[id^=\"refund_payment_sum_value_\"]').each(function (index) {\r\n\t\tnew_total = new_total - Number($(this).text());\r\n\t});\r\n\r\n\t$('#OEH_paymentsTotal').html(formatAsMoney(new_total));\r\n\r\n\tcalculateTotal();\r\n}\r\n\r\n// Check cift card balance\r\nfunction getGiftCardBalance()\r\n{\r\n\t$('#gc_proc_anim').show();\r\n\t$('#balance_target').hide();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'giftCardBalance',\r\n\t\t\tcard_number: $('#debit_gift_card_number').val(),\r\n\t\t\toutput: 'json'\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$('#balance_target').show();\r\n\t\t\t\t$('#balance_target').html(json.card_balance);\r\n\t\t\t\t$('#gc_proc_anim').hide();\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#balance_target').show();\r\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + request_uri + '\">[login]</a> again.</span>');\r\n\t\t\t\t$('#gc_proc_anim').hide();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#balance_target').show();\r\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t\t$('#gc_proc_anim').hide();\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#balance_target').show();\r\n\t\t\t$('#balance_target').html('Error: ' + strError + '. Please <a href=\"javascript:getGiftCardBalance();\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction editCashCheckAmountCommit(id, type)\r\n{\r\n\talert(\"You are only modifying the \" + type + \" details.\\nNo other modifications will be made.\");\r\n\r\n\t$('#check_total_mess_' + id).hide();\r\n\tnew_total = $('#check_total_input_form_' + id).val();\r\n\tnew_number = $('#check_payment_number_input_form_' + id).val();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_editCashCheckAmount',\r\n\t\t\tid: id,\r\n\t\t\ttype: type,\r\n\t\t\tnew_total: new_total,\r\n\t\t\tnew_number: new_number,\r\n\t\t\torder_id: order_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t// Hide input form\r\n\t\t\t\t$('#check_total_input_' + id).hide();\r\n\t\t\t\t$('#check_payment_number_input_' + id).hide();\r\n\t\t\t\t// Show edit link and text\r\n\t\t\t\t$('#check_total_' + id).show();\r\n\t\t\t\t$('#check_payment_number_' + id).show();\r\n\t\t\t\t$('#check_editlink_' + id).show();\r\n\r\n\t\t\t\t// Update page text with new values\r\n\t\t\t\t$('#check_total_' + id).html(new_total);\r\n\t\t\t\t$('#check_payment_number_' + id).html(new_number);\r\n\r\n\t\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t\t$('#check_total_mess_' + id).show().html('<img src=\"' + PATH.image_admin + '/icon/accept.png\" alt=\"Accept\" />').fadeOut(2000);\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + +'\">[login]</a> again.</span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">' + json.processor_message + '</span>');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t$('#check_total_mess_' + id).html('Error: ' + strError + '. Please <a href=\"javascript:editCashCheckAmountCommit(' + id + ',\\'' + type + '\\');\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\n// Proccess delayed payment now\r\nfunction showButtonProcessDelayedPaymentNow(message)\r\n{\r\n\tif (PendingDPOriginalStatus == 'PENDING')\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"process_payment\" value=\"Process delayed payment now\" onclick=\"processPayment();\">');\r\n\t}\r\n\telse if (message)\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html(message);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#payment_proc_mess').hide();\r\n\t}\r\n}\r\n\r\nfunction processPayment()\r\n{\r\n\tif (confirm(\"Are you sure you wish to process the delayed payment now? Click OK to process.\"))\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 60000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_delayedPaymentProcessor',\r\n\t\t\t\torder_number: order_id\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.success)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ($('#point_to_transaction').length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar credit_card_number = $('#point_to_transaction option:selected').text();\r\n\t\t\t\t\t\t$('#cc_payment_number_other').html('XXXXXXXXXXXX' + credit_card_number.substr(-4));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$('#cc_delayed_tran_num_other').html(json.transaction_id);\r\n\t\t\t\t\t$('#cc_delayed_date_other').html(json.transaction_date);\r\n\t\t\t\t\t$('#cc_delayed_status_other').html('Status: Payment Processed');\r\n\r\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'color': ''});\r\n\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).html(json.summary_date);\r\n\r\n\t\t\t\t\tcanAdjustDelayedPayment = false;\r\n\r\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:green;font-weight:bold;\">Payment Processed.</span>').fadeOut(4000);\r\n\t\t\t\t}\r\n\t\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$('#payment_proc_mess').show();\r\n\t\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPayment();\">[try again]</a>.');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Change delayed payment status\r\nfunction setDelayedPaymentStatusTo()\r\n{\r\n\t//Do not allow the user to reset to FAIL\r\n\tif ($('#change_delayed_payment_status').val() == 'FAIL' && PendingDPOriginalStatus != 'FAIL')\r\n\t{\r\n\t\talert('Can not change transaction back to Fail. Please choose pending or canceled.');\r\n\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\t\treturn false;\r\n\t}\r\n\t// Reset transaction id dropdown, can only set the status of one dropdown a time.\r\n\tif ($('#change_delayed_payment_status'))\r\n\t{\r\n\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\r\n\t}\r\n\r\n\tif ($('#change_delayed_payment_status').val() == PendingDPOriginalStatus)\r\n\t{\r\n\t\tshowButtonProcessDelayedPaymentNow();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"set_delayed_payment_status\" value=\"Set delayed payment status to ' + $('#change_delayed_payment_status').val().toLowerCase() + '\" onClick=\"processDelayedPaymentStatus();\">');\r\n\t}\r\n}\r\n\r\nfunction setupCouponState()\r\n{\r\n\t// if a coupon is attached we need to update the UI\r\n\t// 1) set up the coupon code box - disabled with code\r\n\tif (coupon)\r\n\t{\r\n\t\tdocument.getElementById('couponCodeSubmitter').style.display = \"none\";\r\n\t\tdocument.getElementById('couponDeleter').style.display = \"inline\";\r\n\t\tdocument.getElementById('coupon_code').value = coupon.coupon_code;\r\n\t\tdocument.getElementById('coupon_code').disabled = true;\r\n\t}\r\n}\r\n\r\nfunction processDelayedPaymentStatus()\r\n{\r\n\t$('#payment_proc_mess').show();\r\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_delayedPaymentStatusProcessor',\r\n\t\t\torder_number: order_id,\r\n\t\t\told_status: PendingDPOriginalStatus,\r\n\t\t\tnew_status: $('#change_delayed_payment_status').val(),\r\n\t\t\tstore_id: store_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.success)\r\n\t\t\t{\r\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\r\n\t\t\t\tPendingDPOriginalStatus = json.status;\r\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\r\n\t\t\t\t// Reset transaction id dropdown, only set one at a time.\r\n\t\t\t\tif ($('#change_delayed_payment_status'))\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Voodoo, editing cash/check totals element id payment_sum_value_*, so change\r\n\t\t\t\t// element id to cancelled_payment_sum_value_* which will be skipped over in the total caclulation.\r\n\t\t\t\tif (json.status == 'CANCELLED' && $('#payment_sum_value_' + json.payment_id))\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).attr('id', 'cancelled_payment_sum_value_' + json.payment_id);\r\n\t\t\t\t}\r\n\t\t\t\telse if (json.status == 'PENDING' && $('#cancelled_payment_sum_value_' + json.payment_id))\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).attr('id', 'payment_sum_value_' + json.payment_id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update payment status and details\r\n\t\t\t\tif (json.status == 'CANCELLED')\r\n\t\t\t\t{\r\n\t\t\t\t\t// Can only adjust pending payments\r\n\t\t\t\t\tcanAdjustDelayedPayment = false;\r\n\r\n\t\t\t\t\t// Update summary rows\r\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) - Number($('#cancelled_payment_sum_value_' + json.payment_id).html())));\r\n\r\n\t\t\t\t\t// Reset new payment if they have auto adjust selected\r\n\t\t\t\t\t$('#dp_adjust_div').hide();\r\n\t\t\t\t\t//\t$('#autoAdjust').attr({ 'checked' : 'checked' });\r\n\t\t\t\t\t//\thandleAutoAdjust($('#autoAdjust'));\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// Payment pending, we are allowed to edit it\r\n\t\t\t\t\tcanAdjustDelayedPayment = true;\r\n\r\n\t\t\t\t\t// Update summary rows\r\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) + Number($('#payment_sum_value_' + json.payment_id).html())));\r\n\r\n\t\t\t\t\t// Allow auto adjust to be used\r\n\t\t\t\t\tcanAutoAdjust = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcalculateTotal();\r\n\r\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Delayed Payment set to ' + PendingDPOriginalStatus + '.</span>');\r\n\t\t\t\t$('#change_delayed_payment_status_img').attr({\r\n\t\t\t\t\tsrc: PATH.image_admin + '/icon/accept.png',\r\n\t\t\t\t\talt: 'Accept'\r\n\t\t\t\t});\r\n\t\t\t\t$('#change_delayed_payment_status_img').css({display: 'inline'}).fadeOut(2000);\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#payment_proc_mess').show();\r\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processDelayedPaymentStatus();\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Point to new transaction ID\r\nfunction pointToTransaction()\r\n{\r\n\t// Reset payment status dropdown, only set one at a time.\r\n\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\r\n\tif ($('#point_to_transaction').val() == PendingDPOriginalTransActionID)\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\tshowButtonProcessDelayedPaymentNow();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"point_to_payment\" value=\"Point payment to selected Credit Card Number\" onClick=\"processPointToTransaction();\">');\r\n\t}\r\n}\r\n\r\nfunction processPointToTransaction()\r\n{\r\n\t$('#payment_proc_mess').show();\r\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_processPointToTransaction',\r\n\t\t\torder_number: order_id,\r\n\t\t\tstore_id: store_id,\r\n\t\t\told_ref_number: PendingDPOriginalTransActionID,\r\n\t\t\tnew_ref_number: $('#point_to_transaction').val(),\r\n\t\t\tnew_card_number: $('#point_to_transaction option:selected').text()\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.success)\r\n\t\t\t{\r\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\r\n\t\t\t\tPendingDPOriginalTransActionID = json.transactionid;\r\n\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\r\n\r\n\t\t\t\t// Reset payment status dropdown, only set one at a time.\r\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\r\n\t\t\t\t$('#payment_sum_type_' + json.payment_id).html(json.new_card_type);\r\n\t\t\t\t$('#payment_sum_name_' + json.payment_id).html('Delayed CC Payment (#' + json.new_card_number + ')');\r\n\r\n\t\t\t\t$('#cc_credit_card_type_other').html(json.new_card_type);\r\n\t\t\t\t$('#cc_payment_transaction_number_other').html(json.transactionid);\r\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Credit card set to ' + json.new_card_type + '.</span>');\r\n\t\t\t\t$('#point_to_transaction_img').css({display: 'inline'}).fadeOut(2000);\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#payment_proc_mess').show();\r\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPointToTransaction();\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction unsetAutoAdjust()\r\n{\r\n\tif ($('#autoAdjust').length)\r\n\t{\r\n\t\tdocument.getElementById('autoAdjust').checked = false;\r\n\t}\r\n}\r\n\r\nfunction setAllPaymentFieldsToUnrequired()\r\n{\r\n\tvar reqField;\r\n\r\n\treqField = document.getElementById('payment1_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('payment1_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_reference_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('payment2_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('payment2_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_check_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('debit_gift_card_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('debit_gift_card_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n}\r\n\r\nvar lastPayment1Type = false;\r\n\r\nfunction changePayment1(mySelect)\r\n{\r\n\r\n\tif (lastPayment1Type && lastPayment1Type != mySelect)\r\n\t{\r\n\t\tif (lastPayment1Type == 'CC')\r\n\t\t{\r\n\t\t\t$('#payment1_gc_total_amount').val(\"\");\r\n\t\t}\r\n\t\telse if (lastPayment1Type == 'REFERENCE')\r\n\t\t{\r\n\t\t\t$('#payment1_reference_total_amount').val(\"\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlastPayment1Type = mySelect;\r\n\r\n\tvar divGC = document.getElementById('payment1_gc');\r\n\tvar divCash = document.getElementById('payment1_cash');\r\n\tvar divRefundCash = document.getElementById('payment1_refund_cash');\r\n\tvar divCheck = document.getElementById('payment1_check');\r\n\tvar divCC = document.getElementById('payment1_cc');\r\n\tvar divCredit = document.getElementById('payment1_credit');\r\n\tvar divRef = document.getElementById('payment1_reference');\r\n\tvar divRefOther = document.getElementById('payment1_ref');\r\n\tvar refundDiv = document.getElementById('payment1RefundCCDiv');\r\n\r\n\tvar dpAdjust = document.getElementById('dp_adjust_div'); // can be null\r\n\r\n\tdocument.getElementById('new_payments_total').value = 0;\r\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\r\n\t{\r\n\t\tdocument.getElementById('new_payments_total').value = formatAsMoney(document.getElementById('store_credits_amount').value);\r\n\t}\r\n\r\n\tvar divDebitGiftCard = document.getElementById('payment1_debit_gift_card');\r\n\r\n\tvar payment2 = document.getElementById('payment2');\r\n\r\n\tvar selected_ref = false;\r\n\tif (mySelect.substr(0, 4) == 'REF_')\r\n\t{\r\n\t\tselected_ref = mySelect.substr(4);\r\n\t\tmySelect = 'REFERENCE_OTHER';\r\n\t}\r\n\r\n\tresetPendingDelayedPayment();\r\n\r\n\t// reset so validation does not fail when using payment types other than CC\r\n\tvar amount = document.getElementById('payment1_cc_total_amount');\r\n\tamount.value = '';\r\n\r\n\tvar reqField;\r\n\treqField = document.getElementById('payment1_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_reference_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('debit_gift_card_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('debit_gift_card_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\tswitch (mySelect)\r\n\t{\r\n\t\tcase \"REFERENCE\":\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'block';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\r\n\t\t\tif (dpAdjust && canAdjustDelayedPayment)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t\tunsetAutoAdjust();\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment1_reference_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\r\n\t\t\tonPaymentSelected();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CERT\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'block';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tif (orderState != 'ACTIVE')\r\n\t\t\t{\r\n\t\t\t\tpayment2.style.display = 'block';\r\n\t\t\t}\r\n\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment1_gc_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_gc_payment_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CASH\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'block';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tif (orderState == 'ACTIVE')\r\n\t\t\t{\r\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\r\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\t\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\r\n\t\t\t\tamount.value = formatAsMoney(0);\r\n\t\t\t}\r\n\r\n\t\t\treqField = document.getElementById('payment1_cash_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_cash_total_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFUND_CASH\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'block';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'block';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tamount = document.getElementById('payment1_check_total_amount');\r\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\r\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\r\n\t\t\treqField = document.getElementById('payment1_check_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_check_total_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CREDIT\":\r\n\t\t\trefundDiv.style.display = 'none';\r\n\r\n\t\t\tpaymentsTotal = Number(document.getElementById('OEH_paymentsTotal').innerHTML);\r\n\r\n\t\t\tif (paymentsTotal != 0)\r\n\t\t\t{\r\n\t\t\t\talert(\"'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away.\");\r\n\t\t\t\tpaySel = document.getElementById('payment1_type');\r\n\t\t\t\tpaySel.value = '';\r\n\t\t\t\tchangePayment1('');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'block';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'block';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tamount = document.getElementById('payment1_cc_total_amount');\r\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\r\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\r\n\t\t\treqField = document.getElementById('payment1_ccNameOnCard');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccNumber');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_cc_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccType');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccMonth');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccYear');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CARD\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'block';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('debit_gift_card_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('debit_gift_card_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tif (orderState != 'ACTIVE')\r\n\t\t\t{\r\n\t\t\t\tpayment2.style.display = 'block';\r\n\t\t\t}\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"DPADJUST\":\r\n\t\t\tif (!dpAdjust)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t} // should never happen\r\n\r\n\t\t\tif (!canAdjustDelayedPayment)\r\n\t\t\t{\r\n\t\t\t\talert('Can not adjust delayed payment.\\n\\nDelayed payment status: ' + PendingDPOriginalStatus);\r\n\t\t\t\tautoAdjBox = document.getElementById('autoAdjust');\r\n\t\t\t\tif (!forceManualAutoAdjust)\r\n\t\t\t\t{\r\n\t\t\t\t\tautoAdjBox.checked = true;\r\n\t\t\t\t\thandleAutoAdjust(autoAdjBox);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdpAdjust.style.display = 'block';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\t\t\tbalance = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\t\t\tadjustPendingDelayedPayment(balance);\r\n\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'block';\r\n\r\n\t\t\tdocument.getElementById('p1_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\r\n\t\t\tdocument.getElementById('p1_ref_id').innerHTML = selected_ref;\r\n\r\n\t\t\treqField = document.getElementById('payment1_ref_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\t\t\t\treqField.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\t\t\t}\r\n\r\n\t\t\tchangePayment2('');\r\n\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\t\tcase 'CC_REFUND':\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'block';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\r\n\t\t\tresetPendingDelayedPayment();\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tonPaymentDeselected();\r\n\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction changePayment2(mySelect)\r\n{\r\n\r\n\treportPaymentStatus(true);\r\n\r\n\tvar textBal = $(\"#bal_due\").html();\r\n\tvar balance = Number($(\"#bal_due\").html());\r\n\tif (isNaN(balance.valueOf()))\r\n\t{\r\n\t\tbalance = \"\";\r\n\t}\r\n\tif (balance.valueOf() == 0)\r\n\t{\r\n\t\tbalance = \"\";\r\n\t}\r\n\r\n\tvar divCash = document.getElementById('payment2_cash');\r\n\tvar divRefundCash = document.getElementById('payment2_refund)_cash');\r\n\tvar divCheck = document.getElementById('payment2_check');\r\n\tvar divCC = document.getElementById('payment2_cc');\r\n\tvar divref2 = document.getElementById('payment2_ref');\r\n\r\n\tvar reqField;\r\n\r\n\treqField = document.getElementById('payment2_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\tvar selected_ref = false;\r\n\tif (mySelect.substr(0, 4) == 'REF_')\r\n\t{\r\n\t\tselected_ref = mySelect.substr(4);\r\n\t\tmySelect = 'REFERENCE_OTHER';\r\n\t}\r\n\r\n\tswitch (mySelect)\r\n\t{\r\n\t\tcase \"CASH\":\r\n\t\t\tdivCash.style.display = 'block';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivref2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment2_cash_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#payment2_cash_total_amount\").val(balance);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'block';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivref2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment2_check_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#payment2_check_total_amount\").val(balance);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'block';\r\n\t\t\tdivref2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment2_ccNameOnCard');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccNumber');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccType');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccMonth');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccYear');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#payment2_cc_total_amount\").val(balance);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivref2.style.display = 'block';\r\n\r\n\t\t\tdocument.getElementById('p2_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\r\n\t\t\tdocument.getElementById('p2_ref_id').innerHTML = selected_ref;\r\n\r\n\t\t\treqField = document.getElementById('payment2_ref_total_amount');\r\n\r\n\t\t\t$(\"#payment2_ref_total_amount\").val(balance);\r\n\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treqField = document.getElementById('payment2_type');\r\n\t\t\treqField.selectedItem = 0;\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction validateRefTrans(field, limit)\r\n{\r\n\tif (field.value > limit)\r\n\t{\r\n\t\talert('Limited to ' + limit + '.');\r\n\t\tfield.value = limit;\r\n\t}\r\n\r\n\tif (field.value < 0)\r\n\t{\r\n\t\talert('Must be a positive number.');\r\n\t\tfield.value = 0;\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction payAmountChange(value)\r\n{\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction resetPendingDelayedPayment(balance)\r\n{\r\n\tvar idElem = document.getElementById('PendingDP');\r\n\r\n\tif (idElem)\r\n\t{\r\n\t\t// get original amount\r\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\r\n\r\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(org_dp_amount);\r\n\r\n\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(org_dp_amount);\r\n\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(0);\r\n\r\n\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(org_dp_amount);\r\n\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(0);\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction adjustPendingDelayedPayment(balance)\r\n{\r\n\tvar idElem = document.getElementById('PendingDP');\r\n\r\n\tif (idElem)\r\n\t{\r\n\t\t// get original amount\r\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\r\n\r\n\t\tvar adjVal = org_dp_amount + (balance * 1);\r\n\t\tif (adjVal < 0)\r\n\t\t{\r\n\t\t\tbalance = adjVal * -1;\r\n\t\t\tadjVal = 0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tbalance = 0;\r\n\t\t}\r\n\r\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(adjVal);\r\n\t\tvar adjustmentAmount = getPendingDPAdjustment();\r\n\r\n\t\tif (adjustmentAmount > 0)\r\n\t\t{\r\n\t\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(adjVal);\r\n\t\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(adjustmentAmount);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(adjVal);\r\n\t\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(adjustmentAmount * -1);\r\n\t\t}\r\n\r\n\t\treturn balance;\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn balance;\r\n\t}\r\n\r\n}\r\n\r\nfunction getPendingDPAdjustment()\r\n{\r\n\tvar idElem = document.getElementById('PendingDP');\r\n\tif (idElem)\r\n\t{\r\n\t\t// get original amount\r\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\r\n\t\tvar adj_dp_amount = Number(document.getElementById('PendingDPAmount').value);\r\n\t\treturn formatAsMoney(adj_dp_amount - org_dp_amount);\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn 0;\r\n\t}\r\n\r\n\treturn 0;\r\n\r\n}\r\n\r\nfunction assignBalanceToRefTransactions(balance)\r\n{\r\n\tvar paymentCount = 0;\r\n\r\n\tvar prefix = 'RT_';\r\n\tif (balance < 0)\r\n\t{\r\n\t\tprefix = 'Cr_RT_';\r\n\t}\r\n\r\n\t// clear any previous values\r\n\tfor (ident in existingPaymentAmountArray)\r\n\t{\r\n\t\tvar elname = 'RT_' + ident;\r\n\t\tpaymentCount++;\r\n\t\tdocument.getElementById('RT_' + ident).value = \"\";\r\n\t}\r\n\r\n\t// clear any previous values\r\n\tfor (ident in existingPaymentAmountArray)\r\n\t{\r\n\r\n\t\t// alert('nuulify');\r\n\t\tvar elname = 'Cr_RT_' + ident;\r\n\t\t//\talert(elname);\r\n\t\tdocument.getElementById('Cr_RT_' + ident).value = \"\";\r\n\t}\r\n\r\n\tif (balance == 0)\r\n\t{\r\n\t\treportPaymentStatus(false);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (balance > 0)\r\n\t{\r\n\t\t//alert(\"doing it\");\r\n\t\t// first, use store credit\r\n\t\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\r\n\t\t{\r\n\t\t\tvar amountCredit = 0;\r\n\t\t\tvar maxStoreCredit = Number($('#eoTotalStoreCredit').html());\r\n\t\t\t//alert(\"max: \" + maxStoreCredit);\r\n\r\n\t\t\tif (balance > maxStoreCredit)\r\n\t\t\t{\r\n\t\t\t\tamountCredit = maxStoreCredit;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tamountCredit = balance;\r\n\t\t\t}\r\n\r\n\t\t\t// alert(\"amountCredit: \" + amountCredit);\r\n\r\n\t\t\tdocument.getElementById('store_credits_amount').value = formatAsMoney(amountCredit);\r\n\t\t\tbalance -= amountCredit;\r\n\r\n\t\t\t// alert(\"balance: \" + balance);\r\n\t\t}\r\n\r\n\t\t// second, look for a payment that could handle the full credit/debit\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\tif (balance <= existingPaymentAmountArray[ident].amount)\r\n\t\t\t{\r\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\r\n\t\t\t\trefTransField.value = formatAsMoney(balance);\r\n\t\t\t\treportPaymentStatus(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// otherwise just assign to the first one\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(balance);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// balance < 0\r\n\t\t// first, look for a payment that could handle the full credit/debit\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\r\n\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\r\n\t\t\t{\r\n\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\r\n\t\t\t}\r\n\r\n\t\t\tif (balance >= (remainingFundsThisPayment * -1))\r\n\t\t\t{\r\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\r\n\t\t\t\trefTransField.value = formatAsMoney(Math.abs(balance));\r\n\t\t\t\treportPaymentStatus(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//if not found then we must spread the balance across multiple payments\r\n\t\tif (paymentCount > 1)\r\n\t\t{\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\r\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\r\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\r\n\t\t\t\t{\r\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar thisAmount = (remainingFundsThisPayment * -1);\r\n\r\n\t\t\t\tif (thisAmount < balance)\r\n\t\t\t\t{\r\n\t\t\t\t\tthisAmount = balance;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(Math.abs(thisAmount));\r\n\t\t\t\tbalance -= thisAmount;\r\n\r\n\t\t\t\tif (balance >= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (paymentCount == 1)\r\n\t\t{\r\n\t\t\t// just assign the max amount, the remainder will need to be paid through another method\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\r\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\r\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\r\n\t\t\t\t{\r\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(remainingFundsThisPayment);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction storeCreditAmountChange(val)\r\n{\r\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\r\n\r\n\tif (amountCredit.valueOf() < val)\r\n\t{\r\n\t\t$('#store_credits_amount').val(amountCredit.valueOf());\r\n\r\n\t}\r\n\r\n\tpayAmountChange();\r\n}\r\n\r\nfunction storeCreditClick(obj)\r\n{\r\n\tvar amountElem = document.getElementById('store_credits_amount');\r\n\r\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\r\n\r\n\tif (obj.checked && amountCredit > 0)\r\n\t{\r\n\r\n\t\tamountElem.disabled = false;\r\n\r\n\t\tvar balance_elem = document.getElementById('OEH_remaing_balance');\r\n\t\tif (balance_elem)\r\n\t\t{\r\n\t\t\tbalance = Number(balance_elem.innerHTML);\r\n\t\t}\r\n\r\n\t\tif (Number(amountElem.value) > balance && balance > 0)\r\n\t\t{\r\n\r\n\t\t\tamountElem.value = formatAsMoney(balance);\r\n\t\t}\r\n\r\n\t\tupdateChangeList();\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tamountElem.disabled = true;\r\n\t}\r\n\r\n\tcalculateTotal();\r\n\r\n\treportPaymentStatus(false);\r\n\r\n}\r\n\r\nfunction reportPaymentStatus(ignorePayment2)\r\n{\r\n\tvar balance_elem = document.getElementById('OEH_remaing_balance');\r\n\r\n\tvar balance = 0;\r\n\tif (balance_elem)\r\n\t{\r\n\t\tbalance = Number(balance_elem.innerHTML);\r\n\t}\r\n\r\n\tvar paymentsTotal = Number(0);\r\n\r\n\t// Total up any store credit\r\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\r\n\t{\r\n\t\tpaymentsTotal = (paymentsTotal * 1) + (1 * formatAsMoney(document.getElementById('store_credits_amount').value));\r\n\t}\r\n\r\n\tvar paySelElem = document.getElementById('payment1_type');\r\n\r\n\tif (!paySelElem)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar paySel = paySelElem.value;\r\n\r\n\tvar pay1Amount = Number(0);\r\n\r\n\tswitch (paySel)\r\n\t{\r\n\t\tcase \"REFERENCE\":\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\t\t\t\tpay1Amount += Number(document.getElementById('RT_' + ident).value);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cc_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC_REFUND\":\r\n\t\t\tvar DirCreditCCAmount = Number(0);\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\t\t\t\tDirCreditCCAmount += Number(document.getElementById('Dir_Cr_RT_' + ident).value);\r\n\t\t\t}\r\n\t\t\tpay1Amount = DirCreditCCAmount * -1;\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CASH\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cash_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFUND_CASH\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_refund_cash_total_amount').value);\r\n\t\t\tpay1Amount = -pay1Amount;\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_check_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CERT\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_gc_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CARD\":\r\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CREDIT\":\r\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\r\n\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tif (ignorePayment2)\r\n\t{\r\n\t\tpay2Amount = Number(0);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tpaySel2 = document.getElementById('payment2_type').value;\r\n\t\tvar pay2Amount = Number(0);\r\n\t\tswitch (paySel2)\r\n\t\t{\r\n\t\t\tcase \"CC\":\r\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cc_total_amount').value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CASH\":\r\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cash_total_amount').value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CHECK\":\r\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_check_total_amount').value);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar storeCreditRefundElem = document.getElementById('storeCreditRefund');\r\n\tif (storeCreditRefundElem)\r\n\t{\r\n\t\treturnToStoreCredit = Number(storeCreditRefundElem.value * -1);\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturnToStoreCredit = Number(0);\r\n\t}\r\n\r\n\tvar cashRefund = document.getElementById('credit_to_customer_refund_cash_amount');\r\n\tif (cashRefund)\r\n\t{\r\n\t\tcashRefund = Number(cashRefund.value * -1);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tcashRefund = Number(0);\r\n\t}\r\n\r\n\t// Credit Card Refunds\r\n\tvar CreditCCAmount = Number(0);\r\n\tfor (ident in existingPaymentAmountArray)\r\n\t{\r\n\t\tCreditCCAmount += Number(document.getElementById('Cr_RT_' + ident).value);\r\n\t}\r\n\r\n\tif (isNaN(CreditCCAmount))\r\n\t{\r\n\t\tCreditCCAmount = Number(0);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tCreditCCAmount = Number(CreditCCAmount * -1);\r\n\t}\r\n\r\n\tvar PenndingDPAdjustment = Number(getPendingDPAdjustment());\r\n\r\n\t// Note: refunds are now expressed as a negative. Payments total can be negative\r\n\tvar paymentsTotal = Number(paymentsTotal + pay1Amount + pay2Amount +\r\n\t\treturnToStoreCredit + CreditCCAmount + PenndingDPAdjustment + cashRefund);\r\n\r\n\t$('#payment_help_msg').removeClass('overpaid');\r\n\t// current costs are greater than current payments - money owed to store\r\n\r\n\tif (orderState != 'CANCELLED')\r\n\t{\r\n\r\n\t\tvar diff = Number((paymentsTotal * -1) + balance);\r\n\r\n\t\tif (diff < 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse if (diff > 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('').hide();\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\r\n\t\tvar diff = Number(paymentsTotal + balance);\r\n\r\n\t\tif (diff > 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse if (diff < 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('').hide();\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t balance = Math.abs(balance);\r\n\t //\talert(\"balance: \" + balance);\r\n\r\n\t var diff = new Number(paymentsTotal - balance);\r\n\t //\talert(\"diff: \" + diff);\r\n\r\n\t $('#new_payments_total').val(paymentsTotal);\r\n\r\n\t $('#payment_help_msg').removeClass('overpaid').html('<span id=\"bal_due\">0.0</span>').show();\r\n\r\n\r\n\t if (orderState == 'CANCELLED')\r\n\t {\r\n\t if (diff < 0)\r\n\t {\r\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else if (diff > 0)\r\n\t {\r\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else\r\n\t {\r\n\t $('#payment_help_msg').html('').hide();\r\n\t }\r\n\t }\r\n\t else\r\n\t {\r\n\t if (paySel == 'CREDIT')\r\n\t {\r\n\t $('#payment_help_msg').html('<span id=\"bal_due\">No Charge</span>').show();\r\n\t }\r\n\t else if (diff < 0)\r\n\t {\r\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else if (diff > 0)\r\n\t {\r\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else\r\n\t {\r\n\t $('#payment_help_msg').html('').hide();\r\n\t }\r\n\t }\r\n\t */\r\n\tupdateChangeList();\r\n}\r\n\r\nfunction toggle(obj)\r\n{\r\n\tvar el = document.getElementById(obj);\r\n\tel.style.display = (el.style.display != 'none' ? 'none' : '');\r\n}\r\n\r\nvar target_prefix = \"payment1_\";\r\nvar scanPosition = 0;\r\nvar charIndex = 0;\r\nvar codes = [];\r\n\r\nfunction keyHandler2(evt)\r\n{\r\n\r\n\tevt = (evt) ? evt : event;\r\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\r\n\r\n\tif (charCode == 13)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcodes[charIndex++] = String.fromCharCode(charCode);\r\n\r\n\tif ((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\r\n\t{\r\n\t\tscanPosition = 1; //start of data\r\n\t}\r\n\telse if ((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\r\n\t{\r\n\t\tscanPosition = 2; // start of track 1\r\n\t}\r\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\r\n\t{\r\n\t\tscanPosition = 3;  // end of track 1\r\n\t}\r\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\r\n\t{\r\n\t\tscanPosition = 0;  // end of track 2\r\n\t\tcharIndex = 0;\r\n\t\thandleSwipeCompletion();\r\n\t}\r\n}\r\n\r\nfunction endScanHandling()\r\n{\r\n\tdocument.getElementById('scanArea').style.display = \"none\";\r\n\tcodes.length = 0;\r\n\tscanPosition = 0;\r\n\tcharIndex = 0;\r\n\tdocument.getElementById('hidden_text_store').value = \"\";\r\n\r\n\tdocument.onkeypress = OMDefaultKeyHandler;\r\n\r\n}\r\n\r\nfunction prepareForCCSwipe(paymentNumber)\r\n{\r\n\r\n\tif (paymentNumber == 2)\r\n\t{\r\n\t\ttarget_prefix = 'payment2_';\r\n\t}\r\n\telse\r\n\t{\r\n\t\ttarget_prefix = 'payment1_';\r\n\t}\r\n\r\n\tdocument.onkeypress = keyHandler2;\r\n\tdocument.getElementById('scanArea').style.display = \"block\";\r\n\tdocument.getElementById('hidden_text_store').focus();\r\n\tdocument.getElementById('hidden_text_store').value = \"\";\r\n\r\n}\r\n\r\nfunction handleSwipeCompletion()\r\n{\r\n\tvar receivedText = codes.join(\"\");\r\n\r\n\tvar p = new SwipeParserObj(receivedText);\r\n\tvar parsedVersion = p.dump();\r\n\r\n\tvar re_visa = /^4[0-9]{12}([0-9]{3})?$/;\r\n\tvar re_mc = /^5[1-5][0-9]{14}$/;\r\n\tvar re_amex = /^3[47][0-9]{13}$/;\r\n\tvar re_disc = /^6011[0-9]{12}$/;\r\n\r\n\tvar card_type = false;\r\n\r\n\tif (re_visa.test(p.account))\r\n\t{\r\n\t\tcard_type = 'Visa';\r\n\t}\r\n\telse if (re_mc.test(p.account))\r\n\t{\r\n\t\tcard_type = 'Mastercard';\r\n\t}\r\n\telse if (re_amex.test(p.account))\r\n\t{\r\n\t\tcard_type = 'American Express';\r\n\t}\r\n\telse if (re_disc.test(p.account))\r\n\t{\r\n\t\tcard_type = 'Discover';\r\n\t}\r\n\r\n\tif (card_type)\r\n\t{\r\n\t\tdocument.getElementById(target_prefix + 'ccType').value = card_type;\r\n\t}\r\n\r\n\tdocument.getElementById(target_prefix + 'ccNumber').value = p.account;\r\n\tdocument.getElementById(target_prefix + 'ccNameOnCard').value = p.firstname + ' ' + p.surname;\r\n\tdocument.getElementById(target_prefix + 'ccMonth').value = p.exp_month;\r\n\r\n\tvar exp_year = p.exp_year;\r\n\tif (exp_year.length == 2)\r\n\t{\r\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year;\r\n\t}\r\n\telse if (exp_year.length == 4)\r\n\t{\r\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year.substr(2);\r\n\t}\r\n\r\n\tendScanHandling();\r\n}"],"mappings":"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"}
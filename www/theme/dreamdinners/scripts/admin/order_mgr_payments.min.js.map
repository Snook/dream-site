{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_mgr_payments.js"],"sourcesContent":["var originalMaxPPDeduction = 0;\r\nvar selectedFreeMenuItem;\r\nvar couponFreeMenuItemRequired = false;\r\n\r\nfunction handle_ltd_round_up()\r\n{\r\n\t$('#add_ltd_round_up').prop('disabled', false);\r\n\r\n\tif (orderState == 'SAVED' && !$('#add_ltd_round_up').is(':checked') && GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value > 0 && orderInfo.ltd_round_up_value == '')\r\n\t{\r\n\t\t$('#add_ltd_round_up').prop('checked', true);\r\n\r\n\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == 1)\r\n\t\t{\r\n\t\t\t$(\"#ltd_round_up_select option[id='round_up_nearest_dollar']\").attr(\"selected\", \"selected\");\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger('change');\r\n\t\t}\r\n\t}\r\n\telse if ($('#add_ltd_round_up').is(':checked'))\r\n\t{\r\n\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\t}\r\n\r\n\t$('#add_ltd_round_up').on('change', function (e) {\r\n\t\tif ($(this).is(':checked'))\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\r\n\t\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != user_id + '.' + session_id))\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\tmessage: 'Would <span style=\"font-weight: bold; color: red;\">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style=\"font-weight: bold;\">My Preferences</span>.<div style=\"text-align: center; margin-top: 10px;\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option></select></div>',\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\r\n\t\t\t\t\t\tvar rup_dialog = $(this);\r\n\r\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e) {\r\n\r\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\r\n\r\n\t\t\t\t\t\t\tif (rup_value > 0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\r\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\r\n\t\t\t\t\t\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\r\n\r\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value, user_id);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (orderInfo.ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use the selected Round Up value on this order?',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\"No\": function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0, user_id);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"Ask Again Later\": function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t\t\t$.cookie('ltdru', user_id + '.' + session_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\r\n\t\t}\r\n\r\n\t\t$('#ltd_round_up_select').trigger('change');\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n\r\n\t$('#ltd_round_up_select').on('change', function (e) {\r\n\r\n\t\tvar round_up_val = $(this).val();\r\n\r\n\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\r\n\r\n\t\tif ($('#add_ltd_round_up').is(':checked'))\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_div').slideDown();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_div').slideUp();\r\n\r\n\t\t\tround_up_val = 0;\r\n\t\t}\r\n\r\n\t\t/*\r\n\r\n\t\t $.ajax({\r\n\t\t url: 'ddproc.php',\r\n\t\t type: 'POST',\r\n\t\t timeout: 20000,\r\n\t\t dataType: 'json',\r\n\t\t data: {\r\n\t\t processor: 'cart_add_payment',\r\n\t\t payment_type: 'ltd_round_up',\r\n\t\t ltd_round_up_value: round_up_val\r\n\t\t },\r\n\t\t success: function (json)\r\n\t\t {\r\n\t\t if (json.processor_success)\r\n\t\t {\r\n\r\n\t\t }\r\n\t\t else\r\n\t\t {\r\n\t\t dd_message({\r\n\t\t title: 'Error',\r\n\t\t message: json.processor_message\r\n\t\t });\r\n\t\t }\r\n\t\t },\r\n\t\t error: function (objAJAXRequest, strError)\r\n\t\t {\r\n\t\t dd_message({\r\n\t\t title: 'Error',\r\n\t\t message: 'Unexpected error: ' + strError\r\n\t\t });\r\n\t\t }\r\n\t\t });\r\n\r\n\t\t */\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n\r\n\tcalculateTotal();\r\n}\r\n\r\nfunction handle_fundraiser_selection()\r\n{\r\n\tif (isFundraiser)\r\n\t{\r\n\t\t$('#fundraiser_id').prop('disabled', true);\r\n\r\n\t\t$('#fundraiser_value').on('blur', function () {\r\n\t\t\tif (Number($(this).val()) < Number($(this).data('donation_value')))\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Alert',\r\n\t\t\t\t\tmessage: 'Fundraiser value can not be less than $' + $(this).data('donation_value')\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(this).val($(this).data('org_value'));\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tif (parseFloat($('#fundraiser_value').val()) > 0)\r\n\t{\r\n\t\tvar manually_adjusted = true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar manually_adjusted = false;\r\n\t}\r\n\r\n\t$('#fundraiser_id').on('change', function () {\r\n\t\tvar value = 0;\r\n\t\tvar description = '';\r\n\t\tvar disabled = true;\r\n\r\n\t\tif ($(this).find(':selected').val() != '')\r\n\t\t{\r\n\t\t\tif ($(this).find(':selected').data('active') == 1)\r\n\t\t\t{\r\n\t\t\t\tdisabled = false;\r\n\t\t\t}\r\n\r\n\t\t\tvalue = $(this).find(':selected').data('value');\r\n\t\t\tdescription = $(this).find(':selected').data('description');\r\n\t\t}\r\n\r\n\t\t$('#fundraiser_description_div').text(description);\r\n\r\n\t\t$('#fundraiser_value').prop('disabled', disabled);\r\n\r\n\t\tif ((!manually_adjusted && !disabled) || value == 0)\r\n\t\t{\r\n\t\t\t$('#fundraiser_value').val(parseFloat(value).toFixed(2));\r\n\t\t}\r\n\t\telse if (disabled)\r\n\t\t{\r\n\t\t\t$('#fundraiser_value').val($('#fundraiser_value').data('org_value'));\r\n\t\t}\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n\r\n\t$('#fundraiser_value').on('keyup', function () {\r\n\t\tmanually_adjusted = true;\r\n\t\tvar half_grand_total = parseFloat(($('#OEH_grandtotal').text() / 2).toFixed(2));\r\n\t\tvar value = 0;\r\n\r\n\t\tif ($('#fundraiser_value').val())\r\n\t\t{\r\n\t\t\tvalue = parseFloat($('#fundraiser_value').val());\r\n\t\t}\r\n\r\n\t\tif (value > half_grand_total)\r\n\t\t{\r\n\t\t\t$('#fundraiser_value').val(half_grand_total);\r\n\t\t}\r\n\r\n\t\tcalculateTotal();\r\n\t});\r\n}\r\n\r\nfunction handleCouponCodeResult(json)\r\n{\r\n\tif (json.validation_errors)\r\n\t{\r\n\t\tprintString = \"\";\r\n\t\tfor (anError in json.validation_errors)\r\n\t\t{\r\n\t\t\tif (json.validation_errors[anError] != \"\" && json.validation_errors[anError] != null)\r\n\t\t\t{\r\n\t\t\t\tprintString += json.validation_errors[anError] + \"<br />\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#coupon_error\").html(printString);\r\n\t\t$(\"#coupon_error\").show();\r\n\t\t$('#couponCodeSubmitter').show();\r\n\t\t$('#proc_mess').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#coupon_error\").hide();\r\n\t\t$(\"#coupon_error\").html(\"\");\r\n\r\n\t\t$('#proc_mess').hide();\r\n\t\t$('#couponDeleter').show();\r\n\t\t$('#coupon_code').prop('disabled', true);\r\n\r\n\t\t$(\"#couponValue\").val(json.coupon_code_discount_total);\r\n\t\t$(\"#coupon_id\").val(json.code_id);\r\n\r\n\t\t$(\"#coupon_type\").val(json.discount_method);\r\n\r\n\t\tif (json.discount_method == \"FREE_MEAL\")\r\n\t\t{\r\n\t\t\t$('#coupon_free_meal_row').show();\r\n\t\t\t$(\"#free_entree\").html(json.entree_title);\r\n\t\t\t$('#free_entree_servings').val(json.entree_servings);\r\n\t\t}\r\n\t\telse if (json.discount_method == \"FREE_MENU_ITEM\")\r\n\t\t{\r\n\t\t\thandleFreeMenuItem(json.coupon_obj.coupon_code);\r\n\t\t}\r\n\t\telse if (json.discount_method == \"BONUS_CREDIT\")\r\n\t\t{\r\n\t\t\tcreateBonusCredit(0);\r\n\t\t}\r\n\t\telse if (json.coupon_obj.limit_to_recipe_id == \"1\")\r\n\t\t{\r\n\t\t\tlet current_item_qty = json.order_item_array[json.coupon_obj.menu_item_id][0];\r\n\t\t\t$('#qty_' + json.coupon_obj.menu_item_id).val(current_item_qty).trigger('keyup');\r\n\t\t}\r\n\r\n\t\tcoupon = json.coupon;\r\n\t\tcouponDiscountMethod = json.discount_method;\r\n\t\tcouponDiscountVar = json.discount_var;\r\n\t\tcouponlimitedToFT = json.limit_to_finishing_touch;\r\n\t\tcouponIsValidWithPlatePoints = json.valid_with_plate_points_credits;\r\n\t\tcouponFreeMenuItemRequired = true;\r\n\r\n\t\tif (couponlimitedToFT && $(\"#max_plate_points_deduction\").length)\r\n\t\t{\r\n\t\t\tlet maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\r\n\r\n\t\t\toriginalMaxPPDeduction = maxPPDeduction;\r\n\r\n\t\t\tmaxPPDeduction -= json.coupon_code_discount_total;\r\n\t\t\tif (maxPPDeduction < 0)\r\n\t\t\t{\r\n\t\t\t\tmaxPPDeduction = 0;\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(maxPPDeduction));\r\n\t\t}\r\n\r\n\t\tcalculateTotal();\r\n\t}\r\n\r\n}\r\n\r\nfunction processCode()\r\n{\r\n\tif (isDreamRewardsOrder)\r\n\t{\r\n\t\tvar shouldContinue = true;\r\n\t\tshouldContinue = confirm(\"Coupon Codes should not be used with a Dream Rewards Order. Do you want to continue?\");\r\n\t\tif (!shouldContinue)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tvar code = $(\"#coupon_code\").val();\r\n\t$(\"#couponCodeSubmitter\").hide();\r\n\r\n\tvar theForm = $('#editorForm').get()[0];\r\n\r\n\tvar filterBundle = false;\r\n\tvar bundleBox = document.getElementById('selectedBundle');\r\n\tif (bundleBox && !bundleBox.checked)\r\n\t{\r\n\t\tfilterBundle = true;\r\n\t}\r\n\r\n\tvar parameters = \"\";\r\n\tfor (i = 0; i < theForm.elements.length; i++)\r\n\t{\r\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\r\n\t\t{\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\r\n\t\t\tif (i + 1 != theForm.elements.length)\r\n\t\t\t{\r\n\t\t\t\tparameters += \"&\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\r\n\r\n\tvar d = new Date();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessor',\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'add',\r\n\t\t\torg_ts: 'org_order_time',\r\n\t\t\torder_id: order_id,\r\n\t\t\tunique: d.getTime(),\r\n\t\t\tcoupon_code: code,\r\n\t\t\torder_state: orderState,\r\n\t\t\tparams: parameters\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\thandleCouponCodeResult(json);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t$(\"#coupon_error\").html(\"\");\r\n\t\t\t$(\"#coupon_error\").hide();\r\n\t\t\t$('#couponCodeSubmitter').show();\r\n\t\t\t$('#proc_mess').hide();\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction removeCode()\r\n{\r\n\tvar theForm = $('#editorForm').get()[0];\r\n\r\n\tvar filterBundle = false;\r\n\tvar bundleBox = document.getElementById('selectedBundle');\r\n\tif (bundleBox && !bundleBox.checked)\r\n\t{\r\n\t\tfilterBundle = true;\r\n\t}\r\n\r\n\tvar parameters = \"\";\r\n\tfor (i = 0; i < theForm.elements.length; i++)\r\n\t{\r\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\r\n\t\t{\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\r\n\t\t\tif (i + 1 != theForm.elements[i])\r\n\t\t\t{\r\n\t\t\t\tparameters += \"&\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\r\n\r\n\tvar d = new Date();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessor',\r\n\t\t\top: 'remove',\r\n\t\t\tuser_id: user_id,\r\n\t\t\torg_ts: 'org_order_time',\r\n\t\t\torder_id: order_id,\r\n\t\t\tunique: d.getTime(),\r\n\t\t\torder_state: orderState,\r\n\t\t\tparams: parameters\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif ($(\"#coupon_type\").val() == \"BONUS_CREDIT\")\r\n\t\t\t{\r\n\t\t\t\tremoveBonusCredit();\r\n\t\t\t}\r\n\r\n\t\t\t$('#couponCodeSubmitter').show();\r\n\t\t\t$('#proc_mess').hide();\r\n\t\t\t$('#couponDeleter').hide();\r\n\t\t\t$('#coupon_code').prop('disabled', false);\r\n\t\t\t$(\"#coupon_error\").hide();\r\n\t\t\t$(\"#coupon_error\").html(\"\");\r\n\t\t\t$(\"#couponValue\").val(0);\r\n\t\t\t$('#coupon_free_meal_row').hide();\r\n\t\t\t$(\"#free_entree\").html(\"\");\r\n\t\t\t$(\"#coupon_id\").val(\"\");\r\n\t\t\t$(\"#coupon_type\").val(\"\");\r\n\r\n\t\t\t$('#coupon_select_free_menu_item_row').hide();\r\n\t\t\t$('#free_menu_item_coupon option:not([value])').attr('data-dd_required', false);\r\n\r\n\t\t\tif (coupon && coupon.limit_to_recipe_id == \"1\")\r\n\t\t\t{\r\n\t\t\t\tlet current_item_qty = 0;\r\n\r\n\t\t\t\tif (Object.keys(json.order_item_array).length && json.order_item_array[coupon.menu_item_id])\r\n\t\t\t\t{\r\n\t\t\t\t\tcurrent_item_qty = json.order_item_array[coupon.menu_item_id][0];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('#qty_' + coupon.menu_item_id).val(current_item_qty);\r\n\t\t\t}\r\n\r\n\t\t\tcoupon = false;\r\n\t\t\tcouponFreeMenuItem = false;\r\n\t\t\tcouponFreeMenuItemRequired = false;\r\n\r\n\t\t\tcouponDiscountMethod = 'NONE';\r\n\t\t\tcouponDiscountVar = 0;\r\n\t\t\tcouponlimitedToFT = false;\r\n\t\t\tcouponIsValidWithPlatePoints = true;\r\n\r\n\t\t\tcalculateTotal();\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t$(\"#coupon_error\").html(\"\");\r\n\t\t\t$(\"#coupon_error\").hide();\r\n\t\t\t$('#couponCodeSubmitter').show();\r\n\t\t\t$('#proc_mess').hide();\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nfunction handle_free_menu_item_edit()\r\n{\r\n\tif (couponFreeMenuItem)\r\n\t{\r\n\t\thandleFreeMenuItem($('#coupon_code').val());\r\n\t}\r\n}\r\n\r\nfunction handleFreeMenuItem(coupon_code)\r\n{\r\n\tvar menu_item_count = 0;\r\n\r\n\tif (coupon_code == 'SRDessert')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9\");\r\n\t}\r\n\telse if (coupon_code == 'SRDinner')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'\");\r\n\t}\r\n\telse if (coupon_code == 'CC3RDFREE')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00\");\r\n\t}\r\n\telse if (coupon_code == 'SCFinishingTouch')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9 && menu_item.price <= 15.00\");\r\n\t}\r\n\telse if (coupon_code == 'HCFastLane')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'\");\r\n\t}\r\n\telse if (coupon_code == 'SCFriendDinner')\r\n\t{\r\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' && menu_item.intro_item == true\");\r\n\t}\r\n\r\n\tif (menu_item_count > 0)\r\n\t{\r\n\t\t$('#coupon_select_free_menu_item_row').show();\r\n\r\n\t\t$('#free_menu_item_coupon').attr('data-dd_required', true).on('change', function (e) {\r\n\t\t\tvar menu_item = $(this).find(':selected').data('menu_item');\r\n\t\t\tvar price = $(this).find(':selected').data('price');\r\n\r\n\t\t\t$('#couponValue').val(price);\r\n\t\t\tselectedFreeMenuItem = menu_item;\r\n\r\n\t\t\tcalculateTotal();\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Alert',\r\n\t\t\tmessage: 'No valid free items found in cart for this coupon, please add the desired item and then submit the coupon.'\r\n\t\t});\r\n\r\n\t\tremoveCode();\r\n\t}\r\n}\r\n\r\nfunction buildFreeMenuItemList(expression)\r\n{\r\n\trebuildOrderItemsArray();\r\n\r\n\tvar menu_item_in_list = false;\r\n\tvar selected_menu_item_in_list = false; // temp store, used for tab switching\r\n\tvar menu_item_count = 0;\r\n\r\n\t// setup efl free item select\r\n\tvar s = $('#free_menu_item_coupon').html('').attr('disabled', ((couponFreeMenuItem) ? true : false));\r\n\r\n\t$(\"<option />\").val('').text('Select Free Item').appendTo(s);\r\n\r\n\t$.each(orderItems, function (index, menu_item) {\r\n\t\tif (!menu_item_in_list)\r\n\t\t{\r\n\t\t\tmenu_item_in_list = ((couponFreeMenuItem == menu_item.id) ? true : false);\r\n\t\t}\r\n\r\n\t\tif (!selected_menu_item_in_list)\r\n\t\t{\r\n\t\t\tselected_menu_item_in_list = ((selectedFreeMenuItem == menu_item.id) ? true : false);\r\n\t\t}\r\n\r\n\t\tif (eval(expression))\r\n\t\t{\r\n\t\t\tmenu_item_count++;\r\n\r\n\t\t\t$(\"<option />\")\r\n\t\t\t\t.val(menu_item.id)\r\n\t\t\t\t.attr('data-menu_item', menu_item.id)\r\n\t\t\t\t.attr('data-price', menu_item.price)\r\n\t\t\t\t.attr('selected', ((couponFreeMenuItem == menu_item.id || selectedFreeMenuItem == menu_item.id) ? true : false))\r\n\t\t\t\t.text(menu_item.item_title + ' (' + menu_item.price + ')').appendTo(s);\r\n\t\t}\r\n\t});\r\n\r\n\tif (!menu_item_in_list)\r\n\t{\r\n\t\t$('#couponValue').val('0.00');\r\n\r\n\t\t$('#free_menu_item_coupon').attr('disabled', false);\r\n\t}\r\n\r\n\tcalculateTotal();\r\n\r\n\treturn menu_item_count;\r\n}\r\n\r\nfunction stripLeadingZeroes(val)\r\n{\r\n\tvar leadingZeroCount = 0;\r\n\tvar retVal = val;\r\n\r\n\tfor (var i = 0, len = val.length; i < len; i++)\r\n\t{\r\n\t\tif (val[i] != '0')\r\n\t\t{\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tleadingZeroCount++;\r\n\t}\r\n\r\n\tif (leadingZeroCount > 0)\r\n\t{\r\n\t\tretVal = val.slice(leadingZeroCount)\r\n\t}\r\n\r\n\treturn retVal;\r\n\r\n}\r\n\r\nfunction handlePlatePointsDiscount(val)\r\n{\r\n\tif (!couponIsValidWithPlatePoints)\r\n\t{\r\n\t\tdocument.getElementById('plate_points_discount').value = formatAsMoney(0);\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Alert',\r\n\t\t\tmessage: 'PLATEPOINTS cannot be used with the attached coupon.'\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tif ((isNaN(val) || val <= 0) && val != \".\")\r\n\t{\r\n\t\t$('#plate_points_discount').val(\"0\");\r\n\t\tcalculateTotal();\r\n\t\treturn;\r\n\t}\r\n\r\n\tneedPlatePointsMaxDiscountChangeWarning = false;\r\n\r\n\tval = formatAsMoney(Math.abs(val)) * 1;\r\n\r\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\r\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\r\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\r\n\r\n\tif (maxPPDeduction < curPPDiscount)\r\n\t{\r\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\r\n\t}\r\n\r\n\tif (maxPPCredit > maxPPDeduction)\r\n\t{\r\n\t\t$('#tbody_max_plate_points_deduction').show();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#tbody_max_plate_points_deduction').hide();\r\n\t}\r\n\r\n\tvar cap = maxPPCredit;\r\n\tif (cap > maxPPDeduction)\r\n\t{\r\n\t\tcap = maxPPDeduction;\r\n\t}\r\n\r\n\tif (val > cap)\r\n\t{\r\n\t\tval = cap;\r\n\t\t$('#plate_points_discount').val(val);\r\n\r\n\t}\r\n\r\n\tcalculateTotal();\r\n}\r\n\r\nfunction editCashCheckAmount(id, type)\r\n{\r\n\t// Show input form\r\n\t$('#check_total_input_' + id).show();\r\n\t$('#check_payment_number_input_' + id).show();\r\n\t// Hide edit link and text\r\n\t$('#check_total_' + id).hide();\r\n\t$('#check_payment_number_' + id).hide();\r\n\t$('#check_editlink_' + id).hide();\r\n}\r\n\r\nfunction editCashCheckUpdate(id, type)\r\n{\r\n\t$('#payment_sum_value_' + id).html($('#check_total_input_form_' + id).val());\r\n\t$('#payment_sum_name_' + id).html('Check (#' + $('#check_payment_number_input_form_' + id).val() + ')');\r\n\r\n\t// Loop through payment summary to get new total\r\n\tnew_total = 0;\r\n\t$('[id^=\"payment_sum_value_\"]').each(function (index) {\r\n\t\tnew_total = new_total + Number($(this).text());\r\n\t});\r\n\r\n\t// loop through and subtract refunds\r\n\t$('[id^=\"refund_payment_sum_value_\"]').each(function (index) {\r\n\t\tnew_total = new_total - Number($(this).text());\r\n\t});\r\n\r\n\t$('#OEH_paymentsTotal').html(formatAsMoney(new_total));\r\n\r\n\tcalculateTotal();\r\n}\r\n\r\n// Check cift card balance\r\nfunction getGiftCardBalance()\r\n{\r\n\t$('#gc_proc_anim').show();\r\n\t$('#balance_target').hide();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'giftCardBalance',\r\n\t\t\tcard_number: $('#debit_gift_card_number').val(),\r\n\t\t\toutput: 'json'\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$('#balance_target').show();\r\n\t\t\t\t$('#balance_target').html(json.card_balance);\r\n\t\t\t\t$('#gc_proc_anim').hide();\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#balance_target').show();\r\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + request_uri + '\">[login]</a> again.</span>');\r\n\t\t\t\t$('#gc_proc_anim').hide();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#balance_target').show();\r\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t\t$('#gc_proc_anim').hide();\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#balance_target').show();\r\n\t\t\t$('#balance_target').html('Error: ' + strError + '. Please <a href=\"javascript:getGiftCardBalance();\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction editCashCheckAmountCommit(id, type)\r\n{\r\n\talert(\"You are only modifying the \" + type + \" details.\\nNo other modifications will be made.\");\r\n\r\n\t$('#check_total_mess_' + id).hide();\r\n\tnew_total = $('#check_total_input_form_' + id).val();\r\n\tnew_number = $('#check_payment_number_input_form_' + id).val();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_editCashCheckAmount',\r\n\t\t\tid: id,\r\n\t\t\ttype: type,\r\n\t\t\tnew_total: new_total,\r\n\t\t\tnew_number: new_number,\r\n\t\t\torder_id: order_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t// Hide input form\r\n\t\t\t\t$('#check_total_input_' + id).hide();\r\n\t\t\t\t$('#check_payment_number_input_' + id).hide();\r\n\t\t\t\t// Show edit link and text\r\n\t\t\t\t$('#check_total_' + id).show();\r\n\t\t\t\t$('#check_payment_number_' + id).show();\r\n\t\t\t\t$('#check_editlink_' + id).show();\r\n\r\n\t\t\t\t// Update page text with new values\r\n\t\t\t\t$('#check_total_' + id).html(new_total);\r\n\t\t\t\t$('#check_payment_number_' + id).html(new_number);\r\n\r\n\t\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t\t$('#check_total_mess_' + id).show().html('<img src=\"' + PATH.image_admin + '/icon/accept.png\" alt=\"Accept\" />').fadeOut(2000);\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + +'\">[login]</a> again.</span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">' + json.processor_message + '</span>');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#check_total_mess_' + id).show();\r\n\t\t\t$('#check_total_mess_' + id).html('Error: ' + strError + '. Please <a href=\"javascript:editCashCheckAmountCommit(' + id + ',\\'' + type + '\\');\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\n// Proccess delayed payment now\r\nfunction showButtonProcessDelayedPaymentNow(message)\r\n{\r\n\tif (PendingDPOriginalStatus == 'PENDING')\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"process_payment\" value=\"Process delayed payment now\" onclick=\"processPayment();\">');\r\n\t}\r\n\telse if (message)\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html(message);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#payment_proc_mess').hide();\r\n\t}\r\n}\r\n\r\nfunction processPayment()\r\n{\r\n\tif (confirm(\"Are you sure you wish to process the delayed payment now? Click OK to process.\"))\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 60000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_delayedPaymentProcessor',\r\n\t\t\t\torder_number: order_id\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.success)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ($('#point_to_transaction').length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar credit_card_number = $('#point_to_transaction option:selected').text();\r\n\t\t\t\t\t\t$('#cc_payment_number_other').html('XXXXXXXXXXXX' + credit_card_number.substr(-4));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$('#cc_delayed_tran_num_other').html(json.transaction_id);\r\n\t\t\t\t\t$('#cc_delayed_date_other').html(json.transaction_date);\r\n\t\t\t\t\t$('#cc_delayed_status_other').html('Status: Payment Processed');\r\n\r\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'color': ''});\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'color': ''});\r\n\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).html(json.summary_date);\r\n\r\n\t\t\t\t\tcanAdjustDelayedPayment = false;\r\n\r\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:green;font-weight:bold;\">Payment Processed.</span>').fadeOut(4000);\r\n\t\t\t\t}\r\n\t\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$('#payment_proc_mess').show();\r\n\t\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPayment();\">[try again]</a>.');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Change delayed payment status\r\nfunction setDelayedPaymentStatusTo()\r\n{\r\n\t//Do not allow the user to reset to FAIL\r\n\tif ($('#change_delayed_payment_status').val() == 'FAIL' && PendingDPOriginalStatus != 'FAIL')\r\n\t{\r\n\t\talert('Can not change transaction back to Fail. Please choose pending or canceled.');\r\n\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\t\treturn false;\r\n\t}\r\n\t// Reset transaction id dropdown, can only set the status of one dropdown a time.\r\n\tif ($('#change_delayed_payment_status'))\r\n\t{\r\n\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\r\n\t}\r\n\r\n\tif ($('#change_delayed_payment_status').val() == PendingDPOriginalStatus)\r\n\t{\r\n\t\tshowButtonProcessDelayedPaymentNow();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"set_delayed_payment_status\" value=\"Set delayed payment status to ' + $('#change_delayed_payment_status').val().toLowerCase() + '\" onClick=\"processDelayedPaymentStatus();\">');\r\n\t}\r\n}\r\n\r\nfunction setupCouponState()\r\n{\r\n\t// if a coupon is attached we need to update the UI\r\n\t// 1) set up the coupon code box - disabled with code\r\n\tif (coupon)\r\n\t{\r\n\t\tdocument.getElementById('couponCodeSubmitter').style.display = \"none\";\r\n\t\tdocument.getElementById('couponDeleter').style.display = \"inline\";\r\n\t\tdocument.getElementById('coupon_code').value = coupon.coupon_code;\r\n\t\tdocument.getElementById('coupon_code').disabled = true;\r\n\t}\r\n}\r\n\r\nfunction processDelayedPaymentStatus()\r\n{\r\n\t$('#payment_proc_mess').show();\r\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_delayedPaymentStatusProcessor',\r\n\t\t\torder_number: order_id,\r\n\t\t\told_status: PendingDPOriginalStatus,\r\n\t\t\tnew_status: $('#change_delayed_payment_status').val(),\r\n\t\t\tstore_id: store_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.success)\r\n\t\t\t{\r\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\r\n\t\t\t\tPendingDPOriginalStatus = json.status;\r\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\r\n\t\t\t\t// Reset transaction id dropdown, only set one at a time.\r\n\t\t\t\tif ($('#change_delayed_payment_status'))\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Voodoo, editing cash/check totals element id payment_sum_value_*, so change\r\n\t\t\t\t// element id to cancelled_payment_sum_value_* which will be skipped over in the total caclulation.\r\n\t\t\t\tif (json.status == 'CANCELLED' && $('#payment_sum_value_' + json.payment_id))\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).attr('id', 'cancelled_payment_sum_value_' + json.payment_id);\r\n\t\t\t\t}\r\n\t\t\t\telse if (json.status == 'PENDING' && $('#cancelled_payment_sum_value_' + json.payment_id))\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).attr('id', 'payment_sum_value_' + json.payment_id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update payment status and details\r\n\t\t\t\tif (json.status == 'CANCELLED')\r\n\t\t\t\t{\r\n\t\t\t\t\t// Can only adjust pending payments\r\n\t\t\t\t\tcanAdjustDelayedPayment = false;\r\n\r\n\t\t\t\t\t// Update summary rows\r\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'line-through'});\r\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) - Number($('#cancelled_payment_sum_value_' + json.payment_id).html())));\r\n\r\n\t\t\t\t\t// Reset new payment if they have auto adjust selected\r\n\t\t\t\t\t$('#dp_adjust_div').hide();\r\n\t\t\t\t\t//\t$('#autoAdjust').attr({ 'checked' : 'checked' });\r\n\t\t\t\t\t//\thandleAutoAdjust($('#autoAdjust'));\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// Payment pending, we are allowed to edit it\r\n\t\t\t\t\tcanAdjustDelayedPayment = true;\r\n\r\n\t\t\t\t\t// Update summary rows\r\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'none'});\r\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) + Number($('#payment_sum_value_' + json.payment_id).html())));\r\n\r\n\t\t\t\t\t// Allow auto adjust to be used\r\n\t\t\t\t\tcanAutoAdjust = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcalculateTotal();\r\n\r\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Delayed Payment set to ' + PendingDPOriginalStatus + '.</span>');\r\n\t\t\t\t$('#change_delayed_payment_status_img').attr({\r\n\t\t\t\t\tsrc: PATH.image_admin + '/icon/accept.png',\r\n\t\t\t\t\talt: 'Accept'\r\n\t\t\t\t});\r\n\t\t\t\t$('#change_delayed_payment_status_img').css({display: 'inline'}).fadeOut(2000);\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#payment_proc_mess').show();\r\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processDelayedPaymentStatus();\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Point to new transaction ID\r\nfunction pointToTransaction()\r\n{\r\n\t// Reset payment status dropdown, only set one at a time.\r\n\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\r\n\tif ($('#point_to_transaction').val() == PendingDPOriginalTransActionID)\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\tshowButtonProcessDelayedPaymentNow();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#payment_proc_mess').show();\r\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"point_to_payment\" value=\"Point payment to selected Credit Card Number\" onClick=\"processPointToTransaction();\">');\r\n\t}\r\n}\r\n\r\nfunction processPointToTransaction()\r\n{\r\n\t$('#payment_proc_mess').show();\r\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_processPointToTransaction',\r\n\t\t\torder_number: order_id,\r\n\t\t\tstore_id: store_id,\r\n\t\t\told_ref_number: PendingDPOriginalTransActionID,\r\n\t\t\tnew_ref_number: $('#point_to_transaction').val(),\r\n\t\t\tnew_card_number: $('#point_to_transaction option:selected').text()\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.success)\r\n\t\t\t{\r\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\r\n\t\t\t\tPendingDPOriginalTransActionID = json.transactionid;\r\n\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\r\n\r\n\t\t\t\t// Reset payment status dropdown, only set one at a time.\r\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\r\n\r\n\t\t\t\t$('#payment_sum_type_' + json.payment_id).html(json.new_card_type);\r\n\t\t\t\t$('#payment_sum_name_' + json.payment_id).html('Delayed CC Payment (#' + json.new_card_number + ')');\r\n\r\n\t\t\t\t$('#cc_credit_card_type_other').html(json.new_card_type);\r\n\t\t\t\t$('#cc_payment_transaction_number_other').html(json.transactionid);\r\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Credit card set to ' + json.new_card_type + '.</span>');\r\n\t\t\t\t$('#point_to_transaction_img').css({display: 'inline'}).fadeOut(2000);\r\n\t\t\t}\r\n\t\t\telse if (json.message == \"Not logged in\")\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$('#payment_proc_mess').show();\r\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPointToTransaction();\">[try again]</a>.');\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction unsetAutoAdjust()\r\n{\r\n\tif ($('#autoAdjust').length)\r\n\t{\r\n\t\tdocument.getElementById('autoAdjust').checked = false;\r\n\t}\r\n}\r\n\r\nfunction setAllPaymentFieldsToUnrequired()\r\n{\r\n\tvar reqField;\r\n\r\n\treqField = document.getElementById('payment1_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('payment1_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_reference_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('payment2_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('payment2_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_check_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\treqField = document.getElementById('debit_gift_card_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('debit_gift_card_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n}\r\n\r\nvar lastPayment1Type = false;\r\n\r\nfunction changePayment1(mySelect)\r\n{\r\n\r\n\tif (lastPayment1Type && lastPayment1Type != mySelect)\r\n\t{\r\n\t\tif (lastPayment1Type == 'CC')\r\n\t\t{\r\n\t\t\t$('#payment1_gc_total_amount').val(\"\");\r\n\t\t}\r\n\t\telse if (lastPayment1Type == 'REFERENCE')\r\n\t\t{\r\n\t\t\t$('#payment1_reference_total_amount').val(\"\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlastPayment1Type = mySelect;\r\n\r\n\tvar divGC = document.getElementById('payment1_gc');\r\n\tvar divCash = document.getElementById('payment1_cash');\r\n\tvar divRefundCash = document.getElementById('payment1_refund_cash');\r\n\tvar divCheck = document.getElementById('payment1_check');\r\n\tvar divCC = document.getElementById('payment1_cc');\r\n\tvar divCredit = document.getElementById('payment1_credit');\r\n\tvar divRef = document.getElementById('payment1_reference');\r\n\tvar divRefOther = document.getElementById('payment1_ref');\r\n\tvar refundDiv = document.getElementById('payment1RefundCCDiv');\r\n\r\n\tvar dpAdjust = document.getElementById('dp_adjust_div'); // can be null\r\n\r\n\tdocument.getElementById('new_payments_total').value = 0;\r\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\r\n\t{\r\n\t\tdocument.getElementById('new_payments_total').value = formatAsMoney(document.getElementById('store_credits_amount').value);\r\n\t}\r\n\r\n\tvar divDebitGiftCard = document.getElementById('payment1_debit_gift_card');\r\n\r\n\tvar payment2 = document.getElementById('payment2');\r\n\r\n\tvar selected_ref = false;\r\n\tif (mySelect.substr(0, 4) == 'REF_')\r\n\t{\r\n\t\tselected_ref = mySelect.substr(4);\r\n\t\tmySelect = 'REFERENCE_OTHER';\r\n\t}\r\n\r\n\tresetPendingDelayedPayment();\r\n\r\n\t// reset so validation does not fail when using payment types other than CC\r\n\tvar amount = document.getElementById('payment1_cc_total_amount');\r\n\tamount.value = '';\r\n\r\n\tvar reqField;\r\n\treqField = document.getElementById('payment1_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_refund_cash_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_check_total_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_reference_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('debit_gift_card_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('debit_gift_card_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment1_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\tswitch (mySelect)\r\n\t{\r\n\t\tcase \"REFERENCE\":\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'block';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\r\n\t\t\tif (dpAdjust && canAdjustDelayedPayment)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t\tunsetAutoAdjust();\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment1_reference_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\r\n\t\t\tonPaymentSelected();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CERT\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'block';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tif (orderState != 'ACTIVE')\r\n\t\t\t{\r\n\t\t\t\tpayment2.style.display = 'block';\r\n\t\t\t}\r\n\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment1_gc_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_gc_payment_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CASH\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'block';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tif (orderState == 'ACTIVE')\r\n\t\t\t{\r\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\r\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\t\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\r\n\t\t\t\tamount.value = formatAsMoney(0);\r\n\t\t\t}\r\n\r\n\t\t\treqField = document.getElementById('payment1_cash_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_cash_total_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFUND_CASH\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'block';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'block';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tamount = document.getElementById('payment1_check_total_amount');\r\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\r\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\r\n\t\t\treqField = document.getElementById('payment1_check_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_check_total_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t\t\t}\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CREDIT\":\r\n\t\t\trefundDiv.style.display = 'none';\r\n\r\n\t\t\tpaymentsTotal = Number(document.getElementById('OEH_paymentsTotal').innerHTML);\r\n\r\n\t\t\tif (paymentsTotal != 0)\r\n\t\t\t{\r\n\t\t\t\talert(\"'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away.\");\r\n\t\t\t\tpaySel = document.getElementById('payment1_type');\r\n\t\t\t\tpaySel.value = '';\r\n\t\t\t\tchangePayment1('');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'block';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'block';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tamount = document.getElementById('payment1_cc_total_amount');\r\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\r\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\r\n\t\t\treqField = document.getElementById('payment1_ccNameOnCard');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccNumber');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_cc_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccType');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccMonth');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment1_ccYear');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CARD\":\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'block';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('debit_gift_card_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('debit_gift_card_number');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tif (orderState != 'ACTIVE')\r\n\t\t\t{\r\n\t\t\t\tpayment2.style.display = 'block';\r\n\t\t\t}\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"DPADJUST\":\r\n\t\t\tif (!dpAdjust)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t} // should never happen\r\n\r\n\t\t\tif (!canAdjustDelayedPayment)\r\n\t\t\t{\r\n\t\t\t\talert('Can not adjust delayed payment.\\n\\nDelayed payment status: ' + PendingDPOriginalStatus);\r\n\t\t\t\tautoAdjBox = document.getElementById('autoAdjust');\r\n\t\t\t\tif (!forceManualAutoAdjust)\r\n\t\t\t\t{\r\n\t\t\t\t\tautoAdjBox.checked = true;\r\n\t\t\t\t\thandleAutoAdjust(autoAdjBox);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdpAdjust.style.display = 'block';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\t\t\tbalance = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\t\t\tadjustPendingDelayedPayment(balance);\r\n\r\n\t\t\tchangePayment2('');\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'block';\r\n\r\n\t\t\tdocument.getElementById('p1_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\r\n\t\t\tdocument.getElementById('p1_ref_id').innerHTML = selected_ref;\r\n\r\n\t\t\treqField = document.getElementById('payment1_ref_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\r\n\t\t\t\treqField.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\r\n\t\t\t}\r\n\r\n\t\t\tchangePayment2('');\r\n\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\t\tcase 'CC_REFUND':\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'block';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\r\n\t\t\tonPaymentSelected();\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tunsetAutoAdjust();\r\n\t\t\trefundDiv.style.display = 'none';\r\n\t\t\tdivGC.style.display = 'none';\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivRefundCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivCredit.style.display = 'none';\r\n\t\t\tpayment2.style.display = 'none';\r\n\t\t\tdivRef.style.display = 'none';\r\n\t\t\tdivRefOther.style.display = 'none';\r\n\t\t\tdivDebitGiftCard.style.display = 'none';\r\n\r\n\t\t\tresetPendingDelayedPayment();\r\n\t\t\tif (dpAdjust)\r\n\t\t\t{\r\n\t\t\t\tdpAdjust.style.display = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tonPaymentDeselected();\r\n\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction changePayment2(mySelect)\r\n{\r\n\r\n\treportPaymentStatus(true);\r\n\r\n\tvar textBal = $(\"#bal_due\").html();\r\n\tvar balance = Number($(\"#bal_due\").html());\r\n\tif (isNaN(balance.valueOf()))\r\n\t{\r\n\t\tbalance = \"\";\r\n\t}\r\n\tif (balance.valueOf() == 0)\r\n\t{\r\n\t\tbalance = \"\";\r\n\t}\r\n\r\n\tvar divCash = document.getElementById('payment2_cash');\r\n\tvar divRefundCash = document.getElementById('payment2_refund)_cash');\r\n\tvar divCheck = document.getElementById('payment2_check');\r\n\tvar divCC = document.getElementById('payment2_cc');\r\n\tvar divref2 = document.getElementById('payment2_ref');\r\n\r\n\tvar reqField;\r\n\r\n\treqField = document.getElementById('payment2_gc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_gc_payment_number');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNameOnCard');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccNumber');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cash_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_cc_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ref_total_amount');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccType');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccMonth');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\treqField = document.getElementById('payment2_ccYear');\r\n\tif (reqField)\r\n\t{\r\n\t\treqField.setAttribute('data-dd_required', 'false');\r\n\t}\r\n\r\n\tvar selected_ref = false;\r\n\tif (mySelect.substr(0, 4) == 'REF_')\r\n\t{\r\n\t\tselected_ref = mySelect.substr(4);\r\n\t\tmySelect = 'REFERENCE_OTHER';\r\n\t}\r\n\r\n\tswitch (mySelect)\r\n\t{\r\n\t\tcase \"CASH\":\r\n\t\t\tdivCash.style.display = 'block';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivref2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment2_cash_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#payment2_cash_total_amount\").val(balance);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'block';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivref2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment2_check_total_amount');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#payment2_check_total_amount\").val(balance);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'block';\r\n\t\t\tdivref2.style.display = 'none';\r\n\r\n\t\t\treqField = document.getElementById('payment2_ccNameOnCard');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccNumber');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccType');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccMonth');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\treqField = document.getElementById('payment2_ccYear');\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#payment2_cc_total_amount\").val(balance);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t\t\tdivref2.style.display = 'block';\r\n\r\n\t\t\tdocument.getElementById('p2_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\r\n\t\t\tdocument.getElementById('p2_ref_id').innerHTML = selected_ref;\r\n\r\n\t\t\treqField = document.getElementById('payment2_ref_total_amount');\r\n\r\n\t\t\t$(\"#payment2_ref_total_amount\").val(balance);\r\n\r\n\t\t\tif (reqField)\r\n\t\t\t{\r\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\treqField = document.getElementById('payment2_type');\r\n\t\t\treqField.selectedItem = 0;\r\n\t\t\tdivCash.style.display = 'none';\r\n\t\t\tdivCheck.style.display = 'none';\r\n\t\t\tdivCC.style.display = 'none';\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction validateRefTrans(field, limit)\r\n{\r\n\tif (field.value > limit)\r\n\t{\r\n\t\talert('Limited to ' + limit + '.');\r\n\t\tfield.value = limit;\r\n\t}\r\n\r\n\tif (field.value < 0)\r\n\t{\r\n\t\talert('Must be a positive number.');\r\n\t\tfield.value = 0;\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction payAmountChange(value)\r\n{\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction resetPendingDelayedPayment(balance)\r\n{\r\n\tvar idElem = document.getElementById('PendingDP');\r\n\r\n\tif (idElem)\r\n\t{\r\n\t\t// get original amount\r\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\r\n\r\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(org_dp_amount);\r\n\r\n\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(org_dp_amount);\r\n\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(0);\r\n\r\n\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(org_dp_amount);\r\n\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(0);\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction adjustPendingDelayedPayment(balance)\r\n{\r\n\tvar idElem = document.getElementById('PendingDP');\r\n\r\n\tif (idElem)\r\n\t{\r\n\t\t// get original amount\r\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\r\n\r\n\t\tvar adjVal = org_dp_amount + (balance * 1);\r\n\t\tif (adjVal < 0)\r\n\t\t{\r\n\t\t\tbalance = adjVal * -1;\r\n\t\t\tadjVal = 0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tbalance = 0;\r\n\t\t}\r\n\r\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(adjVal);\r\n\t\tvar adjustmentAmount = getPendingDPAdjustment();\r\n\r\n\t\tif (adjustmentAmount > 0)\r\n\t\t{\r\n\t\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(adjVal);\r\n\t\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(adjustmentAmount);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(adjVal);\r\n\t\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(adjustmentAmount * -1);\r\n\t\t}\r\n\r\n\t\treturn balance;\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn balance;\r\n\t}\r\n\r\n}\r\n\r\nfunction getPendingDPAdjustment()\r\n{\r\n\tvar idElem = document.getElementById('PendingDP');\r\n\tif (idElem)\r\n\t{\r\n\t\t// get original amount\r\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\r\n\t\tvar adj_dp_amount = Number(document.getElementById('PendingDPAmount').value);\r\n\t\treturn formatAsMoney(adj_dp_amount - org_dp_amount);\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn 0;\r\n\t}\r\n\r\n\treturn 0;\r\n\r\n}\r\n\r\nfunction assignBalanceToRefTransactions(balance)\r\n{\r\n\tvar paymentCount = 0;\r\n\r\n\tvar prefix = 'RT_';\r\n\tif (balance < 0)\r\n\t{\r\n\t\tprefix = 'Cr_RT_';\r\n\t}\r\n\r\n\t// clear any previous values\r\n\tfor (ident in existingPaymentAmountArray)\r\n\t{\r\n\t\tvar elname = 'RT_' + ident;\r\n\t\tpaymentCount++;\r\n\t\tdocument.getElementById('RT_' + ident).value = \"\";\r\n\t}\r\n\r\n\t// clear any previous values\r\n\tfor (ident in existingPaymentAmountArray)\r\n\t{\r\n\r\n\t\t// alert('nuulify');\r\n\t\tvar elname = 'Cr_RT_' + ident;\r\n\t\t//\talert(elname);\r\n\t\tdocument.getElementById('Cr_RT_' + ident).value = \"\";\r\n\t}\r\n\r\n\tif (balance == 0)\r\n\t{\r\n\t\treportPaymentStatus(false);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (balance > 0)\r\n\t{\r\n\t\t//alert(\"doing it\");\r\n\t\t// first, use store credit\r\n\t\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\r\n\t\t{\r\n\t\t\tvar amountCredit = 0;\r\n\t\t\tvar maxStoreCredit = Number($('#eoTotalStoreCredit').html());\r\n\t\t\t//alert(\"max: \" + maxStoreCredit);\r\n\r\n\t\t\tif (balance > maxStoreCredit)\r\n\t\t\t{\r\n\t\t\t\tamountCredit = maxStoreCredit;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tamountCredit = balance;\r\n\t\t\t}\r\n\r\n\t\t\t// alert(\"amountCredit: \" + amountCredit);\r\n\r\n\t\t\tdocument.getElementById('store_credits_amount').value = formatAsMoney(amountCredit);\r\n\t\t\tbalance -= amountCredit;\r\n\r\n\t\t\t// alert(\"balance: \" + balance);\r\n\t\t}\r\n\r\n\t\t// second, look for a payment that could handle the full credit/debit\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\tif (balance <= existingPaymentAmountArray[ident].amount)\r\n\t\t\t{\r\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\r\n\t\t\t\trefTransField.value = formatAsMoney(balance);\r\n\t\t\t\treportPaymentStatus(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// otherwise just assign to the first one\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(balance);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// balance < 0\r\n\t\t// first, look for a payment that could handle the full credit/debit\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\r\n\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\r\n\t\t\t{\r\n\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\r\n\t\t\t}\r\n\r\n\t\t\tif (balance >= (remainingFundsThisPayment * -1))\r\n\t\t\t{\r\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\r\n\t\t\t\trefTransField.value = formatAsMoney(Math.abs(balance));\r\n\t\t\t\treportPaymentStatus(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//if not found then we must spread the balance across multiple payments\r\n\t\tif (paymentCount > 1)\r\n\t\t{\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\r\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\r\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\r\n\t\t\t\t{\r\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar thisAmount = (remainingFundsThisPayment * -1);\r\n\r\n\t\t\t\tif (thisAmount < balance)\r\n\t\t\t\t{\r\n\t\t\t\t\tthisAmount = balance;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(Math.abs(thisAmount));\r\n\t\t\t\tbalance -= thisAmount;\r\n\r\n\t\t\t\tif (balance >= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (paymentCount == 1)\r\n\t\t{\r\n\t\t\t// just assign the max amount, the remainder will need to be paid through another method\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\r\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\r\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\r\n\t\t\t\t{\r\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(remainingFundsThisPayment);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction storeCreditAmountChange(val)\r\n{\r\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\r\n\r\n\tif (amountCredit.valueOf() < val)\r\n\t{\r\n\t\t$('#store_credits_amount').val(amountCredit.valueOf());\r\n\r\n\t}\r\n\r\n\tpayAmountChange();\r\n}\r\n\r\nfunction storeCreditClick(obj)\r\n{\r\n\tvar amountElem = document.getElementById('store_credits_amount');\r\n\r\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\r\n\r\n\tif (obj.checked && amountCredit > 0)\r\n\t{\r\n\r\n\t\tamountElem.disabled = false;\r\n\r\n\t\tvar balance_elem = document.getElementById('OEH_remaing_balance');\r\n\t\tif (balance_elem)\r\n\t\t{\r\n\t\t\tbalance = Number(balance_elem.innerHTML);\r\n\t\t}\r\n\r\n\t\tif (Number(amountElem.value) > balance && balance > 0)\r\n\t\t{\r\n\r\n\t\t\tamountElem.value = formatAsMoney(balance);\r\n\t\t}\r\n\r\n\t\tupdateChangeList();\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\tamountElem.disabled = true;\r\n\t}\r\n\r\n\tcalculateTotal();\r\n\r\n\treportPaymentStatus(false);\r\n\r\n}\r\n\r\nfunction reportPaymentStatus(ignorePayment2)\r\n{\r\n\tvar balance_elem = document.getElementById('OEH_remaing_balance');\r\n\r\n\tvar balance = 0;\r\n\tif (balance_elem)\r\n\t{\r\n\t\tbalance = Number(balance_elem.innerHTML);\r\n\t}\r\n\r\n\tvar paymentsTotal = Number(0);\r\n\r\n\t// Total up any store credit\r\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\r\n\t{\r\n\t\tpaymentsTotal = (paymentsTotal * 1) + (1 * formatAsMoney(document.getElementById('store_credits_amount').value));\r\n\t}\r\n\r\n\tvar paySelElem = document.getElementById('payment1_type');\r\n\r\n\tif (!paySelElem)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar paySel = paySelElem.value;\r\n\r\n\tvar pay1Amount = Number(0);\r\n\r\n\tswitch (paySel)\r\n\t{\r\n\t\tcase \"REFERENCE\":\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\t\t\t\tpay1Amount += Number(document.getElementById('RT_' + ident).value);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cc_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC_REFUND\":\r\n\t\t\tvar DirCreditCCAmount = Number(0);\r\n\t\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t\t{\r\n\t\t\t\tDirCreditCCAmount += Number(document.getElementById('Dir_Cr_RT_' + ident).value);\r\n\t\t\t}\r\n\t\t\tpay1Amount = DirCreditCCAmount * -1;\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CASH\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cash_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFUND_CASH\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_refund_cash_total_amount').value);\r\n\t\t\tpay1Amount = -pay1Amount;\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_check_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CERT\":\r\n\t\t\tpay1Amount = Number(document.getElementById('payment1_gc_total_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CARD\":\r\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CREDIT\":\r\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\r\n\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tif (ignorePayment2)\r\n\t{\r\n\t\tpay2Amount = Number(0);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tpaySel2 = document.getElementById('payment2_type').value;\r\n\t\tvar pay2Amount = Number(0);\r\n\t\tswitch (paySel2)\r\n\t\t{\r\n\t\t\tcase \"CC\":\r\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cc_total_amount').value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CASH\":\r\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cash_total_amount').value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CHECK\":\r\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_check_total_amount').value);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar storeCreditRefundElem = document.getElementById('storeCreditRefund');\r\n\tif (storeCreditRefundElem)\r\n\t{\r\n\t\treturnToStoreCredit = Number(storeCreditRefundElem.value * -1);\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturnToStoreCredit = Number(0);\r\n\t}\r\n\r\n\tvar cashRefund = document.getElementById('credit_to_customer_refund_cash_amount');\r\n\tif (cashRefund)\r\n\t{\r\n\t\tcashRefund = Number(cashRefund.value * -1);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tcashRefund = Number(0);\r\n\t}\r\n\r\n\t// Credit Card Refunds\r\n\tvar CreditCCAmount = Number(0);\r\n\tfor (ident in existingPaymentAmountArray)\r\n\t{\r\n\t\tCreditCCAmount += Number(document.getElementById('Cr_RT_' + ident).value);\r\n\t}\r\n\r\n\tif (isNaN(CreditCCAmount))\r\n\t{\r\n\t\tCreditCCAmount = Number(0);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tCreditCCAmount = Number(CreditCCAmount * -1);\r\n\t}\r\n\r\n\tvar PenndingDPAdjustment = Number(getPendingDPAdjustment());\r\n\r\n\t// Note: refunds are now expressed as a negative. Payments total can be negative\r\n\tvar paymentsTotal = Number(paymentsTotal + pay1Amount + pay2Amount +\r\n\t\treturnToStoreCredit + CreditCCAmount + PenndingDPAdjustment + cashRefund);\r\n\r\n\t$('#payment_help_msg').removeClass('overpaid');\r\n\t// current costs are greater than current payments - money owed to store\r\n\r\n\tif (orderState != 'CANCELLED')\r\n\t{\r\n\r\n\t\tvar diff = Number((paymentsTotal * -1) + balance);\r\n\r\n\t\tif (diff < 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse if (diff > 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('').hide();\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\r\n\t\tvar diff = Number(paymentsTotal + balance);\r\n\r\n\t\tif (diff > 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse if (diff < 0)\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#payment_help_msg').html('').hide();\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t balance = Math.abs(balance);\r\n\t //\talert(\"balance: \" + balance);\r\n\r\n\t var diff = new Number(paymentsTotal - balance);\r\n\t //\talert(\"diff: \" + diff);\r\n\r\n\t $('#new_payments_total').val(paymentsTotal);\r\n\r\n\t $('#payment_help_msg').removeClass('overpaid').html('<span id=\"bal_due\">0.0</span>').show();\r\n\r\n\r\n\t if (orderState == 'CANCELLED')\r\n\t {\r\n\t if (diff < 0)\r\n\t {\r\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else if (diff > 0)\r\n\t {\r\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else\r\n\t {\r\n\t $('#payment_help_msg').html('').hide();\r\n\t }\r\n\t }\r\n\t else\r\n\t {\r\n\t if (paySel == 'CREDIT')\r\n\t {\r\n\t $('#payment_help_msg').html('<span id=\"bal_due\">No Charge</span>').show();\r\n\t }\r\n\t else if (diff < 0)\r\n\t {\r\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else if (diff > 0)\r\n\t {\r\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\r\n\t }\r\n\t else\r\n\t {\r\n\t $('#payment_help_msg').html('').hide();\r\n\t }\r\n\t }\r\n\t */\r\n\tupdateChangeList();\r\n}\r\n\r\nfunction toggle(obj)\r\n{\r\n\tvar el = document.getElementById(obj);\r\n\tel.style.display = (el.style.display != 'none' ? 'none' : '');\r\n}\r\n\r\nvar target_prefix = \"payment1_\";\r\nvar scanPosition = 0;\r\nvar charIndex = 0;\r\nvar codes = [];\r\n\r\nfunction keyHandler2(evt)\r\n{\r\n\r\n\tevt = (evt) ? evt : event;\r\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\r\n\r\n\tif (charCode == 13)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcodes[charIndex++] = String.fromCharCode(charCode);\r\n\r\n\tif ((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\r\n\t{\r\n\t\tscanPosition = 1; //start of data\r\n\t}\r\n\telse if ((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\r\n\t{\r\n\t\tscanPosition = 2; // start of track 1\r\n\t}\r\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\r\n\t{\r\n\t\tscanPosition = 3;  // end of track 1\r\n\t}\r\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\r\n\t{\r\n\t\tscanPosition = 0;  // end of track 2\r\n\t\tcharIndex = 0;\r\n\t\thandleSwipeCompletion();\r\n\t}\r\n}\r\n\r\nfunction endScanHandling()\r\n{\r\n\tdocument.getElementById('scanArea').style.display = \"none\";\r\n\tcodes.length = 0;\r\n\tscanPosition = 0;\r\n\tcharIndex = 0;\r\n\tdocument.getElementById('hidden_text_store').value = \"\";\r\n\r\n\tdocument.onkeypress = OMDefaultKeyHandler;\r\n\r\n}\r\n\r\nfunction prepareForCCSwipe(paymentNumber)\r\n{\r\n\r\n\tif (paymentNumber == 2)\r\n\t{\r\n\t\ttarget_prefix = 'payment2_';\r\n\t}\r\n\telse\r\n\t{\r\n\t\ttarget_prefix = 'payment1_';\r\n\t}\r\n\r\n\tdocument.onkeypress = keyHandler2;\r\n\tdocument.getElementById('scanArea').style.display = \"block\";\r\n\tdocument.getElementById('hidden_text_store').focus();\r\n\tdocument.getElementById('hidden_text_store').value = \"\";\r\n\r\n}\r\n\r\nfunction handleSwipeCompletion()\r\n{\r\n\tvar receivedText = codes.join(\"\");\r\n\r\n\tvar p = new SwipeParserObj(receivedText);\r\n\tvar parsedVersion = p.dump();\r\n\r\n\tvar re_visa = /^4[0-9]{12}([0-9]{3})?$/;\r\n\tvar re_mc = /^5[1-5][0-9]{14}$/;\r\n\tvar re_amex = /^3[47][0-9]{13}$/;\r\n\tvar re_disc = /^6011[0-9]{12}$/;\r\n\r\n\tvar card_type = false;\r\n\r\n\tif (re_visa.test(p.account))\r\n\t{\r\n\t\tcard_type = 'Visa';\r\n\t}\r\n\telse if (re_mc.test(p.account))\r\n\t{\r\n\t\tcard_type = 'Mastercard';\r\n\t}\r\n\telse if (re_amex.test(p.account))\r\n\t{\r\n\t\tcard_type = 'American Express';\r\n\t}\r\n\telse if (re_disc.test(p.account))\r\n\t{\r\n\t\tcard_type = 'Discover';\r\n\t}\r\n\r\n\tif (card_type)\r\n\t{\r\n\t\tdocument.getElementById(target_prefix + 'ccType').value = card_type;\r\n\t}\r\n\r\n\tdocument.getElementById(target_prefix + 'ccNumber').value = p.account;\r\n\tdocument.getElementById(target_prefix + 'ccNameOnCard').value = p.firstname + ' ' + p.surname;\r\n\tdocument.getElementById(target_prefix + 'ccMonth').value = p.exp_month;\r\n\r\n\tvar exp_year = p.exp_year;\r\n\tif (exp_year.length == 2)\r\n\t{\r\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year;\r\n\t}\r\n\telse if (exp_year.length == 4)\r\n\t{\r\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year.substr(2);\r\n\t}\r\n\r\n\tendScanHandling();\r\n}"],"names":["originalMaxPPDeduction","selectedFreeMenuItem","couponFreeMenuItemRequired","handle_ltd_round_up","$","prop","orderState","is","GUEST_PREFERENCES","user_id","LTD_AUTO_ROUND_UP","value","orderInfo","ltd_round_up_value","attr","val","trigger","on","e","this","cookie","session_id","dd_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","div_id","confirm","remove","set_user_pref","index","buttons","Yes","No","Ask Again Later","calculateTotal","round_up_val","text","formatAsMoney","slideDown","slideUp","handle_fundraiser_selection","isFundraiser","Number","data","parseFloat","manually_adjusted","description","disabled","toFixed","half_grand_total","handleCouponCodeResult","json","validation_errors","printString","anError","html","show","coupon_code_discount_total","code_id","discount_method","entree_title","entree_servings","handleFreeMenuItem","coupon_obj","coupon_code","createBonusCredit","limit_to_recipe_id","let","current_item_qty","order_item_array","menu_item_id","coupon","couponDiscountMethod","couponDiscountVar","discount_var","couponlimitedToFT","limit_to_finishing_touch","couponIsValidWithPlatePoints","valid_with_plate_points_credits","length","maxPPDeduction","processCode","isDreamRewardsOrder","shouldContinue","code","theForm","get","filterBundle","bundleBox","document","getElementById","checked","parameters","i","elements","name","STORE_DETAILS","id","d","Date","ajax","url","type","timeout","dataType","processor","op","org_ts","order_id","unique","getTime","order_state","params","success","processor_success","processor_message","error","objAJAXRequest","strError","response","removeCode","removeBonusCredit","Object","keys","couponFreeMenuItem","handle_free_menu_item_edit","menu_item_count","buildFreeMenuItemList","menu_item","price","expression","rebuildOrderItemsArray","menu_item_in_list","selected_menu_item_in_list","s","appendTo","each","orderItems","eval","item_title","stripLeadingZeroes","leadingZeroCount","retVal","len","slice","handlePlatePointsDiscount","isNaN","needPlatePointsMaxDiscountChangeWarning","Math","abs","maxPPCredit","curPPDiscount","cap","editCashCheckAmount","editCashCheckUpdate","new_total","getGiftCardBalance","card_number","output","card_balance","request_uri","editCashCheckAmountCommit","alert","new_number","PATH","image_admin","fadeOut","showButtonProcessDelayedPaymentNow","PendingDPOriginalStatus","processPayment","order_number","credit_card_number","substr","transaction_id","transaction_date","payment_id","css","color","summary_date","canAdjustDelayedPayment","back_path","setDelayedPaymentStatusTo","PendingDPOriginalTransActionID","toLowerCase","setupCouponState","style","display","processDelayedPaymentStatus","old_status","new_status","store_id","status","text-decoration","canAutoAdjust","src","alt","pointToTransaction","processPointToTransaction","old_ref_number","new_ref_number","new_card_number","transactionid","new_card_type","unsetAutoAdjust","setAllPaymentFieldsToUnrequired","reqField","setAttribute","lastPayment1Type","changePayment1","mySelect","divGC","divCash","divRefundCash","divCheck","divCC","divCredit","divRef","divRefOther","refundDiv","dpAdjust","divDebitGiftCard","payment2","selected_ref","resetPendingDelayedPayment","amount","changePayment2","onPaymentSelected","balance","innerHTML","paymentsTotal","paySel","autoAdjBox","forceManualAutoAdjust","handleAutoAdjust","adjustPendingDelayedPayment","externalPaymentAmountArray","onPaymentDeselected","reportPaymentStatus","textBal","valueOf","divref2","selectedItem","validateRefTrans","field","limit","payAmountChange","idElem","org_dp_amount","adjVal","adjustmentAmount","getPendingDPAdjustment","adj_dp_amount","assignBalanceToRefTransactions","paymentCount","prefix","ident","existingPaymentAmountArray","elname","amountCredit","maxStoreCredit","refTransField","remainingFundsThisPayment","current_refunded_amount","thisAmount","storeCreditAmountChange","storeCreditClick","obj","amountElem","balance_elem","updateChangeList","ignorePayment2","paySelElem","pay1Amount","DirCreditCCAmount","pay2Amount","paySel2","storeCreditRefundElem","returnToStoreCredit","cashRefund","CreditCCAmount","PenndingDPAdjustment","removeClass","diff","addClass","toggle","el","target_prefix","scanPosition","charIndex","codes","keyHandler2","evt","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","onkeypress","OMDefaultKeyHandler","prepareForCCSwipe","paymentNumber","focus","receivedText","join","p","SwipeParserObj","parsedVersion","dump","re_visa","re_mc","re_amex","re_disc","card_type","test","account","firstname","surname","exp_month","exp_year"],"mappings":"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"}
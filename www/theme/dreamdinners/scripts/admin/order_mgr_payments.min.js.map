{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_mgr_payments.js"],"sourcesContent":["var originalMaxPPDeduction = 0;\nvar selectedFreeMenuItem;\nvar couponFreeMenuItemRequired = false;\n\nfunction handle_ltd_round_up()\n{\n\t$('#add_ltd_round_up').prop('disabled', false);\n\n\tif (orderState == 'SAVED' && !$('#add_ltd_round_up').is(':checked') && GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value > 0 && orderInfo.ltd_round_up_value == '')\n\t{\n\t\t$('#add_ltd_round_up').prop('checked', true);\n\n\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == 1)\n\t\t{\n\t\t\t$(\"#ltd_round_up_select option[id='round_up_nearest_dollar']\").attr(\"selected\", \"selected\");\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger('change');\n\t\t}\n\t}\n\telse if ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\t$('#ltd_round_up_select').prop('disabled', false);\n\t}\n\n\t$('#add_ltd_round_up').on('change', function (e) {\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\n\t\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != user_id + '.' + session_id))\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\tmessage: 'Would <span style=\"font-weight: bold; color: red;\">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style=\"font-weight: bold;\">My Preferences</span>.<div style=\"text-align: center; margin-top: 10px;\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option></select></div>',\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\topen: function (event, ui) {\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\n\t\t\t\t\t\tvar rup_dialog = $(this);\n\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e) {\n\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\n\n\t\t\t\t\t\t\tif (rup_value > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\n\t\t\t\t\t\t\t\t\tconfirm: function () {\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\n\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value, user_id);\n\n\t\t\t\t\t\t\t\t\t\tif (orderInfo.ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use the selected Round Up value on this order?',\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"No\": function () {\n\t\t\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0, user_id);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"Ask Again Later\": function () {\n\t\t\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t\t\t$.cookie('ltdru', user_id + '.' + session_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\n\t\t}\n\n\t\t$('#ltd_round_up_select').trigger('change');\n\n\t\tcalculateTotal();\n\t});\n\n\t$('#ltd_round_up_select').on('change', function (e) {\n\n\t\tvar round_up_val = $(this).val();\n\n\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\n\n\t\tif ($('#add_ltd_round_up').is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_div').slideDown();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_div').slideUp();\n\n\t\t\tround_up_val = 0;\n\t\t}\n\n\t\t/*\n\n\t\t $.ajax({\n\t\t url: 'ddproc.php',\n\t\t type: 'POST',\n\t\t timeout: 20000,\n\t\t dataType: 'json',\n\t\t data: {\n\t\t processor: 'cart_add_payment',\n\t\t payment_type: 'ltd_round_up',\n\t\t ltd_round_up_value: round_up_val\n\t\t },\n\t\t success: function (json)\n\t\t {\n\t\t if (json.processor_success)\n\t\t {\n\n\t\t }\n\t\t else\n\t\t {\n\t\t dd_message({\n\t\t title: 'Error',\n\t\t message: json.processor_message\n\t\t });\n\t\t }\n\t\t },\n\t\t error: function (objAJAXRequest, strError)\n\t\t {\n\t\t dd_message({\n\t\t title: 'Error',\n\t\t message: 'Unexpected error: ' + strError\n\t\t });\n\t\t }\n\t\t });\n\n\t\t */\n\n\t\tcalculateTotal();\n\t});\n\n\tcalculateTotal();\n}\n\nfunction handle_fundraiser_selection()\n{\n\tif (isFundraiser)\n\t{\n\t\t$('#fundraiser_id').prop('disabled', true);\n\n\t\t$('#fundraiser_value').on('blur', function () {\n\t\t\tif (Number($(this).val()) < Number($(this).data('donation_value')))\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Alert',\n\t\t\t\t\tmessage: 'Fundraiser value can not be less than $' + $(this).data('donation_value')\n\t\t\t\t});\n\n\t\t\t\t$(this).val($(this).data('org_value'));\n\t\t\t}\n\n\t\t});\n\t}\n\n\tif (parseFloat($('#fundraiser_value').val()) > 0)\n\t{\n\t\tvar manually_adjusted = true;\n\t}\n\telse\n\t{\n\t\tvar manually_adjusted = false;\n\t}\n\n\t$('#fundraiser_id').on('change', function () {\n\t\tvar value = 0;\n\t\tvar description = '';\n\t\tvar disabled = true;\n\n\t\tif ($(this).find(':selected').val() != '')\n\t\t{\n\t\t\tif ($(this).find(':selected').data('active') == 1)\n\t\t\t{\n\t\t\t\tdisabled = false;\n\t\t\t}\n\n\t\t\tvalue = $(this).find(':selected').data('value');\n\t\t\tdescription = $(this).find(':selected').data('description');\n\t\t}\n\n\t\t$('#fundraiser_description_div').text(description);\n\n\t\t$('#fundraiser_value').prop('disabled', disabled);\n\n\t\tif ((!manually_adjusted && !disabled) || value == 0)\n\t\t{\n\t\t\t$('#fundraiser_value').val(parseFloat(value).toFixed(2));\n\t\t}\n\t\telse if (disabled)\n\t\t{\n\t\t\t$('#fundraiser_value').val($('#fundraiser_value').data('org_value'));\n\t\t}\n\n\t\tcalculateTotal();\n\t});\n\n\t$('#fundraiser_value').on('keyup', function () {\n\t\tmanually_adjusted = true;\n\t\tvar half_grand_total = parseFloat(($('#OEH_grandtotal').text() / 2).toFixed(2));\n\t\tvar value = 0;\n\n\t\tif ($('#fundraiser_value').val())\n\t\t{\n\t\t\tvalue = parseFloat($('#fundraiser_value').val());\n\t\t}\n\n\t\tif (value > half_grand_total)\n\t\t{\n\t\t\t$('#fundraiser_value').val(half_grand_total);\n\t\t}\n\n\t\tcalculateTotal();\n\t});\n}\n\nfunction handleCouponCodeResult(json)\n{\n\tif (json.validation_errors)\n\t{\n\t\tprintString = \"\";\n\t\tfor (anError in json.validation_errors)\n\t\t{\n\t\t\tif (json.validation_errors[anError] != \"\" && json.validation_errors[anError] != null)\n\t\t\t{\n\t\t\t\tprintString += json.validation_errors[anError] + \"<br />\";\n\t\t\t}\n\t\t}\n\n\t\t$(\"#coupon_error\").html(printString);\n\t\t$(\"#coupon_error\").show();\n\t\t$('#couponCodeSubmitter').show();\n\t\t$('#proc_mess').hide();\n\t}\n\telse\n\t{\n\t\t$(\"#coupon_error\").hide();\n\t\t$(\"#coupon_error\").html(\"\");\n\n\t\t$('#proc_mess').hide();\n\t\t$('#couponDeleter').show();\n\t\t$('#coupon_code').prop('disabled', true);\n\n\t\t$(\"#couponValue\").val(json.coupon_code_discount_total);\n\t\t$(\"#coupon_id\").val(json.code_id);\n\n\t\t$(\"#coupon_type\").val(json.discount_method);\n\n\t\tif (json.discount_method == \"FREE_MEAL\")\n\t\t{\n\t\t\t$('#coupon_free_meal_row').show();\n\t\t\t$(\"#free_entree\").html(json.entree_title);\n\t\t\t$('#free_entree_servings').val(json.entree_servings);\n\t\t}\n\t\telse if (json.discount_method == \"FREE_MENU_ITEM\")\n\t\t{\n\t\t\thandleFreeMenuItem(json.coupon_obj.coupon_code);\n\t\t}\n\t\telse if (json.discount_method == \"BONUS_CREDIT\")\n\t\t{\n\t\t\tcreateBonusCredit(0);\n\t\t}\n\t\telse if (json.coupon_obj.limit_to_recipe_id == \"1\")\n\t\t{\n\t\t\tlet current_item_qty = json.order_item_array[json.coupon_obj.menu_item_id][0];\n\t\t\t$('#qty_' + json.coupon_obj.menu_item_id).val(current_item_qty).trigger('keyup');\n\t\t}\n\n\t\tcoupon = json.coupon;\n\t\tcouponDiscountMethod = json.discount_method;\n\t\tcouponDiscountVar = json.discount_var;\n\t\tcouponlimitedToFT = json.limit_to_finishing_touch;\n\t\tcouponIsValidWithReferralCredit = json.valid_with_customer_referral_credit;\n\t\tcouponIsValidWithPlatePoints = json.valid_with_plate_points_credits;\n\t\tcouponFreeMenuItemRequired = true;\n\n\t\tif (couponlimitedToFT && $(\"#max_plate_points_deduction\").length)\n\t\t{\n\t\t\tlet maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\n\t\t\toriginalMaxPPDeduction = maxPPDeduction;\n\n\t\t\tmaxPPDeduction -= json.coupon_code_discount_total;\n\t\t\tif (maxPPDeduction < 0)\n\t\t\t{\n\t\t\t\tmaxPPDeduction = 0;\n\t\t\t}\n\n\t\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(maxPPDeduction));\n\t\t}\n\n\t\tcalculateTotal();\n\t}\n\n}\n\nfunction processCode()\n{\n\tif (isDreamRewardsOrder)\n\t{\n\t\tvar shouldContinue = true;\n\t\tshouldContinue = confirm(\"Coupon Codes should not be used with a Dream Rewards Order. Do you want to continue?\");\n\t\tif (!shouldContinue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t}\n\n\tvar code = $(\"#coupon_code\").val();\n\t$(\"#couponCodeSubmitter\").hide();\n\n\tvar theForm = $('#editorForm').get()[0];\n\n\tvar filterBundle = false;\n\tvar bundleBox = document.getElementById('selectedBundle');\n\tif (bundleBox && !bundleBox.checked)\n\t{\n\t\tfilterBundle = true;\n\t}\n\n\tvar parameters = \"\";\n\tfor (i = 0; i < theForm.elements.length; i++)\n\t{\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\n\t\t{\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\n\t\t\tif (i + 1 != theForm.elements.length)\n\t\t\t{\n\t\t\t\tparameters += \"&\";\n\t\t\t}\n\t\t}\n\t}\n\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\n\n\tvar d = new Date();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessor',\n\t\t\tuser_id: user_id,\n\t\t\top: 'add',\n\t\t\torg_ts: 'org_order_time',\n\t\t\torder_id: order_id,\n\t\t\tunique: d.getTime(),\n\t\t\tcoupon_code: code,\n\t\t\torder_state: orderState,\n\t\t\tparams: parameters\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\thandleCouponCodeResult(json);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction removeCode()\n{\n\tvar theForm = $('#editorForm').get()[0];\n\n\tvar filterBundle = false;\n\tvar bundleBox = document.getElementById('selectedBundle');\n\tif (bundleBox && !bundleBox.checked)\n\t{\n\t\tfilterBundle = true;\n\t}\n\n\tvar parameters = \"\";\n\tfor (i = 0; i < theForm.elements.length; i++)\n\t{\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\n\t\t{\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\n\t\t\tif (i + 1 != theForm.elements[i])\n\t\t\t{\n\t\t\t\tparameters += \"&\";\n\t\t\t}\n\t\t}\n\t}\n\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\n\n\tvar d = new Date();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessor',\n\t\t\top: 'remove',\n\t\t\tuser_id: user_id,\n\t\t\torg_ts: 'org_order_time',\n\t\t\torder_id: order_id,\n\t\t\tunique: d.getTime(),\n\t\t\torder_state: orderState,\n\t\t\tparams: parameters\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif ($(\"#coupon_type\").val() == \"BONUS_CREDIT\")\n\t\t\t{\n\t\t\t\tremoveBonusCredit();\n\t\t\t}\n\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\t\t\t$('#couponDeleter').hide();\n\t\t\t$('#coupon_code').prop('disabled', false);\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#couponValue\").val(0);\n\t\t\t$('#coupon_free_meal_row').hide();\n\t\t\t$(\"#free_entree\").html(\"\");\n\t\t\t$(\"#coupon_id\").val(\"\");\n\t\t\t$(\"#coupon_type\").val(\"\");\n\n\t\t\t$('#coupon_select_free_menu_item_row').hide();\n\t\t\t$('#free_menu_item_coupon option:not([value])').attr('data-dd_required', false);\n\n\t\t\tif (coupon && coupon.limit_to_recipe_id == \"1\")\n\t\t\t{\n\t\t\t\tlet current_item_qty = 0;\n\n\t\t\t\tif (Object.keys(json.order_item_array).length && json.order_item_array[coupon.menu_item_id])\n\t\t\t\t{\n\t\t\t\t\tcurrent_item_qty = json.order_item_array[coupon.menu_item_id][0];\n\t\t\t\t}\n\n\t\t\t\t$('#qty_' + coupon.menu_item_id).val(current_item_qty);\n\t\t\t}\n\n\t\t\tcoupon = false;\n\t\t\tcouponFreeMenuItem = false;\n\t\t\tcouponFreeMenuItemRequired = false;\n\n\t\t\tcouponDiscountMethod = 'NONE';\n\t\t\tcouponDiscountVar = 0;\n\t\t\tcouponlimitedToFT = false;\n\t\t\tcouponIsValidWithPlatePoints = true;\n\n\t\t\tcalculateTotal();\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n\n}\n\nfunction handle_free_menu_item_edit()\n{\n\tif (couponFreeMenuItem)\n\t{\n\t\thandleFreeMenuItem($('#coupon_code').val());\n\t}\n}\n\nfunction handleFreeMenuItem(coupon_code)\n{\n\tvar menu_item_count = 0;\n\n\tif (coupon_code == 'SRDessert')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9\");\n\t}\n\telse if (coupon_code == 'SRDinner')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'\");\n\t}\n\telse if (coupon_code == 'CC3RDFREE')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00\");\n\t}\n\telse if (coupon_code == 'SCFinishingTouch')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9 && menu_item.price <= 15.00\");\n\t}\n\telse if (coupon_code == 'HCFastLane')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'\");\n\t}\n\telse if (coupon_code == 'SCFriendDinner')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' && menu_item.intro_item == true\");\n\t}\n\n\tif (menu_item_count > 0)\n\t{\n\t\t$('#coupon_select_free_menu_item_row').show();\n\n\t\t$('#free_menu_item_coupon').attr('data-dd_required', true).on('change', function (e) {\n\t\t\tvar menu_item = $(this).find(':selected').data('menu_item');\n\t\t\tvar price = $(this).find(':selected').data('price');\n\n\t\t\t$('#couponValue').val(price);\n\t\t\tselectedFreeMenuItem = menu_item;\n\n\t\t\tcalculateTotal();\n\t\t});\n\t}\n\telse\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'No valid free items found in cart for this coupon, please add the desired item and then submit the coupon.'\n\t\t});\n\n\t\tremoveCode();\n\t}\n}\n\nfunction buildFreeMenuItemList(expression)\n{\n\trebuildOrderItemsArray();\n\n\tvar menu_item_in_list = false;\n\tvar selected_menu_item_in_list = false; // temp store, used for tab switching\n\tvar menu_item_count = 0;\n\n\t// setup efl free item select\n\tvar s = $('#free_menu_item_coupon').html('').attr('disabled', ((couponFreeMenuItem) ? true : false));\n\n\t$(\"<option />\").val('').text('Select Free Item').appendTo(s);\n\n\t$.each(orderItems, function (index, menu_item) {\n\t\tif (!menu_item_in_list)\n\t\t{\n\t\t\tmenu_item_in_list = ((couponFreeMenuItem == menu_item.id) ? true : false);\n\t\t}\n\n\t\tif (!selected_menu_item_in_list)\n\t\t{\n\t\t\tselected_menu_item_in_list = ((selectedFreeMenuItem == menu_item.id) ? true : false);\n\t\t}\n\n\t\tif (eval(expression))\n\t\t{\n\t\t\tmenu_item_count++;\n\n\t\t\t$(\"<option />\")\n\t\t\t\t.val(menu_item.id)\n\t\t\t\t.attr('data-menu_item', menu_item.id)\n\t\t\t\t.attr('data-price', menu_item.price)\n\t\t\t\t.attr('selected', ((couponFreeMenuItem == menu_item.id || selectedFreeMenuItem == menu_item.id) ? true : false))\n\t\t\t\t.text(menu_item.item_title + ' (' + menu_item.price + ')').appendTo(s);\n\t\t}\n\t});\n\n\tif (!menu_item_in_list)\n\t{\n\t\t$('#couponValue').val('0.00');\n\n\t\t$('#free_menu_item_coupon').attr('disabled', false);\n\t}\n\n\tcalculateTotal();\n\n\treturn menu_item_count;\n}\n\nfunction stripLeadingZeroes(val)\n{\n\tvar leadingZeroCount = 0;\n\tvar retVal = val;\n\n\tfor (var i = 0, len = val.length; i < len; i++)\n\t{\n\t\tif (val[i] != '0')\n\t\t{\n\t\t\tbreak;\n\t\t}\n\n\t\tleadingZeroCount++;\n\t}\n\n\tif (leadingZeroCount > 0)\n\t{\n\t\tretVal = val.slice(leadingZeroCount)\n\t}\n\n\treturn retVal;\n\n}\n\nfunction handleReferralRewardDiscount(val)\n{\n\t//todo: evanl - is this relevant to RR?\n\tif (!couponIsValidWithPlatePoints)\n\t{\n\t\t$('#referral_reward_discount').val( formatAsMoney(0) );\n\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'Customer Referral Reward cannot be used with the attached coupon.'\n\t\t});\n\n\t}\n\n\tif ((isNaN(val) || val <= 0) && val != \".\")\n\t{\n\t\t$('#referral_reward_discount').val(formatAsMoney(0));\n\t\tcalculateTotal();\n\t\treturn;\n\t}\n\n\tneedPlatePointsMaxDiscountChangeWarning = false;\n\n\tval = formatAsMoney(Math.abs(val)) * 1;\n\n\tlet maxReferralRewardCredit = $(\"#referral_reward_available\").html() * 1;\n\tlet maxReferralRewardDeduction = $(\"#max_referral_reward_deduction\").html() * 1;\n\tlet curReferralRewardDiscount = $(\"#referral_reward_discount\").val() * 1;\n\n\tif (maxReferralRewardDeduction < curReferralRewardDiscount)\n\t{\n\t\t$(\"#referral_reward_discount\").val(maxReferralRewardDeduction);\n\t}\n\n\tif (maxReferralRewardCredit > maxReferralRewardDeduction)\n\t{\n\t\t$('#tbody_max_referral_reward').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_referral_reward').hide();\n\t}\n\n\tvar cap = maxReferralRewardCredit;\n\tif (cap > maxReferralRewardDeduction)\n\t{\n\t\tcap = maxReferralRewardDeduction;\n\t}\n\n\tif (val > cap)\n\t{\n\t\tval = cap;\n\t\t$('#referral_reward_discount').val(val);\n\n\t}\n\n\tcalculateTotal();\n}\n\nfunction handlePlatePointsDiscount(val)\n{\n\tif (!couponIsValidWithPlatePoints)\n\t{\n\t\tdocument.getElementById('plate_points_discount').value = formatAsMoney(0);\n\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'PLATEPOINTS cannot be used with the attached coupon.'\n\t\t});\n\n\t}\n\n\tif ((isNaN(val) || val <= 0) && val != \".\")\n\t{\n\t\t$('#plate_points_discount').val(\"0\");\n\t\tcalculateTotal();\n\t\treturn;\n\t}\n\n\tneedPlatePointsMaxDiscountChangeWarning = false;\n\n\tval = formatAsMoney(Math.abs(val)) * 1;\n\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\n\n\tif (maxPPDeduction < curPPDiscount)\n\t{\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\n\t}\n\n\tif (maxPPCredit > maxPPDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tvar cap = maxPPCredit;\n\tif (cap > maxPPDeduction)\n\t{\n\t\tcap = maxPPDeduction;\n\t}\n\n\tif (val > cap)\n\t{\n\t\tval = cap;\n\t\t$('#plate_points_discount').val(val);\n\n\t}\n\n\tcalculateTotal();\n}\n\nfunction editCashCheckAmount(id, type)\n{\n\t// Show input form\n\t$('#check_total_input_' + id).show();\n\t$('#check_payment_number_input_' + id).show();\n\t// Hide edit link and text\n\t$('#check_total_' + id).hide();\n\t$('#check_payment_number_' + id).hide();\n\t$('#check_editlink_' + id).hide();\n}\n\nfunction editCashCheckUpdate(id, type)\n{\n\t$('#payment_sum_value_' + id).html($('#check_total_input_form_' + id).val());\n\t$('#payment_sum_name_' + id).html('Check (#' + $('#check_payment_number_input_form_' + id).val() + ')');\n\n\t// Loop through payment summary to get new total\n\tnew_total = 0;\n\t$('[id^=\"payment_sum_value_\"]').each(function (index) {\n\t\tnew_total = new_total + Number($(this).text());\n\t});\n\n\t// loop through and subtract refunds\n\t$('[id^=\"refund_payment_sum_value_\"]').each(function (index) {\n\t\tnew_total = new_total - Number($(this).text());\n\t});\n\n\t$('#OEH_paymentsTotal').html(formatAsMoney(new_total));\n\n\tcalculateTotal();\n}\n\n// Check cift card balance\nfunction getGiftCardBalance()\n{\n\t$('#gc_proc_anim').show();\n\t$('#balance_target').hide();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'giftCardBalance',\n\t\t\tcard_number: $('#debit_gift_card_number').val(),\n\t\t\toutput: 'json'\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html(json.card_balance);\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + request_uri + '\">[login]</a> again.</span>');\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$('#balance_target').show();\n\t\t\t$('#balance_target').html('Error: ' + strError + '. Please <a href=\"javascript:getGiftCardBalance();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\nfunction editCashCheckAmountCommit(id, type)\n{\n\talert(\"You are only modifying the \" + type + \" details.\\nNo other modifications will be made.\");\n\n\t$('#check_total_mess_' + id).hide();\n\tnew_total = $('#check_total_input_form_' + id).val();\n\tnew_number = $('#check_payment_number_input_form_' + id).val();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_editCashCheckAmount',\n\t\t\tid: id,\n\t\t\ttype: type,\n\t\t\tnew_total: new_total,\n\t\t\tnew_number: new_number,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t// Hide input form\n\t\t\t\t$('#check_total_input_' + id).hide();\n\t\t\t\t$('#check_payment_number_input_' + id).hide();\n\t\t\t\t// Show edit link and text\n\t\t\t\t$('#check_total_' + id).show();\n\t\t\t\t$('#check_payment_number_' + id).show();\n\t\t\t\t$('#check_editlink_' + id).show();\n\n\t\t\t\t// Update page text with new values\n\t\t\t\t$('#check_total_' + id).html(new_total);\n\t\t\t\t$('#check_payment_number_' + id).html(new_number);\n\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).show().html('<img src=\"' + PATH.image_admin + '/icon/accept.png\" alt=\"Accept\" />').fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + +'\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">' + json.processor_message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t$('#check_total_mess_' + id).html('Error: ' + strError + '. Please <a href=\"javascript:editCashCheckAmountCommit(' + id + ',\\'' + type + '\\');\">[try again]</a>.');\n\t\t}\n\t});\n\n}\n\n// Proccess delayed payment now\nfunction showButtonProcessDelayedPaymentNow(message)\n{\n\tif (PendingDPOriginalStatus == 'PENDING')\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"process_payment\" value=\"Process delayed payment now\" onclick=\"processPayment();\">');\n\t}\n\telse if (message)\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html(message);\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').hide();\n\t}\n}\n\nfunction processPayment()\n{\n\tif (confirm(\"Are you sure you wish to process the delayed payment now? Click OK to process.\"))\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 60000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_delayedPaymentProcessor',\n\t\t\t\torder_number: order_id\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.success)\n\t\t\t\t{\n\t\t\t\t\tif ($('#point_to_transaction').length)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar credit_card_number = $('#point_to_transaction option:selected').text();\n\t\t\t\t\t\t$('#cc_payment_number_other').html('XXXXXXXXXXXX' + credit_card_number.substr(-4));\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#cc_delayed_tran_num_other').html(json.transaction_id);\n\t\t\t\t\t$('#cc_delayed_date_other').html(json.transaction_date);\n\t\t\t\t\t$('#cc_delayed_status_other').html('Status: Payment Processed');\n\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'color': ''});\n\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).html(json.summary_date);\n\n\t\t\t\t\tcanAdjustDelayedPayment = false;\n\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:green;font-weight:bold;\">Payment Processed.</span>').fadeOut(4000);\n\t\t\t\t}\n\t\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t\t{\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$('#payment_proc_mess').show();\n\t\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPayment();\">[try again]</a>.');\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Change delayed payment status\nfunction setDelayedPaymentStatusTo()\n{\n\t//Do not allow the user to reset to FAIL\n\tif ($('#change_delayed_payment_status').val() == 'FAIL' && PendingDPOriginalStatus != 'FAIL')\n\t{\n\t\talert('Can not change transaction back to Fail. Please choose pending or canceled.');\n\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\t\treturn false;\n\t}\n\t// Reset transaction id dropdown, can only set the status of one dropdown a time.\n\tif ($('#change_delayed_payment_status'))\n\t{\n\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\t}\n\n\tif ($('#change_delayed_payment_status').val() == PendingDPOriginalStatus)\n\t{\n\t\tshowButtonProcessDelayedPaymentNow();\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"set_delayed_payment_status\" value=\"Set delayed payment status to ' + $('#change_delayed_payment_status').val().toLowerCase() + '\" onClick=\"processDelayedPaymentStatus();\">');\n\t}\n}\n\nfunction setupCouponState()\n{\n\t// if a coupon is attached we need to update the UI\n\t// 1) set up the coupon code box - disabled with code\n\tif (coupon)\n\t{\n\t\tdocument.getElementById('couponCodeSubmitter').style.display = \"none\";\n\t\tdocument.getElementById('couponDeleter').style.display = \"inline\";\n\t\tdocument.getElementById('coupon_code').value = coupon.coupon_code;\n\t\tdocument.getElementById('coupon_code').disabled = true;\n\t}\n}\n\nfunction processDelayedPaymentStatus()\n{\n\t$('#payment_proc_mess').show();\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_delayedPaymentStatusProcessor',\n\t\t\torder_number: order_id,\n\t\t\told_status: PendingDPOriginalStatus,\n\t\t\tnew_status: $('#change_delayed_payment_status').val(),\n\t\t\tstore_id: store_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.success)\n\t\t\t{\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\n\t\t\t\tPendingDPOriginalStatus = json.status;\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\t\t\t\t// Reset transaction id dropdown, only set one at a time.\n\t\t\t\tif ($('#change_delayed_payment_status'))\n\t\t\t\t{\n\t\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\t\t\t\t}\n\n\t\t\t\t// Voodoo, editing cash/check totals element id payment_sum_value_*, so change\n\t\t\t\t// element id to cancelled_payment_sum_value_* which will be skipped over in the total caclulation.\n\t\t\t\tif (json.status == 'CANCELLED' && $('#payment_sum_value_' + json.payment_id))\n\t\t\t\t{\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).attr('id', 'cancelled_payment_sum_value_' + json.payment_id);\n\t\t\t\t}\n\t\t\t\telse if (json.status == 'PENDING' && $('#cancelled_payment_sum_value_' + json.payment_id))\n\t\t\t\t{\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).attr('id', 'payment_sum_value_' + json.payment_id);\n\t\t\t\t}\n\n\t\t\t\t// Update payment status and details\n\t\t\t\tif (json.status == 'CANCELLED')\n\t\t\t\t{\n\t\t\t\t\t// Can only adjust pending payments\n\t\t\t\t\tcanAdjustDelayedPayment = false;\n\n\t\t\t\t\t// Update summary rows\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) - Number($('#cancelled_payment_sum_value_' + json.payment_id).html())));\n\n\t\t\t\t\t// Reset new payment if they have auto adjust selected\n\t\t\t\t\t$('#dp_adjust_div').hide();\n\t\t\t\t\t//\t$('#autoAdjust').attr({ 'checked' : 'checked' });\n\t\t\t\t\t//\thandleAutoAdjust($('#autoAdjust'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t// Payment pending, we are allowed to edit it\n\t\t\t\t\tcanAdjustDelayedPayment = true;\n\n\t\t\t\t\t// Update summary rows\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) + Number($('#payment_sum_value_' + json.payment_id).html())));\n\n\t\t\t\t\t// Allow auto adjust to be used\n\t\t\t\t\tcanAutoAdjust = true;\n\t\t\t\t}\n\n\t\t\t\tcalculateTotal();\n\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Delayed Payment set to ' + PendingDPOriginalStatus + '.</span>');\n\t\t\t\t$('#change_delayed_payment_status_img').attr({\n\t\t\t\t\tsrc: PATH.image_admin + '/icon/accept.png',\n\t\t\t\t\talt: 'Accept'\n\t\t\t\t});\n\t\t\t\t$('#change_delayed_payment_status_img').css({display: 'inline'}).fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$('#payment_proc_mess').show();\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processDelayedPaymentStatus();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\n// Point to new transaction ID\nfunction pointToTransaction()\n{\n\t// Reset payment status dropdown, only set one at a time.\n\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\tif ($('#point_to_transaction').val() == PendingDPOriginalTransActionID)\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\tshowButtonProcessDelayedPaymentNow();\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"point_to_payment\" value=\"Point payment to selected Credit Card Number\" onClick=\"processPointToTransaction();\">');\n\t}\n}\n\nfunction processPointToTransaction()\n{\n\t$('#payment_proc_mess').show();\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_processPointToTransaction',\n\t\t\torder_number: order_id,\n\t\t\tstore_id: store_id,\n\t\t\told_ref_number: PendingDPOriginalTransActionID,\n\t\t\tnew_ref_number: $('#point_to_transaction').val(),\n\t\t\tnew_card_number: $('#point_to_transaction option:selected').text()\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.success)\n\t\t\t{\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\n\t\t\t\tPendingDPOriginalTransActionID = json.transactionid;\n\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\n\t\t\t\t// Reset payment status dropdown, only set one at a time.\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\t\t\t\t$('#payment_sum_type_' + json.payment_id).html(json.new_card_type);\n\t\t\t\t$('#payment_sum_name_' + json.payment_id).html('Delayed CC Payment (#' + json.new_card_number + ')');\n\n\t\t\t\t$('#cc_credit_card_type_other').html(json.new_card_type);\n\t\t\t\t$('#cc_payment_transaction_number_other').html(json.transactionid);\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Credit card set to ' + json.new_card_type + '.</span>');\n\t\t\t\t$('#point_to_transaction_img').css({display: 'inline'}).fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$('#payment_proc_mess').show();\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPointToTransaction();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\nfunction unsetAutoAdjust()\n{\n\tif ($('#autoAdjust').length)\n\t{\n\t\tdocument.getElementById('autoAdjust').checked = false;\n\t}\n}\n\nfunction setAllPaymentFieldsToUnrequired()\n{\n\tvar reqField;\n\n\treqField = document.getElementById('payment1_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment1_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_reference_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment2_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment2_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('debit_gift_card_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n}\n\nvar lastPayment1Type = false;\n\nfunction changePayment1(mySelect)\n{\n\n\tif (lastPayment1Type && lastPayment1Type != mySelect)\n\t{\n\t\tif (lastPayment1Type == 'CC')\n\t\t{\n\t\t\t$('#payment1_gc_total_amount').val(\"\");\n\t\t}\n\t\telse if (lastPayment1Type == 'REFERENCE')\n\t\t{\n\t\t\t$('#payment1_reference_total_amount').val(\"\");\n\t\t}\n\n\t}\n\n\tlastPayment1Type = mySelect;\n\n\tvar divGC = document.getElementById('payment1_gc');\n\tvar divCash = document.getElementById('payment1_cash');\n\tvar divRefundCash = document.getElementById('payment1_refund_cash');\n\tvar divCheck = document.getElementById('payment1_check');\n\tvar divCC = document.getElementById('payment1_cc');\n\tvar divCredit = document.getElementById('payment1_credit');\n\tvar divRef = document.getElementById('payment1_reference');\n\tvar divRefOther = document.getElementById('payment1_ref');\n\tvar refundDiv = document.getElementById('payment1RefundCCDiv');\n\n\tvar dpAdjust = document.getElementById('dp_adjust_div'); // can be null\n\n\tdocument.getElementById('new_payments_total').value = 0;\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t{\n\t\tdocument.getElementById('new_payments_total').value = formatAsMoney(document.getElementById('store_credits_amount').value);\n\t}\n\n\tvar divDebitGiftCard = document.getElementById('payment1_debit_gift_card');\n\n\tvar payment2 = document.getElementById('payment2');\n\n\tvar selected_ref = false;\n\tif (mySelect.substr(0, 4) == 'REF_')\n\t{\n\t\tselected_ref = mySelect.substr(4);\n\t\tmySelect = 'REFERENCE_OTHER';\n\t}\n\n\tresetPendingDelayedPayment();\n\n\t// reset so validation does not fail when using payment types other than CC\n\tvar amount = document.getElementById('payment1_cc_total_amount');\n\tamount.value = '';\n\n\tvar reqField;\n\treqField = document.getElementById('payment1_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_reference_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\tswitch (mySelect)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivRef.style.display = 'block';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\n\t\t\tif (dpAdjust && canAdjustDelayedPayment)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t\tunsetAutoAdjust();\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_reference_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'block';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\n\t\t\tif (orderState != 'ACTIVE')\n\t\t\t{\n\t\t\t\tpayment2.style.display = 'block';\n\t\t\t}\n\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_gc_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_gc_payment_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tunsetAutoAdjust();\n\t\t\tdivGC.style.display = 'none';\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivCash.style.display = 'block';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tif (orderState == 'ACTIVE')\n\t\t\t{\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\n\t\t\t\tamount.value = formatAsMoney(0);\n\t\t\t}\n\n\t\t\treqField = document.getElementById('payment1_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_cash_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'block';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'block';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tamount = document.getElementById('payment1_check_total_amount');\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\n\t\t\treqField = document.getElementById('payment1_check_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_check_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\trefundDiv.style.display = 'none';\n\n\t\t\tpaymentsTotal = Number(document.getElementById('OEH_paymentsTotal').innerHTML);\n\n\t\t\tif (paymentsTotal != 0)\n\t\t\t{\n\t\t\t\talert(\"'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away.\");\n\t\t\t\tpaySel = document.getElementById('payment1_type');\n\t\t\t\tpaySel.value = '';\n\t\t\t\tchangePayment1('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tunsetAutoAdjust();\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'block';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'block';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tamount = document.getElementById('payment1_cc_total_amount');\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\n\t\t\treqField = document.getElementById('payment1_ccNameOnCard');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccNumber');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_cc_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccType');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccMonth');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccYear');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'block';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('debit_gift_card_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('debit_gift_card_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tif (orderState != 'ACTIVE')\n\t\t\t{\n\t\t\t\tpayment2.style.display = 'block';\n\t\t\t}\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"DPADJUST\":\n\t\t\tif (!dpAdjust)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t} // should never happen\n\n\t\t\tif (!canAdjustDelayedPayment)\n\t\t\t{\n\t\t\t\talert('Can not adjust delayed payment.\\n\\nDelayed payment status: ' + PendingDPOriginalStatus);\n\t\t\t\tautoAdjBox = document.getElementById('autoAdjust');\n\t\t\t\tif (!forceManualAutoAdjust)\n\t\t\t\t{\n\t\t\t\t\tautoAdjBox.checked = true;\n\t\t\t\t\thandleAutoAdjust(autoAdjBox);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdpAdjust.style.display = 'block';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\tbalance = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\tadjustPendingDelayedPayment(balance);\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'block';\n\n\t\t\tdocument.getElementById('p1_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\n\t\t\tdocument.getElementById('p1_ref_id').innerHTML = selected_ref;\n\n\t\t\treqField = document.getElementById('payment1_ref_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\t\treqField.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\t}\n\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\t\tcase 'CC_REFUND':\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'block';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\n\t\t\tresetPendingDelayedPayment();\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\n\t\t\tonPaymentDeselected();\n\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction changePayment2(mySelect)\n{\n\n\treportPaymentStatus(true);\n\n\tvar textBal = $(\"#bal_due\").html();\n\tvar balance = Number($(\"#bal_due\").html());\n\tif (isNaN(balance.valueOf()))\n\t{\n\t\tbalance = \"\";\n\t}\n\tif (balance.valueOf() == 0)\n\t{\n\t\tbalance = \"\";\n\t}\n\n\tvar divCash = document.getElementById('payment2_cash');\n\tvar divRefundCash = document.getElementById('payment2_refund)_cash');\n\tvar divCheck = document.getElementById('payment2_check');\n\tvar divCC = document.getElementById('payment2_cc');\n\tvar divref2 = document.getElementById('payment2_ref');\n\n\tvar reqField;\n\n\treqField = document.getElementById('payment2_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\tvar selected_ref = false;\n\tif (mySelect.substr(0, 4) == 'REF_')\n\t{\n\t\tselected_ref = mySelect.substr(4);\n\t\tmySelect = 'REFERENCE_OTHER';\n\t}\n\n\tswitch (mySelect)\n\t{\n\t\tcase \"CASH\":\n\t\t\tdivCash.style.display = 'block';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_cash_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'block';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_check_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_check_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'block';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_ccNameOnCard');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccNumber');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccType');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccMonth');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccYear');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_cc_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'block';\n\n\t\t\tdocument.getElementById('p2_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\n\t\t\tdocument.getElementById('p2_ref_id').innerHTML = selected_ref;\n\n\t\t\treqField = document.getElementById('payment2_ref_total_amount');\n\n\t\t\t$(\"#payment2_ref_total_amount\").val(balance);\n\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\treqField = document.getElementById('payment2_type');\n\t\t\treqField.selectedItem = 0;\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction validateRefTrans(field, limit)\n{\n\tif (field.value > limit)\n\t{\n\t\talert('Limited to ' + limit + '.');\n\t\tfield.value = limit;\n\t}\n\n\tif (field.value < 0)\n\t{\n\t\talert('Must be a positive number.');\n\t\tfield.value = 0;\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction payAmountChange(value)\n{\n\treportPaymentStatus(false);\n}\n\nfunction resetPendingDelayedPayment(balance)\n{\n\tvar idElem = document.getElementById('PendingDP');\n\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(org_dp_amount);\n\n\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(org_dp_amount);\n\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(0);\n\n\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(org_dp_amount);\n\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(0);\n\n\t}\n\n}\n\nfunction adjustPendingDelayedPayment(balance)\n{\n\tvar idElem = document.getElementById('PendingDP');\n\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\n\t\tvar adjVal = org_dp_amount + (balance * 1);\n\t\tif (adjVal < 0)\n\t\t{\n\t\t\tbalance = adjVal * -1;\n\t\t\tadjVal = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbalance = 0;\n\t\t}\n\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(adjVal);\n\t\tvar adjustmentAmount = getPendingDPAdjustment();\n\n\t\tif (adjustmentAmount > 0)\n\t\t{\n\t\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(adjVal);\n\t\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(adjustmentAmount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(adjVal);\n\t\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(adjustmentAmount * -1);\n\t\t}\n\n\t\treturn balance;\n\t}\n\telse\n\t{\n\t\treturn balance;\n\t}\n\n}\n\nfunction getPendingDPAdjustment()\n{\n\tvar idElem = document.getElementById('PendingDP');\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\t\tvar adj_dp_amount = Number(document.getElementById('PendingDPAmount').value);\n\t\treturn formatAsMoney(adj_dp_amount - org_dp_amount);\n\t}\n\telse\n\t{\n\t\treturn 0;\n\t}\n\n\treturn 0;\n\n}\n\nfunction assignBalanceToRefTransactions(balance)\n{\n\tvar paymentCount = 0;\n\n\tvar prefix = 'RT_';\n\tif (balance < 0)\n\t{\n\t\tprefix = 'Cr_RT_';\n\t}\n\n\t// clear any previous values\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\t\tvar elname = 'RT_' + ident;\n\t\tpaymentCount++;\n\t\tdocument.getElementById('RT_' + ident).value = \"\";\n\t}\n\n\t// clear any previous values\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\n\t\t// alert('nuulify');\n\t\tvar elname = 'Cr_RT_' + ident;\n\t\t//\talert(elname);\n\t\tdocument.getElementById('Cr_RT_' + ident).value = \"\";\n\t}\n\n\tif (balance == 0)\n\t{\n\t\treportPaymentStatus(false);\n\t\treturn;\n\t}\n\n\tif (balance > 0)\n\t{\n\t\t//alert(\"doing it\");\n\t\t// first, use store credit\n\t\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t\t{\n\t\t\tvar amountCredit = 0;\n\t\t\tvar maxStoreCredit = Number($('#eoTotalStoreCredit').html());\n\t\t\t//alert(\"max: \" + maxStoreCredit);\n\n\t\t\tif (balance > maxStoreCredit)\n\t\t\t{\n\t\t\t\tamountCredit = maxStoreCredit;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tamountCredit = balance;\n\t\t\t}\n\n\t\t\t// alert(\"amountCredit: \" + amountCredit);\n\n\t\t\tdocument.getElementById('store_credits_amount').value = formatAsMoney(amountCredit);\n\t\t\tbalance -= amountCredit;\n\n\t\t\t// alert(\"balance: \" + balance);\n\t\t}\n\n\t\t// second, look for a payment that could handle the full credit/debit\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tif (balance <= existingPaymentAmountArray[ident].amount)\n\t\t\t{\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\n\t\t\t\trefTransField.value = formatAsMoney(balance);\n\t\t\t\treportPaymentStatus(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// otherwise just assign to the first one\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(balance);\n\t\t\tbreak;\n\t\t}\n\t}\n\telse\n\t{\n\t\t// balance < 0\n\t\t// first, look for a payment that could handle the full credit/debit\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t{\n\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t}\n\n\t\t\tif (balance >= (remainingFundsThisPayment * -1))\n\t\t\t{\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\n\t\t\t\trefTransField.value = formatAsMoney(Math.abs(balance));\n\t\t\t\treportPaymentStatus(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t//if not found then we must spread the balance across multiple payments\n\t\tif (paymentCount > 1)\n\t\t{\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t\t{\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t\t}\n\n\t\t\t\tvar thisAmount = (remainingFundsThisPayment * -1);\n\n\t\t\t\tif (thisAmount < balance)\n\t\t\t\t{\n\t\t\t\t\tthisAmount = balance;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(Math.abs(thisAmount));\n\t\t\t\tbalance -= thisAmount;\n\n\t\t\t\tif (balance >= 0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (paymentCount == 1)\n\t\t{\n\t\t\t// just assign the max amount, the remainder will need to be paid through another method\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t\t{\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(remainingFundsThisPayment);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction storeCreditAmountChange(val)\n{\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\n\n\tif (amountCredit.valueOf() < val)\n\t{\n\t\t$('#store_credits_amount').val(amountCredit.valueOf());\n\n\t}\n\n\tpayAmountChange();\n}\n\nfunction storeCreditClick(obj)\n{\n\tvar amountElem = document.getElementById('store_credits_amount');\n\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\n\n\tif (obj.checked && amountCredit > 0)\n\t{\n\n\t\tamountElem.disabled = false;\n\n\t\tvar balance_elem = document.getElementById('OEH_remaing_balance');\n\t\tif (balance_elem)\n\t\t{\n\t\t\tbalance = Number(balance_elem.innerHTML);\n\t\t}\n\n\t\tif (Number(amountElem.value) > balance && balance > 0)\n\t\t{\n\n\t\t\tamountElem.value = formatAsMoney(balance);\n\t\t}\n\n\t\tupdateChangeList();\n\n\t}\n\telse\n\t{\n\t\tamountElem.disabled = true;\n\t}\n\n\tcalculateTotal();\n\n\treportPaymentStatus(false);\n\n}\n\nfunction reportPaymentStatus(ignorePayment2)\n{\n\tvar balance_elem = document.getElementById('OEH_remaing_balance');\n\n\tvar balance = 0;\n\tif (balance_elem)\n\t{\n\t\tbalance = Number(balance_elem.innerHTML);\n\t}\n\n\tvar paymentsTotal = Number(0);\n\n\t// Total up any store credit\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t{\n\t\tpaymentsTotal = (paymentsTotal * 1) + (1 * formatAsMoney(document.getElementById('store_credits_amount').value));\n\t}\n\n\tvar paySelElem = document.getElementById('payment1_type');\n\n\tif (!paySelElem)\n\t{\n\t\treturn;\n\t}\n\n\tvar paySel = paySelElem.value;\n\n\tvar pay1Amount = Number(0);\n\n\tswitch (paySel)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\t\t\t\tpay1Amount += Number(document.getElementById('RT_' + ident).value);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cc_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"CC_REFUND\":\n\t\t\tvar DirCreditCCAmount = Number(0);\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\t\t\t\tDirCreditCCAmount += Number(document.getElementById('Dir_Cr_RT_' + ident).value);\n\t\t\t}\n\t\t\tpay1Amount = DirCreditCCAmount * -1;\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cash_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_refund_cash_total_amount').value);\n\t\t\tpay1Amount = -pay1Amount;\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_check_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_gc_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\n\n\t\t\tbreak;\n\t}\n\n\tif (ignorePayment2)\n\t{\n\t\tpay2Amount = Number(0);\n\t}\n\telse\n\t{\n\t\tpaySel2 = document.getElementById('payment2_type').value;\n\t\tvar pay2Amount = Number(0);\n\t\tswitch (paySel2)\n\t\t{\n\t\t\tcase \"CC\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cc_total_amount').value);\n\t\t\t\tbreak;\n\n\t\t\tcase \"CASH\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cash_total_amount').value);\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_check_total_amount').value);\n\t\t\t\tbreak;\n\t\t}\n\n\t}\n\n\tvar storeCreditRefundElem = document.getElementById('storeCreditRefund');\n\tif (storeCreditRefundElem)\n\t{\n\t\treturnToStoreCredit = Number(storeCreditRefundElem.value * -1);\n\t}\n\telse\n\t{\n\t\treturnToStoreCredit = Number(0);\n\t}\n\n\tvar cashRefund = document.getElementById('credit_to_customer_refund_cash_amount');\n\tif (cashRefund)\n\t{\n\t\tcashRefund = Number(cashRefund.value * -1);\n\t}\n\telse\n\t{\n\t\tcashRefund = Number(0);\n\t}\n\n\t// Credit Card Refunds\n\tvar CreditCCAmount = Number(0);\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\t\tCreditCCAmount += Number(document.getElementById('Cr_RT_' + ident).value);\n\t}\n\n\tif (isNaN(CreditCCAmount))\n\t{\n\t\tCreditCCAmount = Number(0);\n\t}\n\telse\n\t{\n\t\tCreditCCAmount = Number(CreditCCAmount * -1);\n\t}\n\n\tvar PenndingDPAdjustment = Number(getPendingDPAdjustment());\n\n\t// Note: refunds are now expressed as a negative. Payments total can be negative\n\tvar paymentsTotal = Number(paymentsTotal + pay1Amount + pay2Amount +\n\t\treturnToStoreCredit + CreditCCAmount + PenndingDPAdjustment + cashRefund);\n\n\t$('#payment_help_msg').removeClass('overpaid');\n\t// current costs are greater than current payments - money owed to store\n\n\tif (orderState != 'CANCELLED')\n\t{\n\n\t\tvar diff = Number((paymentsTotal * -1) + balance);\n\n\t\tif (diff < 0)\n\t\t{\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse if (diff > 0)\n\t\t{\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#payment_help_msg').html('').hide();\n\t\t}\n\t}\n\telse\n\t{\n\n\t\tvar diff = Number(paymentsTotal + balance);\n\n\t\tif (diff > 0)\n\t\t{\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse if (diff < 0)\n\t\t{\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#payment_help_msg').html('').hide();\n\t\t}\n\t}\n\n\t/*\n\t balance = Math.abs(balance);\n\t //\talert(\"balance: \" + balance);\n\n\t var diff = new Number(paymentsTotal - balance);\n\t //\talert(\"diff: \" + diff);\n\n\t $('#new_payments_total').val(paymentsTotal);\n\n\t $('#payment_help_msg').removeClass('overpaid').html('<span id=\"bal_due\">0.0</span>').show();\n\n\n\t if (orderState == 'CANCELLED')\n\t {\n\t if (diff < 0)\n\t {\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else if (diff > 0)\n\t {\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else\n\t {\n\t $('#payment_help_msg').html('').hide();\n\t }\n\t }\n\t else\n\t {\n\t if (paySel == 'CREDIT')\n\t {\n\t $('#payment_help_msg').html('<span id=\"bal_due\">No Charge</span>').show();\n\t }\n\t else if (diff < 0)\n\t {\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else if (diff > 0)\n\t {\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else\n\t {\n\t $('#payment_help_msg').html('').hide();\n\t }\n\t }\n\t */\n\tupdateChangeList();\n}\n\nfunction toggle(obj)\n{\n\tvar el = document.getElementById(obj);\n\tel.style.display = (el.style.display != 'none' ? 'none' : '');\n}\n\nvar target_prefix = \"payment1_\";\nvar scanPosition = 0;\nvar charIndex = 0;\nvar codes = [];\n\nfunction keyHandler2(evt)\n{\n\n\tevt = (evt) ? evt : event;\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\tcodes[charIndex++] = String.fromCharCode(charCode);\n\n\tif ((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\n\t{\n\t\tscanPosition = 1; //start of data\n\t}\n\telse if ((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\n\t{\n\t\tscanPosition = 2; // start of track 1\n\t}\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\n\t{\n\t\tscanPosition = 3;  // end of track 1\n\t}\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\n\t{\n\t\tscanPosition = 0;  // end of track 2\n\t\tcharIndex = 0;\n\t\thandleSwipeCompletion();\n\t}\n}\n\nfunction endScanHandling()\n{\n\tdocument.getElementById('scanArea').style.display = \"none\";\n\tcodes.length = 0;\n\tscanPosition = 0;\n\tcharIndex = 0;\n\tdocument.getElementById('hidden_text_store').value = \"\";\n\n\tdocument.onkeypress = OMDefaultKeyHandler;\n\n}\n\nfunction prepareForCCSwipe(paymentNumber)\n{\n\n\tif (paymentNumber == 2)\n\t{\n\t\ttarget_prefix = 'payment2_';\n\t}\n\telse\n\t{\n\t\ttarget_prefix = 'payment1_';\n\t}\n\n\tdocument.onkeypress = keyHandler2;\n\tdocument.getElementById('scanArea').style.display = \"block\";\n\tdocument.getElementById('hidden_text_store').focus();\n\tdocument.getElementById('hidden_text_store').value = \"\";\n\n}\n\nfunction handleSwipeCompletion()\n{\n\tvar receivedText = codes.join(\"\");\n\n\tvar p = new SwipeParserObj(receivedText);\n\tvar parsedVersion = p.dump();\n\n\tvar re_visa = /^4[0-9]{12}([0-9]{3})?$/;\n\tvar re_mc = /^5[1-5][0-9]{14}$/;\n\tvar re_amex = /^3[47][0-9]{13}$/;\n\tvar re_disc = /^6011[0-9]{12}$/;\n\n\tvar card_type = false;\n\n\tif (re_visa.test(p.account))\n\t{\n\t\tcard_type = 'Visa';\n\t}\n\telse if (re_mc.test(p.account))\n\t{\n\t\tcard_type = 'Mastercard';\n\t}\n\telse if (re_amex.test(p.account))\n\t{\n\t\tcard_type = 'American Express';\n\t}\n\telse if (re_disc.test(p.account))\n\t{\n\t\tcard_type = 'Discover';\n\t}\n\n\tif (card_type)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccType').value = card_type;\n\t}\n\n\tdocument.getElementById(target_prefix + 'ccNumber').value = p.account;\n\tdocument.getElementById(target_prefix + 'ccNameOnCard').value = p.firstname + ' ' + p.surname;\n\tdocument.getElementById(target_prefix + 'ccMonth').value = p.exp_month;\n\n\tvar exp_year = p.exp_year;\n\tif (exp_year.length == 2)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year;\n\t}\n\telse if (exp_year.length == 4)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year.substr(2);\n\t}\n\n\tendScanHandling();\n}"],"names":["originalMaxPPDeduction","selectedFreeMenuItem","couponFreeMenuItemRequired","handle_ltd_round_up","$","prop","orderState","is","GUEST_PREFERENCES","user_id","LTD_AUTO_ROUND_UP","value","orderInfo","ltd_round_up_value","attr","val","trigger","on","e","this","cookie","session_id","dd_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","div_id","confirm","remove","set_user_pref","index","buttons","Yes","No","Ask Again Later","calculateTotal","round_up_val","text","formatAsMoney","slideDown","slideUp","handle_fundraiser_selection","isFundraiser","Number","data","parseFloat","manually_adjusted","description","disabled","toFixed","half_grand_total","handleCouponCodeResult","json","validation_errors","printString","anError","html","show","coupon_code_discount_total","code_id","discount_method","entree_title","entree_servings","handleFreeMenuItem","coupon_obj","coupon_code","createBonusCredit","limit_to_recipe_id","current_item_qty","order_item_array","menu_item_id","coupon","couponDiscountMethod","couponDiscountVar","discount_var","couponlimitedToFT","limit_to_finishing_touch","couponIsValidWithReferralCredit","valid_with_customer_referral_credit","couponIsValidWithPlatePoints","valid_with_plate_points_credits","length","maxPPDeduction","processCode","isDreamRewardsOrder","shouldContinue","code","theForm","get","filterBundle","bundleBox","document","getElementById","checked","parameters","i","elements","name","STORE_DETAILS","id","d","Date","ajax","url","type","timeout","dataType","processor","op","org_ts","order_id","unique","getTime","order_state","params","success","processor_success","processor_message","error","objAJAXRequest","strError","response","removeCode","removeBonusCredit","Object","keys","couponFreeMenuItem","handle_free_menu_item_edit","menu_item_count","buildFreeMenuItemList","menu_item","price","expression","rebuildOrderItemsArray","menu_item_in_list","selected_menu_item_in_list","s","appendTo","each","orderItems","eval","item_title","stripLeadingZeroes","leadingZeroCount","retVal","len","slice","handleReferralRewardDiscount","isNaN","needPlatePointsMaxDiscountChangeWarning","Math","abs","maxReferralRewardCredit","maxReferralRewardDeduction","curReferralRewardDiscount","cap","handlePlatePointsDiscount","maxPPCredit","curPPDiscount","editCashCheckAmount","editCashCheckUpdate","new_total","getGiftCardBalance","card_number","output","card_balance","request_uri","editCashCheckAmountCommit","alert","new_number","PATH","image_admin","fadeOut","showButtonProcessDelayedPaymentNow","PendingDPOriginalStatus","processPayment","order_number","credit_card_number","substr","transaction_id","transaction_date","payment_id","css","color","summary_date","canAdjustDelayedPayment","back_path","setDelayedPaymentStatusTo","PendingDPOriginalTransActionID","toLowerCase","setupCouponState","style","display","processDelayedPaymentStatus","old_status","new_status","store_id","status","text-decoration","canAutoAdjust","src","alt","pointToTransaction","processPointToTransaction","old_ref_number","new_ref_number","new_card_number","transactionid","new_card_type","unsetAutoAdjust","setAllPaymentFieldsToUnrequired","reqField","setAttribute","lastPayment1Type","changePayment1","mySelect","divGC","divCash","divRefundCash","divCheck","divCC","divCredit","divRef","divRefOther","refundDiv","dpAdjust","divDebitGiftCard","payment2","selected_ref","resetPendingDelayedPayment","amount","changePayment2","onPaymentSelected","balance","innerHTML","paymentsTotal","paySel","autoAdjBox","forceManualAutoAdjust","handleAutoAdjust","adjustPendingDelayedPayment","externalPaymentAmountArray","onPaymentDeselected","reportPaymentStatus","textBal","valueOf","divref2","selectedItem","validateRefTrans","field","limit","payAmountChange","idElem","org_dp_amount","adjVal","adjustmentAmount","getPendingDPAdjustment","adj_dp_amount","assignBalanceToRefTransactions","paymentCount","prefix","ident","existingPaymentAmountArray","elname","amountCredit","maxStoreCredit","refTransField","remainingFundsThisPayment","current_refunded_amount","thisAmount","storeCreditAmountChange","storeCreditClick","obj","amountElem","balance_elem","updateChangeList","ignorePayment2","paySelElem","pay1Amount","DirCreditCCAmount","pay2Amount","paySel2","storeCreditRefundElem","returnToStoreCredit","cashRefund","CreditCCAmount","PenndingDPAdjustment","removeClass","diff","addClass","toggle","el","target_prefix","scanPosition","charIndex","codes","keyHandler2","evt","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","onkeypress","OMDefaultKeyHandler","prepareForCCSwipe","paymentNumber","focus","receivedText","join","p","SwipeParserObj","parsedVersion","dump","re_visa","re_mc","re_amex","re_disc","card_type","test","account","firstname","surname","exp_month","exp_year"],"mappings":"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"}
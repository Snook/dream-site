{"version":3,"file":"gift_card.min.js","names":["useTransparentRedirect","codes","i","x","browser","navigator","appName","keyHandler","evt","charCode","document","event","keyCode","length","gc_elem","getElementById","value","String","fromCharCode","parseInt","_override_check_form","frmObj","_submit_click","obj","style","display","$","_check_form","amount","val","isNaN","dd_message","title","message","addClass","msg","formatAsMoney","modal","confirm","getTokenAndSubmit","submitDirect","cancel","show","attr","type","name","appendTo","submit","displayModalWaitDialog","billing_name","billing_address","billing_zip","billing_email","payload","PayFlow_Payload","billing_data","bname","badd","bzip","bemail","comment_payload","addNameValuePair","addAssocArray","amt","ajax","url","timeout","dataType","data","processor","store_id","op","order_id","use_corp","check_smart_transactions","dd_csrf_token","chain_token","success","json","getTokenToken","processor_success","submit_to_paypal","token","remove","processor_message","error","objAJAXRequest","strError","response","on","dd_console_log","next_dest","get","contentWindow","pp_success","e","bounce","error_code","expdate","csc","gift_card_number","card_type","USER_DETAILS","id","payflowErrorURL","PATH","https_server","parmList","retrieveEncodedString","tr_action","pfp_test_mode","transparent_redirect_link","create_and_submit_form","action","target","input","SECURETOKEN","SECURETOKENID","tokenID","PARMLIST"],"sourceRoot":"js/src/dreamdinners/admin","sources":["gift_card.js"],"sourcesContent":["var useTransparentRedirect = false;\n\nvar codes = '';\nvar i = 0;\nvar x = 0;\nvar browser = navigator.appName;\n\nfunction keyHandler(evt)\n{\n\tif (browser == \"Microsoft Internet Explorer\")\n\t{\n\t\tvar charCode = (document.all) ? event.keyCode : evt.keyCode;\n\t}\n\telse\n\t{\n\t\tvar charCode = evt.keyCode ? evt.keyCode : evt.charCode;\n\t}\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\tif (charCode == 94)\n\t{\n\t\tif (codes.length >= 15)\n\t\t{\n\t\t\tvar gc_elem = document.getElementById('gift_card_number');\n\t\t\tif (gc_elem)\n\t\t\t{\n\t\t\t\tgc_elem.value = codes;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcodes = '';\n\t\t\ti = 0;\n\t\t}\n\t\treturn false;\n\t}\n\tif (codes.length == 15)\n\t{\n\t\t//document.getElementById('gift_card_number').value=codes;\n\t\treturn false;\n\t}\n\tif ((String.fromCharCode(charCode) == '%') && (i == 0))\n\t{\n\t\ti = 1;\n\t}\n\telse if ((String.fromCharCode(charCode) == 'B') && (i == 1))\n\t{\n\t\ti = 2;\n\t}\n\telse if (i == 2 && (parseInt(charCode) > 57 || parseInt(charCode) < 48) && charCode != 94 && charCode != 8)\n\t{\n\t\t//document.getElementById('gift_card_number').value=codes;\n\t\treturn false;\n\t}\n\telse if ((parseInt(charCode) > 57 || parseInt(charCode) < 48) && i < 2 && charCode != 94 && (String.fromCharCode(charCode)) != 'B' && charCode != 8)\n\t{\n\t\t//document.getElementById('gift_card_number').value=codes;\n\t\treturn false;\n\t}\n\n\tif ((String.fromCharCode(charCode) != 'B') && (i == 2))\n\t{\n\t\tif ((String.fromCharCode(charCode) != '^'))\n\t\t{\n\t\t\tcodes += String.fromCharCode(charCode);\n\t\t}\n\t}\n\n}\n\n//document.onkeypress = keyHandler;\n\nfunction _override_check_form(frmObj)\n{\n\n\treturn false;\n\t// defeat ordinary submission\n\n}\n\nfunction _submit_click(obj)\n{\n\tobj.style.display = \"none\";\n\n\tvar frmObj = $(\"#gift_card_load\")[0];\n\n\tvar validated = _check_form(frmObj);\n\n\tif (!validated)\n\t{\n\t\tdocument.getElementById('procCardLoadBtn').style.display = \"block\"\n\t}\n\telse\n\t{\n\t\tvar amount = $(\"#amount\").val();\n\t\tif (isNaN(amount) || amount < 25 || amount > 500)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: \"Please enter a dollar amount greater or equal to $25 and no greater than $500.\"\n\t\t\t});\n\n\t\t\t$(\"#amount\").addClass('input_in_error');\n\n\t\t\tdocument.getElementById('procCardLoadBtn').style.display = \"block\";\n\t\t\treturn true;\n\t\t}\n\n\t\tvar msg = \"Load Gift Card #\" + $('#gift_card_number').val() + \" by the amount of $\" + formatAsMoney($(\"#amount\").val()) + \"?\";\n\n\t\tdd_message({\n\t\t\ttitle: 'Submit Gift Card Order',\n\t\t\tmessage: msg,\n\t\t\tmodal: true,\n\t\t\tconfirm: function () {\n\t\t\t\tif (useTransparentRedirect)\n\t\t\t\t{\n\t\t\t\t\tgetTokenAndSubmit();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsubmitDirect();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcancel: function () {\n\t\t\t\t$('#procCardLoadBtn').show();\n\t\t\t}\n\n\t\t});\n\n\t}\n\n\treturn true;\n}\n\nfunction submitDirect()\n{\n\t$('<input>').attr({\n\t\ttype: 'hidden',\n\t\tname: 'load_submit',\n\t\tvalue: 'load_submit'\n\t}).appendTo($('#gift_card_load'));\n\n\t$('#gift_card_load').submit();\n}\n\nfunction getTokenAndSubmit()\n{\n\n\tdisplayModalWaitDialog('TR_process_dialog', 'Please wait as the payment is processed. This may take a short while.');\n\n\tvar billing_name = $(\"#billing_name\").val();\n\tvar billing_address = $(\"#billing_address\").val();\n\tvar billing_zip = $(\"#billing_zip\").val();\n\tvar billing_email = $(\"#primary_email\").val();\n\n\tvar payload = new PayFlow_Payload();\n\n\tvar billing_data = {\n\t\tbname: billing_name,\n\t\tbadd: billing_address,\n\t\tbzip: billing_zip,\n\t\tbemail: billing_email\n\t};\n\n\tvar comment_payload = new PayFlow_Payload();\n\n\tcomment_payload.addNameValuePair('UserID', 0);\n\tcomment_payload.addNameValuePair('StoreID', 0);\n\tcomment_payload.addNameValuePair('OrderID', 0);\n\tcomment_payload.addNameValuePair('Email', billing_email);\n\n\tpayload.addAssocArray('billing_data', billing_data);\n\tvar amt = $(\"#amount\").val();\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: store_id,\n\t\t\top: 'get_token',\n\t\t\torder_id: 0,\n\t\t\tamount: amt,\n\t\t\tbilling_name: billing_name,\n\t\t\tbilling_address: billing_address,\n\t\t\tbilling_zip: billing_zip,\n\t\t\tuse_corp: true,\n\t\t\tcheck_smart_transactions: true,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#gift_card_load').val(),\n\t\t\tchain_token: true\n\t\t},\n\t\tsuccess: function (json) {\n\n\t\t\t$('input[name=dd_csrf_token]', '#gift_card_load').val(json.getTokenToken);\n\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tvar token = json.token;\n\n\t\t\t\tsubmit_to_paypal(token, payload, comment_payload);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\t$(\"#procCardLoadBtn\").show();\n\t\t\t\t$(\"#TR_process_dialog\").remove();\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t$(\"#procCardLoadBtn\").show();\n\t\t\t$(\"#TR_process_dialog\").remove();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction submit_to_paypal(token, payload, comment_payload)\n{\n\t$('#paypal-result').on(\"load\", function () {\n\t\tdd_console_log(\"frame is loading in submit_to_paypal()\");\n\n\t\ttry\n\t\t{\n\t\t\t//var datastuff = $('#paypal-result').contents().find('body').html();\n\t\t\tvar next_dest = $('#paypal-result').get(0).contentWindow.next_dest;\n\t\t\tvar success = $('#paypal-result').get(0).contentWindow.pp_success;\n\n\t\t\tdd_console_log(\"successful access with next_dest as \" + next_dest);\n\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tdd_console_log(\"exception thrown accessing iFrame: \" + e.message);\n\t\t\t$(\"#TR_process_dialog\").remove();\n\t\t\t$(\"#procCardLoadBtn\").show();\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Exception',\n\t\t\t\tmessage: 'Some required information is missing or incorrect. Please correct the fields below and try again.'\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t// in Safari - exception is not thrown and success is undefined\n\t\t// the test is false and we drop into the success = false block\n\t\t// then error_code and message also are set to undefined\n\n\t\tif (success)\n\t\t{\n\n\t\t\tdd_console_log(\"sucess! about to bounce to \" + next_dest);\n\n\t\t\tbounce(next_dest);\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tdd_console_log(\"failure! \");\n\n\t\t\tvar error_code = $('#paypal-result').get(0).contentWindow.error_code;\n\t\t\tvar message = $('#paypal-result').get(0).contentWindow.message;\n\n\t\t\tif (typeof message == 'undefined')\n\t\t\t{\n\n\t\t\t\tdd_console_log(\"failure with no data! \");\n\n\t\t\t\terror_code = \"Generic\";\n\t\t\t\tmessage = 'An unexpected error has occurred. It appears that the Gift Card processor is currently unavailable. Please contact Dream Dinners support at 1-360-804-2020.';\n\t\t\t}\n\n\t\t\t$(\"#TR_process_dialog\").remove();\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\tmessage: message\n\t\t\t});\n\n\t\t\t$(\"#procCardLoadBtn\").show();\n\t\t}\n\t});\n\n\tvar expdate = $(\"#credit_card_exp_month\").val();\n\texpdate += $(\"#credit_card_exp_year\").val();\n\tvar csc = $(\"#credit_card_cvv\").val();\n\tvar amt = $(\"#amount\").val();\n\tvar gift_card_number = $(\"#gift_card_number\").val();\n\tvar card_type = $(\"#credit_card_type\").val();\n\n\tpayload.addNameValuePair('user_id', 0);\n\tpayload.addNameValuePair('store_id', store_id);\n\tpayload.addNameValuePair('order_id', 'none');\n\tpayload.addNameValuePair('caller_id', 'fadmin_load');\n\tpayload.addNameValuePair('card_type', card_type);\n\tpayload.addNameValuePair('gcnum', gift_card_number);\n\tpayload.addNameValuePair('admin_user_id', USER_DETAILS.id);\n\n\tif (typeof payflowErrorURL == 'undefined')\n\t{\n\t\tpayflowErrorURL = PATH.https_server + \"/processor?processor=admin_payflow_callback\";\n\t}\n\n\t// make PARMLIST\n\tvar parmList = 'ERRORURL=' + payflowErrorURL + \"&ACCT=\" + $(\"#credit_card_number\").val() + \"&EXPDATE=\" + expdate + \"&CSC=\" + csc + \"&AMT=\" + amt + \"&USER1=\" + payload.retrieveEncodedString() + \"&COMMENT1=\" + comment_payload.retrieveEncodedString();\n\n\tvar tr_action = 'https://payflowlink.paypal.com';\n\tif (typeof pfp_test_mode != 'undefined' && pfp_test_mode)\n\t{\n\t\tvar tr_action = 'https://pilot-payflowlink.paypal.com';\n\t}\n\n\tif (typeof transparent_redirect_link != 'undefined')\n\t{\n\t\ttr_action = transparent_redirect_link;\n\t}\n\n\tdd_console_log(\"About to send! \");\n\n\t// Create dynamic form to post and redirect to session_menu\n\tcreate_and_submit_form({\n\t\taction: tr_action,\n\t\ttarget: \"paypal-result\",\n\t\tinput: ({\n\t\t\tSECURETOKEN: token.token,\n\t\t\tSECURETOKENID: token.tokenID,\n\t\t\tPARMLIST: parmList\n\t\t})\n\t});\n\n}"],"mappings":"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"}
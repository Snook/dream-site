{"version":3,"file":"gift_card.min.js","names":["useTransparentRedirect","codes","i","x","browser","navigator","appName","keyHandler","evt","charCode","document","event","keyCode","length","gc_elem","getElementById","value","String","fromCharCode","parseInt","_override_check_form","frmObj","_submit_click","obj","style","display","$","_check_form","amount","val","isNaN","dd_message","title","message","addClass","msg","formatAsMoney","modal","confirm","getTokenAndSubmit","submitDirect","cancel","show","attr","type","name","appendTo","submit","displayModalWaitDialog","billing_name","billing_address","billing_zip","billing_email","payload","PayFlow_Payload","billing_data","bname","badd","bzip","bemail","comment_payload","addNameValuePair","addAssocArray","amt","ajax","url","timeout","dataType","data","processor","store_id","op","order_id","use_corp","check_smart_transactions","dd_csrf_token","chain_token","success","json","getTokenToken","processor_success","submit_to_paypal","token","remove","processor_message","error","objAJAXRequest","strError","response","on","dd_console_log","next_dest","get","contentWindow","pp_success","e","bounce","error_code","expdate","csc","gift_card_number","card_type","USER_DETAILS","id","payflowErrorURL","parmList","retrieveEncodedString","tr_action","pfp_test_mode","transparent_redirect_link","create_and_submit_form","action","target","input","SECURETOKEN","SECURETOKENID","tokenID","PARMLIST"],"sourceRoot":"js/src/dreamdinners/admin","sources":["gift_card.js"],"sourcesContent":["var useTransparentRedirect = false;\r\n\r\nvar codes = '';\r\nvar i =0;\r\nvar x =0;\r\nvar browser=navigator.appName;\r\n  function keyHandler(evt) {\r\n        if(browser==\"Microsoft Internet Explorer\") {\r\n\t\t\tvar charCode = (document.all)?event.keyCode:evt.keyCode;\r\n\t\t} else {\r\n\t\t\tvar charCode=evt.keyCode? evt.keyCode : evt.charCode;\r\n\t\t}\r\n     if(charCode==13 ){\r\n         return false;\r\n     }\r\n\r\n\t if( charCode==94 ){\r\n\t\t if( codes.length>=15 ) {\r\n\t\t\t\tvar gc_elem = document.getElementById('gift_card_number');\r\n\t\t\t\tif (gc_elem) gc_elem.value=codes;\r\n\t\t } else {\r\n\t\t\t codes = '';\r\n\t\t\t i=0;\t\t }\r\n\t\t return false;\r\n\t }\r\n    if( codes.length==15 ) {\r\n\t\t\t //document.getElementById('gift_card_number').value=codes;\r\n             return false;\r\n    }\r\n\tif((String.fromCharCode(charCode)=='%')&&(i==0)){\r\n         i=1;\r\n     }\r\n     else if((String.fromCharCode(charCode)=='B')&&(i==1)){\r\n         i=2;\r\n     }\r\n\t else if( i==2 && (parseInt(charCode)>57 || parseInt(charCode)<48)  && charCode!=94 && charCode!=8) {\r\n\t\t //document.getElementById('gift_card_number').value=codes;\r\n\t\t return false;\r\n\t }\r\n\telse if((parseInt(charCode)>57 || parseInt(charCode)<48) && i<2 && charCode!=94 && (String.fromCharCode(charCode))!='B' && charCode!=8){\r\n\t\t //document.getElementById('gift_card_number').value=codes;\r\n\t\t return false;\r\n\t }\r\n\r\n\r\n     if((String.fromCharCode(charCode)!='B')&&(i==2)){\r\n         if((String.fromCharCode(charCode)!='^')){\r\n             codes += String.fromCharCode(charCode);\r\n         }\r\n     }\r\n\r\n}\r\n\r\n\r\n //document.onkeypress = keyHandler;\r\n\r\n function _override_check_form(frmObj)\r\n {\r\n\r\n\t return false;\r\n\t// defeat ordinary submission\r\n\r\n }\r\n\r\n function _submit_click(obj)\r\n {\r\n\tobj.style.display = \"none\";\r\n\r\n\tvar frmObj = $(\"#gift_card_load\")[0];\r\n\r\n\tvar validated = _check_form(frmObj);\r\n\r\n\tif (!validated)\r\n\t{\r\n\t\t document.getElementById('procCardLoadBtn').style.display = \"block\"\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar amount = $(\"#amount\").val();\r\n\t\tif(isNaN(amount) || amount < 25 || amount > 500)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: \"Please enter a dollar amount greater or equal to $25 and no greater than $500.\"\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#amount\").addClass('input_in_error');\r\n\r\n\t\t\tdocument.getElementById('procCardLoadBtn').style.display = \"block\";\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\r\n\r\n\t\tvar msg = \"Load Gift Card #\" + $('#gift_card_number').val() + \" by the amount of $\" + formatAsMoney($(\"#amount\").val()) + \"?\";\r\n\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Submit Gift Card Order',\r\n\t\t\tmessage: msg,\r\n\t\t\tmodal: true,\r\n\t\t\tconfirm: function() {\r\n\t\t\t\tif (useTransparentRedirect)\r\n\t\t\t\t{\r\n\t\t\t\t\tgetTokenAndSubmit();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tsubmitDirect();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcancel:function() {\r\n\t\t\t\t$('#procCardLoadBtn').show();\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\treturn true;\r\n }\r\n\r\n\r\n function submitDirect()\r\n {\r\n\t$('<input>').attr({\r\n\t\ttype: 'hidden',\r\n\t\tname: 'load_submit',\r\n\t\tvalue: 'load_submit',\r\n\t}).appendTo($('#gift_card_load'));\r\n\r\n\t$('#gift_card_load').submit();\r\n }\r\n\r\n\r\n function getTokenAndSubmit()\r\n {\r\n\r\n\t\tdisplayModalWaitDialog('TR_process_dialog', 'Please wait as the payment is processed. This may take a short while.');\r\n\r\n\t\tvar billing_name = $(\"#billing_name\").val();\r\n\t\tvar billing_address = $(\"#billing_address\").val();\r\n\t\tvar billing_zip = $(\"#billing_zip\").val();\r\n\t\tvar billing_email = $(\"#primary_email\").val();\r\n\r\n\r\n\t\tvar payload = new PayFlow_Payload();\r\n\r\n\t\tvar billing_data = {\r\n\t\t\tbname: billing_name,\r\n\t\t\tbadd: billing_address,\r\n\t\t\tbzip: billing_zip,\r\n\t\t\tbemail: billing_email\r\n\t\t};\r\n\r\n\r\n\t\tvar comment_payload = new PayFlow_Payload();\r\n\r\n\t\tcomment_payload.addNameValuePair('UserID', 0);\r\n\t\tcomment_payload.addNameValuePair('StoreID', 0);\r\n\t\tcomment_payload.addNameValuePair('OrderID', 0);\r\n\t\tcomment_payload.addNameValuePair('Email', billing_email);\r\n\r\n\r\n\t\tpayload.addAssocArray('billing_data', billing_data);\r\n\t \tvar amt = $(\"#amount\").val();\r\n\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata : {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\r\n\t\t\t\tstore_id: store_id,\r\n\t\t\t\top: 'get_token',\r\n\t\t\t\torder_id: 0,\r\n\t\t\t\tamount: amt,\r\n\t\t\t\tbilling_name: billing_name,\r\n\t\t\t\tbilling_address: billing_address,\r\n\t\t\t\tbilling_zip: billing_zip,\r\n\t\t\t\tuse_corp: true,\r\n\t\t\t\tcheck_smart_transactions: true,\r\n\t\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#gift_card_load').val(),\r\n\t\t\t\tchain_token: true\r\n\t\t\t},\r\n\t\t\tsuccess: function(json)\r\n\t\t\t{\r\n\r\n\t\t\t\t$('input[name=dd_csrf_token]', '#gift_card_load').val(json.getTokenToken);\r\n\r\n\r\n\t\t\t\tif(json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar token = json.token;\r\n\r\n\t\t\t\t\tsubmit_to_paypal(token, payload, comment_payload);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\t $(\"#procCardLoadBtn\").show();\r\n\t\t\t\t\t$(\"#TR_process_dialog\").remove();\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function(objAJAXRequest, strError)\r\n\t\t\t{\r\n\r\n\t\t\t\t $(\"#procCardLoadBtn\").show();\r\n\t\t\t\t$(\"#TR_process_dialog\").remove();\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n }\r\n\r\n\r\n function submit_to_paypal(token, payload, comment_payload)\r\n {\r\n\t$('#paypal-result').on(\"load\", function()\r\n\t{\r\n\t\tdd_console_log( \"frame is loading in submit_to_paypal()\");\r\n\r\n\t\ttry\r\n\t\t{\r\n\t\t\t//var datastuff = $('#paypal-result').contents().find('body').html();\r\n\t\t\tvar next_dest  = $('#paypal-result').get(0).contentWindow.next_dest;\r\n\t\t\tvar success = $('#paypal-result').get(0).contentWindow.pp_success;\r\n\r\n\t\t\tdd_console_log( \"successful access with next_dest as \" + next_dest);\r\n\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tdd_console_log( \"exception thrown accessing iFrame: \" + e.message);\r\n\t\t\t$(\"#TR_process_dialog\").remove();\r\n\t\t    $(\"#procCardLoadBtn\").show();\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Exception',\r\n\t\t\t\tmessage: 'Some required information is missing or incorrect. Please correct the fields below and try again.'\r\n\t\t\t});\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// in Safari - exception is not thrown and success is undefined\r\n\t\t// the test is false and we drop into the success = false block\r\n\t\t// then error_code and message also are set to undefined\r\n\r\n\r\n\t\tif (success)\r\n\t\t{\r\n\r\n\t\t\tdd_console_log( \"sucess! about to bounce to \" + next_dest);\r\n\r\n\t\t\tbounce(next_dest);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\r\n\t\t\tdd_console_log( \"failure! \");\r\n\r\n\r\n\t\t\tvar error_code = $('#paypal-result').get(0).contentWindow.error_code;\r\n\t\t\tvar message = $('#paypal-result').get(0).contentWindow.message;\r\n\r\n\t\t\tif (typeof message == 'undefined')\r\n\t\t\t{\r\n\r\n\t\t\t\tdd_console_log( \"failure with no data! \");\r\n\r\n\t\t\t\terror_code = \"Generic\";\r\n\t\t\t\tmessage = 'An unexpected error has occurred. It appears that the Gift Card processor is currently unavailable. Please contact Dream Dinners support at 1-360-804-2020.';\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#TR_process_dialog\").remove();\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error: ' + error_code,\r\n\t\t\t\tmessage: message\r\n\t\t\t});\r\n\r\n\t\t\t $(\"#procCardLoadBtn\").show();\r\n\t\t}\r\n\t});\r\n\r\n\r\n \tvar expdate = $(\"#credit_card_exp_month\").val();\r\n \texpdate += $(\"#credit_card_exp_year\").val();\r\n \tvar csc = $(\"#credit_card_cvv\").val();\r\n \tvar amt = $(\"#amount\").val();\r\n \tvar gift_card_number = $(\"#gift_card_number\").val();\r\n\tvar card_type = $(\"#credit_card_type\").val();\r\n\r\n\r\n\tpayload.addNameValuePair('user_id', 0);\r\n\tpayload.addNameValuePair('store_id', store_id);\r\n\tpayload.addNameValuePair('order_id', 'none');\r\n\tpayload.addNameValuePair('caller_id', 'fadmin_load');\r\n\tpayload.addNameValuePair('card_type', card_type);\r\n\tpayload.addNameValuePair('gcnum', gift_card_number);\r\n\tpayload.addNameValuePair('admin_user_id', USER_DETAILS.id);\r\n\r\n\r\n    if (typeof payflowErrorURL == 'undefined')\r\n    {\r\n    \tpayflowErrorURL = \"https://dreamdinners.com/ddproc.php?processor=admin_payflow_callback\";\r\n    }\r\n\r\n \t// make PARMLIST\r\n \tvar parmList = 'ERRORURL=' + payflowErrorURL + \"&ACCT=\" + $(\"#credit_card_number\").val() + \"&EXPDATE=\" + expdate + \"&CSC=\" + csc + \"&AMT=\" + amt + \"&USER1=\" + payload.retrieveEncodedString() + \"&COMMENT1=\" + comment_payload.retrieveEncodedString();\r\n\r\n\r\n    var tr_action = 'https://payflowlink.paypal.com';\r\n    if (typeof pfp_test_mode != 'undefined' && pfp_test_mode)\r\n    {\r\n        var tr_action = 'https://pilot-payflowlink.paypal.com';\r\n    }\r\n\r\n    if (typeof transparent_redirect_link != 'undefined')\r\n    {\r\n    \ttr_action = transparent_redirect_link;\r\n    }\r\n\r\n\tdd_console_log( \"About to send! \");\r\n\r\n \t// Create dynamic form to post and redirect to session_menu\r\n \tcreate_and_submit_form({\r\n \t\taction: tr_action,\r\n \t\ttarget: \"paypal-result\",\r\n \t\tinput: ({\r\n\t\t\tSECURETOKEN:token.token,\r\n\t\t\tSECURETOKENID: token.tokenID,\r\n \t\t \tPARMLIST: parmList\r\n \t \t})\r\n \t});\r\n\r\n }\r\n"],"mappings":"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"}
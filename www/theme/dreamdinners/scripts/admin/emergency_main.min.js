var selected_session_id,view_session,manualSearchTypeChange,manualOrderSearchTypeChange,init_go_to_today=!1,suppress_fastlane_labels=!1;function main_init(){handle_agenda_click(),handle_agenda_month_select(),handle_session_tools(),handle_go_to_today(),handle_guest_search(),handle_order_search(),handle_preselection(),handle_order_details_table(),init_looping_timers()}function init_looping_timers(){start_dashboard_snapshot_timer(),start_unix_expiry_timer()}function register_booking_click_handlers(){handle_booking_row_click(),handle_booking_no_show(),handle_platepoints_gifts(),handle_food_testing_recipe(),handle_pp_opted_out(),handle_order_details_table(),handle_delayed_payment_tc()}function handle_order_details_table(){$("[data-view_order_details]").each((function(){$(this).on("click",(function(e){e.preventDefault();var s=$(this).data("booking_id"),t=$(this).data("order_id");$(".order_details_tbody").hide(),$("#order_details_tbody_id_"+s).show(),$("html, body").animate({scrollTop:$("#guest_details_tbody_id_"+s).offset().top-40},500),$("html, body").on("scroll mousedown DOMMouseScroll mousewheel keyup",(function(e){$("html, body").stop()})),$.ajax({url:"/processor",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_fadmin_home_order_details",op:"order_details",order_id:t,booking_id:s},success:function(e){e.processor_success&&($("#order_details_table_div_id_"+e.booking_id).html(e.order_details_table),getQueryVariable("session")?update_page_url("?session="+getQueryVariable("session")+"&order="+e.order_id):getQueryVariable("day")&&update_page_url("?day="+getQueryVariable("day")+"&order="+e.order_id),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"get_history",user_id:USER_DETAILS.id,order_id:t},success:function(e){$("#order_history_div_id_"+e.booking_id).html(e.html)},error:function(e,s){response="Unexpected error: "+s,dd_message({title:"Error",message:response})}}))},error:function(e,s){response="Unexpected error"}})})),$(".close_order_details_table").on("click",(function(e){$("#order_details_tbody_id_"+$(this).data("booking_id")).hide(),getQueryVariable("session")?update_page_url("?session="+getQueryVariable("session")):getQueryVariable("day")&&update_page_url("?day="+getQueryVariable("day"))}))}))}function handle_platepoints_gifts(){$("[data-pp_gift_reward]").each((function(){$(this).on("click",(function(e){user_id=$(this).data("user_id"),level=$(this).data("level"),gift_id=$(this).data("gift_id"),dd_message({title:"Mark received confirmation",message:"Are you sure you wish to mark the gift as received?",modal:!0,confirm:function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"plate_points_processor",user_id:user_id,op:"mark_gift_received",level:level,gift_id:gift_id},success:function(e,s){e.processor_success?($("[data-pp_gift_reward_div="+e.user_id+"]").hide(),dd_toast({message:"The guest has received their current level gift: "+e.giftDisplayString})):dd_message({title:"Error",message:"There was a problem marking the gift as received."})},error:function(e,s){response="Unexpected error"}})}})}))}))}function start_dashboard_snapshot_timer(){$.doTimeout("dashboard_snapshot_timer"),$.doTimeout("dashboard_snapshot_timer",12e4,(function(){return handle_dashboard_update(),!0}))}function start_unix_expiry_timer(){$.doTimeout("unix_expiry_timer"),$.doTimeout("unix_expiry_timer",6e4,(function(){var e=Math.round((new Date).getTime()/1e3);return $("[data-unix_expiry]").filter((function(){return $(this).data("unix_expiry")<e&&!$(this).hasClass("is_past")})).addClass("is_past"),!0})),$.doTimeout("unix_expiry_timer",!0)}function set_selected_date(e){return new_date_parts=e.split("-"),old_date_parts=selected_date.split("-"),new_year_month=new_date_parts[0]+"-"+new_date_parts[1],old_year_month=old_date_parts[0]+"-"+old_date_parts[1],selected_date=e,new_year_month!=old_year_month&&(handle_dashboard_update(),!0)}function handle_dashboard_update(){$("#dashboard_snapshot_table_div").length&&$("#dashboard_snapshot_container").is(":visible")&&($.doTimeout("dashboard_processing_timer",1e3,(function(){$("#dashboard_processing").show(),$("#dashboard_snapshot_table").addClass("processing")})),$.ajax({url:"/processor",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"dashboard_details",store_id:STORE_DETAILS.id,dashboard_date:selected_date},success:function(e){e.processor_success&&($.doTimeout("dashboard_processing_timer"),$("#ds_title_date").html(e.dash_date),$("#dashboard_snapshot_table_div").html(e.dashboard_metrics),$("#dashboard_snapshot_table").removeClass("processing"),$("#dashboard_processing").hide(),help_system_init())},error:function(e,s){response="Unexpected error",handle_dashboard_update()}}))}function handle_agenda_month_select(){$("#month_selector").on("change",(function(e){selected_agenda_month=$("#month_selector").val(),doasync=!0,init_go_to_today&&(doasync=!1),$.ajax({url:"/processor",type:"POST",async:doasync,timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"agenda_details",store_id:STORE_DETAILS.id,agenda_date:selected_agenda_month},success:function(e){e.processor_success&&($("#session_selector").html(e.session_info),handle_agenda_click(),init_go_to_today||$("#day_"+e.date).scrollToTarget($("#session_selector")))},error:function(e,s){response="Unexpected error"}})}))}function handle_delayed_payment_tc(){$("[data-delayed_payment_tc]").on("click",(function(e){var s=$(this).data("delayed_payment_tc");dd_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment,modal:!0,noOk:!0,buttons:{Agree:function(){$(this).remove(),$('[data-delayed_payment_tc="'+s+'"]').hide(),set_user_pref("TC_DELAYED_PAYMENT_AGREE",1,s)},Decline:function(){dd_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment_decline}),set_user_pref("TC_DELAYED_PAYMENT_AGREE",0,s)}}})}))}function handle_agenda_click(){$("#session_selection li").each((function(){$(this).on("click",(function(e){void 0!==window.booking_query&&window.booking_query.abort(),$(".selected").removeClass("selected"),$(this).addClass("selected"),$.doTimeout("booked_guests_table_timer"),$.doTimeout("booked_guests_table_timer",1e3,(function(){$("#booked_guests_table").html('<img src="'+PATH.image_admin+'/style/throbber_circle.gif" class="img_valign img_throbber_circle" data-tooltip="Processing" alt="Processing" style="display: inline;" /> Loading...')})),$(this).data("session_id")?(view_session=!0,selected_session_id=$(this).data("session_id"),window.booking_query=$.ajax({url:"/processor",type:"POST",timeout:12e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"session_details",store_id:STORE_DETAILS.id,session_id:selected_session_id},success:function(e){if(e.processor_success){var s=!1;getQueryVariable("day")||(s=getQueryVariable("order")),$.doTimeout("booked_guests_table_timer"),update_page_url("?session="+e.session_info.id),selected_menu_id=e.session_info.menu_id,set_selected_date(e.session_info.session_start_dtf_ymd),update_session_tool_links(),$("#selected_day").html(e.session_info.session_start_dtf_verbose_date),$("#selected_date_link").attention(),$("#selected_session").html(" - "+e.session_info.session_start_dtf_time_only),$("#selected_session").show(),$("#day_details_container").hide(),$("#session_details_table_div").html(e.session_details);var t="PUBLISHED"==e.session_info.session_publish_state?"Close Session":"Open Session";$("#sd_publish_state").data("session_publish_state",e.session_info.session_publish_state).html(t),$("#session-"+selected_session_id+" > span.attending").html(e.session_info.booked_count),$("#session-"+selected_session_id+" > span.remaining").html(e.session_info.remaining_slots+"/"+(e.session_info.remaining_intro_slots>0?e.session_info.remaining_intro_slots:0)),"PUBLISHED"==e.session_info.session_publish_state?$("#session-"+selected_session_id+" > span.time").removeClass("closed"):$("#session-"+selected_session_id+" > span.time").addClass("closed"),$("#session_details_container").show(),$("#booked_guests_table").html(e.booking_details),register_booking_click_handlers(),s&&$('[data-view_order_details][data-order_id="'+s+'"]').trigger("click"),$("#sd_invitation_pdf").on("click",(function(e){bounce("/my-events?taste_event_pdf="+selected_session_id+"&back="+back_path(),"_blank")})),$("#sd_fundraiser_invitation_pdf").on("click",(function(e){bounce("/rsvp-fundraiser?event_pdf="+selected_session_id+"&back="+back_path(),"_blank")})),$("#sd_resend_hostess_email").on("click",(function(e){resend_dream_taste_notification()}))}},error:function(e,s){"abort"!=s&&dd_message({title:"Error",message:"An unexpected error has occurred, error message: "+s+". If you continue to experience this issue please contact support."})}})):(view_session=!1,set_selected_date($(this).data("date")),selected_menu_id=$(this).data("menu_id"),window.booking_query=$.ajax({url:"/processor",type:"POST",timeout:12e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"date_details",store_id:STORE_DETAILS.id,date:selected_date},success:function(e){if(e.processor_success){var s=!1;getQueryVariable("session")||(s=getQueryVariable("order")),$.doTimeout("booked_guests_table_timer"),update_page_url("?day="+selected_date),update_session_tool_links(),$("#selected_day").html(e.date_info.date_dtf_verbose_date),$("#selected_date_link").attention(),$("#session_details_container, #selected_session").hide(),e.booking_details.length?($("#booked_guests_table").html(e.booking_details),$("#day_details_table_div").html(e.date_details)):($("#booked_guests_table").html('<div class="no_day_sessions">No sessions for this day.</div>'),$("#day_details_table_div").html('<div class="no_day_sessions">No sessions for this day.</div>')),$("#day_details_container").show(),register_booking_click_handlers(),s&&$('[data-view_order_details][data-order_id="'+s+'"]').trigger("click"),$('[id^="gd_title-"]').on("click",(function(e){$("#session-"+$(this).data("session_id")).scrollToTarget($("#session_selector")),$.scrollTo($("body"),100)})).hover((function(){$(this).addClass("hover")}),(function(){$(this).removeClass("hover")}))}},error:function(e,s){"abort"!=s&&dd_message({title:"Error",message:"An unexpected error has occurred, error message: "+s+". If you continue to experience this issue please contact support."})}}))}))}))}function update_page_url(e){historyPush({url:e}),$("#selected_date_link").prop("href",e)}function handle_pp_opted_out(){$(".pp_opted_out").each((function(){$(this).on("click",(function(e){e.preventDefault();var s=$(this).prop("href");dd_message({title:"Guest has opted out",message:"The guest has previously opted out, are you sure you wish to continue?",modal:!0,confirm:function(){bounce(s)}})}))}))}function resend_dream_taste_notification(){dd_message({title:"Send notice confirmation",message:"Are you sure you wish to resend the host email notification?",modal:!0,confirm:function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"resend_dream_taste_email",store_id:STORE_DETAILS.id,session_id:selected_session_id},success:function(e){e.processor_success&&dd_message({title:"Send notice confirmation",message:"Email notification has been resent to the session host."})},error:function(e,s){response="Unexpected error"}})}})}function handle_booking_no_show(){$('[id^="gd_noshow-"]').each((function(e){$(this).on("click",(function(e){var s=this.checked?"yes":"no";$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_no_show_state",bid:$(this).data("booking_id"),store_id:STORE_DETAILS.id,state:s},success:function(e){e.processor_success},error:function(e,s){response="Unexpected error"}})}))}))}function handle_food_testing_recipe(){$('[id^="food_testing-"]').each((function(e){$(this).on("change",(function(e){var s=$(this),t=$(this).data("user_id"),o=$(this).data("session_id"),i=$(this).data("menu_id"),_=$("option:selected",$(this)).text(),a=$(this).val().split("-")[0],r=$(this).val().split("-")[1];"0"!=$(this).val()&&dd_message({title:"Confirm",message:'Are you sure you wish to assign <span style="font-weight: bold;">'+_+'</span> to this guest? The testing item is <span style="font-weight: bold;">not</span> editable once assigend and the guest will immediately receive an email upon confirmation which will include testing instructions.',noOk:!0,modal:!0,buttons:{Confirm:function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"assign_test_recipe",user_id:t,session_id:o,menu_id:i,survey_id:a,survey_size:r},success:function(e){e.processor_success&&$('[data-food_testing_select_user_id="'+e.user_id+'"]').text(_)},error:function(e,s){response="Unexpected error"}}),$(this).remove()},Cancel:function(){$(this).remove(),$(s).val(0)}}})}))}))}function handle_guest_account_notes(){$('[id^="gd_guest_account_note_button-"]').each((function(){$(this).on("click",(function(e){booking_id=$(this).data("booking_id"),user_id=$(this).data("user_id"),do_op="get",guest_note="",1==$(this).data("edit_mode")&&(do_op="save",guest_note=$("#gd_guest_account_note-"+booking_id+" > textarea").val()),"get"==do_op?get_user_pref("USER_ACCOUNT_NOTE",user_id,(function(e){var s=$("<textarea></textarea>").css({margin:"0px",width:"570px",height:"80px"}).val(e.guest_preferences[user_id].USER_ACCOUNT_NOTE.value?e.guest_preferences[user_id].USER_ACCOUNT_NOTE.value:"").on("keyup",(function(e){$(this).val()!=strip_tags($(this).val())&&$(this).val(strip_tags($(this).val()))}));$("#gd_guest_account_note-"+booking_id).addClass("guest_note_edit").html(s),$("#gd_guest_account_note_button-"+booking_id).data("edit_mode",!0).html("Save Note"),$("#gd_guest_account_note_cancel_button-"+booking_id).show(),$("#gd_guest_account_note_cancel_button-"+booking_id).data("user_data_value",e.guest_preferences[user_id].USER_ACCOUNT_NOTE.value?e.guest_preferences[user_id].USER_ACCOUNT_NOTE.value:"").on("click",(function(e){$("#gd_guest_account_note-"+$(this).data("booking_id")).removeClass("guest_note_edit").html($(this).data("user_data_value")),$("#gd_guest_account_note_button-"+$(this).data("booking_id")).data("edit_mode",!1).html("Account Notes"),$(this).hide()}))})):dd_message({title:"Confirm",message:"This note is viewable and editable by the guest in their preferences. Are you sure you wish to modify the guest's account note?",noOk:!0,modal:!0,buttons:{Confirm:function(){$(this).remove(),set_user_pref("USER_ACCOUNT_NOTE",guest_note,user_id),$("#gd_guest_account_note-"+booking_id).removeClass("guest_note_edit").html(nl2br(guest_note)),$("#gd_guest_account_note_cancel_button-"+booking_id).hide(),$("#gd_guest_account_note_button-"+booking_id).data("edit_mode",!1).html("Account Notes")},Cancel:function(){$(this).remove()}}})}))}))}function handle_admin_carryover_notes(){$('[id^="gd_show_guest_note-"]').each((function(){$(this).on("click",(function(e){var s=$(this).data("booking_id"),t=this;$(t).hide(),$("#gd_guest_note-"+s).show(),$.doTimeout("show_guest_note_timer-"+s,1e4,(function(){$(t).show(),$("#gd_guest_note-"+s).hide()}))}))})),$('[id^="gd_guest_note_button-"]').each((function(){$(this).on("click",(function(e){hide_carryover_notes=$(this).data("hide_carryover_notes"),booking_id=$(this).data("booking_id"),user_id=$(this).data("user_id"),do_op="get",guest_note="",1==$(this).data("edit_mode")&&(do_op="save",guest_note=$("#gd_guest_note-"+booking_id+" > textarea").val()),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"guest_carryover_note",do:do_op,store_id:STORE_DETAILS.id,user_id:user_id,note:guest_note},success:function(e){e.processor_success&&("get"==do_op?($.doTimeout("show_guest_note_timer-"+booking_id),$("#gd_guest_note-"+booking_id).show(),$("#gd_show_guest_note-"+booking_id).hide(),$("#gd_guest_note-"+booking_id).addClass("guest_note_edit").html('<textarea style="margin: 0px; width: 570px; height: 80px;">'+(e.guest_note.user_data_value?e.guest_note.user_data_value:"")+"</textarea>"),$("#gd_guest_note_button-"+booking_id).data("edit_mode",!0).html("Save Note"),$("#gd_guest_note_cancel_button-"+booking_id).data("user_data_value",e.guest_note.user_data_value?e.guest_note.user_data_value:"").on("click",(function(e){1===$(this).data("hide_carryover_notes")&&($("#gd_guest_note-"+booking_id).hide(),$("#gd_show_guest_note-"+booking_id).show()),$("#gd_guest_note-"+$(this).data("booking_id")).removeClass("guest_note_edit").html($(this).data("user_data_value")),$("#gd_guest_note_button-"+$(this).data("booking_id")).data("edit_mode",!1).html("Admin Carryover"),$(this).hide()})).show()):(1===hide_carryover_notes&&e.guest_note.user_data_value&&($("#gd_guest_note-"+booking_id).hide(),$("#gd_show_guest_note-"+booking_id).show()),$("#gd_guest_note-"+booking_id).removeClass("guest_note_edit").html(nl2br(e.guest_note.user_data_value)),$("#gd_guest_note_cancel_button-"+booking_id).hide(),$("#gd_guest_note_button-"+booking_id).data("edit_mode",!1).html("Admin Carryover")))},error:function(e,s){response="Unexpected error"}})}))}))}function handle_admin_order_notes(){$('[id^="gd_admin_note_button-"]').each((function(){$(this).on("click",(function(e){let s=$(this).data("uid");void 0===s||null==s||""==s?s="":s+="-";let t=$(this).data("button_name");void 0!==t&&null!=t&&""!=t||(t="Admin Order Note"),booking_id=$(this).data("booking_id"),order_id=$(this).data("order_id"),user_id=$(this).data("user_id"),do_op="get",admin_note="",1==$(this).data("edit_mode")&&(do_op="save",admin_note=$("#gd_admin_note-"+s+booking_id+" > textarea").val()),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"order_admin_note",do:do_op,order_id:order_id,note:admin_note},success:function(e){e.processor_success&&("get"==do_op?($("#gd_admin_note-"+s+booking_id).addClass("admin_note_edit").html('<textarea class="form-control">'+(e.admin_note?e.admin_note:"")+"</textarea>"),$("#gd_admin_note_button-"+s+booking_id).data("edit_mode",!0).html("Save Note"),$("#gd_admin_note_cancel_button-"+s+booking_id).data("admin_note_value",e.admin_note?e.admin_note:"").on("click",(function(e){$("#gd_admin_note-"+s+$(this).data("booking_id")).removeClass("admin_note_edit").html($(this).data("admin_note_value")),$("#gd_admin_note_button-"+s+$(this).data("booking_id")).data("edit_mode",!1).html(t),$(this).hide()})).show()):($("#gd_admin_note-"+s+booking_id).removeClass("admin_note_edit").html(nl2br(e.admin_note)),$(".multi-populate-admin-note").each((function(){$(this).html(nl2br(e.admin_note))})),$("#gd_admin_note_cancel_button-"+s+booking_id).hide(),$("#gd_admin_note_button-"+s+booking_id).data("edit_mode",!1).html(t)))},error:function(e,s){response="Unexpected error"}})}))}))}function handle_reschedule_button(){$('[id^="gd_reschedule-"]').each((function(){$(this).css({cursor:"pointer"}).on("click",(function(e){create_and_submit_form({method:"post",action:"/backoffice/reschedule",input:{session_id:$(this).data("session_id"),original_session_id:$(this).data("session_id"),store_id:$(this).data("store_id"),menus:$(this).data("menu_id"),menu_id:$(this).data("menu_id"),order_id:$(this).data("order_id"),back_address:back_path()}})}))}))}function handle_booking_row_click(){handle_guest_account_notes(),handle_admin_carryover_notes(),handle_admin_order_notes(),handle_reschedule_button(),$("#booked_guests_table tbody.guest").each((function(){$(this).on("click",(function(e){$(this).hasClass("select_guest")?$(".select_guest").removeClass("select_guest"):($(".select_guest").removeClass("select_guest"),$("#guest_details_tbody_id_"+$(this).data("booking_id")).addClass("select_guest"),$("#order_details_tbody_id_"+$(this).data("booking_id")).addClass("select_guest")),$('[id^="gd_guest_menu-"]').hide(),$("#gd_guest_menu-"+$(this).data("user_id")).show()}))})),$('[id^="gd_guest-"]').each((function(){var e=$(this).data("booking_id");$("#gd_guest-"+e+", #gd_guest_menu-"+e).hover((function(){$.doTimeout("guest_menu_timer_hide-"+e),$.doTimeout("guest_menu_timer_show-"+e,100,(function(){$("#gd_guest_menu-"+e).show()}))}),(function(){$.doTimeout("guest_menu_timer_show-"+e),$.doTimeout("guest_menu_timer_hide-"+e,150,(function(){$("#gd_guest_menu-"+e).hide()}))}))})),handle_cancel_order(),handle_delete_saved_order()}function handle_delete_saved_order(){$('[id^="gd_delete_order-"]').each((function(){$(this).on("click",(function(e){var s=$(this).data("session_id"),t=$(this).data("order_id"),o=$(this).data("store_id"),i=$(this).data("user_id"),_=$(this).data("bounce");dd_message({title:"Confirm Delete Saved Order",message:"Are you sure you want to delete this saved order?",confirm:function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:o,op:"delete_saved_order",session_id:s,user_id:i,order_id:t},success:function(e){e.processor_success?(void 0!==_&&""!=_||(_=window.location.href),bounce(_)):1==e.doRefresh?dd_message({title:"Problem Deleting Saved Order",message:e.processor_message,modal:!0,noOk:!0,closeOnEscape:!1,buttons:{Refresh:function(){$(this).remove(),bounce(window.location.href)}}}):dd_message({title:"Error",message:e.processor_message})},error:function(e,s){response="Unexpected error: "+s,dd_message({title:"Error",message:response})}})}})}))}))}function validateKey(e){if(e=e||(event||null)){var s=e.charCode||0==e.charCode?e.charCode:e.keyCode?e.keyCode:e.which;if(s>13&&(s<48||s>57)){if(46==s)return!0;if(e.returnValue)e.returnValue=!1;else{if(!e.preventDefault)return!1;e.preventDefault()}}}}function validateAmount(e,s){isNaN(e.value)&&(e.value=0),e.value>s&&(e.value=s)}function handle_cancel_order(){$('[id^="gd_cancel_order-"]').each((function(){$(this).on("click",(function(e){$(this).data("booking_id");var s=$(this).data("session_id"),t=$(this).data("order_id"),o=$(this).data("store_id"),i=$(this).data("user_id"),_=$(this).data("bounce");$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",op:"cancel_preflight",store_id:o,session_id:s,user_id:i,order_id:t},success:function(e,a){e.processor_success&&e.data?dd_message({title:"Cancel Order?",message:e.data,width:700,height:400,modal:!0,open:function(){$("#order_admin_notes_cancel").on("keyup",(function(e){$(this).val()!=strip_tags($(this).val())&&$(this).val(strip_tags($(this).val()))}))},confirm:function(e,a){var r={};$("#cancel_parent :input").each((function(){r[this.id]=$(this).val()}));var n=$("#order_admin_notes_cancel").val().trim();dd_message({title:"Cancelling order",message:'<img src="'+PATH.image_admin+'/style/throbber_circle.gif" class="img_valign" alt="Processing" /> Processing order cancellation...',div_id:"cancel_order",modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,s){$(this).parent().find(".ui-dialog-titlebar-close").hide()}}),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",op:"cancel",store_id:o,session_id:s,user_id:i,order_id:t,paymentList:r,order_notes:n},success:function(e){e.processor_success?dd_message({title:"Order was Canceled",message:e.data,div_id:"cancel_order",closeOnEscape:!1,modal:!0,noOk:!0,open:function(e,s){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{OK:function(){void 0!==_?bounce(_):bounce(removeQueryVariable("order",window.location.href))}}}):dd_message({title:"Error",message:e.processor_message})},error:function(e,s){response="Unexpected error: "+s,dd_message({title:"Error",message:response})}})}}):dd_message({title:"Error",message:e.processor_message})},error:function(e,s){response="Unexpected error: "+s,dd_message({title:"Error",message:response})}})}))}))}function handle_session_tools(){null!=$.totalStorage("suppress_fastlane_labels")&&(suppress_fastlane_labels=$.totalStorage("suppress_fastlane_labels"),$("#suppress_fastlane_labels").prop("checked",!suppress_fastlane_labels)),$("#suppress_fastlane_labels").on("click",(function(e){$(this).is(":checked")?($.totalStorage("suppress_fastlane_labels",!1),suppress_fastlane_labels=!1):($.totalStorage("suppress_fastlane_labels",!0),suppress_fastlane_labels=!0),update_session_tool_links()})),$("#ds_goal_tracking").on("click",(function(e){bounce("/backoffice/reports_goal_management_v2&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path())})),$("#ds_trending").on("click",(function(e){bounce("/backoffice/reports_trending_menu_based?date="+selected_date+"&store="+STORE_DETAILS.id+"&back="+back_path())})),$("#ds_dashboard").on("click",(function(e){bounce("/backoffice/dashboard-menu-based?override_month="+selected_date+"&store="+STORE_DETAILS.id+"&back="+back_path())})),$("#sd_edit_session").on("click",(function(e){1==view_session&&bounce("/backoffice/edit-session?session="+selected_session_id+"&back="+back_path())})),$("#sd_email_session").on("click",(function(e){1==view_session&&bounce("/backoffice/email?session="+selected_session_id+"&back="+back_path())})),$("#sd_publish_state").on("click",(function(e){1==view_session&&(state=$(this).data("session_publish_state"),"PUBLISHED"==state?new_state="Close":new_state="Open",dd_message({title:new_state+" session confirmation",message:'Are you sure you wish to <span style="font-weight: bold;">'+new_state+"</span> this session?",modal:!0,confirm:function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"session_publish_state",session_id:selected_session_id,open_close_submit:new_state},success:function(e){e.processor_success&&$("#session-"+selected_session_id).scrollToTarget($("#session_selector"))},error:function(e,s){response="Unexpected error"}})}}))})),$("#sd_session_meta").on("click",(function(e){$(".session_meta").toggle(),$("#session_details_text").toggleClass("session_details_text")})),$("#dd_create_session").on("click",(function(e){1!=view_session&&bounce("/backoffice/create-session?date="+selected_date+"&menu="+selected_menu_id+"&back="+back_path())}))}function update_session_tool_links(){1==view_session?($("#st_customer_receipt").prop("href","/backoffice/order-details-view-all?customer_print_view=1&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_franchise_receipt").prop("href","/backoffice/order-details-view-all?session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_entree_summary").prop("href","/backoffice/reports_select_multi_session?query_submit=1&report_id=2&printer=1&pickSession=2&session_id="+selected_session_id+"&back="+back_path()).prop("target","_blank"),$("#st_side_dish_report").prop("href","/backoffice/order-details-view-all?issidedish=1&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_fast_lane_report").prop("href","/backoffice/order-details-view-all?ispreassembled=1&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_dream_rewards").prop("href","/backoffice/reports_dream_rewards_for_session?session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_future_orders").prop("href","/backoffice/order-details-view-all_future?session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank"),$("#st_session_goal_sheet_print").prop("href","/backoffice/reports_goal_tracking?session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&report_submit=true&print=true&back="+back_path()).prop("target","_blank"),$("#st_session_goal_sheet_xls").prop("href","/backoffice/reports_goal_tracking?export=xlsx&hideheaders=true&csvfilename=SessionGoalSheet&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&report_submit=true&back="+back_path()),$("#st_print_labels").prop("href","/backoffice/reports_customer_menu_item_labels?session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank"),$("#st_print_labels_w_breaks").prop("href","/backoffice/reports_customer_menu_item_labels?session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&break=1&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank"),$("#st_print_labels_by_dinner").prop("href","/backoffice/reports_customer_menu_item_labels?session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&order_by=dinner&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank"),$("#st_print_enrollment_forms").prop("href","/backoffice/user_plate_points?session_id="+selected_session_id+"&print_sessions_forms=true").prop("target","_blank"),$("#st_plate_points_status_and_rewards_report").prop("href","/backoffice/reports_points_status_and_rewards?session_id="+selected_session_id+"&back="+back_path()),$("#st_customer_menu_core").prop("href","/backoffice/session-tools-printing?do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_core_current").prop("href","/backoffice/session-tools-printing?do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&cur=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_freezer").prop("href","/backoffice/session-tools-printing?do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&freezer=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_nutrition").prop("href","/backoffice/session-tools-printing?do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&nutrition=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_core_freezer").prop("href","/backoffice/session-tools-printing?do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_core_freezer_nutrition").prop("href","/backoffice/session-tools-printing?do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&nutrition=true&back="+back_path()).prop("target","_blank")):($("#st_customer_receipt").prop("href","/backoffice/order-details-view-all_multi?customer_print_view=1&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank"),$("#st_franchise_receipt").prop("href","/backoffice/order-details-view-all_multi?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank"),$("#st_entree_summary").prop("href","/backoffice/reports_select_multi_session?query_submit=1&report_date="+selected_date+"&report_id=1&printer=1&back="+back_path()).prop("target","_blank"),$("#st_side_dish_report").prop("href","/backoffice/order-details-view-all_multi?issidedish=1&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank"),$("#st_fast_lane_report").prop("href","/backoffice/order-details-view-all_multi?ispreassembled=1&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank"),$("#st_dream_rewards").prop("href","/backoffice/reports_dream_rewards_for_session_multi?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_future_orders").prop("href","/backoffice/order-details-view-all_future_multi?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank"),$("#st_session_goal_sheet_print").prop("href","/backoffice/reports_goal_tracking?multi_session="+selected_date+"&store_id="+STORE_DETAILS.id+"&report_submit=true&print=true&back="+back_path()).prop("target","_blank"),$("#st_session_goal_sheet_xls").prop("href","/backoffice/reports_goal_tracking?export=xlsx&hideheaders=true&csvfilename=SessionGoalSheetSummary&multi_session="+selected_date+"&store_id="+STORE_DETAILS.id+"&report_submit=true&back="+back_path()),$("#st_print_labels").prop("href","/backoffice/reports_customer_menu_item_labels_multi?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank"),$("#st_print_labels_w_breaks").prop("href","/backoffice/reports_customer_menu_item_labels_multi?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&break=1&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank"),$("#st_print_labels_by_dinner").prop("href","/backoffice/reports_customer_menu_item_labels_multi?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&order_by=dinner&back="+back_path()+"&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank"),$("#st_print_enrollment_forms").prop("href","/backoffice/user_plate_points?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&print_days_forms=true").prop("target","_blank"),$("#st_plate_points_status_and_rewards_report").prop("href","/backoffice/reports_points_status_and_rewards?report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()),$("#st_customer_menu_core").prop("href","/backoffice/session-tools-printing?do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_core_current").prop("href","/backoffice/session-tools-printing?do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&cur=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_freezer").prop("href","/backoffice/session-tools-printing?do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&freezer=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_nutrition").prop("href","/backoffice/session-tools-printing?do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&nutrition=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_core_freezer").prop("href","/backoffice/session-tools-printing?do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&back="+back_path()).prop("target","_blank"),$("#st_customer_menu_core_freezer_nutrition").prop("href","/backoffice/session-tools-printing?do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&nutrition=true&back="+back_path()).prop("target","_blank")),$("#st_finishing_touch_pick_sheet").prop("href","/backoffice/finishing-touch-printable-form?store_id="+STORE_DETAILS.id+"&menu_id="+selected_menu_id+"&back="+back_path()).prop("target","_blank"),$("#st_print_generic_labels").prop("href","/backoffice/reports_customer_menu_item_labels?store_id="+STORE_DETAILS.id+"&interface=1&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank")}function handle_order_search(){$("#os_search_go").on("click",(function(e){var s=$("#os_search_value").val().trim();bounce("/backoffice/order-details?order="+s)})),$("#os_search_type").on("change",(function(e){manualOrderSearchTypeChange=!0})),$("#os_search_value").on("keyup",(function(e){13==e.which&&$("#os_search_go").trigger("click"),detect_order_search_type()}))}function handle_guest_search(){$("#gs_search_go").on("click",(function(e){create_and_submit_form({method:"get",action:"/",input:{page:"admin_list_users",search_type:$("#gs_search_type").val(),all_stores:$("#gs_search_all").is(":checked")?1:0,q:$("#gs_search_value").val(),back:back_path()}})})),$("#gs_search_type").on("change",(function(e){manualSearchTypeChange=!0})),$("#gs_search_value").on("keyup",(function(e){13==e.which&&$("#gs_search_go").trigger("click"),detect_guest_search_type()}))}function detect_order_search_type(){if(1!=manualOrderSearchTypeChange){var e=$("#os_search_value").val();$.isNumeric(e)||$("#os_search_type").val("confirmation"),$.isNumeric(e)&&$("#os_search_type").val("id")}}function detect_guest_search_type(){if(1!=manualSearchTypeChange){var e=$("#gs_search_value").val();$.isNumeric(e)||$("#gs_search_type").val("lastname"),$.isNumeric(e)&&$("#gs_search_type").val("id"),-1!=e.indexOf("@")&&$("#gs_search_type").val("email"),-1!=e.indexOf(" ")&&$("#gs_search_type").val("firstlast")}}function handle_go_to_today(){$("#go_to_today").on("click",(function(e){go_to_today()}))}function go_to_today(){if(init_go_to_today=!0,date_select=get_todays_date().slice(0,-3),null!=selected_agenda_month&&selected_agenda_month!=date_select){let e=$("#month_selector option[data-menu_month='"+date_select+"']").val();$("#month_selector").val(e).trigger("change")}$(".selected").removeClass("selected");var e=get_todays_date();$("#day_"+e).scrollToTarget($("#session_selector")).addClass("selected"),init_go_to_today=!1}function handle_preselection(){getQueryVariable("session")&&$("#session-"+getQueryVariable("session")).length?$("#session-"+getQueryVariable("session")).scrollToTarget($("#session_selector")):getQueryVariable("day")&&$("#day_"+getQueryVariable("day")).length?$("#day_"+getQueryVariable("day")).scrollToTarget($("#session_selector")):go_to_today()}function confirm_order_attended(e,s){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"plate_points_processor",user_id:e,op:"confirm_order",order_id:s},success:function(t){t.processor_success?$("[id^=pp_co_"+e+"_"+s+"]").html(t.points_this_order):dd_message({title:"Error",message:t.processor_message})},error:function(e,s){response="Unexpected error: "+s}})}!function(e){e.fn.scrollToTarget=function(s,t){var o=e(this);if(o.length){var i=e(s).position().top,_=i+e(s).height(),a=e(o).position().top,r=a+e(o).height();a>i&&r<_||a<i&&r>_?o.trigger("click"):s.scrollTo(this,800,{offset:-25,onAfter:function(){o.trigger("click")}})}return o}}(jQuery);
//# sourceMappingURL=emergency_main.min.js.map
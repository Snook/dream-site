{"version":3,"names":["sidesDataArray","notShown","menu_editor_init","init_sales_mix_editing","init_week_inventory_editing","init_override_inventory_editing","init_inventory_calculation","init_saving_guest_counts","init_saving_store_sales_mix","init_resetting_store_sales_mix","init_finalize_preorder","init_save_sides_inventory","init_save_EFL_inventory","init_saving_override_inventory","init_saving_week_inventory","init_show_actuals","init_export_sales","init_reset_to_current","reconcile_data","calculatePage","initNavTab","$","stickyTableHeaders","menuState","hasSavedPreOrder","each","this","addClass","oldUrl","attr","newUrl","substring","indexOf","Proxy","URLSearchParams","window","location","search","get","searchParams","prop","tabs","on","data","bootbox","confirm","result","reload","hasDirtyFields","hasClass","message","dd_message","title","modal","width","height","url","gStore_ID","menu_id","weekNumber","id","split","weekStart","start","val","end","click","$header","$content","html","slideToggle","removeClass","overrideValues","thisInv","thisRecipe","displayModalWaitDialog","ajax","type","timeout","dataType","processor","op","store_id","success","json","remove","processor_success","curVal","processor_message","error","objAJAXRequest","strError","response","save_to_global","dd_round_amount","inAmount","tempVal","parseInt","Math","floor","validateSalesMix","sumPercents","newVal","alert","delta","abs","guidance","reconcile_weeks_to_monthly_projection","numSold","Number","valueOf","number_sold","thisVal","weekly_sum","USER_PREFERENCES","HAS_SEEN_ELEMENT","value","WEEKLY_INVENTORY_WARNING","closeCallback","is","set_user_pref","USER_DETAILS","preorderInventory","week1Inv","week2Inv","week3Inv","week4Inv","week5Inv","encounteredNegativeInventory","curNumberSold","recipeName","div_id","data_tooltips_init","numRegGuests","numTasteGuests","numIntroGuests","menu_anchor_date","thisWeek","preFlightResult","sumAndStoreOverrideInventory","week_number","preflight","hasNegativeInventory","badRecipe","thisMix","storeSalesMix","hasSavedStoreMix","starterPackMix","setNormalizedStarterPackMix","totalTastePercent","key","scaleFactor","workShopMix","setNormalizedWorkshopMix","not","isIntro","isTaste","total_servingsNeeded","round","weeksTotal","x","weekInfo","number","targetID","targetIDEditable","distributionPercent","thisProjection","resetPage","document","getElementById","submit","displayValidationErrorMsg","msg","clearErrors","style","display","statusTextDiv","innerHTML","storeChange","obj","menuChange","itemRows","rows","i","length","getAttribute","substr","EFL_itemRows","ctsItemRows","confirm_and_check_form","form","validated","_check_form","cancel"],"sourceRoot":"js/src/admin","sources":["menu_inv_mgr.js"],"sourcesContent":["let sidesDataArray = [];\r\nlet notShown = true;\r\n\r\nfunction menu_editor_init()\r\n{\r\n\tinit_sales_mix_editing();\r\n\tinit_week_inventory_editing();\r\n\tinit_override_inventory_editing();\r\n\tinit_inventory_calculation();\r\n\tinit_saving_guest_counts();\r\n\tinit_saving_store_sales_mix();\r\n\tinit_resetting_store_sales_mix();\r\n\tinit_finalize_preorder();\r\n\tinit_save_sides_inventory();\r\n\tinit_save_EFL_inventory();\r\n\tinit_saving_override_inventory();\r\n\tinit_saving_week_inventory();\r\n\tinit_show_actuals();\r\n\tinit_export_sales();\r\n\tinit_reset_to_current();\r\n\r\n\treconcile_data();\r\n\r\n\tcalculatePage();\r\n\r\n\tinitNavTab();\r\n\r\n\t$(\"#itemsTbl, #ctsItemsTbl\").stickyTableHeaders();\r\n\r\n\tif (!menuState.hasSavedPreOrder)\r\n\t{\r\n\t\t$(\"[id^='finalize_week_']\").each(function () {\r\n\t\t\t$(this).addClass('disabled');\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nfunction initNavTab()\r\n{\r\n\r\n\tvar oldUrl = $('#inv_mgr').attr(\"href\"); // Get current url\r\n\tvar newUrl = oldUrl.substring(0, oldUrl.indexOf('&tabs'));\r\n\tconst params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\tget: (searchParams, prop) => searchParams.get(prop)\r\n\t});\r\n\tnewUrl = newUrl + '&tabs=' + params.tabs;\r\n\t$('#inv_mgr').attr(\"href\", newUrl);\r\n\r\n\t$('.tab').each(function () {\r\n\t\t$(this).on('click', function () {\r\n\t\t\tvar oldUrl = $('#inv_mgr').attr(\"href\"); // Get current url\r\n\t\t\tvar newUrl = oldUrl.substring(0, oldUrl.indexOf('&tab'));\r\n\t\t\tnewUrl = newUrl + '&tabs=menu.' + $(this).data('tabid');\r\n\t\t\t$('#inv_mgr').attr(\"href\", newUrl);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction init_reset_to_current()\r\n{\r\n\t$(\"#reset_to_current\").on('click', function () {\r\n\t\tbootbox.confirm(\"Are you sure you wish to reset the Inventory Manager to last published values? You will lose any unsaved changes.\", function (result) {\r\n\t\t\tif (result)\r\n\t\t\t{\r\n\t\t\t\tlocation.reload();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n}\r\n\r\nfunction init_export_sales()\r\n{\r\n\t$(\"#export_menu_sales\").on('click', function () {\r\n\r\n\t\tlet hasDirtyFields = false;\r\n\t\t$(\"[id^='wta']\").each(function () {\r\n\r\n\t\t\tif ($(this).hasClass('dirty'))\r\n\t\t\t{\r\n\t\t\t\thasDirtyFields = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (!menuState.hasSavedPreOrder || hasDirtyFields)\r\n\t\t{\r\n\t\t\tlet message = \"\";\r\n\t\t\tif (!menuState.hasSavedPreOrder)\r\n\t\t\t{\r\n\t\t\t\tmessage = \"The Pre-Order has not been finalized. This export function will export values currently stored in the database.\";\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDirtyFields)\r\n\t\t\t{\r\n\t\t\t\tif (message == \"\")\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage = \"There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first.\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += \"There are also unsaved weekly projections. You may want to save these value first.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tmessage += \"<br /><br />Do you want to continue with the export?\";\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Export PreOrder',\r\n\t\t\t\tmessage: message,\r\n\t\t\t\tmodal: true,\r\n\t\t\t\twidth: 400,\r\n\t\t\t\theight: 300,\r\n\t\t\t\tconfirm: function () {\r\n\t\t\t\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_month_sales_projection&store=\" + gStore_ID + \"&menu_id=\" + menu_id;\r\n\t\t\t\t\twindow.location = url;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_month_sales_projection&store=\" + gStore_ID + \"&menu_id=\" + menu_id;\r\n\t\t\twindow.location = url;\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"[id^='export_week_']\").on('click', function () {\r\n\r\n\t\tlet weekNumber = this.id.split(\"_\")[2];\r\n\t\tlet hasDirtyFields = false;\r\n\t\t$(\"[id^='wta\" + weekNumber + \"']\").each(function () {\r\n\r\n\t\t\tif ($(this).hasClass('dirty'))\r\n\t\t\t{\r\n\t\t\t\thasDirtyFields = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (!menuState.hasSavedPreOrder || hasDirtyFields)\r\n\t\t{\r\n\t\t\tlet message = \"\";\r\n\r\n\t\t\tif (!menuState.hasSavedPreOrder)\r\n\t\t\t{\r\n\t\t\t\tmessage = \"The Pre-Order has not been finalized. This export function will export values currently stored in the database.\";\r\n\t\t\t}\r\n\t\t\tif (hasDirtyFields)\r\n\t\t\t{\r\n\t\t\t\tif (message == \"\")\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage = \"There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first.\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += \"There are also unsaved weekly projections. You may want to save these value first.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tmessage += \"<br /><br />Do you want to continue with the export?\";\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Export PreOrder',\r\n\t\t\t\tmessage: message,\r\n\t\t\t\tmodal: true,\r\n\t\t\t\twidth: 400,\r\n\t\t\t\theight: 300,\r\n\t\t\t\tconfirm: function () {\r\n\r\n\t\t\t\t\tlet weekStart = $(this).data(\"week_start\");\r\n\t\t\t\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_weekly_sales&store=\" + gStore_ID + \"&weekStart=\" + weekStart + \"&menu_id=\" + menu_id;\r\n\t\t\t\t\twindow.location = url;\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlet weekStart = $(this).data(\"week_start\");\r\n\t\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_weekly_sales&store=\" + gStore_ID + \"&weekStart=\" + weekStart + \"&menu_id=\" + menu_id;\r\n\t\t\twindow.location = url;\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"[id^='export_by_range']\").on('click', function () {\r\n\r\n\t\tlet weekNumber = this.id.split(\"_\")[2];\r\n\t\tlet hasDirtyFields = false;\r\n\t\t$(\"[id^='wta\" + weekNumber + \"']\").each(function () {\r\n\r\n\t\t\tif ($(this).hasClass('dirty'))\r\n\t\t\t{\r\n\t\t\t\thasDirtyFields = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (!menuState.hasSavedPreOrder || hasDirtyFields)\r\n\t\t{\r\n\t\t\tlet message = \"\";\r\n\r\n\t\t\tif (!menuState.hasSavedPreOrder)\r\n\t\t\t{\r\n\t\t\t\tmessage = \"The Pre-Order has not been finalized. This export function will export values currently stored in the database.\";\r\n\t\t\t}\r\n\t\t\tif (hasDirtyFields)\r\n\t\t\t{\r\n\t\t\t\tif (message == \"\")\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage = \"There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first.\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmessage += \"There are also unsaved weekly projections. You may want to save these value first.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tmessage += \"<br /><br />Do you want to continue with the export?\";\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Export PreOrder By Range',\r\n\t\t\t\tmessage: message,\r\n\t\t\t\tmodal: true,\r\n\t\t\t\twidth: 400,\r\n\t\t\t\theight: 300,\r\n\t\t\t\tconfirm: function () {\r\n\r\n\t\t\t\t\tlet start = $(\"[name='range_day_start']\").val();\r\n\t\t\t\t\tlet end = $(\"[name='range_day_end']\").val();\r\n\t\t\t\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_sales_by_range&store=\" + gStore_ID + \"&start=\" + start + \"&end=\" + end + \"&menu_id=\" + menu_id;\r\n\t\t\t\t\twindow.location = url;\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tlet start = $(\"[name='range_day_start']\").val();\r\n\t\t\tlet end = $(\"[name='range_day_end']\").val();\r\n\t\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_sales_by_range&store=\" + gStore_ID + \"&start=\" + start + \"&end=\" + end + \"&menu_id=\" + menu_id;\r\n\t\t\twindow.location = url;\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#export_EFL_sales\").on('click', function () {\r\n\r\n\t\tlet url = \"main.php?page=admin_menu_inventory_mgr&op=export_EFL_sales&store=\" + gStore_ID + \"&menu_id=\" + menu_id;\r\n\t\twindow.location = url;\r\n\t});\r\n\r\n\t$(\".expand_export\").click(function () {\r\n\t\t$header = $(this);\r\n\t\t$content = $(\"#export_by_dates\");\r\n\t\t$header.html(function () {\r\n\t\t\treturn \"<span class='button'>Export By Date</span>\";\r\n\t\t});\r\n\t\t$content.slideToggle(500, function () {\r\n\t\t});\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction init_show_actuals()\r\n{\r\n\t$(\"#show_actuals\").on('click', function () {\r\n\r\n\t\tlet btn_name = $(this).html();\r\n\r\n\t\tif (btn_name == 'View Servings Sold')\r\n\t\t{\r\n\t\t\t$(this).html(\"Hide Servings Sold\");\r\n\r\n\t\t\t$(\"[id^='tr_act_']\").each(function () {\r\n\t\t\t\tlet thisInv = $(this).val();\r\n\t\t\t\tlet thisRecipe = this.id.split(\"_\")[2];\r\n\t\t\t\t$(this).removeClass('collapse');\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).html(\"View Servings Sold\");\r\n\r\n\t\t\t$(\"[id^='tr_act_']\").each(function () {\r\n\t\t\t\tlet thisInv = $(this).val();\r\n\t\t\t\tlet thisRecipe = this.id.split(\"_\")[2];\r\n\t\t\t\t$(this).addClass('collapse');\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction init_save_EFL_inventory()\r\n{\r\n\t$(\"#save_efl_inv\").on('click', function () {\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize PreOrder',\r\n\t\t\tmessage: \"Are you sure you wish to save EFL Available to Promise inventory?\",\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: 180,\r\n\t\t\tconfirm: function () {\r\n\r\n\t\t\t\tlet overrideValues = {};\r\n\r\n\t\t\t\t$(\"[id^='ofi_']\").each(function () {\r\n\r\n\t\t\t\t\tlet thisInv = $(this).val();\r\n\t\t\t\t\tlet thisRecipe = this.id.split(\"_\")[1];\r\n\r\n\t\t\t\t\toverrideValues[thisRecipe] = thisInv;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdisplayModalWaitDialog('MIM_progress', \"Saving EFL Inventory ...\");\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\top: 'save_override_inventory',\r\n\t\t\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\t\t\toverrideValues: overrideValues\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\r\n\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$(\"[id^='ofi_']\").each(function () {\r\n\t\t\t\t\t\t\t\t$(this).removeClass('unsaved');\r\n\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\tlet curVal = $(this).val() * 1;\r\n\t\t\t\t\t\t\t\t$(this).data('org_val', curVal);\r\n\t\t\t\t\t\t\t\t$(this).removeClass('dirty');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\r\n\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n}\r\n\r\nfunction init_save_sides_inventory()\r\n{\r\n\t$(\"#save_sides_inv\").on('click', function () {\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize PreOrder',\r\n\t\t\tmessage: \"Are you sure you wish to save Sides Available to Promise inventory?\",\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: 150,\r\n\t\t\tconfirm: function () {\r\n\r\n\t\t\t\tvar overrideValues = {};\r\n\r\n\t\t\t\t$(\"[id^='ori_']\").each(function () {\r\n\r\n\t\t\t\t\tvar thisInv = $(this).val();\r\n\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\r\n\t\t\t\t\toverrideValues[thisRecipe] = thisInv;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdisplayModalWaitDialog('MIM_progress', \"Saving Sides Inventory ...\");\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\top: 'save_override_inventory',\r\n\t\t\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\t\t\toverrideValues: overrideValues,\r\n\t\t\t\t\t\tsave_to_global: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\r\n\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$(\"[id^='ori_']\").each(function () {\r\n\t\t\t\t\t\t\t\t$(this).removeClass('unsaved');\r\n\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\tvar curVal = $(this).val() * 1;\r\n\t\t\t\t\t\t\t\t$(this).data('org_val', curVal);\r\n\t\t\t\t\t\t\t\t$(this).removeClass('dirty');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\r\n\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction dd_round_amount(inAmount)\r\n{\r\n\tinAmount += .000005;\r\n\r\n\tvar tempVal = inAmount * 1000.0;\r\n\ttempVal = parseInt(tempVal);\r\n\ttempVal = tempVal / 10;\r\n\tvar pennyFraction = tempVal - Math.floor(tempVal);\r\n\tif (pennyFraction >= .5)\r\n\t{\r\n\t\ttempVal = Math.floor(tempVal) + 1;\r\n\t}\r\n\telse\r\n\t{\r\n\t\ttempVal = Math.floor(tempVal);\r\n\t}\r\n\r\n\treturn tempVal / 100;\r\n}\r\n\r\nfunction validateSalesMix()\r\n{\r\n\tvar sumPercents = 0;\r\n\t$(\"[id^='ssmx_']\").each(function () {\r\n\t\tvar newVal = dd_round_amount($(this).val() * 1);\r\n\t\tsumPercents += newVal;\r\n\t\tsumPercents = dd_round_amount(sumPercents);\r\n\t\tif (sumPercents > 10000)\r\n\t\t{\r\n\t\t\talert(\"Invalid entry\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\tif (sumPercents * 100 != 10000)\r\n\t{\r\n\t\tvar delta = dd_round_amount(Math.abs(sumPercents - 100.0));\r\n\t\tvar guidance = \"\";\r\n\t\tif (sumPercents > 100.0)\r\n\t\t{\r\n\t\t\tguidance += \"Remove a total of \" + delta + \" from one more items to establish a 100.0% total\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tguidance += \"Add a total of \" + delta + \" from one more items to establish a 100.0% total\";\r\n\t\t}\r\n\r\n\t\t$(\"#page_error_display\").html(\"The Store Sales Mix does not equal 100% (\" + sumPercents + \"). <br />\" + guidance);\r\n\t\treturn false;\r\n\t}\r\n\r\n\t$(\"#page_error_display\").html(\"\");\r\n\treturn true;\r\n}\r\n\r\nfunction init_week_inventory_editing()\r\n{\r\n\t$(\"[id^='wta']\").on('change', function () {\r\n\t\tvar orgVal = $(this).data(\"org_val\") * 1;\r\n\t\tvar curVal = $(this).val() * 1;\r\n\t\tif (orgVal != curVal)\r\n\t\t{\r\n\t\t\t$(this).addClass('dirty');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('dirty');\r\n\t\t}\r\n\t\treconcile_weeks_to_monthly_projection();\r\n\t});\r\n\r\n}\r\n\r\nfunction init_override_inventory_editing()\r\n{\r\n\t// Core\r\n\t/*\r\n\t$(\"[id^='ovi_']\").on('change', function () {\r\n\t\tvar orgVal = $(this).data(\"org_val\") * 1;\r\n\t\tvar curVal = $(this).val() * 1;\r\n\t\tif (orgVal != curVal)\r\n\t\t{\r\n\t\t\t$(this).addClass('dirty');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('dirty');\r\n\t\t}\r\n\r\n\t\tvar numSold = Number($(this).data('numsold'));\r\n\t\tif ($(this).val() < numSold)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'The Override Inventory must be greater than or equal to the number of future pickups.'\r\n\t\t\t});\r\n\r\n\t\t\t$(this).val(numSold);\r\n\t\t}\r\n\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t$(\"#ri_\" + thisRecipe).html($(this).val() - numSold.valueOf());\r\n\r\n\t});\r\n*/\r\n\t// EFL\r\n\t$(\"[id^='ofi_']\").on('change', function () {\r\n\t\tvar orgVal = $(this).data(\"org_val\") * 1;\r\n\t\tvar curVal = $(this).val() * 1;\r\n\t\tif (orgVal != curVal)\r\n\t\t{\r\n\t\t\t$(this).addClass('dirty');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('dirty');\r\n\t\t}\r\n\r\n\t\tvar numSold = Number($(this).data('numsold'));\r\n\t\tif ($(this).val() < numSold)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'The Override Inventory must be greater than or equal to the number sold.'\r\n\t\t\t});\r\n\t\t\t$(this).val(numSold);\r\n\t\t}\r\n\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t$(\"#atos_\" + thisRecipe).html($(this).val() - numSold.valueOf());\r\n\r\n\t});\r\n\r\n\t//sides\r\n\t$(\"[id^='ori_']\").on('change', function () {\r\n\t\tvar orgVal = $(this).data(\"org_val\") * 1;\r\n\t\tvar curVal = $(this).val() * 1;\r\n\t\tif (orgVal != curVal)\r\n\t\t{\r\n\t\t\t$(this).addClass('dirty');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('dirty');\r\n\t\t}\r\n\r\n\t\tvar number_sold = Number($(this).data('number_sold'));\r\n\t\tif ($(this).val() < number_sold)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'The Override Inventory must be greater than or equal to the number sold.'\r\n\t\t\t});\r\n\r\n\t\t\t$(this).val(number_sold);\r\n\t\t}\r\n\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t$(\"#atos_\" + thisRecipe).html($(this).val() - number_sold.valueOf());\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction reconcile_data()\r\n{\r\n\t// detect total mix <> 100%\r\n\tvalidateSalesMix();\r\n\treconcile_weeks_to_monthly_projection();\r\n}\r\n\r\nfunction reconcile_weeks_to_monthly_projection()\r\n{\r\n\t$(\"[id^='poi_']\").each(function () {\r\n\t\t// check for zero inventory\r\n\t\tvar thisVal = $(this).html();\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\r\n\t\tvar weekly_sum = ($(\"#wta1_\" + thisRecipe).val() * 1) + ($(\"#wta2_\" + thisRecipe).val() * 1) + ($(\"#wta3_\" + thisRecipe).val() * 1) + ($(\"#wta4_\" + thisRecipe).val() * 1);\r\n\r\n\t\tif ($(\"#wta5_\" + thisRecipe)[0])\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta5_\" + thisRecipe).val()) * 1;\r\n\t\t}\r\n\r\n\t\t$(\"#pwt_\" + thisRecipe).html(weekly_sum);\r\n\t\tvar numSold = Number($(\"#ovi_\" + thisRecipe).data('numsold'));\r\n\r\n\t\tif (weekly_sum == 0)\r\n\t\t{\r\n\t\t\tweekly_sum = ($(\"#cur_adj_inv_\" + thisRecipe).data('default_inventory') * 1);\r\n\t\t}\r\n\r\n\t\t$(\"#cur_adj_inv_\" + thisRecipe).html(weekly_sum);\r\n\t\t$(\"#cur_rmg_\" + thisRecipe).html(weekly_sum - numSold.valueOf());\r\n\r\n\t\tif (weekly_sum != thisVal && weekly_sum != 0)\r\n\t\t{\r\n\t\t\tlet huh = USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING;\r\n\t\t\tif (!USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING)\r\n\t\t\t{\r\n\r\n\t\t\t\tlet variance_msg = \"The entered servings number for a particular menu item have deviated from the original preordered amount. Please note that deviations from the preorder can create excess or a shortage of inventory. If you have exceeded your preorder, please contact your AE to secure adequate inventory. By clicking 'Okay' you are acknowledging this information.\";\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Variance from Pre-order',\r\n\t\t\t\t\tmessage: \"<div>\" + variance_msg + \"</div><div style='margin:5px;'><input type='checkbox' id='WEEKLY_INVENTORY_WARNING' name='WEEKLY_INVENTORY_WARNING' />&nbsp;<label for='WEEKLY_INVENTORY_WARNING'>Do not show this warning.</label></div>\",\r\n\t\t\t\t\tcloseCallback: function () {\r\n\t\t\t\t\t\tif ($(\"#WEEKLY_INVENTORY_WARNING\").is(\":checked\"))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tUSER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING = 1;\r\n\t\t\t\t\t\t\tset_user_pref('HAS_SEEN_ELEMENT', USER_PREFERENCES.HAS_SEEN_ELEMENT.value, USER_DETAILS.id, null)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t$(this).addClass(\"warning_text\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass(\"warning_text\");\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction init_finalize_preorder()\r\n{\r\n\t$(\"#finalize_preorder\").on('click', function () {\r\n\r\n\t\t$(\"[id^='poi_']\").each(function () {\r\n\t\t\t// check for zero inventory\r\n\t\t\tvar thisVal = $(this).html();\r\n\t\t\tif (thisVal == '0')\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: \"<h4>Zero Projected Inventory Encountered</h4> Please be sure that all items have a non-zero sales mix or that you have clicked the 'Calculate Projected Inventory' Button.\"\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize PreOrder',\r\n\t\t\tmessage: \"Are you sure you wish to Finalize the Pre-Order Projected  Inventory?\",\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: 150,\r\n\t\t\tconfirm: function () {\r\n\t\t\t\tvar preorderInventory = {};\r\n\t\t\t\tvar week1Inv = {};\r\n\t\t\t\tvar week2Inv = {};\r\n\t\t\t\tvar week3Inv = {};\r\n\t\t\t\tvar week4Inv = {};\r\n\t\t\t\tvar week5Inv = {};\r\n\r\n\t\t\t\tvar encounteredNegativeInventory = false;\r\n\t\t\t\tvar thisVal = null;\r\n\t\t\t\tvar thisRecipe = null;\r\n\t\t\t\tvar curNumberSold = null;\r\n\t\t\t\tvar recipeName = null;\r\n\t\t\t\t$(\"[id^='pwt_']\").each(function () {\r\n\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\tthisVal = $(this).html();\r\n\t\t\t\t\tthisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\tpreorderInventory[thisRecipe] = thisVal;\r\n\r\n\t\t\t\t\tcurNumberSold = $(\"#ovi_\" + thisRecipe).data(\"numsold\");\r\n\r\n\t\t\t\t\tif (curNumberSold > thisVal && !encounteredNegativeInventory)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trecipeName = $(\"#rname_\" + thisRecipe).html();\r\n\t\t\t\t\t\tencounteredNegativeInventory = true;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (encounteredNegativeInventory)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: \"Error\",\r\n\t\t\t\t\t\tdiv_id: \"neg_warn\",\r\n\t\t\t\t\t\theight: 300,\r\n\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\tmessage: \"Recipe \" + recipeName + \" (ID \" + thisRecipe + \") has currently sold \" + curNumberSold + \" servings and the projected amount is less than that.\" +\r\n\t\t\t\t\t\t\t\" This would create negative inventory.  Please increase the projection.\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"[id^='wta1_']\").each(function () {\r\n\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t\tweek1Inv[thisRecipe] = thisVal;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$(\"[id^='wta2_']\").each(function () {\r\n\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t\tweek2Inv[thisRecipe] = thisVal;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$(\"[id^='wta3_']\").each(function () {\r\n\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t\tweek3Inv[thisRecipe] = thisVal;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$(\"[id^='wta4_']\").each(function () {\r\n\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t\tweek4Inv[thisRecipe] = thisVal;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// TODO: make conditional\r\n\t\t\t\t\t$(\"[id^='wta5_']\").each(function () {\r\n\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t\tweek5Inv[thisRecipe] = thisVal;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdisplayModalWaitDialog('MIM_progress', \"Finalizing Core Menu Projections ...\");\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\t\top: 'save_preorder_inventory',\r\n\t\t\t\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\t\t\t\tpreorderInventory: preorderInventory,\r\n\t\t\t\t\t\t\tweek1Inv: week1Inv,\r\n\t\t\t\t\t\t\tweek2Inv: week2Inv,\r\n\t\t\t\t\t\t\tweek3Inv: week3Inv,\r\n\t\t\t\t\t\t\tweek4Inv: week4Inv,\r\n\t\t\t\t\t\t\tweek5Inv: week5Inv\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\t$(\"[id^='finalize_week_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('disabled');\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_poi_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_even')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_even');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_pwt_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_odd')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_odd');\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_wt1_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_even')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_even');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta1_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('unsaved')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_wt2_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_even')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_even');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta2_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('unsaved')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_wt3_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_even')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_even');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta3_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('unsaved')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_wt4_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_even')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_even');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta4_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('unsaved')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='td_wt5_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('static_unsaved_even')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('static_saved_even');\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta5_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('unsaved')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"[id^='ovi_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\t$(this).removeClass('unsaved')\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// update Cur Inventory/Remaining and hidden vals\r\n\t\t\t\t\t\t\t\t$(\"[id^='pwt_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\t// check for zero inventory\r\n\t\t\t\t\t\t\t\t\tvar thisVal = $(this).html();\r\n\t\t\t\t\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t\t\t\t\t$(\"#cur_adj_inv_\" + thisRecipe).html(thisVal);\r\n\t\t\t\t\t\t\t\t\t$(\"#cur_adj_inv_\" + thisRecipe).data(\"default_inventory\", thisVal);\r\n\t\t\t\t\t\t\t\t\tvar numSold = $(\"#ovi_\" + thisRecipe).data(\"numsold\");\r\n\t\t\t\t\t\t\t\t\t$(\"#cur_rmg_\" + thisRecipe).html(thisVal - numSold);\r\n\t\t\t\t\t\t\t\t\t$(\"#ovi_\" + thisRecipe).val(thisVal);\r\n\t\t\t\t\t\t\t\t\t$(\"#ovi_\" + thisRecipe).data(\"org_val\", thisVal);\r\n\t\t\t\t\t\t\t\t\t$(\"#pts-td_\" + thisRecipe).data(\"tooltip\", 'Stored inventory: ' + thisVal + ' Remaining: ' + (thisVal - numSold));\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tdata_tooltips_init();\r\n\r\n\t\t\t\t\t\t\t\t// update org_val\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta1_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\t\t\t\t$(this).data(\"org_val\", thisVal)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta2_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\t\t\t\t$(this).data(\"org_val\", thisVal)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta3_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\t\t\t\t$(this).data(\"org_val\", thisVal)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta4_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\t\t\t\t$(this).data(\"org_val\", thisVal)\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t// TODO: make conditional\r\n\t\t\t\t\t\t\t\t$(\"[id^='wta5_']\").each(function () {\r\n\t\t\t\t\t\t\t\t\tvar thisVal = $(this).val();\r\n\t\t\t\t\t\t\t\t\t$(this).data(\"org_val\", thisVal)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction init_saving_guest_counts()\r\n{\r\n\t$(\"#save_guest_counts\").on('click', function () {\r\n\r\n\t\tvar numRegGuests = $(\"#regular_guest_count_goal\").val();\r\n\t\tvar numTasteGuests = $(\"#taste_guest_count_goal\").val();\r\n\t\tvar numIntroGuests = $(\"#intro_guest_count_goal\").val();\r\n\r\n\t\tdisplayModalWaitDialog('MIM_progress', \"Saving  Guest Count Projections ...\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\top: 'save_guest_counts',\r\n\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\tmenu_anchor_date: menu_anchor_date,\r\n\t\t\t\tnumRegGuests: numRegGuests,\r\n\t\t\t\tnumTasteGuests: numTasteGuests,\r\n\t\t\t\tnumIntroGuests: numIntroGuests\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#regular_guest_count_goal\").removeClass('unsaved');\r\n\t\t\t\t\t$(\"#regular_guest_count_goal\").addClass('saved');\r\n\t\t\t\t\t$(\"#intro_guest_count_goal\").removeClass('unsaved');\r\n\t\t\t\t\t$(\"#intro_guest_count_goal\").addClass('saved');\r\n\t\t\t\t\t$(\"#taste_guest_count_goal\").removeClass('unsaved');\r\n\t\t\t\t\t$(\"#taste_guest_count_goal\").addClass('saved');\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction init_saving_week_inventory()\r\n{\r\n\t$(\"[id^='finalize_week_']\").on('click', function () {\r\n\r\n\t\tif ($(this).hasClass('disabled'))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar thisWeek = this.id.split(\"_\")[2];\r\n\r\n\t\tvar preFlightResult = sumAndStoreOverrideInventory(thisWeek, true);\r\n\r\n\t\tif (preFlightResult !== false)\r\n\t\t{\r\n\t\t\tvar thisRecipe = preFlightResult[0];\r\n\t\t\tvar curNumberSold = preFlightResult[1];\r\n\t\t\tvar recipeName = $(\"#rname_\" + thisRecipe).html();\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: \"Error\",\r\n\t\t\t\tdiv_id: \"neg_warn\",\r\n\t\t\t\theight: 300,\r\n\t\t\t\tmodal: true,\r\n\t\t\t\tmessage: \"Recipe \" + recipeName + \" (ID \" + thisRecipe + \") has currently sold \" + curNumberSold + \" servings and the projected amount is less than that.\" +\r\n\t\t\t\t\t\" This would create negative inventory.  Please increase the projection.\"\r\n\t\t\t});\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize Week',\r\n\t\t\tmessage: \"Are you sure you wish to Finalize the Weekly Projected Inventory for week\" + thisWeek + \"?<br /><br />(This will increase the Available to Promise total that controls availability on your menus.)\",\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: 150,\r\n\t\t\tconfirm: function () {\r\n\r\n\t\t\t\tvar overrideValues = {};\r\n\r\n\t\t\t\t$(\"[id^='wta\" + thisWeek + \"_']\").each(function () {\r\n\r\n\t\t\t\t\tvar thisInv = $(this).val();\r\n\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\r\n\t\t\t\t\toverrideValues[thisRecipe] = thisInv;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdisplayModalWaitDialog('MIM_progress', \"Saving Week \" + thisWeek + \" Inventory ...\");\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\top: 'finalize_week',\r\n\t\t\t\t\t\tweek_number: thisWeek,\r\n\t\t\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\t\t\toverrideValues: overrideValues\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$(\"[id^='wta\" + thisWeek + \"_']\").each(function () {\r\n\t\t\t\t\t\t\t\t$(this).removeClass('unsaved');\r\n\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\tvar curVal = $(this).val() * 1;\r\n\t\t\t\t\t\t\t\t$(this).data('org_val', curVal);\r\n\t\t\t\t\t\t\t\t$(this).removeClass('dirty');\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tsumAndStoreOverrideInventory(thisWeek, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction sumAndStoreOverrideInventory(thisWeek, preflight)\r\n{\r\n\tvar overrideValues = {};\r\n\r\n\t$(\"[id^='poi_']\").each(function () {\r\n\t\t// check for zero inventory\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\tvar weekly_sum = 0;\r\n\r\n\t\tif (thisWeek == 1)\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta1_\" + thisRecipe).val() * 1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta1_\" + thisRecipe).data(\"org_val\") * 1);\r\n\t\t}\r\n\t\tif (thisWeek == 2)\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta2_\" + thisRecipe).val() * 1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta2_\" + thisRecipe).data(\"org_val\") * 1);\r\n\t\t}\r\n\t\tif (thisWeek == 3)\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta3_\" + thisRecipe).val() * 1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta3_\" + thisRecipe).data(\"org_val\") * 1);\r\n\t\t}\r\n\r\n\t\tif (thisWeek == 4)\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta4_\" + thisRecipe).val() * 1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tweekly_sum += ($(\"#wta4_\" + thisRecipe).data(\"org_val\") * 1);\r\n\t\t}\r\n\r\n\t\tif ($(\"#wta5_\" + thisRecipe)[0])\r\n\t\t{\r\n\t\t\tif (thisWeek == 5)\r\n\t\t\t{\r\n\t\t\t\tweekly_sum += ($(\"#wta5_\" + thisRecipe).val() * 1);\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tweekly_sum += ($(\"#wta5_\" + thisRecipe).data(\"org_val\") * 1);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\toverrideValues[thisRecipe] = weekly_sum;\r\n\r\n\t\tvar numSold = Number($(\"#ovi_\" + thisRecipe).data('numsold'));\r\n\t\t$(\"cur_rmg_\" + thisRecipe).html(weekly_sum - numSold.valueOf());\r\n\r\n\t});\r\n\r\n\tif (preflight)\r\n\t{\r\n\t\tvar hasNegativeInventory = false;\r\n\t\tvar badRecipe = null;\r\n\t\tvar numSold = null;\r\n\t\t$(\"[id^='ovi_']\").each(function () {\r\n\t\t\tbadRecipe = this.id.split(\"_\")[1];\r\n\t\t\tvar newVal = overrideValues[badRecipe];\r\n\t\t\tnumSold = $(this).data(\"numsold\");\r\n\r\n\t\t\tif (numSold > newVal)\r\n\t\t\t{\r\n\t\t\t\thasNegativeInventory = true;\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (hasNegativeInventory)\r\n\t\t{\r\n\t\t\treturn [\r\n\t\t\t\tbadRecipe,\r\n\t\t\t\tnumSold\r\n\t\t\t];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tdisplayModalWaitDialog('MIM_progress', \"Saving Override Inventory ...\");\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\top: 'save_override_inventory',\r\n\t\t\tstore_id: gStore_ID,\r\n\t\t\tmenu_id: menu_id,\r\n\t\t\toverrideValues: overrideValues\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$(\"[id^='ovi_']\").each(function () {\r\n\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\tvar newVal = overrideValues[thisRecipe];\r\n\t\t\t\t\t$(this).data('org_val', newVal);\r\n\t\t\t\t\t$(this).val(newVal);\r\n\t\t\t\t\t$(\"#cur_adj_inv_\" + thisRecipe).html(newVal);\r\n\t\t\t\t\tvar numSold = $(this).data(\"numsold\");\r\n\t\t\t\t\t$(\"#cur_rmg_\" + thisRecipe).html(newVal - numSold);\r\n\t\t\t\t\t$(\"#pts-td_\" + thisRecipe).data(\"tooltip\", 'Stored inventory: ' + newVal + ' Remaining: ' + (newVal - numSold));\r\n\t\t\t\t\t$(\"#cur_adj_inv_\" + thisRecipe).data(\"default_inventory\", newVal);\r\n\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction init_saving_override_inventory()\r\n{\r\n\t$(\"#save_override_inventory\").on('click', function () {\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize PreOrder',\r\n\t\t\tmessage: \"Are you sure you wish to save the Core Menu Available to Promise inventory?\",\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: 150,\r\n\t\t\tconfirm: function () {\r\n\r\n\t\t\t\tvar overrideValues = {};\r\n\r\n\t\t\t\t$(\"[id^='ovi_']\").each(function () {\r\n\r\n\t\t\t\t\tvar thisInv = $(this).val();\r\n\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\r\n\t\t\t\t\toverrideValues[thisRecipe] = thisInv;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdisplayModalWaitDialog('MIM_progress', \"Saving Core Inventory ...\");\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\t\t\top: 'save_override_inventory',\r\n\t\t\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\t\t\toverrideValues: overrideValues\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$(\"[id^='ovi_']\").each(function () {\r\n\t\t\t\t\t\t\t\t$(this).removeClass('unsaved');\r\n\t\t\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\t\t\tvar curVal = $(this).val() * 1;\r\n\t\t\t\t\t\t\t\t$(this).data('org_val', curVal);\r\n\t\t\t\t\t\t\t\t$(this).removeClass('dirty');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction init_resetting_store_sales_mix()\r\n{\r\n\t$(\"#reset_sales_mix\").on('click', function () {\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize Week',\r\n\t\t\tmessage: \"Are you sure you want to reset your store's sales mix to national values?\",\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: 150,\r\n\t\t\tconfirm: function () {\r\n\r\n\t\t\t\t$(\"[id^='nsm_']\").each(function () {\r\n\r\n\t\t\t\t\tvar thisMix = $(this).html();\r\n\t\t\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\t\t\t$(\"#ssmx_\" + thisRecipe).val(thisMix);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvalidateSalesMix();\r\n\r\n\t\t\t\t$(\"[id^='ssmx_']\").each(function () {\r\n\t\t\t\t\tvar orgVal = $(this).data(\"org_val\") * 1;\r\n\t\t\t\t\tvar curVal = $(this).val() * 1;\r\n\t\t\t\t\tif (orgVal != curVal)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(this).addClass('dirty');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(this).removeClass('dirty');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction init_saving_store_sales_mix()\r\n{\r\n\t$(\"#save_sales_mix\").on('click', function () {\r\n\r\n\t\tvar storeSalesMix = {};\r\n\r\n\t\t$(\"[id^='ssmx_']\").each(function () {\r\n\r\n\t\t\tvar thisMix = $(this).val();\r\n\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\r\n\t\t\tstoreSalesMix[thisRecipe] = thisMix;\r\n\t\t});\r\n\r\n\t\tdisplayModalWaitDialog('MIM_progress', \"Saving Store Sales Mix  ...\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_menuEditor',\r\n\t\t\t\top: 'save_store_sales_mix',\r\n\t\t\t\tstore_id: gStore_ID,\r\n\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\tstoreSalesMix: storeSalesMix\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"[id^='ssmx_']\").each(function () {\r\n\t\t\t\t\t\t$(this).removeClass('unsaved');\r\n\t\t\t\t\t\t$(this).addClass('saved');\r\n\t\t\t\t\t\tvar curVal = $(this).val() * 1;\r\n\t\t\t\t\t\t$(this).data('org_val', curVal);\r\n\t\t\t\t\t\t$(this).removeClass('dirty');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tmenuState.hasSavedStoreMix = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$(\"#MIM_progress\").remove();\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nlet starterPackMix = {};\r\n\r\nfunction setNormalizedStarterPackMix()\r\n{\r\n\r\n\t$(\"[id^='ssmx_']\").each(function () {\r\n\t\tvar thisMix = $(this).val() / 100.0;\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\tvar isIntro = $(this).data('is_intro');\r\n\r\n\t\tif (isIntro)\r\n\t\t{\r\n\t\t\tstarterPackMix[thisRecipe] = thisMix;\r\n\t\t}\r\n\t});\r\n\r\n\tlet totalTastePercent = 0.0;\r\n\tfor (let key in starterPackMix)\r\n\t{\r\n\t\ttotalTastePercent += starterPackMix[key];\r\n\t}\r\n\r\n\tlet scaleFactor = 1.0 / totalTastePercent;\r\n\r\n\tfor (let key in starterPackMix)\r\n\t{\r\n\t\tstarterPackMix[key] = starterPackMix[key] * scaleFactor;\r\n\t}\r\n}\r\n\r\nlet workShopMix = {};\r\n\r\nfunction setNormalizedWorkshopMix()\r\n{\r\n\r\n\t$(\"[id^='ssmx_']\").each(function () {\r\n\t\tvar thisMix = $(this).val() / 100.0;\r\n\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\tvar isTaste = $(this).data('is_taste');\r\n\r\n\t\tif (isTaste)\r\n\t\t{\r\n\t\t\tworkShopMix[thisRecipe] = thisMix;\r\n\t\t}\r\n\t});\r\n\r\n\tlet totalTastePercent = 0.0;\r\n\tfor (let key in workShopMix)\r\n\t{\r\n\t\ttotalTastePercent += workShopMix[key];\r\n\t}\r\n\r\n\tlet scaleFactor = 1.0 / totalTastePercent;\r\n\r\n\tfor (let key in workShopMix)\r\n\t{\r\n\t\tworkShopMix[key] = workShopMix[key] * scaleFactor;\r\n\t}\r\n\r\n}\r\n\r\nfunction init_inventory_calculation()\r\n{\r\n\t$(\"#calc_inv\").on('click', function () {\r\n\r\n\t\t// validate percentages\r\n\t\tif (!validateSalesMix())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetNormalizedWorkshopMix();\r\n\t\tsetNormalizedStarterPackMix();\r\n\r\n\t\tvar averageServings = 29;\r\n\t\tvar numRegGuests = $(\"#regular_guest_count_goal\").val();\r\n\t\tvar numTasteGuests = $(\"#taste_guest_count_goal\").val();\r\n\t\tvar numIntroGuests = $(\"#intro_guest_count_goal\").val();\r\n\r\n\t\t$(\"[id^='ssmx_']\").not('[data-is_bundle=\"1\"]').each(function () {\r\n\r\n\t\t\tvar thisMix = $(this).val() / 100.0;\r\n\t\t\tvar thisRecipe = this.id.split(\"_\")[1];\r\n\t\t\tvar isIntro = $(this).data('is_intro');\r\n\t\t\tvar isTaste = $(this).data('is_taste');\r\n\r\n\t\t\tvar total_servingsNeeded = numRegGuests * averageServings * thisMix;\r\n\r\n\t\t\tif (isIntro)\r\n\t\t\t{\r\n\t\t\t\ttotal_servingsNeeded += numIntroGuests * 12 * starterPackMix[thisRecipe];\r\n\t\t\t}\r\n\r\n\t\t\tif (isTaste)\r\n\t\t\t{\r\n\t\t\t\ttotal_servingsNeeded += numTasteGuests * 9 * workShopMix[thisRecipe];\r\n\t\t\t}\r\n\r\n\t\t\ttotal_servingsNeeded = Math.round(total_servingsNeeded);\r\n\r\n\t\t\t$(\"#poi_\" + thisRecipe).html(total_servingsNeeded);\r\n\t\t\t$(\"#pwt_\" + thisRecipe).html(total_servingsNeeded);\r\n\t\t\t$(\"#cur_adj_inv_\" + thisRecipe).html(total_servingsNeeded);\r\n\t\t\t$(\"#ovi_\" + thisRecipe).val(total_servingsNeeded);\r\n\r\n\t\t\tvar weeksTotal = 0;\r\n\t\t\tfor (x in weekInfo)\r\n\t\t\t{\r\n\t\t\t\tvar number = weekInfo[x]['menu_week_number'];\r\n\t\t\t\tvar targetID = \"wt\" + number + \"_\" + thisRecipe;\r\n\t\t\t\tvar targetIDEditable = \"wta\" + number + \"_\" + thisRecipe;\r\n\t\t\t\tvar distributionPercent = weekInfo[x]['distribution_percent'] / 100;\r\n\t\t\t\tvar thisProjection = Math.round(distributionPercent * total_servingsNeeded);\r\n\t\t\t\tweeksTotal += thisProjection;\r\n\r\n\t\t\t\t$(\"#\" + targetID).html(thisProjection);\r\n\t\t\t\t$(\"#\" + targetIDEditable).val(thisProjection);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (weeksTotal != total_servingsNeeded)\r\n\t\t\t{\r\n\t\t\t\tvar diff = weeksTotal - total_servingsNeeded;\r\n\t\t\t\tthisProjection -= diff;\r\n\t\t\t\t$(\"#\" + targetID).html(thisProjection);\r\n\t\t\t\t$(\"#\" + targetIDEditable).val(thisProjection);\r\n\t\t\t}\r\n\r\n\t\t\treconcile_weeks_to_monthly_projection();\r\n\t\t});\r\n\t});\r\n\r\n}\r\n\r\nfunction init_sales_mix_editing()\r\n{\r\n\r\n\t$(\"[id^='ssmx_']\").on('change', function () {\r\n\t\tvalidateSalesMix();\r\n\t\tvar orgVal = $(this).data(\"org_val\") * 1;\r\n\t\tvar curVal = $(this).val() * 1;\r\n\t\tif (orgVal != curVal)\r\n\t\t{\r\n\t\t\t$(this).addClass('dirty');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('dirty');\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction resetPage()\r\n{\r\n\tdocument.getElementById('action').value = \"menuChange\";\r\n\tdocument.getElementById('menu_editor_form').submit();\r\n}\r\n\r\nfunction displayValidationErrorMsg(msg)\r\n{\r\n\tmsg = \"<span style='color:red; font-size:larger;'>\" + msg + \"</span>\";\r\n\r\n\tdd_message({\r\n\t\ttitle: 'Error',\r\n\t\tmessage: msg\r\n\t});\r\n}\r\n\r\nfunction clearErrors()\r\n{\r\n\tvar statusDiv = document.getElementById('errorMsg');\r\n\tstatusDiv.style.display = 'none';\r\n\tstatusTextDiv = document.getElementById('errorMsgText');\r\n\tstatusTextDiv.innerHTML = \"\";\r\n}\r\n\r\nfunction storeChange(obj)\r\n{\r\n\tdocument.getElementById('action').value = \"storeChange\";\r\n\tdocument.getElementById('menu_editor_form').submit();\r\n}\r\n\r\nfunction menuChange(obj)\r\n{\r\n\tdocument.getElementById('action').value = \"menuChange\";\r\n\tdocument.getElementById('menu_editor_form').submit();\r\n}\r\n\r\nfunction calculatePage()\r\n{\r\n\r\n\tvar is_unsaved = false;\r\n\tvar sidesCount = 0;\r\n\r\n\tvar itemRows = document.getElementById('itemsTbl').rows;\r\n\r\n\tfor (var i = 0; i < itemRows.length; i++)\r\n\t{\r\n\t\tif (itemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvar itemNumber = null;\r\n\t\tif (itemRows[i].id == 'addonEditorRow')\r\n\t\t{\r\n\t\t\titemNumber = itemRows[i].getAttribute('item_id');\r\n\t\t\tif (!itemNumber)\r\n\t\t\t{\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\titemNumber = itemRows[i].id.substr(4);\r\n\t\t}\r\n\r\n\t}\r\n\t// EFL Items\r\n\r\n\tvar EFL_itemRows = document.getElementById('EFLitemsTbl').rows;\r\n\r\n\tfor (var i = 0; i < EFL_itemRows.length; i++)\r\n\t{\r\n\t\tif (EFL_itemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvar itemNumber = null;\r\n\t\tif (EFL_itemRows[i].id == 'addonEditorRow')\r\n\t\t{\r\n\t\t\titemNumber = EFL_itemRows[i].getAttribute('item_id');\r\n\t\t\tif (!itemNumber)\r\n\t\t\t{\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\titemNumber = EFL_itemRows[i].id.substr(4);\r\n\t\t}\r\n\r\n\t}\r\n\t// Chef Touched Selections\r\n\tvar ctsItemRows = document.getElementById('ctsItemsTbl').rows;\r\n\tfor (i = 0; i < ctsItemRows.length; i++)\r\n\t{\r\n\t\tif (ctsItemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvar itemNumber = null;\r\n\t\titemNumber = ctsItemRows[i].id.substr(4);\r\n\t}\r\n\r\n}\r\n\r\nfunction confirm_and_check_form()\r\n{\r\n\r\n\tvar form = $(\"#menu_editor_form\")[0];\r\n\r\n\tclearErrors();\r\n\r\n\tvalidated = _check_form(form);\r\n\r\n\tvar itemRows = document.getElementById('itemsTbl').rows;\r\n\r\n\tfor (var i = 0; i < itemRows.length; i++)\r\n\t{\r\n\t\tif (itemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvar itemNumber = itemRows[i].id.substr(4);\r\n\r\n\t}\r\n\r\n\tvar EFL_itemRows = document.getElementById('EFLitemsTbl').rows;\r\n\r\n\tfor (var i = 0; i < EFL_itemRows.length; i++)\r\n\t{\r\n\t\tif (EFL_itemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvar itemNumber = EFL_itemRows[i].id.substr(4);\r\n\t}\r\n\r\n\tvar ctsItemRows = document.getElementById('ctsItemsTbl').rows;\r\n\r\n\tfor (i = 0; i < ctsItemRows.length; i++)\r\n\t{\r\n\t\tif (ctsItemRows[i].id.indexOf('row_') == -1)\r\n\t\t{\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tvar itemNumber = ctsItemRows[i].id.substr(4);\r\n\t}\r\n\r\n\tif (message != \"\")\r\n\t{\r\n\t\tvalidated = false;\r\n\t\tdisplayValidationErrorMsg(message);\r\n\t}\r\n\r\n\tif (validated)\r\n\t{\r\n\t\tvar finalizeMessage = \"Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.\";\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Attention',\r\n\t\t\tmessage: finalizeMessage,\r\n\t\t\tmodal: true,\r\n\t\t\tconfirm: function () {\r\n\t\t\t\tdocument.getElementById('action').value = \"finalize\";\r\n\t\t\t\t$(\"#menu_editor_form\").submit();\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tcancel: function () {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t``\r\n\t}\r\n\treturn false;\r\n}"],"mappings":"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"}
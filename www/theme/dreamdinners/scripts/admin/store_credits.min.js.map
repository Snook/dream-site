{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["store_credits.js"],"sourcesContent":["\r\nfunction process_pending_credit_now(user_id, credit_id, referred_user_id, store_id)\r\n{\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata : {\r\n\t\t\tprocessor: 'admin_store_credits',\r\n\t\t\taction:'process_now',\r\n\t\t\tuser_id: user_id,\r\n\t\t\treferred_user_id: referred_user_id,\r\n\t\t\tcredit_id: credit_id,\r\n\t\t\tstore_id: store_id\r\n\t\t},\r\n\t\tsuccess: function(json)\r\n\t\t{\r\n\t\t\tif(json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tvar rowName = 'pscr_' + credit_id;\r\n\r\n\t\t\t\t$('#' + rowName).replaceWith(json.html);\r\n\r\n\t\t\t\tif (window.calculateBalance && typeof(window.calculateBalance) == \"function\")\r\n\t\t\t\t{\r\n\t\t\t\t\tcalculateBalance();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Processing Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n        },\r\n\t\terror: function(objAJAXRequest, strError)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response = 'Unexpected error:' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n    return false;\r\n}\r\n\r\n\r\n// Order Editor is different enough to have it's own version\r\nfunction eo_process_pending_credit_now(user_id, credit_id, referred_user_id, store_id)\r\n{\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata : {\r\n\t\t\tprocessor: 'admin_store_credits',\r\n\t\t\taction:'process_now',\r\n\t\t\tuser_id: user_id,\r\n\t\t\treferred_user_id: referred_user_id,\r\n\t\t\tcredit_id: credit_id,\r\n\t\t\tstore_id: store_id,\r\n\t\t\tclient: 'order_editor'\r\n\t\t},\r\n\t\tsuccess: function(json)\r\n\t\t{\r\n\t\t\tif(json.processor_success)\r\n\t\t\t{\r\n\r\n\t\t\t\tvar rowName = 'pscr_' + credit_id;\r\n\t\t\t\t$('#' + rowName).remove();\r\n\r\n\t\t\t\tif (document.getElementById('pending_credits_table').rows.length == 2)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#pending_credits_table').remove();\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\t$('#eoTotalStoreCredit').html(json.newSCTotal);\r\n\t\t\t\t$('#store_credits_amount').val(json.newSCTotal);\r\n\t\t\t\t$('#store_credits_amount').prop(\"disabled\", false);\r\n\t\t\t\t$('#use_store_credits').prop(\"checked\", true);\r\n\r\n\t\t\t\tif (window.reportPaymentStatus && typeof(window.reportPaymentStatus) == \"function\")\r\n\t\t\t\t{\r\n\t\t\t\t\treportPaymentStatus(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Processing Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n        },\r\n\t\terror: function(objAJAXRequest, strError)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response = 'Unexpected error:' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n    return false;\r\n}\r\n\r\n\r\n\r\n\r\n//Order Editor is different enough to have it's own version\r\nfunction delete_store_credit(credit_id, user_id)\r\n{\r\n\r\n\tdd_message({\r\n\t\ttitle: 'Delete Store Credit',\r\n\t\twidth:400,\r\n\t\tmessage: '<b>Are you sure? This operation is undoable.</b><br />Enter an optional note:<br /><input id=\"delete_SC_notes\" type=\"text\" size=\"60\" maxsize=\"256\" />',\r\n\t\tmodal: true,\r\n\t\tconfirm: function() {\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata : {\r\n\t\t\t\t\tprocessor: 'admin_store_credits',\r\n\t\t\t\t\taction:'delete',\r\n\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\tcredit_id: credit_id,\r\n\t\t\t\t\tnotes: $('#delete_SC_notes').val()\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function(json)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar rowName = 'scr_' + credit_id;\r\n\t\t\t\t\t\t$('#' + rowName).remove();\r\n\r\n\t\t\t\t\t\tvar totalsName = 'sctc_' + json.store_id;\r\n\t\t\t\t\t\t$('#' + totalsName).html(formatAsMoney(json.newSCTotal));\r\n\r\n\t\t\t\t\t\tif (document.getElementById('avail_credits_tbl').rows.length == 2)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$('#avail_credits_header_row').after('<tr><td class=\"bgcolor_light\" colspan=\"8\" style=\"text-align:center;\"><i>There is no available store credit for this customer</i></td></tr>');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Processing Error',\r\n\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t        },\r\n\t\t\t\terror: function(objAJAXRequest, strError)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: response = 'Unexpected error:' + strError\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tcancel: function() {\r\n\t\t}\r\n\t});\r\n\r\n\r\n\r\n    return false;\r\n}"],"names":["process_pending_credit_now","user_id","credit_id","referred_user_id","store_id","$","ajax","url","type","timeout","dataType","data","processor","action","success","json","processor_success","rowName","replaceWith","html","window","calculateBalance","dd_message","title","message","processor_message","error","objAJAXRequest","strError","response","eo_process_pending_credit_now","client","remove","document","getElementById","rows","length","newSCTotal","val","prop","reportPaymentStatus","delete_store_credit","width","modal","confirm","notes","totalsName","formatAsMoney","after","cancel"],"mappings":"AACA,SAASA,2BAA2BC,EAASC,EAAWC,EAAkBC,GAGzEC,EAAEC,KAAK,CACNC,IAAK,aACLC,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAO,CACNC,UAAW,sBACXC,OAAO,cACPZ,QAASA,EACTE,iBAAkBA,EAClBD,UAAWA,EACXE,SAAUA,GAEXU,QAAS,SAASC,GAEjB,GAAGA,EAAKC,kBACR,CACC,IAAIC,EAAU,QAAUf,EAExBG,EAAE,IAAMY,GAASC,YAAYH,EAAKI,MAElC,GAAIC,OAAOC,yBAA2BD,OAAuB,kBAAK,WAClE,CACCC,wBAKF,CACCC,WAAW,CACVC,MAAO,mBACPC,QAAST,EAAKU,sBAIjBC,MAAO,SAASC,EAAgBC,GAE/BN,WAAW,CACVC,MAAO,QACPC,QAASK,SAAW,oBAAsBD,OAK1C,OAAO,MAKX,SAASE,8BAA8B7B,EAASC,EAAWC,EAAkBC,GAG5EC,EAAEC,KAAK,CACNC,IAAK,aACLC,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAO,CACNC,UAAW,sBACXC,OAAO,cACPZ,QAASA,EACTE,iBAAkBA,EAClBD,UAAWA,EACXE,SAAUA,EACV2B,OAAQ,gBAETjB,QAAS,SAASC,GAEjB,GAAGA,EAAKC,kBACR,CAEC,IAAIC,EAAU,QAAUf,EACxBG,EAAE,IAAMY,GAASe,SAEjB,GAAIC,SAASC,eAAe,yBAAyBC,KAAKC,QAAU,EACpE,CACC/B,EAAE,0BAA0B2B,SAI7B3B,EAAE,uBAAuBc,KAAKJ,EAAKsB,YACnChC,EAAE,yBAAyBiC,IAAIvB,EAAKsB,YACpChC,EAAE,yBAAyBkC,KAAK,WAAY,OAC5ClC,EAAE,sBAAsBkC,KAAK,UAAW,MAExC,GAAInB,OAAOoB,4BAA8BpB,OAA0B,qBAAK,WACxE,CACCoB,oBAAoB,YAKtB,CACClB,WAAW,CACVC,MAAO,mBACPC,QAAST,EAAKU,sBAIjBC,MAAO,SAASC,EAAgBC,GAE/BN,WAAW,CACVC,MAAO,QACPC,QAASK,SAAW,oBAAsBD,OAK1C,OAAO,MAOX,SAASa,oBAAoBvC,EAAWD,GAGvCqB,WAAW,CACVC,MAAO,sBACPmB,MAAM,IACNlB,QAAS,wJACTmB,MAAO,KACPC,QAAS,WACRvC,EAAEC,KAAK,CACNC,IAAK,aACLC,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAO,CACNC,UAAW,sBACXC,OAAO,SACPZ,QAASA,EACTC,UAAWA,EACX2C,MAAOxC,EAAE,oBAAoBiC,OAE9BxB,QAAS,SAASC,GAEjB,GAAGA,EAAKC,kBACR,CACC,IAAIC,EAAU,OAASf,EACvBG,EAAE,IAAMY,GAASe,SAEjB,IAAIc,EAAa,QAAU/B,EAAKX,SAChCC,EAAE,IAAMyC,GAAY3B,KAAK4B,cAAchC,EAAKsB,aAE5C,GAAIJ,SAASC,eAAe,qBAAqBC,KAAKC,QAAU,EAChE,CACC/B,EAAE,6BAA6B2C,MAAM,mJAKvC,CACC1B,WAAW,CACVC,MAAO,mBACPC,QAAST,EAAKU,sBAIjBC,MAAO,SAASC,EAAgBC,GAE/BN,WAAW,CACVC,MAAO,QACPC,QAASK,SAAW,oBAAsBD,QAK9CqB,OAAQ,eAMN,OAAO"}
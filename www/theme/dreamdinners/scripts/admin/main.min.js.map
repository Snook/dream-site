{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["main.js"],"sourcesContent":["var selected_session_id, view_session, manualSearchTypeChange, manualOrderSearchTypeChange;\r\nvar init_go_to_today = false;\r\nvar suppress_fastlane_labels = false;\r\n\r\nfunction main_init()\r\n{\r\n\thandle_agenda_click();\r\n\r\n\thandle_agenda_month_select();\r\n\r\n\thandle_session_tools();\r\n\r\n\thandle_go_to_today();\r\n\r\n\thandle_guest_search();\r\n\r\n\thandle_preselection();\r\n\r\n\thandle_order_details_table();\r\n\r\n\tinit_looping_timers();\r\n}\r\n\r\nfunction init_looping_timers()\r\n{\r\n\t// refreshes dashboard snapshot\r\n\tstart_dashboard_snapshot_timer();\r\n\r\n\t// greys out agenda days and session as the expire\r\n\tstart_unix_expiry_timer();\r\n}\r\n\r\nfunction register_booking_click_handlers()\r\n{\r\n\t// make it so you can highlight a guest row on click\r\n\thandle_booking_row_click();\r\n\r\n\t// register guest click handlers\r\n\t// no show checkbox\r\n\thandle_booking_no_show();\r\n\r\n\t// handle platepoints gift tools\r\n\thandle_platepoints_gifts();\r\n\r\n\t// handle food testing recipe assignment\r\n\thandle_food_testing_recipe();\r\n\r\n\t// handle opted out users\r\n\thandle_pp_opted_out();\r\n\r\n\t// handle showing order details\r\n\thandle_order_details_table();\r\n\r\n\t// handle delayed payment tc\r\n\thandle_delayed_payment_tc();\r\n\r\n\t// handle session rsvp functions\r\n\thandle_session_rsvp();\r\n\r\n\t//ShipStation Calls\r\n\thandle_resend_delivered_to_shipstation();\r\n\thandle_fetch_tracking_from_shipstation()\r\n}\r\n\r\nfunction handle_resend_delivered_to_shipstation()\r\n{\r\n\t$('.handle-resend-shipstation').each(function () {\r\n\t\t$(this).on('click', function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tvar orderId = $(this).data('order_id');\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 60000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_shipstation_manager',\r\n\t\t\t\t\top: 'resend-order',\r\n\t\t\t\t\torder: orderId\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_toast({'message': 'There was a problem sending to ShipStation.'});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction handle_fetch_tracking_from_shipstation()\r\n{\r\n\t$('.handle-fetch-tracking-number').each(function () {\r\n\t\t$(this).on('click', function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tvar orderId = $(this).data('order_id');\r\n\r\n\t\t\tvar control = $(this);\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 60000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_shipstation_manager',\r\n\t\t\t\t\top: 'fetch-tracking-number',\r\n\t\t\t\t\torder: orderId\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (json.processor_tracking_number != null && typeof json.processor_tracking_number != 'undefined' && json.processor_tracking_number !== '' && json.processor_tracking_number !== 'null')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcontrol.html(json.processor_tracking_number);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_toast({'message': 'There was a problem updating the tracking number from ShipStation.'});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction handle_session_rsvp()\r\n{\r\n\t$('.add_session_rsvp_guest_create').each(function () {\r\n\t\t$(this).on('click', function (e) {\r\n\t\t\tvar rsvp_session_id = $(this).data('session_id');\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 60000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_session_rsvp',\r\n\t\t\t\t\top: 'get_form_add_guest'\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Add RSVP',\r\n\t\t\t\t\t\t\tmessage: json.form_add_guest,\r\n\t\t\t\t\t\t\theight: 400,\r\n\t\t\t\t\t\t\twidth: 300,\r\n\t\t\t\t\t\t\tdiv_id: 'add_guest_div',\r\n\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t$('.telephone').mask('999-999-9999');\r\n\r\n\t\t\t\t\t\t\t\t// get button objects\r\n\t\t\t\t\t\t\t\tvar buttons = $(this).dialog(\"option\", \"buttons\");\r\n\r\n\t\t\t\t\t\t\t\t// assign accept button function to variable\r\n\t\t\t\t\t\t\t\tvar acceptFunction = buttons.Accept;\r\n\r\n\t\t\t\t\t\t\t\t//hide close button.\r\n\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\r\n\t\t\t\t\t\t\t\t// register keyup on password field, if enter submit form\r\n\t\t\t\t\t\t\t\t$('#add_guest_password_login').keyup(function (e) {\r\n\t\t\t\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ENTER)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tacceptFunction();\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\tAccept: function () {\r\n\t\t\t\t\t\t\t\t\tvar add_guest_ui = $(\"#add_guest_div\")[0];\r\n\t\t\t\t\t\t\t\t\t$(\"#add_guest_div\").find('#error_message').html('');\r\n\r\n\t\t\t\t\t\t\t\t\tif (_check_form($('#form_add_guest')[0]))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tprocessor: 'admin_session_rsvp',\r\n\t\t\t\t\t\t\t\t\t\t\t\top: 'rsvp_dream_taste',\r\n\t\t\t\t\t\t\t\t\t\t\t\tprimary_email_login: $(\"#add_guest_div\").find('#add_guest_primary_email_login').val(),\r\n\t\t\t\t\t\t\t\t\t\t\t\tpassword_login: $(\"#add_guest_div\").find('#add_guest_password_login').val(),\r\n\t\t\t\t\t\t\t\t\t\t\t\tfirstname: $(\"#add_guest_div\").find('#add_guest_firstname').val(),\r\n\t\t\t\t\t\t\t\t\t\t\t\tlastname: $(\"#add_guest_div\").find('#add_guest_lastname').val(),\r\n\t\t\t\t\t\t\t\t\t\t\t\ttelephone_1: $(\"#add_guest_div\").find('#add_guest_telephone_1').val(),\r\n\t\t\t\t\t\t\t\t\t\t\t\trsvp_dream_taste: rsvp_session_id\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(add_guest_ui).remove();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\thandle_preselection();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tCancel: function () {\r\n\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\r\n\t\t\t\t\thandle_dashboard_update();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t});\r\n\r\n\t$('.cancel_session_rsvp').each(function () {\r\n\t\t$(this).on('click', function (e) {\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar session_id = $(this).data('session_id');\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Confirmation',\r\n\t\t\t\tmessage: 'Are you sure you wish to cancel this RSVP?',\r\n\t\t\t\tmodal: true,\r\n\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprocessor: 'admin_session_rsvp',\r\n\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\t\t\top: 'delete_rsvp'\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (json, status) {\r\n\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#session_rsvp-' + session_id + '-' + user_id).remove();\r\n\r\n\t\t\t\t\t\t\t\tdd_toast({'message': 'RSVP has been canceled.'});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction handle_session_rsvp_guest_find(guest)\r\n{\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_session_rsvp',\r\n\t\t\tuser_id: $(guest).data('user_id'),\r\n\t\t\tsession_id: $(guest).data('session_id'),\r\n\t\t\top: 'add_rsvp'\r\n\t\t},\r\n\t\tsuccess: function (json, status) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tdd_toast({'message': 'RSVP has been added.'});\r\n\r\n\t\t\t\thandle_preselection();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error';\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_order_details_table()\r\n{\r\n\t$('[data-view_order_details]').each(function () {\r\n\r\n\t\t// handle view order details\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar booking_id = $(this).data('booking_id');\r\n\t\t\tvar order_id = $(this).data('order_id');\r\n\r\n\t\t\t// hide existing open order\r\n\t\t\t$('.order_details_tbody').hide();\r\n\r\n\t\t\t// show this order\r\n\t\t\t$('#order_details_tbody_id_' + booking_id).show();\r\n\r\n\t\t\t// scroll to guest details\r\n\t\t\t$('html, body').animate({\r\n\r\n\t\t\t\tscrollTop: $('#guest_details_tbody_id_' + booking_id).offset().top - 40\r\n\r\n\t\t\t}, 500);\r\n\r\n\t\t\t// cancel scroll if user manually interrupts the scroll\r\n\t\t\t$('html, body').on('scroll mousedown DOMMouseScroll mousewheel keyup', function (e) {\r\n\r\n\t\t\t\t$('html, body').stop();\r\n\r\n\t\t\t});\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 60000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_fadmin_home_order_details',\r\n\t\t\t\t\top: 'order_details',\r\n\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\tbooking_id: booking_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('#order_details_table_div_id_' + json.booking_id).html(json.order_details_table);\r\n\r\n\t\t\t\t\t\tif (getQueryVariable('session'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tupdate_page_url('main.php?page=' + getQueryVariable('page') + '&session=' + getQueryVariable('session') + '&order=' + json.order_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (getQueryVariable('day'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tupdate_page_url('main.php?page=' + getQueryVariable('page') + '&day=' + getQueryVariable('day') + '&order=' + json.order_id);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// get order history\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\r\n\t\t\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\t\t\t\top: 'get_history',\r\n\t\t\t\t\t\t\t\tuser_id: USER_DETAILS.id,\r\n\t\t\t\t\t\t\t\torder_id: order_id\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\t$('#order_history_div_id_' + json.booking_id).html(json.html);\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t\t// handle closing of order details\r\n\t\t$('.close_order_details_table').on('click', function (e) {\r\n\r\n\t\t\t$('#order_details_tbody_id_' + $(this).data('booking_id')).hide();\r\n\r\n\t\t\tif (getQueryVariable('session'))\r\n\t\t\t{\r\n\t\t\t\tupdate_page_url('main.php?page=' + getQueryVariable('page') + '&session=' + getQueryVariable('session'));\r\n\t\t\t}\r\n\t\t\telse if (getQueryVariable('day'))\r\n\t\t\t{\r\n\t\t\t\tupdate_page_url('main.php?page=' + getQueryVariable('page') + '&day=' + getQueryVariable('day'));\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_platepoints_gifts()\r\n{\r\n\t$('[data-pp_gift_reward]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tuser_id = $(this).data('user_id');\r\n\t\t\tlevel = $(this).data('level');\r\n\t\t\tgift_id = $(this).data('gift_id');\r\n\t\t\torder_sequence_number = $(this).data('order_sequence_number');\r\n\t\t\torder_id = $(this).data('order_id');\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Mark received confirmation',\r\n\t\t\t\tmessage: 'Are you sure you wish to mark the gift as received?',\r\n\t\t\t\tmodal: true,\r\n\t\t\t\tconfirm: function () {\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprocessor: 'plate_points_processor',\r\n\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\top: 'mark_gift_received',\r\n\t\t\t\t\t\t\tlevel: level,\r\n\t\t\t\t\t\t\tgift_id: gift_id,\r\n\t\t\t\t\t\t\torder_sequence_number: order_sequence_number\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (json, status) {\r\n\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (level == 'enrolled')\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('[data-pp_gift_reward_div=' + json.user_id + '_' + gift_id + ']').remove();\r\n\t\t\t\t\t\t\t\t\tdd_toast({'message': 'The guest has received a Member level gift: ' + json.giftDisplayString});\r\n\r\n\t\t\t\t\t\t\t\t\tvar numDue = $(\"div[data-is_due*='true']\").length;\r\n\t\t\t\t\t\t\t\t\tvar numNotDue = $(\"div[data-is_due*='false']\").length;\r\n\r\n\t\t\t\t\t\t\t\t\tif (numDue == 0)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$('#rewardsdueheader_' + json.user_id).hide();\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (numNotDue == 0)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$('#rewardsnotdueheader_' + json.user_id).hide();\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif ($(\"#received_order_based_gifts_\" + order_id).length)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$(\"#received_order_based_gifts_\" + order_id).html(json.received_gifts);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('[data-pp_gift_reward_div=' + json.user_id + ']').hide();\r\n\r\n\t\t\t\t\t\t\t\t\tdd_toast({'message': 'The guest has received their current level gift: ' + json.giftDisplayString});\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\tmessage: 'There was a problem marking the gift as received.'\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction start_dashboard_snapshot_timer()\r\n{\r\n\t// cancel existing timer if there is one\r\n\t$.doTimeout('dashboard_snapshot_timer');\r\n\r\n\t// check every 2 minutes for dashboard updates\r\n\t$.doTimeout('dashboard_snapshot_timer', 120000, function () {\r\n\r\n\t\thandle_dashboard_update();\r\n\r\n\t\treturn true;\r\n\r\n\t});\r\n\r\n\t// call it immediately\r\n\t// $.doTimeout('dashboard_snapshot_timer', true );\r\n}\r\n\r\nfunction start_unix_expiry_timer()\r\n{\r\n\t// cancel existing timer if there is one\r\n\t$.doTimeout('unix_expiry_timer');\r\n\r\n\t// check every minute and set agenda display is_past based on session/day expiry\r\n\t$.doTimeout('unix_expiry_timer', 60000, function () {\r\n\r\n\t\tvar unixtime = Math.round(new Date().getTime() / 1000);\r\n\r\n\t\t$('[data-unix_expiry]').filter(function () {\r\n\r\n\t\t\treturn $(this).data('unix_expiry') < unixtime && !$(this).hasClass('is_past');\r\n\r\n\t\t}).addClass('is_past');\r\n\r\n\t\treturn true;\r\n\r\n\t});\r\n\r\n\t// call it immediately\r\n\t$.doTimeout('unix_expiry_timer', true);\r\n}\r\n\r\nfunction set_selected_date(new_date, cur_menu_id, new_menu_id)\r\n{\r\n\tselected_date = new_date;\r\n\r\n\tif (cur_menu_id != new_menu_id)\r\n\t{\r\n\t\thandle_dashboard_update();\r\n\t\treturn true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction handle_dashboard_update()\r\n{\r\n\tif ($('#dashboard_snapshot_table_div').length && $('#dashboard_snapshot_container').is(\":visible\"))\r\n\t{\r\n\t\t// short timeout to prevent processing message from showing for normal cached load times\r\n\t\t$.doTimeout('dashboard_processing_timer', 1000, function () {\r\n\r\n\t\t\t$('#dashboard_processing').show();\r\n\t\t\t$('#dashboard_snapshot_table').addClass('processing');\r\n\r\n\t\t});\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 60000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\top: 'dashboard_details',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\tdashboard_date: selected_date\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$.doTimeout('dashboard_processing_timer');\r\n\r\n\t\t\t\t\t$('#dashboard_snapshot_table_div').html(json.dashboard_metrics);\r\n\t\t\t\t\t$('#ds_title_date').html(json.dashboard_title);\r\n\r\n\t\t\t\t\t$('#dashboard_snapshot_table').removeClass('processing');\r\n\t\t\t\t\t$('#dashboard_processing').hide();\r\n\t\t\t\t\thelp_system_init();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t//\t\thandle_dashboard_update();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction handle_agenda_month_select()\r\n{\r\n\t$('#month_selector').on('change', function (e) {\r\n\r\n\t\tselected_agenda_month = $('#month_selector').val();\r\n\t\tselected_agenda_month_id = $('#month_selector').find(':selected').data('menu_id');\r\n\r\n\t\tdoasync = true;\r\n\t\tif (init_go_to_today)\r\n\t\t{\r\n\t\t\tdoasync = false;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\tasync: doasync,\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\top: 'agenda_details',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\tagenda_date: selected_agenda_month,\r\n\t\t\t\tagenda_month_id: selected_agenda_month_id\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#session_selector').html(json.session_info);\r\n\r\n\t\t\t\t\thandle_agenda_click();\r\n\r\n\t\t\t\t\tif (!init_go_to_today)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('#day_' + json.date).scrollToTarget($('#session_selector'));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_delayed_payment_tc()\r\n{\r\n\t$('[data-delayed_payment_tc]').on('click', function (e) {\r\n\r\n\t\tvar user_id = $(this).data('delayed_payment_tc');\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: lang.en.tc.terms_and_conditions,\r\n\t\t\tmessage: lang.en.tc.delayed_payment,\r\n\t\t\tmodal: true,\r\n\t\t\tnoOk: true,\r\n\t\t\tbuttons: {\r\n\t\t\t\t'Agree': function () {\r\n\r\n\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t$('[data-delayed_payment_tc=\"' + user_id + '\"]').hide();\r\n\r\n\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 1, user_id);\r\n\r\n\t\t\t\t},\r\n\t\t\t\t'Decline': function () {\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\r\n\t\t\t\t\t\tmessage: lang.en.tc.delayed_payment_decline\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 0, user_id);\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_agenda_click()\r\n{\r\n\t$('#session_selection li').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tif (typeof window.booking_query != 'undefined')\r\n\t\t\t{\r\n\t\t\t\twindow.booking_query.abort();\r\n\t\t\t}\r\n\r\n\t\t\t$('.selected').removeClass('selected');\r\n\r\n\t\t\t$(this).addClass('selected');\r\n\t\t\t// cancel timeout\r\n\t\t\t$.doTimeout('booked_guests_table_timer');\r\n\r\n\t\t\t// if fetching guests takes longer than 1 second, show a loading message\r\n\t\t\t$.doTimeout('booked_guests_table_timer', 1000, function () {\r\n\r\n\t\t\t\t$('#booked_guests_table').html('<img src=\"' + PATH.image_admin + '/style/throbber_circle.gif\" class=\"img_valign img_throbber_circle\" data-tooltip=\"Processing\" alt=\"Processing\" style=\"display: inline;\" /> Loading...');\r\n\r\n\t\t\t});\r\n\r\n\t\t\tif ($(this).data('session_id'))\r\n\t\t\t{\r\n\t\t\t\tview_session = true;\r\n\r\n\t\t\t\tselected_session_id = $(this).data('session_id');\r\n\r\n\t\t\t\twindow.booking_query = $.ajax({\r\n\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\ttimeout: 120000,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\t\top: 'session_details',\r\n\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\t\tsession_id: selected_session_id\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// if getting order details, show it after\r\n\t\t\t\t\t\t\tvar order_details = false;\r\n\t\t\t\t\t\t\t// only check if not switching between day and session view\r\n\t\t\t\t\t\t\tif (!getQueryVariable('day'))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\torder_details = getQueryVariable('order');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// cancel timer\r\n\t\t\t\t\t\t\t$.doTimeout('booked_guests_table_timer');\r\n\t\t\t\t\t\t\tupdate_page_url('main.php?page=' + getQueryVariable('page') + '&session=' + json.session_info.id);\r\n\r\n\t\t\t\t\t\t\tvar current_menu_id = selected_menu_id;\r\n\t\t\t\t\t\t\tselected_menu_id = json.session_info.menu_id;\r\n\t\t\t\t\t\t\tset_selected_date(json.session_info.session_start_dtf_ymd, current_menu_id, selected_menu_id);\r\n\r\n\t\t\t\t\t\t\t// update session tools\r\n\t\t\t\t\t\t\tupdate_session_tool_links();\r\n\r\n\t\t\t\t\t\t\t// update title\r\n\t\t\t\t\t\t\t$('#selected_day').html(json.session_info.session_start_dtf_verbose_date);\r\n\t\t\t\t\t\t\t$('#selected_date_link').attention();\r\n\r\n\t\t\t\t\t\t\t// show title time\r\n\t\t\t\t\t\t\t$('#selected_session').html(' - ' + json.session_info.session_start_dtf_time_only);\r\n\t\t\t\t\t\t\t$('#selected_session').show();\r\n\r\n\t\t\t\t\t\t\t// Hide Day Details\r\n\t\t\t\t\t\t\t$('#day_details_container').hide();\r\n\r\n\t\t\t\t\t\t\t// fill session details container\r\n\t\t\t\t\t\t\t$('#session_details_table_div').html(json.session_details);\r\n\r\n\t\t\t\t\t\t\t$('#sd_edit_session').show();\r\n\t\t\t\t\t\t\t$('#sd_session_meta').show();\r\n\r\n\t\t\t\t\t\t\tvar publish_state_button_text = json.session_info.session_publish_state == 'PUBLISHED' ? 'Close Session' : 'Open Session';\r\n\t\t\t\t\t\t\t$('#sd_publish_state').data('session_publish_state', json.session_info.session_publish_state).html(publish_state_button_text);\r\n\t\t\t\t\t\t\t// update agenda display with new details in-case the state has changed since last load\r\n\t\t\t\t\t\t\tif (json.session_data.session_type === 'DELIVERED')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.shipped').html(json.session_info.shipping_bookings_count);\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.attending').html(json.session_info.delivered_bookings_count);\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.remaining').html(json.session_info.remaining_slots);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (json.session_data.session_type_subtype === 'WALK_IN')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#sd_edit_session').hide();\r\n\t\t\t\t\t\t\t\t$('#sd_session_meta').hide();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (typeof json.session_info.additional_orders !== undefined && json.session_info.additional_orders != null && json.session_info.additional_orders > 0)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.attending').html((json.session_info.booked_count * 1) + (json.session_info.num_rsvps * 1) + '/' + json.session_info.additional_orders);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.attending').html((json.session_info.booked_count * 1) + (json.session_info.num_rsvps * 1));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.remaining').html(json.session_info.remaining_slots + '/' + (json.session_info.remaining_intro_slots > 0 ? json.session_info.remaining_intro_slots : 0));\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (json.session_info.session_publish_state == 'PUBLISHED')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.time').removeClass('closed');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id + ' > span.time').addClass('closed');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// show session details container\r\n\t\t\t\t\t\t\t$('#session_details_container').show();\r\n\r\n\t\t\t\t\t\t\t// show guest list\r\n\t\t\t\t\t\t\t$('#booked_guests_table').html(json.booking_details);\r\n\r\n\t\t\t\t\t\t\t// register click handlers\r\n\t\t\t\t\t\t\tregister_booking_click_handlers();\r\n\r\n\t\t\t\t\t\t\t// show order details\r\n\t\t\t\t\t\t\tif (order_details)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('[data-view_order_details][data-order_id=\"' + order_details + '\"]').trigger('click');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// dream taste buttons\r\n\t\t\t\t\t\t\t$('#sd_invitation_pdf').on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\tbounce('main.php?page=print&dream_taste_event_pdf=' + selected_session_id, '_blank');\r\n\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// fundraiser buttons\r\n\t\t\t\t\t\t\t$('#sd_fundraiser_invitation_pdf').on('click', function (e) {\r\n\t\t\t\t\t\t\t\tbounce('main.php?page=print&fundraiser_event_pdf=' + selected_session_id, '_blank');\r\n\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// community pickup buttons\r\n\t\t\t\t\t\t\t$('#sd_pick_up_event_invitation_pdf').on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\tbounce('main.php?page=print&remote_pickup_private_event_pdf=' + selected_session_id, '_blank');\r\n\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t$('#sd_resend_hostess_email').on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\tresend_dream_taste_notification();\r\n\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\tif (strError != 'abort')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: 'An unexpected error has occurred, error message: ' + strError + '. If you continue to experience this issue please contact support.'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tview_session = false;\r\n\t\t\t\tvar days_menu = $(this).data('menu_id');\r\n\r\n\t\t\t\tvar submitted_date = $(this).data('date');\r\n\t\t\t\twindow.booking_query = $.ajax({\r\n\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\ttimeout: 120000,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\t\top: 'date_details',\r\n\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\t\tdate: submitted_date\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// if getting order details, show it after\r\n\t\t\t\t\t\t\tvar order_details = false;\r\n\t\t\t\t\t\t\t// only check if not switching between day and session view\r\n\t\t\t\t\t\t\tif (!getQueryVariable('session'))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\torder_details = getQueryVariable('order');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar current_menu_id = selected_menu_id;\r\n\t\t\t\t\t\t\tselected_menu_id = days_menu;\r\n\r\n\t\t\t\t\t\t\tset_selected_date(submitted_date, current_menu_id, selected_menu_id);\r\n\r\n\t\t\t\t\t\t\t// cancel timer\r\n\t\t\t\t\t\t\t$.doTimeout('booked_guests_table_timer');\r\n\t\t\t\t\t\t\tupdate_page_url('main.php?page=' + getQueryVariable('page') + '&day=' + selected_date);\r\n\r\n\t\t\t\t\t\t\t// update session tools\r\n\t\t\t\t\t\t\tupdate_session_tool_links();\r\n\r\n\t\t\t\t\t\t\t// update title\r\n\t\t\t\t\t\t\t$('#selected_day').html(json.date_info.date_dtf_verbose_date);\r\n\t\t\t\t\t\t\t$('#selected_date_link').attention();\r\n\r\n\t\t\t\t\t\t\t// Hide session specific details\r\n\t\t\t\t\t\t\t$('#session_details_container, #selected_session').hide();\r\n\r\n\t\t\t\t\t\t\t// show guest list\r\n\t\t\t\t\t\t\tif (json.booking_details.length)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#booked_guests_table').html(json.booking_details);\r\n\t\t\t\t\t\t\t\t// fill date details container\r\n\t\t\t\t\t\t\t\t$('#day_details_table_div').html(json.date_details);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#booked_guests_table').html('<div class=\"no_day_sessions\">No sessions for this day.</div>');\r\n\t\t\t\t\t\t\t\t// fill date details container\r\n\t\t\t\t\t\t\t\t$('#day_details_table_div').html('<div class=\"no_day_sessions\">No sessions for this day.</div>');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// show day details container\r\n\t\t\t\t\t\t\t$('#day_details_container').show();\r\n\r\n\t\t\t\t\t\t\t// register click handlers\r\n\t\t\t\t\t\t\tregister_booking_click_handlers();\r\n\r\n\t\t\t\t\t\t\t// show order details\r\n\t\t\t\t\t\t\tif (order_details)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('[data-view_order_details][data-order_id=\"' + order_details + '\"]').trigger('click');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// clicking session time will link to that session\r\n\t\t\t\t\t\t\t$('[id^=\"gd_title-\"]').on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\t$('#session-' + $(this).data('session_id')).scrollToTarget($('#session_selector'));\r\n\r\n\t\t\t\t\t\t\t\t$.scrollTo($('body'), 100);\r\n\r\n\t\t\t\t\t\t\t}).hover(function () {\r\n\r\n\t\t\t\t\t\t\t\t$(this).addClass('hover');\r\n\r\n\t\t\t\t\t\t\t}, function () {\r\n\r\n\t\t\t\t\t\t\t\t$(this).removeClass('hover');\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\tif (strError != 'abort')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: 'An unexpected error has occurred, error message: ' + strError + '. If you continue to experience this issue please contact support.'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction update_page_url(page_url)\r\n{\r\n\t// update url\r\n\thistoryPush({url: page_url});\r\n\t// update title link\r\n\t$('#selected_date_link').prop('href', page_url);\r\n}\r\n\r\nfunction handle_pp_opted_out()\r\n{\r\n\t$('.pp_opted_out').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar bounce_to = $(this).prop('href');\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Guest has opted out',\r\n\t\t\t\tmessage: 'The guest has previously opted out, are you sure you wish to continue?',\r\n\t\t\t\tmodal: true,\r\n\t\t\t\tconfirm: function () {\r\n\r\n\t\t\t\t\tbounce(bounce_to);\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction resend_dream_taste_notification()\r\n{\r\n\tdd_message({\r\n\t\ttitle: 'Send notice confirmation',\r\n\t\tmessage: 'Are you sure you wish to resend the host email notification?',\r\n\t\tmodal: true,\r\n\t\tconfirm: function () {\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\top: 'resend_dream_taste_email',\r\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\tsession_id: selected_session_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Send notice confirmation',\r\n\t\t\t\t\t\t\tmessage: 'Email notification has been resent to the session host.'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction handle_booking_no_show()\r\n{\r\n\t$('[id^=\"gd_noshow-\"]').each(function (e) {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar state = this.checked ? 'yes' : 'no';\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_no_show_state',\r\n\t\t\t\t\tbid: $(this).data('booking_id'),\r\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\tstate: state\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_food_testing_recipe()\r\n{\r\n\t$('[id^=\"food_testing-\"]').each(function (e) {\r\n\r\n\t\t$(this).on('change', function (e) {\r\n\r\n\t\t\tvar selector_elem = $(this);\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar session_id = $(this).data('session_id');\r\n\t\t\tvar menu_id = $(this).data('menu_id');\r\n\t\t\tvar survey_name = $('option:selected', $(this)).text();\r\n\t\t\tvar survey_id = $(this).val().split(\"-\")[0];\r\n\t\t\tvar survey_size = $(this).val().split(\"-\")[1];\r\n\r\n\t\t\tif ($(this).val() == '0')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Confirm',\r\n\t\t\t\tmessage: 'Are you sure you wish to assign <span style=\"font-weight: bold;\">' + survey_name + '</span> to this guest? The testing item is <span style=\"font-weight: bold;\">not</span> editable once assigend and the guest will immediately receive an email upon confirmation which will include testing instructions.',\r\n\t\t\t\tnoOk: true,\r\n\t\t\t\tmodal: true,\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\t'Confirm': function () {\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\t\t\t\top: 'assign_test_recipe',\r\n\t\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\t\t\t\tmenu_id: menu_id,\r\n\t\t\t\t\t\t\t\tsurvey_id: survey_id,\r\n\t\t\t\t\t\t\t\tsurvey_size: survey_size\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('[data-food_testing_select_user_id=\"' + json.user_id + '\"]').text(survey_name);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'Cancel': function () {\r\n\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t$(selector_elem).val(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_guest_account_notes()\r\n{\r\n\t$('[id^=\"gd_guest_account_note_button-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tbooking_id = $(this).data('booking_id');\r\n\t\t\tuser_id = $(this).data('user_id');\r\n\t\t\tdo_op = 'get';\r\n\t\t\tguest_note = '';\r\n\r\n\t\t\tif ($(this).data('edit_mode') == true)\r\n\t\t\t{\r\n\t\t\t\tdo_op = 'save';\r\n\r\n\t\t\t\tguest_note = $('#gd_guest_account_note-' + booking_id + ' > textarea').val();\r\n\t\t\t}\r\n\r\n\t\t\tif (do_op == 'get')\r\n\t\t\t{\r\n\t\t\t\tget_user_pref('USER_ACCOUNT_NOTE', user_id, function (json) {\r\n\r\n\t\t\t\t\tvar textarea_elem = $('<textarea></textarea>').addClass('form-control').val((json.guest_preferences[user_id]['USER_ACCOUNT_NOTE'].value ? json.guest_preferences[user_id]['USER_ACCOUNT_NOTE'].value : \"\")).on('keyup', function (e) {\r\n\r\n\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$('#gd_guest_account_note-' + booking_id).addClass('guest_note_edit').html(textarea_elem);\r\n\r\n\t\t\t\t\t$('#gd_guest_account_note_button-' + booking_id).data('edit_mode', true).html('Save Note');\r\n\r\n\t\t\t\t\t$('#gd_guest_account_note_cancel_button-' + booking_id).show();\r\n\r\n\t\t\t\t\t$('#gd_guest_account_note_cancel_button-' + booking_id).data('user_data_value', (json.guest_preferences[user_id]['USER_ACCOUNT_NOTE'].value ? json.guest_preferences[user_id]['USER_ACCOUNT_NOTE'].value : \"\")).on('click', function (e) {\r\n\r\n\t\t\t\t\t\t$('#gd_guest_account_note-' + $(this).data('booking_id')).removeClass('guest_note_edit').html($(this).data('user_data_value'));\r\n\r\n\t\t\t\t\t\t$('#gd_guest_account_note_button-' + $(this).data('booking_id')).data('edit_mode', false).html('Account Notes');\r\n\r\n\t\t\t\t\t\t$(this).hide();\r\n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Confirm',\r\n\t\t\t\t\tmessage: \"This note is viewable and editable by the guest in their preferences. Are you sure you wish to modify the guest's account note?\",\r\n\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t'Confirm': function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\r\n\t\t\t\t\t\t\tset_user_pref('USER_ACCOUNT_NOTE', guest_note, user_id);\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_account_note-' + booking_id).removeClass('guest_note_edit').html(nl2br(guest_note));\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_account_note_cancel_button-' + booking_id).hide();\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_account_note_button-' + booking_id).data('edit_mode', false).html('Account Notes');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'Cancel': function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_admin_carryover_notes()\r\n{\r\n\t// handle button for stores that have hidden carryover notes\r\n\t$('[id^=\"gd_show_guest_note-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar booking_id = $(this).data('booking_id');\r\n\r\n\t\t\tvar button_obj = this;\r\n\r\n\t\t\t$(button_obj).hide();\r\n\r\n\t\t\t$('#gd_guest_note-' + booking_id).show();\r\n\r\n\t\t\t$.doTimeout('show_guest_note_timer-' + booking_id, 10000, function () {\r\n\r\n\t\t\t\t$(button_obj).show();\r\n\r\n\t\t\t\t$('#gd_guest_note-' + booking_id).hide();\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t$('[id^=\"gd_guest_note_button-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\thide_carryover_notes = $(this).data('hide_carryover_notes');\r\n\r\n\t\t\tbooking_id = $(this).data('booking_id');\r\n\t\t\tuser_id = $(this).data('user_id');\r\n\t\t\tdo_op = 'get';\r\n\t\t\tguest_note = '';\r\n\r\n\t\t\tif ($(this).data('edit_mode') == true)\r\n\t\t\t{\r\n\t\t\t\tdo_op = 'save';\r\n\r\n\t\t\t\tguest_note = $('#gd_guest_note-' + booking_id + ' > textarea').val();\r\n\t\t\t}\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\top: 'guest_carryover_note',\r\n\t\t\t\t\t'do': do_op,\r\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\tnote: guest_note\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (do_op == 'get')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// handle button for stores that have hidden carryover notes\r\n\t\t\t\t\t\t\t$.doTimeout('show_guest_note_timer-' + booking_id); //cancel timer\r\n\t\t\t\t\t\t\t$('#gd_guest_note-' + booking_id).show(); // show notes\r\n\t\t\t\t\t\t\t$('#gd_show_guest_note-' + booking_id).hide(); // hide button\r\n\t\t\t\t\t\t\t$('#gd_guest_note-' + booking_id).addClass('guest_note_edit').html('<textarea class=\"form-control\">' + (json.guest_note.user_data_value ? json.guest_note.user_data_value : \"\") + '</textarea>');\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_note_button-' + booking_id).data('edit_mode', true).html('Save Note');\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_note_cancel_button-' + booking_id).data('user_data_value', (json.guest_note.user_data_value ? json.guest_note.user_data_value : \"\")).on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\t// handle button for stores that have hidden carryover notes\r\n\t\t\t\t\t\t\t\tif ($(this).data('hide_carryover_notes') === 1)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('#gd_guest_note-' + booking_id).hide(); // hide notes\r\n\t\t\t\t\t\t\t\t\t$('#gd_show_guest_note-' + booking_id).show(); // hide button\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t$('#gd_guest_note-' + $(this).data('booking_id')).removeClass('guest_note_edit').html($(this).data('user_data_value'));\r\n\r\n\t\t\t\t\t\t\t\t$('#gd_guest_note_button-' + $(this).data('booking_id')).data('edit_mode', false).html('Admin Carryover');\r\n\r\n\t\t\t\t\t\t\t\t$(this).hide();\r\n\r\n\t\t\t\t\t\t\t}).show();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// handle button for stores that have hidden carryover notes\r\n\t\t\t\t\t\t\tif (hide_carryover_notes === 1 && json.guest_note.user_data_value)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$('#gd_guest_note-' + booking_id).hide(); // hide notes\r\n\t\t\t\t\t\t\t\t$('#gd_show_guest_note-' + booking_id).show(); // hide button\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$('#gd_guest_note-' + booking_id).removeClass('guest_note_edit').html(nl2br(json.guest_note.user_data_value));\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_note_cancel_button-' + booking_id).hide();\r\n\r\n\t\t\t\t\t\t\t$('#gd_guest_note_button-' + booking_id).data('edit_mode', false).html('Admin Carryover');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_admin_order_notes()\r\n{\r\n\t$('[id^=\"gd_admin_note_button-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tlet unique_id = $(this).data('uid');\r\n\t\t\tif (typeof unique_id == 'undefined' || unique_id == null || unique_id == '')\r\n\t\t\t{\r\n\t\t\t\tunique_id = '';\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tunique_id += '-';\r\n\t\t\t}\r\n\t\t\tlet buttonName = $(this).data('button_name');\r\n\t\t\tif (typeof buttonName == 'undefined' || buttonName == null || buttonName == '')\r\n\t\t\t{\r\n\t\t\t\tbuttonName = 'Admin Order Note';\r\n\t\t\t}\r\n\t\t\tbooking_id = $(this).data('booking_id');\r\n\t\t\torder_id = $(this).data('order_id');\r\n\t\t\tuser_id = $(this).data('user_id');\r\n\t\t\tdo_op = 'get';\r\n\t\t\tadmin_note = '';\r\n\r\n\t\t\tif ($(this).data('edit_mode') == true)\r\n\t\t\t{\r\n\t\t\t\tdo_op = 'save';\r\n\r\n\t\t\t\tadmin_note = $('#gd_admin_note-' + unique_id + booking_id + ' > textarea').val();\r\n\t\t\t}\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\top: 'order_admin_note',\r\n\t\t\t\t\t'do': do_op,\r\n\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\tnote: admin_note\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (do_op == 'get')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$('#gd_admin_note-' + unique_id + booking_id).addClass('admin_note_edit').html('<textarea class=\"form-control\">' + (json.admin_note ? json.admin_note : \"\") + '</textarea>');\r\n\r\n\t\t\t\t\t\t\t$('#gd_admin_note_button-' + unique_id + booking_id).data('edit_mode', true).html('Save Note');\r\n\r\n\t\t\t\t\t\t\t$('#gd_admin_note_cancel_button-' + unique_id + booking_id).data('admin_note_value', (json.admin_note ? json.admin_note : \"\")).on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\t$('#gd_admin_note-' + unique_id + $(this).data('booking_id')).removeClass('admin_note_edit').html($(this).data('admin_note_value'));\r\n\r\n\t\t\t\t\t\t\t\t$('#gd_admin_note_button-' + unique_id + $(this).data('booking_id')).data('edit_mode', false).html(buttonName);\r\n\r\n\t\t\t\t\t\t\t\t$(this).hide();\r\n\r\n\t\t\t\t\t\t\t}).show();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$('#gd_admin_note-' + unique_id + booking_id).removeClass('admin_note_edit').html(nl2br(json.admin_note));\r\n\r\n\t\t\t\t\t\t\t$('.multi-populate-admin-note').each(function () {\r\n\t\t\t\t\t\t\t\t$(this).html(nl2br(json.admin_note));\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t$('#gd_admin_note_cancel_button-' + unique_id + booking_id).hide();\r\n\r\n\t\t\t\t\t\t\t$('#gd_admin_note_button-' + unique_id + booking_id).data('edit_mode', false).html(buttonName);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_reschedule_button()\r\n{\r\n\t$('[id^=\"gd_reschedule-\"]').each(function () {\r\n\r\n\t\t$(this).css({'cursor': 'pointer'}).on('click', function (e) {\r\n\r\n\t\t\tcreate_and_submit_form({\r\n\t\t\t\tmethod: 'post',\r\n\t\t\t\taction: 'main.php?page=admin_reschedule',\r\n\t\t\t\tinput: ({\r\n\t\t\t\t\t'session_id': $(this).data('session_id'),\r\n\t\t\t\t\t'original_session_id': $(this).data('session_id'),\r\n\t\t\t\t\t'store_id': $(this).data('store_id'),\r\n\t\t\t\t\t'menus': $(this).data('menu_id'),\r\n\t\t\t\t\t'menu_id': $(this).data('menu_id'),\r\n\t\t\t\t\t'order_id': $(this).data('order_id'),\r\n\t\t\t\t\t'back_address': back_path()\r\n\t\t\t\t})\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_booking_row_click()\r\n{\r\n\thandle_guest_account_notes();\r\n\r\n\thandle_admin_carryover_notes();\r\n\r\n\thandle_admin_order_notes();\r\n\r\n\thandle_reschedule_button();\r\n\r\n\t$('#booked_guests_table tbody.guest').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tif ($(this).hasClass('select_guest'))\r\n\t\t\t{\r\n\t\t\t\t$('.select_guest').removeClass('select_guest');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('.select_guest').removeClass('select_guest');\r\n\r\n\t\t\t\t$('#guest_details_tbody_id_' + $(this).data('booking_id')).addClass('select_guest');\r\n\t\t\t\t$('#order_details_tbody_id_' + $(this).data('booking_id')).addClass('select_guest');\r\n\t\t\t}\r\n\t\t\t$('[id^=\"gd_guest_menu-\"]').hide();\r\n\r\n\t\t\t$('#gd_guest_menu-' + $(this).data('user_id')).show();\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t$('[id^=\"gd_guest-\"]').each(function () {\r\n\r\n\t\tvar booking_id = $(this).data('booking_id');\r\n\r\n\t\t/*\r\n\t\t * Handle touch events under development\r\n\t\t * Aug 29, 2014\r\n\t\t * -- Ryan\r\n\t\t * ------------------- this -----VVV is a problem\r\n\t\t $('#gd_guest-' + booking_id +', #gd_guest_menu-' + booking_id).on({\r\n\t\t touchstart: function(e) {\r\n\r\n\t\t e.preventDefault();\r\n\r\n\t\t if ($('#gd_guest_menu-' + booking_id).is(':visible'))\r\n\t\t {\r\n\t\t $('#gd_guest_menu-' + booking_id).hide();\r\n\t\t }\r\n\t\t else\r\n\t\t {\r\n\t\t $('#gd_guest_menu-' + booking_id).show();\r\n\t\t }\r\n\r\n\t\t },\r\n\t\t touchend: function(e) {\r\n\r\n\t\t e.preventDefault();\r\n\r\n\t\t },\r\n\t\t mouseenter: function(e) {\r\n\r\n\t\t // cancel timeout\r\n\t\t $.doTimeout('guest_menu_timer_hide-' + booking_id);\r\n\r\n\t\t // short timeout to prevent menus from popping up when moused over\r\n\t\t $.doTimeout( 'guest_menu_timer_show-' + booking_id, 100, function() {\r\n\r\n\t\t $('#gd_guest_menu-' + booking_id).show();\r\n\r\n\t\t });\r\n\r\n\t\t },\r\n\t\t mouseleave: function(e) {\r\n\r\n\t\t // cancel timeout\r\n\t\t $.doTimeout('guest_menu_timer_show-' + booking_id);\r\n\r\n\t\t // short timeout to prevent menus from disappearing when moused away\r\n\t\t $.doTimeout( 'guest_menu_timer_hide-' + booking_id, 150, function() {\r\n\r\n\t\t $('#gd_guest_menu-' + booking_id).hide();\r\n\r\n\t\t });\r\n\r\n\t\t }\r\n\t\t });\r\n\t\t */\r\n\r\n\t\t$('#gd_guest-' + booking_id + ', #gd_guest_menu-' + booking_id).hover(function () {\r\n\r\n\t\t\t// cancel timeout\r\n\t\t\t$.doTimeout('guest_menu_timer_hide-' + booking_id);\r\n\r\n\t\t\t// short timeout to prevent menus from popping up when moused over\r\n\t\t\t$.doTimeout('guest_menu_timer_show-' + booking_id, 100, function () {\r\n\r\n\t\t\t\t$('#gd_guest_menu-' + booking_id).show();\r\n\r\n\t\t\t});\r\n\r\n\t\t}, function () {\r\n\r\n\t\t\t// cancel timeout\r\n\t\t\t$.doTimeout('guest_menu_timer_show-' + booking_id);\r\n\r\n\t\t\t// short timeout to prevent menus from disappearing when moused away\r\n\t\t\t$.doTimeout('guest_menu_timer_hide-' + booking_id, 150, function () {\r\n\r\n\t\t\t\t$('#gd_guest_menu-' + booking_id).hide();\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n\thandle_cancel_order();\r\n\thandle_cancel_order_delivered();\r\n\thandle_delete_saved_order();\r\n}\r\n\r\nfunction handle_delete_saved_order_delivered()\r\n{\r\n\t$('[id^=\"gd_delete_delivered_order-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar session_id = $(this).data('session_id');\r\n\t\t\tvar order_id = $(this).data('order_id');\r\n\t\t\tvar store_id = $(this).data('store_id');\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar bounce_to = $(this).data('bounce');\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Confirm Delete Saved Order',\r\n\t\t\t\tmessage: \"Are you sure you want to delete this saved order?\",\r\n\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\t\t\t\tstore_id: store_id,\r\n\t\t\t\t\t\t\top: 'delete_saved_order',\r\n\t\t\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\torder_id: order_id\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (typeof bounce_to == 'undefined' || bounce_to == \"\")\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tbounce_to = window.location.href;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbounce(bounce_to);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\tif (json.doRefresh == true)\r\n\t\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Problem Deleting Saved Order',\r\n\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message,\r\n\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t'Refresh': function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\tbounce(window.location.href);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction handle_delete_saved_order()\r\n{\r\n\t$('[id^=\"gd_delete_order-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar session_id = $(this).data('session_id');\r\n\t\t\tvar order_id = $(this).data('order_id');\r\n\t\t\tvar store_id = $(this).data('store_id');\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar bounce_to = $(this).data('bounce');\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Confirm Delete Saved Order',\r\n\t\t\t\tmessage: \"Are you sure you want to delete this saved order?\",\r\n\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\r\n\t\t\t\t\t\t\tstore_id: store_id,\r\n\t\t\t\t\t\t\top: 'delete_saved_order',\r\n\t\t\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\torder_id: order_id\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (typeof bounce_to == 'undefined' || bounce_to == \"\")\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tbounce_to = window.location.href;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tbounce(bounce_to);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\tif (json.doRefresh == true)\r\n\t\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Problem Deleting Saved Order',\r\n\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message,\r\n\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t'Refresh': function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\t\t\t\t\t\tbounce(window.location.href);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction validateKey(evt)\r\n{\r\n\tevt = (evt) ? evt : ((event) ? event : null);\r\n\tif (evt)\r\n\t{\r\n\t\tvar charCode = (evt.charCode || evt.charCode == 0) ? evt.charCode : ((evt.keyCode) ? evt.keyCode : evt.which);\r\n\r\n\t\tif (charCode > 13 && (charCode < 48 || charCode > 57))\r\n\t\t{\r\n\t\t\t//alert(\"Only whole numbers are allowed.\");\r\n\t\t\tif (charCode == 46)\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif (evt.returnValue)\r\n\t\t\t{\r\n\t\t\t\tevt.returnValue = false;\r\n\t\t\t}\r\n\t\t\telse if (evt.preventDefault)\r\n\t\t\t{\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction validateAmount(obj, limit)\r\n{\r\n\tif (isNaN(obj.value))\r\n\t{\r\n\t\tobj.value = 0.00;\r\n\t}\r\n\r\n\tif (obj.value > limit)\r\n\t{\r\n\t\tobj.value = limit;\r\n\t}\r\n}\r\n\r\nfunction handle_cancel_order()\r\n{\r\n\t$('[id^=\"gd_cancel_order-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar booking_id = $(this).data('booking_id');\r\n\t\t\tvar session_id = $(this).data('session_id');\r\n\t\t\tvar order_id = $(this).data('order_id');\r\n\t\t\tvar store_id = $(this).data('store_id');\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar bounce_to = $(this).data('bounce');\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\r\n\t\t\t\t\top: 'cancel_preflight',\r\n\t\t\t\t\tstore_id: store_id,\r\n\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\torder_id: order_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json, status) {\r\n\t\t\t\t\tif (json.processor_success && json.data)\r\n\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Cancel Order?',\r\n\t\t\t\t\t\t\tmessage: json.data,\r\n\t\t\t\t\t\t\twidth: 700,\r\n\t\t\t\t\t\t\theight: 480,\r\n\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\topen: function () {\r\n\t\t\t\t\t\t\t\t$(\"#order_admin_notes_cancel\").on('keyup', function (e) {\r\n\r\n\t\t\t\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcanConfirm: function () {\r\n\t\t\t\t\t\t\t\tvar reason = $(\"#cancellation_reason\").val();\r\n\t\t\t\t\t\t\t\tif (reason == \"\")\r\n\t\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\tdiv_id: 'Uneek262020',\r\n\t\t\t\t\t\t\t\t\t\tmessage: \"Please select a reason for cancelling\"\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tconfirm: function (json, status) {\r\n\r\n\t\t\t\t\t\t\t\tvar paymentList = {};\r\n\t\t\t\t\t\t\t\t$(\"#cancel_parent :input\").each(function () {\r\n\r\n\t\t\t\t\t\t\t\t\tpaymentList[this.id] = $(this).val();\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tvar order_notes = $(\"#order_admin_notes_cancel\").val().trim();\r\n\t\t\t\t\t\t\t\tvar reason = $(\"#cancellation_reason\").val();\r\n\t\t\t\t\t\t\t\tvar declined_MFY = $('#declined_MFY').is(':checked');\r\n\t\t\t\t\t\t\t\tvar declined_Reschedule = $('#declined_to_reschedule').is(':checked');\r\n\t\t\t\t\t\t\t\tvar suppress_cancel_email = $('#suppress_cancel_email').is(':checked');\r\n\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Cancelling order',\r\n\t\t\t\t\t\t\t\t\tmessage: '<img src=\"' + PATH.image_admin + '/style/throbber_circle.gif\" class=\"img_valign\" alt=\"Processing\" /> Processing order cancellation...',\r\n\t\t\t\t\t\t\t\t\tdiv_id: 'cancel_order',\r\n\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\r\n\t\t\t\t\t\t\t\t\t\top: 'cancel',\r\n\t\t\t\t\t\t\t\t\t\tstore_id: store_id,\r\n\t\t\t\t\t\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\t\t\t\t\t\tpaymentList: paymentList,\r\n\t\t\t\t\t\t\t\t\t\torder_notes: order_notes,\r\n\t\t\t\t\t\t\t\t\t\treason: reason,\r\n\t\t\t\t\t\t\t\t\t\tdeclined_MFY: declined_MFY,\r\n\t\t\t\t\t\t\t\t\t\tdeclined_Reschedule: declined_Reschedule,\r\n\t\t\t\t\t\t\t\t\t\tsuppress_cancel_email: suppress_cancel_email\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Order was Canceled',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.data,\r\n\t\t\t\t\t\t\t\t\t\t\t\tdiv_id: 'cancel_order',\r\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"OK\": function () {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof bounce_to != 'undefined')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbounce(bounce_to);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbounce(removeQueryVariable('order', window.location.href));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_cancel_order_delivered()\r\n{\r\n\t$('[id^=\"gd_cancel_delivered_order-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar session_id = $(this).data('session_id');\r\n\t\t\tvar order_id = $(this).data('order_id');\r\n\t\t\tvar store_id = $(this).data('store_id');\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar bounce_to = $(this).data('bounce');\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\t\top: 'cancel_preflight',\r\n\t\t\t\t\tstore_id: store_id,\r\n\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\torder_id: order_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json, status) {\r\n\t\t\t\t\tif (json.processor_success && json.data)\r\n\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Cancel Order?',\r\n\t\t\t\t\t\t\tmessage: json.data,\r\n\t\t\t\t\t\t\twidth: 700,\r\n\t\t\t\t\t\t\theight: 480,\r\n\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\topen: function () {\r\n\t\t\t\t\t\t\t\t$(\"#order_admin_notes_cancel\").on('keyup', function (e) {\r\n\r\n\t\t\t\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcanConfirm: function () {\r\n\t\t\t\t\t\t\t\tvar reason = $(\"#cancellation_reason\").val();\r\n\t\t\t\t\t\t\t\tif (reason == \"\")\r\n\t\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\tdiv_id: 'Uneek262020',\r\n\t\t\t\t\t\t\t\t\t\tmessage: \"Please select a reason for cancelling\"\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tconfirm: function (json, status) {\r\n\r\n\t\t\t\t\t\t\t\tvar paymentList = {};\r\n\t\t\t\t\t\t\t\t$(\"#cancel_parent :input\").each(function () {\r\n\r\n\t\t\t\t\t\t\t\t\tpaymentList[this.id] = $(this).val();\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tvar order_notes = $(\"#order_admin_notes_cancel\").val().trim();\r\n\t\t\t\t\t\t\t\tvar reason = $(\"#cancellation_reason\").val();\r\n\t\t\t\t\t\t\t\tvar declined_MFY = $('#declined_MFY').is(':checked');\r\n\t\t\t\t\t\t\t\tvar declined_Reschedule = $('#declined_to_reschedule').is(':checked');\r\n\t\t\t\t\t\t\t\tvar suppress_email = $('#suppress_reschedule_email').is(':checked');\r\n\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Cancelling order',\r\n\t\t\t\t\t\t\t\t\tmessage: '<img src=\"' + PATH.image_admin + '/style/throbber_circle.gif\" class=\"img_valign\" alt=\"Processing\" /> Processing order cancellation...',\r\n\t\t\t\t\t\t\t\t\tdiv_id: 'cancel_order',\r\n\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\t\t\t\t\t\t\top: 'cancel',\r\n\t\t\t\t\t\t\t\t\t\tstore_id: store_id,\r\n\t\t\t\t\t\t\t\t\t\tsession_id: session_id,\r\n\t\t\t\t\t\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\t\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\t\t\t\t\t\tpaymentList: paymentList,\r\n\t\t\t\t\t\t\t\t\t\torder_notes: order_notes,\r\n\t\t\t\t\t\t\t\t\t\treason: reason,\r\n\t\t\t\t\t\t\t\t\t\tdeclined_MFY: declined_MFY,\r\n\t\t\t\t\t\t\t\t\t\tdeclined_Reschedule: declined_Reschedule,\r\n\t\t\t\t\t\t\t\t\t\tsuppress_email: suppress_email\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Order was Canceled',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.data,\r\n\t\t\t\t\t\t\t\t\t\t\t\tdiv_id: 'cancel_order',\r\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"OK\": function () {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof bounce_to != 'undefined')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbounce(bounce_to);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbounce(removeQueryVariable('order', window.location.href));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: response\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handle_session_tools()\r\n{\r\n\t// session tool suppress fastlane cookie\r\n\tif ($.totalStorage('suppress_fastlane_labels') != null)\r\n\t{\r\n\t\tsuppress_fastlane_labels = $.totalStorage('suppress_fastlane_labels');\r\n\t\t$('#suppress_fastlane_labels').prop('checked', !suppress_fastlane_labels);\r\n\r\n\t}\r\n\r\n\t// session tool suppress fastlane click\r\n\t$('#suppress_fastlane_labels').on('click', function (e) {\r\n\r\n\t\tif ($(this).is(':checked'))\r\n\t\t{\r\n\t\t\t$.totalStorage('suppress_fastlane_labels', false);\r\n\t\t\tsuppress_fastlane_labels = false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$.totalStorage('suppress_fastlane_labels', true);\r\n\t\t\tsuppress_fastlane_labels = true;\r\n\t\t}\r\n\r\n\t\tupdate_session_tool_links();\r\n\r\n\t});\r\n\t// Dashboard Snapshot\r\n\t$('#ds_goal_tracking').on('click', function (e) {\r\n\r\n\t\tbounce('main.php?page=admin_reports_goal_management_v2&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path());\r\n\r\n\t});\r\n\r\n\t$('#ds_trending').on('click', function (e) {\r\n\r\n\t\tbounce('main.php?page=admin_reports_trending_menu_based&date=' + selected_date + '&store=' + STORE_DETAILS.id + '&back=' + back_path());\r\n\r\n\t});\r\n\r\n\t$('#ds_dashboard').on('click', function (e) {\r\n\r\n\t\tbounce('main.php?page=admin_dashboard_menu_based&override_month=' + selected_date + '&store=' + STORE_DETAILS.id + '&back=' + back_path());\r\n\r\n\t});\r\n\r\n\t// Session Controls\r\n\t$('#sd_edit_session').on('click', function (e) {\r\n\r\n\t\tif (view_session == true)\r\n\t\t{\r\n\t\t\tbounce('main.php?page=admin_edit_session&session=' + selected_session_id + '&back=' + back_path());\r\n\t\t}\r\n\r\n\t});\r\n\t// Session Controls\r\n\t$('#sd_email_session').on('click', function (e) {\r\n\r\n\t\tif (view_session == true)\r\n\t\t{\r\n\t\t\tbounce('main.php?page=admin_email&session=' + selected_session_id + '&back=' + back_path());\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$('#sd_publish_state').on('click', function (e) {\r\n\r\n\t\tif (view_session == true)\r\n\t\t{\r\n\t\t\tstate = $(this).data('session_publish_state');\r\n\r\n\t\t\tif (state == 'PUBLISHED')\r\n\t\t\t{\r\n\t\t\t\tnew_state = 'Close';\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tnew_state = 'Open';\r\n\t\t\t}\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: new_state + ' session confirmation',\r\n\t\t\t\tmessage: 'Are you sure you wish to <span style=\"font-weight: bold;\">' + new_state + '</span> this session?',\r\n\t\t\t\tmodal: true,\r\n\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tprocessor: 'admin_fadmin_home',\r\n\t\t\t\t\t\t\top: 'session_publish_state',\r\n\t\t\t\t\t\t\tsession_id: selected_session_id,\r\n\t\t\t\t\t\t\topen_close_submit: new_state\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t{\r\n\r\n\t\t\t\t\t\t\t\t$('#session-' + selected_session_id).scrollToTarget($('#session_selector'));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n\t// Session Controls\r\n\t$('#sd_session_meta').on('click', function (e) {\r\n\r\n\t\t$('.session_meta').toggle();\r\n\r\n\t\t$('#session_details_text').toggleClass('session_details_text');\r\n\r\n\t});\r\n\r\n\t// Day Controls\r\n\t$('#dd_create_session').on('click', function (e) {\r\n\r\n\t\tif (view_session != true)\r\n\t\t{\r\n\t\t\tbounce('main.php?page=admin_create_session&date=' + selected_date + '&menu=' + selected_menu_id + '&back=' + back_path());\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction update_session_tool_links()\r\n{\r\n\tif (view_session == true)\r\n\t{\r\n\t\t$('#st_customer_receipt').prop('href', 'main.php?page=admin_order_details_view_all&customer_print_view=1&session_id=' + selected_session_id + '&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_franchise_receipt').prop('href', 'main.php?page=admin_order_details_view_all&session_id=' + selected_session_id + '&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_entree_summary').prop('href', 'main.php?page=admin_reports_select_multi_session&query_submit=1&report_id=2&printer=1&pickSession=2&session_id=' + selected_session_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_side_dish_report').prop('href', 'main.php?page=admin_order_details_view_all&issidedish=1&session_id=' + selected_session_id + '&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_fast_lane_report').prop('href', 'main.php?page=admin_order_details_view_all&ispreassembled=1&session_id=' + selected_session_id + '&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_dream_rewards').prop('href', 'main.php?page=admin_reports_dream_rewards_for_session&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_future_orders').prop('href', 'main.php?page=admin_order_details_view_all_future&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_session_goal_sheet_print').prop('href', 'main.php?page=admin_reports_goal_tracking&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&report_submit=true&print=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_session_goal_sheet_xls').prop('href', 'main.php?page=admin_reports_goal_tracking&export=xlsx&hideheaders=true&csvfilename=SessionGoalSheet&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&report_submit=true&back=' + back_path());\r\n\t\t$('#st_print_labels').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&back=' + back_path() + '&suppressFastlane=' + suppress_fastlane_labels).prop('target', '_blank');\r\n\t\t$('#st_print_labels_w_breaks').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&back=' + back_path() + '&break=1&suppressFastlane=' + suppress_fastlane_labels).prop('target', '_blank');\r\n\t\t$('#st_print_labels_by_dinner').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels&session_id=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&order_by=dinner&suppressFastlane=' + suppress_fastlane_labels).prop('target', '_blank');\r\n\t\t$('#st_print_enrollment_forms').prop('href', 'main.php?page=admin_user_plate_points&session_id=' + selected_session_id + '&print_sessions_forms=true').prop('target', '_blank');\r\n\t\t$('#st_plate_points_status_and_rewards_report').prop('href', 'main.php?page=admin_reports_points_status_and_rewards&session_id=' + selected_session_id + '&back=' + back_path());\r\n\t\t$('#st_customer_menu_core').prop('href', 'main.php?page=admin_session_tools_printing&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&core=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_core_current').prop('href', 'main.php?page=admin_session_tools_printing&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&core=true&cur=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_freezer').prop('href', 'main.php?page=admin_session_tools_printing&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&freezer=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_nutrition').prop('href', 'main.php?page=admin_session_tools_printing&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&nutrition=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_core_freezer').prop('href', 'main.php?page=admin_session_tools_printing&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&core=true&freezer=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_core_freezer_nutrition').prop('href', 'main.php?page=admin_session_tools_printing&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&core=true&freezer=true&nutrition=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_daily_boxes_shipped').prop('href', 'main.php?page=admin_reports_delivered_daily_boxes&type=shipping&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_daily_boxes_delivered').prop('href', 'main.php?page=admin_reports_delivered_daily_boxes&type=delivering&do=print&session=' + selected_session_id + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#st_customer_receipt').prop('href', 'main.php?page=admin_order_details_view_all_multi&customer_print_view=1&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_franchise_receipt').prop('href', 'main.php?page=admin_order_details_view_all_multi&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_entree_summary').prop('href', 'main.php?page=admin_reports_select_multi_session&query_submit=1&report_date=' + selected_date + '&report_id=1&printer=1&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_side_dish_report').prop('href', 'main.php?page=admin_order_details_view_all_multi&issidedish=1&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_fast_lane_report').prop('href', 'main.php?page=admin_order_details_view_all_multi&ispreassembled=1&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_dream_rewards').prop('href', 'main.php?page=admin_reports_dream_rewards_for_session_multi&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_future_orders').prop('href', 'main.php?page=admin_order_details_view_all_future_multi&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_session_goal_sheet_print').prop('href', 'main.php?page=admin_reports_goal_tracking&multi_session=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&report_submit=true&print=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_session_goal_sheet_xls').prop('href', 'main.php?page=admin_reports_goal_tracking&export=xlsx&hideheaders=true&csvfilename=SessionGoalSheetSummary&multi_session=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&report_submit=true&back=' + back_path());\r\n\t\t$('#st_print_labels').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels_multi&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&back=' + back_path() + '&suppressFastlane=' + suppress_fastlane_labels).prop('target', '_blank');\r\n\t\t$('#st_print_labels_w_breaks').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels_multi&labels_per_sheet=4&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&back=' + back_path() + '&break=1&suppressFastlane=' + suppress_fastlane_labels).prop('target', '_blank');\r\n\t\t$('#st_print_labels_by_dinner').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels_multi&labels_per_sheet=4&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&menuid=' + selected_menu_id + '&order_by=dinner&back=' + back_path() + '&suppressFastlane=' + suppress_fastlane_labels).prop('target', '_blank');\r\n\t\t$('#st_print_enrollment_forms').prop('href', 'main.php?page=admin_user_plate_points&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&print_days_forms=true').prop('target', '_blank');\r\n\t\t$('#st_plate_points_status_and_rewards_report').prop('href', 'main.php?page=admin_reports_points_status_and_rewards&report_date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path());\r\n\t\t$('#st_customer_menu_core').prop('href', 'main.php?page=admin_session_tools_printing&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&core=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_core_current').prop('href', 'main.php?page=admin_session_tools_printing&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&core=true&cur=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_freezer').prop('href', 'main.php?page=admin_session_tools_printing&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&freezer=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_nutrition').prop('href', 'main.php?page=admin_session_tools_printing&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&nutrition=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_core_freezer').prop('href', 'main.php?page=admin_session_tools_printing&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&core=true&freezer=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_customer_menu_core_freezer_nutrition').prop('href', 'main.php?page=admin_session_tools_printing&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&core=true&freezer=true&nutrition=true&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_daily_boxes_shipped').prop('href', 'main.php?page=admin_reports_delivered_daily_boxes&type=shipping&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t\t$('#st_daily_boxes_delivered').prop('href', 'main.php?page=admin_reports_delivered_daily_boxes&type=delivering&do=print&date=' + selected_date + '&store_id=' + STORE_DETAILS.id + '&back=' + back_path()).prop('target', '_blank');\r\n\t}\r\n\r\n\t$('#st_finishing_touch_pick_sheet').prop('href', 'main.php?page=admin_finishing_touch_printable_form&store_id=' + STORE_DETAILS.id + '&menu_id=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n\t$('#st_print_generic_labels').prop('href', 'main.php?page=admin_reports_customer_menu_item_labels&store_id=' + STORE_DETAILS.id + '&interface=1&menuid=' + selected_menu_id + '&back=' + back_path()).prop('target', '_blank');\r\n}\r\n\r\nfunction handle_guest_search()\r\n{\r\n\t$(document).on('click', '#gs_search_go', function (e) {\r\n\r\n\t\tcreate_and_submit_form({\r\n\t\t\tmethod: 'get',\r\n\t\t\taction: 'main.php',\r\n\t\t\tinput: ({\r\n\t\t\t\t'page': 'admin_list_users',\r\n\t\t\t\t'search_type': $('#gs_search_type').val(),\r\n\t\t\t\t'all_stores': ($('#gs_search_all').is(':checked') ? 1 : 0),\r\n\t\t\t\t'q': $('#gs_search_value').val(),\r\n\t\t\t\t'back': back_path()\r\n\t\t\t})\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t$(document).on('change', '#gs_search_type', function (e) {\r\n\r\n\t\tmanualSearchTypeChange = true;\r\n\r\n\t\t$('#gs_search_value').unmask();\r\n\r\n\t\tif ($('#gs_search_type').val() == 'phone')\r\n\t\t{\r\n\t\t\t$('#gs_search_value').mask('999-999-9999');\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$(document).on('keyup', '#gs_search_value', function (e) {\r\n\r\n\t\tif (e.which == 13)\r\n\t\t{\r\n\t\t\t$('#gs_search_go').trigger('click');\r\n\t\t}\r\n\r\n\t\tdetect_guest_search_type();\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction detect_order_search_type()\r\n{\r\n\t// user manually changed search type, don't automatically change it\r\n\tif (manualOrderSearchTypeChange == true)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar value = $('#os_search_value').val();\r\n\r\n\t// not numeric entry, start with last name\r\n\tif (!$.isNumeric(value))\r\n\t{\r\n\t\t$('#os_search_type').val('confirmation');\r\n\t}\r\n\r\n\t// numeric entry, probably guest id\r\n\tif ($.isNumeric(value))\r\n\t{\r\n\t\t$('#os_search_type').val('id');\r\n\t}\r\n\r\n}\r\n\r\nfunction detect_guest_search_type()\r\n{\r\n\t// user manually changed search type, don't automatically change it\r\n\tif (manualSearchTypeChange == true)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar value = $('#gs_search_value').val();\r\n\r\n\t// not numeric entry, start with last name\r\n\tif (!$.isNumeric(value))\r\n\t{\r\n\t\t$('#gs_search_type').val('lastname');\r\n\t}\r\n\r\n\t// numeric entry, probably guest id\r\n\tif ($.isNumeric(value))\r\n\t{\r\n\t\t$('#gs_search_type').val('id');\r\n\t}\r\n\r\n\t// has @ symbol, probably email\r\n\tif (value.indexOf(\"@\") != -1)\r\n\t{\r\n\t\t$('#gs_search_type').val('email');\r\n\t}\r\n\r\n\t// has space, probably first and last name\r\n\tif (value.indexOf(\" \") != -1)\r\n\t{\r\n\t\t$('#gs_search_type').val('firstlast');\r\n\t}\r\n}\r\n\r\nfunction handle_go_to_today()\r\n{\r\n\t$('#go_to_today').on('click', function (e) {\r\n\r\n\t\tgo_to_today();\r\n\r\n\t});\r\n}\r\n\r\nfunction go_to_today()\r\n{\r\n\tinit_go_to_today = true;\r\n\r\n\tdate_select = get_todays_date().slice(0, -3);\r\n\r\n\tif (selected_agenda_month != undefined && selected_agenda_month != date_select)\r\n\t{\r\n\t\tlet val = $(\"#month_selector option[data-menu_month='\"+date_select+\"']\").val();\r\n\t\t$('#month_selector').val(val).trigger('change');\r\n\t}\r\n\r\n\t$('.selected').removeClass('selected');\r\n\r\n\tvar todays_date = get_todays_date();\r\n\r\n\t$('#day_' + todays_date).scrollToTarget($('#session_selector')).addClass('selected');\r\n\r\n\tinit_go_to_today = false;\r\n}\r\n\r\nfunction handle_preselection()\r\n{\r\n\tif (getQueryVariable('session') && $('#session-' + getQueryVariable('session')).length)\r\n\t{\r\n\t\t$('#session-' + getQueryVariable('session')).scrollToTarget($('#session_selector'));\r\n\t}\r\n\telse if (getQueryVariable('day') && $('#day_' + getQueryVariable('day')).length)\r\n\t{\r\n\t\t$('#day_' + getQueryVariable('day')).scrollToTarget($('#session_selector'));\r\n\t}\r\n\telse\r\n\t{\r\n\t\tgo_to_today();\r\n\t}\r\n}\r\n\r\nfunction confirm_order_attended(user_id, order_id)\r\n{\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'plate_points_processor',\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'confirm_order',\r\n\t\t\torder_id: order_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$(\"[id^=pp_co_\" + user_id + \"_\" + order_id + \"]\").html(json.points_this_order);\r\n\r\n\t\t\t\tif (json.total_credit)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"[id^=pp_credit_\" + user_id + \"_\" + order_id + \"]\").text('$' + json.total_credit);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\n// jquery plugins\r\n(function ($) {\r\n\r\n\t//create jquery scrollToTarget method\r\n\t$.fn.scrollToTarget = function (target, callback) {\r\n\t\tvar elem = $(this);\r\n\r\n\t\tif (elem.length)\r\n\t\t{\r\n\t\t\tvar target_top = $(target).position().top;\r\n\t\t\tvar target_bottom = target_top + $(target).height();\r\n\r\n\t\t\tvar elem_top = $(elem).position().top;\r\n\t\t\tvar elem_bottom = elem_top + $(elem).height();\r\n\r\n\t\t\t// only scroll if element is out of bounds\r\n\t\t\tif ((elem_top > target_top && elem_bottom < target_bottom) || (elem_top < target_top && elem_bottom > target_bottom))\r\n\t\t\t{\r\n\t\t\t\telem.trigger('click');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ttarget.scrollTo(\r\n\t\t\t\t\tthis,\r\n\t\t\t\t\t800,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toffset: -25,\r\n\t\t\t\t\t\teasing: 'easeOutBack',\r\n\t\t\t\t\t\tonAfter: function () {\r\n\t\t\t\t\t\t\telem.trigger('click');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn elem;\r\n\t};\r\n\r\n})(jQuery);\r\n\r\n\r\n$(document).on('click keyup', '#os_search_go, #os_search_value', function (e) {\r\n\r\n\tlet this_id = $(this).attr('id');\r\n\r\n\tif (this_id == 'os_search_value')\r\n\t{\r\n\t\t// if the enter key is pressed, execute search else stop\r\n\t\tif (e.which != 13)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tlet order_id = $.trim($('#os_search_value').val());\r\n\r\n\tif (!order_id.match(/^[0-9a-z]+$/i))\r\n\t{\r\n\t\tbootbox.alert(\"Invalid character in order ID.\");\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_helpers',\r\n\t\t\top: 'order_search',\r\n\t\t\torder_identifier: order_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tbounce(json.bounce_to);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tbootbox.alert(json.processor_message);\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t}\r\n\r\n\t});\r\n\r\n});"],"names":["selected_session_id","view_session","manualSearchTypeChange","manualOrderSearchTypeChange","init_go_to_today","suppress_fastlane_labels","main_init","handle_agenda_click","handle_agenda_month_select","handle_session_tools","handle_go_to_today","handle_guest_search","handle_preselection","handle_order_details_table","init_looping_timers","start_dashboard_snapshot_timer","start_unix_expiry_timer","register_booking_click_handlers","handle_booking_row_click","handle_booking_no_show","handle_platepoints_gifts","handle_food_testing_recipe","handle_pp_opted_out","handle_delayed_payment_tc","handle_session_rsvp","handle_resend_delivered_to_shipstation","handle_fetch_tracking_from_shipstation","$","each","this","on","event","preventDefault","orderId","data","ajax","url","type","timeout","dataType","processor","op","order","success","json","processor_success","dd_toast","message","error","objAJAXRequest","strError","control","processor_tracking_number","html","e","rsvp_session_id","dd_message","title","form_add_guest","height","width","div_id","closeOnEscape","noOk","open","ui","mask","buttons","dialog","acceptFunction","Accept","parent","find","hide","keyup","keyCode","ENTER","add_guest_ui","_check_form","primary_email_login","val","password_login","firstname","lastname","telephone_1","rsvp_dream_taste","remove","processor_message","response","Cancel","handle_dashboard_update","user_id","session_id","modal","confirm","status","handle_session_rsvp_guest_find","guest","booking_id","order_id","show","animate","scrollTop","offset","top","stop","order_details_table","getQueryVariable","update_page_url","store_id","STORE_DETAILS","id","USER_DETAILS","level","gift_id","order_sequence_number","giftDisplayString","numDue","length","numNotDue","received_gifts","doTimeout","unixtime","Math","round","Date","getTime","filter","hasClass","addClass","set_selected_date","new_date","cur_menu_id","new_menu_id","selected_date","is","dashboard_date","dashboard_metrics","dashboard_title","removeClass","help_system_init","selected_agenda_month","selected_agenda_month_id","doasync","async","agenda_date","agenda_month_id","session_info","date","scrollToTarget","lang","en","tc","terms_and_conditions","delayed_payment","Agree","set_user_pref","Decline","delayed_payment_decline","window","booking_query","abort","PATH","image_admin","order_details","current_menu_id","selected_menu_id","menu_id","session_start_dtf_ymd","update_session_tool_links","session_start_dtf_verbose_date","attention","session_start_dtf_time_only","session_details","publish_state_button_text","session_publish_state","session_data","session_type","shipping_bookings_count","delivered_bookings_count","remaining_slots","session_type_subtype","additional_orders","undefined","booked_count","num_rsvps","remaining_intro_slots","booking_details","trigger","bounce","resend_dream_taste_notification","days_menu","submitted_date","date_info","date_dtf_verbose_date","date_details","scrollTo","hover","page_url","historyPush","prop","bounce_to","state","checked","bid","selector_elem","survey_name","text","survey_id","split","survey_size","Confirm","handle_guest_account_notes","do_op","guest_note","get_user_pref","textarea_elem","guest_preferences","value","strip_tags","nl2br","handle_admin_carryover_notes","button_obj","hide_carryover_notes","do","note","user_data_value","handle_admin_order_notes","let","unique_id","buttonName","admin_note","handle_reschedule_button","css","cursor","create_and_submit_form","method","action","input","original_session_id","menus","back_address","back_path","handle_cancel_order","handle_cancel_order_delivered","handle_delete_saved_order","handle_delete_saved_order_delivered","location","href","doRefresh","Refresh","validateKey","evt","charCode","which","returnValue","validateAmount","obj","limit","isNaN","canConfirm","reason","paymentList","order_notes","trim","declined_MFY","declined_Reschedule","suppress_cancel_email","OK","removeQueryVariable","suppress_email","totalStorage","new_state","open_close_submit","toggle","toggleClass","document","page","search_type","all_stores","q","back","unmask","detect_guest_search_type","detect_order_search_type","isNumeric","indexOf","go_to_today","date_select","get_todays_date","slice","todays_date","confirm_order_attended","points_this_order","total_credit","fn","target","callback","elem","target_top","position","target_bottom","elem_top","elem_bottom","easing","onAfter","jQuery","this_id","attr","match","bootbox","alert","order_identifier"],"mappings":"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"}
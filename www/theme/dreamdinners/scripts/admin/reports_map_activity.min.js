var timeframe=60,checkperiod=10,last_time=(new Date).getTime()/1e3-60*timeframe,map=null,markers=[],hasrun=!1;function initMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:5,mapTypeId:"roadmap"}),(new google.maps.Geocoder).geocode({address:"United States"},(function(e,t){t==google.maps.GeocoderStatus.OK?map.setCenter(e[0].geometry.location):alert("Could not find location: "+location)})),map_activity_timer()}function map_activity_timer(){$.doTimeout("map_activity_timer"),$.doTimeout("map_activity_timer",1e3*checkperiod,(function(){return $.ajax({url:"/processor",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_reports_map_activity",last_time:last_time},success:function(e,t){time_in=1,$.each(e.data,(function(e){time_in++;var t=this;this.timestamp_updated_unix>last_time&&(last_time=this.timestamp_updated_unix),setTimeout((function(e){set_marker(t,PATH.image+"/style/logo/heart-grn-75x55.png",0),console.log((new Date).toTimeString().slice(0,8)+": Adding marker #"+t.id)}),200*time_in),fadmin_is_idle(!1)}))},error:function(e,t){}}),USER_LOGGEDIN&&$.cookie("DreamSite_TO")&&(TO=$.cookie("DreamSite_TO"),fadmin_is_idle(!1)),!0})),$.doTimeout("map_activity_timer",!0)}function sort_list(){$("#event").each((function(){$(this).html($(this).children("li").sort((function(e,t){return $(t).data("time")>$(e).data("time")?1:-1})))}))}function set_marker(e,t,i){var a=new google.maps.Marker({animation:google.maps.Animation.DROP,position:{lat:e.lat,lng:e.lon},map:map,icon:t,zIndex:i});create_event(e,t);var o=(new Date).getTime(),n=1e3*e.timestamp_updated_unix+60*timeframe*1e3-o;markers[e.id]={marker:a,expire:n,marker_data:e},setTimeout((function(t){markers[e.id].marker.setMap(null),$("#"+e.id).slideUp("normal",(function(){$(this).remove()})),update_servings(e,!0),update_foundation(e,!0),console.log((new Date).toTimeString().slice(0,8)+": Removing marker #"+e.id)}),n)}function create_event(e,t){$('<li id="'+e.id+'" data-time="'+e.timestamp_updated_unix+'" class="event row py-1 m-0 border-bottom cursor-pointer">').html('<div class="col-2 align-self-center"><img src="'+t+'" /></div><div class="col-10"><div class="font-weight-bold">'+e.firstname+" "+e.lastname_letter+"</div><div>"+e.store_name+", "+e.state+'</div><div class="text-muted font-size-small">'+e.date_time+"</div></div>").prependTo($("#event")).hide().slideDown(),update_servings(e,!1),update_foundation(e,!1),sort_list()}function update_servings(e,t){if(0==t)var i=$("#servings").data("total")+e.servings_total_count;else i=$("#servings").data("total")-e.servings_total_count;$("#servings").data("total",i),$("#servings").text(i.toLocaleString("en"))}function update_foundation(e,t){if(0==t)var i=$("#foundation").data("total")+e.ltd_round_up_value+e.subtotal_ltd_menu_item_value;else i=$("#foundation").data("total")-e.ltd_round_up_value-e.subtotal_ltd_menu_item_value;$("#foundation").data("total",i),$("#foundation").text(Math.floor(i/.25).toLocaleString("en"))}function toggleBounce(e){null!==markers[e].marker.getAnimation()?(markers[e].marker.setAnimation(null),$("#"+e).removeClass("border-width-2-imp border-green")):(markers[e].marker.setZIndex(100),markers[e].marker.setAnimation(google.maps.Animation.BOUNCE),$("#"+e).addClass("border-width-2-imp border-green"))}$(document).on("click",".event",(function(){toggleBounce(this.id)}));
//# sourceMappingURL=reports_map_activity.min.js.map
var timeframe=60;var checkperiod=10;var last_time=(new Date).getTime()/1e3-timeframe*60;var map=null;var markers=[];var hasrun=false;function initMap(){var e="United States";var t={zoom:5,mapTypeId:"roadmap"};map=new google.maps.Map(document.getElementById("map"),t);var a=new google.maps.Geocoder;a.geocode({address:e},function(e,t){if(t==google.maps.GeocoderStatus.OK){map.setCenter(e[0].geometry.location)}else{alert("Could not find location: "+location)}});map_activity_timer()}function map_activity_timer(){$.doTimeout("map_activity_timer");$.doTimeout("map_activity_timer",checkperiod*1e3,function(){$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_reports_map_activity",last_time:last_time},success:function(e,t){time_in=1;$.each(e.data,function(e){time_in++;var t=this;if(this.timestamp_updated_unix>last_time){last_time=this.timestamp_updated_unix}setTimeout(function(e){set_marker(t,PATH.image+"/style/logo/heart-grn-75x55.png",0);console.log((new Date).toTimeString().slice(0,8)+": Adding marker #"+t.id)},time_in*200);fadmin_is_idle(false)})},error:function(e,t){}});if(USER_LOGGEDIN&&$.cookie("DreamSite_TO")){TO=$.cookie("DreamSite_TO");fadmin_is_idle(false)}return true});$.doTimeout("map_activity_timer",true)}function sort_list(){$("#event").each(function(){$(this).html($(this).children("li").sort(function(e,t){return $(t).data("time")>$(e).data("time")?1:-1}))})}function set_marker(t,e,a){var i=new google.maps.Marker({animation:google.maps.Animation.DROP,position:{lat:t.lat,lng:t.lon},map:map,icon:e,zIndex:a});create_event(t,e);var n=(new Date).getTime();var o=t.timestamp_updated_unix*1e3+timeframe*60*1e3-n;markers[t.id]={marker:i,expire:o,marker_data:t};setTimeout(function(e){markers[t.id].marker.setMap(null);$("#"+t.id).slideUp("normal",function(){$(this).remove()});update_servings(t,true);update_foundation(t,true);console.log((new Date).toTimeString().slice(0,8)+": Removing marker #"+t.id)},o)}function create_event(e,t){$('<li id="'+e.id+'" data-time="'+e.timestamp_updated_unix+'" class="event row py-1 m-0 border-bottom cursor-pointer">').html('<div class="col-2 align-self-center"><img src="'+t+'" /></div><div class="col-10"><div class="font-weight-bold">'+e.firstname+" "+e.lastname_letter+"</div><div>"+e.store_name+", "+e.state+'</div><div class="text-muted font-size-small">'+e.date_time+"</div></div>").prependTo($("#event")).hide().slideDown();update_servings(e,false);update_foundation(e,false);sort_list()}function update_servings(e,t){if(t==false){var a=$("#servings").data("total")+e.servings_total_count}else{var a=$("#servings").data("total")-e.servings_total_count}$("#servings").data("total",a);$("#servings").text(a.toLocaleString("en"))}function update_foundation(e,t){if(t==false){var a=$("#foundation").data("total")+e.ltd_round_up_value+e.subtotal_ltd_menu_item_value}else{var a=$("#foundation").data("total")-e.ltd_round_up_value-e.subtotal_ltd_menu_item_value}$("#foundation").data("total",a);$("#foundation").text(Math.floor(a/.25).toLocaleString("en"))}function toggleBounce(e){if(markers[e].marker.getAnimation()!==null){markers[e].marker.setAnimation(null);$("#"+e).removeClass("border-width-2-imp border-green")}else{markers[e].marker.setZIndex(100);markers[e].marker.setAnimation(google.maps.Animation.BOUNCE);$("#"+e).addClass("border-width-2-imp border-green")}}$(document).on("click",".event",function(){toggleBounce(this.id)});
//# sourceMappingURL=reports_map_activity.min.js.map
var itemChanges=false;var discountOrPaymentChanges=false;var deliveryChanges=false;var discountChanges=false;var reportingChanges=false;var paymentChanges=false;var changeList=null;var currentlySavingOrder=false;var intenseLoggingOn=true;var boxesDeletedFromActiveOrder=[];var needPlatePointsMaxDiscountChangeWarning=false;var lastMaxPPDiscountAmount=-1;function admin_order_mgr_init(){if(store_id!=STORE_DETAILS.id){STORE_DETAILS.id=store_id}if(orderState=="NEW"){setupForNewOrder()}else if(orderState=="SAVED"){setupForSavedOrder()}else{setupForActiveOrder()}initChangeList();init_inside_box_editing();if(orderState!="NEW"){calculateTotal();setAllPaymentFieldsToUnrequired();setupCouponState()}setUpKeyHandlers();handle_special_instruction_notes();handle_cancel_order_delivered();handle_delete_saved_order_delivered();handle_free_menu_item_edit();handleDirectOrderDiscountFocusing();$("#shipping_phone_number").trigger("change");updateInventory();handle_is_gift()}function handleSessionSelection(){$("[data-select_delivery_day]").on("click",function(){let e=$(this).data("select_delivery_day");let t=$(this).data("date");doReschedule(e,t)})}function handle_is_gift(){if($("#shipping_is_gift").is(":checked")){$(".shipping_email_address_div").show()}else{$(".shipping_email_address_div").hide()}$("#shipping_is_gift").on("change",function(){if($(this).is(":checked")){$(".shipping_email_address_div").show()}else{$(".shipping_email_address_div").hide()}})}function validateBoxes(){let s=false;let i=true;$("[id^='box_inst_id_']").each(function(){let a=this.id.split("_")[3];if($(this).data("contents_are_fixed")==true){s=true}else{s=true;let e=0;$("input").filter("[data-box_inst_id='"+a+"']").each(function(){e+=$(this).val()*1});let t=$("#box_inst_id_"+a).data("number_items_required");if(t!=e){i=false}}});return s&&i}function countItemsInBox(e){let t=0;$("[id^='qty_"+e+"_']").each(function(){t+=$(this).val()*1});return t}function init_inside_box_editing(){$("[id^='qty_']").off("click",function(){});$("[id^='qty_']").on("change",function(){let e=false;let t=false;let a=this.id.split("_")[2];let s=this.id.split("_")[1];let i=$("#box_inst_id_"+s).data("number_items_required");let n=$(this).val();let r=countItemsInBox(s);if(r>i){let e=r-i;$(this).val(n-e);t=true}n=$(this).val();if(isNaN(n)){n=0;$(this).val(0)}if(n<0){n=0;$(this).val(0)}if(n-Math.floor(n)!=0){n=Math.floor(n);$(this).val(n)}let o=$(this).data("last_qty");var d=$(this).data("servings_per_item");var _=$(this).data("recipe_id");if(n>2){e=true;$(this).val(2);n=2}let l=(n-o)*d;while(l>current_inventory[_]){n--;l=(n-o)*d}$(this).val(n);$(this).data("last_qty",n);current_inventory[_]-=l;$("[id^='inv_']").filter("[data-recipe_id='"+_+"']").html(current_inventory[_]+"/serv");updateChangeList();if(t&&e){dd_message({title:"Error",message:"Each box can only have up to 2 of the same menu item and a total of "+i+" items."})}else if(e){dd_message({title:"Error",message:"Each box can only have up to 2 of the same menu item"})}else if(t){dd_message({title:"Error",message:"You can only add a total of "+i+" items to this box."})}})}function addToInitialInventory(e){if($(this).data("contents_are_fixed")==true){$("[id^='qty_"+e+"_']").each(function(){var e=$(this).val();var t=$(this).data("recipe_id");var a=$(this).data("servings_per_item");var s=initial_inventory[t];var i=s+e*a;initial_inventory[t]=i})}else{$("input").filter("[data-box_inst_id='"+e+"']").each(function(){var e=$(this).val();var t=$(this).data("recipe_id");var a=$(this).data("servings_per_item");var s=current_inventory[t];var i=s+e*a;initial_inventory[t]=i})}}$(document).on("click",".add_box",function(e){let t=$(this).data("bundle_id");let a=$(this).data("box_id");let s=$(this).data("box_type");let i=$(this).data("box_label");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"add_box",bundle_id:t,box_id:a,box_type:s,box_label:i,menu_id:menu_id,store_id:store_id,order_id:order_id,user_id:user_id},success:function(a){if(a.processor_success){$("#box_editor").append(a.html);let e=$("#subtotal_delivery_fee").val();let t=Number(formatAsMoney(e))+Number(formatAsMoney(a.bundle_info.price_shipping));$("#subtotal_delivery_fee").val(t);updateInventory();calculateTotal();init_inside_box_editing()}else{dd_message({title:"Error",message:a.processor_message})}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})});$(document).on("click",".box-delete",function(e){let a=$(this).data("box_instance_id");if(orderState=="ACTIVE"){let e=$("#subtotal_delivery_fee").val();let t=Number(formatAsMoney(e))-Number(formatAsMoney($("#box_inst_id_"+a).data("price_shipping")));$("#subtotal_delivery_fee").val(t);addToInitialInventory(a);boxesDeletedFromActiveOrder[a]=$("#box_inst_id_"+a).data("box_label");$("#bi_"+a).remove();updateInventory();calculateTotal();return}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"delete_box",box_inst_id:a,order_id:order_id,user_id:user_id},success:function(e){if(e.processor_success){$("#bi_"+a).remove();updateInventory();calculateTotal()}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})});function updateInventory(){current_inventory=Object.assign({},initial_inventory);$("[id^='box_inst_id_']").each(function(){let e=this.id.split("_")[3];if($(this).data("contents_are_fixed")==true){$("[id^='qty_"+e+"_']").each(function(){var e=$(this).val();var t=$(this).data("claimed_qty");e-=t;var a=$(this).data("recipe_id");var s=$(this).data("servings_per_item");var i=current_inventory[a];var n=i-e*s;current_inventory[a]=n})}else{$("input").filter("[data-box_inst_id='"+e+"']").each(function(){var e=$(this).val();var t=$(this).data("claimed_qty");e-=t;var a=$(this).data("recipe_id");var s=$(this).data("servings_per_item");var i=current_inventory[a];var n=i-e*s;current_inventory[a]=n})}});for(const e in current_inventory){$("[id^='inv_']").filter("[data-recipe_id='"+e+"']").each(function(){if(current_inventory[e]==0){$(this).html("Out of stock")}else{$(this).html(current_inventory[e]+"/serv")}})}}function handleDirectOrderDiscountFocusing(){$("#plate_points_discount, #direct_order_discount").focus(function(e){if($(this).val()==0){$(this).val("")}if($(this).val().length>0){$(this).select()}});$("#plate_points_discount, #direct_order_discount").blur(function(e){var t=$(this).val();t=t.trim();if(t==""||isNaN(t)){$(this).val("0")}})}function intenseLogging(e){if(window.console&&intenseLoggingOn){console.log("OM Intense logging: "+e)}}function saveSpecialInstructions(){var e=strip_tags($("#order_user_notes").val());$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,user_id:user_id,op:"update_special_instructions",order_id:order_id,special_instructions:e},success:function(e){if(e.processor_success){updateInstructionsOrgValues()}else{intenseLogging("saveSpecialInstructions: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){intenseLogging("saveSpecialInstructions: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function handle_special_instruction_notes(){$('[id^="gd_special_instruction_note_button-"]').each(function(){$(this).on("click",function(e){var a=$(this).data("booking_id");var t=$(this).data("user_id");var s="get";var i="";if($(this).data("edit_mode")==true){s="save";i=strip_tags($("#gd_special_instruction_note-"+a+" > textarea").val())}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"update_special_instructions",do:s,store_id:STORE_DETAILS.id,user_id:t,order_id:order_id,note:i},success:function(e){if(e.processor_success){if(s=="get"){var t=$("<textarea></textarea>").addClass("form-control").val(e.special_instruction_note?e.special_instruction_note:"").on("keyup",function(e){if($(this).val()!=strip_tags($(this).val())){$(this).val(strip_tags($(this).val()))}});$("#gd_special_instruction_note-"+a).addClass("special_instruction_note_edit").html(t);$("#gd_special_instruction_note_button-"+a).data("edit_mode",true).html("Save Note");$("#gd_special_instruction_note_cancel_button-"+a).data("special_instruction_note_value",e.special_instruction_note?e.special_instruction_note:"").on("click",function(e){$("#gd_special_instruction_note-"+$(this).data("booking_id")).removeClass("special_instruction_note_edit").html($(this).data("special_instruction_note_value"));$("#gd_special_instruction_note_button-"+$(this).data("booking_id")).data("edit_mode",false).html("Special Instructions");$(this).hide()}).show()}else{$("#gd_special_instruction_note-"+a).removeClass("special_instruction_note_edit").html(nl2br(e.special_instruction_note));$("#gd_special_instruction_note_cancel_button-"+a).hide();$("#gd_special_instruction_note_button-"+a).data("edit_mode",false).html("Special Instructions")}}},error:function(e,t){intenseLogging("handle_special_instruction_notes: "+t+" | "+e.responseText);response="Unexpected error"}})})})}function setUpKeyHandlers(){document.onkeypress=OMDefaultKeyHandler;$("#coupon_code").on("keypress",function(e){e=e?e:event;var t=e.charCode?e.charCode:e.which?e.which:e.keyCode;if(t==13){processCode();e.stopPropagation();return false}return true});$("#order_user_notes").on("keypress",function(e){e.stopPropagation();return true});$("#payment1_gc_payment_number").on("keyup",function(e){if($(this).val().length==15&&!isNaN($(this).val())&&$(this).val()!=lastCheckedGiftCertNumber){dd_message({title:"Warning",message:"It appears that you may be entering a gift Card number. If so, select Gift Card from payment selector. This is the Certificate (Gift Certificate) payment type."})}lastCheckedGiftCertNumber=$(this).val();return true})}function OMDefaultKeyHandler(e){e=e?e:event;var t=e.charCode?e.charCode:e.which?e.which:e.keyCode;if(t==13){return false}return true}function initChangeList(){$("#changeListTab").on("click",function(){var e=getChangeListHTML();if(!e||e==""){e="<h3><i>No Changes</i></h3>"}dd_message({title:"Change List",message:e,height:620,width:300,modal:false,div_id:"changelist",dialogClass:"fixedDialog",noOk:true,position:{my:"left top",at:"left bottom",of:this},close:function(e,t){$("#changelist").remove()}})})}function updateItemsOrgValues(){updateChangeList()}function saveAll(){saveItems(true,false,true)}function saveItems(t,a){intenseLogging("saveItems() called");if(currentlySavingOrder){dd_toast({message:"Items are still being saved",position:"topcenter"});return}dd_toast({message:"Items Saved",position:"topcenter"});if(a){if(!validateBoxes()){$("#activate_confirm").remove();dd_message({title:"Problem with boxes",message:"Please review the selected box(es) and ensure item counts are correct."});return}}var s={};$("[id^='box_inst_id_']").each(function(){let e=this.id.split("_")[3];s[e]={};if($(this).data("contents_are_fixed")==true){$("li[data-box_inst_id|='"+e+"']").each(function(){s[e][$(this).data("menu_item_id")]=1})}else{$("input").filter("[data-box_inst_id='"+e+"']").each(function(){s[e][$(this).data("menu_item_id")]=$(this).val()})}});var e=$("#subtotal_delivery_fee").val();if(isNaN(e)){e="0.00"}var i=$("#order_user_notes").val();currentlySavingOrder=true;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,user_id:user_id,op:"update_items",order_id:order_id,items:s,subtotal_delivery_fee:e,special_instructions:i},success:function(e){if(e.processor_success){itemTabIsDirty=false;updateItemsOrgValues();currentlySavingOrder=false;intenseLogging("saveItems() successful");if(t){saveDiscounts(a)}}else{currentlySavingOrder=false;intenseLogging("update_items: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){currentlySavingOrder=false;intenseLogging("update_items: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function setShipToAddressAndSaveOrder(){var e={};$("[id^='shipping_']").each(function(){e[this.id]=$(this).val()});if($("#shipping_is_gift").is(":checked")){e["shipping_is_gift"]="on"}else{e["shipping_is_gift"]="0"}intenseLogging("setShipToAddressAndSaveOrder() called");$.ajax({url:"ddproc.php",type:"POST",timeout:2e5,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,user_id:user_id,op:"save_delivery_address",shipping_data:e,order_state:orderState,order_id:order_id},success:function(e){if(e.processor_success){intenseLogging("setShipToAddressAndSaveOrder() successful");bounce("main.php?page=admin_order_mgr_delivered&order="+e.order_id+"&atabs=mgr.sessionsTab")}else{intenseLogging("setShipToAddressAndSaveOrder: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){intenseLogging("save_delivery_address: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function Reschedule(e){intenseLogging("Reschedule() called");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,op:"reschedule",session_id:session_id,user_id:user_id,order_id:order_id,saved_booking_id:saved_booking_id,org_session_id:e,order_state:orderState},success:function(e){if(e.processor_success){intenseLogging("Reschedule() successful");session_id=e.new_session_id;$("#curSessionDate").html(e.new_session_time);$("#curShipDate").html(e.new_ship_time);$("#session").val(e.new_session_id);RetrieveCalendar(0)}else{intenseLogging("reschedule: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){response="Unexpected error: "+t;intenseLogging("reschedule: "+t+" | "+e.responseText);dd_message({title:"Error",message:response})}})}function onSaveItems(){intenseLogging("onSaveItems() called");saveItems(false,false,false);return false}function setupForNewOrder(){HideLineItemsIfZero();var e=getQueryVariable("month")}function setupForSavedOrder(){RetrieveCalendar(0);$("#addPaymentAndActivate").show();$("#addPaymentAndActivateButton").attr("disabled","disabled");$("#items_tab_li").removeClass("disabled");$("#items_tab_li").removeClass("unsaved_data_on_tab")}function setupForActiveOrder(){if(discountEligable.limited_access){$("#payments_tab_li").click();$("#items_tab_li").addClass("disabled");$("#sessions_tab_li").addClass("disabled");$("#discountsDiv").find(":input").prop("disabled",true);$("#discountsDiv").find("*").addClass("om_disabled")}$("#addPaymentAndActivate").hide()}function isDeliveryAddressComplete(){var e=true;$("[id^='shipping_']").each(function(){if(!$(this).val()&&$(this).attr("required")){e=false}});return e}function onDeliveryTabSelected(){}function onDeliveryTabDeselected(){return true}function onSessionTabSelected(){RetrieveCalendar(0)}function onSessionTabDeselected(){return true}function onItemsTabSelected(){}function onItemsTabDeselected(){if(orderState!="ACTIVE"){if(itemTabIsDirty){saveItems(false,false,false)}}return true}function onPaymentTabSelected(){}function onPaymentTabDeselected(){if(orderState!="ACTIVE"&&(discountChanges||reportingChanges)){saveDiscounts(false,false)}return true}function onNotesTabSelected(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,op:"get_history",session_id:session_id,user_id:user_id,order_id:order_id},success:function(e){$("#history_div").html(e.html);handle_guest_account_notes();handle_admin_carryover_notes();handle_admin_order_notes()},error:function(e,t){response="Unexpected error: "+t;intenseLogging("get_history: "+t+" | "+e.responseText);dd_message({title:"Error",message:response})}})}function onNotesTabDeselected(){return true}function onPaymentSelected(){if(orderState!="ACTIVE"){$("#addPaymentAndActivateButton").attr("disabled",false);paymentChanges=true;updateChangeList()}else{paymentChanges=true;updateChangeList()}}function onPaymentDeselected(){if(orderState!="ACTIVE"){$("#addPaymentAndActivateButton").attr("disabled",true);updateChangeList();paymentChanges=false}else{paymentChanges=false;updateChangeList()}return true}function updateDiscountOrgValues(){$("#org_coupon_id").val($("#coupon_id").val());updateChangeList()}function _validate_discounts(){return true}function _validate_address(){validationSuccess=true;if($("#shipping_firstname").val().length==0){$("#shipping_firstname").removeClass("is-valid");$("#shipping_firstname").addClass("is-invalid");validationSuccess=false}else{$("#shipping_firstname").removeClass("is-invalid");$("#shipping_firstname").addClass("is-valid")}if($("#shipping_lastname").val().length==0){$("#shipping_lastname").removeClass("is-valid");$("#shipping_lastname").addClass("is-invalid");validationSuccess=false}else{$("#shipping_lastname").removeClass("is-invalid");$("#shipping_lastname").addClass("is-valid")}if($("#shipping_address_line1").val().length==0){$("#shipping_address_line1").removeClass("is-valid");$("#shipping_address_line1").addClass("is-invalid");validationSuccess=false}else{$("#shipping_address_line1").removeClass("is-invalid");$("#shipping_address_line1").addClass("is-valid")}if($("#shipping_city").val().length==0){$("#shipping_city").removeClass("is-valid");$("#shipping_city").addClass("is-invalid");validationSuccess=false}else{$("#shipping_city").removeClass("is-invalid");$("#shipping_city").addClass("is-valid")}if($("#shipping_state_id").val().length==0){$("#shipping_state_id").removeClass("is-valid");$("#shipping_state_id").addClass("is-invalid");validationSuccess=false}else{$("#shipping_state_id").removeClass("is-invalid");$("#shipping_state_id").addClass("is-valid")}if($("#shipping_state_id").val().length==0){$("#shipping_state_id").removeClass("is-valid");$("#shipping_state_id").addClass("is-invalid");validationSuccess=false}else{$("#shipping_state_id").removeClass("is-invalid");$("#shipping_state_id").addClass("is-valid")}if($("#shipping_postal_code").val().length!=5){$("#shipping_postal_code").removeClass("is-valid");$("#shipping_postal_code").addClass("is-invalid");validationSuccess=false}else{$("#shipping_postal_code").removeClass("is-invalid");$("#shipping_postal_code").addClass("is-valid")}return validationSuccess}function saveDiscounts(t){intenseLogging("saveDiscounts() called");if(!_validate_discounts()){return false}if(!t){dd_toast({message:"Discounts Saved",position:"topcenter"})}var e=$("#direct_order_discount").val();if(isNaN(e)){e="0.00"}var a=$("#plate_points_discount").val();if(isNaN(a)){a="0.00"}var s=0;var i=0;if($("#coupon_id").val()){s=$("#coupon_id").val()}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,op:"update_discounts",order_id:order_id,user_id:user_id,direct_order_discount:e,plate_points_discount:a,coupon_id:s},success:function(e){if(e.processor_success){intenseLogging("saveDiscounts() successful");updateDiscountOrgValues();updateReportingOrgValues();if(i){$("#free_menu_item_coupon").attr("disabled",true);couponFreeMenuItem=i}if(t){if(!_validate_address()){dd_message({title:"Error",message:"Please review and correct the shipping address."});return}onAddPaymentAndActivate(false,true,e.paymentToken)}}else{intenseLogging("update_discounts: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){intenseLogging("update_discounts: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function updateReportingOrgValues(){updateChangeList()}function getPaymentData(e,t){if(e!="CC"){var a={type:e,number:0,amount:0,cert_type:"",note:$("#payment_note").val()}}else{var a={type:e,number:0,amount:0,cert_type:"",note:$("#payment_note").val(),ccNameOnCard:"",ccType:"CC",ccMonth:"",ccYear:"",cc_security_code:"",billing_address:"",billing_postal_code:"",is_store_specific_flat_rate_deposit_delayed_payment:0,do_not_ref:0}}if(t==1){switch(e){case"REFERENCE":a.amount=$("#payment1_reference_total_amount").val();break;case"GIFT_CERT":a.amount=$("#payment1_gc_total_amount").val();a.cert_type=$("#payment1_gift_cert_type").val();a.number=$("#payment1_gc_payment_number").val();break;case"CASH":a.amount=$("#payment1_cash_total_amount").val();a.number=$("#payment1_cash_payment_number").val();break;case"REFUND_CASH":a.amount=$("#payment1_refund_cash_total_amount").val();a.number=$("#payment1_refund_cash_payment_number").val();break;case"CHECK":a.amount=$("#payment1_check_total_amount").val();a.number=$("#payment1_check_payment_number").val();break;case"CREDIT":a.amount=$("#OEH_remaing_balance").html();break;case"CC":a.amount=$("#payment1_cc_total_amount").val();a.number=$("#payment1_ccNumber").val();a.ccNameOnCard=$("#payment1_ccNameOnCard").val();a.ccType=$("#payment1_ccType").val();a.ccMonth=$("#payment1_ccMonth").val();a.ccYear=$("#payment1_ccYear").val();a.cc_security_code=$("#payment1_cc_security_code").val();a.billing_address=$("#billing_address_1").val();a.billing_postal_code=$("#billing_postal_code_1").val();if($("#save_cc_as_ref_1").is(":checked")){a.save_card=true}var s=$("input[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked").val();a.is_store_specific_flat_rate_deposit_delayed_payment=s;break;case"GIFT_CARD":a.amount=$("#debit_gift_card_amount").val();a.number=$("#debit_gift_card_number").val();break;case"DPADJUST":break;case"REFERENCE_OTHER":alert("investigate REFERENCE_OTHER");break;default:if(e.indexOf("REF_")==0){a.amount=$("#payment1_ref_total_amount").val();a.reference_id=$("#p1_ref_id").html()}}return a}else if(t==2){switch(e){case"CASH":a.amount=$("#payment2_cash_total_amount").val();a.number=$("#payment2_cash_payment_number").val();break;case"CHECK":a.amount=$("#payment2_check_total_amount").val();a.number=$("#payment2_check_payment_number").val();break;case"CC":a.amount=$("#payment2_cc_total_amount").val();a.number=$("#payment2_ccNumber").val();a.ccNameOnCard=$("#payment2_ccNameOnCard").val();a.ccType=$("#payment2_ccType").val();a.ccMonth=$("#payment2_ccMonth").val();a.ccYear=$("#payment2_ccYear").val();a.cc_security_code=$("#payment2_cc_security_code").val();a.billing_address=$("#billing_address_2").val();a.billing_postal_code=$("#billing_postal_code_2").val();if($("#save_cc_as_ref_2").is(":checked")){a.save_card=true}var s=$("input[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked").val();a.is_store_specific_flat_rate_deposit_delayed_payment=s;break;case"REFERENCE_OTHER":alert("investigate REFERENCE_OTHER");break;default:if(e.indexOf("REF_")==0){a.amount=$("#payment2_ref_total_amount").val();a.reference_id=$("#p2_ref_id").html()}}return a}}function validatePayment1(e){var t=null;var a=true;if(e.substr(0,4)=="REF_"){e="REFERENCE_OTHER"}switch(e){case"REFERENCE":t=$("#payment1_reference :input");a=_check_elements(t);break;case"GIFT_CERT":t=$("#payment1_gc :input");a=_check_elements(t);break;case"CASH":t=$("#payment1_cash :input");a=_check_elements(t);break;case"REFUND_CASH":t=$("#payment1_refund_cash :input");a=_check_elements(t);break;case"CHECK":t=$("#payment1_check :input");a=_check_elements(t);break;case"CREDIT":t=$("#payment1_credit :input");a=_check_elements(t);break;case"CC":t=$("#payment1_cc :input");a=_check_elements(t);var s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#payment1_is_store_specific_flat_rate_deposit_delayed_payment1").is(":checked")||$("#payment1_is_store_specific_flat_rate_deposit_delayed_payment2").is(":checked")){var i=$("#payment1_cc_total_amount").val();if(i*1<=store_specific_deposit*1){$("#payment1_CC_DP_note").html(s);$("#payment1_CC_DP_note").show();a=false}}break;case"GIFT_CARD":t=$("#payment1_debit_gift_card :input");a=_check_elements(t);break;case"DPADJUST":t=$("#dp_adjust_div :input");a=_check_elements(t);break;case"REFERENCE_OTHER":t=$("#payment1_ref :input");a=_check_elements(t);var s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#ref_payment1_is_store_specific_flat_rate_deposit_delayed1").is(":checked")||$("#ref_payment1_is_store_specific_flat_rate_deposit_delayed2").is(":checked")){var i=$("#payment1_ref_total_amount").val();if(i*1<=store_specific_deposit*1){$("#payment1_Ref_DP_note").html(s);$("#payment1_Ref_DP_note").show();a=false}}break;default:}return a}function validatePayment2(e){var t=null;var a=true;if(e.substr(0,4)=="REF_"){e="REFERENCE_OTHER"}switch(e){case"CASH":t=$("#payment2_check :input");a=_check_elements(t);break;case"CHECK":t=$("#payment2_check :input");a=_check_elements(t);break;case"CC":t=$("#payment2_cc :input");a=_check_elements(t);var s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#payment2_is_store_specific_flat_rate_deposit_delayed_payment1").is(":checked")||$("#payment2_is_store_specific_flat_rate_deposit_delayed_payment2").is(":checked")){var i=$("#payment2_cc_total_amount").val();if(i*1<=store_specific_deposit*1){$("#payment2_CC_DP_note").html(s);$("#payment2_CC_DP_note").show();a=false}}break;case"REFERENCE_OTHER":t=$("#payment2_ref :input");a=_check_elements(t);var s="The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.";if($("#ref_payment2_is_store_specific_flat_rate_deposit_delayed1").is(":checked")||$("#ref_payment2_is_store_specific_flat_rate_deposit_delayed2").is(":checked")){var i=$("#payment2_ref_total_amount").val();if(i*1<=store_specific_deposit*1){$("#payment2_Ref_DP_note").html(s);$("#payment2_Ref_DP_note").show();a=false}}break;default:}return a}function addPaymentAndActivate(){intenseLogging("addPaymentAndActivate() called");var e="You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?";var t=getAbbreviatedSummaryString();dd_message({div_id:"activate_confirm",title:"Add Payment and Book Order",message:e,modal:true,width:400,height:180,confirm:function(){var e=saveItems(true,true)}});return true}function save2PaymentsAndBookOrder(e,a,t){intenseLogging("save2PaymentsAndBookOrder() called");var s=getPaymentData(e,2);if(e!="CC"||!supports_transparent_redirect){var i=0;if($("#ref_payment2_is_store_specific_flat_rate_deposit_delayed0").length){i=$("input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked").val();if(i==1){i=4}if(i==2){i=5}if(i>0){}}var n=$("#max_plate_points_deduction").html();if(!n){n=0}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,async:true,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,op:"save_payment",order_id:order_id,session_id:session_id,user_id:user_id,payment_data:a,add_payment_data:s,max_plate_points_deduction:n,delay_remainder:i,dd_csrf_token:t},success:function(e){if(e.processor_success){intenseLogging("save2PaymentsAndBookOrder() save_payment successful");if(e.warnOfOutstandingSavedOrdersOnFullSession){bounce("main.php?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true")}else{bounce("main.php?page=admin_order_mgr_thankyou&order="+e.order_id)}}else{$("#paying_div").remove();intenseLogging("save2PaymentsAndBookOrder save_payment: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#paying_div").remove();intenseLogging("save2PaymentsAndBookOrder save_payment: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}else if(e=="CC"){var r=$("#payment2_ccNameOnCard").val();var o=$("#billing_address_2").val();var d=$("#billing_postal_code_2").val();var _=$("#payment2_cc_total_amount").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,async:true,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,user_id:user_id,op:"get_token",order_id:order_id,amount:_,billing_name:r,billing_address:o,billing_zip:d,dd_csrf_token:t,chain_token:true},success:function(e){$("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken);if(e.processor_success){intenseLogging("save2PaymentsAndBookOrder() get_token successful");var t=e.token;send(t,2,e.warnOfOutstandingSavedOrdersOnFullSession,false,false,a)}else{$("#paying_div").remove();intenseLogging("save2PaymentsAndBookOrder get_token: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#paying_div").remove();intenseLogging("save2PaymentsAndBookOrder get_token: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}}function savePayment2(e,a,t){intenseLogging("savePayment2() called");var s=getPaymentData(e,2);if(e!="CC"||!supports_transparent_redirect){var i=0;if($("#ref_payment2_is_store_specific_flat_rate_deposit_delayed0").length){i=$("input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked").val();if(i==1){i=4}if(i==2){i=5}if(i>0){}}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,async:true,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,op:"add_payment",order_id:order_id,user_id:user_id,payment_data:s,delay_remainder:i,dd_csrf_token:t},success:function(e){if(e.processor_success){intenseLogging("savePayment2() add_payment successful");if(a){bounce("main.php?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true")}else{bounce("main.php?page=admin_order_mgr_thankyou&order="+e.order_id)}}else{$("#paying_div").remove();intenseLogging("savePayment2 add_payment: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#paying_div").remove();intenseLogging("savePayment2 add_payment: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}else if(e=="CC"){var n=$("#payment2_ccNameOnCard").val();var r=$("#billing_address_2").val();var o=$("#billing_postal_code_2").val();var d=$("#payment2_cc_total_amount").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,async:true,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,user_id:user_id,op:"get_token",order_id:order_id,amount:d,billing_name:n,billing_address:r,billing_zip:o,dd_csrf_token:t,chain_token:true},success:function(e){$("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken);if(e.processor_success){intenseLogging("savePayment2() get_token successful");var t=e.token;send(t,2,a,false,false)}else{$("#paying_div").remove();intenseLogging("savePayment2 get_token: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#paying_div").remove();intenseLogging("savePayment2 get_token: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}}function handleDirectPayment(e,t,a){intenseLogging("handleDirectPayment() called");var s=$("#payment1_type").val();var i=false;if(s=="GIFT_CERT"||s=="GIFT_CARD"){i=$("#payment2_type").val()}if(!validatePayment1(s)){return false}if(i&&i!=""&&!validatePayment2(i)){return false}displayModalWaitDialog("paying_div","Sending Payment. Please wait ...");var n=getPaymentData(s,1);var r=0;if($("#ref_payment1_is_store_specific_flat_rate_deposit_delayed0").length){r=$("input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked").val();if(r==1){r=4}if(r==2){r=5}if(r>0){}}var o=false;var d=0;if($("#use_store_credits").length){if($("#use_store_credits").is(":checked")){d=$("#store_credits_amount").val();o=true}}var _=null;var l=null;if(i){_=getPaymentData(i,2);var r=0;if($("#ref_payment2_is_store_specific_flat_rate_deposit_delayed0").length){r=$("input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked").val();if(r==1){r=4}}l=n}else{_=n}var c=$("#max_plate_points_deduction").html();if(!c){c=0}$.ajax({url:"ddproc.php",type:"POST",timeout:9e4,async:true,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:store_id,op:"save_payment",order_id:order_id,user_id:user_id,payment_data:_,add_payment_data:l,delay_remainder:r,use_store_credits:o,max_plate_points_deduction:c,store_credits_amount:d,dd_csrf_token:a,payment2Type:i},success:function(e){if(e.processor_success){intenseLogging("handleDirectPayment() save_payment successful");if(e.warnOfOutstandingSavedOrdersOnFullSession){bounce("main.php?page=admin_order_mgr_thankyou&order="+e.order_id+"&full_session=true")}else{bounce("main.php?page=admin_order_mgr_thankyou&order="+e.order_id)}}else{$("#paying_div").remove();intenseLogging("handleDirectPayment save_payment: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){if(t=="timeout"){dd_message({title:"Order Processing Timed Out",message:"The request to finalized the order has timed out. This may be due to network congestion. The order may have been successful. The page will refresh and show the actual current status.",modal:true,noOk:true,closeOnEscape:false,buttons:{Refresh:function(){$(this).remove();bounce(window.location.href)}}})}else{$("#paying_div").remove();intenseLogging("handleDirectPayment save_payment: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}}})}function onAddPaymentAndActivate(e,t,a){intenseLogging("onAddPaymentAndActivate() called");return handleDirectPayment(e,t,a)}function RetrieveCalendar(e){intenseLogging("RetrieveCalendar() called");var t="retrieve_new";if(orderState!="SAVED"){t="retrieve_for_reschedule"}$.ajax({url:"ddproc.php",type:"GET",timeout:2e4,dataType:"json",data:{processor:"admin_calendarProcessorDelivered",store_id:store_id,action:t,cur_session_id:session_id,timestamp:e,service_days:service_days_for_current_zip},success:function(e){if(e.processor_success){intenseLogging("RetrieveCalendar() successful");$("#calendar_holder").html(e.data);handleSessionSelection()}else{intenseLogging("RetrieveCalendar: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){intenseLogging("RetrieveCalendar: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function onDayClick(e){}function doReschedule(t,e){var a=$("#curSessionDate").html();dd_message({title:"Reschedule",message:'<div style="text-align: center;"><div>From</div><div style="font-weight: bold;">'+a+'</div><div>to</div><div style="font-weight: bold;">'+e+"</div>",modal:true,confirm:function(){var e=session_id;session_id=t;Reschedule(e)},open:function(){$(this).siblings(".ui-dialog-buttonpane").find("button:contains('Confirm')").focus()}})}function onRescheduleClick(e,t,a,s){if(orderState!="NEW"){if(s=="locked"){dd_message({title:"Reschedule",message:"You cannot reschedule to this session as it is in the previous calendar month and all activity for that month has been locked and finalized."})}else{doReschedule(e,t)}}}function onSessionClick(e,t,a){intenseLogging("onSessionClick() called .................... please investiage should not occur for Delivered order")}function monthChange(e){RetrieveCalendar(e)}function handleSummaryDisplayChange(e){if(e.checked){ShowAllLineItems()}else{HideLineItemsIfZero()}}function HideLineItemsIfZero(){var e=Number($("#OEH_subtotal_delivery_fee_org").html());var t=Number($("#OEH_subtotal_delivery_fee").html());if(e==0&&t==0){$("#DeliveryFeeRow").hide()}else{$("#DeliveryFeeRow").show()}var a=Number($("#OEH_direct_order_discount_org").html());var s=Number($("#OEH_direct_order_discount").html());if(a==0&&s==0){$("#directDiscountRow").hide()}else{$("#directDiscountRow").show()}var i=Number($("#OEH_coupon_discount_org").html());var n=Number($("#OEH_coupon_discount").html());if(i==0&&n==0){$("#couponDiscountRow").hide()}else{$("#couponDiscountRow").show()}var r=Number($("#OEH_membership_discount_org").html());var o=Number($("#OEH_membership_discount").html());if(r==0&&o==0){$("#membershipDiscountRow").hide()}else{$("#membershipDiscountRow").show()}var d=Number($("#OEH_food_tax_subtotal_org").html());var _=Number($("#OEH_food_tax_subtotal").html());if(d==0&&_==0){$("#foodTaxRow").hide()}else{$("#foodTaxRow").show()}var l=Number($("#OEH_tax_subtotal_org").html());var c=Number($("#OEH_tax_subtotal").html());if(l==0&&c==0){$("#nonFoodTaxRow").hide()}else{$("#nonFoodTaxRow").show()}var u=Number($("#OEH_delivery_tax_subtotal_org").html());var m=Number($("#OEH_delivery_tax_subtotal").html());if(u==0&&m==0){$("#DeliveryTaxRow").hide()}else{$("#DeliveryTaxRow").show()}var p=Number($("#OEH_plate_points_order_discount_fee_org").html());var f=Number($("#OEH_plate_points_order_discount_fee").html());f=isNaN(f)?0:f;p=isNaN(p)?0:p;if(p==0&&f==0){$("#dinnerDollarsDiscountRow").hide()}else{$("#dinnerDollarsDiscountRow").show()}}function ShowAllLineItems(){$("#DeliveryFeeRow").show();$("#directDiscountRow").show();$("#couponDiscountRow").show();$("#foodTaxRow").show();$("#nonFoodTaxRow").show();$("#dinnerDollarsDiscountRow").show()}function sort_by_price(e,t){if(e.price==t.price){return 0}return e.price<t.price?1:-1}function drawChangeList(){var e=getChangeListHTML();$("#changelist").html(e)}function getChangeListHTML(){var e="";var a=true;let s={};let i={};for(var n in changeList.box_contents){if(changeList.box_contents.hasOwnProperty(n)){let t="";for(var r in changeList.box_contents[n]){let e=$("#qty_"+n+"_"+r).data("title");if(changeList.box_contents[n][r]>0){t+="-Added "+changeList.box_contents[n][r]+" "+e+"<br />"}else{t+="-Removed "+changeList.box_contents[n][r]+" "+e+"<br />"}}if(!changeList.boxes[n]){if(a){e+="<h3>Edited Boxes</h3><ul style='margin: 4px;'>";a=false}var o=$("#box_inst_id_"+d).data("box_label");s[n]="Box: "+o+"<br />"+t}else{i[n]=t}}}var a=true;for(var d in changeList.boxes){if(a){e+="<h3>Added Boxes</h3><ul style='margin: 0px; padding: 0px;'>";a=false}e+="<li>";if(changeList.boxes.hasOwnProperty(d)){var o=$("#box_inst_id_"+d).data("box_label");if(changeList.boxes[d]>0){e+="Added "+changeList.boxes[d]+" <i>"+o+"</i> ";if(i[d]){e+="<br />"+i[d]}}else{e+="Removed "+changeList.boxes[d]*-1+"<i>"+boxesDeletedFromActiveOrder[d]+"</i>"}}e+="</li>"}for(var d in s){if(s.hasOwnProperty(d)){e+=s[d]}}if(!a){e+="</ul>"}a=true;var t=false;for(var _ in changeList.miscCosts){t=true;if(a){e+="<h3>Misc Costs</h3>";a=false}if(changeList.miscCosts.hasOwnProperty(_)){if(changeList.miscCosts[_]["newVal"]>changeList.miscCosts[_]["orgVal"]){if(changeList.miscCosts[_]["orgVal"]==0){e+="Added "+getHumanReadableName(_)+" of $"+formatAsMoney(changeList.miscCosts[_]["newVal"])+"<br />"}else{e+=getHumanReadableName(_)+" was increased by $"+formatAsMoney(changeList.miscCosts[_]["diff"])+" to $"+formatAsMoney(changeList.miscCosts[_]["newVal"])+"<br />"}}else{if(changeList.miscCosts[_]["newVal"]==0){e+="Removed "+getHumanReadableName(_)+" of $"+formatAsMoney(changeList.miscCosts[_]["orgVal"])+"<br />"}else{e+=getHumanReadableName(_)+" was decreased by $"+formatAsMoney(changeList.miscCosts[_]["diff"]*-1)+" to $"+formatAsMoney(changeList.miscCosts[_]["newVal"])+"<br />"}}}}a=true;for(var _ in changeList.miscDescs){if(!t&&a){e+="<h3>Misc Costs</h3>";a=false}if(changeList.miscDescs.hasOwnProperty(_)){e+=getHumanReadableName(_)+" updated<br />"}}if(changeList.order_type!=""){e+="<h3>Order changed "+changeList.order_type+"</h3>"}a=true;for(var _ in changeList.discounts){if(a){e+="<h3>Discounts</h3>";a=false}if(changeList.discounts.hasOwnProperty(_)){if(changeList.discounts[_]["newVal"]>changeList.discounts[_]["orgVal"]){if(changeList.discounts[_]["orgVal"]==0){e+="Added "+getHumanReadableName(_)+" of $"+formatAsMoney(changeList.discounts[_]["newVal"])+"<br />"}else{e+=getHumanReadableName(_)+" was increased by $"+formatAsMoney(changeList.discounts[_]["diff"])+" to $"+formatAsMoney(changeList.discounts[_]["newVal"])+"<br />"}}else{if(changeList.discounts[_]["newVal"]==0){e+="Removed "+getHumanReadableName(_)+" of $"+formatAsMoney(changeList.discounts[_]["orgVal"])+"<br />"}else{e+=getHumanReadableName(_)+" was decreased by $"+formatAsMoney(changeList.discounts[_]["diff"]*-1)+" to $"+formatAsMoney(changeList.discounts[_]["newVal"])+"<br />"}}}}a=true;for(var _ in changeList.reporting){if(a){e+="<h3>Reporting</h3>";a=false}if(changeList.reporting.hasOwnProperty(_)){if(_=="fundraiser"){if(changeList.reporting[_]["newVal"]==0){e+="Removed "+getHumanReadableName(_)+" "+changeList.reporting[_]["title"]+"<br />"}else if(changeList.reporting[_]["orgVal"]>0&&changeList.reporting[_]["orgVal"]!=changeList.reporting[_]["newVal"]){e+="Changed "+getHumanReadableName(_)+" to "+changeList.reporting[_]["title"]+"<br />"}else{e+="Added "+getHumanReadableName(_)+" "+changeList.reporting[_]["title"]+"<br />"}}else if(_=="fundraiser_value"){if(changeList.reporting[_]["diff"]>0){e+=getHumanReadableName(_)+" was increased by $"+formatAsMoney(changeList.reporting[_]["diff"])+" to $"+formatAsMoney(changeList.reporting[_]["newVal"])+"<br />"}else{e+=getHumanReadableName(_)+" was decreased by $"+formatAsMoney(changeList.reporting[_]["diff"]*-1)+" to $"+formatAsMoney(changeList.reporting[_]["newVal"])+"<br />"}}if(_=="ltd_roundup"){if(changeList.reporting[_]["newVal"]==false){e+=getHumanReadableName(_)+" was removed from the order."}else{e+=getHumanReadableName(_)+" was added to the order."}}if(_=="ltd_roundup_value"){if(changeList.reporting[_]["diff"]>0){e+=getHumanReadableName(_)+" was increased by $"+formatAsMoney(changeList.reporting[_]["diff"])+" to $"+formatAsMoney(changeList.reporting[_]["newVal"])+"<br />"}else{e+=getHumanReadableName(_)+" was decreased by $"+formatAsMoney(changeList.reporting[_]["diff"]*-1)+" to $"+formatAsMoney(changeList.reporting[_]["newVal"])+"<br />"}}}}if(changeList.coupon){if(a){e+="<h3>Discounts</h3>";a=false}if(changeList.coupon.change_type="added"){e+="Added coupon code: "+"<br />"}else if(changeList.coupon.change_type="removed"){e+="Removed coupon code: "+"<br />"}else if(changeList.coupon.change_type="added"){e+="Change coupon code to: "+"<br />"}}if(paymentChanges||$("#use_store_credit").is(":checked")){e+="<h3>Payments</h3>";var l=$("#payment1_type").val();if(l!=""){e+="Payment of type "+l+" selected.<br />"}else{$("#creditDiv").is(":visible");{if($("#credit_to_customer_refund_cash_amount").val()>0){e+="Refunding Cash to customer.<br />"}var c=0;$("[id^='Cr_RT_']").each(function(){c+=parseFloat($(this).val())});if(c>0){e+="Refunding to customer credit card(s).<br />"}}}if((l=="GIFT_CERT"||l=="GIFT_CARD")&&$("#payment2_type").val()!=""){var u=$("#payment2_type").val();if(u&&u!=""){e+="Payment of type "+u+" selected.<br />"}}if($("#use_store_credit").is(":checked")){e+="Store Credit selected for payment.<br />"}}return e}function getHumanReadableName(e){switch(e){case"direct_order_discount":return"Direct Order Discount";case"plate_points_discount":return"Dinner Dollars";case"misc_food_subtotal":return"Miscellaneous Food Cost";case"misc_nonfood_subtotal":return"Miscellaneous Non-food Cost";case"subtotal_service_fee":return"Service Fee";case"subtotal_delivery_fee":return"Delivery Fee";case"misc_food_subtotal_desc":return"Misc Food Description";case"misc_nonfood_subtotal_desc":return"Misc Non-food Description";case"service_fee_description":return"Service Fee Description";case"session_discount":return"Session Discount";case"fundraiser":return"Fundraiser";case"fundraiser_value":return"Fundraiser Value";case"ltd_roundup_value":return"Dream Dinners Foundation Round Up Value";case"ltd_roundup":return"Dream Dinners Foundation Round Up";default:return"error"}}function getAbbreviatedSummaryString(){var s="";s+="<h3>Delivered Order</h3>";var e=true;for(var t in changeList.boxes){if(e){s+="<h3>Added Boxes</h3><ul style='margin: 4px;'>";e=false}s+="<li>";if(changeList.boxes.hasOwnProperty(t)){var a=$("#box_inst_id_"+t).data("box_label");if(changeList.boxes[t]>0){s+="Added "+changeList.boxes[t]+"<i>"+a+"</i>"}else{s+="Removed "+changeList.boxes[t]*-1+"<i>"+boxesDeletedFromActiveOrder[t]+"</i>"}}s+="</li>"}if(!e){s+="</ul>"}$("[data-dd_type='item_field']").each(function(){var e=$(this).val();if($(this).data("number")==true){e=parseFloat(e);if(isNaN(e)){e=0}if(e>0){s+=getHumanReadableName(this.id)+" costs of $"+formatAsMoney(e);var t="";switch(this.id){case"misc_food_subtotal":t="misc_food_subtotal_desc";break;case"misc_nonfood_subtotal":t="misc_nonfood_subtotal_desc";break;case"subtotal_service_fee":t="service_fee_description";break}var a=null;if(t!=""){a=$("#"+t).val()}if(a){s+=". <span>( "+a+" )</span><br />"}else{s+=".<br />"}}}});var i="";$("#plate_points_discount, #direct_order_discount").each(function(){var e=$(this).val();if($(this).data("number")==true){e=parseFloat(e);if(isNaN(e)){e=0}}if(e.valueOf()>0){i+=getHumanReadableName(this.id)+" applied.<br />"}});if(i!=""){s+="<h3>Discounts</h3>"+i}if(paymentChanges||$("#use_store_credit").is(":checked")){s+="<h3>Payments</h3>";var n=$("#payment1_type").val();if(n!=""){s+="Payment of type "+n+" selected.<br />"}else{$("#creditDiv").is(":visible");{if($("#credit_to_customer_refund_cash_amount").val()>0){s+="Refunding Cash to customer.<br />"}var r=0;$("[id^='Cr_RT_']").each(function(){r+=parseFloat($(this).val())});if(r>0){s+="Refunding to customer credit card(s).<br />"}}}if((n=="GIFT_CERT"||n=="GIFT_CARD")&&$("#payment1_type").val()!=""){var o=$("#payment2_type").val();if(o&&o!=""){s+="Payment of type "+o+" selected.<br />"}}if($("#use_store_credit").is(":checked")){s+="Store Credit selected for payment.<br />"}}return s}function updateChangeList(){let i=false;let a=false;let e=false;let s=false;let t=false;changeList={};changeList.stdMenuItems={};changeList.FTMenuItems={};changeList.miscCosts={};changeList.miscDescs={};changeList.bundleItems={};changeList.order_type="";changeList.discounts={};changeList.reporting={};changeList.delivery={};changeList.boxes={};changeList.box_contents={};for(var n in current_box_ids){current_box_ids[n]=0}$("[id^='box_inst_id_']").each(function(){let s=this.id.split("_")[3];current_box_ids[s]=1;if($(this).data("contents_are_fixed")==true){if(!$(this).data("is_saved")){changeList.boxes[s]=1;i=true}}else{if(!$(this).data("is_saved")){changeList.boxes[s]=1;i=true;$("input").filter("[data-box_inst_id='"+s+"']").each(function(){let e=$(this).val();let t=$(this).data("claimed_qty");let a=$(this).data("menu_item_id");if(e!=t){if(!changeList.box_contents[s]){changeList.box_contents[s]={}}changeList.box_contents[s][a]=e-t}})}else{$("input").filter("[data-box_inst_id='"+s+"']").each(function(){let e=$(this).val();let t=$(this).data("claimed_qty");let a=$(this).data("menu_item_id");if(e!=t){if(!changeList.box_contents.list_id){changeList.box_contents.list_id={}}changeList.box_contents.list_id[a]=e-t;i=true}})}}});for(var n in current_box_ids){if(current_box_ids[n]==0){changeList.boxes[n]=-1}}$("[data-dd_type='item_field']").each(function(){var e=$(this).val();var t=$(this).data("org_value");if(e==undefined||e==""){e="0.00"}if($(this).data("number")==true){e=parseFloat(e);t=parseFloat(t);if(isNaN(e)){e=0}if(isNaN(t)){t=0}}if(e.valueOf()!=t.valueOf()){$(this).addClass("unsaved_data");if($(this).data("number")==true){changeList.miscCosts[this.id]={newVal:$(this).val(),orgVal:$(this).data("org_value"),diff:$(this).val()-$(this).data("org_value")}}i=true}else{$(this).removeClass("unsaved_data")}});if(i){$("#items_tab_li").addClass("unsaved_data_on_tab");t=true}else{$("#items_tab_li").removeClass("unsaved_data_on_tab")}$("#plate_points_discount, #direct_order_discount").each(function(){var e=$(this).val();var t=$(this).data("org_value");if($(this).data("number")==true){e=parseFloat(e);t=parseFloat(t);if(isNaN(e)){e=0}if(isNaN(t)){t=0}}if(e.valueOf()!=t.valueOf()){changeList.discounts[this.id]={newVal:$(this).val(),orgVal:$(this).data("org_value"),diff:$(this).val()-$(this).data("org_value")};$(this).addClass("unsaved_data");s=true;a=true}else{$(this).removeClass("unsaved_data")}});var r=$("#org_coupon_id").val();var o=$("#coupon_id").val();if(r!=o){s=true;if(r==""){changeList.coupon={newVal:o,orgVal:r,change_type:"added"}}else if(o==""){changeList.coupon={newVal:o,orgVal:r,change_type:"removed"}}else{changeList.coupon={newVal:o,orgVal:r,change_type:"changed"}}}if(deliveryChanges){$("#delivery_tab_li").addClass("unsaved_data_on_tab");t=true}else{$("#delivery_tab_li").removeClass("unsaved_data_on_tab")}if(s){$("#payments_tab_li").addClass("unsaved_data_on_tab");t=true}else{$("#payments_tab_li").removeClass("unsaved_data_on_tab")}if(orderState=="SAVED"&&(t||$("#use_store_credit").is(":checked"))){$("#saveOrderSpan").show()}else{$("#saveOrderSpan").hide()}if(orderState=="SAVED"&&($("#use_store_credit").is(":checked")||paymentChanges)){$("#addPaymentAndActivateButton").attr("disabled",false)}else{$("#addPaymentAndActivateButton").attr("disabled",true)}if(orderState=="ACTIVE"||discountEligable.limited_access){$("#finalizeOrderSpan").show();if(t||paymentChanges||$("#use_store_credits").is(":checked")){s=true;$("#submit_button").attr("disabled",false);$("#finalize_msg").show()}else{$("#submit_button").attr("disabled",true);$("#finalize_msg").hide()}}else{$("#finalizeOrderSpan").hide()}if(i||s){$("#changeListTab").addClass("unsaved_data_list")}else{$("#changeListTab").removeClass("unsaved_data_list")}drawChangeList()}function handleAutoAdjust(e){if(e.checked){var t=Number($("#OEH_remaing_balance").html());if(canAdjustDelayedPayment&&(currentDPAmount>0||t>0)){if(t>0){$("#payment1_type").val("DPADJUST");changePayment1("DPADJUST")}else{adjustPendingDelayedPayment(t)}}else{if(t>0){$("#payment1_type").val("REFERENCE");changePayment1("REFERENCE")}assignBalanceToRefTransactions(t)}}else{if($("#payment1_type").val()!=""){$("#payment1_type").val("");changePayment1("")}for(ident in existingPaymentAmountArray){$("#Cr_RT_"+ident).val("")}}reportPaymentStatus(false)}function getAbbreviatedChangeString(){var e="";var t=0;var a=0;var e="";if(needPlatePointsMaxDiscountChangeWarning){e+="<div style='color:red;'>Warning: The amount discountable by Dinner Dollars has changed. You may wish to review and adjust the Dinner Dollars discount.</div>"}var s=true;for(var i in changeList.boxes){if(s){e+="<h3>Added Boxes</h3><ul style='margin: 4px;'>";s=false}e+="<li>";if(changeList.boxes.hasOwnProperty(i)){var n=$("#box_inst_id_"+i).data("box_label");if(changeList.boxes[i]>0){e+="Added "+changeList.boxes[i]+"<i>"+n+"</i>"}else{e+="Removed "+changeList.boxes[i]*-1+"<i>"+boxesDeletedFromActiveOrder[i]+"</i>"}}e+="</li>"}if(!s){e+="</ul>"}for(var r in changeList.miscCosts){if(changeList.miscCosts.hasOwnProperty(r)){if(changeList.miscCosts[r]["newVal"]>changeList.miscCosts[r]["orgVal"]){if(changeList.miscCosts[r]["orgVal"]==0){e+="Added "+getHumanReadableName(r)+" of $"+formatAsMoney(changeList.miscCosts[r]["newVal"])+"<br />"}else{e+=getHumanReadableName(r)+" was increased by $"+formatAsMoney(changeList.miscCosts[r]["diff"])+" to $"+formatAsMoney(changeList.miscCosts[r]["newVal"])+"<br />"}}else{if(changeList.miscCosts[r]["newVal"]==0){e+="Removed "+getHumanReadableName(r)+" of $"+formatAsMoney(changeList.miscCosts[r]["orgVal"])+"<br />"}else{e+=getHumanReadableName(r)+" was decreased by $"+formatAsMoney(changeList.miscCosts[r]["diff"]*-1)+" to $"+formatAsMoney(changeList.miscCosts[r]["newVal"])+"<br />"}}}}for(var r in changeList.miscDescs){if(changeList.miscDescs.hasOwnProperty(r)){e+=getHumanReadableName(r)+" updated<br />"}}s=true;for(var r in changeList.discounts){if(s){e+="<h3>Discounts</h3>";s=false}if(changeList.discounts.hasOwnProperty(r)){if(changeList.discounts[r]["newVal"]>changeList.discounts[r]["orgVal"]){if(changeList.discounts[r]["orgVal"]==0){e+="Added "+getHumanReadableName(r)+" of $"+formatAsMoney(changeList.discounts[r]["newVal"])+"<br />"}else{e+=getHumanReadableName(r)+" was increased by $"+formatAsMoney(changeList.discounts[r]["diff"])+" to $"+formatAsMoney(changeList.discounts[r]["newVal"])+"<br />"}}else{if(changeList.discounts[r]["newVal"]==0){e+="Removed "+getHumanReadableName(r)+" of $"+formatAsMoney(changeList.discounts[r]["orgVal"])+"<br />"}else{e+=getHumanReadableName(r)+" was decreased by $"+formatAsMoney(changeList.discounts[r]["diff"]*-1)+" to $"+formatAsMoney(changeList.discounts[r]["newVal"])+"<br />"}}}}if($("#autoAdjust").is(":checked")){e+="<span style='color:red'>Auto-Adjust is checked and will "+$("#adj_action").html()+"</span>"}e="<div id='finalize_changes_div'>"+e+"</div>";return e}function addPaymentToLockedOrder(){var e=$("#payment1_ccNameOnCard").val();var t=$("#billing_address_1").val();var a=$("#billing_postal_code_1").val();var s=$("#payment1_cc_total_amount").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,async:true,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:STORE_DETAILS.id,op:"get_token",order_id:order_id,amount:s,user_id:user_id,billing_name:e,billing_address:t,billing_zip:a,dd_csrf_token:$("input[name=dd_csrf_token]","#editorForm").val(),chain_token:true},success:function(e){$("input[name=dd_csrf_token]","#editorForm").val(e.getTokenToken);if(e.processor_success){intenseLogging("addPaymentToLockedOrder() get_token successful");var t=e.token;send(t,1,false,true,true,false)}else{$("#paying_div").remove();intenseLogging("addPaymentToLockedOrder get_token: "+e.processor_message);dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#paying_div").remove();intenseLogging("addPaymentToLockedOrder get_token: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function submitPage(){intenseLogging("submitPage() called");var e=$("#editorForm")[0];var t=confirm_and_check_form(e);if(t){var a="This can not be undone. Are you sure you want to submit the changes?";var s=getAbbreviatedChangeString();a+="<br /><br />"+s;var i=460;if(a.length<128){i=160}else if(a.length<256){i=260}dd_message({title:"Finalize",message:a,modal:true,width:400,height:i,confirm:function(){if(supports_transparent_redirect&&$("#payment1_type").val()=="CC"){intenseLogging("submitPage() confirmed");if(!discountEligable.limited_access){updateActiveOrder(true,true)}else{addPaymentToLockedOrder(true,true)}}else{$("<input>").attr({type:"hidden",name:"changeList",value:JSON.stringify(changeList)}).appendTo($(e));$("<input>").attr({type:"hidden",name:"changeListStr",value:getChangeListHTML()}).appendTo($(e));$("#submit_changes").val("true");$("#editorForm").submit()}}})}}function resetPage(){intenseLogging("resetPage() called");bounce(window.location.href)}function confirm_and_check_form(e){intenseLogging("confirm_and_check_form() called");if(orderState=="NEW"||orderState=="SAVED"){return false}return _check_form(e)}function dd_round_amount(e){e+=5e-6;var t=e*1e3;t=parseInt(t);t=t/10;var a=t-Math.floor(t);if(a>=.5){t=Math.floor(t)+1}else{t=Math.floor(t)}return t/100}function calculateTotal(){var i=0;var n=0;var e=0;var t=0;var r=0;var o=0;for(var a in entreeIDToInventoryMap){entreeIDToInventoryMap[a].remaining=entreeIDToInventoryMap[a].org_remaining;$("#inv_"+a).html(entreeIDToInventoryMap[a].org_remaining+"/serv")}$("[id^='box_inst_id_']").each(function(){let e=this.id.split("_")[2];let t=$(this).data("box_price");let a=$(this).data("number_items_required");let s=$(this).data("number_servings_required");i+=t*1;r+=a;n+=s;o++});t=i;$("#OEH_item_count").html(r);$("#OEH_number_servings").html(n);$("#OEH_number_boxes").html(o);t=Math.round(t*100)/100;$("#orderSubTotal").val(formatAsMoney(Math.round(i*100)/100));$("#OEH_menu_subtotal").html(formatAsMoney(t));$("#orderTotal").val(formatAsMoney(t));$("#OEH_menu_subtotal").html(formatAsMoney(t*1));var s=t;var d=s;var _=Number(0);directDiscount=$("#direct_order_discount");if(directDiscount.length){_=directDiscount.val();if(isNaN(_)){_=0}if(_>d){_=d;directDiscount.val(_)}if(_){s=formatAsMoney(s-_)}$("#OEH_direct_order_discount").html(formatAsMoney(_))}discountablePlatePointsAmount=handleDinnerDollars(s);if(couponDiscountMethod=="PERCENT"){var l=Math.floor(d*couponDiscountVar);l/=100;$("#couponValue").val(l)}var c=Number(0);couponDiscount=$("#couponValue");if(couponDiscount.length){if(couponDiscount.val()==""){couponDiscount.val("0.00")}c=couponDiscount.val()}var u=false;if(typeof coupon!="undefined"&&coupon.limit_to_delivery_fee=="1"&&coupon.discount_method=="FLAT"){var m=$("#subtotal_delivery_fee").val();if(c!=m){c=m;$("#couponValue").val(c)}u=true}if(c){s=formatAsMoney(s-c);$("#OEH_coupon_discount").html(formatAsMoney(c))}var p=0;if($("#plate_points_discount").length){p=$("#plate_points_discount").val();if(p*1>discountablePlatePointsAmount*1){p=discountablePlatePointsAmount;if(p==0){$("#plate_points_discount").val("")}else{$("#plate_points_discount").val(formatAsMoney(p))}}$("#OEH_plate_points_order_discount_fee").html(formatAsMoney(p));s=formatAsMoney(s-p)}if(orderIsEligibleForMembershipDiscount&&storeSupportsMembership){var f=Number(0);if(couponDiscountValIsServiceFee||u){f=c}var h=Number(s*1+f*1);var g=Number(h*(membership_status.discount_var/100));g=Math.round(g*100)/100;$("#OEH_membership_discount").html(formatAsMoney(g));s=formatAsMoney(s-g)}var v=Number(0);if($("#subtotal_delivery_fee")[0]){v=Number($("#subtotal_delivery_fee").val());$("#OEH_subtotal_delivery_fee").html(formatAsMoney(v));s=Number(s*1+v*1);var y=s-v*1}var b=0;var C=0;var L=0;if(orderState!="NEW"&&y>0){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,async:false,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"retrieve_sales_tax",order_id:order_id,user_id:user_id,store_id:store_id,subtotal_all_items:s,subtotal_delivery_fee:v},success:function(e){intenseLogging("retrieving Sales tax");C=e.subtotal_food_sales_taxes;L=e.subtotal_delivery_tax;$("#OEH_food_tax_subtotal").text(formatAsMoney(C));$("#OEH_delivery_tax_subtotal").text(formatAsMoney(L))},error:function(e,t){intenseLogging("retrieving Sales tax: "+t+" | "+e.responseText);response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}var E=0;if(e){$("#nonFoodTaxLabel").html("Non-Food & Enrollment Tax")}else{$("#nonFoodTaxLabel").html("Non-Food Tax")}b=formatAsMoney(C);taxElem=document.getElementById("OEH_tax_subtotal");if(taxElem){taxElem.innerHTML=formatAsMoney(E)}taxElem=document.getElementById("OEH_food_tax_subtotal");if(taxElem){taxElem.innerHTML=formatAsMoney(b)}taxElem=document.getElementById("OEH_delivery_tax_subtotal");if(taxElem){taxElem.innerHTML=formatAsMoney(L)}var x=Number(s);s=s*1+b*1+E*1+L*1;$("#OEH_grandtotal").html(formatAsMoney(s));$("#OEH_new_total").html(formatAsMoney(s));$("#OEH_delta").html(formatAsMoney((orderInfoGrandTotal-s)*-1));var T=0;if($("#OEH_paymentsTotal").length){T=$("#OEH_paymentsTotal").html()}var A=Number(formatAsMoney(T-s));$("#OEH_remaing_balance").html(formatAsMoney(A*-1));if(orderState=="CANCELLED"){A=T;$("#OEH_remaing_balance").html(formatAsMoney(A))}if(A>0){$("#balance_msg").html(formatAsMoney(A*-1)+" owed to the customer.");$("#balanceRow").addClass("balance_msg_customer_owed");$("#newPaymentDiv").hide();if(canAdjustDelayedPayment&&currentDPAmount>0){$("#dp_adjust_down_div").show()}else{$("#creditDiv").show()}$("#payment1_type").val("");$("#payment2_type").val("");changePayment1("");changePayment2("");paymentChanges=true;$("#use_store_credits").prop("checked",false);$("#use_store_credits").prop("disabled",true)}else if(A<0){$("#balance_msg").html(formatAsMoney(A*-1)+" owed to your store.");$("#balanceRow").addClass("balance_msg_store_owed");$("#newPaymentDiv").show();$("#creditDiv").hide();if(canAdjustDelayedPayment){$("#dp_adjust_down_div").hide()}$("#use_store_credits").prop("disabled",false);var D=true;if(D){var O=A*-1;if($("#use_store_credits").is(":checked")){var w=Number($("#store_credits_amount").val());if(isNaN(w.valueOf())){w=Number(0)}O-=w.valueOf()}O=formatAsMoney(O);if($("#payment1_type").val()=="CC"){$("#payment1_cc_total_amount").val(O)}else if($("#payment1_type").val()=="CHECK"){$("#payment1_check_total_amount").val(O)}else if($("#payment1_type").val().split("_")[0]=="REF"){$("#payment1_ref_total_amount").val(O)}else if(($("#payment1_type").val()=="GIFT_CERT"||$("#payment1_type").val()=="GIFT_CARD")&&$("#payment2_type").val()!=""){var k=null;if($("#payment1_type").val()=="GIFT_CERT"){k=Number($("#payment1_gc_total_amount").val())}else if($("#payment1_type").val()=="GIFT_CARD"){k=Number($("#debit_gift_card_amount").val())}if(isNaN(k.valueOf())){k=Number(0)}O=formatAsMoney(O-k.valueOf());if($("#payment2_type").val()=="CC"){$("#payment2_cc_total_amount").val(O)}else if($("#payment2_type").val()=="CHECK"){$("#payment2_check_total_amount").val(O)}else if($("#payment2_type").val()=="CASH"){$("#payment2_cash_total_amount").val(O)}else if($("#payment2_type").val().split("_")[0]=="REF"){$("#payment2_ref_total_amount").val(O)}}}}else{$("#balance_msg").html("0.00");$("#balanceRow").addClass("balance_msg_balanced");$("#newPaymentDiv").show();$("#creditDiv").hide();if(canAdjustDelayedPayment){$("#dp_adjust_down_div").hide()}$("#use_store_credits").prop("disabled",false);assignBalanceToRefTransactions(0)}var R=$("#autoAdjustDiv");if(R.length){if(A!=0&&canAutoAdjust){if(canAdjustDelayedPayment&&(currentDPAmount>0||A<0)){$("#OEH_auto_pay_msg").html("Check this to <span id='adj_action'><b>adjust customer's delayed payment.</b></span>")}else{if(A>0){$("#OEH_auto_pay_msg").html("Check this to <span id='adj_action'><b>credit customer's credit card now.</b></span>")}else{$("#OEH_auto_pay_msg").html("Check this to <span id='adj_action'><b>charge original credit card now.</b></span>")}}R.show();if(!forceManualAutoAdjust){$("#autoAdjust").prop("checked",true);handleAutoAdjust($("#autoAdjust").get()[0])}}else{if(R.is(":visible")){R.hide();$("#autoAdjust").prop("checked",false);$("#payment1_type").val("");$("#payment2_type").val("");changePayment1("");changePayment2("")}}}$("#help_msg").html("");if($("#submit_changes").length){if(n>0){$("#submit_changes").prop("disabled",false)}else{$("#submit_changes").prop("disabled",true)}if(_>=Number(x)+Number(_)&&x!=0){$("#submit_changes").prop("disabled",true);$("#help_msg").html($("#help_msg").html()+'You cannot use a Direct Order Discount that is equal to or greater than the food cost total. Please use the "No Charge" payment type to give away an order.')}}if($("#help_msg").length){if($("#help_msg").html()!=""){$("#help_msg").show()}else{$("#help_msg").hide()}}reportPaymentStatus(false);HideLineItemsIfZero();if(orderState!="NEW"){updateChangeList()}}function handleDinnerDollars(e){var t=e;if(t!=lastMaxPPDiscountAmount&&lastMaxPPDiscountAmount!=-1){needPlatePointsMaxDiscountChangeWarning=true}lastMaxPPDiscountAmount=t;if(t<0)t=0;$("#max_plate_points_deduction").html(formatAsMoney(t));var a=$("#plate_points_available").html()*1;var s=$("#max_plate_points_deduction").html()*1;var i=$("#plate_points_discount").val()*1;if(s<i){$("#plate_points_discount").val(s)}if(a>s){$("#tbody_max_plate_points_deduction").show()}else{$("#tbody_max_plate_points_deduction").hide()}var n=Number($("#OEH_plate_points_discount_org_fee").html());var r=Number($("#OEH_plate_points_order_discount_fee").html());if(n==0&&r==0){$("#dinnerDollarsDiscountRow").hide()}else{$("#dinnerDollarsDiscountRow").show()}return t}$(document).on("change","#shipping_phone_number",function(e){$(".shipping_phone_number_new_div").hideFlex();$("#shipping_phone_number_new").prop("required",false);if($(this).val()=="new"){$(".shipping_phone_number_new_div").showFlex();$("#shipping_phone_number_new").prop("required",true)}});$(document).on("change keyup",".delivery-input",function(e){deliveryChanges=false;$(".delivery-input").each(function(){if($(this).data("org_value")){var e=$(this).val();var t=$(this).data("org_value");if(e!=t){deliveryChanges=true}}});updateChangeList()});$(document).on("change","#address_book_select",function(e){let t=$(this).val();if(t){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"retrieve_address_from_address_book",address_id:t,user_id:user_id},success:function(e){if(e.processor_success){$("#shipping_firstname").val(e.address.firstname);$("#shipping_lastname").val(e.address.lastname);$("#shipping_address_line1").val(e.address.address_line1);$("#shipping_address_line2").val(e.address.address_line2);$("#shipping_city").val(e.address.city);$("#shipping_state_id").val(e.address.state_id);$("#shipping_postal_code").val(e.address.postal_code);$("#shipping_address_note").val(e.address.address_note);$("#shipping_phone_number").val(e.address.telephone_1);$("#shipping_gift_email_address").val(e.address.email_address)}else{dd_message({title:"Address Error",message:e.processor_message})}},error:function(e,t){dd_message({title:"Error",message:"Unexpected error: "+t})}})}});
//# sourceMappingURL=order_mgr_delivered.min.js.map
var hasChangedCOGS=!1;function reports_goal_management_init(){$("html").bind("keypress",(function(t){if(13==t.keyCode)return!1})),init_exposure_controls(),init_session_lead_dropdowns(),init_goal_inputs(),init_food_cost_inputs(),init_labor_cost_inputs(),init_money_formatting(),init_update_p_and_l_data(),calculatePage(),$(".gt_input").each((function(){$(this).val(addFormatting($(this).val()))})),$("#session_summary_table").stickyTableHeaders()}function init_money_formatting(){$(".gt_input").focus((function(){$(this).val(removeFormatting($(this).val()))})),$(".gt_input").blur((function(){$(this).val(addFormatting($(this).val()))})),$(".gt_input").keypress((function(t){return 188==t.which||190==t.which||46==t.which||45==t.which||8==t.keyCode||9==t.keyCode||37==t.keyCode||39==t.keyCode||45==t.keyCode||t.which>47&&t.which<58||13==t.keyCode&&($(this).blur(),!0)})),$(".gt_input").change((function(){if(isNaN($(this).val()))return!1}))}function init_update_p_and_l_data(){var t=Number(0);$('[data-dd_subtype="expense"]').each((function(){t+=Number(removeFormatting($(this).val()))}));var a=Number(removeFormatting($("#p_and_l_total_agr").html())),e=Number(removeFormatting($("#p_and_l_marketing_total").html())),o=Number(removeFormatting($("#p_and_l_royalty_total").html())),s=Number(removeFormatting($("#net_income").val()));$("#other_expenses").val(addFormatting(a-(t+e+o)-s)),$(".gt_input").keyup((function(){var t=Number(removeFormatting($("#net_income").val())),a=Number(0);$('[data-dd_subtype="expense"]').each((function(){a+=Number(removeFormatting($(this).val()))}));var s=Number(removeFormatting($("#p_and_l_total_agr").html()));$("#other_expenses").val(addFormatting(s-(a+e+o)-t))})),$("#update_p_and_l").click((function(){var t=!1;if($("#owner_hours, #employee_hours, #manager_hours").each((function(){isNaN($(this).val())&&(dd_message({title:"Error",message:"The hours fields must be a number."}),t=!0)})),t)return!1;var a={};return $("#finance_tab input").each((function(){a[this.id]=removeFormatting($(this).val())})),$("#finance_tab input").each((function(){""==a[this.id]&&(a[this.id]="not supplied")})),$("#cost_of_goods_and_services").data("org_value")!=$("#cost_of_goods_and_services").val()&&(hasChangedCOGS=!0),$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_p_and_l_data",store_id:store_id,month:month,year:year,p_and_l_data:a},success:function(t){t.processor_success?(dd_toast({message:"Your data was saved."}),hasChangedCOGS&&(hasChangedCOGS=!1,$("#cogs_msg").html(""))):dd_message({title:"Error",message:t.processor_message})},error:function(t,a){response="Unexpected error: "+a,dd_message({title:"Error",message:response})}}),!1}))}function init_goal_inputs(){$("#avg_ticket_goal,#finishing_touch_goal,#taste_sessions_goal,#regular_guest_count_goal,#taste_guest_count_goal,#intro_guest_count_goal").change((function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_sessionGoals",store_id:store_id,month:month,year:year,goal:this.id,value:removeFormatting($(this).val())},success:function(t){t.processor_success||dd_message({title:"Error",message:t.processor_message})},error:function(t,a){response="Unexpected error"}})}))}function updateGOGSfields(t,a){var e=t+"-1-"+a;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_expensesData",store_id:store_id,date:e,op:"retrieveForMonth"},success:function(t){if($("[id^='fc_']").val(addFormatting("0.00")),$("[id^='lc_']").val(addFormatting("0.00")),t.processor_success){for(var e in t.food_costs){var o=t.food_costs[e];1==e.length&&(e="0"+e),"00"==e&&(e="53"),$("#fc_"+e+"_"+a).val(addFormatting(o))}for(var e in t.labor_costs){o=t.labor_costs[e];1==e.length&&(e="0"+e),"00"==e&&(e="53"),$("#lc_"+e+"_"+a).val(addFormatting(o))}calculatePage()}else dd_message({title:"Error",message:t.processor_message})},error:function(t,a){dd_message({title:"Error",message:json.strError})}})}function init_food_cost_inputs(){$("[id^=fc_]").on("click",(function(){$.ajax({url:"main.php?page=admin_store_expenses_v2",type:"POST",once:!1,data:{store_id:store_id,month:month,year:year},success:function(t,a){dd_message({title:"Input Expenses",message:t,height:"auto",width:740,div_id:"cost_inputter",closeOnEscape:!0,noOk:!0}),dayClickHandler=SE_dayClickHandler,initExpensesDialog()},error:function(t,a){response="Unexpected error"}})}))}function init_labor_cost_inputs(){$("[id^=lc_]").on("click",(function(){$.ajax({url:"main.php?page=admin_store_expenses_v2",type:"POST",once:!1,data:{store_id:store_id,month:month,year:year},success:function(t,a){dd_message({title:"Input Expenses",message:t,height:"auto",width:740,div_id:"cost_inputter",closeOnEscape:!0,noOk:!0}),dayClickHandler=SE_dayClickHandler,initExpensesDialog()},error:function(t,a){response="Unexpected error"}})}))}function roundToTenths(t){return t-=0,(t=Math.round(10*t)/10)==Math.floor(t)?t+".0":t==Math.floor(t)?t+"0":t}function _report_submitClick(t){var a=parseInt($("#year_field_001").val());return isNaN(a)?(dd_message({title:"Error",message:"The year is not an integer."}),!1):a<2011?(dd_message({title:"Error",message:"The year must be greater than 2010."}),!1):($("#avg_ticket_goal").remove(),$("#finishing_touch_goal").remove(),$("#taste_sessions_goal").remove(),$("#regular_guest_count_goal").remove(),$("#taste_guest_count_goal").remove(),$("#intro_guest_count_goal").remove(),$("[data-dd_type='p&l_widget']").remove(),!0)}function removeFormatting(t){return null==t||""==t?t:t=(t=t.replace(/,/,"")).replace(/\$/,"")}function addFormatting(t){return null==t||""==t?"":t=accounting.formatMoney(t,"$",2,",",".","%s%v")}function calculatePage(){var t=$("#nonTasteSessionCount").val(),a=removeFormatting($("#avg_ticket_goal").val()),e=removeFormatting($("#finishing_touch_goal").val()),o=removeFormatting($("#regular_guest_count_goal").val()),s=removeFormatting($("#taste_guest_count_goal").val()),r=removeFormatting($("#intro_guest_count_goal").val()),n=1*o+1*r,i=o*a+34.99*s+84.95*r,_=i;$("#gross_revenue_goal").html(addFormatting(i)),$("#calendar_month_goal").html(addFormatting(i)),$("#FT_months_total_goal").html(addFormatting(e));var m=new Date,d="true"==$("#isCurrentMonth").val(),l=m.getDate(),g=0,h=0,c=0,u=0,v=0,f=0,p=!1,F=0,y=0,w=0,k=0,C=!1;$("#guest_count_months_total").html();$("#sg_gross_revenue_goal").html(addFormatting(i/t)),$("#sg_avg_ticket_goal").html(addFormatting($("#avg_ticket_goal").val())),$("#sg_guests_goal").html(roundToTenths($("#guests_goal").html()/t)),$("#sg_finishing_touch_goal").html(addFormatting(e/t));var b=e,T=0;$("[id^=dre_]").each((function(){if("true"==$(this).attr("data-in_month")){var a=0,o=0,s=this.id.substr(4),r=$(this).attr("data-day_number"),_=removeFormatting($("#dac_"+s).html()),m=removeFormatting($("#ftt_"+s).html()),x="true"==$(this).attr("data-is_taste");if(y+=1*_,w+=1*m,x||(k+=1*_),d&&r>l||month_is_future){if(dd_console_log("Pos: "+s+" | toDataGuestCount: "+v),!x){C||(g=a=i/t,T=b/(n-v)),C=!0;var M=$("#sgc_"+s).html();o=formatAsMoney(T*M),h=o,$(this).html(addFormatting(g)),$("#fttg_"+s).html(addFormatting(h)),_<g?($("#dac_"+s).addClass("goal_not_met"),$("#dac_"+s).removeClass("goal_met")):($("#dac_"+s).addClass("goal_met"),$("#dac_"+s).removeClass("goal_not_met")),m<h?($("#fft_"+s).addClass("goal_not_met"),$("#ftt_"+s).removeClass("goal_met")):($("#ftt_"+s).addClass("goal_met"),$("#ftt_"+s).removeClass("goal_not_met")),h,p=g,F++}}else{if(!x){a=i/t,$(this).html(addFormatting(a)),o=b/t,$("#fttg_"+s).html(addFormatting(o)),g=a,h=o,_<a?($("#dac_"+s).addClass("goal_not_met"),$("#dac_"+s).removeClass("goal_met")):($("#dac_"+s).addClass("goal_met"),$("#dac_"+s).removeClass("goal_not_met")),m<o?($("#ftt_"+s).addClass("goal_not_met"),$("#ftt_"+s).removeClass("goal_met")):($("#ftt_"+s).addClass("goal_met"),$("#ftt_"+s).removeClass("goal_not_met")),c++,t--;var S=$("#sgc_"+s).html();v+=1*S}u+=1*_,i-=_;var E=removeFormatting($("#ftt_"+s).html());f+=1*E}b=e-w}})),$("#aam_gross_revenue_goal").html(addFormatting(u/c)),$("#aam_guests_goal").html(formatAsMoney(v/c)),$("#aam_finishing_touch_goal").html(addFormatting(f/c)),$("#aam_avg_ticket_goal").html(addFormatting(removeFormatting($("#aam_gross_revenue_goal").html())/$("#aam_guests_goal").html())),$("#rgrs_gross_revenue_goal").html(addFormatting(p)),F>0?$("#rgrs_guests_goal").html(roundToTenths((n-v)/F)):$("#rgrs_guests_goal").html("0"),$("#rgrs_avg_ticket_goal").html(addFormatting(removeFormatting($("#rgrs_gross_revenue_goal").html())/$("#rgrs_guests_goal").html()));var x=removeFormatting($("#FT_months_total").html());F>0?$("#rgrs_finishing_touch_goal").html(addFormatting((e-x)/F)):$("#rgrs_finishing_touch_goal").html("$0.00"),$("#ma_gross_revenue_goal").html(addFormatting(y));var M=$("#guest_count_months_total").html();$("#ma_guests_goal").html(M),$("#ma_avg_ticket_goal").html(addFormatting(removeFormatting($("#ma_gross_revenue_goal").html())/$("#ma_guests_goal").html())),$("#ma_finishing_touch_goal").html(addFormatting(x)),$("#mat_gross_revenue_goal").html(addFormatting(k));var S=$("#guestCountTotalMinusTaste").val();$("#mat_guests_goal").html(S),$("#mat_avg_ticket_goal").html(addFormatting(k/S)),$("#mat_finishing_touch_goal").html(addFormatting($("#allFTTotalMinusTaste").val()));var E=0;$("[id^=fc_]").each((function(){var t=this.id.split("_"),a="fcp_"+t[1]+"_"+t[2],e="wkt_"+t[1],o=removeFormatting($(this).val()),s=removeFormatting($("#"+e).html());E+=1*o;var r=100*o/s;$("#"+a).html(formatAsMoney(r))})),$("#total_food_cost").html(addFormatting(E)),$("#total_food_cost_percentage").html(formatAsMoney(100*E/y)+"%");var N=0;if($("[id^=lc_]").each((function(){var t=this.id.split("_"),a="lcp_"+t[1]+"_"+t[2],e="wkt_"+t[1],o=removeFormatting($(this).val()),s=removeFormatting($("#"+e).html());N+=1*o;var r=100*o/s;$("#"+a).html(formatAsMoney(r))})),$("#total_labor_cost").html(addFormatting(N)),$("#total_labor_cost_percentage").html(formatAsMoney(100*N/y)+"%"),month_is_passed){y>=_?$("#rgrs_gross_revenue_goal").html(addFormatting(0)):$("#rgrs_gross_revenue_goal").html(addFormatting(y-_));var O=removeFormatting($("#ma_avg_ticket_goal").html());O>=a?$("#rgrs_avg_ticket_goal").html(addFormatting(0)):$("#rgrs_avg_ticket_goal").html(addFormatting(O-a)),x>=e?$("#rgrs_finishing_touch_goal").html(addFormatting(0)):$("#rgrs_finishing_touch_goal").html(addFormatting(x-e));var P=$("#guests_goal").html();M>=P?$("#rgrs_guests_goal").html(formatAsMoney(0)):$("#rgrs_guests_goal").html(formatAsMoney(M-P))}var j=-1,H=-1,A=0,G=0,D=0,I=0,U=0,L=0;$("[id^=dre_]").each((function(){var t=$(this).attr("data-day_number"),a=$(this).attr("data-week_number");-1!=j&&t!=j&&($("#dce_"+j+"-"+H).html(addFormatting(A)),$("#ftdtg_"+j+"-"+H).html(addFormatting(D)),A=0,D=0),-1!=H&&a!=H&&(hasPreviousMonthSessions&&H==hasPreviousMonthSessions||hasFutureMonthSessions&&H==hasFutureMonthSessions?($("#wcec_"+H).html(addFormatting(U)),$("#ftwtgc_"+H).html(addFormatting(L)),$("#wce_"+H).html(addFormatting(G)),$("#ftwtg_"+H).html(addFormatting(I))):($("#wcec_"+H).html(addFormatting(G)),$("#ftwtgc_"+H).html(addFormatting(I))),G=0,I=0,U=0,L=0);var e=this.id.substr(4);if("true"==$(this).attr("data-in_month")){var o=removeFormatting($(this).html());U+=1*o;var s=removeFormatting($("#fttg_"+e).html());L+=1*s}j=t,H=a;var r=removeFormatting($(this).html()),n=removeFormatting($("#fttg_"+e).html());A+=1*r,G+=1*r,D+=1*n,I+=1*n})),$("#dce_"+j+"-"+H).html(addFormatting(A)),$("#ftdtg_"+j+"-"+H).html(addFormatting(D)),$("#wcec_"+H).html(addFormatting(G)),$("#ftwtgc_"+H).html(addFormatting(I)),hasPreviousMonthSessions&&parseInt(H)==hasPreviousMonthSessions&&($("#wce_"+H).html(addFormatting(U)),$("#ftwtg_"+H).html(addFormatting(L))),hasFutureMonthSessions&&parseInt(H)==hasFutureMonthSessions&&($("#wce_"+H).html(addFormatting(U)),$("#ftwtg_"+H).html(addFormatting(L)))}function init_session_lead_dropdowns(){$("[id^=sl_]").change((function(){var t=this.id.substr(3);$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_sessionLead",user_id:$(this).val(),session_id:t},success:function(t){t.processor_success||dd_message({title:"Error",message:t.processor_message})},error:function(t,a){response="Unexpected error"}})}))}function init_exposure_controls(){$("[id^=wc_]").on("click",(function(){var t=this.id.substr(3),a="wcan_"+t;"Hide"==$(this).html()?($("[id^="+("wid_"+t)+"]").hide(),$("#"+a).show(),$(this).html("Show")):($("[id^="+("wid_"+t)+"]").show(),$("#"+a).hide(),$(this).html("Hide"),$("[id^=dn_"+t+"]").hide(),$("[id^=dc_"+t+"]").html("Hide"))})),$("[id^=dc_]").on("click",(function(){var t=$(this).parent().parent(),a=this.id.split("-"),e=a[0].substr(3),o=a[1],s="wcan_"+e,r="dn_"+e+"-"+o;"Hide"==$(this).html()?($("[id^="+("wid_"+e+"-did_"+o+"-")+"]").hide(),$(this).html("Show"),$("#"+r).show(),1==t.attr("data-interweek_day_count")&&$("[id^="+s+"]").show()):($("[id^="+("wid_"+e+"-did_"+o+"-")+"]").show(),$(this).html("Hide"),$("#"+r).hide(),1==t.attr("data-interweek_day_count")&&$("[id^="+s+"]").hide())}))}
//# sourceMappingURL=reports_goal_management.min.js.map
var hasChangedCOGS=false;function reports_goal_management_init(){$("html").bind("keypress",function(t){if(t.keyCode==13){return false}});init_exposure_controls();init_session_lead_dropdowns();init_goal_inputs();init_food_cost_inputs();init_labor_cost_inputs();init_money_formatting();init_update_p_and_l_data();calculatePage();$(".gt_input").each(function(){$(this).val(addFormatting($(this).val()))});$("#session_summary_table").stickyTableHeaders()}function init_money_formatting(){$(".gt_input").focus(function(){$(this).val(removeFormatting($(this).val()))});$(".gt_input").blur(function(){$(this).val(addFormatting($(this).val()))});$(".gt_input").keypress(function(t){if(t.which==188||t.which==190||t.which==46||t.which==45||t.keyCode==8||t.keyCode==9||t.keyCode==37||t.keyCode==39||t.keyCode==45||t.which>47&&t.which<58){return true}else if(t.keyCode==13){$(this).blur();return true}else return false});$(".gt_input").change(function(){if(isNaN($(this).val()))return false})}function init_update_p_and_l_data(){var t=new Number(0);$('[data-dd_subtype="expense"]').each(function(){t+=new Number(removeFormatting($(this).val()))});var a=new Number(removeFormatting($("#p_and_l_total_agr").html()));var o=new Number(removeFormatting($("#p_and_l_marketing_total").html()));var r=new Number(removeFormatting($("#p_and_l_royalty_total").html()));var e=new Number(removeFormatting($("#net_income").val()));$("#other_expenses").val(addFormatting(a-(t+o+r)-e));$(".gt_input").keyup(function(){var t=new Number(removeFormatting($("#net_income").val()));var a=new Number(0);$('[data-dd_subtype="expense"]').each(function(){a+=new Number(removeFormatting($(this).val()))});var e=new Number(removeFormatting($("#p_and_l_total_agr").html()));$("#other_expenses").val(addFormatting(e-(a+o+r)-t))});$("#update_p_and_l").click(function(){var t=false;$("#owner_hours, #employee_hours, #manager_hours").each(function(){if(isNaN($(this).val())){dd_message({title:"Error",message:"The hours fields must be a number."});t=true}});if(t){return false}var a=new Object;$("#finance_tab input").each(function(){a[this.id]=removeFormatting($(this).val())});$("#finance_tab input").each(function(){if(a[this.id]=="")a[this.id]="not supplied"});if($("#cost_of_goods_and_services").data("org_value")!=$("#cost_of_goods_and_services").val()){hasChangedCOGS=true}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_p_and_l_data",store_id:store_id,month:month,year:year,p_and_l_data:a},success:function(t){if(t.processor_success){dd_toast({message:"Your data was saved."});if(hasChangedCOGS){hasChangedCOGS=false;$("#cogs_msg").html("")}}else{dd_message({title:"Error",message:t.processor_message})}},error:function(t,a){response="Unexpected error: "+a;dd_message({title:"Error",message:response})}});return false})}function init_goal_inputs(){$("#avg_ticket_goal,#finishing_touch_goal,#taste_sessions_goal,#regular_guest_count_goal,#taste_guest_count_goal,#intro_guest_count_goal").change(function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_sessionGoals",store_id:store_id,month:month,year:year,goal:this.id,value:removeFormatting($(this).val())},success:function(t){if(t.processor_success){}else{dd_message({title:"Error",message:t.processor_message})}},error:function(t,a){response="Unexpected error"}})})}function updateGOGSfields(t,o){var a=t+"-1-"+o;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_expensesData",store_id:store_id,date:a,op:"retrieveForMonth"},success:function(t){$("[id^='fc_']").val(addFormatting("0.00"));$("[id^='lc_']").val(addFormatting("0.00"));if(t.processor_success){for(var a in t.food_costs){var e=t.food_costs[a];if(a.length==1)a="0"+a;if(a=="00")a="53";$("#fc_"+a+"_"+o).val(addFormatting(e))}for(var a in t.labor_costs){var e=t.labor_costs[a];if(a.length==1)a="0"+a;if(a=="00")a="53";$("#lc_"+a+"_"+o).val(addFormatting(e))}calculatePage()}else{dd_message({title:"Error",message:t.processor_message})}},error:function(t,a){dd_message({title:"Error",message:json.strError})}})}function init_food_cost_inputs(){$("[id^=fc_]").on("click",function(){$.ajax({url:"main.php?page=admin_store_expenses_v2",type:"POST",once:false,data:{store_id:store_id,month:month,year:year},success:function(t,a){dd_message({title:"Input Expenses",message:t,height:"auto",width:740,div_id:"cost_inputter",closeOnEscape:true,noOk:true});dayClickHandler=SE_dayClickHandler;initExpensesDialog()},error:function(t,a){response="Unexpected error"}})})}function init_labor_cost_inputs(){$("[id^=lc_]").on("click",function(){$.ajax({url:"main.php?page=admin_store_expenses_v2",type:"POST",once:false,data:{store_id:store_id,month:month,year:year},success:function(t,a){dd_message({title:"Input Expenses",message:t,height:"auto",width:740,div_id:"cost_inputter",closeOnEscape:true,noOk:true});dayClickHandler=SE_dayClickHandler;initExpensesDialog()},error:function(t,a){response="Unexpected error"}})})}function roundToTenths(t){t-=0;t=Math.round(t*10)/10;return t==Math.floor(t)?t+".0":t==Math.floor(t)?t+"0":t}function _report_submitClick(t){var a=parseInt($("#year_field_001").val());if(isNaN(a)){dd_message({title:"Error",message:"The year is not an integer."});return false}else if(a<2011){dd_message({title:"Error",message:"The year must be greater than 2010."});return false}$("#avg_ticket_goal").remove();$("#finishing_touch_goal").remove();$("#taste_sessions_goal").remove();$("#regular_guest_count_goal").remove();$("#taste_guest_count_goal").remove();$("#intro_guest_count_goal").remove();$("[data-dd_type='p&l_widget']").remove();return true}function removeFormatting(t){if(t==null||t=="")return t;t=t.replace(/,/,"");t=t.replace(/\$/,"");return t}function addFormatting(t){if(t==null||t=="")return"";t=accounting.formatMoney(t,"$",2,",",".","%s%v");return t}function calculatePage(){var m=$("#nonTasteSessionCount").val();var t=removeFormatting($("#avg_ticket_goal").val());var d=removeFormatting($("#finishing_touch_goal").val());var a=removeFormatting($("#regular_guest_count_goal").val());var e=removeFormatting($("#taste_guest_count_goal").val());var o=removeFormatting($("#intro_guest_count_goal").val());var g=a*1+o*1;var h=a*t+e*34.99+o*84.95;var r=h;$("#gross_revenue_goal").html(addFormatting(h));$("#calendar_month_goal").html(addFormatting(h));$("#FT_months_total_goal").html(addFormatting(d));var s=new Date;var u=$("#isCurrentMonth").val()=="true";var c=s.getDate();var v=0;var f=0;var p=0;var F=0;var w=0;var y=0;var k=false;var C=false;var b=0;var T=0;var x=0;var M=0;var S=false;var i=$("#guest_count_months_total").html();$("#sg_gross_revenue_goal").html(addFormatting(h/m));$("#sg_avg_ticket_goal").html(addFormatting($("#avg_ticket_goal").val()));$("#sg_guests_goal").html(roundToTenths($("#guests_goal").html()/m));$("#sg_finishing_touch_goal").html(addFormatting(d/m));var E=d;var N=0;$("[id^=dre_]").each(function(){if($(this).attr("data-in_month")=="true"){var t=0;var a=0;var e=this.id.substr(4);var o=$(this).attr("data-day_number");var r=removeFormatting($("#dac_"+e).html());var s=removeFormatting($("#ftt_"+e).html());var i=$(this).attr("data-is_taste")=="true";T+=r*1;x+=s*1;if(!i)M+=r*1;if(u&&o>c||month_is_future){dd_console_log("Pos: "+e+" | toDataGuestCount: "+w);if(!i){if(!S){t=h/m;v=t;N=E/(g-w)}S=true;var n=$("#sgc_"+e).html();a=formatAsMoney(N*n);f=a;$(this).html(addFormatting(v));$("#fttg_"+e).html(addFormatting(f));if(r<v){$("#dac_"+e).addClass("goal_not_met");$("#dac_"+e).removeClass("goal_met")}else{$("#dac_"+e).addClass("goal_met");$("#dac_"+e).removeClass("goal_not_met")}if(s<f){$("#fft_"+e).addClass("goal_not_met");$("#ftt_"+e).removeClass("goal_met")}else{$("#ftt_"+e).addClass("goal_met");$("#ftt_"+e).removeClass("goal_not_met")}C=f;k=v;b++}}else{if(!i){t=h/m;$(this).html(addFormatting(t));a=E/m;$("#fttg_"+e).html(addFormatting(a));v=t;f=a;if(r<t){$("#dac_"+e).addClass("goal_not_met");$("#dac_"+e).removeClass("goal_met")}else{$("#dac_"+e).addClass("goal_met");$("#dac_"+e).removeClass("goal_not_met")}if(s<a){$("#ftt_"+e).addClass("goal_not_met");$("#ftt_"+e).removeClass("goal_met")}else{$("#ftt_"+e).addClass("goal_met");$("#ftt_"+e).removeClass("goal_not_met")}p++;m--;var _=$("#sgc_"+e).html();w+=_*1}F+=r*1;h-=r;var l=removeFormatting($("#ftt_"+e).html());y+=l*1}E=d-x}});$("#aam_gross_revenue_goal").html(addFormatting(F/p));$("#aam_guests_goal").html(formatAsMoney(w/p));$("#aam_finishing_touch_goal").html(addFormatting(y/p));$("#aam_avg_ticket_goal").html(addFormatting(removeFormatting($("#aam_gross_revenue_goal").html())/$("#aam_guests_goal").html()));$("#rgrs_gross_revenue_goal").html(addFormatting(k));if(b>0)$("#rgrs_guests_goal").html(roundToTenths((g-w)/b));else $("#rgrs_guests_goal").html("0");$("#rgrs_avg_ticket_goal").html(addFormatting(removeFormatting($("#rgrs_gross_revenue_goal").html())/$("#rgrs_guests_goal").html()));var n=removeFormatting($("#FT_months_total").html());if(b>0)$("#rgrs_finishing_touch_goal").html(addFormatting((d-n)/b));else $("#rgrs_finishing_touch_goal").html("$0.00");$("#ma_gross_revenue_goal").html(addFormatting(T));var _=$("#guest_count_months_total").html();$("#ma_guests_goal").html(_);$("#ma_avg_ticket_goal").html(addFormatting(removeFormatting($("#ma_gross_revenue_goal").html())/$("#ma_guests_goal").html()));$("#ma_finishing_touch_goal").html(addFormatting(n));$("#mat_gross_revenue_goal").html(addFormatting(M));var l=$("#guestCountTotalMinusTaste").val();$("#mat_guests_goal").html(l);$("#mat_avg_ticket_goal").html(addFormatting(M/l));$("#mat_finishing_touch_goal").html(addFormatting($("#allFTTotalMinusTaste").val()));var O=0;$("[id^=fc_]").each(function(){var t=this.id.split("_");var a="fcp_"+t[1]+"_"+t[2];var e="wkt_"+t[1];var o=removeFormatting($(this).val());var r=removeFormatting($("#"+e).html());O+=o*1;var s=o*100/r;$("#"+a).html(formatAsMoney(s))});$("#total_food_cost").html(addFormatting(O));$("#total_food_cost_percentage").html(formatAsMoney(O*100/T)+"%");var P=0;$("[id^=lc_]").each(function(){var t=this.id.split("_");var a="lcp_"+t[1]+"_"+t[2];var e="wkt_"+t[1];var o=removeFormatting($(this).val());var r=removeFormatting($("#"+e).html());P+=o*1;var s=o*100/r;$("#"+a).html(formatAsMoney(s))});$("#total_labor_cost").html(addFormatting(P));$("#total_labor_cost_percentage").html(formatAsMoney(P*100/T)+"%");if(month_is_passed){if(T>=r)$("#rgrs_gross_revenue_goal").html(addFormatting(0));else $("#rgrs_gross_revenue_goal").html(addFormatting(T-r));var j=removeFormatting($("#ma_avg_ticket_goal").html());if(j>=t)$("#rgrs_avg_ticket_goal").html(addFormatting(0));else $("#rgrs_avg_ticket_goal").html(addFormatting(j-t));if(n>=d)$("#rgrs_finishing_touch_goal").html(addFormatting(0));else $("#rgrs_finishing_touch_goal").html(addFormatting(n-d));var H=$("#guests_goal").html();if(_>=H)$("#rgrs_guests_goal").html(formatAsMoney(0));else $("#rgrs_guests_goal").html(formatAsMoney(_-H))}var A=-1;var G=-1;var D=0;var I=0;var U=0;var L=0;var Y=0;var q=0;$("[id^=dre_]").each(function(){var t=$(this).attr("data-day_number");var a=$(this).attr("data-week_number");if(A!=-1&&t!=A){$("#dce_"+A+"-"+G).html(addFormatting(D));$("#ftdtg_"+A+"-"+G).html(addFormatting(U));D=0;U=0}if(G!=-1&&a!=G){if(hasPreviousMonthSessions&&G==hasPreviousMonthSessions){$("#wcec_"+G).html(addFormatting(Y));$("#ftwtgc_"+G).html(addFormatting(q));$("#wce_"+G).html(addFormatting(I));$("#ftwtg_"+G).html(addFormatting(L))}else if(hasFutureMonthSessions&&G==hasFutureMonthSessions){$("#wcec_"+G).html(addFormatting(Y));$("#ftwtgc_"+G).html(addFormatting(q));$("#wce_"+G).html(addFormatting(I));$("#ftwtg_"+G).html(addFormatting(L))}else{$("#wcec_"+G).html(addFormatting(I));$("#ftwtgc_"+G).html(addFormatting(L))}I=0;L=0;Y=0;q=0}var e=this.id.substr(4);if($(this).attr("data-in_month")=="true"){var o=removeFormatting($(this).html());Y+=o*1;var r=removeFormatting($("#fttg_"+e).html());q+=r*1}A=t;G=a;var s=removeFormatting($(this).html());var i=removeFormatting($("#fttg_"+e).html());D+=s*1;I+=s*1;U+=i*1;L+=i*1});$("#dce_"+A+"-"+G).html(addFormatting(D));$("#ftdtg_"+A+"-"+G).html(addFormatting(U));$("#wcec_"+G).html(addFormatting(I));$("#ftwtgc_"+G).html(addFormatting(L));if(hasPreviousMonthSessions&&parseInt(G)==hasPreviousMonthSessions){$("#wce_"+G).html(addFormatting(Y));$("#ftwtg_"+G).html(addFormatting(q))}if(hasFutureMonthSessions&&parseInt(G)==hasFutureMonthSessions){$("#wce_"+G).html(addFormatting(Y));$("#ftwtg_"+G).html(addFormatting(q))}}function init_session_lead_dropdowns(){$("[id^=sl_]").change(function(){var t=this.id.substr(3);$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_sessionLead",user_id:$(this).val(),session_id:t},success:function(t){if(t.processor_success){}else{dd_message({title:"Error",message:t.processor_message})}},error:function(t,a){response="Unexpected error"}})})}function init_exposure_controls(){$("[id^=wc_]").on("click",function(){var t=this.id.substr(3);var a="wcan_"+t;if($(this).html()=="Hide"){var e="wid_"+t;$("[id^="+e+"]").hide();$("#"+a).show();$(this).html("Show")}else{var o="wid_"+t;$("[id^="+o+"]").show();$("#"+a).hide();$(this).html("Hide");$("[id^=dn_"+t+"]").hide();$("[id^=dc_"+t+"]").html("Hide")}});$("[id^=dc_]").on("click",function(){var t=$(this).parent().parent();var a=this.id.split("-");var e=a[0].substr(3);var o=a[1];var r="wcan_"+e;var s="dn_"+e+"-"+o;if($(this).html()=="Hide"){var i="wid_"+e+"-did_"+o+"-";$("[id^="+i+"]").hide();$(this).html("Show");$("#"+s).show();if(t.attr("data-interweek_day_count")==1){$("[id^="+r+"]").show()}}else{var n="wid_"+e+"-did_"+o+"-";$("[id^="+n+"]").show();$(this).html("Hide");$("#"+s).hide();if(t.attr("data-interweek_day_count")==1){$("[id^="+r+"]").hide()}}})}
//# sourceMappingURL=reports_goal_management.min.js.map
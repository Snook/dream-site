let session_type,initial_load=!0;function addHostess(e){$("#session_host").val($(e).data("primary_email"))}function minutesToTime(e){let s=Math.floor(e/60),i=e-60*s;return s=s.toString(),i=i.toString(),1==s.length&&(s="0"+s),1==i.length&&(i="0"+i),s+":"+i}$(document).on("change","#menu",(function(e){bounce("main.php?page=admin_create_session&menu="+$(this).val())})),$(document).on("change","#session_type, #dream_taste_theme, #fundraiser_theme, #fundraiser_recipient",(function(e){$("#session_edit").removeClass("was-validated")})),$(document).on("change","#session_type",(function(e){switch(session_type=$(this).val(),session_type){case"SPECIAL_EVENT":$("#dream_taste_theme").prop({disabled:!0,required:!1}),$("#dream_taste_theme_selection").hideFlex(),$("#fundraiser_theme").prop({disabled:!0,required:!1}),$("#fundraiser_theme_selection").hideFlex(),$("#fundraiser_recipient_selection").hideFlex(),$("#fundraiser_recipient").prop({disabled:!0,required:!1}),$("#private_session_row").hideFlex(),$("#session_password").prop({disabled:!0,required:!1,placeholder:""}),$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1}),$("#discount_row").showFlex(),$("#session_assembly_fee_row").showFlex(),$("#session_assembly_fee_enable").prop({disabled:!1,required:!1}),$("#session_assembly_fee").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").hideFlex(),$("#session_delivery_fee_enable").prop({disabled:!0,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1}),$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}).valDefault(),$("#discount_value").prop({disabled:!1,required:!1}),$("#session_discount_div").hideFlex(),$("#intro_slots_row").showFlex(),$("#introductory_slots").prop({disabled:!1,required:!0}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}).valDefault(),$("#session_title_warn, #session_details_warn").text("").hideFlex(),$("#session_details_row").hideFlex(),$("#session_details").prop({disabled:!0,required:!1}),$("#session_type_subtype_row").showFlex(),$("#session_type_subtype").prop({disabled:!1,required:!1}),$("#standard_session_type_subtype_row").hideFlex(),$("#standard_session_type_subtype").prop({disabled:!0,required:!1}).valDefault(),$("#meal_customization_close_row").showFlex(),$("#meal_customization_close_interval_type").prop({disabled:!1,required:!0}),$("#meal_customization_close_interval").prop({disabled:!1,required:!0}),$("#session_type_subtype, #session_pickup_location").trigger("change").valDefault();break;case"DREAM_TASTE":"disable_locked"!=$("#dream_taste_theme").data("dd_type")&&$("#dream_taste_theme").prop({disabled:!1,required:!0}),$("#dream_taste_theme_selection").showFlex(),$("#fundraiser_theme").prop({disabled:!0,required:!1}),$("#fundraiser_theme_selection").hideFlex(),$("#fundraiser_recipient_selection").hideFlex(),$("#fundraiser_recipient").prop({disabled:!0,required:!1}),$("#private_session_row").showFlex(),$("#session_password").prop({disabled:!1,required:!0,placeholder:""}),$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!0}),$("#discount_row").hideFlex(),$("#session_assembly_fee_row").hideFlex(),$("#session_assembly_fee_enable").prop({disabled:!0,required:!1}),$("#session_assembly_fee").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").hideFlex(),$("#session_delivery_fee_enable").prop({disabled:!0,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1}),$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}).valDefault(),$("#discount_value").prop({disabled:!0,required:!1}),$("#session_discount_div").hideFlex(),$("#intro_slots_row").hideFlex(),$("#introductory_slots").prop({disabled:!0,required:!1}),$("#session_title_row").hideFlex(),$("#session_title").prop({disabled:!0,required:!1}).valDefault(),$("#session_title_warn, #session_details_warn").text("").hideFlex(),$("#session_details_row").showFlex(),$("#session_details").prop({disabled:!1,required:!1}),$("#session_type_subtype_row").hideFlex(),$("#session_type_subtype").prop({disabled:!0,required:!1}),$("#standard_session_type_subtype_row").hideFlex(),$("#standard_session_type_subtype").prop({disabled:!0,required:!1}).valDefault(),$("#meal_customization_close_row").hideFlex(),$("#meal_customization_close_interval_type").prop({disabled:!0,required:!1}),$("#meal_customization_close_interval").prop({disabled:!0,required:!1}),$("#dream_taste_theme").trigger("change");break;case"FUNDRAISER":$("#dream_taste_theme").prop({disabled:!0,required:!1}),$("#dream_taste_theme_selection").hideFlex(),"disable_locked"!=$("#fundraiser_theme").data("dd_type")&&$("#fundraiser_theme").prop({disabled:!1,required:!0}),$("#fundraiser_theme_selection").showFlex(),$("#fundraiser_recipient_selection").showFlex(),"disable_locked"!=$("#fundraiser_recipient").data("dd_type")&&$("#fundraiser_recipient").prop({disabled:!1,required:!0}),$("#private_session_row").hideFlex(),$("#session_password").prop({disabled:!0,required:!1,placeholder:""}),$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!1}),$("#discount_row").hideFlex(),$("#session_assembly_fee_row").hideFlex(),$("#session_assembly_fee_enable").prop({disabled:!0,required:!1}),$("#session_assembly_fee").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").hideFlex(),$("#session_delivery_fee_enable").prop({disabled:!0,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1}),$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}).valDefault(),$("#discount_value").prop({disabled:!0,required:!1}),$("#session_discount_div").hideFlex(),$("#intro_slots_row").hideFlex(),$("#introductory_slots").prop({disabled:!0,required:!1}),$("#session_title_row").hideFlex(),$("#session_title").prop({disabled:!0,required:!1}).valDefault(),$("#session_title_warn, #session_details_warn").text("").hideFlex(),$("#session_details_row").showFlex(),$("#session_details").prop({disabled:!1,required:!1}),$("#session_type_subtype_row").hideFlex(),$("#session_type_subtype").prop({disabled:!0,required:!1}),$("#standard_session_type_subtype_row").hideFlex(),$("#standard_session_type_subtype").prop({disabled:!0,required:!1}).valDefault(),$("#meal_customization_close_row").hideFlex(),$("#meal_customization_close_interval_type").prop({disabled:!0,required:!1}),$("#meal_customization_close_interval").prop({disabled:!0,required:!1}),$("#fundraiser_theme, #fundraiser_recipient").trigger("change");break;default:$("#dream_taste_theme").prop({disabled:!0,required:!1}),$("#dream_taste_theme_selection").hideFlex(),$("#fundraiser_theme").prop({disabled:!0,required:!1}),$("#fundraiser_theme_selection").hideFlex(),$("#fundraiser_recipient_selection").hideFlex(),$("#fundraiser_recipient").prop({disabled:!0,required:!1}),$("#private_session_row").showFlex(),$("#session_password").prop({disabled:!1,required:!1,placeholder:""}),$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1}),$("#discount_row").showFlex(),$("#session_assembly_fee_row").hideFlex(),$("#session_assembly_fee_enable").prop({disabled:!0,required:!1}),$("#session_assembly_fee").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").hideFlex(),$("#session_delivery_fee_enable").prop({disabled:!0,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1}),$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}).valDefault(),$("#discount_value").prop({disabled:!1,required:!1}),$("#session_discount_div").hideFlex(),$("#intro_slots_row").showFlex(),$("#introductory_slots").prop({disabled:!1,required:!1}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}),$("#session_title_warn, #session_details_warn").text("").hideFlex(),$("#session_details_row").hideFlex(),$("#session_details").prop({disabled:!0,required:!1}),$("#session_type_subtype_row").hideFlex(),$("#session_type_subtype").prop({disabled:!0,required:!1}),$("#standard_session_type_subtype_row").showFlex(),$("#standard_session_type_subtype").prop({disabled:!1,required:!0}).valDefault(),$("#meal_customization_close_row").hideFlex(),$("#meal_customization_close_interval_type").prop({disabled:!0,required:!1}),$("#meal_customization_close_interval").prop({disabled:!0,required:!1})}$("#session_password, #standard_session_type_subtype, #session_title, #session_details, #admin_notes, #session_type_subtype, #session_assembly_fee_enable, #session_delivery_fee_enable").trigger("change"),initial_load=!1})),$(document).on("change","#custom_close_interval",(function(e){$("#close_interval_typeHOURS").prop("checked",!0)})),$(document).on("change","#session_time",(function(){let e=$(this).val(),s=($("#session_end_time").val(),$("#duration_minutes").val()),i=0,o=0;""!=e&&(i=60*e.split(":")[0]+1*e.split(":")[1]),""!=e&&(0==s?$("#session_end_time").val(e):(o=i+1*s,o>=1440&&(s=1439-i,o=1439,$("#duration_minutes").val(s)),$("#session_end_time").val(minutesToTime(o))))})),$(document).on("change","#session_end_time",(function(){let e=$("#session_time").val(),s=$(this).val(),i=$("#duration_minutes").val(),o=0,r=0;""!=s&&(r=60*s.split(":")[0]+1*s.split(":")[1]),""!=e&&""!=s&&(o=60*e.split(":")[0]+1*e.split(":")[1],e>s?0==i?$("#session_end_time").val(e):(r=o+1*i,r>=1440?($("#duration_minutes").val(1439-o),r=1439,$("#session_end_time").val(minutesToTime(r))):$("#session_end_time").val(minutesToTime(r))):$("#duration_minutes").val(r-o))})),$(document).on("change","#duration_minutes",(function(){let e=$(this).val();e<0&&(e=0,$("#duration_minutes").val(0));let s=$("#session_time").val();if(8==s.length&&(s=s.substr(0,5)),""!=s){let i=60*s.split(":")[0]+1*s.split(":")[1],o=i+1*e;o>=1440&&(duration=1439-i,o=1439,$("#duration_minutes").val(duration)),$("#session_end_time").val(minutesToTime(o))}})),$(document).on("change","#dream_taste_theme, #fundraiser_theme",(function(e){let s,i;switch(s=$(this).find(":selected").data("password_required"),i=$(this).find(":selected").data("host_required"),s){case 1:$("#session_password").prop({disabled:!1,required:!0,placeholder:"*Required"});break;case 2:$("#session_password").prop({disabled:!1,required:!1,placeholder:"*Optional"});break;default:$("#session_password").prop({disabled:!0,required:!1,placeholder:"*Optional"})}switch(i){case 1:$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!0,placeholder:"*Required email address or user id"});break;case 2:$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!1,placeholder:"*Optional email address or user id"});break;default:$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1,placeholder:"*Optional Email address or user id"})}})),$(document).on("change","#standard_session_type_subtype",(function(e){let s=$(this).val();if("STANDARD"==session_type)if("PRIVATE_SESSION"===s)$("#private_session_row").showFlex(),$("#session_password").prop({disabled:!1,required:!0}),$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!0}),$("#session_title_row").hideFlex(),$("#session_title").prop({disabled:!0,required:!1}),$("#session_details_row").showFlex(),$("#session_details").prop({disabled:!1,required:!1});else $("#private_session_row").hideFlex(),$("#session_password").prop({disabled:!0,required:!1}),$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}),$("#session_details_row").hideFlex(),$("#session_details").prop({disabled:!0,required:!1})})),$(document).on("change","#session_type_subtype",(function(e){let s=$(this).val();if("SPECIAL_EVENT"==session_type)switch(s){case"REMOTE_PICKUP":$("#session_pickup_location_row").showFlex(),$("#session_pickup_location").prop({disabled:!1,required:!0}),$("#private_session_row").hideFlex(),$("#session_password").prop({disabled:!0,required:!1}),$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}),$("#session_details_row").hideFlex(),$("#session_details").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").showFlex(),$("#session_delivery_fee_enable").prop({disabled:!1,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1});break;case"REMOTE_PICKUP_PRIVATE":$("#session_pickup_location_row").showFlex(),$("#session_pickup_location").prop({disabled:!1,required:!0}),$("#private_session_row").showFlex(),$("#session_password").prop({disabled:!1,required:!0}),$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!0}),$("#session_title_row").hideFlex(),$("#session_title").prop({disabled:!0,required:!1}).val(""),$("#session_details_row").showFlex(),$("#session_details").prop({disabled:!1,required:!1}),$("#session_delivery_fee_row").showFlex(),$("#session_delivery_fee_enable").prop({disabled:!1,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1});break;case"DELIVERY":$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}),$("#private_session_row").hideFlex(),$("#session_password").prop({disabled:!0,required:!1,placeholder:""}),$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}),$("#session_details_row").hideFlex(),$("#session_details").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").showFlex(),$("#session_delivery_fee_enable").prop({disabled:!1,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1});break;case"DELIVERY_PRIVATE":case"WALK_IN":$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}),$("#private_session_row").showFlex(),$("#session_password").prop({disabled:!1,required:!0,placeholder:""}),$("#privatePartyHost").showFlex(),$("#session_host").prop({disabled:!1,required:!1}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}),$("#session_details_row").showFlex(),$("#session_details").prop({disabled:!1,required:!1}),$("#session_delivery_fee_row").showFlex(),$("#session_delivery_fee_enable").prop({disabled:!1,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1});break;default:$("#session_pickup_location_row").hideFlex(),$("#session_pickup_location").prop({disabled:!0,required:!1}),$("#private_session_row").hideFlex(),$("#session_password").prop({disabled:!0,required:!1,placeholder:""}),$("#privatePartyHost").hideFlex(),$("#session_host").prop({disabled:!0,required:!1}),$("#session_title_row").showFlex(),$("#session_title").prop({disabled:!1,required:!1}),$("#session_details_row").hideFlex(),$("#session_details").prop({disabled:!0,required:!1}),$("#session_delivery_fee_row").hideFlex(),$("#session_delivery_fee_enable").prop({disabled:!0,required:!1}),$("#session_delivery_fee").prop({disabled:!0,required:!1})}})),$(document).on("change","#session_assembly_fee_enable",(function(e){$(this).is(":checked")?$("#session_assembly_fee").prop({disabled:!1,required:!0}):$("#session_assembly_fee").prop({disabled:!0,required:!1}).valDefault()})),$(document).on("change","#session_delivery_fee_enable",(function(e){$(this).is(":checked")?$("#session_delivery_fee").prop({disabled:!1,required:!0}):$("#session_delivery_fee").prop({disabled:!0,required:!1}).valDefault()})),$(document).on("change","#session_pickup_location",(function(e){let s=$(this).find(":selected").data("location_title"),i=$(this).find(":selected").data("default_session_override");(!initial_load||initial_load&&!$("#session_assembly_fee_enable").is(":checked"))&&(0==$(this)[0].selectedIndex?$("#session_assembly_fee_enable").prop({checked:!1}).trigger("change"):(void 0!==s&&$("#session_title").val(s),void 0!==s&&!1!==i?($("#session_assembly_fee_enable").prop({checked:!0}).trigger("change"),$("#session_assembly_fee").val(i)):void 0!==s&&!1===i&&$("#session_assembly_fee_enable").prop({checked:!1}).trigger("change")))})),$(document).on("keyup change","#session_title, #session_details, #admin_notes",(function(e){$("#session_title_warn, #session_details_warn").text("").hideFlex(),"SPECIAL_EVENT"==session_type&&(match=$("#session_title").val().match(new RegExp("\\b"+["home delivery","made for you","made 4 you","m4u","mfy","assembly fee","delivery fee","pre(.*)assembled"].join("|")+"\\b","gi")),null!=match&&match.length&&$("#session_title_warn").text('The title mentions "'+match.join(", ")+'", this is likely unnecessary and may appear redundant or add clutter on small devices when displayed on the customer site.').showFlex()),"DREAM_TASTE"!=session_type&&"STANDARD"!=session_type||(match=$("#session_details").val().match(new RegExp("\\b"+["pass(.*)word","invite code"].join("|")+"\\b","gi")),null!=match&&match.length&&$("#session_details_warn").text('The details mention "'+match.join(", ")+'", this may be unnecessary to display publicly, another session type may be more appropriate.').showFlex())})),$(document).on("click","#submit_delete",(function(e){e.stopPropagation(),e.preventDefault(),bootbox.confirm("Are you sure you wish to delete this session?",(function(e){e&&($("#session_edit").removeClass("needs-validation"),$("<input>").attr({type:"hidden",name:"submit_delete",value:!0}).appendTo("#session_edit"),$("#session_edit").submit())}))})),$("#session_type").trigger("change"),$("#session_submit").prop("disabled",!1);
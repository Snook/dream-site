var originalMaxPPDeduction=0;var selectedFreeMenuItem;var couponFreeMenuItemRequired=false;function handle_ltd_round_up(){$("#add_ltd_round_up").prop("disabled",false);if(orderState=="SAVED"&&!$("#add_ltd_round_up").is(":checked")&&GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value>0&&orderInfo.ltd_round_up_value==""){$("#add_ltd_round_up").prop("checked",true);if(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value==1){$("#ltd_round_up_select option[id='round_up_nearest_dollar']").attr("selected","selected");$("#ltd_round_up_select").prop("disabled",false)}else{$("#ltd_round_up_select").prop("disabled",false).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger("change")}}else if($("#add_ltd_round_up").is(":checked")){$("#ltd_round_up_select").prop("disabled",false)}$("#add_ltd_round_up").on("change",function(e){if($(this).is(":checked")){$("#ltd_round_up_select").prop("disabled",false);if(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value==""&&(!$.cookie("ltdru")||$.cookie("ltdru")!=user_id+"."+session_id)){dd_message({title:"My Preferences",message:'Would <span style="font-weight: bold; color: red;">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style="font-weight: bold;">My Preferences</span>.<div style="text-align: center; margin-top: 10px;"><select id="ltd-round_up_opt_in"><option>Select a Round Up value</option><option value="1">Nearest Dollar</option></select></div>',modal:true,noOk:true,closeOnEscape:false,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide();var n=$(this);$("#ltd-round_up_opt_in").on("change",function(e){var t=$(this).val();if(t>0){dd_message({div_id:"rup_confirm",title:"My Preferences",message:"You have chosen to set your auto Round Up to "+(t==1?"the nearest dollar.":"$"+t),confirm:function(){$(n).remove();set_user_pref("LTD_AUTO_ROUND_UP",t,user_id);if(orderInfo.ltd_round_up_value==0&&t!=1||$("#ltd_round_up_select option:selected").index()==0&&!$.cookie("ltdru")){dd_message({title:"My Preferences",message:"Preference saved. Would you like to use the selected Round Up value on this order?",modal:true,noOk:true,closeOnEscape:false,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{Yes:function(){if(t==1){$("#ltd_round_up_select option:eq(0)").prop("selected",true).trigger("change")}else{$("#ltd_round_up_select").val(t).trigger("change")}$(this).remove()},No:function(){$(this).remove()}}})}}})}})},buttons:{No:function(){$(this).remove();set_user_pref("LTD_AUTO_ROUND_UP",0,user_id)},"Ask Again Later":function(){$(this).remove();$.cookie("ltdru",user_id+"."+session_id)}}})}}else{$("#ltd_round_up_select").prop("disabled",true)}$("#ltd_round_up_select").trigger("change");calculateTotal()});$("#ltd_round_up_select").on("change",function(e){var t=$(this).val();$("#checkout_total-roundup_donation").text(formatAsMoney(t));if($("#add_ltd_round_up").is(":checked")){$("#ltd_round_up_div").slideDown()}else{$("#ltd_round_up_div").slideUp();t=0}calculateTotal()});calculateTotal()}function handle_fundraiser_selection(){if(isFundraiser){$("#fundraiser_id").prop("disabled",true);$("#fundraiser_value").on("blur",function(){if(Number($(this).val())<Number($(this).data("donation_value"))){dd_message({title:"Alert",message:"Fundraiser value can not be less than $"+$(this).data("donation_value")});$(this).val($(this).data("org_value"))}})}if(parseFloat($("#fundraiser_value").val())>0){var a=true}else{var a=false}$("#fundraiser_id").on("change",function(){var e=0;var t="";var n=true;if($(this).find(":selected").val()!=""){if($(this).find(":selected").data("active")==1){n=false}e=$(this).find(":selected").data("value");t=$(this).find(":selected").data("description")}$("#fundraiser_description_div").text(t);$("#fundraiser_value").prop("disabled",n);if(!a&&!n||e==0){$("#fundraiser_value").val(parseFloat(e).toFixed(2))}else if(n){$("#fundraiser_value").val($("#fundraiser_value").data("org_value"))}calculateTotal()});$("#fundraiser_value").on("keyup",function(){a=true;var e=parseFloat(($("#OEH_grandtotal").text()/2).toFixed(2));var t=0;if($("#fundraiser_value").val()){t=parseFloat($("#fundraiser_value").val())}if(t>e){$("#fundraiser_value").val(e)}calculateTotal()})}function handleCouponCodeResult(t){if(t.validation_errors){printString="";for(anError in t.validation_errors){if(t.validation_errors[anError]!=""&&t.validation_errors[anError]!=null){printString+=t.validation_errors[anError]+"<br />"}}$("#coupon_error").html(printString);$("#coupon_error").show();$("#couponCodeSubmitter").show();$("#proc_mess").hide()}else{$("#coupon_error").hide();$("#coupon_error").html("");$("#proc_mess").hide();$("#couponDeleter").show();$("#coupon_code").prop("disabled",true);$("#couponValue").val(t.coupon_code_discount_total);$("#coupon_id").val(t.code_id);$("#coupon_type").val(t.discount_method);if(t.discount_method=="FREE_MEAL"){$("#coupon_free_meal_row").show();$("#free_entree").html(t.entree_title);$("#free_entree_servings").val(t.entree_servings)}else if(t.discount_method=="FREE_MENU_ITEM"){handleFreeMenuItem(t.coupon_obj.coupon_code)}else if(t.discount_method=="BONUS_CREDIT"){createBonusCredit(0)}else if(t.coupon_obj.limit_to_recipe_id=="1"){let e=t.order_item_array[t.coupon_obj.menu_item_id][0];$("#qty_"+t.coupon_obj.menu_item_id).val(e).trigger("keyup")}coupon=t.coupon;couponDiscountMethod=t.discount_method;couponDiscountVar=t.discount_var;couponlimitedToFT=t.limit_to_finishing_touch;couponIsValidWithPlatePoints=t.valid_with_plate_points_credits;couponFreeMenuItemRequired=true;if(couponlimitedToFT&&$("#max_plate_points_deduction").length){let e=$("#max_plate_points_deduction").html()*1;originalMaxPPDeduction=e;e-=t.coupon_code_discount_total;if(e<0){e=0}$("#max_plate_points_deduction").html(formatAsMoney(e))}calculateTotal()}}function processCode(){if(isDreamRewardsOrder){var e=true;e=confirm("Coupon Codes should not be used with a Dream Rewards Order. Do you want to continue?");if(!e){return}}var t=$("#coupon_code").val();$("#couponCodeSubmitter").hide();var n=$("#editorForm").get()[0];var a=false;var d=document.getElementById("selectedBundle");if(d&&!d.checked){a=true}var o="";for(i=0;i<n.elements.length;i++){if(a&&n.elements[i].name=="selectedBundle"){}else{o+=n.elements[i].name+"="+n.elements[i].value;if(i+1!=n.elements.length){o+="&"}}}o=o+"&store_id="+STORE_DETAILS.id;var s=new Date;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_orderMgrCouponCodeProcessor",user_id:user_id,op:"add",org_ts:"org_order_time",order_id:order_id,unique:s.getTime(),coupon_code:t,order_state:orderState,params:o},success:function(e){if(e.processor_success){handleCouponCodeResult(e)}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#coupon_error").html("");$("#coupon_error").hide();$("#couponCodeSubmitter").show();$("#proc_mess").hide();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function removeCode(){var e=$("#editorForm").get()[0];var t=false;var n=document.getElementById("selectedBundle");if(n&&!n.checked){t=true}var a="";for(i=0;i<e.elements.length;i++){if(t&&e.elements[i].name=="selectedBundle"){}else{a+=e.elements[i].name+"="+e.elements[i].value;if(i+1!=e.elements[i]){a+="&"}}}a=a+"&store_id="+STORE_DETAILS.id;var d=new Date;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_orderMgrCouponCodeProcessor",op:"remove",user_id:user_id,org_ts:"org_order_time",order_id:order_id,unique:d.getTime(),order_state:orderState,params:a},success:function(t){if($("#coupon_type").val()=="BONUS_CREDIT"){removeBonusCredit()}$("#couponCodeSubmitter").show();$("#proc_mess").hide();$("#couponDeleter").hide();$("#coupon_code").prop("disabled",false);$("#coupon_error").hide();$("#coupon_error").html("");$("#couponValue").val(0);$("#coupon_free_meal_row").hide();$("#free_entree").html("");$("#coupon_id").val("");$("#coupon_type").val("");$("#coupon_select_free_menu_item_row").hide();$("#free_menu_item_coupon option:not([value])").attr("data-dd_required",false);if(coupon&&coupon.limit_to_recipe_id=="1"){let e=0;if(Object.keys(t.order_item_array).length&&t.order_item_array[coupon.menu_item_id]){e=t.order_item_array[coupon.menu_item_id][0]}$("#qty_"+coupon.menu_item_id).val(e)}coupon=false;couponFreeMenuItem=false;couponFreeMenuItemRequired=false;couponDiscountMethod="NONE";couponDiscountVar=0;couponlimitedToFT=false;couponIsValidWithPlatePoints=true;calculateTotal()},error:function(e,t){$("#coupon_error").html("");$("#coupon_error").hide();$("#couponCodeSubmitter").show();$("#proc_mess").hide();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function handle_free_menu_item_edit(){if(couponFreeMenuItem){handleFreeMenuItem($("#coupon_code").val())}}function handleFreeMenuItem(e){var t=0;if(e=="SRDessert"){t=buildFreeMenuItemList("menu_item.menu_category_id == 9")}else if(e=="SRDinner"){t=buildFreeMenuItemList("menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'")}else if(e=="CC3RDFREE"){t=buildFreeMenuItemList("(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00")}else if(e=="SCFinishingTouch"){t=buildFreeMenuItemList("menu_item.menu_category_id == 9 && menu_item.price <= 15.00")}else if(e=="HCFastLane"){t=buildFreeMenuItemList("menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'")}else if(e=="SCFriendDinner"){t=buildFreeMenuItemList("menu_item.menu_class == 'Specials' && menu_item.intro_item == true")}if(t>0){$("#coupon_select_free_menu_item_row").show();$("#free_menu_item_coupon").attr("data-dd_required",true).on("change",function(e){var t=$(this).find(":selected").data("menu_item");var n=$(this).find(":selected").data("price");$("#couponValue").val(n);selectedFreeMenuItem=t;calculateTotal()})}else{dd_message({title:"Alert",message:"No valid free items found in cart for this coupon, please add the desired item and then submit the coupon."});removeCode()}}function buildFreeMenuItemList(expression){rebuildOrderItemsArray();var menu_item_in_list=false;var selected_menu_item_in_list=false;var menu_item_count=0;var s=$("#free_menu_item_coupon").html("").attr("disabled",couponFreeMenuItem?true:false);$("<option />").val("").text("Select Free Item").appendTo(s);$.each(orderItems,function(index,menu_item){if(!menu_item_in_list){menu_item_in_list=couponFreeMenuItem==menu_item.id?true:false}if(!selected_menu_item_in_list){selected_menu_item_in_list=selectedFreeMenuItem==menu_item.id?true:false}if(eval(expression)){menu_item_count++;$("<option />").val(menu_item.id).attr("data-menu_item",menu_item.id).attr("data-price",menu_item.price).attr("selected",couponFreeMenuItem==menu_item.id||selectedFreeMenuItem==menu_item.id?true:false).text(menu_item.item_title+" ("+menu_item.price+")").appendTo(s)}});if(!menu_item_in_list){$("#couponValue").val("0.00");$("#free_menu_item_coupon").attr("disabled",false)}calculateTotal();return menu_item_count}function stripLeadingZeroes(e){var t=0;var n=e;for(var a=0,d=e.length;a<d;a++){if(e[a]!="0"){break}t++}if(t>0){n=e.slice(t)}return n}function handlePlatePointsDiscount(e){if(!couponIsValidWithPlatePoints){document.getElementById("plate_points_discount").value=formatAsMoney(0);dd_message({title:"Alert",message:"PLATEPOINTS cannot be used with the attached coupon."})}if((isNaN(e)||e<=0)&&e!="."){$("#plate_points_discount").val("0");calculateTotal();return}needPlatePointsMaxDiscountChangeWarning=false;e=formatAsMoney(Math.abs(e))*1;var t=$("#plate_points_available").html()*1;var n=$("#max_plate_points_deduction").html()*1;var a=$("#plate_points_discount").val()*1;if(n<a){$("#plate_points_discount").val(n)}if(t>n){$("#tbody_max_plate_points_deduction").show()}else{$("#tbody_max_plate_points_deduction").hide()}var d=t;if(d>n){d=n}if(e>d){e=d;$("#plate_points_discount").val(e)}calculateTotal()}function editCashCheckAmount(e,t){$("#check_total_input_"+e).show();$("#check_payment_number_input_"+e).show();$("#check_total_"+e).hide();$("#check_payment_number_"+e).hide();$("#check_editlink_"+e).hide()}function editCashCheckUpdate(e,t){$("#payment_sum_value_"+e).html($("#check_total_input_form_"+e).val());$("#payment_sum_name_"+e).html("Check (#"+$("#check_payment_number_input_form_"+e).val()+")");new_total=0;$('[id^="payment_sum_value_"]').each(function(e){new_total=new_total+Number($(this).text())});$('[id^="refund_payment_sum_value_"]').each(function(e){new_total=new_total-Number($(this).text())});$("#OEH_paymentsTotal").html(formatAsMoney(new_total));calculateTotal()}function getGiftCardBalance(){$("#gc_proc_anim").show();$("#balance_target").hide();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"giftCardBalance",card_number:$("#debit_gift_card_number").val(),output:"json"},success:function(e){if(e.processor_success){$("#balance_target").show();$("#balance_target").html(e.card_balance);$("#gc_proc_anim").hide()}else if(e.message=="Not logged in"){$("#balance_target").show();$("#balance_target").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+request_uri+'">[login]</a> again.</span>');$("#gc_proc_anim").hide()}else{$("#balance_target").show();$("#balance_target").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>");$("#gc_proc_anim").hide()}},error:function(e,t){$("#balance_target").show();$("#balance_target").html("Error: "+t+'. Please <a href="javascript:getGiftCardBalance();">[try again]</a>.')}})}function editCashCheckAmountCommit(n,a){alert("You are only modifying the "+a+" details.\nNo other modifications will be made.");$("#check_total_mess_"+n).hide();new_total=$("#check_total_input_form_"+n).val();new_number=$("#check_payment_number_input_form_"+n).val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_editCashCheckAmount",id:n,type:a,new_total:new_total,new_number:new_number,order_id:order_id},success:function(e){if(e.processor_success){$("#check_total_input_"+n).hide();$("#check_payment_number_input_"+n).hide();$("#check_total_"+n).show();$("#check_payment_number_"+n).show();$("#check_editlink_"+n).show();$("#check_total_"+n).html(new_total);$("#check_payment_number_"+n).html(new_number);$("#check_total_mess_"+n).show();$("#check_total_mess_"+n).show().html('<img src="'+PATH.image_admin+'/icon/accept.png" alt="Accept" />').fadeOut(2e3)}else if(e.message=="Not logged in"){$("#check_total_mess_"+n).show();$("#check_total_mess_"+n).html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+ +'">[login]</a> again.</span>')}else{$("#check_total_mess_"+n).show();$("#check_total_mess_"+n).html('<span style="color:red;font-weight:bold;">'+e.processor_message+"</span>")}},error:function(e,t){$("#check_total_mess_"+n).show();$("#check_total_mess_"+n).html("Error: "+t+'. Please <a href="javascript:editCashCheckAmountCommit('+n+",'"+a+"');\">[try again]</a>.")}})}function showButtonProcessDelayedPaymentNow(e){if(PendingDPOriginalStatus=="PENDING"){$("#payment_proc_mess").show();$("#payment_proc_mess").html('<input type="button" class="button" name="process_payment" value="Process delayed payment now" onclick="processPayment();">')}else if(e){$("#payment_proc_mess").show();$("#payment_proc_mess").html(e)}else{$("#payment_proc_mess").hide()}}function processPayment(){if(confirm("Are you sure you wish to process the delayed payment now? Click OK to process.")){$("#payment_proc_mess").show();$("#payment_proc_mess").html('<img src="'+PATH.image_admin+'/throbber_processing_noborder.gif" alt="Processing" />');$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_delayedPaymentProcessor",order_number:order_id},success:function(e){if(e.success){if($("#point_to_transaction").length){var t=$("#point_to_transaction option:selected").text();$("#cc_payment_number_other").html("XXXXXXXXXXXX"+t.substr(-4))}$("#cc_delayed_tran_num_other").html(e.transaction_id);$("#cc_delayed_date_other").html(e.transaction_date);$("#cc_delayed_status_other").html("Status: Payment Processed");$("#payment_sum_row_"+e.payment_id).css({color:""});$("#payment_sum_type_"+e.payment_id).css({color:""});$("#payment_sum_name_"+e.payment_id).css({color:""});$("#payment_sum_value_"+e.payment_id).css({color:""});$("#payment_sum_date_"+e.payment_id).css({color:""});$("#payment_sum_date_"+e.payment_id).html(e.summary_date);canAdjustDelayedPayment=false;$("#payment_proc_mess").html('<span style="color:green;font-weight:bold;">Payment Processed.</span>').fadeOut(4e3)}else if(e.message=="Not logged in"){$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+back_path()+'">[login]</a> again.</span>')}else{$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>")}},error:function(e,t){$("#payment_proc_mess").show();$("#payment_proc_mess").html("Error: "+t+'. Please <a href="javascript:processPayment();">[try again]</a>.')}})}}function setDelayedPaymentStatusTo(){if($("#change_delayed_payment_status").val()=="FAIL"&&PendingDPOriginalStatus!="FAIL"){alert("Can not change transaction back to Fail. Please choose pending or canceled.");$("#change_delayed_payment_status").val(PendingDPOriginalStatus);return false}if($("#change_delayed_payment_status")){$("#point_to_transaction").val(PendingDPOriginalTransActionID)}if($("#change_delayed_payment_status").val()==PendingDPOriginalStatus){showButtonProcessDelayedPaymentNow()}else{$("#payment_proc_mess").show();$("#payment_proc_mess").html('<input type="button" class="button" name="set_delayed_payment_status" value="Set delayed payment status to '+$("#change_delayed_payment_status").val().toLowerCase()+'" onClick="processDelayedPaymentStatus();">')}}function setupCouponState(){if(coupon){document.getElementById("couponCodeSubmitter").style.display="none";document.getElementById("couponDeleter").style.display="inline";document.getElementById("coupon_code").value=coupon.coupon_code;document.getElementById("coupon_code").disabled=true}}function processDelayedPaymentStatus(){$("#payment_proc_mess").show();$("#payment_proc_mess").html('<img src="'+PATH.image_admin+'/throbber_processing_noborder.gif" alt="Processing" />');$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_delayedPaymentStatusProcessor",order_number:order_id,old_status:PendingDPOriginalStatus,new_status:$("#change_delayed_payment_status").val(),store_id:store_id},success:function(e){if(e.success){PendingDPOriginalStatus=e.status;$("#change_delayed_payment_status").val(PendingDPOriginalStatus);if($("#change_delayed_payment_status")){$("#point_to_transaction").val(PendingDPOriginalTransActionID)}if(e.status=="CANCELLED"&&$("#payment_sum_value_"+e.payment_id)){$("#payment_sum_value_"+e.payment_id).attr("id","cancelled_payment_sum_value_"+e.payment_id)}else if(e.status=="PENDING"&&$("#cancelled_payment_sum_value_"+e.payment_id)){$("#cancelled_payment_sum_value_"+e.payment_id).attr("id","payment_sum_value_"+e.payment_id)}if(e.status=="CANCELLED"){canAdjustDelayedPayment=false;$("#payment_sum_row_"+e.payment_id).css({"text-decoration":"line-through"});$("#payment_sum_type_"+e.payment_id).css({"text-decoration":"line-through"});$("#payment_sum_name_"+e.payment_id).css({"text-decoration":"line-through"});$("#cancelled_payment_sum_value_"+e.payment_id).css({"text-decoration":"line-through"});$("#payment_sum_date_"+e.payment_id).css({"text-decoration":"line-through"});$("#OEH_paymentsTotal").html(formatAsMoney(Number($("#OEH_paymentsTotal").html())-Number($("#cancelled_payment_sum_value_"+e.payment_id).html())));$("#dp_adjust_div").hide()}else{canAdjustDelayedPayment=true;$("#payment_sum_row_"+e.payment_id).css({"text-decoration":"none"});$("#payment_sum_type_"+e.payment_id).css({"text-decoration":"none"});$("#payment_sum_name_"+e.payment_id).css({"text-decoration":"none"});$("#payment_sum_value_"+e.payment_id).css({"text-decoration":"none"});$("#payment_sum_date_"+e.payment_id).css({"text-decoration":"none"});$("#OEH_paymentsTotal").html(formatAsMoney(Number($("#OEH_paymentsTotal").html())+Number($("#payment_sum_value_"+e.payment_id).html())));canAutoAdjust=true}calculateTotal();showButtonProcessDelayedPaymentNow('<span style="color:green;font-weight:bold;">Delayed Payment set to '+PendingDPOriginalStatus+".</span>");$("#change_delayed_payment_status_img").attr({src:PATH.image_admin+"/icon/accept.png",alt:"Accept"});$("#change_delayed_payment_status_img").css({display:"inline"}).fadeOut(2e3)}else if(e.message=="Not logged in"){$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+back_path()+'">[login]</a> again.</span>')}else{$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>")}},error:function(e,t){$("#payment_proc_mess").show();$("#payment_proc_mess").html("Error: "+t+'. Please <a href="javascript:processDelayedPaymentStatus();">[try again]</a>.')}})}function pointToTransaction(){$("#change_delayed_payment_status").val(PendingDPOriginalStatus);if($("#point_to_transaction").val()==PendingDPOriginalTransActionID){$("#payment_proc_mess").show();showButtonProcessDelayedPaymentNow()}else{$("#payment_proc_mess").show();$("#payment_proc_mess").html('<input type="button" class="button" name="point_to_payment" value="Point payment to selected Credit Card Number" onClick="processPointToTransaction();">')}}function processPointToTransaction(){$("#payment_proc_mess").show();$("#payment_proc_mess").html('<img src="'+PATH.image_admin+'/throbber_processing_noborder.gif" alt="Processing" />');$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_processPointToTransaction",order_number:order_id,store_id:store_id,old_ref_number:PendingDPOriginalTransActionID,new_ref_number:$("#point_to_transaction").val(),new_card_number:$("#point_to_transaction option:selected").text()},success:function(e){if(e.success){PendingDPOriginalTransActionID=e.transactionid;$("#point_to_transaction").val(PendingDPOriginalTransActionID);$("#change_delayed_payment_status").val(PendingDPOriginalStatus);$("#payment_sum_type_"+e.payment_id).html(e.new_card_type);$("#payment_sum_name_"+e.payment_id).html("Delayed CC Payment (#"+e.new_card_number+")");$("#cc_credit_card_type_other").html(e.new_card_type);$("#cc_payment_transaction_number_other").html(e.transactionid);showButtonProcessDelayedPaymentNow('<span style="color:green;font-weight:bold;">Credit card set to '+e.new_card_type+".</span>");$("#point_to_transaction_img").css({display:"inline"}).fadeOut(2e3)}else if(e.message=="Not logged in"){$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">Session timed out, please <a href="'+back_path()+'">[login]</a> again.</span>')}else{$("#payment_proc_mess").html('<span style="color:red;font-weight:bold;">'+e.message+"</span>")}},error:function(e,t){$("#payment_proc_mess").show();$("#payment_proc_mess").html("Error: "+t+'. Please <a href="javascript:processPointToTransaction();">[try again]</a>.')}})}function unsetAutoAdjust(){if($("#autoAdjust").length){document.getElementById("autoAdjust").checked=false}}function setAllPaymentFieldsToUnrequired(){var e;e=document.getElementById("payment1_gc_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_gc_payment_number");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_ccNameOnCard");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_ccNumber");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_ccType");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_ccMonth");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_ccYear");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_cash_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_cash_total_number");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_refund_cash_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_refund_cash_total_number");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_check_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_check_total_number");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_cc_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_reference_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment1_ref_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_ccType");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_ccMonth");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_ccYear");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_gc_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_gc_payment_number");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_ccNameOnCard");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_ccNumber");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_cash_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_check_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_cc_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("payment2_ref_total_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("debit_gift_card_amount");if(e){e.setAttribute("data-dd_required","false")}e=document.getElementById("debit_gift_card_number");if(e){e.setAttribute("data-dd_required","false")}}var lastPayment1Type=false;function changePayment1(e){if(lastPayment1Type&&lastPayment1Type!=e){if(lastPayment1Type=="CC"){$("#payment1_gc_total_amount").val("")}else if(lastPayment1Type=="REFERENCE"){$("#payment1_reference_total_amount").val("")}}lastPayment1Type=e;var t=document.getElementById("payment1_gc");var n=document.getElementById("payment1_cash");var a=document.getElementById("payment1_refund_cash");var d=document.getElementById("payment1_check");var o=document.getElementById("payment1_cc");var s=document.getElementById("payment1_credit");var r=document.getElementById("payment1_reference");var i=document.getElementById("payment1_ref");var l=document.getElementById("payment1RefundCCDiv");var u=document.getElementById("dp_adjust_div");document.getElementById("new_payments_total").value=0;if(document.getElementById("use_store_credits")&&document.getElementById("use_store_credits").checked){document.getElementById("new_payments_total").value=formatAsMoney(document.getElementById("store_credits_amount").value)}var m=document.getElementById("payment1_debit_gift_card");var _=document.getElementById("payment2");var c=false;if(e.substr(0,4)=="REF_"){c=e.substr(4);e="REFERENCE_OTHER"}resetPendingDelayedPayment();var y=document.getElementById("payment1_cc_total_amount");y.value="";var p;p=document.getElementById("payment1_gc_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_gc_payment_number");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_ccNameOnCard");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_ccNumber");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_cash_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_refund_cash_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_check_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_cash_total_number");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_refund_cash_total_number");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_check_total_number");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_cc_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_reference_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("debit_gift_card_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("debit_gift_card_number");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_ref_total_amount");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_ccType");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_ccMonth");if(p){p.setAttribute("data-dd_required","false")}p=document.getElementById("payment1_ccYear");if(p){p.setAttribute("data-dd_required","false")}switch(e){case"REFERENCE":l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";r.style.display="block";s.style.display="none";o.style.display="none";i.style.display="none";m.style.display="none";if(u&&canAdjustDelayedPayment){u.style.display="none";unsetAutoAdjust()}_.style.display="none";p=document.getElementById("payment1_reference_total_amount");if(p){p.setAttribute("data-dd_required","true")}changePayment2("");onPaymentSelected();break;case"GIFT_CERT":unsetAutoAdjust();l.style.display="none";t.style.display="block";n.style.display="none";a.style.display="none";d.style.display="none";r.style.display="none";o.style.display="none";s.style.display="none";if(u){u.style.display="none"}if(orderState!="ACTIVE"){_.style.display="block"}m.style.display="none";i.style.display="none";p=document.getElementById("payment1_gc_total_amount");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_gc_payment_number");if(p){p.setAttribute("data-dd_required","true")}onPaymentSelected();break;case"CASH":unsetAutoAdjust();t.style.display="none";l.style.display="none";n.style.display="block";a.style.display="none";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="none";if(u){u.style.display="none"}_.style.display="none";m.style.display="none";i.style.display="none";if(orderState=="ACTIVE"){y=document.getElementById("payment1_cash_total_amount");balance=Number(document.getElementById("OEH_remaing_balance").innerHTML);y.value=formatAsMoney(balance-document.getElementById("new_payments_total").value)}else{y=document.getElementById("payment1_cash_total_amount");y.value=formatAsMoney(0)}p=document.getElementById("payment1_cash_total_amount");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_cash_total_number");if(p){p.setAttribute("data-dd_required","false")}changePayment2("");onPaymentSelected();break;case"REFUND_CASH":unsetAutoAdjust();l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="block";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="none";if(u){u.style.display="none"}_.style.display="none";m.style.display="none";i.style.display="none";p=document.getElementById("payment1_refund_cash_total_amount");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_refund_cash_total_number");if(p){p.setAttribute("data-dd_required","false")}changePayment2("");onPaymentSelected();break;case"CHECK":unsetAutoAdjust();l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="block";o.style.display="none";r.style.display="none";s.style.display="none";if(u){u.style.display="none"}_.style.display="none";m.style.display="none";i.style.display="none";y=document.getElementById("payment1_check_total_amount");balance=Number(document.getElementById("OEH_remaing_balance").innerHTML);y.value=formatAsMoney(balance-document.getElementById("new_payments_total").value);p=document.getElementById("payment1_check_total_amount");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_check_total_number");if(p){p.setAttribute("data-dd_required","false")}changePayment2("");onPaymentSelected();break;case"CREDIT":l.style.display="none";paymentsTotal=Number(document.getElementById("OEH_paymentsTotal").innerHTML);if(paymentsTotal!=0){alert("'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away.");paySel=document.getElementById("payment1_type");paySel.value="";changePayment1("");return}unsetAutoAdjust();t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="block";if(u){u.style.display="none"}_.style.display="none";m.style.display="none";i.style.display="none";changePayment2("");onPaymentSelected();break;case"CC":unsetAutoAdjust();l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="block";r.style.display="none";s.style.display="none";if(u){u.style.display="none"}_.style.display="none";m.style.display="none";i.style.display="none";y=document.getElementById("payment1_cc_total_amount");balance=Number(document.getElementById("OEH_remaing_balance").innerHTML);y.value=formatAsMoney(balance-document.getElementById("new_payments_total").value);p=document.getElementById("payment1_ccNameOnCard");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_ccNumber");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_cc_total_amount");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_ccType");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_ccMonth");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("payment1_ccYear");if(p){p.setAttribute("data-dd_required","true")}changePayment2("");onPaymentSelected();break;case"GIFT_CARD":unsetAutoAdjust();l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="none";if(u){u.style.display="none"}_.style.display="none";m.style.display="block";i.style.display="none";p=document.getElementById("debit_gift_card_amount");if(p){p.setAttribute("data-dd_required","true")}p=document.getElementById("debit_gift_card_number");if(p){p.setAttribute("data-dd_required","true")}if(orderState!="ACTIVE"){_.style.display="block"}onPaymentSelected();break;case"DPADJUST":if(!u){return}if(!canAdjustDelayedPayment){alert("Can not adjust delayed payment.\n\nDelayed payment status: "+PendingDPOriginalStatus);autoAdjBox=document.getElementById("autoAdjust");if(!forceManualAutoAdjust){autoAdjBox.checked=true;handleAutoAdjust(autoAdjBox)}return false}l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="none";_.style.display="none";u.style.display="block";m.style.display="none";i.style.display="none";balance=Number(document.getElementById("OEH_remaing_balance").innerHTML);balance=formatAsMoney(balance-document.getElementById("new_payments_total").value);adjustPendingDelayedPayment(balance);changePayment2("");onPaymentSelected();break;case"REFERENCE_OTHER":l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="none";_.style.display="none";m.style.display="none";i.style.display="block";document.getElementById("p1_card_num").innerHTML=externalPaymentAmountArray[c]["cc_number"];document.getElementById("p1_ref_id").innerHTML=c;p=document.getElementById("payment1_ref_total_amount");if(p){p.setAttribute("data-dd_required","true");balance=Number(document.getElementById("OEH_remaing_balance").innerHTML);p.value=formatAsMoney(balance-document.getElementById("new_payments_total").value)}changePayment2("");onPaymentSelected();break;case"CC_REFUND":unsetAutoAdjust();l.style.display="block";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="none";r.style.display="none";s.style.display="none";if(u){u.style.display="none"}_.style.display="none";m.style.display="none";i.style.display="none";onPaymentSelected();break;default:unsetAutoAdjust();l.style.display="none";t.style.display="none";n.style.display="none";a.style.display="none";d.style.display="none";o.style.display="none";s.style.display="none";_.style.display="none";r.style.display="none";i.style.display="none";m.style.display="none";resetPendingDelayedPayment();if(u){u.style.display="none"}onPaymentDeselected()}reportPaymentStatus(false)}function changePayment2(e){reportPaymentStatus(true);var t=$("#bal_due").html();var n=Number($("#bal_due").html());if(isNaN(n.valueOf())){n=""}if(n.valueOf()==0){n=""}var a=document.getElementById("payment2_cash");var d=document.getElementById("payment2_refund)_cash");var o=document.getElementById("payment2_check");var s=document.getElementById("payment2_cc");var r=document.getElementById("payment2_ref");var i;i=document.getElementById("payment2_gc_total_amount");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_gc_payment_number");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_ccNameOnCard");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_ccNumber");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_cash_total_amount");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_cc_total_amount");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_ref_total_amount");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_ccType");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_ccMonth");if(i){i.setAttribute("data-dd_required","false")}i=document.getElementById("payment2_ccYear");if(i){i.setAttribute("data-dd_required","false")}var l=false;if(e.substr(0,4)=="REF_"){l=e.substr(4);e="REFERENCE_OTHER"}switch(e){case"CASH":a.style.display="block";o.style.display="none";s.style.display="none";r.style.display="none";i=document.getElementById("payment2_cash_total_amount");if(i){i.setAttribute("data-dd_required","true")}$("#payment2_cash_total_amount").val(n);break;case"CHECK":a.style.display="none";o.style.display="block";s.style.display="none";r.style.display="none";i=document.getElementById("payment2_check_total_amount");if(i){i.setAttribute("data-dd_required","true")}$("#payment2_check_total_amount").val(n);break;case"CC":a.style.display="none";o.style.display="none";s.style.display="block";r.style.display="none";i=document.getElementById("payment2_ccNameOnCard");if(i){i.setAttribute("data-dd_required","true")}i=document.getElementById("payment2_ccNumber");if(i){i.setAttribute("data-dd_required","true")}i=document.getElementById("payment2_ccType");if(i){i.setAttribute("data-dd_required","true")}i=document.getElementById("payment2_ccMonth");if(i){i.setAttribute("data-dd_required","true")}i=document.getElementById("payment2_ccYear");if(i){i.setAttribute("data-dd_required","true")}$("#payment2_cc_total_amount").val(n);break;case"REFERENCE_OTHER":a.style.display="none";o.style.display="none";s.style.display="none";r.style.display="block";document.getElementById("p2_card_num").innerHTML=externalPaymentAmountArray[l]["cc_number"];document.getElementById("p2_ref_id").innerHTML=l;i=document.getElementById("payment2_ref_total_amount");$("#payment2_ref_total_amount").val(n);if(i){i.setAttribute("data-dd_required","true")}break;default:i=document.getElementById("payment2_type");i.selectedItem=0;a.style.display="none";o.style.display="none";s.style.display="none"}reportPaymentStatus(false)}function validateRefTrans(e,t){if(e.value>t){alert("Limited to "+t+".");e.value=t}if(e.value<0){alert("Must be a positive number.");e.value=0}reportPaymentStatus(false)}function payAmountChange(e){reportPaymentStatus(false)}function resetPendingDelayedPayment(e){var t=document.getElementById("PendingDP");if(t){var n=Number(document.getElementById("OriginalPendingDPAmount").value);document.getElementById("PendingDPAmount").value=formatAsMoney(n);document.getElementById("adj_dp_amount_up").value=formatAsMoney(n);document.getElementById("adjustment_amount_up").innerHTML=formatAsMoney(0);document.getElementById("adj_dp_amount_down").value=formatAsMoney(n);document.getElementById("adjustment_amount_down").innerHTML=formatAsMoney(0)}}function adjustPendingDelayedPayment(e){var t=document.getElementById("PendingDP");if(t){var n=Number(document.getElementById("OriginalPendingDPAmount").value);var a=n+e*1;if(a<0){e=a*-1;a=0}else{e=0}document.getElementById("PendingDPAmount").value=formatAsMoney(a);var d=getPendingDPAdjustment();if(d>0){document.getElementById("adj_dp_amount_up").value=formatAsMoney(a);document.getElementById("adjustment_amount_up").innerHTML=formatAsMoney(d)}else{document.getElementById("adj_dp_amount_down").value=formatAsMoney(a);document.getElementById("adjustment_amount_down").innerHTML=formatAsMoney(d*-1)}return e}else{return e}}function getPendingDPAdjustment(){var e=document.getElementById("PendingDP");if(e){var t=Number(document.getElementById("OriginalPendingDPAmount").value);var n=Number(document.getElementById("PendingDPAmount").value);return formatAsMoney(n-t)}else{return 0}return 0}function assignBalanceToRefTransactions(e){var t=0;var n="RT_";if(e<0){n="Cr_RT_"}for(ident in existingPaymentAmountArray){var a="RT_"+ident;t++;document.getElementById("RT_"+ident).value=""}for(ident in existingPaymentAmountArray){var a="Cr_RT_"+ident;document.getElementById("Cr_RT_"+ident).value=""}if(e==0){reportPaymentStatus(false);return}if(e>0){if(document.getElementById("use_store_credits")&&document.getElementById("use_store_credits").checked){var d=0;var o=Number($("#eoTotalStoreCredit").html());if(e>o){d=o}else{d=e}document.getElementById("store_credits_amount").value=formatAsMoney(d);e-=d}for(ident in existingPaymentAmountArray){if(e<=existingPaymentAmountArray[ident].amount){refTransField=document.getElementById(n+ident);refTransField.value=formatAsMoney(e);reportPaymentStatus(false);return}}for(ident in existingPaymentAmountArray){document.getElementById(n+ident).value=formatAsMoney(e);break}}else{for(ident in existingPaymentAmountArray){var s=existingPaymentAmountArray[ident].amount;if(existingPaymentAmountArray[ident].current_refunded_amount){s=existingPaymentAmountArray[ident].amount-existingPaymentAmountArray[ident].current_refunded_amount}if(e>=s*-1){refTransField=document.getElementById(n+ident);refTransField.value=formatAsMoney(Math.abs(e));reportPaymentStatus(false);return}}if(t>1){for(ident in existingPaymentAmountArray){var s=existingPaymentAmountArray[ident].amount;if(existingPaymentAmountArray[ident].current_refunded_amount){s=existingPaymentAmountArray[ident].amount-existingPaymentAmountArray[ident].current_refunded_amount}var r=s*-1;if(r<e){r=e}document.getElementById(n+ident).value=formatAsMoney(Math.abs(r));e-=r;if(e>=0){break}}}else if(t==1){for(ident in existingPaymentAmountArray){var s=existingPaymentAmountArray[ident].amount;if(existingPaymentAmountArray[ident].current_refunded_amount){s=existingPaymentAmountArray[ident].amount-existingPaymentAmountArray[ident].current_refunded_amount}document.getElementById(n+ident).value=formatAsMoney(s);break}}}reportPaymentStatus(false)}function storeCreditAmountChange(e){var t=Number($("#eoTotalStoreCredit").html());if(t.valueOf()<e){$("#store_credits_amount").val(t.valueOf())}payAmountChange()}function storeCreditClick(e){var t=document.getElementById("store_credits_amount");var n=Number($("#eoTotalStoreCredit").html());if(e.checked&&n>0){t.disabled=false;var a=document.getElementById("OEH_remaing_balance");if(a){balance=Number(a.innerHTML)}if(Number(t.value)>balance&&balance>0){t.value=formatAsMoney(balance)}updateChangeList()}else{t.disabled=true}calculateTotal();reportPaymentStatus(false)}function reportPaymentStatus(e){var t=document.getElementById("OEH_remaing_balance");var n=0;if(t){n=Number(t.innerHTML)}var a=Number(0);if(document.getElementById("use_store_credits")&&document.getElementById("use_store_credits").checked){a=a*1+1*formatAsMoney(document.getElementById("store_credits_amount").value)}var d=document.getElementById("payment1_type");if(!d){return}var o=d.value;var s=Number(0);switch(o){case"REFERENCE":for(ident in existingPaymentAmountArray){s+=Number(document.getElementById("RT_"+ident).value)}break;case"CC":s=Number(document.getElementById("payment1_cc_total_amount").value);break;case"CC_REFUND":var r=Number(0);for(ident in existingPaymentAmountArray){r+=Number(document.getElementById("Dir_Cr_RT_"+ident).value)}s=r*-1;break;case"CASH":s=Number(document.getElementById("payment1_cash_total_amount").value);break;case"REFUND_CASH":s=Number(document.getElementById("payment1_refund_cash_total_amount").value);s=-s;break;case"CHECK":s=Number(document.getElementById("payment1_check_total_amount").value);break;case"GIFT_CERT":s=Number(document.getElementById("payment1_gc_total_amount").value);break;case"GIFT_CARD":s=Number(document.getElementById("debit_gift_card_amount").value);break;case"CREDIT":s=Number(document.getElementById("debit_gift_card_amount").value);break}if(e){i=Number(0)}else{paySel2=document.getElementById("payment2_type").value;var i=Number(0);switch(paySel2){case"CC":i=Number(document.getElementById("payment2_cc_total_amount").value);break;case"CASH":i=Number(document.getElementById("payment2_cash_total_amount").value);break;case"CHECK":i=Number(document.getElementById("payment2_check_total_amount").value);break}}var l=document.getElementById("storeCreditRefund");if(l){returnToStoreCredit=Number(l.value*-1)}else{returnToStoreCredit=Number(0)}var u=document.getElementById("credit_to_customer_refund_cash_amount");if(u){u=Number(u.value*-1)}else{u=Number(0)}var m=Number(0);for(ident in existingPaymentAmountArray){m+=Number(document.getElementById("Cr_RT_"+ident).value)}if(isNaN(m)){m=Number(0)}else{m=Number(m*-1)}var _=Number(getPendingDPAdjustment());var a=Number(a+s+i+returnToStoreCredit+m+_+u);$("#payment_help_msg").removeClass("overpaid");if(orderState!="CANCELLED"){var c=Number(a*-1+n);if(c<0){$("#payment_help_msg").addClass("overpaid").html('Overpaid by: $<span id="bal_due">'+formatAsMoney(Math.abs(c))).show()+"</span>"}else if(c>0){$("#payment_help_msg").html('Balance Due: $<span id="bal_due">'+formatAsMoney(Math.abs(c))).show()+"</span>"}else{$("#payment_help_msg").html("").hide()}}else{var c=Number(a+n);if(c>0){$("#payment_help_msg").addClass("overpaid").html('Overpaid by: $<span id="bal_due">'+formatAsMoney(Math.abs(c))).show()+"</span>"}else if(c<0){$("#payment_help_msg").html('Balance Due: $<span id="bal_due">'+formatAsMoney(Math.abs(c))).show()+"</span>"}else{$("#payment_help_msg").html("").hide()}}updateChangeList()}function toggle(e){var t=document.getElementById(e);t.style.display=t.style.display!="none"?"none":""}var target_prefix="payment1_";var scanPosition=0;var charIndex=0;var codes=[];function keyHandler2(e){e=e?e:event;var t=e.charCode?e.charCode:e.which?e.which:e.keyCode;if(t==13){return false}codes[charIndex++]=String.fromCharCode(t);if(String.fromCharCode(t)=="%"&&scanPosition==0){scanPosition=1}else if(String.fromCharCode(t)=="B"&&scanPosition==1){scanPosition=2}else if(String.fromCharCode(t)=="?"&&scanPosition==2){scanPosition=3}else if(String.fromCharCode(t)=="?"&&scanPosition==3){scanPosition=0;charIndex=0;handleSwipeCompletion()}}function endScanHandling(){document.getElementById("scanArea").style.display="none";codes.length=0;scanPosition=0;charIndex=0;document.getElementById("hidden_text_store").value="";document.onkeypress=OMDefaultKeyHandler}function prepareForCCSwipe(e){if(e==2){target_prefix="payment2_"}else{target_prefix="payment1_"}document.onkeypress=keyHandler2;document.getElementById("scanArea").style.display="block";document.getElementById("hidden_text_store").focus();document.getElementById("hidden_text_store").value=""}function handleSwipeCompletion(){var e=codes.join("");var t=new SwipeParserObj(e);var n=t.dump();var a=/^4[0-9]{12}([0-9]{3})?$/;var d=/^5[1-5][0-9]{14}$/;var o=/^3[47][0-9]{13}$/;var s=/^6011[0-9]{12}$/;var r=false;if(a.test(t.account)){r="Visa"}else if(d.test(t.account)){r="Mastercard"}else if(o.test(t.account)){r="American Express"}else if(s.test(t.account)){r="Discover"}if(r){document.getElementById(target_prefix+"ccType").value=r}document.getElementById(target_prefix+"ccNumber").value=t.account;document.getElementById(target_prefix+"ccNameOnCard").value=t.firstname+" "+t.surname;document.getElementById(target_prefix+"ccMonth").value=t.exp_month;var i=t.exp_year;if(i.length==2){document.getElementById(target_prefix+"ccYear").value=i}else if(i.length==4){document.getElementById(target_prefix+"ccYear").value=i.substr(2)}endScanHandling()}
//# sourceMappingURL=order_mgr_payments.min.js.map
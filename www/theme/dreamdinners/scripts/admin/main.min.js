var selected_session_id,view_session,manualSearchTypeChange,manualOrderSearchTypeChange;var init_go_to_today=false;var suppress_fastlane_labels=false;function main_init(){handle_agenda_click();handle_agenda_month_select();handle_session_tools();handle_go_to_today();handle_guest_search();handle_preselection();handle_order_details_table();init_looping_timers()}function init_looping_timers(){start_dashboard_snapshot_timer();start_unix_expiry_timer()}function register_booking_click_handlers(){handle_booking_row_click();handle_booking_no_show();handle_platepoints_gifts();handle_food_testing_recipe();handle_pp_opted_out();handle_order_details_table();handle_delayed_payment_tc();handle_session_rsvp();handle_resend_delivered_to_shipstation();handle_fetch_tracking_from_shipstation()}function handle_resend_delivered_to_shipstation(){$(".handle-resend-shipstation").each(function(){$(this).on("click",function(e){e.preventDefault();var s=$(this).data("order_id");$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_shipstation_manager",op:"resend-order",order:s},success:function(e){if(e.processor_success){}else{dd_toast({message:"There was a problem sending to ShipStation."})}},error:function(e,s){}})})})}function handle_fetch_tracking_from_shipstation(){$(".handle-fetch-tracking-number").each(function(){$(this).on("click",function(e){e.preventDefault();var s=$(this).data("order_id");var t=$(this);$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_shipstation_manager",op:"fetch-tracking-number",order:s},success:function(e){if(e.processor_success){if(e.processor_tracking_number!=null&&typeof e.processor_tracking_number!="undefined"&&e.processor_tracking_number!==""&&e.processor_tracking_number!=="null"){t.html(e.processor_tracking_number)}}else{dd_toast({message:"There was a problem updating the tracking number from ShipStation."})}},error:function(e,s){}})})})}function handle_session_rsvp(){$(".add_session_rsvp_guest_create").each(function(){$(this).on("click",function(e){var t=$(this).data("session_id");$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_session_rsvp",op:"get_form_add_guest"},success:function(e){if(e.processor_success){dd_message({title:"Add RSVP",message:e.form_add_guest,height:400,width:300,div_id:"add_guest_div",closeOnEscape:false,noOk:true,open:function(e,s){$(".telephone").mask("999-999-9999");var t=$(this).dialog("option","buttons");var i=t.Accept;$(this).parent().find(".ui-dialog-titlebar-close").hide();$("#add_guest_password_login").keyup(function(e){if(e.keyCode==$.ui.keyCode.ENTER){i()}})},buttons:{Accept:function(){var s=$("#add_guest_div")[0];$("#add_guest_div").find("#error_message").html("");if(_check_form($("#form_add_guest")[0])){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_session_rsvp",op:"rsvp_dream_taste",primary_email_login:$("#add_guest_div").find("#add_guest_primary_email_login").val(),password_login:$("#add_guest_div").find("#add_guest_password_login").val(),firstname:$("#add_guest_div").find("#add_guest_firstname").val(),lastname:$("#add_guest_div").find("#add_guest_lastname").val(),telephone_1:$("#add_guest_div").find("#add_guest_telephone_1").val(),rsvp_dream_taste:t},success:function(e){if(e.processor_success){$(s).remove();handle_preselection()}else{dd_message({message:e.processor_message})}},error:function(e,s){response="Unexpected error"}})}},Cancel:function(){$(this).remove()}}})}},error:function(e,s){response="Unexpected error";handle_dashboard_update()}})})});$(".cancel_session_rsvp").each(function(){$(this).on("click",function(e){var t=$(this).data("user_id");var i=$(this).data("session_id");dd_message({title:"Confirmation",message:"Are you sure you wish to cancel this RSVP?",modal:true,confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_session_rsvp",user_id:t,session_id:i,op:"delete_rsvp"},success:function(e,s){if(e.processor_success){$("#session_rsvp-"+i+"-"+t).remove();dd_toast({message:"RSVP has been canceled."})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error"}})}})})})}function handle_session_rsvp_guest_find(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_session_rsvp",user_id:$(e).data("user_id"),session_id:$(e).data("session_id"),op:"add_rsvp"},success:function(e,s){if(e.processor_success){dd_toast({message:"RSVP has been added."});handle_preselection()}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error"}})}function handle_order_details_table(){$("[data-view_order_details]").each(function(){$(this).on("click",function(e){e.preventDefault();var s=$(this).data("booking_id");var t=$(this).data("order_id");$(".order_details_tbody").hide();$("#order_details_tbody_id_"+s).show();$("html, body").animate({scrollTop:$("#guest_details_tbody_id_"+s).offset().top-40},500);$("html, body").on("scroll mousedown DOMMouseScroll mousewheel keyup",function(e){$("html, body").stop()});$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_fadmin_home_order_details",op:"order_details",order_id:t,booking_id:s},success:function(e){if(e.processor_success){$("#order_details_table_div_id_"+e.booking_id).html(e.order_details_table);if(getQueryVariable("session")){update_page_url("main.php?page="+getQueryVariable("page")+"&session="+getQueryVariable("session")+"&order="+e.order_id)}else if(getQueryVariable("day")){update_page_url("main.php?page="+getQueryVariable("page")+"&day="+getQueryVariable("day")+"&order="+e.order_id)}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:STORE_DETAILS.id,op:"get_history",user_id:USER_DETAILS.id,order_id:t},success:function(e){$("#order_history_div_id_"+e.booking_id).html(e.html)},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})}},error:function(e,s){response="Unexpected error"}})});$(".close_order_details_table").on("click",function(e){$("#order_details_tbody_id_"+$(this).data("booking_id")).hide();if(getQueryVariable("session")){update_page_url("main.php?page="+getQueryVariable("page")+"&session="+getQueryVariable("session"))}else if(getQueryVariable("day")){update_page_url("main.php?page="+getQueryVariable("page")+"&day="+getQueryVariable("day"))}})})}function handle_platepoints_gifts(){$("[data-pp_gift_reward]").each(function(){$(this).on("click",function(e){user_id=$(this).data("user_id");level=$(this).data("level");gift_id=$(this).data("gift_id");order_sequence_number=$(this).data("order_sequence_number");order_id=$(this).data("order_id");dd_message({title:"Mark received confirmation",message:"Are you sure you wish to mark the gift as received?",modal:true,confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"plate_points_processor",user_id:user_id,op:"mark_gift_received",level:level,gift_id:gift_id,order_sequence_number:order_sequence_number},success:function(e,s){if(e.processor_success){if(level=="enrolled"){$("[data-pp_gift_reward_div="+e.user_id+"_"+gift_id+"]").remove();dd_toast({message:"The guest has received a Member level gift: "+e.giftDisplayString});var t=$("div[data-is_due*='true']").length;var i=$("div[data-is_due*='false']").length;if(t==0){$("#rewardsdueheader_"+e.user_id).hide()}if(i==0){$("#rewardsnotdueheader_"+e.user_id).hide()}if($("#received_order_based_gifts_"+order_id).length){$("#received_order_based_gifts_"+order_id).html(e.received_gifts)}}else{$("[data-pp_gift_reward_div="+e.user_id+"]").hide();dd_toast({message:"The guest has received their current level gift: "+e.giftDisplayString})}}else{dd_message({title:"Error",message:"There was a problem marking the gift as received."})}},error:function(e,s){response="Unexpected error"}})}})})})}function start_dashboard_snapshot_timer(){$.doTimeout("dashboard_snapshot_timer");$.doTimeout("dashboard_snapshot_timer",12e4,function(){handle_dashboard_update();return true})}function start_unix_expiry_timer(){$.doTimeout("unix_expiry_timer");$.doTimeout("unix_expiry_timer",6e4,function(){var e=Math.round((new Date).getTime()/1e3);$("[data-unix_expiry]").filter(function(){return $(this).data("unix_expiry")<e&&!$(this).hasClass("is_past")}).addClass("is_past");return true});$.doTimeout("unix_expiry_timer",true)}function set_selected_date(e,s,t){selected_date=e;if(s!=t){handle_dashboard_update();return true}else{return false}}function handle_dashboard_update(){if($("#dashboard_snapshot_table_div").length&&$("#dashboard_snapshot_container").is(":visible")){$.doTimeout("dashboard_processing_timer",1e3,function(){$("#dashboard_processing").show();$("#dashboard_snapshot_table").addClass("processing")});$.ajax({url:"ddproc.php",type:"POST",timeout:6e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"dashboard_details",store_id:STORE_DETAILS.id,dashboard_date:selected_date},success:function(e){if(e.processor_success){$.doTimeout("dashboard_processing_timer");$("#dashboard_snapshot_table_div").html(e.dashboard_metrics);$("#ds_title_date").html(e.dashboard_title);$("#dashboard_snapshot_table").removeClass("processing");$("#dashboard_processing").hide();help_system_init()}},error:function(e,s){response="Unexpected error"}})}}function handle_agenda_month_select(){$("#month_selector").on("change",function(e){selected_agenda_month=$("#month_selector").val();selected_agenda_month_id=$("#month_selector").find(":selected").data("menu_id");doasync=true;if(init_go_to_today){doasync=false}$.ajax({url:"ddproc.php",type:"POST",async:doasync,timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"agenda_details",store_id:STORE_DETAILS.id,agenda_date:selected_agenda_month,agenda_month_id:selected_agenda_month_id},success:function(e){if(e.processor_success){$("#session_selector").html(e.session_info);handle_agenda_click();if(!init_go_to_today){$("#day_"+e.date).scrollToTarget($("#session_selector"))}}},error:function(e,s){response="Unexpected error"}})})}function handle_delayed_payment_tc(){$("[data-delayed_payment_tc]").on("click",function(e){var s=$(this).data("delayed_payment_tc");dd_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment,modal:true,noOk:true,buttons:{Agree:function(){$(this).remove();$('[data-delayed_payment_tc="'+s+'"]').hide();set_user_pref("TC_DELAYED_PAYMENT_AGREE",1,s)},Decline:function(){dd_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment_decline});set_user_pref("TC_DELAYED_PAYMENT_AGREE",0,s)}}})})}function handle_agenda_click(){$("#session_selection li").each(function(){$(this).on("click",function(e){if(typeof window.booking_query!="undefined"){window.booking_query.abort()}$(".selected").removeClass("selected");$(this).addClass("selected");$.doTimeout("booked_guests_table_timer");$.doTimeout("booked_guests_table_timer",1e3,function(){$("#booked_guests_table").html('<img src="'+PATH.image_admin+'/style/throbber_circle.gif" class="img_valign img_throbber_circle" data-tooltip="Processing" alt="Processing" style="display: inline;" /> Loading...')});if($(this).data("session_id")){view_session=true;selected_session_id=$(this).data("session_id");window.booking_query=$.ajax({url:"ddproc.php",type:"POST",timeout:12e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"session_details",store_id:STORE_DETAILS.id,session_id:selected_session_id},success:function(e){if(e.processor_success){var s=false;if(!getQueryVariable("day")){s=getQueryVariable("order")}$.doTimeout("booked_guests_table_timer");update_page_url("main.php?page="+getQueryVariable("page")+"&session="+e.session_info.id);var t=selected_menu_id;selected_menu_id=e.session_info.menu_id;set_selected_date(e.session_info.session_start_dtf_ymd,t,selected_menu_id);update_session_tool_links();$("#selected_day").html(e.session_info.session_start_dtf_verbose_date);$("#selected_date_link").attention();$("#selected_session").html(" - "+e.session_info.session_start_dtf_time_only);$("#selected_session").show();$("#day_details_container").hide();$("#session_details_table_div").html(e.session_details);$("#sd_edit_session").show();$("#sd_session_meta").show();var i=e.session_info.session_publish_state=="PUBLISHED"?"Close Session":"Open Session";$("#sd_publish_state").data("session_publish_state",e.session_info.session_publish_state).html(i);if(e.session_data.session_type==="DELIVERED"){$("#session-"+selected_session_id+" > span.shipped").html(e.session_info.shipping_bookings_count);$("#session-"+selected_session_id+" > span.attending").html(e.session_info.delivered_bookings_count);$("#session-"+selected_session_id+" > span.remaining").html(e.session_info.remaining_slots)}else if(e.session_data.session_type_subtype==="WALK_IN"){$("#sd_edit_session").hide();$("#sd_session_meta").hide()}else{if(typeof e.session_info.additional_orders!==undefined&&e.session_info.additional_orders!=null&&e.session_info.additional_orders>0){$("#session-"+selected_session_id+" > span.attending").html(e.session_info.booked_count*1+e.session_info.num_rsvps*1+"/"+e.session_info.additional_orders)}else{$("#session-"+selected_session_id+" > span.attending").html(e.session_info.booked_count*1+e.session_info.num_rsvps*1)}$("#session-"+selected_session_id+" > span.remaining").html(e.session_info.remaining_slots+"/"+(e.session_info.remaining_intro_slots>0?e.session_info.remaining_intro_slots:0))}if(e.session_info.session_publish_state=="PUBLISHED"){$("#session-"+selected_session_id+" > span.time").removeClass("closed")}else{$("#session-"+selected_session_id+" > span.time").addClass("closed")}$("#session_details_container").show();$("#booked_guests_table").html(e.booking_details);register_booking_click_handlers();if(s){$('[data-view_order_details][data-order_id="'+s+'"]').trigger("click")}$("#sd_invitation_pdf").on("click",function(e){bounce("main.php?page=print&dream_taste_event_pdf="+selected_session_id,"_blank")});$("#sd_fundraiser_invitation_pdf").on("click",function(e){bounce("main.php?page=print&fundraiser_event_pdf="+selected_session_id,"_blank")});$("#sd_pick_up_event_invitation_pdf").on("click",function(e){bounce("main.php?page=print&remote_pickup_private_event_pdf="+selected_session_id,"_blank")});$("#sd_resend_hostess_email").on("click",function(e){resend_dream_taste_notification()})}},error:function(e,s){if(s!="abort"){dd_message({title:"Error",message:"An unexpected error has occurred, error message: "+s+". If you continue to experience this issue please contact support."})}}})}else{view_session=false;var i=$(this).data("menu_id");var a=$(this).data("date");window.booking_query=$.ajax({url:"ddproc.php",type:"POST",timeout:12e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"date_details",store_id:STORE_DETAILS.id,date:a},success:function(e){if(e.processor_success){var s=false;if(!getQueryVariable("session")){s=getQueryVariable("order")}var t=selected_menu_id;selected_menu_id=i;set_selected_date(a,t,selected_menu_id);$.doTimeout("booked_guests_table_timer");update_page_url("main.php?page="+getQueryVariable("page")+"&day="+selected_date);update_session_tool_links();$("#selected_day").html(e.date_info.date_dtf_verbose_date);$("#selected_date_link").attention();$("#session_details_container, #selected_session").hide();if(e.booking_details.length){$("#booked_guests_table").html(e.booking_details);$("#day_details_table_div").html(e.date_details)}else{$("#booked_guests_table").html('<div class="no_day_sessions">No sessions for this day.</div>');$("#day_details_table_div").html('<div class="no_day_sessions">No sessions for this day.</div>')}$("#day_details_container").show();register_booking_click_handlers();if(s){$('[data-view_order_details][data-order_id="'+s+'"]').trigger("click")}$('[id^="gd_title-"]').on("click",function(e){$("#session-"+$(this).data("session_id")).scrollToTarget($("#session_selector"));$.scrollTo($("body"),100)}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}},error:function(e,s){if(s!="abort"){dd_message({title:"Error",message:"An unexpected error has occurred, error message: "+s+". If you continue to experience this issue please contact support."})}}})}})})}function update_page_url(e){historyPush({url:e});$("#selected_date_link").prop("href",e)}function handle_pp_opted_out(){$(".pp_opted_out").each(function(){$(this).on("click",function(e){e.preventDefault();var s=$(this).prop("href");dd_message({title:"Guest has opted out",message:"The guest has previously opted out, are you sure you wish to continue?",modal:true,confirm:function(){bounce(s)}})})})}function resend_dream_taste_notification(){dd_message({title:"Send notice confirmation",message:"Are you sure you wish to resend the host email notification?",modal:true,confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"resend_dream_taste_email",store_id:STORE_DETAILS.id,session_id:selected_session_id},success:function(e){if(e.processor_success){dd_message({title:"Send notice confirmation",message:"Email notification has been resent to the session host."})}},error:function(e,s){response="Unexpected error"}})}})}function handle_booking_no_show(){$('[id^="gd_noshow-"]').each(function(e){$(this).on("click",function(e){var s=this.checked?"yes":"no";$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_no_show_state",bid:$(this).data("booking_id"),store_id:STORE_DETAILS.id,state:s},success:function(e){if(e.processor_success){}},error:function(e,s){response="Unexpected error"}})})})}function handle_food_testing_recipe(){$('[id^="food_testing-"]').each(function(e){$(this).on("change",function(e){var s=$(this);var t=$(this).data("user_id");var i=$(this).data("session_id");var a=$(this).data("menu_id");var o=$("option:selected",$(this)).text();var _=$(this).val().split("-")[0];var r=$(this).val().split("-")[1];if($(this).val()=="0"){return}dd_message({title:"Confirm",message:'Are you sure you wish to assign <span style="font-weight: bold;">'+o+'</span> to this guest? The testing item is <span style="font-weight: bold;">not</span> editable once assigend and the guest will immediately receive an email upon confirmation which will include testing instructions.',noOk:true,modal:true,buttons:{Confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"assign_test_recipe",user_id:t,session_id:i,menu_id:a,survey_id:_,survey_size:r},success:function(e){if(e.processor_success){$('[data-food_testing_select_user_id="'+e.user_id+'"]').text(o)}},error:function(e,s){response="Unexpected error"}});$(this).remove()},Cancel:function(){$(this).remove();$(s).val(0)}}})})})}function handle_guest_account_notes(){$('[id^="gd_guest_account_note_button-"]').each(function(){$(this).on("click",function(e){booking_id=$(this).data("booking_id");user_id=$(this).data("user_id");do_op="get";guest_note="";if($(this).data("edit_mode")==true){do_op="save";guest_note=$("#gd_guest_account_note-"+booking_id+" > textarea").val()}if(do_op=="get"){get_user_pref("USER_ACCOUNT_NOTE",user_id,function(e){var s=$("<textarea></textarea>").addClass("form-control").val(e.guest_preferences[user_id]["USER_ACCOUNT_NOTE"].value?e.guest_preferences[user_id]["USER_ACCOUNT_NOTE"].value:"").on("keyup",function(e){if($(this).val()!=strip_tags($(this).val())){$(this).val(strip_tags($(this).val()))}});$("#gd_guest_account_note-"+booking_id).addClass("guest_note_edit").html(s);$("#gd_guest_account_note_button-"+booking_id).data("edit_mode",true).html("Save Note");$("#gd_guest_account_note_cancel_button-"+booking_id).show();$("#gd_guest_account_note_cancel_button-"+booking_id).data("user_data_value",e.guest_preferences[user_id]["USER_ACCOUNT_NOTE"].value?e.guest_preferences[user_id]["USER_ACCOUNT_NOTE"].value:"").on("click",function(e){$("#gd_guest_account_note-"+$(this).data("booking_id")).removeClass("guest_note_edit").html($(this).data("user_data_value"));$("#gd_guest_account_note_button-"+$(this).data("booking_id")).data("edit_mode",false).html("Account Notes");$(this).hide()})})}else{dd_message({title:"Confirm",message:"This note is viewable and editable by the guest in their preferences. Are you sure you wish to modify the guest's account note?",noOk:true,modal:true,buttons:{Confirm:function(){$(this).remove();set_user_pref("USER_ACCOUNT_NOTE",guest_note,user_id);$("#gd_guest_account_note-"+booking_id).removeClass("guest_note_edit").html(nl2br(guest_note));$("#gd_guest_account_note_cancel_button-"+booking_id).hide();$("#gd_guest_account_note_button-"+booking_id).data("edit_mode",false).html("Account Notes")},Cancel:function(){$(this).remove()}}})}})})}function handle_admin_carryover_notes(){$('[id^="gd_show_guest_note-"]').each(function(){$(this).on("click",function(e){var s=$(this).data("booking_id");var t=this;$(t).hide();$("#gd_guest_note-"+s).show();$.doTimeout("show_guest_note_timer-"+s,1e4,function(){$(t).show();$("#gd_guest_note-"+s).hide()})})});$('[id^="gd_guest_note_button-"]').each(function(){$(this).on("click",function(e){hide_carryover_notes=$(this).data("hide_carryover_notes");booking_id=$(this).data("booking_id");user_id=$(this).data("user_id");do_op="get";guest_note="";if($(this).data("edit_mode")==true){do_op="save";guest_note=$("#gd_guest_note-"+booking_id+" > textarea").val()}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"guest_carryover_note",do:do_op,store_id:STORE_DETAILS.id,user_id:user_id,note:guest_note},success:function(e){if(e.processor_success){if(do_op=="get"){$.doTimeout("show_guest_note_timer-"+booking_id);$("#gd_guest_note-"+booking_id).show();$("#gd_show_guest_note-"+booking_id).hide();$("#gd_guest_note-"+booking_id).addClass("guest_note_edit").html('<textarea class="form-control">'+(e.guest_note.user_data_value?e.guest_note.user_data_value:"")+"</textarea>");$("#gd_guest_note_button-"+booking_id).data("edit_mode",true).html("Save Note");$("#gd_guest_note_cancel_button-"+booking_id).data("user_data_value",e.guest_note.user_data_value?e.guest_note.user_data_value:"").on("click",function(e){if($(this).data("hide_carryover_notes")===1){$("#gd_guest_note-"+booking_id).hide();$("#gd_show_guest_note-"+booking_id).show()}$("#gd_guest_note-"+$(this).data("booking_id")).removeClass("guest_note_edit").html($(this).data("user_data_value"));$("#gd_guest_note_button-"+$(this).data("booking_id")).data("edit_mode",false).html("Admin Carryover");$(this).hide()}).show()}else{if(hide_carryover_notes===1&&e.guest_note.user_data_value){$("#gd_guest_note-"+booking_id).hide();$("#gd_show_guest_note-"+booking_id).show()}$("#gd_guest_note-"+booking_id).removeClass("guest_note_edit").html(nl2br(e.guest_note.user_data_value));$("#gd_guest_note_cancel_button-"+booking_id).hide();$("#gd_guest_note_button-"+booking_id).data("edit_mode",false).html("Admin Carryover")}}},error:function(e,s){response="Unexpected error"}})})})}function handle_admin_order_notes(){$('[id^="gd_admin_note_button-"]').each(function(){$(this).on("click",function(e){let s=$(this).data("uid");if(typeof s=="undefined"||s==null||s==""){s=""}else{s+="-"}let t=$(this).data("button_name");if(typeof t=="undefined"||t==null||t==""){t="Admin Order Note"}booking_id=$(this).data("booking_id");order_id=$(this).data("order_id");user_id=$(this).data("user_id");do_op="get";admin_note="";if($(this).data("edit_mode")==true){do_op="save";admin_note=$("#gd_admin_note-"+s+booking_id+" > textarea").val()}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"order_admin_note",do:do_op,order_id:order_id,note:admin_note},success:function(e){if(e.processor_success){if(do_op=="get"){$("#gd_admin_note-"+s+booking_id).addClass("admin_note_edit").html('<textarea class="form-control">'+(e.admin_note?e.admin_note:"")+"</textarea>");$("#gd_admin_note_button-"+s+booking_id).data("edit_mode",true).html("Save Note");$("#gd_admin_note_cancel_button-"+s+booking_id).data("admin_note_value",e.admin_note?e.admin_note:"").on("click",function(e){$("#gd_admin_note-"+s+$(this).data("booking_id")).removeClass("admin_note_edit").html($(this).data("admin_note_value"));$("#gd_admin_note_button-"+s+$(this).data("booking_id")).data("edit_mode",false).html(t);$(this).hide()}).show()}else{$("#gd_admin_note-"+s+booking_id).removeClass("admin_note_edit").html(nl2br(e.admin_note));$(".multi-populate-admin-note").each(function(){$(this).html(nl2br(e.admin_note))});$("#gd_admin_note_cancel_button-"+s+booking_id).hide();$("#gd_admin_note_button-"+s+booking_id).data("edit_mode",false).html(t)}}},error:function(e,s){response="Unexpected error"}})})})}function handle_reschedule_button(){$('[id^="gd_reschedule-"]').each(function(){$(this).css({cursor:"pointer"}).on("click",function(e){create_and_submit_form({method:"post",action:"main.php?page=admin_reschedule",input:{session_id:$(this).data("session_id"),original_session_id:$(this).data("session_id"),store_id:$(this).data("store_id"),menus:$(this).data("menu_id"),menu_id:$(this).data("menu_id"),order_id:$(this).data("order_id"),back_address:back_path()}})})})}function handle_booking_row_click(){handle_guest_account_notes();handle_admin_carryover_notes();handle_admin_order_notes();handle_reschedule_button();$("#booked_guests_table tbody.guest").each(function(){$(this).on("click",function(e){if($(this).hasClass("select_guest")){$(".select_guest").removeClass("select_guest")}else{$(".select_guest").removeClass("select_guest");$("#guest_details_tbody_id_"+$(this).data("booking_id")).addClass("select_guest");$("#order_details_tbody_id_"+$(this).data("booking_id")).addClass("select_guest")}$('[id^="gd_guest_menu-"]').hide();$("#gd_guest_menu-"+$(this).data("user_id")).show()})});$('[id^="gd_guest-"]').each(function(){var e=$(this).data("booking_id");$("#gd_guest-"+e+", #gd_guest_menu-"+e).hover(function(){$.doTimeout("guest_menu_timer_hide-"+e);$.doTimeout("guest_menu_timer_show-"+e,100,function(){$("#gd_guest_menu-"+e).show()})},function(){$.doTimeout("guest_menu_timer_show-"+e);$.doTimeout("guest_menu_timer_hide-"+e,150,function(){$("#gd_guest_menu-"+e).hide()})})});handle_cancel_order();handle_cancel_order_delivered();handle_delete_saved_order()}function handle_delete_saved_order_delivered(){$('[id^="gd_delete_delivered_order-"]').each(function(){$(this).on("click",function(e){var s=$(this).data("session_id");var t=$(this).data("order_id");var i=$(this).data("store_id");var a=$(this).data("user_id");var o=$(this).data("bounce");dd_message({title:"Confirm Delete Saved Order",message:"Are you sure you want to delete this saved order?",confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",store_id:i,op:"delete_saved_order",session_id:s,user_id:a,order_id:t},success:function(e){if(e.processor_success){if(typeof o=="undefined"||o==""){o=window.location.href}bounce(o)}else{if(e.doRefresh==true){dd_message({title:"Problem Deleting Saved Order",message:e.processor_message,modal:true,noOk:true,closeOnEscape:false,buttons:{Refresh:function(){$(this).remove();bounce(window.location.href)}}})}else{dd_message({title:"Error",message:e.processor_message})}}},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})}})})})}function handle_delete_saved_order(){$('[id^="gd_delete_order-"]').each(function(){$(this).on("click",function(e){var s=$(this).data("session_id");var t=$(this).data("order_id");var i=$(this).data("store_id");var a=$(this).data("user_id");var o=$(this).data("bounce");dd_message({title:"Confirm Delete Saved Order",message:"Are you sure you want to delete this saved order?",confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:i,op:"delete_saved_order",session_id:s,user_id:a,order_id:t},success:function(e){if(e.processor_success){if(typeof o=="undefined"||o==""){o=window.location.href}bounce(o)}else{if(e.doRefresh==true){dd_message({title:"Problem Deleting Saved Order",message:e.processor_message,modal:true,noOk:true,closeOnEscape:false,buttons:{Refresh:function(){$(this).remove();bounce(window.location.href)}}})}else{dd_message({title:"Error",message:e.processor_message})}}},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})}})})})}function validateKey(e){e=e?e:event?event:null;if(e){var s=e.charCode||e.charCode==0?e.charCode:e.keyCode?e.keyCode:e.which;if(s>13&&(s<48||s>57)){if(s==46){return true}if(e.returnValue){e.returnValue=false}else if(e.preventDefault){e.preventDefault()}else{return false}}}}function validateAmount(e,s){if(isNaN(e.value)){e.value=0}if(e.value>s){e.value=s}}function handle_cancel_order(){$('[id^="gd_cancel_order-"]').each(function(){$(this).on("click",function(e){var s=$(this).data("booking_id");var n=$(this).data("session_id");var d=$(this).data("order_id");var c=$(this).data("store_id");var l=$(this).data("user_id");var p=$(this).data("bounce");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",op:"cancel_preflight",store_id:c,session_id:n,user_id:l,order_id:d},success:function(e,s){if(e.processor_success&&e.data){dd_message({title:"Cancel Order?",message:e.data,width:700,height:480,modal:true,open:function(){$("#order_admin_notes_cancel").on("keyup",function(e){if($(this).val()!=strip_tags($(this).val())){$(this).val(strip_tags($(this).val()))}})},canConfirm:function(){var e=$("#cancellation_reason").val();if(e==""){dd_message({title:"Error",div_id:"Uneek262020",message:"Please select a reason for cancelling"});return false}else{return true}},confirm:function(e,s){var t={};$("#cancel_parent :input").each(function(){t[this.id]=$(this).val()});var i=$("#order_admin_notes_cancel").val().trim();var a=$("#cancellation_reason").val();var o=$("#declined_MFY").is(":checked");var _=$("#declined_to_reschedule").is(":checked");var r=$("#suppress_cancel_email").is(":checked");dd_message({title:"Cancelling order",message:'<img src="'+PATH.image_admin+'/style/throbber_circle.gif" class="img_valign" alt="Processing" /> Processing order cancellation...',div_id:"cancel_order",modal:true,noOk:true,closeOnEscape:false,open:function(e,s){$(this).parent().find(".ui-dialog-titlebar-close").hide()}});$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",op:"cancel",store_id:c,session_id:n,user_id:l,order_id:d,paymentList:t,order_notes:i,reason:a,declined_MFY:o,declined_Reschedule:_,suppress_cancel_email:r},success:function(e){if(e.processor_success){dd_message({title:"Order was Canceled",message:e.data,div_id:"cancel_order",closeOnEscape:false,modal:true,noOk:true,open:function(e,s){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{OK:function(){if(typeof p!="undefined"){bounce(p)}else{bounce(removeQueryVariable("order",window.location.href))}}}})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})}})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})})})}function handle_cancel_order_delivered(){$('[id^="gd_cancel_delivered_order-"]').each(function(){$(this).on("click",function(e){var n=$(this).data("session_id");var d=$(this).data("order_id");var c=$(this).data("store_id");var l=$(this).data("user_id");var p=$(this).data("bounce");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"cancel_preflight",store_id:c,session_id:n,user_id:l,order_id:d},success:function(e,s){if(e.processor_success&&e.data){dd_message({title:"Cancel Order?",message:e.data,width:700,height:480,modal:true,open:function(){$("#order_admin_notes_cancel").on("keyup",function(e){if($(this).val()!=strip_tags($(this).val())){$(this).val(strip_tags($(this).val()))}})},canConfirm:function(){var e=$("#cancellation_reason").val();if(e==""){dd_message({title:"Error",div_id:"Uneek262020",message:"Please select a reason for cancelling"});return false}else{return true}},confirm:function(e,s){var t={};$("#cancel_parent :input").each(function(){t[this.id]=$(this).val()});var i=$("#order_admin_notes_cancel").val().trim();var a=$("#cancellation_reason").val();var o=$("#declined_MFY").is(":checked");var _=$("#declined_to_reschedule").is(":checked");var r=$("#suppress_reschedule_email").is(":checked");dd_message({title:"Cancelling order",message:'<img src="'+PATH.image_admin+'/style/throbber_circle.gif" class="img_valign" alt="Processing" /> Processing order cancellation...',div_id:"cancel_order",modal:true,noOk:true,closeOnEscape:false,open:function(e,s){$(this).parent().find(".ui-dialog-titlebar-close").hide()}});$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor_delivered",op:"cancel",store_id:c,session_id:n,user_id:l,order_id:d,paymentList:t,order_notes:i,reason:a,declined_MFY:o,declined_Reschedule:_,suppress_email:r},success:function(e){if(e.processor_success){dd_message({title:"Order was Canceled",message:e.data,div_id:"cancel_order",closeOnEscape:false,modal:true,noOk:true,open:function(e,s){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{OK:function(){if(typeof p!="undefined"){bounce(p)}else{bounce(removeQueryVariable("order",window.location.href))}}}})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})}})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error: "+s;dd_message({title:"Error",message:response})}})})})}function handle_session_tools(){if($.totalStorage("suppress_fastlane_labels")!=null){suppress_fastlane_labels=$.totalStorage("suppress_fastlane_labels");$("#suppress_fastlane_labels").prop("checked",!suppress_fastlane_labels)}$("#suppress_fastlane_labels").on("click",function(e){if($(this).is(":checked")){$.totalStorage("suppress_fastlane_labels",false);suppress_fastlane_labels=false}else{$.totalStorage("suppress_fastlane_labels",true);suppress_fastlane_labels=true}update_session_tool_links()});$("#ds_goal_tracking").on("click",function(e){bounce("main.php?page=admin_reports_goal_management_v2&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path())});$("#ds_trending").on("click",function(e){bounce("main.php?page=admin_reports_trending_menu_based&date="+selected_date+"&store="+STORE_DETAILS.id+"&back="+back_path())});$("#ds_dashboard").on("click",function(e){bounce("main.php?page=admin_dashboard_menu_based&override_month="+selected_date+"&store="+STORE_DETAILS.id+"&back="+back_path())});$("#sd_edit_session").on("click",function(e){if(view_session==true){bounce("main.php?page=admin_edit_session&session="+selected_session_id+"&back="+back_path())}});$("#sd_email_session").on("click",function(e){if(view_session==true){bounce("main.php?page=admin_email&session="+selected_session_id+"&back="+back_path())}});$("#sd_publish_state").on("click",function(e){if(view_session==true){state=$(this).data("session_publish_state");if(state=="PUBLISHED"){new_state="Close"}else{new_state="Open"}dd_message({title:new_state+" session confirmation",message:'Are you sure you wish to <span style="font-weight: bold;">'+new_state+"</span> this session?",modal:true,confirm:function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_fadmin_home",op:"session_publish_state",session_id:selected_session_id,open_close_submit:new_state},success:function(e){if(e.processor_success){$("#session-"+selected_session_id).scrollToTarget($("#session_selector"))}},error:function(e,s){response="Unexpected error"}})}})}});$("#sd_session_meta").on("click",function(e){$(".session_meta").toggle();$("#session_details_text").toggleClass("session_details_text")});$("#dd_create_session").on("click",function(e){if(view_session!=true){bounce("main.php?page=admin_create_session&date="+selected_date+"&menu="+selected_menu_id+"&back="+back_path())}})}function update_session_tool_links(){if(view_session==true){$("#st_customer_receipt").prop("href","main.php?page=admin_order_details_view_all&customer_print_view=1&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_franchise_receipt").prop("href","main.php?page=admin_order_details_view_all&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_entree_summary").prop("href","main.php?page=admin_reports_select_multi_session&query_submit=1&report_id=2&printer=1&pickSession=2&session_id="+selected_session_id+"&back="+back_path()).prop("target","_blank");$("#st_side_dish_report").prop("href","main.php?page=admin_order_details_view_all&issidedish=1&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_fast_lane_report").prop("href","main.php?page=admin_order_details_view_all&ispreassembled=1&session_id="+selected_session_id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_dream_rewards").prop("href","main.php?page=admin_reports_dream_rewards_for_session&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_future_orders").prop("href","main.php?page=admin_order_details_view_all_future&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_session_goal_sheet_print").prop("href","main.php?page=admin_reports_goal_tracking&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&report_submit=true&print=true&back="+back_path()).prop("target","_blank");$("#st_session_goal_sheet_xls").prop("href","main.php?page=admin_reports_goal_tracking&export=xlsx&hideheaders=true&csvfilename=SessionGoalSheet&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&report_submit=true&back="+back_path());$("#st_print_labels").prop("href","main.php?page=admin_reports_customer_menu_item_labels&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank");$("#st_print_labels_w_breaks").prop("href","main.php?page=admin_reports_customer_menu_item_labels&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&break=1&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank");$("#st_print_labels_by_dinner").prop("href","main.php?page=admin_reports_customer_menu_item_labels&session_id="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&order_by=dinner&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank");$("#st_print_enrollment_forms").prop("href","main.php?page=admin_user_plate_points&session_id="+selected_session_id+"&print_sessions_forms=true").prop("target","_blank");$("#st_plate_points_status_and_rewards_report").prop("href","main.php?page=admin_reports_points_status_and_rewards&session_id="+selected_session_id+"&back="+back_path());$("#st_customer_menu_core").prop("href","main.php?page=admin_session_tools_printing&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_core_current").prop("href","main.php?page=admin_session_tools_printing&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&cur=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_freezer").prop("href","main.php?page=admin_session_tools_printing&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&freezer=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_nutrition").prop("href","main.php?page=admin_session_tools_printing&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&nutrition=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_core_freezer").prop("href","main.php?page=admin_session_tools_printing&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_core_freezer_nutrition").prop("href","main.php?page=admin_session_tools_printing&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&nutrition=true&back="+back_path()).prop("target","_blank");$("#st_daily_boxes_shipped").prop("href","main.php?page=admin_reports_delivered_daily_boxes&type=shipping&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_daily_boxes_delivered").prop("href","main.php?page=admin_reports_delivered_daily_boxes&type=delivering&do=print&session="+selected_session_id+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank")}else{$("#st_customer_receipt").prop("href","main.php?page=admin_order_details_view_all_multi&customer_print_view=1&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_franchise_receipt").prop("href","main.php?page=admin_order_details_view_all_multi&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_entree_summary").prop("href","main.php?page=admin_reports_select_multi_session&query_submit=1&report_date="+selected_date+"&report_id=1&printer=1&back="+back_path()).prop("target","_blank");$("#st_side_dish_report").prop("href","main.php?page=admin_order_details_view_all_multi&issidedish=1&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_fast_lane_report").prop("href","main.php?page=admin_order_details_view_all_multi&ispreassembled=1&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_dream_rewards").prop("href","main.php?page=admin_reports_dream_rewards_for_session_multi&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_future_orders").prop("href","main.php?page=admin_order_details_view_all_future_multi&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_session_goal_sheet_print").prop("href","main.php?page=admin_reports_goal_tracking&multi_session="+selected_date+"&store_id="+STORE_DETAILS.id+"&report_submit=true&print=true&back="+back_path()).prop("target","_blank");$("#st_session_goal_sheet_xls").prop("href","main.php?page=admin_reports_goal_tracking&export=xlsx&hideheaders=true&csvfilename=SessionGoalSheetSummary&multi_session="+selected_date+"&store_id="+STORE_DETAILS.id+"&report_submit=true&back="+back_path());$("#st_print_labels").prop("href","main.php?page=admin_reports_customer_menu_item_labels_multi&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank");$("#st_print_labels_w_breaks").prop("href","main.php?page=admin_reports_customer_menu_item_labels_multi&labels_per_sheet=4&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&back="+back_path()+"&break=1&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank");$("#st_print_labels_by_dinner").prop("href","main.php?page=admin_reports_customer_menu_item_labels_multi&labels_per_sheet=4&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&menuid="+selected_menu_id+"&order_by=dinner&back="+back_path()+"&suppressFastlane="+suppress_fastlane_labels).prop("target","_blank");$("#st_print_enrollment_forms").prop("href","main.php?page=admin_user_plate_points&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&print_days_forms=true").prop("target","_blank");$("#st_plate_points_status_and_rewards_report").prop("href","main.php?page=admin_reports_points_status_and_rewards&report_date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path());$("#st_customer_menu_core").prop("href","main.php?page=admin_session_tools_printing&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_core_current").prop("href","main.php?page=admin_session_tools_printing&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&cur=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_freezer").prop("href","main.php?page=admin_session_tools_printing&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&freezer=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_nutrition").prop("href","main.php?page=admin_session_tools_printing&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&nutrition=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_core_freezer").prop("href","main.php?page=admin_session_tools_printing&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&back="+back_path()).prop("target","_blank");$("#st_customer_menu_core_freezer_nutrition").prop("href","main.php?page=admin_session_tools_printing&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&core=true&freezer=true&nutrition=true&back="+back_path()).prop("target","_blank");$("#st_daily_boxes_shipped").prop("href","main.php?page=admin_reports_delivered_daily_boxes&type=shipping&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank");$("#st_daily_boxes_delivered").prop("href","main.php?page=admin_reports_delivered_daily_boxes&type=delivering&do=print&date="+selected_date+"&store_id="+STORE_DETAILS.id+"&back="+back_path()).prop("target","_blank")}$("#st_finishing_touch_pick_sheet").prop("href","main.php?page=admin_finishing_touch_printable_form&store_id="+STORE_DETAILS.id+"&menu_id="+selected_menu_id+"&back="+back_path()).prop("target","_blank");$("#st_print_generic_labels").prop("href","main.php?page=admin_reports_customer_menu_item_labels&store_id="+STORE_DETAILS.id+"&interface=1&menuid="+selected_menu_id+"&back="+back_path()).prop("target","_blank")}function handle_guest_search(){$(document).on("click","#gs_search_go",function(e){create_and_submit_form({method:"get",action:"main.php",input:{page:"admin_list_users",search_type:$("#gs_search_type").val(),all_stores:$("#gs_search_all").is(":checked")?1:0,q:$("#gs_search_value").val(),back:back_path()}})});$(document).on("change","#gs_search_type",function(e){manualSearchTypeChange=true;$("#gs_search_value").unmask();if($("#gs_search_type").val()=="phone"){$("#gs_search_value").mask("999-999-9999")}});$(document).on("keyup","#gs_search_value",function(e){if(e.which==13){$("#gs_search_go").trigger("click")}detect_guest_search_type()})}function detect_order_search_type(){if(manualOrderSearchTypeChange==true){return}var e=$("#os_search_value").val();if(!$.isNumeric(e)){$("#os_search_type").val("confirmation")}if($.isNumeric(e)){$("#os_search_type").val("id")}}function detect_guest_search_type(){if(manualSearchTypeChange==true){return}var e=$("#gs_search_value").val();if(!$.isNumeric(e)){$("#gs_search_type").val("lastname")}if($.isNumeric(e)){$("#gs_search_type").val("id")}if(e.indexOf("@")!=-1){$("#gs_search_type").val("email")}if(e.indexOf(" ")!=-1){$("#gs_search_type").val("firstlast")}}function handle_go_to_today(){$("#go_to_today").on("click",function(e){go_to_today()})}function go_to_today(){init_go_to_today=true;date_select=get_todays_date().slice(0,-3);if(selected_agenda_month!=undefined&&selected_agenda_month!=date_select){let e=$("#month_selector option[data-menu_month='"+date_select+"']").val();$("#month_selector").val(e).trigger("change")}$(".selected").removeClass("selected");var e=get_todays_date();$("#day_"+e).scrollToTarget($("#session_selector")).addClass("selected");init_go_to_today=false}function handle_preselection(){if(getQueryVariable("session")&&$("#session-"+getQueryVariable("session")).length){$("#session-"+getQueryVariable("session")).scrollToTarget($("#session_selector"))}else if(getQueryVariable("day")&&$("#day_"+getQueryVariable("day")).length){$("#day_"+getQueryVariable("day")).scrollToTarget($("#session_selector"))}else{go_to_today()}}function confirm_order_attended(s,t){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"plate_points_processor",user_id:s,op:"confirm_order",order_id:t},success:function(e){if(e.processor_success){$("[id^=pp_co_"+s+"_"+t+"]").html(e.points_this_order);if(e.total_credit){$("[id^=pp_credit_"+s+"_"+t+"]").text("$"+e.total_credit)}}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,s){response="Unexpected error: "+s}})}(function(r){r.fn.scrollToTarget=function(e,s){var t=r(this);if(t.length){var i=r(e).position().top;var a=i+r(e).height();var o=r(t).position().top;var _=o+r(t).height();if(o>i&&_<a||o<i&&_>a){t.trigger("click")}else{e.scrollTo(this,800,{offset:-25,easing:"easeOutBack",onAfter:function(){t.trigger("click")}})}}return t}})(jQuery);$(document).on("click keyup","#os_search_go, #os_search_value",function(e){let s=$(this).attr("id");if(s=="os_search_value"){if(e.which!=13){return}}let t=$.trim($("#os_search_value").val());if(!t.match(/^[0-9a-z]+$/i)){bootbox.alert("Invalid character in order ID.");return}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_helpers",op:"order_search",order_identifier:t},success:function(e){if(e.processor_success){bounce(e.bounce_to)}else{bootbox.alert(e.processor_message)}},error:function(e,s){response="Unexpected error: "+s}})});
//# sourceMappingURL=main.min.js.map
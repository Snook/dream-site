function CCodeThatGrid(e,t,r,i,a,l){var o=this,n,s;o.widthValue=i;o.heightValue=a;o.helptips=l;t=parseInt(t);r=parseInt(r);o.def={datatype:0,data:[]};o.name=e;o.showStatusBar=0;CodeThatGrids[e]=o;o.rows=[];o.cols=[];o.cells=[];o.rowCount=isNaN(t)||t<=0?20:t;o.colCount=isNaN(r)||r<=0?5:r;o.rIdx=[];o.vr=[];o.cIdx=[];o.sortCol=-1;o.sortType=1;o.multiSortCol=[];o.multiSortType=[];o.useMultiSort=1;o.searchValue="";o.clip="";o.msg="";o.useProgress=1;o.winProgress=null;o.useRCID=1;o.showCols=0;o.useExportBar=0;o.useColTitle=0;o.curCell=null;o.amountPerPage=20;o.pageCount=1;o.page=1;o.isInit=0;o.markType=0;o.markRange=[];o.userFunction=null;o.tableStyle={tableClass:{borderwidth:1,borderstyle:"solid",bordercolor:"#D4D0C8"},thClass:dfp,tdClass:dfp,bgcolor:"#ffffff",x:10,y:10,width:o.widthValue,height:o.heightValue,position:0,overflow:"auto"};o.rowStyle={defaultClass:merge([dfp,crp,{backgroundcolor:"#D4D0C8"}]),markClass:merge([dfp,crp,{backgroundcolor:"#ccccff"}]),resizeClass:{cursor:"row-resize",borderwidth:"0"},dragClass:{cursor:"move",borderwidth:"0"},width:40,height:22};o.colStyle={defaultClass:merge([dfp,crp,{backgroundcolor:"#D4D0C8"}]),markClass:merge([dfp,crp,{backgroundcolor:"#ccccff"}]),resizeClass:{cursor:"col-resize",borderwidth:"0"},dragClass:{cursor:"move",borderwidth:"0"},width:80,height:22};o.cellStyle={defaultClass:merge([dfp,clp,{backgroundcolor:"#ffffff",bordercolor:"#cccccc",borderwidth:1}]),markClass:merge([dfp,clp,{backgroundcolor:"#ccccff",bordercolor:"#cccccc",borderwidth:1}]),currClass:merge([dfp,clp,{backgroundcolor:"#effffe",bordercolor:"#000000",borderwidth:2}])};o.toolBar={height:29,bgcolor:"#D4D0C8",defaultClass:merge([dfp,dbp]),buttons:[],searchControl:null};o.statusBar={height:18,bgcolor:"#D4D0C8",defaultClass:dbp,messageClass:dbp,fieldText:"Field",valueText:"Value"};o.pageTurnBar={defaultClass:{backgroundcolor:"#ffffff",fontsize:"12px",fontfamily:"Verdana,Arial"},activeClass:{backgroundcolor:"#D4D0C8",fontsize:"12px",fontfamily:"Verdana,Arial"},img_on:{src:imgDir+"t_on.gif"},img_off:{src:imgDir+"t_off.gif"},text:"Page",width:65,height:14};var f=["addrowto","addrowafter","delrow","addcolto","addcolafter","delcol","sortasc","sortdesc","multisortasc","multisortdesc","resetsort","copy","paste","formatbold","formatitalic","formatunderline","alignleft","aligncenter","alignright","setsearch","resetsearch","setamount"],c=["Add row before current one","Add row after current one","Delete row","Add column before current one","Add column after current one","Delete column","Sort in ascending order","Sort in descending order","Multi Sort in ascending order","Multi Sort in descending order","Reset sort","Copy","Paste","Format bold","Format italic","Format underline","Align left","Align center","Align right","Search","Reset search","Set amount"],d=o.toolBar.buttons;for(n=0;n<f.length;n++){d[n]={};d[n].name=f[n];d[n].text=c[n];d[n].img_on={src:imgDir+f[n]+".gif",width:16,height:16};d[n].img_off={src:imgDir+f[n]+"_off.gif",width:16,height:16}}ua.oldB=ua.oldOpera||ua.nn4}{var CGp=CCodeThatGrid.prototype;CGp.setFocus=function(e,t){var r=this,i=r.curCell,a,l,o,n,s,f;if(Undef(i))return;l=!r.vr.length?r.rIdx.indexOf(i.row._id):r.vr.indexOf(i.row._id);a=r.cIdx.indexOf(i.col._id);o=(r.page-1)*r.amountPerPage;n=r.page*r.amountPerPage>r.rows.length?r.rows.length:r.page*r.amountPerPage;if(e+l<o){l=n+(e+l)}else{if(e+l<n)l=e+l;else l=n-(e+l)}if(t+a<0){a=r.cols.length+(t+a)}else{if(t+a<r.cols.length)a=t+a;else a=r.cols.length-t-a}if(t>=0){while(a<r.colCount&&!r.cols[a].isVisible)a++;if(a==r.colCount)a=0;while(a<r.colCount&&!r.cols[a].isVisible)a++;if(a==r.colCount){alert("All columns are hidden!");return}}else{while(a>-1&&!r.cols[a].isVisible)a--;if(a==-1)a=r.colCount-1;while(a>-1&&!r.cols[a].isVisible)a--;if(a==-1){alert("All columns are hidden!");return}}l=!r.vr.length?r.rIdx[l]:r.vr[l];a=r.cIdx[a];if(l>-1&&a>-1)r.setCurCell(r.cells[l][a])};CGp.onKeyPress=function(e){var t=this,r=t.curCell,i,a,l;if(Undef(r))return;switch(e._e.keyCode){case 57387:case 37:if(r.state!=2)t.setFocus(0,-1);break;case 57385:case 38:if(r.state!=2)t.setFocus(-1,0);break;case 57388:case 39:if(r.state!=2)t.setFocus(0,1);break;case 57386:case 40://!^
if(r.state!=2)t.setFocus(1,0);break;case 9:if(isShift)if(t.cIdx.indexOf(t.cols[r.col._id])==0)t.setFocus(-1,-1);else t.setFocus(0,-1);else if(t.cIdx.indexOf(t.cols[r.col._id])==t.cIdx.length-1)t.setFocus(1,1);else t.setFocus(0,1);if(ua.ie){i=CT_fe(t.curCell.getID());i.focus()};break;case 13:if(r.state!=2){r.setState(2);return false}else{i=CT_fe("cell");if(Def(i)&&i.type.toLowerCase()!="textarea")t.setFocus(0,1)};break;case 57346:case 113:if(r.state!=2)r.setState(2);break;case 27:if(r.state==2){i=CT_fe("cell");if(Def(i))i.value=r.getDataForEdit()}r.setState(1);break;case 57383:case 33:if(r.state!=2){a=t.rIdx[(t.page-1)*t.amountPerPage];t.setCurCell(t.cells[a][r.col._id])};break;case 57384:case 34:if(r.state!=2){if(t.page*t.amountPerPage-1>=t.rIdx.length)a=t.rIdx[t.rIdx.length-1];else a=t.rIdx[t.page*t.amountPerPage-1];t.setCurCell(t.cells[a][r.col._id])};break;case 57382:case 35:if(r.state!=2){l=t.cIdx[t.cIdx.length-1];t.setCurCell(t.cells[r.row._id][l])};break;case 57381:case 36:if(r.state!=2){l=t.cIdx[0];t.setCurCell(t.cells[r.row._id][l])};break;case 67:if(r.state==2)break;t.copy();break;case 86:if(r.state==2)break;t.paste();break}};CGp.makeStyle=function(e,t,r){var i;if(Def(i=makeCssClass(e[t]))){r=makeNameUnique(r);e[t]=r;i="\n."+r+"{"+i+"}"}return i};CGp.setMarkRange=function(e,t){var r=this,i=r.markRange,a,l,o,n=!ua.opera;if(Def(r.curCell)&&t<3)r.setCurCell(null);r.clearMarkRange(t);switch(t){case 1:case 2:r.markType=t;a=i.indexOf(e);if(isShift){if(i.length>0)a=i[i.length-1];else a=e;if(i.length>0)i.length--;if(r.markType==1){a=r.cIdx.indexOf(a);e=r.cIdx.indexOf(e)}else{a=r.rIdx.indexOf(a);e=r.rIdx.indexOf(e)}if(a>e){l=a;a=e;e=l}for(l=a;l<=e;l++){i[i.length]=r.markType==1?r.cols[r.cIdx[l]]._id:r.rows[r.rIdx[l]]._id}}else{if(a==-1)i[i.length]=e};for(l=0;l<i.length;l++)if(r.markType==1)r.cols[i[l]].setMark(1,null,null,n);else r.rows[i[l]].setMark(1,null,null,n);break;case 3:i=e;for(l=0;l<i.length;l++)i[l]=i[l]-0;if(i[0]-i[2]==0&&i[1]-i[3]==0)return;r.markType=t;r.markRange=e;if(r.rIdx.indexOf(i[0])>r.rIdx.indexOf(i[2])){a=i[0];i[0]=i[2];i[2]=a}if(r.cIdx.indexOf(i[1])>r.rIdx.indexOf(i[3])){a=i[1];i[1]=i[3];i[3]=a}for(l=r.rIdx.indexOf(i[0]);l<=r.rIdx.indexOf(i[2]);l++)r.rows[r.rIdx[l]].setMark(1,r.cIdx.indexOf(i[1]),r.cIdx.indexOf(i[3])+1,n);break}if(!n)r.paint()};CGp.clearMarkRange=function(e){var t=this,r,i=t.markRange,a=!ua.opera;if(t.markType==0)return;if(t.markType==e&&(isCtrl||isShift))return;switch(t.markType){case 1:case 2:for(r=0;r<i.length;r++)if(t.markType==1)t.cols[i[r]].setMark(0,null,null,a);else t.rows[i[r]].setMark(0,null,null,a);break;case 3:if(Undef(i)||i.constructor!=Array||i.length==0)return;for(r=t.rIdx.indexOf(i[0]);r<=t.rIdx.indexOf(i[2]);r++)t.rows[t.rIdx[r]].setMark(0,t.cIdx.indexOf(i[1]),t.cIdx.indexOf(i[3])+1,a);break}t.markType=0;t.markRange.length=0;if(!a)t.paint()};CGp.init=function(gridDef){var t=this,d=new Date,i,j,style="",imgs=[],c,data;if(Def(gridDef))t.def=gridDef;for(i in t){if((i.indexOf("Style")>-1||i.indexOf("Bar")>-1)&&t[i].constructor==Object){if(Def(t.def[i]))t[i]=t.def[i];for(j in t[i]){if(j.indexOf("Class")>-1)style+=t.makeStyle(t[i],j,"")}}if(i.indexOf("use")==0&&Def(t.def[i]))eval("t."+i+"="+t.def[i])}t.showProgress("Get appearance parameters");if(Undef(t.tableStyle.overflow))t.tableStyle.overflow="auto";if(ua.moz&&t.tableStyle.overflow=="visible")t.tableStyle.overflow="auto";if(Def(style))dw("<style>"+style+"</style>");b=t.toolBar.buttons;for(i=0;Def(b)&&i<b.length;i++)for(j in b[i])if(j.indexOf("img")>-1&&Def(b[i][j]))imgs[imgs.length]=b[i][j].src;b=t.pageTurnBar;for(i in b)if(i.indexOf("img")>-1&&Def(b[i]))imgs[imgs.length]=b[i].src;for(i=0;i<imgs.length;i++)CodeThat.preload(imgs[i]);c=parseInt(t.def.amountPerPage);if(!isNaN(c)&&c>0)t.amountPerPage=c;t.userFunction=t.def.userFunction;t.writeProgress("Init grid "+t.rowCount+"x"+t.colCount);for(i=0;i<t.rowCount;i++){t.rows[i]=new CGRow(i,t);t.rIdx[i]=i;t.cells[i]=[];for(j=0;j<t.colCount;j++){c=Def(t.def.colDef)&&t.def.colDef.length>j&&Def(t.def.colDef[j])?t.def.colDef[j]:DEFAULT_COLDEF;if(i==0){t.cols[j]=new CGCol(j,t,c);t.cIdx[j]=j}t.cells[i][j]=new CGCell(t.rows[i],t.cols[j],"")}}t.loadData(t.def.datatype,t.def.data);t.isInit=1};CGp.toCSV=function(e,t,r,i,a){var l=this,o="",n,s,f,c,d=!l.vr.length?l.rIdx:l.vr;if(Undef(e))e=";";if(Undef(t))t=0;if(Undef(r))r=0;if(Undef(r))r=0;if(Undef(a))a=0;c=new RegExp(e+"+$");if(!t){for(s=0;s<l.rowCount;s++){if(r&&!l.rows[l.rIdx[s]].change||i&&l.rows[l.rIdx[s]].isReadOnly)continue;for(f=0;f<l.colCount;f++){if(a==1&&!l.cols[f].isVisible)continue;o+=l.cells[l.rIdx[s]][l.cIdx[f]].getDataForEdit().replace(/\r?\n/g,"\\n")+e}o=o.replace(c,"")+"\n"}}else{n=l.markRange;switch(l.markType){case 1:for(s=0;s<l.rowCount;s++){for(f=0;f<n.length;f++)o+=l.cells[l.rIdx[s]][n[f]].getDataForEdit().replace(/\r?\n/g,"\\n")+e;o=o.replace(c,"")+"\n"};break;case 2:for(s=0;s<n.length;s++){for(f=0;f<l.colCount;f++)o+=l.cells[n[s]][l.cIdx[f]].getDataForEdit().replace(/\r?\n/g,"\\n")+e;o=o.replace(c,"")+"\n"};break;case 3:for(s=d.indexOf(n[0]);s<=d.indexOf(n[2]);s++){for(f=l.cIdx.indexOf(n[1]);f<=l.cIdx.indexOf(n[3]);f++)o+=l.cells[d[s]][l.cIdx[f]].getDataForEdit().replace(/\r?\n/g,"\\n")+e;o=o.replace(c,"")+"\n"};break}}o=o.replace(/\n+$/,"");return o};CGp.toCSVFile=function(e){return'<?xml version="1.0" standalone="yes"?><data table="'+this.name+'">'+this.toCSV(";",0,e)+"</data>"};CGp.fromCSV=function(e,t){var r=this,i,a;if(Undef(t))t=";";if(ua.oldB)i=e.split("\n");else i=e.split(/\n/);for(a=0;a<i.length;a++){i[a]=i[a].split(t)}return i};CGp.fromCSVFile=function(e,t){var r=this,i=[],a=null,l,o,n;if(ua.oldB||Undef(e))return i;if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.async=0;a.load(e);a=a.documentElement.text}if(window.XMLHttpRequest){l=new XMLHttpRequest;l.open("GET",e,0);if(Def(l.overrideMimeType))l.overrideMimeType("text/xml");l.send(null);if(!l.responseXML)return i;a=l.responseXML.documentElement.firstChild.nodeValue}if(Def(w)&&Def(w.document)&&w.document.readyState=="complete"){a=w.document.getElementsByTagName("data")[0].firstChild.nodeValue}if(Def(a)){i=this.fromCSV(a,t);if(Def(w)&&!w.closed){w.close();w=null;curId=0}return i}if(Undef(w)){w=window.open(e);window.focus()}if(curId<10)window.setTimeout(r.name+".loadData(3, '"+e+"', null)",1e3);else{if(confirm(curId+" tries to access to file "+e+". \nDo you wish try again?")){curId=0;window.setTimeout(r.name+".loadData(3, '"+e+"', null)",1e3)}else{alert("Can't load data from file "+e+"!");if(Def(w)&&!w.closed){w.close();w=null;curId=0}}}curId++;return i};CGp.fromXML=function(x){var t=this,d=[];if(Undef(x)||x.indexOf("<?")==-1)return d;var xml=new CXMLTree(x),i,j,f,k,b,p=["bold","italic","underline"];xml=xml.toObject();xml=xml.data;if(Def(xml.row)){xml=xml.row;if(Undef(xml))return d;if(xml.constructor!=Array)xml=[xml];for(i=0;i<xml.length;i++){d[i]=[];f=xml[i].field;if(Undef(f))continue;if(f.constructor!=Array)f=[f];for(j=0;j<f.length;j++){for(k=0;k<p.length;k++){eval("b="+f[j][p[k]]);f[j][p[k]]=b}if(Undef(f[j].align))f[j].align="";d[i][j]=Undef(f[j].__value)?"":f[j]}}}else{for(i in xml)if(i.indexOf("value")>-1&&Def(xml[i]))x=xml[i];d=t.fromCSV(x)}return d};CGp.fromXMLField=function(e){var t=new Object,r=["bold","italic","underline"],i;for(i=0;i<r.length;i++)t[r[i]]=e.getAttribute(r[i])=="true"?1:0;t.align=e.getAttribute("align");if(Undef(t.align)||t.align=="undefined")t.align="";if(ua.ie)t.__value=Def(e.text)?e.text:"";else t.__value=Def(e.firstChild)?e.firstChild.nodeValue:"";if(Undef(t.__value))t="";return t};CGp.fromXMLFile=function(e){var t=this,r=[],i=null,a,l,o,n;if(ua.oldB||Undef(e))return r;if(window.ActiveXObject){i=new ActiveXObject("Microsoft.XMLDOM");i.async=0;i.load(e)}if(window.XMLHttpRequest){l=new XMLHttpRequest;l.open("GET",e,0);if(Def(l.overrideMimeType))l.overrideMimeType("text/xml");l.send(null);if(!l.responseXML)return r;i=l.responseXML.documentElement}if(ua.opera7&&Def(w)&&Def(w.document)&&w.document.readyState=="complete"){i=w.document}if(Def(i)){for(o=0;o<i.getElementsByTagName("row").length;o++){r[r.length]=[];a=i.getElementsByTagName("row")[o];for(n=0;n<a.getElementsByTagName("field").length;n++)r[o][n]=t.fromXMLField(ua.moz?a.getElementsByTagName("field")[n]:a.getElementsByTagName("field").item(n))}if(Def(w)&&!w.closed){w.close();w=null;curId=0}return r}if(Undef(w)){w=window.open(e);window.focus()}if(curId<10)window.setTimeout(t.name+".loadData(2, '"+e+"', null)",1e3);else{if(confirm(curId+" tries to access to file "+e+". \nDo you wish try again?")){curId=0;window.setTimeout(t.name+".loadData(2, '"+e+"', null)",1e3)}else{alert("Can't load data from file "+e+"!");if(Def(w)&&!w.closed){w.close();w=null;curId=0}}}curId++;return r};CGp.toXML=function(e,t){if(Undef(e))e=0;if(Undef(t))t=0;var r=this,i='<?xml version="1.0" standalone="yes"?><data table="'+r.name+'">',a,l,o,n,s,f;for(a=0;a<r.rowCount;a++){if(e&&!r.rows[r.rIdx[a]].change||t&&r.rows[r.rIdx[a]].isReadOnly)continue;s="";f="";for(l=0;l<r.colCount;l++){o=r.cells[r.rIdx[a]][r.cIdx[l]];n=r.cols[r.cIdx[l]].title;n=Def(n)&&n.search(/[^a-z0-9_]/gi)==-1?n:r.cols[0].getName(l);f+='\n\t<field fieldname="'+n+'" bold="'+Def(o.b)+'" italic="'+Def(o.i)+'" underline="'+Def(o.u)+'" align="'+o.alignment+'">'+o.getDataForEdit()+"</field>";s+=o.getDataForEdit()+";"}if(Def(s.replace(/;+$/,"")))i+='\n<row id="'+r.rows[r.rIdx[a]]._id+'">'+f+"\n</row>"}i+="\n</data>";return i};CGp.loadData=function(e,t,r){if(Undef(t))return;if(Undef(e))e=0;var i=this,a=0,l=0,o=i.rowCount,n=i.colCount,s,f,c,d,u,g;if(Def(r)){a=r.row._id;l=r.col._id}a=i.rIdx.indexOf(a);l=i.cIdx.indexOf(l);i.writeProgress("Read data from source");switch(parseInt(e)){case 0:break;case 1:t=i.fromCSV(t);break;case 2:t=i.fromXMLFile(t);break;case 3:if(t.constructor==Array)t=t[1];t=i.fromCSVFile(t);break;case 4:t=i.fromXML(t);break;default:return}if(t.constructor!=Array||!t.length)return;u=t[0];if(u.constructor!=Array){u=u.data}if(u.constructor!=Array)return;i.writeProgress("Load data into grid");if(t.length>o-a)for(c=o;c<a+t.length;c++)i.addRow(c,0,0);if(u.length>n-l)for(c=n;c<l+u.length;c++){g=Def(i.def.colDef)&&i.def.colDef.length>c&&Def(i.def.colDef[c])?i.def.colDef[c]:DEFAULT_COLDEF;i.addCol(c,0,0,g)}o=i.rowCount;n=i.colCount;for(c=a;c<a+t.length;c++){s=i.rIdx[c];if(i.isInit)i.rows[s].change=1;u=t[c-a];if(Undef(u))continue;if(u.constructor!=Array){i.rows[s].userFunction=u.userFunction;u=u.data}for(d=l;d<l+u.length;d++){f=i.cIdx[d];i.cols[f].index.length=0;i.cols[f].filter.length=0;if(Def(u[d-l])&&u[d-l].constructor==Object&&Def(u[d-l].__value)){i.cells[s][f].b=u[d-l].bold?"bold":"";i.cells[s][f].i=u[d-l].italic?"italic":"";i.cells[s][f].u=u[d-l].underline?"underline":"";i.cells[s][f].alignment=u[d-l].align;i.cells[s][f].setData(u[d-l].__value)}else i.cells[s][f].setData(u[d-l])}}if(i.isInit)i.paint()};CGp.useFilter=function(e){var t=this,r,i=0;for(r=0;r<t.colCount&&!i;r++)if(Def(e))i=i||t.cols[r].useAutoFilter&&t.cols[r].filterValue!="";else i=i||t.cols[r].useAutoFilter;return i};CGp.toHTML=function(e){var t=this,r,i="",a="",l="",o="",n,s,f,c,d,u,g,C,h=t.amountPerPage,p=t.tableStyle,m=0,w=0,x=t.rowStyle.width,b,v,D,y=t.rowStyle.defaultClass,k,I;t.writeProgress("Create HTML content");if(t.useRCID)o="<th "+re+y+" width="+x+"><img src=imgDir+'spacer.gif' border=0 width="+x+" height=1></th>";for(n=0;n<t.colCount;n++){c=t.cIdx[n];if(!t.cols[c].isVisible)continue;d=Def(t.curCell)&&t.curCell.col._id==t.cols[c]._id;D=t.cols[c].defaultClass;b=t.cols[c].markClass;k=ua.ie?"<img src=imgDir+'spacer.gif' border=1 width=5 height=10 "+re+t.cols[c].dragClass+" style='position:relative;left:5;' id='_ID_'>":"";if(t.useRCID&&t.showCols)i+="<th id='"+t.cols[c].getID("col")+"' "+t.cols[c].width+" "+re+(t.cols[c].isMark||d?b:D)+">"+k.replace(/_ID_/,t.cols[c].getID("cold"))+t.cols[c].getName(n)+"</th>";if(t.helptips==true)a+="<th ONMOUSEOVER='helpOver(this)'; ONMOUSEOUT='helpOut(this)'; id='"+t.cols[c].getID("title")+"' "+re+t.cols[c].titleClass+" "+t.cols[c].width+">"+t.cols[c].title+"</th>";else a+="<th id='"+t.cols[c].getID("title")+"' "+re+t.cols[c].titleClass+" "+t.cols[c].width+">"+t.cols[c].title+"</th>";if(t.cols[c].useAutoIndex&&!t.cols[c].index.length)t.setIndex(c);if(!t.cols[c].filter.length)t.cols[c].setFilter();l+="<th "+re+t.cols[c].titleClass+">"+t.cols[c].filterToHTML()+"</th>";w=t.cols[c].width;if(w.constructor!=String)w+="";w=w.replace(/[^0-9]/gi,"")*1;m+=w>0?w:t.colStyle.width}r="<table cellpadding=0 cellspacing=0 border=1 width="+m+">"+"<tr>"+o+i+"</tr>"+(t.useColTitle?"<tr>"+o+a+"</tr>":"")+(t.useFilter()&&!ua.oldB?"<tr>"+o+l+"</tr>":"");if(!t.vr.length){t.writeProgress("Hide invisible rows");for(n=0;n<t.rIdx.length;n++)if(t.rows[t.rIdx[n]].isVisible)t.vr[t.vr.length]=t.rIdx[n]}t.pageCount=t.vr.length%h==0?t.vr.length/h:Math.floor(t.vr.length/h)+1;g=(t.page-1)*h;C=t.page*h<t.vr.length?t.page*h:t.vr.length;for(n=g;n<C;n++){f=t.vr[n];d=Def(t.curCell)&&t.curCell.row._id==t.rows[f]._id;y=t.rows[f].defaultClass;v=t.rows[f].markClass;I=ua.ie?"<img src=imgDir+'spacer.gif' border=1 width=5 height=10 "+re+t.rows[f].dragClass+" style='position:relative;left:5;' id='_ID_'>":"";if(t.useRCID)r+="<tr "+t.rows[f].height+"><th nowrap width='"+x+"' id='"+t.rows[f].getID("row")+"' "+re+(t.rows[f].isMark||d?v:y)+">"+I.replace(/_ID_/,t.rows[f].getID("rowd"))+t.rows[f].getName(n)+"</th>";for(s=0;s<t.colCount;s++){c=t.cIdx[s];if(!t.cols[c].isVisible)continue;u=t.cells[f][c];r+="<td "+t.cols[c].alignment+t.cols[c].width+" id='"+u.getID()+"' "+re+(u==t.curCell?u.currClass:u.isMark?u.markClass:u.defaultClass)+" "+u.getStyle()+">"+u.getData()+"</td>"}r+="</tr>"}r+="</table>";if(e)if(ua.moz)r="<div id='"+t.getID("cnt")+"' style='background-color:"+p.bgcolor+";top:"+p.y+";left: "+p.x+";width:"+(p.width-4)+";height:"+p.height+";overflow:hidden;' "+re+p.tableClass+"><div id='"+t.name+"' style='height:100%;width:100%;overflow:"+p.overflow+";'>"+r+"</div></div>";else if(!ua.oldB)r="<div id='"+t.name+"' style='background-color:"+p.bgcolor+";top:"+p.y+";left: "+p.x+";width:"+p.width+";height:"+p.height+";overflow:"+p.overflow+";' "+re+p.tableClass+">"+r+"</div>";return r};CGp.paint=function(){var e=this,t=CT_fe(e.name);if(Def(t)){CT_HTML(e.name,e.toHTML());e.paintBar("sb");e.paintBar("pt")}else{if(!ua.oldB)dw("<style>.separator{background-color: #ffffff;height: 22px; border-left: 1px inset;width: 2px;}\n#cell{font-size:11px;}</style>");dw(e.tbToHTML()+e.sbToHTML(1)+e.toHTML(1)+e.ptToHTML(1));if(!ua.oldB)CT_regEvents(e.name,e.getID("pt"));if(e.useExportBar)dw(e.ebToHTML())}e.hideProgress()};CGp.doAction=function(datatype,data){var t=this;if(Def(datatype)&&Def(data)){t.isInit=0;t.loadData(datatype,data,null);t.isInit=1}if(ua.oldB){var l=window.location.href,i;if(l.indexOf("?")>-1){l=l.slice(l.indexOf("?")+1);l=l.split("&");for(i=0;i<l.length;i++)if(Def(l[i]))eval(t.name+"."+l[i])}}t.paint()};CGp.getID=function(e){return e+this.name};CGp.paintBar=function(bar){if(ua.oldB)return;var t=this,h=eval(t.name+"."+bar+"ToHTML()");if(Def(h))CT_HTML(t.getID(bar),h)};CGp.sbToHTML=function(e){var t=this,r=t.statusBar;if(ua.oldB||r.height==0)return"";var i,a=t.curCell,l="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",o="",n=t.msg;if(Def(a)){l=a.col.getName(t.cIdx.indexOf(a.col._id))+a.row.getName(t.rIdx.indexOf(a.row._id))+"&nbsp;";o=a.getData()}if(t.showStatusBar==0)i="";else{if(t.searchValue!="")n="Current search: "+t.searchValue+"&nbsp;"+t.msg;i="<table width=100% cellpadding=0 cellspacing=0 border=0 "+re+r.defaultClass+"><tr><td>"+r.fieldText+": </td><td>"+l+"</td><td>"+r.valueText+":</td><td nowrap>"+o+"</td><td align=right "+re+r.messageClass+" nowrap width=80%>"+n+"&nbsp;</td></tr></table>";if(e)i="<div id='"+t.getID("sb")+"' style='width:"+t.tableStyle.width+";height:"+r.height+";overflow:hidden;background-color:"+r.bgcolor+"'>"+i+"</div>"}return i};CGp.ptToHTML=function(e){var t=this,r,i,a,l=t.pageCount,o=t.amountPerPage,n=t.pageTurnBar,s=0,f=t.tableStyle.width,c=n.width;f=isNaN(f)||ua.oldB?DEFAULT_COLDEF.width*t.colCount:f;if(l==1)i="&nbsp;";else{i="<table border=0 cellpadding=0 cellspacing=1><tr>";for(r=1;r<=l;r++){a=r==t.page?Def(n.img_on)?n.img_on.src:"":Def(n.img_off)?n.img_off.src:"";if(Def(a))a="style='background-image:url("+a+");background-repeat:no-repeat;background-position:center'";i+="<th id='"+t.getID("pt"+r)+"'"+a+" "+re+(r==t.page?n.activeClass:n.defaultClass)+" width="+c+" height="+n.height+">"+(r==t.page?n.text+" "+r:"<a href='javascript:"+t.name+".setPage("+r+")' style='text-decoration:none'>"+n.text+" "+r+"</a>")+"</th>";s+=c;if(f>0&&s+c>f){s=0;i+="</tr><tr>"}}i+="</tr></table>"}if(e)i="<div id='"+t.getID("pt")+"'>"+i+"</div>";return i};CGp.tbToHTML=function(){var e=this,t=e.toolBar;if(ua.oldB||t.height==0)return"";var r=t.buttons,i,a,l,o,n,s,f=t.searchControl,c="<div id='"+e.getID("tb")+"' "+re+t.defaultClass+" style='width:"+e.tableStyle.width+";height:"+t.height+";overflow:hidden;background-color:"+t.bgcolor+"''><table cellpadding=1 cellspacing=1 border=0><tr>";if(Def(f)){r[r.length]={name:"setsearch",mg_on:f.img_on,text:f.text_on};r[r.length]={name:"resetsearch",img_on:f.img_off,text:f.text_off}}n=0;s=0;for(i=0;i<r.length&&!n;i++){if(r[i].name=="setamount")n=1;if(r[i].name=="resetsort")s=1}if(!n)r[r.length]={name:"setamount",text:"Amount"};if(!s)r[r.length]={name:"resetsort",text:"Reset sort"};for(i=0;i<r.length;i++){o="";if(Undef(r[i].name))c+="<th><span class=separator></span></th>";else{switch(r[i].name){case"addrowto":o=e.name+".addRow(null, -1)";break;case"addrowafter":o=e.name+".addRow(null, 1)";break;case"delrow":o=e.name+".delRows()";break;case"addcolto":o=e.name+".addCol(null, -1)";break;case"addcolafter":o=e.name+".addCol(null, 1)";break;case"delcol":o=e.name+".delCols()";break;case"sortasc":o=e.name+".setSort(null, 1)";break;case"sortdesc":o=e.name+".setSort(null, -1)";break;case"multisortasc":if(!e.useMultiSort)continue;o=e.name+".setMultiSort(null, 1)";break;case"multisortdesc":if(!e.useMultiSort)continue;o=e.name+".setMultiSort(null, -1)";break;case"resetsort":o=e.name+".resetSort()";break;case"copy":case"paste":o=e.name+"."+r[i].name+"()";break;case"formatbold":o=e.name+'.setCellStyle("b")';break;case"formatitalic":o=e.name+'.setCellStyle("i")';break;case"formatunderline":o=e.name+'.setCellStyle("u")';break;case"alignleft":o=e.name+'.setCellStyle("alignment", "left")';break;case"aligncenter":o=e.name+'.setCellStyle("alignment", "center")';break;case"alignright":o=e.name+'.setCellStyle("alignment", "right")';break;case"setsearch":o=e.name+".setSearch()";break;case"resetsearch":o=e.name+".resetSearch()";break;case"setamount":o=e.name+".setAmountPerPage()";break;case"setPageWidth":o=e.name+".setPageWidth()";break}if(o=="")continue;if(Undef(r[i].img_off))r[i].img_off=r[i].img_on;a=makeImgTag(r[i].img_on,r[i].name,r[i].text);l=makeImgTag(r[i].img_off,r[i].name,r[i].text);if(Undef(a)&&Undef(l))a=r[i].text;if(Def(a)&&Def(l)&&a!=l)f="onMouseOver='document.images[\""+r[i].name+'"].src="'+r[i].img_on.src+"\";' onMouseOut='document.images[\""+r[i].name+'"].src="'+r[i].img_off.src+"\";'";if(Undef(a)&&Undef(l))f="onMouseOut='this.style.borderColor=\"#000000\";' onMouseOver='this.style.borderColor=\"#cccccc\";' style='border-width:1;border-style:outset;border-color:#cccccc'";c+="<th><a href='javascript:"+o+"' "+f+" title='"+r[i].text+"'>"+l+"</a></th>"}}c+="</tr></table></div>";return c};CGp.ebToHTML=function(){var e=this,t;t='<textarea  name="csv" rows=5 cols=90 style="width:'+e.tableStyle.width+';overflow:auto;" onSelect="'+this.name+'.clip = this.value;"></textarea><br>'+' <br><input type="button" value="Export to CSV String" onClick="this.form.csv.value = '+this.name+".toCSV(';', 0)\">"+' <input type="button" value="Export to CSV file" onClick="this.form.csv.value = '+this.name+'.toCSVFile()">'+' <input type="button" value="Export to XML" onClick="this.form.csv.value = '+this.name+'.toXML()">';t="<div id='"+e.getID("eb")+"'><form name='"+e.getID("exportForm")+"'>"+t+"</form></div>";return t};CGp.resetSort=function(e){var t=this,r=t.multiSortCol,i=t.multiSortType,a;if(t.sortCol==-1)return;if(Undef(e))e=-1;t.showProgress("Reset sort");a=r.indexOf(e);if(a<1){for(a=0;a<t.rowCount;a++)t.rIdx[a]=t.rows[a]._id;t.vr.length=0;t.setPage(1)}else{r.length=a;i.length=a;t.setMultiSort(r[a-1],i[a-1])}};CGp.setSort=function(e,t){var r=this,i;if(Undef(e)){if(Def(r.curCell))e=r.curCell.col._id;else if(r.markType==1)e=r.markRange[0];else e=prompt("Set the column for sort as number: A, B, ... or title","A");if(isNaN(parseInt(e))){e=r.getColByTitle(e)}if(Undef(e)||e==-1)return}if(r.markType==3)r.clearMarkRange();r.showProgress("Sort "+r.cols[e].title);r.sortCol=e;r.sortType=t;r.multiSortCol.length=0;r.multiSortType.length=0;if(!r.cols[r.sortCol].index.length)r.setIndex(r.sortCol);r.rIdx.setValue(r.cols[r.sortCol].index);if(r.sortType==-1)r.rIdx.reverse();r.vr.length=0;r.setPage(1)};CGp.setMultiSort=function(e,t){var r=this,i=r.multiSortCol,a=r.multiSortType,l,o,n,s,f,c,d,u;if(!r.useMultiSort)return;if(Undef(e)){if(Def(r.curCell))e=r.curCell.col._id;else if(r.markType==1)e=r.markRange[0];else e=prompt("Set the column for sort as number: A, B, ... or title","A");if(isNaN(parseInt(e))){e=r.getColByTitle(e)}if(Undef(e)||e==-1)return}if(r.markType==3)r.clearMarkRange();r.showProgress("Multi sort "+r.cols[e].title);if(i.length==0){if(r.sortCol==-1){r.sortCol=e;r.sortType=t}else{i[i.length]=r.sortCol;a[a.length]=r.sortType}i[i.length]=e;a[a.length]=t}else{l=i.indexOf(e);if(l>-1){a[l]=t}else{i[i.length]=e;a[a.length]=t}}if(r.cols[r.sortCol].index.length==0)r.setIndex(r.sortCol);r.rIdx.setValue(r.cols[r.sortCol].index);if(r.sortType==-1)r.rIdx.reverse();r.writeProgress("Create multi index for "+r.cols[e].title);for(l=1;l<i.length;l++){for(o=1;o<r.rowCount;o++){s=f=-1;d=r.rIdx[o-1];u=r.rIdx[o];while(r.cells[d][i[l-1]].compareTo(r.cells[u][i[l-1]])==0){if(s==-1)s=o-1;f=o;o++;if(o<r.rowCount){d=r.rIdx[o-1];u=r.rIdx[o]}else break}if(s>-1&&f>-1){c=r.setIndex2(i[l],s,f);if(a[l]==-1)c.reverse();for(n=0;n<c.length;n++)r.rIdx[s+n]=c[n]._id}}}r.vr.length=0;r.setPage(1)};CGp.setIndex=function(e){var t=this,r,i=t.sortCol,a=[];t.writeProgress("Create index for "+t.cols[e].title);t.sortCol=e;a.setValue(t.rows);a=a.sort(t.compare);for(r=0;r<t.rowCount;r++){t.cols[t.sortCol].index[r]=a[r]._id}t.sortCol=i};CGp.setIndex2=function(e,t,r){var i=this,a=i.sortCol,l=[],o,n;i.sortCol=e;for(o=t;o<r+1;o++){n=i.rows.indexOf(i.rIdx[o]);l[l.length]=i.rows[n]}l=l.sort(i.compare);i.sortCol=a;return l};CGp.resetSearch=function(){var e=this;if(e.searchValue=="")return;if(e.markType==3)e.clearMarkRange();e.searchValue="";e.search()};CGp.setFilter=function(e,t){var r=this;if(r.markType==3)r.clearMarkRange();r.showProgress("Set filter '"+t+"' on "+r.cols[e].title);r.cols[e].filterValue=t;r.search()};CGp.setSearch=function(){var e=this,t=prompt("Enter your query:",e.searchValue);if(Undef(t))return;if(e.markType==3)e.clearMarkRange();e.showProgress("Search value '"+t+"'");e.searchValue=t;e.search()};CGp.setAmountPerPage=function(){var e=this,t=prompt("Set count records per page",e.amountPerPage);if(!isNaN(parseInt(t))){t=parseInt(t);if(t<=0)return;e.amountPerPage=t;e.showProgress("Set '"+t+"' records per page");e.setPage(1)}};CGp.search=function(){var e=this,t,r=[];e.vr=[];for(t=0;t<e.colCount;t++)if(e.cols[t].useAutoFilter&&e.cols[t].filterValue!="")r[r.length]=t;e.writeProgress("Search match rows");for(t=0;t<e.rowCount;t++)e.rows[t].isVisible=e.rows[t].search(e.searchValue,r);e.setPage(1)};CGp.compare=function(e,t){var r=e.grid,i=r.sortCol,a;return r.cells[e._id][i].compareTo(r.cells[t._id][i])};CGp.showProgress=function(e){var t=this;t.winProgress=window.document.title;t.writeProgress(e)};CGp.writeProgress=function(e){var t=this;if(!t.useProgress)return;window.document.title=e+"...";window.status=e+"..."};CGp.hideProgress=function(){var e=this;if(!e.useProgress)return;window.document.title=e.winProgress;window.status=""};CGp.setPage=function(e){var t=this,r=new Date,i=window.location.href;t.page=e;if(ua.oldB){if(i.indexOf("setPage("+e+")")==-1){i=i.replace(/setPage\([0-9]+\)/,"");i=i+(i.indexOf("?")>-1?"&":"?")+"setPage("+e+")";window.location.href=i.replace(/\?&/,"?")}}else{t.writeProgress("Set current page "+t.page+"");t.paint()}};CGp.setPageWidth=function(){var e=this;tempWidth=prompt("Enter your width:",600);alert(tempWidth);e.setWidth(tempWidth);e.paint()};CGp.addRow=function(e,t,r){var i=this,a=i.rowCount,l,o;if(Undef(r))r=1;if(Undef(e)){o=i.curCell;if(Undef(o)){if(i.markType==2)e=i.markRange[0];else e=0}else e=o.row._id;e=i.rIdx.indexOf(e);if(t>0)e++}if(r)i.showProgress("Create new Row "+e);i.rows[a]=new CGRow(a,i);if(r)i.writeProgress("Create cells");i.cells[a]=new Array(i.colCount);for(l=0;l<i.colCount;l++){i.cols[l].index.length=0;i.cells[a][l]=new CGCell(i.rows[a],i.cols[l],"");if(i.cols[l].useAutoFilter&&i.isInit)i.cols[l].setFilter()}i.vr.length=0;i.rIdx.insert(a,e);i.rowCount++;if(r)i.paint()};CGp.delRows=function(){var e=this,t=[],r,i;if(Undef(e.curCell)||e.markType==3){switch(e.markType){case 1:case 3:alert("Choose row for deleting!");return;case 2:t.setValue(e.markRange);e.clearMarkRange();t.sort(compare);for(r=0;r<t.length;r++){e.delRow(t[r],0);for(i=r;i<t.length;i++)if(t[i]>t[r])t[i]--};break}}else e.delRow(null,0);e.paint()};CGp.delRow=function(e,t){var r=this,i,a,l=0,o;if(r.rowCount==1){alert("You can't delete this row!");return}if(Undef(t))t=1;if(Undef(e)){a=r.curCell;if(Undef(a)){alert("Choose row for deleting!");return}else{e=a.row._id;l=a.col._id}}o=r.rIdx.indexOf(e);r.showProgress("Delete row "+o);r.rIdx.remove(o);for(i=0;i<r.rIdx.length;i++){if(parseInt(r.rIdx[i])>parseInt(e)){r.rIdx[i]--}}r.rows.remove(e);r.cells.remove(e);r.rowCount--;for(i=0;i<r.colCount;i++){r.cols[i].index.length=0;if(r.cols[i].useAutoFilter)r.cols[i].setFilter()}if(Def(a))r.setCurCell(r.cells[r.rIdx[o]][l]);r.vr.length=0;if(t)r.paint()};CGp.addCol=function(e,t,r,i){var a=this,l=a.colCount,o;if(Undef(r))r=1;if(Undef(e)){cl=a.curCell;if(Undef(cl)){if(a.markType==1)e=a.markRange[0];else e=0}else e=cl.col._id;e=a.cIdx.indexOf(e);if(t>0)e++}if(r)a.showProgress("Create new Column "+e);a.cols[l]=new CGCol(l,a,i);if(r)a.writeProgress("Create cells");for(o=0;o<a.rowCount;o++){a.cells[o].insert(new CGCell(a.rows[o],a.cols[l],""),l);a.rows[o].change=1}a.cIdx.insert(l,e);a.colCount++;a.sortCol=-1;if(r)a.paint()};CGp.delCols=function(){var e=this,t=[],r,i;if(Undef(e.curCell)||e.markType==3){switch(e.markType){case 1:t.setValue(e.markRange);e.clearMarkRange();t.sort(compare);for(r=0;r<t.length;r++){e.delCol(t[r],0);for(i=r;i<t.length;i++)if(t[i]>t[r])t[i]--};break;case 2:case 3:alert("Choose column for deleting!");return}}else e.delCol(null,0);e.paint()};CGp.delCol=function(e,t){var r=this,i,a=0,l,o;if(Undef(t))t=1;if(r.colCount==1){alert("You can't delete this column!");return}if(Undef(e)){l=r.curCell;if(Undef(l)){alert("Choose column for deleting!");return}else{e=l.col._id;a=l.row._id}}o=r.cIdx.indexOf(e);r.showProgress("Delete column "+r.cols[e].title);r.cIdx.remove(o);for(i=0;i<r.cIdx.length;i++)if(parseInt(r.cIdx[i])>parseInt(e))r.cIdx[i]--;r.cols.remove(e);for(i=0;i<r.rowCount;i++){r.cells[i].remove(e);r.rows[i].change=1}r.colCount--;r.sortCol=-1;if(Def(l))r.setCurCell(r.cells[a][r.cIdx[o]]);if(t)r.paint()};CGp.setCurCell=function(e){var t=this;if(Def(e))t.clearMarkRange();if(t.curCell!=e){if(Def(t.curCell))t.curCell.setState(0);if(Def(e)){t.curCell=e;t.curCell.setState(1)}}else{if(Def(t.curCell)){if(t.curCell.state==2)t.curCell.setState(1);else t.curCell.setState(2)}}t.curCell=e;rng.length=0};CGp.setCellStyle=function(e,t,r){var i=this,a,l,o=i.markRange;if(Undef(r))r=i.curCell;if(Undef(r)){switch(i.markType){case 1:for(a=0;a<o.length;a++){for(l=0;l<i.rowCount;l++)i.cells[l][o[a]].setStyle(e,t)};break;case 2:for(a=0;a<o.length;a++)for(l=0;l<i.colCount;l++)i.cells[o[a]][l].setStyle(e,t);break;case 3:break;default:alert("Choose cell before!");return;break}}else r.setStyle(e,t)};CGp.getColByTitle=function(e){var t=this,r=-1,i;if(Undef(e))return r;else e=e.toUpperCase();for(r=0;r<t.cols.length&&Def(e);r++){i=t.cIdx.indexOf(t.cols[r]._id);if(t.cols[r].title.toUpperCase()==e||t.cols[r].getName(i)==e)return r}return-1};CGp.copy=function(){var e=this;if(Def(e.curCell)&&!e.markType)e.clip=e.curCell.getDataForEdit();else e.clip=e.toCSV(";",1)+"";e.setClipData(e.clip)};CGp.paste=function(){var e=this,t=[];if(Undef(e.curCell)){alert("Choose cell before!");return}e.showProgress("Pasting data");if(!ua.opera&&Def(e.getClipData()))e.clip=e.getClipData();if(e.clip.indexOf("\t")==-1)t=e.fromCSV(e.clip);else t=e.fromCSV(e.clip,"\t");e.loadData(0,t,e.curCell)};CGp.getClipData=function(){if(ua.ie)return window.clipboardData.getData("Text");if(ua.moz){netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var clip=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!clip)return;var trans=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!trans)return;trans.addDataFlavor("text/unicode");clip.getData(trans,clip.kGlobalClipboard);var str=new Object;var len=new Object;eval("try { trans.getTransferData('text/unicode',str,len);}catch(exception) { return;}");if(str){if(Components.interfaces.nsISupportsWString)str=str.value.QueryInterface(Components.interfaces.nsISupportsWString);else if(Components.interfaces.nsISupportsString)str=str.value.QueryInterface(Components.interfaces.nsISupportsString);else str=null}if(str)return str.data.substring(0,len.value/2)}return null};CGp.setClipData=function(d){if(!ua.ie)return;eval("try {window.clipboardData.setData('Text', d)}catch(e){}")}}function CGRow(e,t){var r=this,i,a;r._id=e;r.grid=t;r.isVisible=1;r.height="height="+r.grid.rowStyle.height;r.change=0;r.isMark=0;r.isReadOnly=0;r.userFunction=null;a=r.grid.rowStyle;for(i in a)if(i.indexOf("Class")>-1)r[i]=a[i]}{var CRp=CGRow.prototype;CRp.getName=function(e){if(Undef(e))e=this._id+1;e=e*1+1;return e};CRp.getID=function(e){var t=this;return t.grid.getID(e)+t._id};CRp.valueOf=function(){return this._id};CRp.search=function(e,t){var r=this,i=r.grid,a,l,o=1;for(a=0;a<t.length&&o;a++){if(i.cells[r._id][t[a]].getDataForFilter()!=i.cols[t[a]].filterValue)o=0}if(o&&Def(e)){o=0;e=new RegExp(makeRE(e),"gi");for(a=0;a<i.colCount&&!o;a++){o=o||e.test(i.cells[r._id][a].getDataForFilter())}}return o};CRp.setMark=function(e,t,r,i){var a=this,l,o=a.grid,n=o.cells,s=t,f=r;if(Undef(e))e=!a.isMark;if(Undef(i))i=1;a.isMark=e;if(Undef(s))s=0;if(Undef(f))f=o.colCount;a.grid.writeProgress("Mark rows for current selection");for(l=s;l<f;l++){n[a._id][l].isMark=a.isMark;if(o.markType==3)o.cols[l].isMark=a.isMark}if(i)a.paint(t,r)};CRp.paint=function(e,t){var r=this,i,a=r.grid,l=a.cells,o;if(Undef(e))e=0;if(Undef(t))t=a.colCount;r.grid.writeProgress("Paint rows for current selection");for(i=e;i<t;i++){l[r._id][a.cIdx[i]].paint(a.markType==3)}o=CT_fe(r.getID("row"));if(Def(o))CT_css(o,r.isMark?r.markClass:r.defaultClass);r.grid.hideProgress()};CRp.setHeight=function(e){var t=this,r=t.grid;if(Undef(e))e=prompt("Set height for row",t.height.replace(/[^0-9%]/g,""));if(!isNaN(parseInt(e))){t.height="height="+e;r.paint()}};CRp.callHandler=function(e){if(Def(this.handler))this.handler(e)}}function CGCol(id,g,colDef){var t=this,w,i,s;t._id=id;t.grid=g;t.index=[];t.filter=[];t.filterValue="";s=t.grid.colStyle;for(i in s)if(i.indexOf("Class")>-1)t[i]=s[i];for(i in DEFAULT_COLDEF)t[i]=DEFAULT_COLDEF[i];if(Def(colDef)){for(i in colDef){if(Def(colDef[i]))if(i.indexOf("is")>-1||i.indexOf("use")>-1||i.indexOf("Function")>-1)eval("t[i] = "+colDef[i]);else t[i]=colDef[i]}w=parseInt(colDef.width);t.width=isNaN(w)||w>0?' width="'+colDef.width+'"':"";t.alignment=Def(colDef.alignment)?' align="'+colDef.alignment+'"':""}if(Undef(t.title))t.title="Column"+t.getName(t._id);if(Undef(t.titleClass))t.titleClass=t.defaultClass}{var CCp=CGCol.prototype;CCp.callHandler=function(e){if(Def(this.handler))this.handler(e)};CCp.getName=function(e){if(Undef(e))e=this._id;var t=26,r=65,i=[],a="";while(e>t){i[i.length]=e%t;e=e/t}i[i.length]=e%t;if(i.length>1)if(i[i.length-1]>0)i[i.length-1]--;for(var l=i.length-1;l>-1;l--){a+=String.fromCharCode(i[l]*1+r)}return a};CCp.setTitle=function(){var e=this,t=prompt("Set title",e.title);if(t){e.title=t;changeContent(e.getID("title"),e.title)}};CCp.getID=function(e){var t=this;return t.grid.getID(e)+t._id};CCp.valueOf=function(){return this._id};CCp.setFilter=function(){var t=this,g=t.grid,i,v;if(!t.useAutoFilter||!t.grid.isInit)return;g.writeProgress("Update filter for column "+t.title);t.filter.length=0;for(i=0;i<g.rows.length;i++){v=g.cells[i][t._id].getDataForFilter();if(Def(v)&&typeof v!="unknown"&&t.filter.indexOf(v)==-1)t.filter[t.filter.length]=v}if(t.filter.length&&!ua.oldB)eval("try{t.filter = t.filter.sort(compare)}catch(e){}")};CCp.filterToHTML=function(){var e=this,t,r="&nbsp;";if(!e.useAutoFilter)return r;r="<select id='"+e.getID("filter")+"' name='"+e.getID("filter")+"' onChange='"+e.grid.name+".setFilter("+e._id+", this.value)'><option value=''>"+EMPTY_ROW+"</option>";for(t=0;t<e.filter.length;t++)r+='<option value="'+e.filter[t]+'"'+(e.filterValue!=""&&e.filter[t].toString()==e.filterValue?" selected":"")+">"+e.filter[t]+"</option>";r+="</select>";return r};CCp.setMark=function(e,t,r,i){var a=this,l,o=a.grid.cells,n=r,s=t;if(Undef(e))e=!a.isMark;if(Undef(i))i=1;a.isMark=e;if(Undef(s))s=0;if(Undef(n))n=a.grid.rowCount;a.grid.writeProgress("Mark columns for current selection");for(l=s;l<n;l++)o[l][a._id].isMark=a.isMark;if(i)a.paint(t,r)};CCp.paint=function(e,t){var r=this,i,a=r.grid,l=a.amountPerPage,o=a.cells,n;if(Undef(e))e=(a.page-1)*l;if(Undef(t))t=a.page*l<a.vr.length?a.page*l:a.vr.length;r.grid.writeProgress("Paint columns for current selection");for(i=e;i<t;i++){o[a.vr[i]][r._id].paint(0)}n=CT_fe(r.getID("col"));if(Def(n))CT_css(n,r.isMark?r.markClass:r.defaultClass);r.grid.hideProgress()};CCp.setWidth=function(e){var t=this,r=t.grid;if(Undef(e))e=prompt("Set width for column",t.width.replace(/[^0-9%]/g,""));if(!isNaN(parseInt(e))){t.width="width="+e;r.paint()}}}function CGCell(e,t,r){var i=this,a,l;i.row=e;i.col=t;i.state=0;i.isMark=0;i.isReadOnly=0;i.alignment="";i.b="";i.u="";i.i="";i.data=null;i.setData(r);a=i.row.grid.cellStyle;for(l in a)if(l.indexOf("Class")>-1)i[l]=a[l]}{var CCp=CGCell.prototype;CCp.callHandler=function(e){if(Def(this.handler))this.handler(e)};CCp.setData=function(data,isService){var t=this,f,err="",i,fa=t.col.filter,g=t.col.grid;if(Undef(isService))isService=t.col.isReadOnly||t.row.isReadOnly;switch(t.col.type){case"Date":if(Def(data)&&parseDate(data,DATE_FORMAT)==null){err=data;data=t.data}else data=parseDate(data,DATE_FORMAT);break;case"Image":break;case"Number":case"Currency":default:if(ua.oldB)eval("data = parse"+t.col.type+"(data)");else eval('try{eval("data = parse" + t.col.type + "(data)");}catch(e){};')}if(Def(err))alert("Can't parse data "+err+" as "+t.col.type+"!");if(t.row.grid.isInit&&data!=t.data){t.row.change=1;t.data=data;if(!isService){if(Def(t.row.userFunction))t.row.userFunction(g,t);if(Def(t.col.userFunction))t.col.userFunction(g,t);if(Def(g.userFunction))g.userFunction(g,t)}}t.data=data;if(g.isInit&&t.col.useAutoFilter&&fa.indexOf(t.getDataForFilter())==-1&&Def(t.data)&&typeof t.data!="unknown"){fa=t.col.filter;fa[fa.length]=t.getDataForFilter();fa.sort(compare);f=CT_fe(t.col.getID("filter"));if(Def(f))f.outerHTML=t.col.filterToHTML();if(ua.moz){t.row.grid.paint()}}};CCp.getData=function(){var t=this,data=t.data;if(Undef(t.data))data=DEFAULT_RESULT;else switch(t.col.type){case"URL":data=formatURL(t.data,"blank");break;case"String":case"Number":case"HTML":case"Email":if(ua.oldB)eval("data = format"+t.col.type+"(t.data)");else eval("try{eval('data = format' + t.col.type + '(t.data)');}catch(e){data = t.data};");break;case"Image":if(Def(t.data)&&t.data.constructor!=Object||ua.oldOpera)t.data=parseImage(t.data);data=formatImage(t.data);break;case"Date":case"Currency":default:if(ua.oldB)eval("data = format"+t.col.type+"(t.data, "+t.col.type.toUpperCase()+"_FORMAT)");else eval("try{eval('data = format' + t.col.type + '(t.data, ' + t.col.type.toUpperCase() + '_FORMAT)');}catch(e){data = t.data};");break}return data};CCp.getDataForEdit=function(){var e=this,t=e.data;if(Undef(e.data)||e.col.type=="Image")t="";else if(e.col.type=="Date")t=formatDate(e.data,DATE_FORMAT);return new String(t)};CCp.getDataForFilter=function(){var t=this,data=t.data;if(Undef(t.data))data="";else switch(t.col.type){case"Date":case"Currency":if(ua.oldB)eval("data = format"+t.col.type+"(t.data, "+t.col.type.toUpperCase()+"_FORMAT)");else eval("try{eval('data = format' + t.col.type + '(t.data, ' + t.col.type.toUpperCase() + '_FORMAT)');}catch(e){data = t.data};");break;case"Image":if(t.data.src.indexOf("undefined")<0){start=(t.data.src.lastIndexOf("/")<0?t.data.src.lastIndexOf("\\"):t.data.src.lastIndexOf("/"))+1;data=t.data.src.slice(start)}else data="No image";default:data=t.data}return new String(data)};CCp.compareTo=function(e){return this.col.compareFunction(this.data,e.data)};CCp.toString=function(){return"Cell ["+this.row._id+"; "+this.col._id+"]"};CCp.getID=function(){var e=this;return e.row.grid.getID("cell")+e.row._id+"_"+e.col._id};CCp.getEditControl=function(){var e=this,t,r,i=e.getDataForEdit();if(e.isReadOnly||e.row.isReadOnly||e.col.isReadOnly||e.col.type=="Image"){e.state=1;return e.getData()}else{switch(e.col.type){case"Date":t="<input id='cell' name='cell' type='text' style='width:100%;' value=\""+i+"\" maxlength='"+DATE_FORMAT.length+"' onblur='CodeThatGrids[\""+e.row.grid.name+"\"].curCell.setData(this.value)'>";break;case"Currency":case"Number":t="<input id='cell' name='cell' type='text' style='width:100%;' value=\""+i+"\" maxlength='10' onblur='CodeThatGrids[\""+e.row.grid.name+"\"].curCell.setData(this.value)'>";break;case"String":case"HTML":case"Email":case"URL":default:t="<textarea id='cell' name='cell' rows=1 cols=1 style='width:100%;height:100%' onblur='CodeThatGrids[\""+e.row.grid.name+"\"].curCell.setData(this.value);'>"+i+"</textarea>";break}}return t};CCp.setState=function(e){var t=this,r=CT_fe("cell");rng.length=0;if(Def(r)&&t.state==2)t.setData(r.value);t.state=e;t.paint()};CCp.setMark=function(e){var t=this;if(Undef(e))e=!t.isMark;t.isMark=e;t.paint()};CCp.setStyle=function(e,t){var r=this;switch(e){case"b":if(Def(r.b))r.b="";else r.b="bold";break;case"i":if(Def(r.i))r.i="";else r.i="italic";break;case"u":if(Def(r.u))r.u="";else r.u="underline";break;case"alignment":r.alignment=t;break}r.paint(0)};CCp.getStyle=function(){var e=this,t="";if(Def(e.b))t+="font-weight:bold;";if(Def(e.i))t+="font-style:italic;";if(Def(e.u))t+="text-decoration:underline;";if(Def(e.alignment))t+="text-align:"+e.alignment+";";if(Def(t))t="style='"+t+"'";return t};CCp.paint=function(e){var t=this,r=t.row.grid,i=1,a=1,l=CT_fe(t.getID()),o=t.row.markClass,n=t.col.markClass,s=t.row.defaultClass,f=t.col.defaultClass;if(Undef(e))e=1&&r.useRCID;if(e){i=CT_fe(t.row.getID("row"));a=CT_fe(t.col.getID("col"))}if(Undef(l)||Undef(i)||Undef(a))return;l.style.fontWeight=t.b;l.style.fontStyle=t.i;l.style.textDecoration=t.u;l.style.textAlign=t.alignment;switch(t.state){case 0:CT_css(l,t.isMark?t.markClass:t.defaultClass);CT_HTML(l,t.getData());if(e){CT_css(i,t.isMark?o:s);CT_css(a,t.isMark?n:f)};break;case 1:CT_css(l,t.currClass);if(e){CT_css(i,o);CT_css(a,n)};CT_HTML(l,t.getData());break;case 2:CT_HTML(l,t.getEditControl());l=CT_fe("cell");if(Def(l)){if(ua.moz)l.setAttribute("autocomplete","off");l.value=t.getDataForEdit();l.focus()};break}if(e)r.paintBar("sb")}}var isShift=0,isCtrl=0,CCG,CodeThatGrids=[],re="class=",rng=[],w=null,curId=0;var dfp={fontfamily:"Verdana, Arial",fontsize:"12px"},crp={borderwidth:"1",borderstyle:"outset",bordercolor:"#cccccc"},clp={borderstyle:"solid"},dbp={fontfamily:"Verdana, Arial",fontsize:"11px",backgroundcolor:"#D4D0C8"};function CT_fe(e){return CodeThat.findElement(e)}function CT_reh(e,t,r){CodeThat.regEventHandler(e,t,r)}function CT_regEvents(e,t){CT_reh("click",CT_onMouseEvent,CT_fe(e));CT_reh("dblclick",CT_onMouseEvent,CT_fe(e));CT_reh("keydown",CT_onKeyPress);CT_reh("selectstart",CT_onSelect,CT_fe(e));CT_reh("mousemove",CT_onMouseMove);CT_reh("mousedown",CT_onMouseEvent);CT_reh("mouseup",CT_onMouseEvent);CT_reh("dragend",CT_onDrag,CT_fe(e));CT_reh("dragover",CT_onDragOver,CT_fe(e));CT_reh("dragover",CT_onDragOver,CT_fe(t))}function CT_onDrag(e){var t=ua.moz?e._e.target:e._e.srcElement;var r,i=t.id,a=curId,l,o;if(Undef(a)||Undef(i))return;if(Undef(CCG)){var r=CT_getParent(t);if(Undef(r.id))return;CCG=CodeThatGrids[r.id]}if(Undef(CCG))return;if(a.indexOf("col")>-1&&i.indexOf("col")>-1){a=a.replace(new RegExp(CCG.name),"").replace(/[^0-9]/gi,"");i=i.replace(new RegExp(CCG.name),"").replace(/[^0-9]/gi,"");l=CCG.cIdx.indexOf(i);o=CCG.cIdx.indexOf(a);CCG.cIdx.remove(l);CCG.cIdx.insert(i,o)}if(a.indexOf("row")>-1&&i.indexOf("row")>-1){a=a.replace(new RegExp(CCG.name),"").replace(/[^0-9]/gi,"");i=i.replace(new RegExp(CCG.name),"").replace(/[^0-9]/gi,"");l=CCG.rIdx.indexOf(i);o=CCG.rIdx.indexOf(a);CCG.rIdx.remove(l);CCG.rIdx.insert(i,o);CCG.vr.length=0}if(a.indexOf("pt")>-1&&i.indexOf("row")>-1){i=i.replace(new RegExp(CCG.name),"").replace(/[^0-9]/gi,"");l=CCG.rIdx.indexOf(i);o=(a.replace(new RegExp(CCG.name),"").replace(/[^0-9]/gi,"")-1)*CCG.amountPerPage;a=CCG.rIdx[o];CCG.rIdx.remove(l);CCG.rIdx.insert(i,o);CCG.vr.length=0}curId="";CCG.paint()}function CT_onDragOver(e){var t=ua.moz?e._e.target:e._e.srcElement;curId=t.id}function CT_onSelect(e){var t=ua.moz?e._e.target:e._e.srcElement;if(t.id!="cell")return false}function CT_onMouseMove(e){var t=ua.moz?e._e.target:e._e.srcElement;if(Undef(t.id)||Undef(CCG))return;var r=t.id.replace(new RegExp(CCG.name),"").replace(/[^0-9_]/gi,""),i,a,l,o;if(Undef(r)||r.indexOf("_")==-1||rng.length<2)return;i=r.slice(0,r.indexOf("_"));a=rng[0];l=r.slice(r.indexOf("_")+1);o=rng[1];i=CCG.rIdx.indexOf(i);a=CCG.rIdx.indexOf(a);l=CCG.cIdx.indexOf(l);o=CCG.cIdx.indexOf(o);CCG.msg="Selection: "+(1+Math.abs(i-a))+"R x "+(1+Math.abs(l-o))+"C";CCG.paintBar("sb")}function CT_onMouseEvent(e){isShift=e._e.shiftKey;isCtrl=e._e.ctrlKey;var t=ua.moz?e._e.target:e._e.srcElement;if(Undef(t.id)&&ua.moz)t=t.parentNode;var r=CT_getParent(t);if(Undef(t.id)||Undef(r.id)){rng.length=0;return}if(Def(CCG)&&CCG!=CodeThatGrids[r.id]&&CCG.curCell)CCG.curCell.setState(1);CCG=CodeThatGrids[r.id];if(Undef(CCG)){rng.length=0;return}var i=t.id.replace(new RegExp(CCG.name),"").replace(/[^0-9_]/gi,""),a=-1,l=-1,o=-1;if(Undef(i))return;if(i.indexOf("_")>-1){a=i.slice(0,i.indexOf("_"));l=i.slice(i.indexOf("_")+1);o=0}else{if(t.id.indexOf("col")>-1){l=i;o=1}if(t.id.indexOf("row")>-1){l=i;o=2}if(t.id.indexOf("title")>-1){l=i;o=4}}switch(o){case 0:e._o=CCG.cells[a][l];CCG.cells[a][l].callHandler(e);break;case 2:e._o=CCG.rows[l];CCG.rows[l].callHandler(e);break;case 1:e._o=CCG.cols[l];CCG.cols[l].callHandler(e);break}switch(e._e.type){case"click":switch(o){case 0:break;case 1:case 2:CCG.setMarkRange(l,o);break;case 4:CCG.cols[l].setTitle()};break;case"dblclick":switch(o){case 0:CCG.setCurCell(CCG.cells[a][l]);CCG.cells[a][l].setState(2);break;case 1:CCG.cols[l].setWidth();break;case 2:CCG.rows[l].setHeight();break};break;case"mousedown":if(o!=0)return;CCG.setCurCell(CCG.cells[a][l]);if(CCG.cells[a][l].state!=2)rng=[a,l];break;case"mouseup":if(o!=0||rng.length<2){rng.length=0;return}CCG.setMarkRange(rng.concat([a,l]),3);CCG.msg="";CCG.paintBar("sb");rng.length=0;break}}function CT_onKeyPress(e){if(Def(CCG)){CCG.onKeyPress(e)}}function CT_getParent(e){while(Def(e)&&Def(e.tagName)&&e.tagName.toLowerCase()!="div"&&e.tagName.toLowerCase()!="body"){e=ua.ie?e.parentElement:e.parentNode}return e}{var a=Array.prototype;a.insert=function(e,t){var r=this,i;r[r.length]=e;if(t<r.length-1){for(i=r.length-1;i>t;i--)r[i]=r[i-1];r[t]=e}};a.remove=function(e){var t=this,r;if(e<t.length-1)for(r=e;r<t.length-1;r++){t[r]=t[r*1+1];if(Def(t[r]._id))t[r]._id=r}t.length--}}function makeRE(e){var t=["\\","/",".","^","+","*","?","$","|","(",")","{","}"],r;for(r=0;r<t.length;r++)e=e.replace(new RegExp("\\"+t[r],"ig"),"\\"+t[r]);return e}function merge(e){var t,r,i={};if(e.constructor!=Array)e=new Array(e);for(t=0;t<e.length;t++)for(r in e[t])i[r]=e[t][r];return i}
//# sourceMappingURL=codethatgridpro.min.js.map
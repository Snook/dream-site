{"version":3,"file":"order_mgr_delivered.min.js","names":["itemChanges","discountOrPaymentChanges","deliveryChanges","discountChanges","reportingChanges","paymentChanges","changeList","currentlySavingOrder","intenseLoggingOn","boxesDeletedFromActiveOrder","needPlatePointsMaxDiscountChangeWarning","lastMaxPPDiscountAmount","admin_order_mgr_init","store_id","STORE_DETAILS","id","orderState","setupForNewOrder","setupForSavedOrder","setupForActiveOrder","initChangeList","init_inside_box_editing","calculateTotal","setAllPaymentFieldsToUnrequired","setupCouponState","setUpKeyHandlers","handle_special_instruction_notes","handle_cancel_order_delivered","handle_delete_saved_order_delivered","handle_free_menu_item_edit","handleDirectOrderDiscountFocusing","$","trigger","updateInventory","handle_is_gift","handleSessionSelection","on","doReschedule","this","data","is","show","hide","validateBoxes","hasAtLeastOneBox","noCustomBoxesAreIncomplete","each","list_id","split","itemCount","filter","val","countItemsInBox","box_instance_id","retVal","off","itemError","boxError","box_inst_id","number_items_required","newQty","curTotal","delta","isNaN","Math","floor","lastQty","servings","recipeID","new_servings_needed","current_inventory","html","updateChangeList","dd_message","title","message","addToInitialInventory","curAmount","adjInv","initial_inventory","Object","assign","recipe_id","focus","e","length","select","blur","curVal","trim","intenseLogging","window","console","log","saveSpecialInstructions","special_instructions","strip_tags","ajax","url","type","timeout","dataType","processor","user_id","op","order_id","success","json","processor_success","updateInstructionsOrgValues","processor_message","error","objAJAXRequest","strError","responseText","response","booking_id","do_op","do","note","textarea_elem","addClass","special_instruction_note","removeClass","nl2br","document","onkeypress","OMDefaultKeyHandler","evt","event","charCode","which","keyCode","processCode","stopPropagation","lastCheckedGiftCertNumber","getChangeListHTML","height","width","modal","div_id","dialogClass","noOk","position","my","at","of","close","ui","remove","updateItemsOrgValues","saveAll","saveItems","saveDiscountsUponCompletion","activateOnSaveDiscountsCompletion","dd_toast","boxList","subtotal_delivery_fee","items","itemTabIsDirty","saveDiscounts","setShipToAddressAndSaveOrder","shipping_data","order_state","bounce","Reschedule","org_session_id","session_id","saved_booking_id","new_session_id","new_session_time","new_ship_time","RetrieveCalendar","onSaveItems","HideLineItemsIfZero","getQueryVariable","attr","discountEligable","limited_access","click","find","prop","isDeliveryAddressComplete","validated","onDeliveryTabSelected","onDeliveryTabDeselected","onSessionTabSelected","onSessionTabDeselected","onItemsTabSelected","onItemsTabDeselected","onPaymentTabSelected","onPaymentTabDeselected","onNotesTabSelected","handle_guest_account_notes","handle_admin_carryover_notes","handle_admin_order_notes","onNotesTabDeselected","onPaymentSelected","onPaymentDeselected","updateDiscountOrgValues","_validate_discounts","_validate_address","validationSuccess","payOnCompletion","direct_order_discount","dinner_dollars_discount","coupon_id","plate_points_discount","updateReportingOrgValues","onAddPaymentAndActivate","paymentToken","getPaymentData","payment_number","paymentData","number","amount","cert_type","ccNameOnCard","ccType","ccMonth","ccYear","cc_security_code","billing_address","billing_postal_code","is_store_specific_flat_rate_deposit_delayed_payment","do_not_ref","save_card","DPSetting","alert","indexOf","reference_id","validatePayment1","inputArray","validates","substr","_check_elements","depositWarningStr","store_specific_deposit","validatePayment2","addPaymentAndActivate","getAbbreviatedSummaryString","confirm","save2PaymentsAndBookOrder","payment2Type","payment1Data","token","payment2Data","supports_transparent_redirect","billing_name","billing_zip","amt","async","dd_csrf_token","chain_token","getTokenToken","send","warnOfOutstandingSavedOrdersOnFullSession","DP_State","max_plate_points_deduction","payment_data","add_payment_data","delay_remainder","savePayment2","handleDirectPayment","addOnly","go_to_confirm","payment1Type","displayModalWaitDialog","use_store_credits","store_credit_amount","mainPaymentData","additionalPaymentData","store_credits_amount","closeOnEscape","buttons","Refresh","location","href","timestamp","action","cur_session_id","service_days","service_days_for_current_zip","onDayClick","obj","sessionTime","curSessionDate","open","siblings","onRescheduleClick","isDiscounted","control_message","onSessionClick","monthChange","monthVal","handleSummaryDisplayChange","checked","ShowAllLineItems","deliveryFeeOrg","Number","deliveryFee","doDiscountOrg","doDiscount","couponDiscountOrg","couponDiscount","membershipDiscountOrg","membershipDiscount","foodTaxOrg","foodTax","nonFoodTaxOrg","nonFoodTax","deliveryTaxOrg","deliveryTax","ddOrg","dd","sort_by_price","a","b","price","drawChangeList","htmlStr","first","editedExistingBoxHTML","existingNewBoxHTML","thisBox","box_contents","hasOwnProperty","tempHTML","thisItem","item_name","boxes","hadMiscCostChanges","item","miscCosts","getHumanReadableName","formatAsMoney","miscDescs","order_type","discounts","reporting","coupon","change_type","ccRefundTotal","parseFloat","descIDStr","desc","discountsHTML","valueOf","showSaveButton","box_inst","stdMenuItems","FTMenuItems","bundleItems","delivery","current_box_ids","curQty","savedQty","menu_item_id","orgVal","undefined","newVal","diff","orgCouponVal","curCouponVal","handleAutoAdjust","balance","canAdjustDelayedPayment","currentDPAmount","changePayment1","adjustPendingDelayedPayment","assignBalanceToRefTransactions","ident","existingPaymentAmountArray","reportPaymentStatus","getAbbreviatedChangeString","addPaymentToLockedOrder","submitPage","form","confirm_and_check_form","dialogHeight","updateActiveOrder","name","value","JSON","stringify","appendTo","submit","resetPage","_check_form","dd_round_amount","inAmount","tempVal","parseInt","total","discounted_total","main_items_count","num_boxes","x","entreeIDToInventoryMap","remaining","org_remaining","cost","items_in_box","servings_in_box","round","newGrandTotal","pre_discounts_grand_total","directDiscountVal","directDiscount","discountablePlatePointsAmount","handleDinnerDollars","couponDiscountMethod","CouponCodeStr","newDiscountAmount","formatterUSD","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","couponDiscountVar","couponlimitedToFT","newDiscountVal","couponDiscountVal","couponDiscountValIsServiceFee","couponDiscountValIsDeliveryFee","limit_to_mfy_fee","discount_method","currentServiceFee","limit_to_delivery_fee","currentDeliveryFee","discount_var","limit_to_core","base","limit_to_core_and_efl","eflItemsSubtotal","limit_to_finishing_touch","limit_to_recipe_id","prc_str","text","curPPDiscount","orderIsEligibleForMembershipDiscount","storeSupportsMembership","couponAdjustment","membership_discount_basis","memberDiscountAmount","membership_status","newDeliveryTax","curDeliveryTax","newFoodTax","newServiceTax","food_portion_of_points_credit","fee_portion_of_points_credit","discountMFYFeeFirst","foodPortionOfMaxDeduction","curFoodTax","mealCustomizationFee","curServiceTax","taxElem","getElementById","innerHTML","preTaxTotal","orderInfoGrandTotal","paymentTotal","remainingBalance","changePayment2","defaultPaymentAmount","amountStoreCredit","payment1Amount","autoAdjustDiv","canAutoAdjust","forceManualAutoAdjust","get","maxPPCredit","maxPPDeduction","platePointsDiscountOrg","platePointsDiscount","bundle_id","box_id","box_type","box_label","menu_id","append","newDeliveryFee","bundle_info","price_shipping","preventDefault","hideFlex","showFlex","address_id","address","firstname","lastname","address_line1","address_line2","city","state_id","postal_code","address_note","telephone_1","email_address"],"sourceRoot":"js/src/dreamdinners/admin","sources":["order_mgr_delivered.js"],"sourcesContent":["var itemChanges = false;\nvar discountOrPaymentChanges = false;\nvar deliveryChanges = false;\nvar discountChanges = false;\nvar reportingChanges = false;\nvar paymentChanges = false;\nvar changeList = null;\nvar currentlySavingOrder = false;\nvar intenseLoggingOn = true;\nvar boxesDeletedFromActiveOrder = []; // for showing box deletions in change list\n\nvar needPlatePointsMaxDiscountChangeWarning = false;\nvar lastMaxPPDiscountAmount = -1;\n\nfunction admin_order_mgr_init()\n{\n\n\tif (store_id != STORE_DETAILS.id)\n\t{\n\t\tSTORE_DETAILS.id = store_id;\n\n\t\t//STORE_DETAILS.id is either the current fadmin store - in which case a match is guaranteed or\n\t\t// is the current Site Admin store (last selection from a store drop down.) However in this case if the order was accessed by the address\n\t\t// bar a match is not guaranteed so force STORE_DETAILS.id to store_id which is always the store of the order\n\t}\n\n\tif (orderState == 'NEW')\n\t{\n\t\tsetupForNewOrder();\n\t}\n\telse if (orderState == 'SAVED')\n\t{\n\t\tsetupForSavedOrder();\n\t}\n\telse\n\t{\n\t\tsetupForActiveOrder();\n\t}\n\n\tinitChangeList();\n\tinit_inside_box_editing();\n\n\tif (orderState != 'NEW')\n\t{\n\t\tcalculateTotal();\n\t\tsetAllPaymentFieldsToUnrequired();\n\t\tsetupCouponState();\n\t}\n\n\tsetUpKeyHandlers();\n\n\thandle_special_instruction_notes();\n\thandle_cancel_order_delivered();\n\thandle_delete_saved_order_delivered();\n\n\thandle_free_menu_item_edit();\n\thandleDirectOrderDiscountFocusing();\n\n\t$('#shipping_phone_number').trigger('change');\n\n\tupdateInventory();\n\n\thandle_is_gift();\n\n}\n\nfunction handleSessionSelection()\n{\n\t$(\"[data-select_delivery_day]\").on('click', function () {\n\t\tlet selected_session_id = $(this).data(\"select_delivery_day\");\n\t\tlet sessionDate = $(this).data(\"date\");\n\t\tdoReschedule(selected_session_id, sessionDate);\n\t});\n\n}\n\nfunction handle_is_gift()\n{\n\tif ($(\"#shipping_is_gift\").is(':checked'))\n\t{\n\t\t$(\".shipping_email_address_div\").show();\n\t}\n\telse\n\t{\n\t\t$(\".shipping_email_address_div\").hide();\n\t}\n\n\t$(\"#shipping_is_gift\").on('change', function () {\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\t$(\".shipping_email_address_div\").show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\".shipping_email_address_div\").hide();\n\t\t}\n\t});\n\n}\n\nfunction validateBoxes()\n{\n\tlet hasAtLeastOneBox = false;\n\tlet noCustomBoxesAreIncomplete = true;\n\n\t$(\"[id^='box_inst_id_']\").each(function () {\n\t\tlet list_id = this.id.split(\"_\")[3];\n\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\n\t\t{\n\t\t\thasAtLeastOneBox = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\thasAtLeastOneBox = true;\n\n\t\t\tlet itemCount = 0;\n\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\n\t\t\t\titemCount += ($(this).val() * 1);\n\t\t\t});\n\n\t\t\tlet number_items_required = $(\"#box_inst_id_\" + list_id).data(\"number_items_required\");\n\n\t\t\tif (number_items_required != itemCount)\n\t\t\t{\n\t\t\t\tnoCustomBoxesAreIncomplete = false;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn (hasAtLeastOneBox && noCustomBoxesAreIncomplete);\n}\n\nfunction countItemsInBox(box_instance_id)\n{\n\tlet retVal = 0;\n\t$(\"[id^='qty_\" + box_instance_id + \"_']\").each(function () {\n\t\tretVal += ($(this).val() * 1);\n\t});\n\n\treturn retVal;\n}\n\nfunction init_inside_box_editing()\n{\n\n\t$(\"[id^='qty_']\").off('click', function () {\n\n\t});\n\n\t$(\"[id^='qty_']\").on('change', function () {\n\t\tlet itemError = false;\n\t\tlet boxError = false;\n\n\t\tlet menu_item_id = this.id.split(\"_\")[2];\n\t\tlet box_inst_id = this.id.split(\"_\")[1];\n\t\tlet number_items_required = $(\"#box_inst_id_\" + box_inst_id).data(\"number_items_required\");\n\t\tlet newQty = $(this).val();\n\n\t\tlet curTotal = countItemsInBox(box_inst_id);\n\t\tif (curTotal > number_items_required)\n\t\t{\n\t\t\tlet delta = curTotal - number_items_required;\n\t\t\t$(this).val(newQty - delta);\n\t\t\tboxError = true;\n\t\t}\n\n\t\tnewQty = $(this).val();\n\n\t\tif (isNaN(newQty))\n\t\t{\n\t\t\tnewQty = 0;\n\t\t\t$(this).val(0);\n\t\t}\n\t\tif (newQty < 0)\n\t\t{\n\t\t\tnewQty = 0;\n\t\t\t$(this).val(0);\n\t\t}\n\n\t\tif (newQty - Math.floor(newQty) != 0)\n\t\t{\n\t\t\tnewQty = Math.floor(newQty);\n\t\t\t$(this).val(newQty);\n\t\t}\n\n\t\tlet lastQty = $(this).data('last_qty'); // last quantity is already removed from current_inventory array\n\t\tvar servings = $(this).data('servings_per_item');\n\t\tvar recipeID = $(this).data('recipe_id');\n\n\t\tif (newQty > 2)\n\t\t{\n\t\t\titemError = true;\n\t\t\t$(this).val(2);\n\t\t\tnewQty = 2;\n\t\t}\n\n\t\tlet new_servings_needed = (newQty - lastQty) * servings;\n\n\t\twhile (new_servings_needed > current_inventory[recipeID])\n\t\t{\n\t\t\tnewQty--;\n\t\t\tnew_servings_needed = (newQty - lastQty) * servings;\n\t\t}\n\n\t\t$(this).val(newQty);\n\t\t$(this).data('last_qty', newQty);\n\t\tcurrent_inventory[recipeID] -= new_servings_needed;\n\n\t\t$(\"[id^='inv_']\").filter(\"[data-recipe_id='\" + recipeID + \"']\").html(current_inventory[recipeID] + \"/serv\");\n\n\t\tupdateChangeList();\n\n\t\tif (boxError && itemError)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: \"Each box can only have up to 2 of the same menu item and a total of \" + number_items_required + \" items.\"\n\t\t\t});\n\t\t}\n\t\telse if (itemError)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: \"Each box can only have up to 2 of the same menu item\"\n\t\t\t});\n\t\t}\n\t\telse if (boxError)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: \"You can only add a total of \" + number_items_required + \" items to this box.\"\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction addToInitialInventory(list_id)\n{\n\n\tif ($(this).data(\"contents_are_fixed\") == true)\n\t{\n\t\t$(\"[id^='qty_\" + list_id + \"_']\").each(function () {\n\t\t\tvar curAmount = $(this).val();\n\t\t\tvar recipeID = $(this).data('recipe_id');\n\t\t\tvar servings = $(this).data('servings_per_item');\n\t\t\tvar curInv = initial_inventory[recipeID];\n\t\t\tvar adjInv = curInv + (curAmount * servings);\n\t\t\tinitial_inventory[recipeID] = adjInv;\n\t\t});\n\t}\n\telse\n\t{\n\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\n\t\t\tvar curAmount = $(this).val();\n\t\t\tvar recipeID = $(this).data('recipe_id');\n\t\t\tvar servings = $(this).data('servings_per_item');\n\t\t\tvar curInv = current_inventory[recipeID];\n\t\t\tvar adjInv = curInv + (curAmount * servings);\n\t\t\tinitial_inventory[recipeID] = adjInv;\n\t\t});\n\t}\n}\n\n$(document).on('click', '.add_box', function (e) {\n\n\tlet bundle_id = $(this).data(\"bundle_id\");\n\tlet box_id = $(this).data(\"box_id\");\n\tlet box_type = $(this).data(\"box_type\");\n\tlet box_label = $(this).data(\"box_label\");\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\top: 'add_box',\n\t\t\tbundle_id: bundle_id,\n\t\t\tbox_id: box_id,\n\t\t\tbox_type: box_type,\n\t\t\tbox_label: box_label,\n\t\t\tmenu_id: menu_id,\n\t\t\tstore_id: store_id,\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$(\"#box_editor\").append(json.html);\n\n\t\t\t\tlet currentDeliveryFee = $('#subtotal_delivery_fee').val();\n\t\t\t\tlet newDeliveryFee = Number(formatAsMoney(currentDeliveryFee)) + Number(formatAsMoney(json.bundle_info.price_shipping));\n\n\t\t\t\t$('#subtotal_delivery_fee').val(newDeliveryFee);\n\n\t\t\t\tupdateInventory();\n\t\t\t\tcalculateTotal();\n\t\t\t\tinit_inside_box_editing();\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n});\n\n$(document).on('click', '.box-delete', function (e) {\n\n\te.preventDefault();\n\tlet box_inst_id = $(this).data('box_instance_id');\n\t//let price_shipping = $(this).data('price_shipping');\n\n\tlet currentDeliveryFee = $('#subtotal_delivery_fee').val();\n\tlet newDeliveryFee = Number(formatAsMoney(currentDeliveryFee)) - Number(formatAsMoney($(\"#box_inst_id_\" + box_inst_id).data('price_shipping')));\n\n\tif (orderState == 'ACTIVE')\n\t{\n\n\t\t$('#subtotal_delivery_fee').val(newDeliveryFee);\n\n\t\t// active orders defer database updates until finalized\n\t\taddToInitialInventory(box_inst_id);\n\t\tboxesDeletedFromActiveOrder[box_inst_id] = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\n\t\t$(\"#bi_\" + box_inst_id).remove();\n\t\tupdateInventory();\n\t\tcalculateTotal();\n\t\treturn;\n\t}\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\top: 'delete_box',\n\t\t\tbox_inst_id: box_inst_id,\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id\n\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$(\"#bi_\" + box_inst_id).remove();\n\n\t\t\t\t$('#subtotal_delivery_fee').val(newDeliveryFee);\n\n\t\t\t\tupdateInventory();\n\t\t\t\tcalculateTotal();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\t});\n\n});\n\nfunction updateInventory()\n{\n\n\t// re init current values\n\tcurrent_inventory = Object.assign({}, initial_inventory);\n\n\t// loop through all existing boxes and accumulate values in current_inventory\n\t// after items have been accumulated push numbers to the display\n\n\t$(\"[id^='box_inst_id_']\").each(function () {\n\n\t\tlet list_id = this.id.split(\"_\")[3];\n\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\n\t\t{\n\t\t\t$(\"[id^='qty_\" + list_id + \"_']\").each(function () {\n\t\t\t\tvar curAmount = $(this).val();\n\t\t\t\tvar claimedAmount = $(this).data('claimed_qty');\n\t\t\t\tcurAmount -= claimedAmount;\n\t\t\t\tvar recipeID = $(this).data('recipe_id');\n\t\t\t\tvar servings = $(this).data('servings_per_item');\n\t\t\t\tvar curInv = current_inventory[recipeID];\n\t\t\t\tvar adjInv = curInv - (curAmount * servings);\n\t\t\t\tcurrent_inventory[recipeID] = adjInv;\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\n\t\t\t\tvar curAmount = $(this).val();\n\t\t\t\tvar claimedAmount = $(this).data('claimed_qty');\n\t\t\t\tcurAmount -= claimedAmount;\n\t\t\t\tvar recipeID = $(this).data('recipe_id');\n\t\t\t\tvar servings = $(this).data('servings_per_item');\n\t\t\t\tvar curInv = current_inventory[recipeID];\n\t\t\t\tvar adjInv = curInv - (curAmount * servings);\n\t\t\t\tcurrent_inventory[recipeID] = adjInv;\n\t\t\t});\n\t\t}\n\t});\n\n\tfor (const recipe_id in current_inventory)\n\t{\n\n\t\t$(\"[id^='inv_']\").filter(\"[data-recipe_id='\" + recipe_id + \"']\").each(function () {\n\n\t\t\t// TODO:  item < serving per item is also out of stock\n\t\t\tif (current_inventory[recipe_id] == 0)\n\t\t\t{\n\t\t\t\t$(this).html('Out of stock');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(this).html(current_inventory[recipe_id] + \"/serv\");\n\t\t\t}\n\t\t});\n\n\t}\n\n}\n\nfunction handleDirectOrderDiscountFocusing()\n{\n\n\t$(\"#plate_points_discount, #direct_order_discount\").focus(function (e) {\n\n\t\tif ($(this).val() == 0)\n\t\t{\n\t\t\t$(this).val(\"\");\n\t\t}\n\t\tif ($(this).val().length > 0)\n\t\t{\n\t\t\t$(this).select();\n\t\t}\n\t});\n\n\t$(\"#plate_points_discount, #direct_order_discount\").blur(function (e) {\n\n\t\tvar curVal = $(this).val();\n\t\tcurVal = (curVal.trim());\n\n\t\tif (curVal == \"\" || isNaN(curVal))\n\t\t{\n\t\t\t$(this).val(\"0\");\n\t\t}\n\n\t});\n\n}\n\nfunction intenseLogging(message)\n{\n\tif (window.console && intenseLoggingOn)\n\t{\n\t\tconsole.log('OM Intense logging: ' + message);\n\t}\n}\n\nfunction saveSpecialInstructions()\n{\n\n\tvar special_instructions = strip_tags($(\"#order_user_notes\").val());\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_special_instructions',\n\t\t\torder_id: order_id,\n\t\t\tspecial_instructions: special_instructions\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tupdateInstructionsOrgValues();\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveSpecialInstructions: \" + json.processor_message);\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tintenseLogging(\"saveSpecialInstructions: \" + strError + \" | \" + objAJAXRequest.responseText);\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\t});\n}\n\nfunction handle_special_instruction_notes()\n{\n\t$('[id^=\"gd_special_instruction_note_button-\"]').each(function () {\n\n\t\t$(this).on('click', function (e) {\n\n\t\t\tvar booking_id = $(this).data('booking_id');\n\t\t\tvar user_id = $(this).data('user_id');\n\t\t\tvar do_op = 'get';\n\t\t\tvar special_instructions = '';\n\n\t\t\tif ($(this).data('edit_mode') == true)\n\t\t\t{\n\t\t\t\tdo_op = 'save';\n\n\t\t\t\tspecial_instructions = strip_tags($('#gd_special_instruction_note-' + booking_id + ' > textarea').val());\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\turl: '/processor',\n\t\t\t\ttype: 'POST',\n\t\t\t\ttimeout: 20000,\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\t\t\top: 'update_special_instructions',\n\t\t\t\t\t'do': do_op,\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\t\tuser_id: user_id,\n\t\t\t\t\torder_id: order_id,\n\t\t\t\t\tnote: special_instructions\n\t\t\t\t},\n\t\t\t\tsuccess: function (json) {\n\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (do_op == 'get')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar textarea_elem = $('<textarea></textarea>').addClass('form-control').val((json.special_instruction_note ? json.special_instruction_note : \"\")).on('keyup', function (e) {\n\n\t\t\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).addClass('special_instruction_note_edit').html(textarea_elem);\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', true).html('Save Note');\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).data('special_instruction_note_value', (json.special_instruction_note ? json.special_instruction_note : \"\")).on('click', function (e) {\n\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + $(this).data('booking_id')).removeClass('special_instruction_note_edit').html($(this).data('special_instruction_note_value'));\n\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + $(this).data('booking_id')).data('edit_mode', false).html('Special Instructions');\n\n\t\t\t\t\t\t\t\t$(this).hide();\n\n\t\t\t\t\t\t\t}).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).removeClass('special_instruction_note_edit').html(nl2br(json.special_instruction_note));\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).hide();\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', false).html('Special Instructions');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t\tintenseLogging(\"handle_special_instruction_notes: \" + strError + \" | \" + objAJAXRequest.responseText);\n\t\t\t\t\tresponse = 'Unexpected error';\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\n\t});\n}\n\nfunction setUpKeyHandlers()\n{\n\tdocument.onkeypress = OMDefaultKeyHandler;\n\n\t$(\"#coupon_code\").on('keypress', function (evt) {\n\t\t// the enter key will submit a coupon code\n\t\tevt = (evt) ? evt : event;\n\t\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\t\tif (charCode == 13)\n\t\t{\n\t\t\tprocessCode();\n\t\t\tevt.stopPropagation();\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t});\n\n\t$(\"#order_user_notes\").on('keypress', function (evt) {\n\t\tevt.stopPropagation();\n\t\treturn true;\n\t});\n\n\t$(\"#payment1_gc_payment_number\").on('keyup', function (evt) {\n\n\t\tif ($(this).val().length == 15 && !isNaN($(this).val()) && $(this).val() != lastCheckedGiftCertNumber)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Warning',\n\t\t\t\tmessage: \"It appears that you may be entering a gift Card number. If so, select Gift Card from payment selector. This is the Certificate (Gift Certificate) payment type.\"\n\t\t\t});\n\t\t}\n\n\t\tlastCheckedGiftCertNumber = $(this).val();\n\n\t\treturn true;\n\t});\n\n}\n\nfunction OMDefaultKeyHandler(evt)\n{\n\t// by default the document just eats the enter key\n\tevt = (evt) ? evt : event;\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nfunction initChangeList()\n{\n\t$(\"#changeListTab\").on('click', function () {\n\n\t\tvar html = getChangeListHTML();\n\n\t\tif (!html || html == \"\")\n\t\t{\n\t\t\thtml = \"<h3><i>No Changes</i></h3>\"\n\t\t}\n\n\t\tdd_message({\n\t\t\ttitle: 'Change List',\n\t\t\tmessage: html,\n\t\t\theight: 620,\n\t\t\twidth: 300,\n\t\t\tmodal: false,\n\t\t\tdiv_id: 'changelist',\n\t\t\tdialogClass: 'fixedDialog',\n\t\t\tnoOk: true,\n\t\t\tposition: {\n\t\t\t\tmy: \"left top\",\n\t\t\t\tat: \"left bottom\",\n\t\t\t\tof: this\n\t\t\t},\n\t\t\tclose: function (event, ui) {\n\t\t\t\t$(\"#changelist\").remove();\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction updateItemsOrgValues()\n{\n\t// TODO\n\tupdateChangeList();\n}\n\nfunction saveAll()\n{\n\tsaveItems(true, false, true);\n}\n\nfunction saveItems(saveDiscountsUponCompletion, activateOnSaveDiscountsCompletion)\n{\n\n\tintenseLogging(\"saveItems() called\");\n\n\tif (currentlySavingOrder)\n\t{\n\t\tdd_toast({\n\t\t\tmessage: 'Items are still being saved',\n\t\t\tposition: 'topcenter'\n\t\t});\n\t\treturn;\n\t}\n\n\tdd_toast({\n\t\tmessage: 'Items Saved',\n\t\tposition: 'topcenter'\n\t});\n\n\tif (activateOnSaveDiscountsCompletion)\n\t{\n\t\tif (!validateBoxes())\n\t\t{\n\t\t\t$(\"#activate_confirm\").remove();\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Problem with boxes',\n\t\t\t\tmessage: \"Please review the selected box(es) and ensure item counts are correct.\"\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t}\n\tvar boxList = {};\n\n\t$(\"[id^='box_inst_id_']\").each(function () {\n\t\tlet list_id = this.id.split(\"_\")[3];\n\t\tboxList[list_id] = {};\n\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\n\t\t{\n\t\t\t$(\"li[data-box_inst_id|='\" + list_id + \"']\").each(function () {\n\t\t\t\tboxList[list_id][$(this).data(\"menu_item_id\")] = 1;\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\n\t\t\t\tboxList[list_id][$(this).data(\"menu_item_id\")] = $(this).val();\n\t\t\t});\n\n\t\t}\n\n\t});\n\n\tvar subtotal_delivery_fee = $(\"#subtotal_delivery_fee\").val();\n\tif (isNaN(subtotal_delivery_fee))\n\t{\n\t\tsubtotal_delivery_fee = \"0.00\";\n\t}\n\n\tvar special_instructions = $(\"#order_user_notes\").val();\n\n\tcurrentlySavingOrder = true;\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_items',\n\t\t\torder_id: order_id,\n\t\t\titems: boxList,\n\t\t\tsubtotal_delivery_fee: subtotal_delivery_fee,\n\t\t\tspecial_instructions: special_instructions\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\titemTabIsDirty = false;\n\t\t\t\tupdateItemsOrgValues();\n\n\t\t\t\tcurrentlySavingOrder = false;\n\n\t\t\t\tintenseLogging(\"saveItems() successful\");\n\n\t\t\t\tif (saveDiscountsUponCompletion)\n\t\t\t\t{\n\t\t\t\t\tsaveDiscounts(activateOnSaveDiscountsCompletion);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcurrentlySavingOrder = false;\n\n\t\t\t\tintenseLogging(\"update_items: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tcurrentlySavingOrder = false;\n\t\t\tintenseLogging(\"update_items: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\n/*\nfunction saveDeliveryAddress(payOnCompletion, token)\n{\n\n\tvar shipping_data = {};\n\t$(\"[id^='shipping_']\").each(function(){\n\t\tshipping_data[this.id] = $(this).val();\n\t});\n\n\tintenseLogging(\"saveDeliveryAddress() called\");\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 200000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'save_delivery_address',\n\t\t\torder_id: order_id,\n\t\t\tshipping_data: shipping_data\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveDeliveryAddress() successful\");\n\n\t\t\t\tdd_toast({\n\t\t\t\t\tmessage: 'Delivery Address Saved',\n\t\t\t\t\tposition: 'topcenter'\n\t\t\t\t});\n\n\t\t\t\tif (payOnCompletion)\n\t\t\t\t{\n\t\t\t\t\tonAddPaymentAndActivate(false, true, token);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"save_delivery_address: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\tintenseLogging(\"save_delivery_address: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\n */\n\nfunction setShipToAddressAndSaveOrder()\n{\n\n\tvar shipping_data = {};\n\t$(\"[id^='shipping_']\").each(function () {\n\t\tshipping_data[this.id] = $(this).val();\n\t});\n\n\tif ($(\"#shipping_is_gift\").is(\":checked\"))\n\t{\n\t\tshipping_data[\"shipping_is_gift\"] = \"on\";\n\t}\n\telse\n\t{\n\t\tshipping_data[\"shipping_is_gift\"] = \"0\";\n\t}\n\n\tintenseLogging(\"setShipToAddressAndSaveOrder() called\");\n\n\t// similar to saveDeliveryAddress but no order id is passed\n\t// and the response to success is to expose the calendar\n\t// I.E., this is part of initializing a new order\n\t// A SAVED order will have been created when this call completes.\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 200000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'save_delivery_address',\n\t\t\tshipping_data: shipping_data,\n\t\t\torder_state: orderState,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"setShipToAddressAndSaveOrder() successful\");\n\t\t\t\tbounce(\"/backoffice/order-mgr-delivered?order=\" + json.order_id + \"&atabs=mgr.sessionsTab\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"setShipToAddressAndSaveOrder: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tintenseLogging(\"save_delivery_address: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction Reschedule(org_session_id)\n{\n\n\tintenseLogging(\"Reschedule() called\");\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'reschedule',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\torder_id: order_id,\n\t\t\tsaved_booking_id: saved_booking_id,\n\t\t\torg_session_id: org_session_id,\n\t\t\torder_state: orderState\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"Reschedule() successful\");\n\n\t\t\t\tsession_id = json.new_session_id;\n\t\t\t\t$(\"#curSessionDate\").html(json.new_session_time);\n\t\t\t\t$(\"#curShipDate\").html(json.new_ship_time);\n\t\t\t\t$(\"#session\").val(json.new_session_id);\n\n\t\t\t\tRetrieveCalendar(0);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"reschedule: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\n\t\t\tintenseLogging(\"reschedule: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction onSaveItems()\n{\n\tintenseLogging(\"onSaveItems() called\");\n\n\tsaveItems(false, false, false);\n\treturn false;\n\n}\n\nfunction setupForNewOrder()\n{\n\tHideLineItemsIfZero();\n\tvar timestamp = getQueryVariable('month');\n\n}\n\nfunction setupForSavedOrder()\n{\n\tRetrieveCalendar(0);\n\t$(\"#addPaymentAndActivate\").show();\n\t$(\"#addPaymentAndActivateButton\").attr('disabled', 'disabled');\n\t$(\"#items_tab_li\").removeClass(\"disabled\");\n\t$(\"#items_tab_li\").removeClass(\"unsaved_data_on_tab\");\n}\n\nfunction setupForActiveOrder()\n{\n\tif (discountEligable.limited_access)\n\t{\n\t\t$(\"#payments_tab_li\").click();\n\t\t$(\"#items_tab_li\").addClass(\"disabled\");\n\t\t$(\"#sessions_tab_li\").addClass(\"disabled\");\n\t\t$(\"#discountsDiv\").find(\":input\").prop(\"disabled\", true);\n\t\t$(\"#discountsDiv\").find(\"*\").addClass(\"om_disabled\");\n\t}\n\n\t$(\"#addPaymentAndActivate\").hide();\n\n}\n\nfunction isDeliveryAddressComplete()\n{\n\tvar validated = true;\n\n\t$(\"[id^='shipping_']\").each(function () {\n\n\t\tif (!$(this).val() && $(this).attr('required'))\n\t\t{\n\t\t\tvalidated = false;\n\t\t}\n\t});\n\treturn validated;\n}\n\nfunction onDeliveryTabSelected()\n{\n\n}\n\nfunction onDeliveryTabDeselected()\n{\n\t/*\n\tif (!isDeliveryAddressComplete())\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please check the Delivery Address and phone number fields for completeness.'\n\t\t});\n\n\t\treturn false;\n\t}\n*/\n\treturn true;\n\n}\n\nfunction onSessionTabSelected()\n{\n\tRetrieveCalendar(0);\n}\n\nfunction onSessionTabDeselected()\n{\n\treturn true;\n}\n\nfunction onItemsTabSelected()\n{\n\n}\n\nfunction onItemsTabDeselected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\tif (itemTabIsDirty)\n\t\t{\n\t\t\tsaveItems(false, false, false);\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction onPaymentTabSelected()\n{\n}\n\nfunction onPaymentTabDeselected()\n{\n\tif (orderState != 'ACTIVE' && (discountChanges || reportingChanges))\n\t{\n\t\tsaveDiscounts(false, false);\n\t}\n\n\treturn true;\n}\n\nfunction onNotesTabSelected()\n{\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'get_history',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\t$(\"#history_div\").html(json.html);\n\n\t\t\thandle_guest_account_notes();\n\n\t\t\thandle_admin_carryover_notes();\n\n\t\t\thandle_admin_order_notes();\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\n\t\t\tintenseLogging(\"get_history: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onNotesTabDeselected()\n{\n\treturn true;\n}\n\nfunction onPaymentSelected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\n\t\tpaymentChanges = true;\n\t\tupdateChangeList();\n\t}\n\telse\n\t{\n\t\tpaymentChanges = true;\n\t\tupdateChangeList();\n\t}\n}\n\nfunction onPaymentDeselected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\n\t\tupdateChangeList();\n\t\tpaymentChanges = false;\n\t}\n\telse\n\t{\n\t\tpaymentChanges = false;\n\t\tupdateChangeList();\n\t}\n\n\treturn true;\n\n}\n\nfunction updateDiscountOrgValues()\n{\n\n\t$(\"#org_coupon_id\").val($(\"#coupon_id\").val());\n\n\tupdateChangeList();\n\n}\n\nfunction _validate_discounts()\n{\n\treturn true;\n}\n\nfunction _validate_address()\n{/*\n\t$thisOrder->orderAddress->firstname = $shippingData['shipping_firstname'];\n\t$thisOrder->orderAddress->lastname = $shippingData['shipping_lastname'];\n\t$thisOrder->orderAddress->address_line1 = $shippingData['shipping_address_line1'];\n\t$thisOrder->orderAddress->address_line2 = $shippingData['shipping_address_line2'];\n\t$thisOrder->orderAddress->city = $shippingData['shipping_city'];\n\t$thisOrder->orderAddress->state_id = $shippingData['shipping_state_id'];\n\t$thisOrder->orderAddress->postal_code = $shippingData['shipping_postal_code'];\n\t$thisOrder->orderAddress->telephone_1 = (($shipping_phone_number == 'new') ? $shipping_phone_number_new : $shipping_phone_number);\n\t$thisOrder->orderAddress->address_note = trim(strip_tags($shipping_address_note));\n\t$thisOrder->orderAddress->email_address = $shipping_email_address;\n\t$thisOrder->orderAddress->is_gift = (!empty($shippingData['shipping_is_gift']) ? 1 : 0);\n*/\n\t// TODO: phone and email validation\n\n\tvalidationSuccess = true;\n\n\tif ($(\"#shipping_firstname\").val().length == 0)\n\t{\n\t\t$(\"#shipping_firstname\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_firstname\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_firstname\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_firstname\").addClass(\"is-valid\");\n\t}\n\n\tif ($(\"#shipping_lastname\").val().length == 0)\n\t{\n\t\t$(\"#shipping_lastname\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_lastname\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_lastname\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_lastname\").addClass(\"is-valid\");\n\t}\n\n\tif ($(\"#shipping_address_line1\").val().length == 0)\n\t{\n\t\t$(\"#shipping_address_line1\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_address_line1\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_address_line1\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_address_line1\").addClass(\"is-valid\");\n\t}\n\n\tif ($(\"#shipping_city\").val().length == 0)\n\t{\n\t\t$(\"#shipping_city\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_city\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_city\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_city\").addClass(\"is-valid\");\n\t}\n\n\tif ($(\"#shipping_state_id\").val().length == 0)\n\t{\n\t\t$(\"#shipping_state_id\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_state_id\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_state_id\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_state_id\").addClass(\"is-valid\");\n\t}\n\n\tif ($(\"#shipping_state_id\").val().length == 0)\n\t{\n\t\t$(\"#shipping_state_id\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_state_id\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_state_id\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_state_id\").addClass(\"is-valid\");\n\t}\n\n\tif ($(\"#shipping_postal_code\").val().length != 5)\n\t{\n\t\t$(\"#shipping_postal_code\").removeClass(\"is-valid\");\n\t\t$(\"#shipping_postal_code\").addClass(\"is-invalid\");\n\t\tvalidationSuccess = false;\n\t}\n\telse\n\t{\n\t\t$(\"#shipping_postal_code\").removeClass(\"is-invalid\");\n\t\t$(\"#shipping_postal_code\").addClass(\"is-valid\");\n\t}\n\n\treturn validationSuccess;\n}\n\nfunction saveDiscounts(payOnCompletion)\n{\n\tintenseLogging(\"saveDiscounts() called\");\n\n\tif (!_validate_discounts())\n\t{\n\t\treturn false;\n\t}\n\n\tif (!payOnCompletion)\n\t{\n\t\tdd_toast({\n\t\t\tmessage: 'Discounts Saved',\n\t\t\tposition: 'topcenter'\n\t\t});\n\t}\n\n\tvar direct_order_discount = $(\"#direct_order_discount\").val();\n\tif (isNaN(direct_order_discount))\n\t{\n\t\tdirect_order_discount = \"0.00\";\n\t}\n\n\tvar dinner_dollars_discount = $(\"#plate_points_discount\").val();\n\tif (isNaN(dinner_dollars_discount))\n\t{\n\t\tdinner_dollars_discount = \"0.00\";\n\t}\n\n\tvar coupon_id = 0;\n\tvar coupon_free_menu_item = 0;\n\tif ($(\"#coupon_id\").val())\n\t{\n\n\t\tcoupon_id = $(\"#coupon_id\").val();\n\t}\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'update_discounts',\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id,\n\t\t\tdirect_order_discount: direct_order_discount,\n\t\t\tplate_points_discount: dinner_dollars_discount,\n\t\t\tcoupon_id: coupon_id\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveDiscounts() successful\");\n\n\t\t\t\tupdateDiscountOrgValues();\n\t\t\t\tupdateReportingOrgValues();\n\n\t\t\t\tif (coupon_free_menu_item)\n\t\t\t\t{\n\t\t\t\t\t$('#free_menu_item_coupon').attr('disabled', true);\n\t\t\t\t\tcouponFreeMenuItem = coupon_free_menu_item;\n\t\t\t\t}\n\n\t\t\t\tif (payOnCompletion)\n\t\t\t\t{\n\n\t\t\t\t\tif (!_validate_address())\n\t\t\t\t\t{\n\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\tmessage: \"Please review and correct the shipping address.\"\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tonAddPaymentAndActivate(false, true, json.paymentToken);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"update_discounts: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\tintenseLogging(\"update_discounts: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction updateReportingOrgValues()\n{\n\tupdateChangeList();\n}\n\nfunction getPaymentData(type, payment_number)\n{\n\n\tif (type != 'CC')\n\t{\n\t\tvar paymentData = {\n\t\t\ttype: type,\n\t\t\tnumber: 0,\n\t\t\tamount: 0,\n\t\t\tcert_type: '',\n\t\t\tnote: $(\"#payment_note\").val()\n\t\t}\n\t}\n\telse\n\t{\n\t\tvar paymentData = {\n\t\t\ttype: type,\n\t\t\tnumber: 0,\n\t\t\tamount: 0,\n\t\t\tcert_type: '',\n\t\t\tnote: $(\"#payment_note\").val(),\n\t\t\tccNameOnCard: \"\",\n\t\t\tccType: 'CC',\n\t\t\tccMonth: \"\",\n\t\t\tccYear: \"\",\n\t\t\tcc_security_code: \"\",\n\t\t\tbilling_address: \"\",\n\t\t\tbilling_postal_code: \"\",\n\t\t\tis_store_specific_flat_rate_deposit_delayed_payment: 0,\n\t\t\tdo_not_ref: 0\n\t\t}\n\t}\n\n\tif (payment_number == 1)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase \"REFERENCE\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_reference_total_amount\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"GIFT_CERT\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_gc_total_amount\").val();\n\t\t\t\tpaymentData.cert_type = $(\"#payment1_gift_cert_type\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_gc_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFUND_CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_refund_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_refund_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_check_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_check_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CREDIT\":\n\t\t\t\tpaymentData.amount = $(\"#OEH_remaing_balance\").html();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CC\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_cc_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_ccNumber\").val();\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment1_ccNameOnCard\").val();\n\t\t\t\tpaymentData.ccType = $(\"#payment1_ccType\").val();\n\t\t\t\tpaymentData.ccMonth = $(\"#payment1_ccMonth\").val();\n\t\t\t\tpaymentData.ccYear = $(\"#payment1_ccYear\").val();\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment1_cc_security_code\").val();\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_1\").val();\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_1\").val();\n\n\t\t\t\tif ($('#save_cc_as_ref_1').is(':checked'))\n\t\t\t\t{\n\t\t\t\t\tpaymentData.save_card = true;\n\t\t\t\t}\n\n\t\t\t\tvar DPSetting = $('input[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"GIFT_CARD\":\n\t\t\t\tpaymentData.amount = $(\"#debit_gift_card_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#debit_gift_card_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"DPADJUST\":\n\t\t\t\t// TODO: ???\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFERENCE_OTHER\":\n\t\t\t\talert('investigate REFERENCE_OTHER');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\n\t\t\t\t{\n\t\t\t\t\tpaymentData.amount = $(\"#payment1_ref_total_amount\").val();\n\t\t\t\t\tpaymentData.reference_id = $(\"#p1_ref_id\").html();\n\t\t\t\t}\n\n\t\t}\n\n\t\treturn paymentData;\n\n\t}\n\telse if (payment_number == 2)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase \"CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_check_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_check_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CC\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_cc_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_ccNumber\").val();\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment2_ccNameOnCard\").val();\n\t\t\t\tpaymentData.ccType = $(\"#payment2_ccType\").val();\n\t\t\t\tpaymentData.ccMonth = $(\"#payment2_ccMonth\").val();\n\t\t\t\tpaymentData.ccYear = $(\"#payment2_ccYear\").val();\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment2_cc_security_code\").val();\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_2\").val();\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_2\").val();\n\n\t\t\t\tif ($('#save_cc_as_ref_2').is(':checked'))\n\t\t\t\t{\n\t\t\t\t\tpaymentData.save_card = true;\n\t\t\t\t}\n\n\t\t\t\tvar DPSetting = $('input[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFERENCE_OTHER\":\n\t\t\t\talert('investigate REFERENCE_OTHER');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\n\t\t\t\t{\n\t\t\t\t\tpaymentData.amount = $(\"#payment2_ref_total_amount\").val();\n\t\t\t\t\tpaymentData.reference_id = $(\"#p2_ref_id\").html();\n\t\t\t\t}\n\n\t\t}\n\n\t\treturn paymentData;\n\t}\n\n}\n\nfunction validatePayment1(type)\n{\n\n\tvar inputArray = null;\n\tvar validates = true;\n\n\tif (type.substr(0, 4) == \"REF_\")\n\t{\n\t\ttype = \"REFERENCE_OTHER\";\n\t}\n\n\tswitch (type)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\tinputArray = $(\"#payment1_reference :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tinputArray = $(\"#payment1_gc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tinputArray = $(\"#payment1_cash :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tinputArray = $(\"#payment1_refund_cash :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tinputArray = $(\"#payment1_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\tinputArray = $(\"#payment1_credit :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tinputArray = $(\"#payment1_cc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment1_cc_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tinputArray = $(\"#payment1_debit_gift_card :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"DPADJUST\":\n\t\t\tinputArray = $(\"#dp_adjust_div :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tinputArray = $(\"#payment1_ref :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment1_ref_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t}\n\n\treturn validates;\n\n}\n\nfunction validatePayment2(type)\n{\n\n\tvar inputArray = null;\n\tvar validates = true;\n\n\tif (type.substr(0, 4) == \"REF_\")\n\t{\n\t\ttype = \"REFERENCE_OTHER\";\n\t}\n\n\tswitch (type)\n\t{\n\n\t\tcase \"CASH\":\n\t\t\tinputArray = $(\"#payment2_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tinputArray = $(\"#payment2_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tinputArray = $(\"#payment2_cc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment2_cc_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tinputArray = $(\"#payment2_ref :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment2_ref_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\t}\n\n\treturn validates;\n}\n\nfunction addPaymentAndActivate()\n{\n\tintenseLogging(\"addPaymentAndActivate() called\");\n\n\t// always first ensure that discounts are updated on server\n\tvar message = \"You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?\";\n\tvar changesBlurb = getAbbreviatedSummaryString();\n\t//message += \"<br /><br />\" + changesBlurb;\n\n\tdd_message({\n\t\tdiv_id: 'activate_confirm',\n\t\ttitle: 'Add Payment and Book Order',\n\t\tmessage: message,\n\t\tmodal: true,\n\t\twidth: 400,\n\t\theight: 180,\n\t\tconfirm: function () {\n\t\t\tvar discounts_are_valid = saveItems(true, true);\n\t\t}\n\t});\n\n\treturn true;\n}\n\nfunction save2PaymentsAndBookOrder(payment2Type, payment1Data, token)\n{\n\n\tintenseLogging(\"save2PaymentsAndBookOrder() called\");\n\n\tvar payment2Data = getPaymentData(payment2Type, 2);\n\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\n\t{\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\n\t\tif (!max_plate_points_deduction)\n\t\t{\n\t\t\tmax_plate_points_deduction = 0;\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'save_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tsession_id: session_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment1Data,\n\t\t\t\tadd_payment_data: payment2Data,\n\t\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() save_payment successful\");\n\n\t\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/backoffice/order-mgr-thankyou?order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/backoffice/order-mgr-thankyou?order=\" + json.order_id);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\telse if (payment2Type == \"CC\")\n\t{\n\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_2\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\n\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 2, json.warnOfOutstandingSavedOrdersOnFullSession, false, false, payment1Data);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction savePayment2(payment2Type, warnOfOutstandingSavedOrdersOnFullSession, token)\n{\n\n\tintenseLogging(\"savePayment2() called\");\n\n\tvar payment2Data = getPaymentData(payment2Type, 2);\n\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\n\t{\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'add_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment2Data,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"savePayment2() add_payment successful\");\n\n\t\t\t\t\tif (warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/backoffice/order-mgr-thankyou?order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/backoffice/order-mgr-thankyou?order=\" + json.order_id);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\telse if (payment2Type == \"CC\")\n\t{\n\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_2\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\n\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"savePayment2() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 2, warnOfOutstandingSavedOrdersOnFullSession, false, false);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction handleDirectPayment(addOnly, go_to_confirm, token)\n{\n\n\tintenseLogging(\"handleDirectPayment() called\");\n\n\tvar payment1Type = $(\"#payment1_type\").val();\n\tvar payment2Type = false;\n\n\tif (payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD')\n\t{\n\t\tpayment2Type = $(\"#payment2_type\").val();\n\t}\n\n\t// validation\n\tif (!validatePayment1(payment1Type))\n\t{\n\t\treturn false;\n\t}\n\n\t// validation\n\tif (payment2Type && payment2Type != \"\" && !validatePayment2(payment2Type))\n\t{\n\t\treturn false;\n\t}\n\n\tdisplayModalWaitDialog('paying_div', \"Sending Payment. Please wait ...\");\n\n\tvar payment1Data = getPaymentData(payment1Type, 1);\n\n\t// Handle Payment 1 for certain\n\t// Then handle Payment 2 unless it's a CC payment.\n\n\tvar DP_State = 0;\n\tif ($('#ref_payment1_is_store_specific_flat_rate_deposit_delayed0').length)\n\t{\n\t\tDP_State = $('input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\tif (DP_State == 1)\n\t\t{\n\t\t\tDP_State = 4;\n\t\t} // translate to CPayment constants - for now\n\t\tif (DP_State == 2)\n\t\t{\n\t\t\tDP_State = 5;\n\t\t}\n\n\t\tif (DP_State > 0)\n\t\t{\n\t\t\t// TODO: validate amounts\n\t\t}\n\t}\n\n\tvar use_store_credits = false;\n\tvar store_credit_amount = 0;\n\tif ($(\"#use_store_credits\").length)\n\t{\n\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t{\n\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\tuse_store_credits = true;\n\t\t}\n\t}\n\n\tvar mainPaymentData = null;\n\tvar additionalPaymentData = null;\n\n\tif (payment2Type)\n\t{\n\t\tmainPaymentData = getPaymentData(payment2Type, 2);\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t}\n\t\t}\n\t\tadditionalPaymentData = payment1Data;\n\t}\n\telse\n\t{\n\t\tmainPaymentData = payment1Data;\n\t}\n\n\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\n\tif (!max_plate_points_deduction)\n\t{\n\t\tmax_plate_points_deduction = 0;\n\t}\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 90000,\n\t\tasync: true,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: store_id,\n\t\t\top: 'save_payment',\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id,\n\t\t\tpayment_data: mainPaymentData,\n\t\t\tadd_payment_data: additionalPaymentData,\n\t\t\tdelay_remainder: DP_State,\n\t\t\tuse_store_credits: use_store_credits,\n\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\n\t\t\tstore_credits_amount: store_credit_amount,\n\t\t\tdd_csrf_token: token,\n\t\t\tpayment2Type: payment2Type\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"handleDirectPayment() save_payment successful\");\n\n\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t{\n\t\t\t\t\tbounce(\"/backoffice/order-mgr-thankyou?order=\" + json.order_id + '&full_session=true');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbounce(\"/backoffice/order-mgr-thankyou?order=\" + json.order_id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tif (strError == 'timeout')\n\t\t\t{\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Order Processing Timed Out',\n\t\t\t\t\tmessage: \"The request to finalized the order has timed out. This may be due to network congestion. The order may have been successful. The page will refresh and show the actual current status.\",\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t'Refresh': function () {\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\tbounce(window.location.href);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction onAddPaymentAndActivate(addOnly, go_to_confirm, token)\n{\n\tintenseLogging(\"onAddPaymentAndActivate() called\");\n\treturn handleDirectPayment(addOnly, go_to_confirm, token);\n}\n\nfunction RetrieveCalendar(timestamp)\n{\n\tintenseLogging(\"RetrieveCalendar() called\");\n\n\tvar op = 'retrieve_new';\n\tif (orderState != 'SAVED')\n\t{\n\t\top = 'retrieve_for_reschedule';\n\t}\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'GET',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_calendarProcessorDelivered',\n\t\t\tstore_id: store_id,\n\t\t\taction: op,\n\t\t\tcur_session_id: session_id,\n\t\t\ttimestamp: timestamp,\n\t\t\tservice_days: service_days_for_current_zip\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"RetrieveCalendar() successful\");\n\t\t\t\t$(\"#calendar_holder\").html(json.data);\n\t\t\t\thandleSessionSelection();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"RetrieveCalendar: \" + json.processor_message);\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tintenseLogging(\"RetrieveCalendar: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onDayClick(obj)\n{\n}\n\nfunction doReschedule(id, sessionTime)\n{\n\tvar curSessionDate = $(\"#curSessionDate\").html();\n\n\tdd_message({\n\t\ttitle: 'Reschedule',\n\t\tmessage: '<div style=\"text-align: center;\"><div>From</div><div style=\"font-weight: bold;\">' + curSessionDate + '</div><div>to</div><div style=\"font-weight: bold;\">' + sessionTime + '</div>',\n\t\tmodal: true,\n\t\tconfirm: function () {\n\n\t\t\tvar org_session_id = session_id;\n\t\t\tsession_id = id;\n\t\t\tReschedule(org_session_id);\n\n\t\t},\n\t\topen: function () {\n\n\t\t\t$(this).siblings('.ui-dialog-buttonpane').find(\"button:contains('Confirm')\").focus();\n\t\t}\n\n\t});\n\n}\n\nfunction onRescheduleClick(id, sessionTime, isDiscounted, control_message)\n{\n\tif (orderState != 'NEW')\n\t{\n\t\tif (control_message == \"locked\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"You cannot reschedule to this session as it is in the previous calendar month and all activity for that month has been locked and finalized.\"\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdoReschedule(id, sessionTime);\n\t\t}\n\t}\n}\n\nfunction onSessionClick(id, sessionTime, isDiscounted)\n{\n\t// Obsolete - delivered orders always set a session based on current date and service days\n\tintenseLogging(\"onSessionClick() called .................... please investiage should not occur for Shipping order\");\n\n}\n\nfunction monthChange(monthVal)\n{\n\tRetrieveCalendar(monthVal);\n}\n\nfunction handleSummaryDisplayChange(obj)\n{\n\tif (obj.checked)\n\t{\n\t\tShowAllLineItems();\n\t}\n\telse\n\t{\n\t\tHideLineItemsIfZero();\n\t}\n}\n\nfunction HideLineItemsIfZero()\n{\n\n\tvar deliveryFeeOrg = Number($('#OEH_subtotal_delivery_fee_org').html());\n\tvar deliveryFee = Number($('#OEH_subtotal_delivery_fee').html());\n\n\tif (deliveryFeeOrg == 0 && deliveryFee == 0)\n\t{\n\t\t$('#DeliveryFeeRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#DeliveryFeeRow').show();\n\t}\n\n\tvar doDiscountOrg = Number($('#OEH_direct_order_discount_org').html());\n\tvar doDiscount = Number($('#OEH_direct_order_discount').html());\n\n\tif (doDiscountOrg == 0 && doDiscount == 0)\n\t{\n\t\t$('#directDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#directDiscountRow').show();\n\t}\n\n\tvar couponDiscountOrg = Number($('#OEH_coupon_discount_org').html());\n\tvar couponDiscount = Number($('#OEH_coupon_discount').html());\n\n\tif (couponDiscountOrg == 0 && couponDiscount == 0)\n\t{\n\t\t$('#couponDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#couponDiscountRow').show();\n\t}\n\n\tvar membershipDiscountOrg = Number($('#OEH_membership_discount_org').html());\n\tvar membershipDiscount = Number($('#OEH_membership_discount').html());\n\n\tif (membershipDiscountOrg == 0 && membershipDiscount == 0)\n\t{\n\t\t$('#membershipDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#membershipDiscountRow').show();\n\t}\n\n\tvar foodTaxOrg = Number($('#OEH_food_tax_subtotal_org').html());\n\tvar foodTax = Number($('#OEH_food_tax_subtotal').html());\n\n\tif (foodTaxOrg == 0 && foodTax == 0)\n\t{\n\t\t$('#foodTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#foodTaxRow').show();\n\t}\n\n\tvar nonFoodTaxOrg = Number($('#OEH_tax_subtotal_org').html());\n\tvar nonFoodTax = Number($('#OEH_tax_subtotal').html());\n\n\tif (nonFoodTaxOrg == 0 && nonFoodTax == 0)\n\t{\n\t\t$('#nonFoodTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#nonFoodTaxRow').show();\n\t}\n\n\tvar deliveryTaxOrg = Number($('#OEH_delivery_tax_subtotal_org').html());\n\tvar deliveryTax = Number($('#OEH_delivery_tax_subtotal').html());\n\n\tif (deliveryTaxOrg == 0 && deliveryTax == 0)\n\t{\n\t\t$('#DeliveryTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#DeliveryTaxRow').show();\n\t}\n\n\tvar ddOrg = Number($('#OEH_plate_points_order_discount_fee_org').html());\n\tvar dd = Number($('#OEH_plate_points_order_discount_fee').html());\n\tdd = isNaN(dd) ? 0 : dd;\n\tddOrg = isNaN(ddOrg) ? 0 : ddOrg;\n\n\tif (ddOrg == 0 && dd == 0)\n\t{\n\t\t$('#dinnerDollarsDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#dinnerDollarsDiscountRow').show();\n\t}\n\n}\n\nfunction ShowAllLineItems()\n{\n\t$('#DeliveryFeeRow').show();\n\t$('#directDiscountRow').show();\n\t$('#couponDiscountRow').show();\n\t$('#foodTaxRow').show();\n\t$('#nonFoodTaxRow').show();\n\t$('#dinnerDollarsDiscountRow').show();\n}\n\nfunction sort_by_price(a, b)\n{\n\tif (a.price == b.price)\n\t{\n\t\treturn 0;\n\t}\n\n\treturn (a.price < b.price) ? 1 : -1;\n}\n\nfunction drawChangeList()\n{\n\tvar html = getChangeListHTML();\n\t$(\"#changelist\").html(html);\n\n}\n\nfunction getChangeListHTML()\n{\n\n\tvar htmlStr = \"\";\n\tvar first = true;\n\n\tlet editedExistingBoxHTML = {};\n\tlet existingNewBoxHTML = {};\n\n\tfor (var thisBox in changeList.box_contents)\n\t{\n\t\tif (changeList.box_contents.hasOwnProperty(thisBox))\n\t\t{\n\t\t\tlet tempHTML = \"\";\n\n\t\t\tfor (var thisItem in changeList.box_contents[thisBox])\n\t\t\t{\n\t\t\t\tlet item_name = $(\"#qty_\" + thisBox + \"_\" + thisItem).data('title');\n\n\t\t\t\tif (changeList.box_contents[thisBox][thisItem] > 0)\n\t\t\t\t{\n\t\t\t\t\ttempHTML += \"-Added \" + changeList.box_contents[thisBox][thisItem] + \" \" + item_name + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttempHTML += \"-Removed \" + changeList.box_contents[thisBox][thisItem] + \" \" + item_name + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!changeList.boxes[thisBox])\n\t\t\t{\n\t\t\t\t// an existing boxes contents have changed\n\n\t\t\t\tif (first)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"<h3>Edited Boxes</h3><ul style='margin: 4px;'>\";\n\t\t\t\t\tfirst = false;\n\t\t\t\t}\n\n\t\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\n\n\t\t\t\teditedExistingBoxHTML[thisBox] = \"Box: \" + title + \"<br />\" + tempHTML;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\texistingNewBoxHTML[thisBox] = tempHTML;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tvar first = true;\n\n\tfor (var box_inst_id in changeList.boxes)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Added Boxes</h3><ul style='margin: 0px; padding: 0px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.boxes.hasOwnProperty(box_inst_id))\n\t\t{\n\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\n\n\t\t\tif (changeList.boxes[box_inst_id] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.boxes[box_inst_id] + \" <i>\" + title + \"</i> \";\n\n\t\t\t\tif (existingNewBoxHTML[box_inst_id])\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"<br />\" + existingNewBoxHTML[box_inst_id];\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.boxes[box_inst_id] * -1 + \"<i>\" + boxesDeletedFromActiveOrder[box_inst_id] + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tfor (var box_inst_id in editedExistingBoxHTML)\n\t{\n\t\tif (editedExistingBoxHTML.hasOwnProperty(box_inst_id))\n\t\t{\n\t\t\thtmlStr += editedExistingBoxHTML[box_inst_id];\n\t\t}\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tvar hadMiscCostChanges = false;\n\tfor (var item in changeList.miscCosts)\n\t{\n\t\thadMiscCostChanges = true;\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.miscDescs)\n\t{\n\t\tif (!hadMiscCostChanges && first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\n\t\t{\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\n\t\t}\n\t}\n\n\tif (changeList.order_type != \"\")\n\t{\n\t\thtmlStr += \"<h3>Order changed \" + changeList.order_type + \"</h3>\";\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.discounts)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.discounts.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.reporting)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Reporting</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.reporting.hasOwnProperty(item))\n\t\t{\n\t\t\tif (item == 'fundraiser')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse if (changeList.reporting[item][\"orgVal\"] > 0 && changeList.reporting[item][\"orgVal\"] != changeList.reporting[item][\"newVal\"])\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Changed \" + getHumanReadableName(item) + \" to \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (item == 'fundraiser_value')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item == 'ltd_roundup')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == false)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + ' was removed from the order.'\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + ' was added to the order.'\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item == 'ltd_roundup_value')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (changeList.coupon)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.coupon.change_type = 'added')\n\t\t{\n\t\t\thtmlStr += \"Added coupon code: \" + \"<br />\";\n\t\t}\n\t\telse if (changeList.coupon.change_type = 'removed')\n\t\t{\n\t\t\thtmlStr += \"Removed coupon code: \" + \"<br />\";\n\t\t}\n\t\telse if (changeList.coupon.change_type = 'added')\n\t\t{\n\t\t\thtmlStr += \"Change coupon code to: \" + \"<br />\";\n\t\t}\n\t}\n\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\n\t{\n\t\thtmlStr += \"<h3>Payments</h3>\";\n\n\t\tvar payment1Type = $('#payment1_type').val();\n\n\t\tif (payment1Type != '')\n\t\t{\n\t\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').is(\":visible\");\n\t\t\t{\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\n\t\t\t\t}\n\n\t\t\t\tvar ccRefundTotal = 0;\n\t\t\t\t$(\"[id^='Cr_RT_']\").each(function () {\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\n\t\t\t\t});\n\n\t\t\t\tif (ccRefundTotal > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment2_type').val() != \"\")\n\t\t{\n\t\t\tvar payment2Type = $('#payment2_type').val();\n\t\t\tif (payment2Type && payment2Type != \"\")\n\t\t\t{\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\n\t\t\t}\n\t\t}\n\n\t\tif ($('#use_store_credit').is(':checked'))\n\t\t{\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\n\t\t}\n\t}\n\treturn htmlStr;\n}\n\nfunction getHumanReadableName(id)\n{\n\tswitch (id)\n\t{\n\t\tcase 'direct_order_discount':\n\t\t\treturn \"Direct Order Discount\";\n\t\tcase 'plate_points_discount':\n\t\t\treturn \"Dinner Dollars\";\n\t\tcase \"misc_food_subtotal\":\n\t\t\treturn \"Miscellaneous Food Cost\";\n\t\tcase \"misc_nonfood_subtotal\":\n\t\t\treturn \"Miscellaneous Non-food Cost\";\n\t\tcase \"subtotal_service_fee\":\n\t\t\treturn \"Service Fee\";\n\t\tcase \"subtotal_delivery_fee\":\n\t\t\treturn \"Delivery Fee\";\n\t\tcase 'misc_food_subtotal_desc':\n\t\t\treturn 'Misc Food Description';\n\t\tcase 'misc_nonfood_subtotal_desc':\n\t\t\treturn 'Misc Non-food Description';\n\t\tcase 'service_fee_description':\n\t\t\treturn 'Service Fee Description';\n\t\tcase 'session_discount':\n\t\t\treturn 'Session Discount';\n\t\tcase 'fundraiser':\n\t\t\treturn 'Fundraiser';\n\t\tcase 'fundraiser_value':\n\t\t\treturn 'Fundraiser Value';\n\t\tcase 'ltd_roundup_value':\n\t\t\treturn 'Dream Dinners Foundation Round Up Value';\n\t\tcase 'ltd_roundup':\n\t\t\treturn 'Dream Dinners Foundation Round Up';\n\t\tdefault:\n\t\t\treturn 'error';\n\t}\n}\n\nfunction getAbbreviatedSummaryString()\n{\n\tvar htmlStr = \"\";\n\n\thtmlStr += \"<h3>Shipping Order</h3>\";\n\n\tvar first = true;\n\tfor (var box_inst_id in changeList.boxes)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Added Boxes</h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.boxes.hasOwnProperty(box_inst_id))\n\t\t{\n\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\n\n\t\t\tif (changeList.boxes[box_inst_id] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.boxes[box_inst_id] + \"<i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.boxes[box_inst_id] * -1 + \"<i>\" + boxesDeletedFromActiveOrder[box_inst_id] + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\t$(\"[data-dd_type='item_field']\").each(function () {\n\t\tvar curVal = $(this).val();\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\n\t\t\tif (curVal > 0)\n\t\t\t{\n\t\t\t\thtmlStr += getHumanReadableName(this.id) + \" costs of $\" + formatAsMoney(curVal);\n\n\t\t\t\tvar descIDStr = \"\";\n\n\t\t\t\tswitch (this.id)\n\t\t\t\t{\n\t\t\t\t\tcase \"misc_food_subtotal\":\n\t\t\t\t\t\tdescIDStr = \"misc_food_subtotal_desc\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"misc_nonfood_subtotal\":\n\t\t\t\t\t\tdescIDStr = \"misc_nonfood_subtotal_desc\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"subtotal_service_fee\":\n\t\t\t\t\t\tdescIDStr = \"service_fee_description\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar desc = null;\n\t\t\t\tif (descIDStr != \"\")\n\t\t\t\t{\n\t\t\t\t\tdesc = $(\"#\" + descIDStr).val();\n\t\t\t\t}\n\n\t\t\t\tif (desc)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \". <span>( \" + desc + \" )</span><br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \".<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t// Discounts\n\n\tvar discountsHTML = \"\";\n\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\n\n\t\tvar curVal = $(this).val();\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() > 0)\n\t\t{\n\t\t\tdiscountsHTML += getHumanReadableName(this.id) + \" applied.<br />\";\n\t\t}\n\t});\n\n\tif (discountsHTML != \"\")\n\t{\n\t\thtmlStr += \"<h3>Discounts</h3>\" + discountsHTML;\n\t}\n\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\n\t{\n\t\thtmlStr += \"<h3>Payments</h3>\";\n\n\t\tvar payment1Type = $('#payment1_type').val();\n\n\t\tif (payment1Type != '')\n\t\t{\n\t\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').is(\":visible\");\n\t\t\t{\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\n\t\t\t\t}\n\n\t\t\t\tvar ccRefundTotal = 0;\n\t\t\t\t$(\"[id^='Cr_RT_']\").each(function () {\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\n\t\t\t\t});\n\n\t\t\t\tif (ccRefundTotal > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment1_type').val() != \"\")\n\t\t{\n\t\t\tvar payment2Type = $('#payment2_type').val();\n\t\t\tif (payment2Type && payment2Type != \"\")\n\t\t\t{\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\n\t\t\t}\n\t\t}\n\n\t\tif ($('#use_store_credit').is(':checked'))\n\t\t{\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\n\t\t}\n\n\t}\n\n\treturn htmlStr;\n}\n\nfunction updateChangeList()\n{\n\n\tlet itemChanges = false;\n\tlet discountChanges = false;\n\tlet reportingChanges = false;\n\n\tlet discountOrPaymentChanges = false;\n\tlet showSaveButton = false;\n\n\tchangeList = {};\n\tchangeList.stdMenuItems = {};\n\tchangeList.FTMenuItems = {};\n\tchangeList.miscCosts = {};\n\tchangeList.miscDescs = {};\n\tchangeList.bundleItems = {};\n\tchangeList.order_type = \"\";\n\tchangeList.discounts = {};\n\tchangeList.reporting = {};\n\tchangeList.delivery = {};\n\tchangeList.boxes = {}\n\tchangeList.box_contents = {}\n\n\tfor (var box_inst in current_box_ids)\n\t{\n\t\tcurrent_box_ids[box_inst] = 0;\n\t}\n\n\t$(\"[id^='box_inst_id_']\").each(function () {\n\t\tlet list_id = this.id.split(\"_\")[3];\n\t\tcurrent_box_ids[list_id] = 1;\n\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\n\t\t{\n\t\t\tif (!$(this).data(\"is_saved\"))\n\t\t\t{\n\t\t\t\tchangeList.boxes[list_id] = 1;\n\t\t\t\titemChanges = true;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!$(this).data(\"is_saved\"))\n\t\t\t{\n\t\t\t\tchangeList.boxes[list_id] = 1;\n\t\t\t\titemChanges = true;\n\n\t\t\t\t// also need to see it contents changed\n\t\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\n\t\t\t\t\tlet curQty = $(this).val();\n\t\t\t\t\tlet savedQty = $(this).data('claimed_qty');\n\t\t\t\t\tlet menu_item_id = $(this).data('menu_item_id');\n\n\t\t\t\t\tif (curQty != savedQty)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!changeList.box_contents[list_id])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tchangeList.box_contents[list_id] = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchangeList.box_contents[list_id][menu_item_id] = curQty - savedQty\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// also need to see it contents changed\n\t\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\n\t\t\t\t\tlet curQty = $(this).val();\n\t\t\t\t\tlet savedQty = $(this).data('claimed_qty');\n\t\t\t\t\tlet menu_item_id = $(this).data('menu_item_id');\n\n\t\t\t\t\tif (curQty != savedQty)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!changeList.box_contents.list_id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tchangeList.box_contents.list_id = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchangeList.box_contents.list_id[menu_item_id] = curQty - savedQty\n\t\t\t\t\t\titemChanges = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\n\t});\n\n\tfor (var box_inst in current_box_ids)\n\t{\n\t\tif (current_box_ids[box_inst] == 0)\n\t\t{\n\t\t\tchangeList.boxes[box_inst] = -1;\n\t\t}\n\t}\n\n\t/*\n\t// Items\n\t$(\"[id^='qty_']\").each(function ()\n\t{\n\t\tif ($(this).val() != $(this).data('org_value'))\n\t\t{\n\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t{\n\t\t\t\tchangeList.FTMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.stdMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t}\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\t*/\n\n\t// Misc Costs\n\t$(\"[data-dd_type='item_field']\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif (curVal == undefined || curVal == \"\")\n\t\t{\n\t\t\tcurVal = \"0.00\";\n\t\t}\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\t$(this).addClass('unsaved_data');\n\n\t\t\tif ($(this).data(\"number\") == true)\n\t\t\t{\n\t\t\t\t// we're not tracking description fields for now\n\t\t\t\tchangeList.miscCosts[this.id] = {\n\t\t\t\t\tnewVal: $(this).val(),\n\t\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\tif (itemChanges)\n\t{\n\t\t$(\"#items_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#items_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\t// Discounts\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\t// we're not  tracking description fields for now\n\t\t\tchangeList.discounts[this.id] = {\n\t\t\t\tnewVal: $(this).val(),\n\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t// coupons\n\tvar orgCouponVal = $(\"#org_coupon_id\").val();\n\tvar curCouponVal = $(\"#coupon_id\").val();\n\n\tif (orgCouponVal != curCouponVal)\n\t{\n\t\tdiscountOrPaymentChanges = true;\n\n\t\tif (orgCouponVal == \"\")\n\t\t{\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tchange_type: \"added\"\n\t\t\t};\n\t\t}\n\t\telse if (curCouponVal == \"\")\n\t\t{\n\t\t\t//removed\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tchange_type: \"removed\"\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tchange_type: \"changed\"\n\t\t\t};\n\t\t}\n\n\t}\n\n\tif (deliveryChanges)\n\t{\n\t\t$(\"#delivery_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#delivery_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\tif (discountOrPaymentChanges)\n\t{\n\t\t$(\"#payments_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#payments_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\tif (orderState == 'SAVED' && (showSaveButton || $('#use_store_credit').is(':checked')))\n\t{\n\t\t$(\"#saveOrderSpan\").show();\n\t}\n\telse\n\t{\n\t\t$(\"#saveOrderSpan\").hide();\n\t}\n\n\tif (orderState == 'SAVED' && ($('#use_store_credit').is(':checked') || paymentChanges))\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\n\t}\n\telse\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\n\n\t}\n\n\tif (orderState == 'ACTIVE' || discountEligable.limited_access)\n\t{\n\t\t$(\"#finalizeOrderSpan\").show();\n\t\tif (showSaveButton || paymentChanges || $('#use_store_credits').is(':checked'))\n\t\t{\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\t$(\"#submit_button\").attr(\"disabled\", false);\n\t\t\t$(\"#finalize_msg\").show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#submit_button\").attr(\"disabled\", true);\n\t\t\t$(\"#finalize_msg\").hide();\n\t\t}\n\t}\n\telse\n\t{\n\t\t$(\"#finalizeOrderSpan\").hide();\n\t}\n\n\tif (itemChanges || discountOrPaymentChanges)\n\t{\n\t\t$(\"#changeListTab\").addClass('unsaved_data_list');\n\t}\n\telse\n\t{\n\t\t$(\"#changeListTab\").removeClass('unsaved_data_list');\n\t}\n\n\tdrawChangeList();\n}\n\nfunction handleAutoAdjust(obj)\n{\n\t// called when the document is loaded or when the \"autoAdjust\" check box changes\n\n\t// if checked then setup the amounts to be credited/debited\n\tif (obj.checked)\n\t{\n\t\tvar balance = Number($('#OEH_remaing_balance').html());\n\n\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || balance > 0))\n\t\t{\n\t\t\tif (balance > 0)\n\t\t\t{\n\t\t\t\t$('#payment1_type').val('DPADJUST');\n\t\t\t\tchangePayment1('DPADJUST');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tadjustPendingDelayedPayment(balance);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tif (balance > 0)\n\t\t\t{\n\t\t\t\t$('#payment1_type').val('REFERENCE');\n\t\t\t\tchangePayment1('REFERENCE');\n\t\t\t}\n\n\t\t\tassignBalanceToRefTransactions(balance);\n\t\t}\n\t}\n\telse\n\t{\n\n\t\tif ($('#payment1_type').val() != \"\")\n\t\t{\n\t\t\t$('#payment1_type').val('');\n\t\t\tchangePayment1('');\n\t\t}\n\n\t\t// also clear any credits\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\t$('#Cr_RT_' + ident).val(\"\");\n\t\t}\n\n\t\t// or if trying to credit\n\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction getAbbreviatedChangeString()\n{\n\tvar htmlStr = \"\";\n\tvar addedStd = 0;\n\tvar removedStd = 0;\n\n\tvar htmlStr = \"\";\n\n\tif (needPlatePointsMaxDiscountChangeWarning)\n\t{\n\t\thtmlStr += \"<div style='color:red;'>Warning: The amount discountable by Dinner Dollars has changed. You may wish to review and adjust the Dinner Dollars discount.</div>\";\n\n\t}\n\tvar first = true;\n\tfor (var box_inst_id in changeList.boxes)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Added Boxes</h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.boxes.hasOwnProperty(box_inst_id))\n\t\t{\n\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\n\n\t\t\tif (changeList.boxes[box_inst_id] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.boxes[box_inst_id] + \"<i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.boxes[box_inst_id] * -1 + \"<i>\" + boxesDeletedFromActiveOrder[box_inst_id] + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfor (var item in changeList.miscCosts)\n\t{\n\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfor (var item in changeList.miscDescs)\n\t{\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\n\t\t{\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\n\t\t}\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.discounts)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.discounts.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tif ($('#autoAdjust').is(\":checked\"))\n\t{\n\t\thtmlStr += \"<span style='color:red'>Auto-Adjust is checked and will \" + $(\"#adj_action\").html() + \"</span>\";\n\n\t}\n\n\thtmlStr = \"<div id='finalize_changes_div'>\" + htmlStr + \"</div>\";\n\treturn htmlStr;\n}\n\nfunction addPaymentToLockedOrder()\n{\n\tvar billing_name = $(\"#payment1_ccNameOnCard\").val();\n\tvar billing_address = $(\"#billing_address_1\").val();\n\tvar billing_zip = $(\"#billing_postal_code_1\").val();\n\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tasync: true,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'get_token',\n\t\t\torder_id: order_id,\n\t\t\tamount: amt,\n\t\t\tuser_id: user_id,\n\t\t\tbilling_name: billing_name,\n\t\t\tbilling_address: billing_address,\n\t\t\tbilling_zip: billing_zip,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val(),\n\t\t\tchain_token: true\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder() get_token successful\");\n\n\t\t\t\tvar token = json.token;\n\n\t\t\t\tsend(token, 1, false, true, true, false);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\t$(\"#paying_div\").remove();\n\n\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction submitPage()\n{\n\tintenseLogging(\"submitPage() called\");\n\n\tvar form = $(\"#editorForm\")[0];\n\n\tvar is_valid = confirm_and_check_form(form);\n\n\tif (is_valid)\n\t{\n\t\tvar message = \"This can not be undone. Are you sure you want to submit the changes?\";\n\t\tvar changesBlurb = getAbbreviatedChangeString();\n\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\tvar dialogHeight = 460;\n\n\t\tif (message.length < 128)\n\t\t{\n\t\t\tdialogHeight = 160;\n\t\t}\n\t\telse if (message.length < 256)\n\t\t{\n\t\t\tdialogHeight = 260;\n\t\t}\n\n\t\tdd_message({\n\t\t\ttitle: 'Finalize',\n\t\t\tmessage: message,\n\t\t\tmodal: true,\n\t\t\twidth: 400,\n\t\t\theight: dialogHeight,\n\t\t\tconfirm: function () {\n\n\t\t\t\tif (supports_transparent_redirect && $(\"#payment1_type\").val() == 'CC')\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"submitPage() confirmed\");\n\n\t\t\t\t\tif (!discountEligable.limited_access)\n\t\t\t\t\t{\n\t\t\t\t\t\tupdateActiveOrder(true, true);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\taddPaymentToLockedOrder(true, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('<input>').attr({\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'changeList',\n\t\t\t\t\t\tvalue: JSON.stringify(changeList)\n\t\t\t\t\t}).appendTo($(form));\n\n\t\t\t\t\t$('<input>').attr({\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'changeListStr',\n\t\t\t\t\t\tvalue: getChangeListHTML()\n\t\t\t\t\t}).appendTo($(form));\n\n\t\t\t\t\t$(\"#submit_changes\").val(\"true\");\n\t\t\t\t\t$(\"#editorForm\").submit();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n}\n\nfunction resetPage()\n{\n\tintenseLogging(\"resetPage() called\");\n\n\tbounce(window.location.href);\n}\n\nfunction confirm_and_check_form(form)\n{\n\n\tintenseLogging(\"confirm_and_check_form() called\");\n\n\tif (orderState == 'NEW' || orderState == 'SAVED')\n\t{\n\t\treturn false;\n\t}\n\n\treturn _check_form(form);\n}\n\n// rounds to the nearest penny\n// move to global once this is found to be reliable\nfunction dd_round_amount(inAmount)\n{\n\tinAmount += .000005;\n\n\tvar tempVal = inAmount * 1000.0;\n\ttempVal = parseInt(tempVal);\n\ttempVal = tempVal / 10;\n\tvar pennyFraction = tempVal - Math.floor(tempVal);\n\tif (pennyFraction >= .5)\n\t{\n\t\ttempVal = Math.floor(tempVal) + 1;\n\t}\n\telse\n\t{\n\t\ttempVal = Math.floor(tempVal);\n\t}\n\n\treturn tempVal / 100;\n}\n\n/*\n\n function reportTestFailure(testNum, actual, correct)\n {\n if (actual != correct)\n {\n alert(\"Test #: \" + testNum + \" actual: \" + actual + \" correct: \" + correct);\n }\n }\n\n function doTests()\n {\n\n var testmultiplier = \".5\";\n\n var testNum = \"260.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(1, newResult, 130.05);\n\n var testNum = \"209.10\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(2, newResult, 104.55);\n\n testNum = \"209.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(3, newResult, 104.55);\n\n testNum = \"209\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(4, newResult, 104.5);\n\n testNum = \"1\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(5, newResult, .5);\n\n testNum = \"0\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(6, newResult, 0);\n\n testNum = \".05\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(7, newResult, .03);\n\n testNum = \".005\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(8, newResult, 0);\n\n testNum = \"499.99\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(9, newResult, 250);\n\n var testNum = \"209.10\";\n var testmultiplier = \".12\";\n\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(10, newResult, 25.09);\n\n testNum = \"209.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(11, newResult, 25.09);\n\n testNum = \"209\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(12, newResult, 25.08);\n\n testNum = \"1\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(13, newResult, .12);\n\n testNum = \"0\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(14, newResult, 0);\n\n testNum = \".05\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(15, newResult, .01);\n\n testNum = \".005\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(16, newResult, 0);\n\n testNum = \"499.99\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(17, newResult, 60);\n\n }\n\n doTests();\n\n */\n\n// this massive function is called anytime something that affects costs or payments is altered\nfunction calculateTotal()\n{\n\tlet total = 0;\n\tlet entrees = 0;\n\tlet servings = 0;\n\tlet core_servings = 0;\n\tlet halfQty = 0;\n\tlet wholeQty = 0;\n\tlet customizableMealQty = 0;\n\tlet introQty = 0;\n\tlet sideDishQty = 0;\n\tlet sideDishSubTotal = 0;\n\tlet bundlesSubTotal = 0;\n\tlet productsSubTotal = 0;\n\tlet coreItemsSubtotal = 0;\n\tlet bundlesQty = 0;\n\tlet discounted_total = 0;\n\tlet creditContribution = 0;\n\tlet main_items_count = 0;\n\tlet bundleIsSelected = false;\n\tlet PUDExcludedItemsTotal = 0;\n\tlet PUDExcludedFullItemsCount = 0;\n\tlet PUDExcludedHalfItemsCount = 0;\n\tlet creditConsumed = 0;\n\tlet hasServiceFeeWithMFYCoupon = false;\n\tlet hasDeliveryFeeWithCoupon = false;\n\tlet miscNonFoodSubtotal = 0;\n\tlet serviceFee = 0;\n\tvar num_boxes = 0;\n\n\tfor (var x in entreeIDToInventoryMap)\n\t{\n\t\tentreeIDToInventoryMap[x].remaining = entreeIDToInventoryMap[x].org_remaining;\n\t\t$('#inv_' + x).html(entreeIDToInventoryMap[x].org_remaining + \"/serv\");\n\t}\n\n\t// ---------------------------------------------------------- Items\n\t$(\"[id^='box_inst_id_']\").each(function () {\n\t\tlet box_local_id = this.id.split(\"_\")[2];\n\n\t\tlet cost = $(this).data(\"box_price\");\n\t\tlet items_in_box = $(this).data(\"number_items_required\");\n\t\tlet servings_in_box = $(this).data(\"number_servings_required\");\n\t\ttotal += (cost * 1);\n\t\tmain_items_count += items_in_box;\n\t\tservings += servings_in_box;\n\t\tnum_boxes++;\n\t});\n\n\tdiscounted_total = total;\n\n\t// update the entree and serving totals display\n\t$('#OEH_item_count').html(main_items_count);\n\t$('#OEH_number_servings').html(servings);\n\t$('#OEH_number_boxes').html(num_boxes);\n\n\tdiscounted_total = Math.round(discounted_total * 100) / 100;\n\n\t// --------------------------------------------------------------------- menu items subtotal\n\t$('#orderSubTotal').val(formatAsMoney(Math.round(total * 100) / 100));\n\t$('#OEH_menu_subtotal').html(formatAsMoney(discounted_total));\n\t$('#orderTotal').val(formatAsMoney(discounted_total));\n\n\t// ------------------------------------------------------ food subtotal\n\n\t$('#OEH_menu_subtotal').html(formatAsMoney((discounted_total * 1)));\n\n\tvar newGrandTotal = discounted_total;\n\tvar pre_discounts_grand_total = newGrandTotal;\n\n\t// -------------------------------DISCOUNTS-----------------------------------------\n\t// ---------------------------------------------- Direct Order\n\tvar directDiscountVal = Number(0);\n\n\tdirectDiscount = $('#direct_order_discount');\n\n\tif (directDiscount.length)\n\t{\n\t\tdirectDiscountVal = directDiscount.val();\n\n\t\tif (isNaN(directDiscountVal))\n\t\t{\n\t\t\tdirectDiscountVal = 0;\n\t\t}\n\n\t\tif (directDiscountVal > pre_discounts_grand_total)\n\t\t{\n\t\t\tdirectDiscountVal = pre_discounts_grand_total;\n\t\t\tdirectDiscount.val(directDiscountVal);\n\t\t}\n\n\t\tif (directDiscountVal)\n\t\t{\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - directDiscountVal);\n\t\t}\n\n\t\t$('#OEH_direct_order_discount').html(formatAsMoney(directDiscountVal));\n\n\t}\n\n\t//----------------------------------------------------Dinner Dollars\n\tdiscountablePlatePointsAmount = handleDinnerDollars(newGrandTotal);\n\n\t// ------------------------------------------------------------------- coupon Discount\n\n\tif (couponDiscountMethod == 'PERCENT')\n\t{\n\t\tlet CouponCodeStr = $('#coupon_code').val();\n\t\tvar newDiscountAmount = 0;\n\t\ttry\n\t\t{\n\t\t\t//this method correctly handles rounding in a way that matches server side\n\t\t\tlet formatterUSD = new Intl.NumberFormat('en-US', {\n\t\t\t\tminimumFractionDigits: 2,\n\t\t\t\tmaximumFractionDigits: 2\n\t\t\t});\n\t\t\tif (CouponCodeStr == 'VOLUME')\n\t\t\t{\n\t\t\t\tnewDiscountAmount = formatterUSD.format(coreItemsSubtotal * (couponDiscountVar / 100))\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewDiscountAmount = formatterUSD.format(pre_discounts_grand_total * (couponDiscountVar / 100))\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\t//original way which lead to off-by-one issue compared to server's method of rounding\n\t\t\tif (CouponCodeStr == 'VOLUME')\n\t\t\t{\n\t\t\t\tnewDiscountAmount = Math.floor(coreItemsSubtotal * (couponDiscountVar));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewDiscountAmount = Math.floor(pre_discounts_grand_total * (couponDiscountVar));\n\t\t\t}\n\n\t\t\tnewDiscountAmount /= 100;\n\t\t}\n\n\t\t$('#couponValue').val(newDiscountAmount);\n\t}\n\n\tif (couponlimitedToFT)\n\t{\n\t\tif (couponDiscountMethod == 'FLAT')\n\t\t{\n\t\t\tlet newDiscountVal = sideDishSubTotal;\n\n\t\t\tif (newDiscountVal > couponDiscountVar)\n\t\t\t{\n\t\t\t\tnewDiscountAmount = couponDiscountVar;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewDiscountAmount = newDiscountVal;\n\t\t\t}\n\t\t}\n\n\t\tif (couponDiscountMethod == 'PERCENT')\n\t\t{\n\t\t\tlet newDiscountVal = sideDishSubTotal;\n\n\t\t\tvar newDiscountAmount = Math.floor(newDiscountVal * (couponDiscountVar));\n\n\t\t\tnewDiscountAmount /= 100;\n\t\t}\n\n\t\t$('#couponValue').val(newDiscountAmount);\n\t}\n\n\tlet couponDiscountVal = Number(0);\n\tcouponDiscount = $('#couponValue');\n\n\tif (couponDiscount.length)\n\t{\n\t\tif (couponDiscount.val() == \"\")\n\t\t{\n\t\t\tcouponDiscount.val('0.00');\n\t\t}\n\t\tcouponDiscountVal = couponDiscount.val();\n\t}\n\n\tlet couponDiscountValIsServiceFee = false;\n\tlet couponDiscountValIsDeliveryFee = false;\n\n\tif (typeof coupon != 'undefined')\n\t{\n\t\tif (coupon.limit_to_mfy_fee == '1' && coupon.discount_method == 'FLAT')\n\t\t{\n\t\t\tlet currentServiceFee = $(\"#subtotal_service_fee\").val();\n\t\t\tif (couponDiscountVal != currentServiceFee)\n\t\t\t{\n\t\t\t\tcouponDiscountVal = currentServiceFee;\n\t\t\t}\n\n\t\t\tcouponDiscountValIsServiceFee = true;\n\t\t}\n\n\t\tif (coupon.limit_to_delivery_fee == '1')\n\t\t{\n\t\t\tlet currentDeliveryFee = $(\"#subtotal_delivery_fee\").val();\n\n\t\t\tif (coupon.discount_method == 'FLAT')\n\t\t\t{\n\t\t\t\tif (couponDiscountVal != currentDeliveryFee)\n\t\t\t\t{\n\t\t\t\t\tif (parseFloat(couponDiscountVal) > parseFloat(currentDeliveryFee))\n\t\t\t\t\t{\n\t\t\t\t\t\tcouponDiscountVal = currentDeliveryFee;\n\t\t\t\t\t\tcouponDiscountValIsDeliveryFee = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcouponDiscountVal = formatAsMoney(currentDeliveryFee * (coupon.discount_var / 100));\n\t\t\t\tcouponDiscountValIsDeliveryFee = true;\n\t\t\t}\n\t\t}\n\n\t\tif (coupon.limit_to_core == '1')\n\t\t{\n\t\t\tlet base = coreItemsSubtotal;\n\n\t\t\tif (coupon.discount_method == 'FLAT')\n\t\t\t{\n\t\t\t\tif (base > coupon.discount_var)\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = coupon.discount_var;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(base);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (coupon.discount_method == 'PERCENT')\n\t\t\t{\n\t\t\t\tcouponDiscountVal = formatAsMoney(base * (coupon.discount_var / 100));\n\t\t\t}\n\t\t}\n\n\t\tif (coupon.limit_to_core_and_efl == '1')\n\t\t{\n\t\t\tlet base = coreItemsSubtotal + eflItemsSubtotal;\n\n\t\t\tif (coupon.discount_method == 'FLAT')\n\t\t\t{\n\t\t\t\tif (base > coupon.discount_var)\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = coupon.discount_var;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(base);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (coupon.discount_method == 'PERCENT')\n\t\t\t{\n\t\t\t\tcouponDiscountVal = formatAsMoney(base * (coupon.discount_var / 100));\n\t\t\t}\n\t\t}\n\n\t\tif (coupon.limit_to_finishing_touch == '1')\n\t\t{\n\t\t\tlet base = sideDishSubTotal;\n\n\t\t\tif (coupon.discount_method == 'FLAT')\n\t\t\t{\n\t\t\t\tif (base > coupon.discount_var)\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = coupon.discount_var;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(base);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (coupon.discount_method == 'PERCENT')\n\t\t\t{\n\t\t\t\tcouponDiscountVal = formatAsMoney(base * (coupon.discount_var / 100));\n\t\t\t}\n\t\t}\n\n\t\tif (coupon.limit_to_recipe_id == '1')\n\t\t{\n\t\t\tlet prc_str = $('#prc_' + coupon.menu_item_id).text();\n\n\t\t\tif (coupon.discount_method == 'FLAT')\n\t\t\t{\n\t\t\t\tif (prc_str > coupon.discount_var)\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(prc_str - coupon.discount_var);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcouponDiscountVal = formatAsMoney(prc_str);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (coupon.discount_method == 'PERCENT')\n\t\t\t{\n\t\t\t\tcouponDiscountVal = formatAsMoney(prc_str * (coupon.discount_var / 100));\n\t\t\t}\n\t\t}\n\n\t\t$('#couponValue').val(couponDiscountVal);\n\t}\n\n\tif (couponDiscountVal)\n\t{\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - couponDiscountVal);\n\t\t$('#OEH_coupon_discount').html(formatAsMoney(couponDiscountVal));\n\t}\n\n\tvar curPPDiscount = 0;\n\t// ----------------------------------------------  PLATEPOINTS Discount\n\tif ($('#plate_points_discount').length)\n\t{\n\t\tcurPPDiscount = $('#plate_points_discount').val();\n\t\tif (curPPDiscount * 1 > discountablePlatePointsAmount * 1)\n\t\t{\n\t\t\tcurPPDiscount = discountablePlatePointsAmount;\n\n\t\t\tif (curPPDiscount == 0)\n\t\t\t{\n\t\t\t\t$('#plate_points_discount').val(\"\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#plate_points_discount').val(formatAsMoney(curPPDiscount));\n\t\t\t}\n\t\t}\n\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(curPPDiscount));\n\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - curPPDiscount);\n\t}\n\n\t// ----------------------------------------------------------Membership Discount\n\n\tif (orderIsEligibleForMembershipDiscount && storeSupportsMembership)\n\t{\n\t\tvar couponAdjustment = Number(0);\n\t\tif (couponDiscountValIsServiceFee || couponDiscountValIsDeliveryFee)\n\t\t{\n\t\t\tcouponAdjustment = couponDiscountVal;\n\t\t}\n\n\t\tvar membership_discount_basis = Number((newGrandTotal * 1) + (couponAdjustment * 1));\n\t\tvar memberDiscountAmount = Number(membership_discount_basis * (membership_status.discount_var / 100));\n\t\tmemberDiscountAmount = Math.round(memberDiscountAmount * 100) / 100;\n\n\t\t$(\"#OEH_membership_discount\").html(formatAsMoney(memberDiscountAmount));\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - memberDiscountAmount);\n\n\t}\n\n\tvar deliveryFee = Number(0);\n\tif ($('#subtotal_delivery_fee')[0])\n\t{\n\t\tdeliveryFee = Number($('#subtotal_delivery_fee').val());\n\t\t$('#OEH_subtotal_delivery_fee').html(formatAsMoney(deliveryFee));\n\n\t\tnewGrandTotal = Number((newGrandTotal * 1) + (deliveryFee * 1));\n\n\t\tvar newFoodTotal = newGrandTotal - (deliveryFee * 1);\n\t}\n\n\t// --------------------------------------------------------------------- tax\n\tvar newDeliveryTax = 0;\n\tvar newNonFoodTax = 0; // convert to float\n\n\tif (!hasDeliveryFeeWithCoupon)\n\t{\n\t\tnewDeliveryTax = formatAsMoney(deliveryFee * (curDeliveryTax / 100));\n\t}\n\n\tif (productsSubTotal)\n\t{\n\t\t$('#nonFoodTaxLabel').html('Non-Food & Enrollment Tax');\n\t}\n\telse\n\t{\n\t\t$('#nonFoodTaxLabel').html('Non-Food Tax');\n\n\t}\n\n\tlet newFoodTax = 0;\n\tlet newServiceTax = 0;\n\n\tif (curPPDiscount > 0)\n\t{\n\t\tlet food_portion_of_points_credit = 0;\n\t\tlet fee_portion_of_points_credit = 0;\n\n\t\tif (hasServiceFeeWithMFYCoupon)\n\t\t{\n\t\t\tfood_portion_of_points_credit = curPPDiscount;\n\t\t\tfee_portion_of_points_credit = 0;\n\t\t}\n\t\telse if (discountMFYFeeFirst && serviceFee > 0)\n\t\t{\n\n\t\t\tif (curPPDiscount > serviceFee)\n\t\t\t{\n\t\t\t\tfood_portion_of_points_credit = curPPDiscount - serviceFee;\n\t\t\t\tfee_portion_of_points_credit = serviceFee;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfee_portion_of_points_credit = curPPDiscount;\n\t\t\t\tfood_portion_of_points_credit = 0;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet foodPortionOfMaxDeduction = discountablePlatePointsAmount - serviceFee;\n\n\t\t\tif (curPPDiscount > foodPortionOfMaxDeduction)\n\t\t\t{\n\t\t\t\tlet remainderAfterFoodDiscount = curPPDiscount - foodPortionOfMaxDeduction;\n\t\t\t\tfood_portion_of_points_credit = foodPortionOfMaxDeduction;\n\t\t\t\tfee_portion_of_points_credit = remainderAfterFoodDiscount;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfood_portion_of_points_credit = curPPDiscount;\n\t\t\t\tfee_portion_of_points_credit = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (hasServiceFeeWithMFYCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - food_portion_of_points_credit - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewServiceTax = 0;\n\t\t}\n\t\telse if (hasDeliveryFeeWithCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - food_portion_of_points_credit - serviceFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewDeliveryTax = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - serviceFee - food_portion_of_points_credit - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tlet mealCustomizationFee = Number($('#subtotal_meal_customization_fee').val())\n\t\t\tif (isNaN(mealCustomizationFee))\n\t\t\t{\n\t\t\t\tmealCustomizationFee = 0;\n\t\t\t}\n\t\t\tnewServiceTax = formatAsMoney(((((serviceFee + mealCustomizationFee) - fee_portion_of_points_credit)) * (curServiceTax / 100)) + .000001);\n\t\t}\n\n\t\t$('#OEH_plate_points_order_discount_food').html(formatAsMoney(food_portion_of_points_credit));\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(fee_portion_of_points_credit));\n\t}\n\telse\n\t{\n\t\tif (hasServiceFeeWithMFYCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewServiceTax = 0;\n\t\t}\n\t\telse if (hasDeliveryFeeWithCoupon)\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - serviceFee) * (curFoodTax / 100)) + .000001);\n\t\t\tnewDeliveryTax = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - serviceFee - deliveryFee) * (curFoodTax / 100)) + .000001);\n\t\t\tlet mealCustomizationFee = Number($('#subtotal_meal_customization_fee').val())\n\t\t\tif (isNaN(mealCustomizationFee))\n\t\t\t{\n\t\t\t\tmealCustomizationFee = 0;\n\t\t\t}\n\t\t\tnewServiceTax = formatAsMoney((serviceFee + mealCustomizationFee) * (curServiceTax / 100) + .000001);\n\t\t}\n\n\t\t$('#OEH_plate_points_order_discount_food').html(formatAsMoney(0));\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(0));\n\t}\n\n\ttaxElem = document.getElementById('OEH_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newNonFoodTax);\n\t}\n\n\ttaxElem = document.getElementById('OEH_food_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newFoodTax);\n\t}\n\n\ttaxElem = document.getElementById('OEH_delivery_tax_subtotal');\n\tif (taxElem)\n\t{\n\t\ttaxElem.innerHTML = formatAsMoney(newDeliveryTax);\n\t}\n\n\tvar preTaxTotal = Number(newGrandTotal);\n\tnewGrandTotal = (newGrandTotal * 1) + (newFoodTax * 1) + (newNonFoodTax * 1) + (newDeliveryTax * 1);\n\n\t// -------------------------------------------------------------------- grand total\n\t$('#OEH_grandtotal').html(formatAsMoney(newGrandTotal));\n\t$('#OEH_new_total').html(formatAsMoney(newGrandTotal));\n\t$('#OEH_delta').html(formatAsMoney((orderInfoGrandTotal - newGrandTotal) * -1));\n\n\tvar paymentTotal = 0;\n\tif ($('#OEH_paymentsTotal').length)\n\t{\n\t\tpaymentTotal = $('#OEH_paymentsTotal').html();\n\t}\n\n\tvar remainingBalance = Number(formatAsMoney(paymentTotal - newGrandTotal));\n\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance * -1));\n\n\t// Values are now calculated and the summary display updated\n\t// Next Display \"balance\" messages and set up payments\n\n\tif (orderState == 'CANCELLED')\n\t{\n\t\tremainingBalance = paymentTotal;\n\t\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance));\n\n\t}\n\n\tif (remainingBalance > 0)\n\t{\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to the customer.\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_customer_owed');\n\t\t$(\"#newPaymentDiv\").hide();\n\n\t\tif (canAdjustDelayedPayment && currentDPAmount > 0)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').show();\n\t\t}\n\n\t\t$('#payment1_type').val('');\n\t\t$('#payment2_type').val('');\n\t\tchangePayment1('');\n\t\tchangePayment2('');\n\n\t\tpaymentChanges = true;\n\n\t\t$(\"#use_store_credits\").prop('checked', false);\n\t\t$(\"#use_store_credits\").prop('disabled', true);\n\n\t}\n\telse if (remainingBalance < 0)\n\t{\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to your store.\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_store_owed');\n\t\t$(\"#newPaymentDiv\").show();\n\t\t$('#creditDiv').hide();\n\n\t\tif (canAdjustDelayedPayment)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').hide();\n\t\t}\n\n\t\t$(\"#use_store_credits\").prop('disabled', false);\n\n\t\tvar doNewLivePaymentAdjustments = true;\n\t\tif (doNewLivePaymentAdjustments)\n\t\t{\n\n\t\t\tvar defaultPaymentAmount = remainingBalance * -1;\n\n\t\t\tif ($(\"#use_store_credits\").is(\":checked\"))\n\t\t\t{\n\n\t\t\t\tvar amountStoreCredit = Number($(\"#store_credits_amount\").val());\n\t\t\t\tif (isNaN(amountStoreCredit.valueOf()))\n\t\t\t\t{\n\t\t\t\t\tamountStoreCredit = Number(0);\n\t\t\t\t}\n\n\t\t\t\tdefaultPaymentAmount -= amountStoreCredit.valueOf();\n\t\t\t}\n\n\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount);\n\n\t\t\tif ($('#payment1_type').val() == 'CC')\n\t\t\t{\n\t\t\t\t$('#payment1_cc_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if ($('#payment1_type').val() == 'CHECK')\n\t\t\t{\n\t\t\t\t$('#payment1_check_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if ($('#payment1_type').val().split(\"_\")[0] == 'REF')\n\t\t\t{\n\t\t\t\t$('#payment1_ref_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if (($('#payment1_type').val() == 'GIFT_CERT' || $('#payment1_type').val() == \"GIFT_CARD\") && $('#payment2_type').val() != \"\")\n\t\t\t{\n\t\t\t\tvar payment1Amount = null;\n\t\t\t\tif ($('#payment1_type').val() == 'GIFT_CERT')\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number($('#payment1_gc_total_amount').val());\n\t\t\t\t}\n\t\t\t\telse if ($('#payment1_type').val() == 'GIFT_CARD')\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number($('#debit_gift_card_amount').val());\n\t\t\t\t}\n\n\t\t\t\tif (isNaN(payment1Amount.valueOf()))\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number(0);\n\t\t\t\t}\n\n\t\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount - payment1Amount.valueOf());\n\t\t\t\tif ($('#payment2_type').val() == 'CC')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_cc_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\t\t\t\telse if ($('#payment2_type').val() == 'CHECK')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_check_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\t\t\t\telse if ($('#payment2_type').val() == 'CASH')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_cash_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\t\t\t\telse if ($('#payment2_type').val().split(\"_\")[0] == 'REF')\n\t\t\t\t{\n\t\t\t\t\t$('#payment2_ref_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t}\n\telse // == 0\n\t{\n\t\t$(\"#balance_msg\").html(\"0.00\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_balanced');\n\t\t$(\"#newPaymentDiv\").show();\n\t\t$('#creditDiv').hide();\n\n\t\tif (canAdjustDelayedPayment)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').hide();\n\t\t}\n\n\t\t$(\"#use_store_credits\").prop('disabled', false);\n\n\t\tassignBalanceToRefTransactions(0);\n\t}\n\n\tvar autoAdjustDiv = $('#autoAdjustDiv');\n\tif (autoAdjustDiv.length)\n\t{\n\n\t\tif (remainingBalance != 0 && canAutoAdjust)\n\t\t{\n\t\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || remainingBalance < 0))\n\t\t\t{\n\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>adjust customer's delayed payment.</b></span>\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (remainingBalance > 0)\n\t\t\t\t{\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>credit customer's credit card now.</b></span>\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>charge original credit card now.</b></span>\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tautoAdjustDiv.show();\n\t\t\tif (!forceManualAutoAdjust)\n\t\t\t{\n\t\t\t\t$('#autoAdjust').prop('checked', true);\n\t\t\t\thandleAutoAdjust($('#autoAdjust').get()[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// if the div is hidden skip these steps\n\n\t\t\tif (autoAdjustDiv.is(\":visible\"))\n\t\t\t{\n\t\t\t\tautoAdjustDiv.hide();\n\t\t\t\t$('#autoAdjust').prop('checked', false);\n\t\t\t\t$('#payment1_type').val('');\n\t\t\t\t$('#payment2_type').val('');\n\t\t\t\tchangePayment1('');\n\t\t\t\tchangePayment2('');\n\t\t\t}\n\t\t}\n\t}\n\n\t$('#help_msg').html(\"\");\n\n\t// enforce a few rules by disallowing checkout\n\tif ($('#submit_changes').length)\n\t{\n\n\t\tif (servings > 0)\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\n\t\t}\n\n\t\tif (directDiscountVal >= (Number(preTaxTotal) + Number(directDiscountVal)) && preTaxTotal != 0)\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\n\t\t\t$('#help_msg').html($('#help_msg').html() + \"You cannot use a Direct Order Discount that is equal to or greater than the food cost total. Please use the \\\"No Charge\\\" payment type to give away an order.\");\n\t\t}\n\n\t}\n\n\tif ($('#help_msg').length)\n\t{\n\t\tif ($('#help_msg').html() != \"\")\n\t\t{\n\t\t\t$('#help_msg').show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#help_msg').hide();\n\t\t}\n\t}\n\n\treportPaymentStatus(false);\n\n\tHideLineItemsIfZero();\n\n\tif (orderState != 'NEW')\n\t{\n\t\tupdateChangeList();\n\t}\n\n}\n\nfunction handleDinnerDollars(total)\n{\n\n\t//var serviceFee = Number(document.getElementById('OEH_subtotal_delivery_fee').value);\n\tvar discountablePlatePointsAmount = total;// + serviceFee.valueOf();\n\n\tif (discountablePlatePointsAmount != lastMaxPPDiscountAmount && lastMaxPPDiscountAmount != -1)\n\t{\n\t\tneedPlatePointsMaxDiscountChangeWarning = true;\n\t}\n\n\tlastMaxPPDiscountAmount = discountablePlatePointsAmount;\n\n\tif (discountablePlatePointsAmount < 0)\n\t{\n\t\tdiscountablePlatePointsAmount = 0;\n\t}\n\n\t$(\"#max_plate_points_deduction\").html(formatAsMoney(discountablePlatePointsAmount))\n\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\n\n\tif (maxPPDeduction < curPPDiscount)\n\t{\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\n\t}\n\n\tif (maxPPCredit > maxPPDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tvar platePointsDiscountOrg = Number($('#OEH_plate_points_discount_org_fee').html());\n\tvar platePointsDiscount = Number($('#OEH_plate_points_order_discount_fee').html());\n\n\tif (platePointsDiscountOrg == 0 && platePointsDiscount == 0)\n\t{\n\t\t$('#dinnerDollarsDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#dinnerDollarsDiscountRow').show();\n\t}\n\n\treturn discountablePlatePointsAmount;\n}\n\n$(document).on('change', '#shipping_phone_number', function (e) {\n\n\t$('.shipping_phone_number_new_div').hideFlex();\n\t$('#shipping_phone_number_new').prop('required', false);\n\n\tif ($(this).val() == 'new')\n\t{\n\t\t$('.shipping_phone_number_new_div').showFlex();\n\t\t$('#shipping_phone_number_new').prop('required', true);\n\n\t}\n});\n\n$(document).on('change keyup', '.delivery-input', function (e) {\n\n\tdeliveryChanges = false;\n\n\t$('.delivery-input').each(function () {\n\n\t\tif ($(this).data('org_value'))\n\t\t{\n\t\t\tvar val = $(this).val();\n\t\t\tvar org_value = $(this).data('org_value');\n\n\t\t\tif (val != org_value)\n\t\t\t{\n\t\t\t\tdeliveryChanges = true;\n\n\t\t\t}\n\t\t}\n\n\t});\n\n\tupdateChangeList();\n\n});\n$(document).on('change', '#address_book_select', function (e) {\n\n\tlet id = $(this).val();\n\n\tif (id)\n\t{\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\n\t\t\t\top: 'retrieve_address_from_address_book',\n\t\t\t\taddress_id: id,\n\t\t\t\tuser_id: user_id\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\t$('#shipping_firstname').val(json.address.firstname);\n\t\t\t\t\t$('#shipping_lastname').val(json.address.lastname);\n\t\t\t\t\t$('#shipping_address_line1').val(json.address.address_line1);\n\t\t\t\t\t$('#shipping_address_line2').val(json.address.address_line2);\n\t\t\t\t\t$('#shipping_city').val(json.address.city);\n\t\t\t\t\t$('#shipping_state_id').val(json.address.state_id);\n\t\t\t\t\t$('#shipping_postal_code').val(json.address.postal_code);\n\t\t\t\t\t$('#shipping_address_note').val(json.address.address_note);\n\t\t\t\t\t$('#shipping_phone_number').val(json.address.telephone_1);\n\t\t\t\t\t$('#shipping_gift_email_address').val(json.address.email_address);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Address Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n});"],"mappings":"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","ignoreList":[]}
{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_mgr_delivered.js"],"sourcesContent":["var itemChanges = false;\r\nvar discountOrPaymentChanges = false;\r\nvar deliveryChanges = false;\r\nvar discountChanges = false;\r\nvar reportingChanges = false;\r\nvar paymentChanges = false;\r\nvar changeList = null;\r\nvar currentlySavingOrder = false;\r\nvar intenseLoggingOn = true;\r\nvar boxesDeletedFromActiveOrder = []; // for showing box deletions in change list\r\n\r\nvar needPlatePointsMaxDiscountChangeWarning = false;\r\nvar lastMaxPPDiscountAmount = -1;\r\n\r\nfunction admin_order_mgr_init()\r\n{\r\n\r\n\tif (store_id != STORE_DETAILS.id)\r\n\t{\r\n\t\tSTORE_DETAILS.id = store_id;\r\n\r\n\t\t//STORE_DETAILS.id is either the current fadmin store - in which case a match is guaranteed or\r\n\t\t// is the current Site Admin store (last selection from a store drop down.) However in this case if the order was accessed by the address\r\n\t\t// bar a match is not guaranteed so force STORE_DETAILS.id to store_id which is always the store of the order\r\n\t}\r\n\r\n\tif (orderState == 'NEW')\r\n\t{\r\n\t\tsetupForNewOrder();\r\n\t}\r\n\telse if (orderState == 'SAVED')\r\n\t{\r\n\t\tsetupForSavedOrder();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tsetupForActiveOrder();\r\n\t}\r\n\r\n\tinitChangeList();\r\n\tinit_inside_box_editing();\r\n\r\n\tif (orderState != 'NEW')\r\n\t{\r\n\t\tcalculateTotal();\r\n\t\tsetAllPaymentFieldsToUnrequired();\r\n\t\tsetupCouponState();\r\n\t}\r\n\r\n\tsetUpKeyHandlers();\r\n\r\n\thandle_special_instruction_notes();\r\n\thandle_cancel_order_delivered();\r\n\thandle_delete_saved_order_delivered();\r\n\r\n\thandle_free_menu_item_edit();\r\n\thandleDirectOrderDiscountFocusing();\r\n\r\n\t$('#shipping_phone_number').trigger('change');\r\n\r\n\tupdateInventory();\r\n\r\n\thandle_is_gift();\r\n\r\n}\r\n\r\nfunction handleSessionSelection()\r\n{\r\n\t$(\"[data-select_delivery_day]\").on('click', function () {\r\n\t\tlet selected_session_id = $(this).data(\"select_delivery_day\");\r\n\t\tlet sessionDate = $(this).data(\"date\");\r\n\t\tdoReschedule(selected_session_id, sessionDate);\r\n\t});\r\n\r\n}\r\n\r\nfunction handle_is_gift()\r\n{\r\n\tif ($(\"#shipping_is_gift\").is(':checked'))\r\n\t{\r\n\t\t$(\".shipping_email_address_div\").show();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\".shipping_email_address_div\").hide();\r\n\t}\r\n\r\n\t$(\"#shipping_is_gift\").on('change', function () {\r\n\t\tif ($(this).is(':checked'))\r\n\t\t{\r\n\t\t\t$(\".shipping_email_address_div\").show();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\".shipping_email_address_div\").hide();\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nfunction validateBoxes()\r\n{\r\n\tlet hasAtLeastOneBox = false;\r\n\tlet noCustomBoxesAreIncomplete = true;\r\n\r\n\t$(\"[id^='box_inst_id_']\").each(function () {\r\n\t\tlet list_id = this.id.split(\"_\")[3];\r\n\r\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\r\n\t\t{\r\n\t\t\thasAtLeastOneBox = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\thasAtLeastOneBox = true;\r\n\r\n\t\t\tlet itemCount = 0;\r\n\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\r\n\t\t\t\titemCount += ($(this).val() * 1);\r\n\t\t\t});\r\n\r\n\t\t\tlet number_items_required = $(\"#box_inst_id_\" + list_id).data(\"number_items_required\");\r\n\r\n\t\t\tif (number_items_required != itemCount)\r\n\t\t\t{\r\n\t\t\t\tnoCustomBoxesAreIncomplete = false;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn (hasAtLeastOneBox && noCustomBoxesAreIncomplete);\r\n}\r\n\r\nfunction countItemsInBox(box_instance_id)\r\n{\r\n\tlet retVal = 0;\r\n\t$(\"[id^='qty_\" + box_instance_id + \"_']\").each(function () {\r\n\t\tretVal += ($(this).val() * 1);\r\n\t});\r\n\r\n\treturn retVal;\r\n}\r\n\r\nfunction init_inside_box_editing()\r\n{\r\n\r\n\t$(\"[id^='qty_']\").off('click', function () {\r\n\r\n\t});\r\n\r\n\t$(\"[id^='qty_']\").on('change', function () {\r\n\t\tlet itemError = false;\r\n\t\tlet boxError = false;\r\n\r\n\t\tlet menu_item_id = this.id.split(\"_\")[2];\r\n\t\tlet box_inst_id = this.id.split(\"_\")[1];\r\n\t\tlet number_items_required = $(\"#box_inst_id_\" + box_inst_id).data(\"number_items_required\");\r\n\t\tlet newQty = $(this).val();\r\n\r\n\t\tlet curTotal = countItemsInBox(box_inst_id);\r\n\t\tif (curTotal > number_items_required)\r\n\t\t{\r\n\t\t\tlet delta = curTotal - number_items_required;\r\n\t\t\t$(this).val(newQty - delta);\r\n\t\t\tboxError = true;\r\n\t\t}\r\n\r\n\t\tnewQty = $(this).val();\r\n\r\n\t\tif (isNaN(newQty))\r\n\t\t{\r\n\t\t\tnewQty = 0;\r\n\t\t\t$(this).val(0);\r\n\t\t}\r\n\t\tif (newQty < 0)\r\n\t\t{\r\n\t\t\tnewQty = 0;\r\n\t\t\t$(this).val(0);\r\n\t\t}\r\n\r\n\t\tif (newQty - Math.floor(newQty) != 0)\r\n\t\t{\r\n\t\t\tnewQty = Math.floor(newQty);\r\n\t\t\t$(this).val(newQty);\r\n\t\t}\r\n\r\n\t\tlet lastQty = $(this).data('last_qty'); // last quantity is already removed from current_inventory array\r\n\t\tvar servings = $(this).data('servings_per_item');\r\n\t\tvar recipeID = $(this).data('recipe_id');\r\n\r\n\t\tif (newQty > 2)\r\n\t\t{\r\n\t\t\titemError = true;\r\n\t\t\t$(this).val(2);\r\n\t\t\tnewQty = 2;\r\n\t\t}\r\n\r\n\t\tlet new_servings_needed = (newQty - lastQty) * servings;\r\n\r\n\t\twhile (new_servings_needed > current_inventory[recipeID])\r\n\t\t{\r\n\t\t\tnewQty--;\r\n\t\t\tnew_servings_needed = (newQty - lastQty) * servings;\r\n\t\t}\r\n\r\n\t\t$(this).val(newQty);\r\n\t\t$(this).data('last_qty', newQty);\r\n\t\tcurrent_inventory[recipeID] -= new_servings_needed;\r\n\r\n\t\t$(\"[id^='inv_']\").filter(\"[data-recipe_id='\" + recipeID + \"']\").html(current_inventory[recipeID] + \"/serv\");\r\n\r\n\t\tupdateChangeList();\r\n\r\n\t\tif (boxError && itemError)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: \"Each box can only have up to 2 of the same menu item and a total of \" + number_items_required + \" items.\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if (itemError)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: \"Each box can only have up to 2 of the same menu item\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if (boxError)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: \"You can only add a total of \" + number_items_required + \" items to this box.\"\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction addToInitialInventory(list_id)\r\n{\r\n\r\n\tif ($(this).data(\"contents_are_fixed\") == true)\r\n\t{\r\n\t\t$(\"[id^='qty_\" + list_id + \"_']\").each(function () {\r\n\t\t\tvar curAmount = $(this).val();\r\n\t\t\tvar recipeID = $(this).data('recipe_id');\r\n\t\t\tvar servings = $(this).data('servings_per_item');\r\n\t\t\tvar curInv = initial_inventory[recipeID];\r\n\t\t\tvar adjInv = curInv + (curAmount * servings);\r\n\t\t\tinitial_inventory[recipeID] = adjInv;\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\r\n\t\t\tvar curAmount = $(this).val();\r\n\t\t\tvar recipeID = $(this).data('recipe_id');\r\n\t\t\tvar servings = $(this).data('servings_per_item');\r\n\t\t\tvar curInv = current_inventory[recipeID];\r\n\t\t\tvar adjInv = curInv + (curAmount * servings);\r\n\t\t\tinitial_inventory[recipeID] = adjInv;\r\n\t\t});\r\n\t}\r\n}\r\n\r\n$(document).on('click', '.add_box', function (e) {\r\n\r\n\tlet bundle_id = $(this).data(\"bundle_id\");\r\n\tlet box_id = $(this).data(\"box_id\");\r\n\tlet box_type = $(this).data(\"box_type\");\r\n\tlet box_label = $(this).data(\"box_label\");\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\top: 'add_box',\r\n\t\t\tbundle_id: bundle_id,\r\n\t\t\tbox_id: box_id,\r\n\t\t\tbox_type: box_type,\r\n\t\t\tbox_label: box_label,\r\n\t\t\tmenu_id: menu_id,\r\n\t\t\tstore_id: store_id,\r\n\t\t\torder_id: order_id,\r\n\t\t\tuser_id: user_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$(\"#box_editor\").append(json.html);\r\n\r\n\t\t\t\tlet currentDeliveryFee = $('#subtotal_delivery_fee').val();\r\n\t\t\t\tlet newDeliveryFee = Number(formatAsMoney(currentDeliveryFee)) + Number(formatAsMoney(json.bundle_info.price_shipping));\r\n\r\n\t\t\t\t$('#subtotal_delivery_fee').val(newDeliveryFee);\r\n\r\n\t\t\t\tupdateInventory();\r\n\t\t\t\tcalculateTotal();\r\n\t\t\t\tinit_inside_box_editing();\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n});\r\n\r\n$(document).on('click', '.box-delete', function (e) {\r\n\r\n\tlet box_inst_id = $(this).data('box_instance_id');\r\n\r\n\tif (orderState == 'ACTIVE')\r\n\t{\r\n\t\tlet currentDeliveryFee = $('#subtotal_delivery_fee').val();\r\n\t\tlet newDeliveryFee = Number(formatAsMoney(currentDeliveryFee)) - Number(formatAsMoney($(\"#box_inst_id_\" + box_inst_id).data('price_shipping')));\r\n\r\n\t\t$('#subtotal_delivery_fee').val(newDeliveryFee);\r\n\r\n\t\t// active orders defer database updates until finalized\r\n\t\taddToInitialInventory(box_inst_id);\r\n\t\tboxesDeletedFromActiveOrder[box_inst_id] = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\r\n\t\t$(\"#bi_\" + box_inst_id).remove();\r\n\t\tupdateInventory();\r\n\t\tcalculateTotal();\r\n\t\treturn;\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\top: 'delete_box',\r\n\t\t\tbox_inst_id: box_inst_id,\r\n\t\t\torder_id: order_id,\r\n\t\t\tuser_id: user_id\r\n\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$(\"#bi_\" + box_inst_id).remove();\r\n\t\t\t\tupdateInventory();\r\n\t\t\t\tcalculateTotal();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n\r\n});\r\n\r\nfunction updateInventory()\r\n{\r\n\r\n\t// re init current values\r\n\tcurrent_inventory = Object.assign({}, initial_inventory);\r\n\r\n\t// loop through all existing boxes and accumulate values in current_inventory\r\n\t// after items have been accumulated push numbers to the display\r\n\r\n\t$(\"[id^='box_inst_id_']\").each(function () {\r\n\r\n\t\tlet list_id = this.id.split(\"_\")[3];\r\n\r\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\r\n\t\t{\r\n\t\t\t$(\"[id^='qty_\" + list_id + \"_']\").each(function () {\r\n\t\t\t\tvar curAmount = $(this).val();\r\n\t\t\t\tvar claimedAmount = $(this).data('claimed_qty');\r\n\t\t\t\tcurAmount -= claimedAmount;\r\n\t\t\t\tvar recipeID = $(this).data('recipe_id');\r\n\t\t\t\tvar servings = $(this).data('servings_per_item');\r\n\t\t\t\tvar curInv = current_inventory[recipeID];\r\n\t\t\t\tvar adjInv = curInv - (curAmount * servings);\r\n\t\t\t\tcurrent_inventory[recipeID] = adjInv;\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\r\n\t\t\t\tvar curAmount = $(this).val();\r\n\t\t\t\tvar claimedAmount = $(this).data('claimed_qty');\r\n\t\t\t\tcurAmount -= claimedAmount;\r\n\t\t\t\tvar recipeID = $(this).data('recipe_id');\r\n\t\t\t\tvar servings = $(this).data('servings_per_item');\r\n\t\t\t\tvar curInv = current_inventory[recipeID];\r\n\t\t\t\tvar adjInv = curInv - (curAmount * servings);\r\n\t\t\t\tcurrent_inventory[recipeID] = adjInv;\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tfor (const recipe_id in current_inventory)\r\n\t{\r\n\r\n\t\t$(\"[id^='inv_']\").filter(\"[data-recipe_id='\" + recipe_id + \"']\").each(function () {\r\n\r\n\t\t\t// TODO:  item < serving per item is also out of stock\r\n\t\t\tif (current_inventory[recipe_id] == 0)\r\n\t\t\t{\r\n\t\t\t\t$(this).html('Out of stock');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$(this).html(current_inventory[recipe_id] + \"/serv\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction handleDirectOrderDiscountFocusing()\r\n{\r\n\r\n\t$(\"#plate_points_discount, #direct_order_discount\").focus(function (e) {\r\n\r\n\t\tif ($(this).val() == 0)\r\n\t\t{\r\n\t\t\t$(this).val(\"\");\r\n\t\t}\r\n\t\tif ($(this).val().length > 0)\r\n\t\t{\r\n\t\t\t$(this).select();\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#plate_points_discount, #direct_order_discount\").blur(function (e) {\r\n\r\n\t\tvar curVal = $(this).val();\r\n\t\tcurVal = (curVal.trim());\r\n\r\n\t\tif (curVal == \"\" || isNaN(curVal))\r\n\t\t{\r\n\t\t\t$(this).val(\"0\");\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction intenseLogging(message)\r\n{\r\n\tif (window.console && intenseLoggingOn)\r\n\t{\r\n\t\tconsole.log('OM Intense logging: ' + message);\r\n\t}\r\n}\r\n\r\nfunction saveSpecialInstructions()\r\n{\r\n\r\n\tvar special_instructions = strip_tags($(\"#order_user_notes\").val());\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'update_special_instructions',\r\n\t\t\torder_id: order_id,\r\n\t\t\tspecial_instructions: special_instructions\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tupdateInstructionsOrgValues();\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"saveSpecialInstructions: \" + json.processor_message);\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tintenseLogging(\"saveSpecialInstructions: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction handle_special_instruction_notes()\r\n{\r\n\t$('[id^=\"gd_special_instruction_note_button-\"]').each(function () {\r\n\r\n\t\t$(this).on('click', function (e) {\r\n\r\n\t\t\tvar booking_id = $(this).data('booking_id');\r\n\t\t\tvar user_id = $(this).data('user_id');\r\n\t\t\tvar do_op = 'get';\r\n\t\t\tvar special_instructions = '';\r\n\r\n\t\t\tif ($(this).data('edit_mode') == true)\r\n\t\t\t{\r\n\t\t\t\tdo_op = 'save';\r\n\r\n\t\t\t\tspecial_instructions = strip_tags($('#gd_special_instruction_note-' + booking_id + ' > textarea').val());\r\n\t\t\t}\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\t\top: 'update_special_instructions',\r\n\t\t\t\t\t'do': do_op,\r\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\t\tuser_id: user_id,\r\n\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\tnote: special_instructions\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (do_op == 'get')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar textarea_elem = $('<textarea></textarea>').addClass('form-control').val((json.special_instruction_note ? json.special_instruction_note : \"\")).on('keyup', function (e) {\r\n\r\n\t\t\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).addClass('special_instruction_note_edit').html(textarea_elem);\r\n\r\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', true).html('Save Note');\r\n\r\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).data('special_instruction_note_value', (json.special_instruction_note ? json.special_instruction_note : \"\")).on('click', function (e) {\r\n\r\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + $(this).data('booking_id')).removeClass('special_instruction_note_edit').html($(this).data('special_instruction_note_value'));\r\n\r\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + $(this).data('booking_id')).data('edit_mode', false).html('Special Instructions');\r\n\r\n\t\t\t\t\t\t\t\t$(this).hide();\r\n\r\n\t\t\t\t\t\t\t}).show();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).removeClass('special_instruction_note_edit').html(nl2br(json.special_instruction_note));\r\n\r\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).hide();\r\n\r\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', false).html('Special Instructions');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tintenseLogging(\"handle_special_instruction_notes: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction setUpKeyHandlers()\r\n{\r\n\tdocument.onkeypress = OMDefaultKeyHandler;\r\n\r\n\t$(\"#coupon_code\").on('keypress', function (evt) {\r\n\t\t// the enter key will submit a coupon code\r\n\t\tevt = (evt) ? evt : event;\r\n\t\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\r\n\r\n\t\tif (charCode == 13)\r\n\t\t{\r\n\t\t\tprocessCode();\r\n\t\t\tevt.stopPropagation();\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\t$(\"#order_user_notes\").on('keypress', function (evt) {\r\n\t\tevt.stopPropagation();\r\n\t\treturn true;\r\n\t});\r\n\r\n\t$(\"#payment1_gc_payment_number\").on('keyup', function (evt) {\r\n\r\n\t\tif ($(this).val().length == 15 && !isNaN($(this).val()) && $(this).val() != lastCheckedGiftCertNumber)\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Warning',\r\n\t\t\t\tmessage: \"It appears that you may be entering a gift Card number. If so, select Gift Card from payment selector. This is the Certificate (Gift Certificate) payment type.\"\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlastCheckedGiftCertNumber = $(this).val();\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n}\r\n\r\nfunction OMDefaultKeyHandler(evt)\r\n{\r\n\t// by default the document just eats the enter key\r\n\tevt = (evt) ? evt : event;\r\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\r\n\r\n\tif (charCode == 13)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction initChangeList()\r\n{\r\n\t$(\"#changeListTab\").on('click', function () {\r\n\r\n\t\tvar html = getChangeListHTML();\r\n\r\n\t\tif (!html || html == \"\")\r\n\t\t{\r\n\t\t\thtml = \"<h3><i>No Changes</i></h3>\"\r\n\t\t}\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Change List',\r\n\t\t\tmessage: html,\r\n\t\t\theight: 620,\r\n\t\t\twidth: 300,\r\n\t\t\tmodal: false,\r\n\t\t\tdiv_id: 'changelist',\r\n\t\t\tdialogClass: 'fixedDialog',\r\n\t\t\tnoOk: true,\r\n\t\t\tposition: {\r\n\t\t\t\tmy: \"left top\",\r\n\t\t\t\tat: \"left bottom\",\r\n\t\t\t\tof: this\r\n\t\t\t},\r\n\t\t\tclose: function (event, ui) {\r\n\t\t\t\t$(\"#changelist\").remove();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction updateItemsOrgValues()\r\n{\r\n\t// TODO\r\n\tupdateChangeList();\r\n}\r\n\r\nfunction saveAll()\r\n{\r\n\tsaveItems(true, false, true);\r\n}\r\n\r\nfunction saveItems(saveDiscountsUponCompletion, activateOnSaveDiscountsCompletion)\r\n{\r\n\r\n\tintenseLogging(\"saveItems() called\");\r\n\r\n\tif (currentlySavingOrder)\r\n\t{\r\n\t\tdd_toast({\r\n\t\t\tmessage: 'Items are still being saved',\r\n\t\t\tposition: 'topcenter'\r\n\t\t});\r\n\t\treturn;\r\n\t}\r\n\r\n\tdd_toast({\r\n\t\tmessage: 'Items Saved',\r\n\t\tposition: 'topcenter'\r\n\t});\r\n\r\n\tif (activateOnSaveDiscountsCompletion)\r\n\t{\r\n\t\tif (!validateBoxes())\r\n\t\t{\r\n\t\t\t$(\"#activate_confirm\").remove();\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Problem with boxes',\r\n\t\t\t\tmessage: \"Please review the selected box(es) and ensure item counts are correct.\"\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tvar boxList = {};\r\n\r\n\t$(\"[id^='box_inst_id_']\").each(function () {\r\n\t\tlet list_id = this.id.split(\"_\")[3];\r\n\t\tboxList[list_id] = {};\r\n\r\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\r\n\t\t{\r\n\t\t\t$(\"li[data-box_inst_id|='\" + list_id + \"']\").each(function () {\r\n\t\t\t\tboxList[list_id][$(this).data(\"menu_item_id\")] = 1;\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\r\n\t\t\t\tboxList[list_id][$(this).data(\"menu_item_id\")] = $(this).val();\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tvar subtotal_delivery_fee = $(\"#subtotal_delivery_fee\").val();\r\n\tif (isNaN(subtotal_delivery_fee))\r\n\t{\r\n\t\tsubtotal_delivery_fee = \"0.00\";\r\n\t}\r\n\r\n\tvar special_instructions = $(\"#order_user_notes\").val();\r\n\r\n\tcurrentlySavingOrder = true;\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'update_items',\r\n\t\t\torder_id: order_id,\r\n\t\t\titems: boxList,\r\n\t\t\tsubtotal_delivery_fee: subtotal_delivery_fee,\r\n\t\t\tspecial_instructions: special_instructions\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\titemTabIsDirty = false;\r\n\t\t\t\tupdateItemsOrgValues();\r\n\r\n\t\t\t\tcurrentlySavingOrder = false;\r\n\r\n\t\t\t\tintenseLogging(\"saveItems() successful\");\r\n\r\n\t\t\t\tif (saveDiscountsUponCompletion)\r\n\t\t\t\t{\r\n\t\t\t\t\tsaveDiscounts(activateOnSaveDiscountsCompletion);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tcurrentlySavingOrder = false;\r\n\r\n\t\t\t\tintenseLogging(\"update_items: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\tcurrentlySavingOrder = false;\r\n\t\t\tintenseLogging(\"update_items: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\n/*\r\nfunction saveDeliveryAddress(payOnCompletion, token)\r\n{\r\n\r\n\tvar shipping_data = {};\r\n\t$(\"[id^='shipping_']\").each(function(){\r\n\t\tshipping_data[this.id] = $(this).val();\r\n\t});\r\n\r\n\tintenseLogging(\"saveDeliveryAddress() called\");\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 200000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'save_delivery_address',\r\n\t\t\torder_id: order_id,\r\n\t\t\tshipping_data: shipping_data\r\n\t\t},\r\n\t\tsuccess: function (json)\r\n\t\t{\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"saveDeliveryAddress() successful\");\r\n\r\n\t\t\t\tdd_toast({\r\n\t\t\t\t\tmessage: 'Delivery Address Saved',\r\n\t\t\t\t\tposition: 'topcenter'\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (payOnCompletion)\r\n\t\t\t\t{\r\n\t\t\t\t\tonAddPaymentAndActivate(false, true, token);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"save_delivery_address: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError)\r\n\t\t{\r\n\r\n\t\t\tintenseLogging(\"save_delivery_address: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\n */\r\n\r\nfunction setShipToAddressAndSaveOrder()\r\n{\r\n\r\n\tvar shipping_data = {};\r\n\t$(\"[id^='shipping_']\").each(function () {\r\n\t\tshipping_data[this.id] = $(this).val();\r\n\t});\r\n\r\n\tif ($(\"#shipping_is_gift\").is(\":checked\"))\r\n\t{\r\n\t\tshipping_data[\"shipping_is_gift\"] = \"on\";\r\n\t}\r\n\telse\r\n\t{\r\n\t\tshipping_data[\"shipping_is_gift\"] = \"0\";\r\n\t}\r\n\r\n\tintenseLogging(\"setShipToAddressAndSaveOrder() called\");\r\n\r\n\t// similar to saveDeliveryAddress but no order id is passed\r\n\t// and the response to success is to expose the calendar\r\n\t// I.E., this is part of initializing a new order\r\n\t// A SAVED order will have been created when this call completes.\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 200000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\top: 'save_delivery_address',\r\n\t\t\tshipping_data: shipping_data,\r\n\t\t\torder_state: orderState,\r\n\t\t\torder_id: order_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"setShipToAddressAndSaveOrder() successful\");\r\n\t\t\t\tbounce(\"main.php?page=admin_order_mgr_delivered&order=\" + json.order_id + \"&atabs=mgr.sessionsTab\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"setShipToAddressAndSaveOrder: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\tintenseLogging(\"save_delivery_address: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction Reschedule(org_session_id)\r\n{\r\n\r\n\tintenseLogging(\"Reschedule() called\");\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\top: 'reschedule',\r\n\t\t\tsession_id: session_id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\torder_id: order_id,\r\n\t\t\tsaved_booking_id: saved_booking_id,\r\n\t\t\torg_session_id: org_session_id,\r\n\t\t\torder_state: orderState\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"Reschedule() successful\");\r\n\r\n\t\t\t\tsession_id = json.new_session_id;\r\n\t\t\t\t$(\"#curSessionDate\").html(json.new_session_time);\r\n\t\t\t\t$(\"#curShipDate\").html(json.new_ship_time);\r\n\t\t\t\t$(\"#session\").val(json.new_session_id);\r\n\r\n\t\t\t\tRetrieveCalendar(0);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"reschedule: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\r\n\t\t\tintenseLogging(\"reschedule: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction onSaveItems()\r\n{\r\n\tintenseLogging(\"onSaveItems() called\");\r\n\r\n\tsaveItems(false, false, false);\r\n\treturn false;\r\n\r\n}\r\n\r\nfunction setupForNewOrder()\r\n{\r\n\tHideLineItemsIfZero();\r\n\tvar timestamp = getQueryVariable('month');\r\n\r\n}\r\n\r\nfunction setupForSavedOrder()\r\n{\r\n\tRetrieveCalendar(0);\r\n\t$(\"#addPaymentAndActivate\").show();\r\n\t$(\"#addPaymentAndActivateButton\").attr('disabled', 'disabled');\r\n\t$(\"#items_tab_li\").removeClass(\"disabled\");\r\n\t$(\"#items_tab_li\").removeClass(\"unsaved_data_on_tab\");\r\n}\r\n\r\nfunction setupForActiveOrder()\r\n{\r\n\tif (discountEligable.limited_access)\r\n\t{\r\n\t\t$(\"#payments_tab_li\").click();\r\n\t\t$(\"#items_tab_li\").addClass(\"disabled\");\r\n\t\t$(\"#sessions_tab_li\").addClass(\"disabled\");\r\n\t\t$(\"#discountsDiv\").find(\":input\").prop(\"disabled\", true);\r\n\t\t$(\"#discountsDiv\").find(\"*\").addClass(\"om_disabled\");\r\n\t}\r\n\r\n\t$(\"#addPaymentAndActivate\").hide();\r\n\r\n}\r\n\r\nfunction isDeliveryAddressComplete()\r\n{\r\n\tvar validated = true;\r\n\r\n\t$(\"[id^='shipping_']\").each(function () {\r\n\r\n\t\tif (!$(this).val() && $(this).attr('required'))\r\n\t\t{\r\n\t\t\tvalidated = false;\r\n\t\t}\r\n\t});\r\n\treturn validated;\r\n}\r\n\r\nfunction onDeliveryTabSelected()\r\n{\r\n\r\n}\r\n\r\nfunction onDeliveryTabDeselected()\r\n{\r\n\t/*\r\n\tif (!isDeliveryAddressComplete())\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'Please check the Delivery Address and phone number fields for completeness.'\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\t}\r\n*/\r\n\treturn true;\r\n\r\n}\r\n\r\nfunction onSessionTabSelected()\r\n{\r\n\tRetrieveCalendar(0);\r\n}\r\n\r\nfunction onSessionTabDeselected()\r\n{\r\n\treturn true;\r\n}\r\n\r\nfunction onItemsTabSelected()\r\n{\r\n\r\n}\r\n\r\nfunction onItemsTabDeselected()\r\n{\r\n\tif (orderState != 'ACTIVE')\r\n\t{\r\n\t\tif (itemTabIsDirty)\r\n\t\t{\r\n\t\t\tsaveItems(false, false, false);\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction onPaymentTabSelected()\r\n{\r\n}\r\n\r\nfunction onPaymentTabDeselected()\r\n{\r\n\tif (orderState != 'ACTIVE' && (discountChanges || reportingChanges))\r\n\t{\r\n\t\tsaveDiscounts(false, false);\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction onNotesTabSelected()\r\n{\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\top: 'get_history',\r\n\t\t\tsession_id: session_id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\torder_id: order_id\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\t$(\"#history_div\").html(json.html);\r\n\r\n\t\t\thandle_guest_account_notes();\r\n\r\n\t\t\thandle_admin_carryover_notes();\r\n\r\n\t\t\thandle_admin_order_notes();\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\r\n\t\t\tintenseLogging(\"get_history: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction onNotesTabDeselected()\r\n{\r\n\treturn true;\r\n}\r\n\r\nfunction onPaymentSelected()\r\n{\r\n\tif (orderState != 'ACTIVE')\r\n\t{\r\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\r\n\t\tpaymentChanges = true;\r\n\t\tupdateChangeList();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tpaymentChanges = true;\r\n\t\tupdateChangeList();\r\n\t}\r\n}\r\n\r\nfunction onPaymentDeselected()\r\n{\r\n\tif (orderState != 'ACTIVE')\r\n\t{\r\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\r\n\t\tupdateChangeList();\r\n\t\tpaymentChanges = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tpaymentChanges = false;\r\n\t\tupdateChangeList();\r\n\t}\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\nfunction updateDiscountOrgValues()\r\n{\r\n\r\n\t$(\"#org_coupon_id\").val($(\"#coupon_id\").val());\r\n\r\n\tupdateChangeList();\r\n\r\n}\r\n\r\nfunction _validate_discounts()\r\n{\r\n\treturn true;\r\n}\r\n\r\nfunction _validate_address()\r\n{/*\r\n\t$thisOrder->orderAddress->firstname = $shippingData['shipping_firstname'];\r\n\t$thisOrder->orderAddress->lastname = $shippingData['shipping_lastname'];\r\n\t$thisOrder->orderAddress->address_line1 = $shippingData['shipping_address_line1'];\r\n\t$thisOrder->orderAddress->address_line2 = $shippingData['shipping_address_line2'];\r\n\t$thisOrder->orderAddress->city = $shippingData['shipping_city'];\r\n\t$thisOrder->orderAddress->state_id = $shippingData['shipping_state_id'];\r\n\t$thisOrder->orderAddress->postal_code = $shippingData['shipping_postal_code'];\r\n\t$thisOrder->orderAddress->telephone_1 = (($shipping_phone_number == 'new') ? $shipping_phone_number_new : $shipping_phone_number);\r\n\t$thisOrder->orderAddress->address_note = trim(strip_tags($shipping_address_note));\r\n\t$thisOrder->orderAddress->email_address = $shipping_email_address;\r\n\t$thisOrder->orderAddress->is_gift = (!empty($shippingData['shipping_is_gift']) ? 1 : 0);\r\n*/\r\n\t// TODO: phone and email validation\r\n\r\n\tvalidationSuccess = true;\r\n\r\n\tif ($(\"#shipping_firstname\").val().length == 0)\r\n\t{\r\n\t\t$(\"#shipping_firstname\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_firstname\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_firstname\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_firstname\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\tif ($(\"#shipping_lastname\").val().length == 0)\r\n\t{\r\n\t\t$(\"#shipping_lastname\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_lastname\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_lastname\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_lastname\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\tif ($(\"#shipping_address_line1\").val().length == 0)\r\n\t{\r\n\t\t$(\"#shipping_address_line1\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_address_line1\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_address_line1\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_address_line1\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\tif ($(\"#shipping_city\").val().length == 0)\r\n\t{\r\n\t\t$(\"#shipping_city\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_city\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_city\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_city\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\tif ($(\"#shipping_state_id\").val().length == 0)\r\n\t{\r\n\t\t$(\"#shipping_state_id\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_state_id\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_state_id\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_state_id\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\tif ($(\"#shipping_state_id\").val().length == 0)\r\n\t{\r\n\t\t$(\"#shipping_state_id\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_state_id\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_state_id\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_state_id\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\tif ($(\"#shipping_postal_code\").val().length != 5)\r\n\t{\r\n\t\t$(\"#shipping_postal_code\").removeClass(\"is-valid\");\r\n\t\t$(\"#shipping_postal_code\").addClass(\"is-invalid\");\r\n\t\tvalidationSuccess = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#shipping_postal_code\").removeClass(\"is-invalid\");\r\n\t\t$(\"#shipping_postal_code\").addClass(\"is-valid\");\r\n\t}\r\n\r\n\treturn validationSuccess;\r\n}\r\n\r\nfunction saveDiscounts(payOnCompletion)\r\n{\r\n\tintenseLogging(\"saveDiscounts() called\");\r\n\r\n\tif (!_validate_discounts())\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!payOnCompletion)\r\n\t{\r\n\t\tdd_toast({\r\n\t\t\tmessage: 'Discounts Saved',\r\n\t\t\tposition: 'topcenter'\r\n\t\t});\r\n\t}\r\n\r\n\tvar direct_order_discount = $(\"#direct_order_discount\").val();\r\n\tif (isNaN(direct_order_discount))\r\n\t{\r\n\t\tdirect_order_discount = \"0.00\";\r\n\t}\r\n\r\n\tvar dinner_dollars_discount = $(\"#plate_points_discount\").val();\r\n\tif (isNaN(dinner_dollars_discount))\r\n\t{\r\n\t\tdinner_dollars_discount = \"0.00\";\r\n\t}\r\n\r\n\tvar coupon_id = 0;\r\n\tvar coupon_free_menu_item = 0;\r\n\tif ($(\"#coupon_id\").val())\r\n\t{\r\n\r\n\t\tcoupon_id = $(\"#coupon_id\").val();\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\top: 'update_discounts',\r\n\t\t\torder_id: order_id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\tdirect_order_discount: direct_order_discount,\r\n\t\t\tplate_points_discount: dinner_dollars_discount,\r\n\t\t\tcoupon_id: coupon_id,\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"saveDiscounts() successful\");\r\n\r\n\t\t\t\tupdateDiscountOrgValues();\r\n\t\t\t\tupdateReportingOrgValues();\r\n\r\n\t\t\t\tif (coupon_free_menu_item)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#free_menu_item_coupon').attr('disabled', true);\r\n\t\t\t\t\tcouponFreeMenuItem = coupon_free_menu_item;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (payOnCompletion)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\tif (!_validate_address())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: \"Please review and correct the shipping address.\"\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tonAddPaymentAndActivate(false, true, json.paymentToken);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"update_discounts: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\tintenseLogging(\"update_discounts: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction updateReportingOrgValues()\r\n{\r\n\tupdateChangeList();\r\n}\r\n\r\nfunction getPaymentData(type, payment_number)\r\n{\r\n\r\n\tif (type != 'CC')\r\n\t{\r\n\t\tvar paymentData = {\r\n\t\t\ttype: type,\r\n\t\t\tnumber: 0,\r\n\t\t\tamount: 0,\r\n\t\t\tcert_type: '',\r\n\t\t\tnote: $(\"#payment_note\").val()\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar paymentData = {\r\n\t\t\ttype: type,\r\n\t\t\tnumber: 0,\r\n\t\t\tamount: 0,\r\n\t\t\tcert_type: '',\r\n\t\t\tnote: $(\"#payment_note\").val(),\r\n\t\t\tccNameOnCard: \"\",\r\n\t\t\tccType: 'CC',\r\n\t\t\tccMonth: \"\",\r\n\t\t\tccYear: \"\",\r\n\t\t\tcc_security_code: \"\",\r\n\t\t\tbilling_address: \"\",\r\n\t\t\tbilling_postal_code: \"\",\r\n\t\t\tis_store_specific_flat_rate_deposit_delayed_payment: 0,\r\n\t\t\tdo_not_ref: 0\r\n\t\t}\r\n\t}\r\n\r\n\tif (payment_number == 1)\r\n\t{\r\n\t\tswitch (type)\r\n\t\t{\r\n\t\t\tcase \"REFERENCE\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment1_reference_total_amount\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"GIFT_CERT\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment1_gc_total_amount\").val();\r\n\t\t\t\tpaymentData.cert_type = $(\"#payment1_gift_cert_type\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment1_gc_payment_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CASH\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment1_cash_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment1_cash_payment_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"REFUND_CASH\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment1_refund_cash_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment1_refund_cash_payment_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CHECK\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment1_check_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment1_check_payment_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CREDIT\":\r\n\t\t\t\tpaymentData.amount = $(\"#OEH_remaing_balance\").html();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CC\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment1_cc_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment1_ccNumber\").val();\r\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment1_ccNameOnCard\").val();\r\n\t\t\t\tpaymentData.ccType = $(\"#payment1_ccType\").val();\r\n\t\t\t\tpaymentData.ccMonth = $(\"#payment1_ccMonth\").val();\r\n\t\t\t\tpaymentData.ccYear = $(\"#payment1_ccYear\").val();\r\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment1_cc_security_code\").val();\r\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_1\").val();\r\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_1\").val();\r\n\r\n\t\t\t\tif ($('#save_cc_as_ref_1').is(':checked'))\r\n\t\t\t\t{\r\n\t\t\t\t\tpaymentData.save_card = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar DPSetting = $('input[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\r\n\r\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"GIFT_CARD\":\r\n\t\t\t\tpaymentData.amount = $(\"#debit_gift_card_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#debit_gift_card_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"DPADJUST\":\r\n\t\t\t\t// TODO: ???\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\t\talert('investigate REFERENCE_OTHER');\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tpaymentData.amount = $(\"#payment1_ref_total_amount\").val();\r\n\t\t\t\t\tpaymentData.reference_id = $(\"#p1_ref_id\").html();\r\n\t\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn paymentData;\r\n\r\n\t}\r\n\telse if (payment_number == 2)\r\n\t{\r\n\t\tswitch (type)\r\n\t\t{\r\n\t\t\tcase \"CASH\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment2_cash_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment2_cash_payment_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CHECK\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment2_check_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment2_check_payment_number\").val();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"CC\":\r\n\t\t\t\tpaymentData.amount = $(\"#payment2_cc_total_amount\").val();\r\n\t\t\t\tpaymentData.number = $(\"#payment2_ccNumber\").val();\r\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment2_ccNameOnCard\").val();\r\n\t\t\t\tpaymentData.ccType = $(\"#payment2_ccType\").val();\r\n\t\t\t\tpaymentData.ccMonth = $(\"#payment2_ccMonth\").val();\r\n\t\t\t\tpaymentData.ccYear = $(\"#payment2_ccYear\").val();\r\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment2_cc_security_code\").val();\r\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_2\").val();\r\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_2\").val();\r\n\r\n\t\t\t\tif ($('#save_cc_as_ref_2').is(':checked'))\r\n\t\t\t\t{\r\n\t\t\t\t\tpaymentData.save_card = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar DPSetting = $('input[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\r\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\t\talert('investigate REFERENCE_OTHER');\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tpaymentData.amount = $(\"#payment2_ref_total_amount\").val();\r\n\t\t\t\t\tpaymentData.reference_id = $(\"#p2_ref_id\").html();\r\n\t\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn paymentData;\r\n\t}\r\n\r\n}\r\n\r\nfunction validatePayment1(type)\r\n{\r\n\r\n\tvar inputArray = null;\r\n\tvar validates = true;\r\n\r\n\tif (type.substr(0, 4) == \"REF_\")\r\n\t{\r\n\t\ttype = \"REFERENCE_OTHER\";\r\n\t}\r\n\r\n\tswitch (type)\r\n\t{\r\n\t\tcase \"REFERENCE\":\r\n\t\t\tinputArray = $(\"#payment1_reference :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CERT\":\r\n\t\t\tinputArray = $(\"#payment1_gc :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CASH\":\r\n\t\t\tinputArray = $(\"#payment1_cash :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFUND_CASH\":\r\n\t\t\tinputArray = $(\"#payment1_refund_cash :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tinputArray = $(\"#payment1_check :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CREDIT\":\r\n\t\t\tinputArray = $(\"#payment1_credit :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tinputArray = $(\"#payment1_cc :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\r\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\r\n\r\n\t\t\tif ($(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\r\n\t\t\t{\r\n\t\t\t\tvar CC1Amount = $(\"#payment1_cc_total_amount\").val();\r\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").html(depositWarningStr);\r\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").show();\r\n\t\t\t\t\tvalidates = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"GIFT_CARD\":\r\n\t\t\tinputArray = $(\"#payment1_debit_gift_card :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"DPADJUST\":\r\n\t\t\tinputArray = $(\"#dp_adjust_div :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\tinputArray = $(\"#payment1_ref :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\r\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\r\n\r\n\t\t\tif ($(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\r\n\t\t\t{\r\n\t\t\t\tvar CC1Amount = $(\"#payment1_ref_total_amount\").val();\r\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").html(depositWarningStr);\r\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").show();\r\n\t\t\t\t\tvalidates = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t}\r\n\r\n\treturn validates;\r\n\r\n}\r\n\r\nfunction validatePayment2(type)\r\n{\r\n\r\n\tvar inputArray = null;\r\n\tvar validates = true;\r\n\r\n\tif (type.substr(0, 4) == \"REF_\")\r\n\t{\r\n\t\ttype = \"REFERENCE_OTHER\";\r\n\t}\r\n\r\n\tswitch (type)\r\n\t{\r\n\r\n\t\tcase \"CASH\":\r\n\t\t\tinputArray = $(\"#payment2_check :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CHECK\":\r\n\t\t\tinputArray = $(\"#payment2_check :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"CC\":\r\n\t\t\tinputArray = $(\"#payment2_cc :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\r\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\r\n\r\n\t\t\tif ($(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\r\n\t\t\t{\r\n\t\t\t\tvar CC1Amount = $(\"#payment2_cc_total_amount\").val();\r\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").html(depositWarningStr);\r\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").show();\r\n\t\t\t\t\tvalidates = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"REFERENCE_OTHER\":\r\n\t\t\tinputArray = $(\"#payment2_ref :input\");\r\n\t\t\tvalidates = _check_elements(inputArray);\r\n\r\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\r\n\r\n\t\t\tif ($(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\r\n\t\t\t{\r\n\t\t\t\tvar CC1Amount = $(\"#payment2_ref_total_amount\").val();\r\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").html(depositWarningStr);\r\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").show();\r\n\t\t\t\t\tvalidates = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t}\r\n\r\n\treturn validates;\r\n}\r\n\r\nfunction addPaymentAndActivate()\r\n{\r\n\tintenseLogging(\"addPaymentAndActivate() called\");\r\n\r\n\t// always first ensure that discounts are updated on server\r\n\tvar message = \"You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?\";\r\n\tvar changesBlurb = getAbbreviatedSummaryString();\r\n\t//message += \"<br /><br />\" + changesBlurb;\r\n\r\n\tdd_message({\r\n\t\tdiv_id: 'activate_confirm',\r\n\t\ttitle: 'Add Payment and Book Order',\r\n\t\tmessage: message,\r\n\t\tmodal: true,\r\n\t\twidth: 400,\r\n\t\theight: 180,\r\n\t\tconfirm: function () {\r\n\t\t\tvar discounts_are_valid = saveItems(true, true);\r\n\t\t}\r\n\t});\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction save2PaymentsAndBookOrder(payment2Type, payment1Data, token)\r\n{\r\n\r\n\tintenseLogging(\"save2PaymentsAndBookOrder() called\");\r\n\r\n\tvar payment2Data = getPaymentData(payment2Type, 2);\r\n\r\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\r\n\t{\r\n\r\n\t\tvar DP_State = 0;\r\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\r\n\t\t{\r\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\r\n\r\n\t\t\tif (DP_State == 1)\r\n\t\t\t{\r\n\t\t\t\tDP_State = 4;\r\n\t\t\t} // translate to CPayment constants - for now\r\n\t\t\tif (DP_State == 2)\r\n\t\t\t{\r\n\t\t\t\tDP_State = 5;\r\n\t\t\t}\r\n\r\n\t\t\tif (DP_State > 0)\r\n\t\t\t{\r\n\t\t\t\t// TODO: validate amounts\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\r\n\t\tif (!max_plate_points_deduction)\r\n\t\t{\r\n\t\t\tmax_plate_points_deduction = 0;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tasync: true,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\top: 'save_payment',\r\n\t\t\t\torder_id: order_id,\r\n\t\t\t\tsession_id: session_id,\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpayment_data: payment1Data,\r\n\t\t\t\tadd_payment_data: payment2Data,\r\n\t\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\r\n\t\t\t\tdelay_remainder: DP_State,\r\n\t\t\t\tdd_csrf_token: token\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() save_payment successful\");\r\n\r\n\t\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + json.processor_message);\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\telse if (payment2Type == \"CC\")\r\n\t{\r\n\r\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\r\n\t\tvar billing_address = $(\"#billing_address_2\").val();\r\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\r\n\r\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tasync: true,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\top: 'get_token',\r\n\t\t\t\torder_id: order_id,\r\n\t\t\t\tamount: amt,\r\n\t\t\t\tbilling_name: billing_name,\r\n\t\t\t\tbilling_address: billing_address,\r\n\t\t\t\tbilling_zip: billing_zip,\r\n\t\t\t\tdd_csrf_token: token,\r\n\t\t\t\tchain_token: true\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() get_token successful\");\r\n\r\n\t\t\t\t\tvar token = json.token;\r\n\r\n\t\t\t\t\tsend(token, 2, json.warnOfOutstandingSavedOrdersOnFullSession, false, false, payment1Data);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + json.processor_message);\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction savePayment2(payment2Type, warnOfOutstandingSavedOrdersOnFullSession, token)\r\n{\r\n\r\n\tintenseLogging(\"savePayment2() called\");\r\n\r\n\tvar payment2Data = getPaymentData(payment2Type, 2);\r\n\r\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\r\n\t{\r\n\r\n\t\tvar DP_State = 0;\r\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\r\n\t\t{\r\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\r\n\r\n\t\t\tif (DP_State == 1)\r\n\t\t\t{\r\n\t\t\t\tDP_State = 4;\r\n\t\t\t} // translate to CPayment constants - for now\r\n\t\t\tif (DP_State == 2)\r\n\t\t\t{\r\n\t\t\t\tDP_State = 5;\r\n\t\t\t}\r\n\r\n\t\t\tif (DP_State > 0)\r\n\t\t\t{\r\n\t\t\t\t// TODO: validate amounts\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tasync: true,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\top: 'add_payment',\r\n\t\t\t\torder_id: order_id,\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpayment_data: payment2Data,\r\n\t\t\t\tdelay_remainder: DP_State,\r\n\t\t\t\tdd_csrf_token: token\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\tintenseLogging(\"savePayment2() add_payment successful\");\r\n\r\n\t\t\t\t\tif (warnOfOutstandingSavedOrdersOnFullSession)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + json.processor_message);\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\telse if (payment2Type == \"CC\")\r\n\t{\r\n\r\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\r\n\t\tvar billing_address = $(\"#billing_address_2\").val();\r\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\r\n\r\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tasync: true,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\top: 'get_token',\r\n\t\t\t\torder_id: order_id,\r\n\t\t\t\tamount: amt,\r\n\t\t\t\tbilling_name: billing_name,\r\n\t\t\t\tbilling_address: billing_address,\r\n\t\t\t\tbilling_zip: billing_zip,\r\n\t\t\t\tdd_csrf_token: token,\r\n\t\t\t\tchain_token: true\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\tintenseLogging(\"savePayment2() get_token successful\");\r\n\r\n\t\t\t\t\tvar token = json.token;\r\n\r\n\t\t\t\t\tsend(token, 2, warnOfOutstandingSavedOrdersOnFullSession, false, false);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + json.processor_message);\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction handleDirectPayment(addOnly, go_to_confirm, token)\r\n{\r\n\r\n\tintenseLogging(\"handleDirectPayment() called\");\r\n\r\n\tvar payment1Type = $(\"#payment1_type\").val();\r\n\tvar payment2Type = false;\r\n\r\n\tif (payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD')\r\n\t{\r\n\t\tpayment2Type = $(\"#payment2_type\").val();\r\n\t}\r\n\r\n\t// validation\r\n\tif (!validatePayment1(payment1Type))\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// validation\r\n\tif (payment2Type && payment2Type != \"\" && !validatePayment2(payment2Type))\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tdisplayModalWaitDialog('paying_div', \"Sending Payment. Please wait ...\");\r\n\r\n\tvar payment1Data = getPaymentData(payment1Type, 1);\r\n\r\n\t// Handle Payment 1 for certain\r\n\t// Then handle Payment 2 unless it's a CC payment.\r\n\r\n\tvar DP_State = 0;\r\n\tif ($('#ref_payment1_is_store_specific_flat_rate_deposit_delayed0').length)\r\n\t{\r\n\t\tDP_State = $('input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked').val();\r\n\r\n\t\tif (DP_State == 1)\r\n\t\t{\r\n\t\t\tDP_State = 4;\r\n\t\t} // translate to CPayment constants - for now\r\n\t\tif (DP_State == 2)\r\n\t\t{\r\n\t\t\tDP_State = 5;\r\n\t\t}\r\n\r\n\t\tif (DP_State > 0)\r\n\t\t{\r\n\t\t\t// TODO: validate amounts\r\n\t\t}\r\n\t}\r\n\r\n\tvar use_store_credits = false;\r\n\tvar store_credit_amount = 0;\r\n\tif ($(\"#use_store_credits\").length)\r\n\t{\r\n\t\tif ($(\"#use_store_credits\").is(':checked'))\r\n\t\t{\r\n\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\r\n\t\t\tuse_store_credits = true;\r\n\t\t}\r\n\t}\r\n\r\n\tvar mainPaymentData = null;\r\n\tvar additionalPaymentData = null;\r\n\r\n\tif (payment2Type)\r\n\t{\r\n\t\tmainPaymentData = getPaymentData(payment2Type, 2);\r\n\t\tvar DP_State = 0;\r\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\r\n\t\t{\r\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\r\n\r\n\t\t\tif (DP_State == 1)\r\n\t\t\t{\r\n\t\t\t\tDP_State = 4;\r\n\t\t\t}\r\n\t\t}\r\n\t\tadditionalPaymentData = payment1Data;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tmainPaymentData = payment1Data;\r\n\t}\r\n\r\n\tvar max_plate_points_deduction = $(\"#max_plate_points_deduction\").html();\r\n\tif (!max_plate_points_deduction)\r\n\t{\r\n\t\tmax_plate_points_deduction = 0;\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 90000,\r\n\t\tasync: true,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: store_id,\r\n\t\t\top: 'save_payment',\r\n\t\t\torder_id: order_id,\r\n\t\t\tuser_id: user_id,\r\n\t\t\tpayment_data: mainPaymentData,\r\n\t\t\tadd_payment_data: additionalPaymentData,\r\n\t\t\tdelay_remainder: DP_State,\r\n\t\t\tuse_store_credits: use_store_credits,\r\n\t\t\tmax_plate_points_deduction: max_plate_points_deduction,\r\n\t\t\tstore_credits_amount: store_credit_amount,\r\n\t\t\tdd_csrf_token: token,\r\n\t\t\tpayment2Type: payment2Type\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"handleDirectPayment() save_payment successful\");\r\n\r\n\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\r\n\t\t\t\t{\r\n\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tbounce(\"main.php?page=admin_order_mgr_thankyou&order=\" + json.order_id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tif (strError == 'timeout')\r\n\t\t\t{\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Order Processing Timed Out',\r\n\t\t\t\t\tmessage: \"The request to finalized the order has timed out. This may be due to network congestion. The order may have been successful. The page will refresh and show the actual current status.\",\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t'Refresh': function () {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t\tbounce(window.location.href);\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction onAddPaymentAndActivate(addOnly, go_to_confirm, token)\r\n{\r\n\tintenseLogging(\"onAddPaymentAndActivate() called\");\r\n\treturn handleDirectPayment(addOnly, go_to_confirm, token);\r\n}\r\n\r\nfunction RetrieveCalendar(timestamp)\r\n{\r\n\tintenseLogging(\"RetrieveCalendar() called\");\r\n\r\n\tvar op = 'retrieve_new';\r\n\tif (orderState != 'SAVED')\r\n\t{\r\n\t\top = 'retrieve_for_reschedule';\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'GET',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_calendarProcessorDelivered',\r\n\t\t\tstore_id: store_id,\r\n\t\t\taction: op,\r\n\t\t\tcur_session_id: session_id,\r\n\t\t\ttimestamp: timestamp,\r\n\t\t\tservice_days: service_days_for_current_zip\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"RetrieveCalendar() successful\");\r\n\t\t\t\t$(\"#calendar_holder\").html(json.data);\r\n\t\t\t\thandleSessionSelection();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tintenseLogging(\"RetrieveCalendar: \" + json.processor_message);\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tintenseLogging(\"RetrieveCalendar: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction onDayClick(obj)\r\n{\r\n}\r\n\r\nfunction doReschedule(id, sessionTime)\r\n{\r\n\tvar curSessionDate = $(\"#curSessionDate\").html();\r\n\r\n\tdd_message({\r\n\t\ttitle: 'Reschedule',\r\n\t\tmessage: '<div style=\"text-align: center;\"><div>From</div><div style=\"font-weight: bold;\">' + curSessionDate + '</div><div>to</div><div style=\"font-weight: bold;\">' + sessionTime + '</div>',\r\n\t\tmodal: true,\r\n\t\tconfirm: function () {\r\n\r\n\t\t\tvar org_session_id = session_id;\r\n\t\t\tsession_id = id;\r\n\t\t\tReschedule(org_session_id);\r\n\r\n\t\t},\r\n\t\topen: function () {\r\n\r\n\t\t\t$(this).siblings('.ui-dialog-buttonpane').find(\"button:contains('Confirm')\").focus();\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction onRescheduleClick(id, sessionTime, isDiscounted, control_message)\r\n{\r\n\tif (orderState != 'NEW')\r\n\t{\r\n\t\tif (control_message == \"locked\")\r\n\t\t{\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Reschedule',\r\n\t\t\t\tmessage: \"You cannot reschedule to this session as it is in the previous calendar month and all activity for that month has been locked and finalized.\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdoReschedule(id, sessionTime);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction onSessionClick(id, sessionTime, isDiscounted)\r\n{\r\n\t// Obsolete - delivered orders always set a session based on current date and service days\r\n\tintenseLogging(\"onSessionClick() called .................... please investiage should not occur for Delivered order\");\r\n\r\n}\r\n\r\nfunction monthChange(monthVal)\r\n{\r\n\tRetrieveCalendar(monthVal);\r\n}\r\n\r\nfunction handleSummaryDisplayChange(obj)\r\n{\r\n\tif (obj.checked)\r\n\t{\r\n\t\tShowAllLineItems();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tHideLineItemsIfZero();\r\n\t}\r\n}\r\n\r\nfunction HideLineItemsIfZero()\r\n{\r\n\r\n\tvar deliveryFeeOrg = Number($('#OEH_subtotal_delivery_fee_org').html());\r\n\tvar deliveryFee = Number($('#OEH_subtotal_delivery_fee').html());\r\n\r\n\tif (deliveryFeeOrg == 0 && deliveryFee == 0)\r\n\t{\r\n\t\t$('#DeliveryFeeRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#DeliveryFeeRow').show();\r\n\t}\r\n\r\n\tvar doDiscountOrg = Number($('#OEH_direct_order_discount_org').html());\r\n\tvar doDiscount = Number($('#OEH_direct_order_discount').html());\r\n\r\n\tif (doDiscountOrg == 0 && doDiscount == 0)\r\n\t{\r\n\t\t$('#directDiscountRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#directDiscountRow').show();\r\n\t}\r\n\r\n\tvar couponDiscountOrg = Number($('#OEH_coupon_discount_org').html());\r\n\tvar couponDiscount = Number($('#OEH_coupon_discount').html());\r\n\r\n\tif (couponDiscountOrg == 0 && couponDiscount == 0)\r\n\t{\r\n\t\t$('#couponDiscountRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#couponDiscountRow').show();\r\n\t}\r\n\r\n\tvar membershipDiscountOrg = Number($('#OEH_membership_discount_org').html());\r\n\tvar membershipDiscount = Number($('#OEH_membership_discount').html());\r\n\r\n\tif (membershipDiscountOrg == 0 && membershipDiscount == 0)\r\n\t{\r\n\t\t$('#membershipDiscountRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#membershipDiscountRow').show();\r\n\t}\r\n\r\n\tvar foodTaxOrg = Number($('#OEH_food_tax_subtotal_org').html());\r\n\tvar foodTax = Number($('#OEH_food_tax_subtotal').html());\r\n\r\n\tif (foodTaxOrg == 0 && foodTax == 0)\r\n\t{\r\n\t\t$('#foodTaxRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#foodTaxRow').show();\r\n\t}\r\n\r\n\tvar nonFoodTaxOrg = Number($('#OEH_tax_subtotal_org').html());\r\n\tvar nonFoodTax = Number($('#OEH_tax_subtotal').html());\r\n\r\n\tif (nonFoodTaxOrg == 0 && nonFoodTax == 0)\r\n\t{\r\n\t\t$('#nonFoodTaxRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#nonFoodTaxRow').show();\r\n\t}\r\n\r\n\tvar deliveryTaxOrg = Number($('#OEH_delivery_tax_subtotal_org').html());\r\n\tvar deliveryTax = Number($('#OEH_delivery_tax_subtotal').html());\r\n\r\n\tif (deliveryTaxOrg == 0 && deliveryTax == 0)\r\n\t{\r\n\t\t$('#DeliveryTaxRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#DeliveryTaxRow').show();\r\n\t}\r\n\r\n\tvar ddOrg = Number($('#OEH_plate_points_order_discount_fee_org').html());\r\n\tvar dd = Number($('#OEH_plate_points_order_discount_fee').html());\r\n\tdd = isNaN(dd)? 0:dd;\r\n\tddOrg = isNaN(ddOrg)? 0:ddOrg;\r\n\r\n\tif (ddOrg == 0 && dd == 0)\r\n\t{\r\n\t\t$('#dinnerDollarsDiscountRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#dinnerDollarsDiscountRow').show();\r\n\t}\r\n\r\n}\r\n\r\nfunction ShowAllLineItems()\r\n{\r\n\t$('#DeliveryFeeRow').show();\r\n\t$('#directDiscountRow').show();\r\n\t$('#couponDiscountRow').show();\r\n\t$('#foodTaxRow').show();\r\n\t$('#nonFoodTaxRow').show();\r\n\t$('#dinnerDollarsDiscountRow').show();\r\n}\r\n\r\nfunction sort_by_price(a, b)\r\n{\r\n\tif (a.price == b.price)\r\n\t{\r\n\t\treturn 0;\r\n\t}\r\n\r\n\treturn (a.price < b.price) ? 1 : -1;\r\n}\r\n\r\nfunction drawChangeList()\r\n{\r\n\tvar html = getChangeListHTML();\r\n\t$(\"#changelist\").html(html);\r\n\r\n}\r\n\r\nfunction getChangeListHTML()\r\n{\r\n\r\n\tvar htmlStr = \"\";\r\n\tvar first = true;\r\n\r\n\tlet editedExistingBoxHTML = {};\r\n\tlet existingNewBoxHTML = {};\r\n\r\n\tfor (var thisBox in changeList.box_contents)\r\n\t{\r\n\t\tif (changeList.box_contents.hasOwnProperty(thisBox))\r\n\t\t{\r\n\t\t\tlet tempHTML = \"\";\r\n\r\n\t\t\tfor (var thisItem in changeList.box_contents[thisBox])\r\n\t\t\t{\r\n\t\t\t\tlet item_name = $(\"#qty_\" + thisBox + \"_\" + thisItem).data('title');\r\n\r\n\t\t\t\tif (changeList.box_contents[thisBox][thisItem] > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\ttempHTML += \"-Added \" + changeList.box_contents[thisBox][thisItem] + \" \" + item_name + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\ttempHTML += \"-Removed \" + changeList.box_contents[thisBox][thisItem] + \" \" + item_name + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!changeList.boxes[thisBox])\r\n\t\t\t{\r\n\t\t\t\t// an existing boxes contents have changed\r\n\r\n\t\t\t\tif (first)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"<h3>Edited Boxes</h3><ul style='margin: 4px;'>\";\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\r\n\r\n\t\t\t\teditedExistingBoxHTML[thisBox] = \"Box: \" + title + \"<br />\" + tempHTML;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\texistingNewBoxHTML[thisBox] = tempHTML;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar first = true;\r\n\r\n\tfor (var box_inst_id in changeList.boxes)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Added Boxes</h3><ul style='margin: 0px; padding: 0px;'>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\thtmlStr += \"<li>\";\r\n\r\n\t\tif (changeList.boxes.hasOwnProperty(box_inst_id))\r\n\t\t{\r\n\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\r\n\r\n\t\t\tif (changeList.boxes[box_inst_id] > 0)\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Added \" + changeList.boxes[box_inst_id] + \" <i>\" + title + \"</i> \";\r\n\r\n\t\t\t\tif (existingNewBoxHTML[box_inst_id])\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"<br />\" + existingNewBoxHTML[box_inst_id];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Removed \" + changeList.boxes[box_inst_id] * -1 + \"<i>\" + boxesDeletedFromActiveOrder[box_inst_id] + \"</i>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtmlStr += \"</li>\";\r\n\r\n\t}\r\n\r\n\tfor (var box_inst_id in editedExistingBoxHTML)\r\n\t{\r\n\t\tif (editedExistingBoxHTML.hasOwnProperty(box_inst_id))\r\n\t\t{\r\n\t\t\thtmlStr += editedExistingBoxHTML[box_inst_id];\r\n\t\t}\r\n\t}\r\n\r\n\tif (!first)\r\n\t{\r\n\t\thtmlStr += \"</ul>\";\r\n\t}\r\n\r\n\tfirst = true;\r\n\tvar hadMiscCostChanges = false;\r\n\tfor (var item in changeList.miscCosts)\r\n\t{\r\n\t\thadMiscCostChanges = true;\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\r\n\t\t{\r\n\r\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\r\n\t\t\t{\r\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tfirst = true;\r\n\tfor (var item in changeList.miscDescs)\r\n\t{\r\n\t\tif (!hadMiscCostChanges && first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\r\n\t\t{\r\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\r\n\t\t}\r\n\t}\r\n\r\n\tif (changeList.order_type != \"\")\r\n\t{\r\n\t\thtmlStr += \"<h3>Order changed \" + changeList.order_type + \"</h3>\";\r\n\t}\r\n\r\n\tfirst = true;\r\n\tfor (var item in changeList.discounts)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\tif (changeList.discounts.hasOwnProperty(item))\r\n\t\t{\r\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\r\n\t\t\t{\r\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tfirst = true;\r\n\tfor (var item in changeList.reporting)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Reporting</h3>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\tif (changeList.reporting.hasOwnProperty(item))\r\n\t\t{\r\n\t\t\tif (item == 'fundraiser')\r\n\t\t\t{\r\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse if (changeList.reporting[item][\"orgVal\"] > 0 && changeList.reporting[item][\"orgVal\"] != changeList.reporting[item][\"newVal\"])\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Changed \" + getHumanReadableName(item) + \" to \" + changeList.reporting[item][\"title\"] + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (item == 'fundraiser_value')\r\n\t\t\t{\r\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (item == 'ltd_roundup')\r\n\t\t\t{\r\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == false)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + ' was removed from the order.'\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + ' was added to the order.'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (item == 'ltd_roundup_value')\r\n\t\t\t{\r\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (changeList.coupon)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\tif (changeList.coupon.change_type = 'added')\r\n\t\t{\r\n\t\t\thtmlStr += \"Added coupon code: \" + \"<br />\";\r\n\t\t}\r\n\t\telse if (changeList.coupon.change_type = 'removed')\r\n\t\t{\r\n\t\t\thtmlStr += \"Removed coupon code: \" + \"<br />\";\r\n\t\t}\r\n\t\telse if (changeList.coupon.change_type = 'added')\r\n\t\t{\r\n\t\t\thtmlStr += \"Change coupon code to: \" + \"<br />\";\r\n\t\t}\r\n\t}\r\n\r\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\r\n\t{\r\n\t\thtmlStr += \"<h3>Payments</h3>\";\r\n\r\n\t\tvar payment1Type = $('#payment1_type').val();\r\n\r\n\t\tif (payment1Type != '')\r\n\t\t{\r\n\t\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#creditDiv').is(\":visible\");\r\n\t\t\t{\r\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar ccRefundTotal = 0;\r\n\t\t\t\t$(\"[id^='Cr_RT_']\").each(function () {\r\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (ccRefundTotal > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment2_type').val() != \"\")\r\n\t\t{\r\n\t\t\tvar payment2Type = $('#payment2_type').val();\r\n\t\t\tif (payment2Type && payment2Type != \"\")\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($('#use_store_credit').is(':checked'))\r\n\t\t{\r\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\r\n\t\t}\r\n\t}\r\n\treturn htmlStr;\r\n}\r\n\r\nfunction getHumanReadableName(id)\r\n{\r\n\tswitch (id)\r\n\t{\r\n\t\tcase 'direct_order_discount':\r\n\t\t\treturn \"Direct Order Discount\";\r\n\t\tcase 'plate_points_discount':\r\n\t\t\treturn \"Dinner Dollars\";\r\n\t\tcase \"misc_food_subtotal\":\r\n\t\t\treturn \"Miscellaneous Food Cost\";\r\n\t\tcase \"misc_nonfood_subtotal\":\r\n\t\t\treturn \"Miscellaneous Non-food Cost\";\r\n\t\tcase \"subtotal_service_fee\":\r\n\t\t\treturn \"Service Fee\";\r\n\t\tcase \"subtotal_delivery_fee\":\r\n\t\t\treturn \"Delivery Fee\";\r\n\t\tcase 'misc_food_subtotal_desc':\r\n\t\t\treturn 'Misc Food Description';\r\n\t\tcase 'misc_nonfood_subtotal_desc':\r\n\t\t\treturn 'Misc Non-food Description';\r\n\t\tcase 'service_fee_description':\r\n\t\t\treturn 'Service Fee Description';\r\n\t\tcase 'session_discount':\r\n\t\t\treturn 'Session Discount';\r\n\t\tcase 'fundraiser':\r\n\t\t\treturn 'Fundraiser';\r\n\t\tcase 'fundraiser_value':\r\n\t\t\treturn 'Fundraiser Value';\r\n\t\tcase 'ltd_roundup_value':\r\n\t\t\treturn 'Dream Dinners Foundation Round Up Value';\r\n\t\tcase 'ltd_roundup':\r\n\t\t\treturn 'Dream Dinners Foundation Round Up';\r\n\t\tdefault:\r\n\t\t\treturn 'error';\r\n\t}\r\n}\r\n\r\nfunction getAbbreviatedSummaryString()\r\n{\r\n\tvar htmlStr = \"\";\r\n\r\n\thtmlStr += \"<h3>Delivered Order</h3>\";\r\n\r\n\tvar first = true;\r\n\tfor (var box_inst_id in changeList.boxes)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Added Boxes</h3><ul style='margin: 4px;'>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\thtmlStr += \"<li>\";\r\n\r\n\t\tif (changeList.boxes.hasOwnProperty(box_inst_id))\r\n\t\t{\r\n\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\r\n\r\n\t\t\tif (changeList.boxes[box_inst_id] > 0)\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Added \" + changeList.boxes[box_inst_id] + \"<i>\" + title + \"</i>\";\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Removed \" + changeList.boxes[box_inst_id] * -1 + \"<i>\" + boxesDeletedFromActiveOrder[box_inst_id] + \"</i>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtmlStr += \"</li>\";\r\n\r\n\t}\r\n\r\n\tif (!first)\r\n\t{\r\n\t\thtmlStr += \"</ul>\";\r\n\t}\r\n\r\n\t$(\"[data-dd_type='item_field']\").each(function () {\r\n\t\tvar curVal = $(this).val();\r\n\r\n\t\tif ($(this).data(\"number\") == true)\r\n\t\t{\r\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\r\n\t\t\tcurVal = parseFloat(curVal);\r\n\t\t\tif (isNaN(curVal))\r\n\t\t\t{\r\n\t\t\t\tcurVal = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (curVal > 0)\r\n\t\t\t{\r\n\t\t\t\thtmlStr += getHumanReadableName(this.id) + \" costs of $\" + formatAsMoney(curVal);\r\n\r\n\t\t\t\tvar descIDStr = \"\";\r\n\r\n\t\t\t\tswitch (this.id)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"misc_food_subtotal\":\r\n\t\t\t\t\t\tdescIDStr = \"misc_food_subtotal_desc\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"misc_nonfood_subtotal\":\r\n\t\t\t\t\t\tdescIDStr = \"misc_nonfood_subtotal_desc\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"subtotal_service_fee\":\r\n\t\t\t\t\t\tdescIDStr = \"service_fee_description\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar desc = null;\r\n\t\t\t\tif (descIDStr != \"\")\r\n\t\t\t\t{\r\n\t\t\t\t\tdesc = $(\"#\" + descIDStr).val();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (desc)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \". <span>( \" + desc + \" )</span><br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \".<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Discounts\r\n\r\n\tvar discountsHTML = \"\";\r\n\r\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\r\n\r\n\t\tvar curVal = $(this).val();\r\n\r\n\t\tif ($(this).data(\"number\") == true)\r\n\t\t{\r\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\r\n\t\t\tcurVal = parseFloat(curVal);\r\n\t\t\tif (isNaN(curVal))\r\n\t\t\t{\r\n\t\t\t\tcurVal = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (curVal.valueOf() > 0)\r\n\t\t{\r\n\t\t\tdiscountsHTML += getHumanReadableName(this.id) + \" applied.<br />\";\r\n\t\t}\r\n\t});\r\n\r\n\tif (discountsHTML != \"\")\r\n\t{\r\n\t\thtmlStr += \"<h3>Discounts</h3>\" + discountsHTML;\r\n\t}\r\n\r\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\r\n\t{\r\n\t\thtmlStr += \"<h3>Payments</h3>\";\r\n\r\n\t\tvar payment1Type = $('#payment1_type').val();\r\n\r\n\t\tif (payment1Type != '')\r\n\t\t{\r\n\t\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#creditDiv').is(\":visible\");\r\n\t\t\t{\r\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar ccRefundTotal = 0;\r\n\t\t\t\t$(\"[id^='Cr_RT_']\").each(function () {\r\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (ccRefundTotal > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment1_type').val() != \"\")\r\n\t\t{\r\n\t\t\tvar payment2Type = $('#payment2_type').val();\r\n\t\t\tif (payment2Type && payment2Type != \"\")\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($('#use_store_credit').is(':checked'))\r\n\t\t{\r\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn htmlStr;\r\n}\r\n\r\nfunction updateChangeList()\r\n{\r\n\r\n\tlet itemChanges = false;\r\n\tlet discountChanges = false;\r\n\tlet reportingChanges = false;\r\n\r\n\tlet discountOrPaymentChanges = false;\r\n\tlet showSaveButton = false;\r\n\r\n\tchangeList = {};\r\n\tchangeList.stdMenuItems = {};\r\n\tchangeList.FTMenuItems = {};\r\n\tchangeList.miscCosts = {};\r\n\tchangeList.miscDescs = {};\r\n\tchangeList.bundleItems = {};\r\n\tchangeList.order_type = \"\";\r\n\tchangeList.discounts = {};\r\n\tchangeList.reporting = {};\r\n\tchangeList.delivery = {};\r\n\tchangeList.boxes = {}\r\n\tchangeList.box_contents = {}\r\n\r\n\tfor (var box_inst in current_box_ids)\r\n\t{\r\n\t\tcurrent_box_ids[box_inst] = 0;\r\n\t}\r\n\r\n\t$(\"[id^='box_inst_id_']\").each(function () {\r\n\t\tlet list_id = this.id.split(\"_\")[3];\r\n\t\tcurrent_box_ids[list_id] = 1;\r\n\r\n\t\tif ($(this).data(\"contents_are_fixed\") == true)\r\n\t\t{\r\n\t\t\tif (!$(this).data(\"is_saved\"))\r\n\t\t\t{\r\n\t\t\t\tchangeList.boxes[list_id] = 1;\r\n\t\t\t\titemChanges = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!$(this).data(\"is_saved\"))\r\n\t\t\t{\r\n\t\t\t\tchangeList.boxes[list_id] = 1;\r\n\t\t\t\titemChanges = true;\r\n\r\n\t\t\t\t// also need to see it contents changed\r\n\t\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\r\n\t\t\t\t\tlet curQty = $(this).val();\r\n\t\t\t\t\tlet savedQty = $(this).data('claimed_qty');\r\n\t\t\t\t\tlet menu_item_id = $(this).data('menu_item_id');\r\n\r\n\t\t\t\t\tif (curQty != savedQty)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (!changeList.box_contents[list_id])\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tchangeList.box_contents[list_id] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tchangeList.box_contents[list_id][menu_item_id] = curQty - savedQty\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// also need to see it contents changed\r\n\t\t\t\t$(\"input\").filter(\"[data-box_inst_id='\" + list_id + \"']\").each(function () {\r\n\t\t\t\t\tlet curQty = $(this).val();\r\n\t\t\t\t\tlet savedQty = $(this).data('claimed_qty');\r\n\t\t\t\t\tlet menu_item_id = $(this).data('menu_item_id');\r\n\r\n\t\t\t\t\tif (curQty != savedQty)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (!changeList.box_contents.list_id)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tchangeList.box_contents.list_id = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tchangeList.box_contents.list_id[menu_item_id] = curQty - savedQty\r\n\t\t\t\t\t\titemChanges = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tfor (var box_inst in current_box_ids)\r\n\t{\r\n\t\tif (current_box_ids[box_inst] == 0)\r\n\t\t{\r\n\t\t\tchangeList.boxes[box_inst] = -1;\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t// Items\r\n\t$(\"[id^='qty_']\").each(function ()\r\n\t{\r\n\t\tif ($(this).val() != $(this).data('org_value'))\r\n\t\t{\r\n\t\t\tif ($(this).data('dd_type') == 'cts')\r\n\t\t\t{\r\n\t\t\t\tchangeList.FTMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tchangeList.stdMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\r\n\t\t\t}\r\n\r\n\t\t\t$(this).addClass('unsaved_data');\r\n\t\t\titemChanges = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('unsaved_data');\r\n\t\t}\r\n\t});\r\n\t*/\r\n\r\n\t// Misc Costs\r\n\t$(\"[data-dd_type='item_field']\").each(function () {\r\n\t\tvar curVal = $(this).val();\r\n\t\tvar orgVal = $(this).data('org_value');\r\n\r\n\t\tif (curVal == undefined || curVal == \"\")\r\n\t\t{\r\n\t\t\tcurVal = \"0.00\";\r\n\t\t}\r\n\r\n\t\tif ($(this).data(\"number\") == true)\r\n\t\t{\r\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\r\n\t\t\tcurVal = parseFloat(curVal);\r\n\t\t\torgVal = parseFloat(orgVal);\r\n\r\n\t\t\tif (isNaN(curVal))\r\n\t\t\t{\r\n\t\t\t\tcurVal = 0;\r\n\t\t\t}\r\n\t\t\tif (isNaN(orgVal))\r\n\t\t\t{\r\n\t\t\t\torgVal = 0;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (curVal.valueOf() != orgVal.valueOf())\r\n\t\t{\r\n\t\t\t$(this).addClass('unsaved_data');\r\n\r\n\t\t\tif ($(this).data(\"number\") == true)\r\n\t\t\t{\r\n\t\t\t\t// we're not tracking description fields for now\r\n\t\t\t\tchangeList.miscCosts[this.id] = {\r\n\t\t\t\t\tnewVal: $(this).val(),\r\n\t\t\t\t\torgVal: $(this).data('org_value'),\r\n\t\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\titemChanges = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('unsaved_data');\r\n\t\t}\r\n\t});\r\n\r\n\tif (itemChanges)\r\n\t{\r\n\t\t$(\"#items_tab_li\").addClass(\"unsaved_data_on_tab\");\r\n\t\tshowSaveButton = true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#items_tab_li\").removeClass(\"unsaved_data_on_tab\");\r\n\t}\r\n\r\n\t// Discounts\r\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function () {\r\n\t\tvar curVal = $(this).val();\r\n\t\tvar orgVal = $(this).data('org_value');\r\n\r\n\t\tif ($(this).data(\"number\") == true)\r\n\t\t{\r\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\r\n\t\t\tcurVal = parseFloat(curVal);\r\n\t\t\torgVal = parseFloat(orgVal);\r\n\r\n\t\t\tif (isNaN(curVal))\r\n\t\t\t{\r\n\t\t\t\tcurVal = 0;\r\n\t\t\t}\r\n\t\t\tif (isNaN(orgVal))\r\n\t\t\t{\r\n\t\t\t\torgVal = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (curVal.valueOf() != orgVal.valueOf())\r\n\t\t{\r\n\t\t\t// we're not  tracking description fields for now\r\n\t\t\tchangeList.discounts[this.id] = {\r\n\t\t\t\tnewVal: $(this).val(),\r\n\t\t\t\torgVal: $(this).data('org_value'),\r\n\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\r\n\t\t\t};\r\n\r\n\t\t\t$(this).addClass('unsaved_data');\r\n\t\t\tdiscountOrPaymentChanges = true;\r\n\t\t\tdiscountChanges = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).removeClass('unsaved_data');\r\n\t\t}\r\n\t});\r\n\r\n\t// coupons\r\n\tvar orgCouponVal = $(\"#org_coupon_id\").val();\r\n\tvar curCouponVal = $(\"#coupon_id\").val();\r\n\r\n\tif (orgCouponVal != curCouponVal)\r\n\t{\r\n\t\tdiscountOrPaymentChanges = true;\r\n\r\n\t\tif (orgCouponVal == \"\")\r\n\t\t{\r\n\t\t\t//added\r\n\t\t\tchangeList.coupon = {\r\n\t\t\t\tnewVal: curCouponVal,\r\n\t\t\t\torgVal: orgCouponVal,\r\n\t\t\t\tchange_type: \"added\"\r\n\t\t\t};\r\n\t\t}\r\n\t\telse if (curCouponVal == \"\")\r\n\t\t{\r\n\t\t\t//removed\r\n\t\t\t//added\r\n\t\t\tchangeList.coupon = {\r\n\t\t\t\tnewVal: curCouponVal,\r\n\t\t\t\torgVal: orgCouponVal,\r\n\t\t\t\tchange_type: \"removed\"\r\n\t\t\t};\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//added\r\n\t\t\tchangeList.coupon = {\r\n\t\t\t\tnewVal: curCouponVal,\r\n\t\t\t\torgVal: orgCouponVal,\r\n\t\t\t\tchange_type: \"changed\"\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif (deliveryChanges)\r\n\t{\r\n\t\t$(\"#delivery_tab_li\").addClass(\"unsaved_data_on_tab\");\r\n\t\tshowSaveButton = true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#delivery_tab_li\").removeClass(\"unsaved_data_on_tab\");\r\n\t}\r\n\r\n\tif (discountOrPaymentChanges)\r\n\t{\r\n\t\t$(\"#payments_tab_li\").addClass(\"unsaved_data_on_tab\");\r\n\t\tshowSaveButton = true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#payments_tab_li\").removeClass(\"unsaved_data_on_tab\");\r\n\t}\r\n\r\n\tif (orderState == 'SAVED' && (showSaveButton || $('#use_store_credit').is(':checked')))\r\n\t{\r\n\t\t$(\"#saveOrderSpan\").show();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#saveOrderSpan\").hide();\r\n\t}\r\n\r\n\tif (orderState == 'SAVED' && ($('#use_store_credit').is(':checked') || paymentChanges))\r\n\t{\r\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\r\n\r\n\t}\r\n\r\n\tif (orderState == 'ACTIVE' || discountEligable.limited_access)\r\n\t{\r\n\t\t$(\"#finalizeOrderSpan\").show();\r\n\t\tif (showSaveButton || paymentChanges || $('#use_store_credits').is(':checked'))\r\n\t\t{\r\n\t\t\tdiscountOrPaymentChanges = true;\r\n\t\t\t$(\"#submit_button\").attr(\"disabled\", false);\r\n\t\t\t$(\"#finalize_msg\").show();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"#submit_button\").attr(\"disabled\", true);\r\n\t\t\t$(\"#finalize_msg\").hide();\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#finalizeOrderSpan\").hide();\r\n\t}\r\n\r\n\tif (itemChanges || discountOrPaymentChanges)\r\n\t{\r\n\t\t$(\"#changeListTab\").addClass('unsaved_data_list');\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"#changeListTab\").removeClass('unsaved_data_list');\r\n\t}\r\n\r\n\tdrawChangeList();\r\n}\r\n\r\nfunction handleAutoAdjust(obj)\r\n{\r\n\t// called when the document is loaded or when the \"autoAdjust\" check box changes\r\n\r\n\t// if checked then setup the amounts to be credited/debited\r\n\tif (obj.checked)\r\n\t{\r\n\t\tvar balance = Number($('#OEH_remaing_balance').html());\r\n\r\n\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || balance > 0))\r\n\t\t{\r\n\t\t\tif (balance > 0)\r\n\t\t\t{\r\n\t\t\t\t$('#payment1_type').val('DPADJUST');\r\n\t\t\t\tchangePayment1('DPADJUST');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tadjustPendingDelayedPayment(balance);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\r\n\t\t\tif (balance > 0)\r\n\t\t\t{\r\n\t\t\t\t$('#payment1_type').val('REFERENCE');\r\n\t\t\t\tchangePayment1('REFERENCE');\r\n\t\t\t}\r\n\r\n\t\t\tassignBalanceToRefTransactions(balance);\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\r\n\t\tif ($('#payment1_type').val() != \"\")\r\n\t\t{\r\n\t\t\t$('#payment1_type').val('');\r\n\t\t\tchangePayment1('');\r\n\t\t}\r\n\r\n\t\t// also clear any credits\r\n\t\tfor (ident in existingPaymentAmountArray)\r\n\t\t{\r\n\t\t\t$('#Cr_RT_' + ident).val(\"\");\r\n\t\t}\r\n\r\n\t\t// or if trying to credit\r\n\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n}\r\n\r\nfunction getAbbreviatedChangeString()\r\n{\r\n\tvar htmlStr = \"\";\r\n\tvar addedStd = 0;\r\n\tvar removedStd = 0;\r\n\r\n\tvar htmlStr = \"\";\r\n\r\n\tif (needPlatePointsMaxDiscountChangeWarning)\r\n\t{\r\n\t\thtmlStr += \"<div style='color:red;'>Warning: The amount discountable by Dinner Dollars has changed. You may wish to review and adjust the Dinner Dollars discount.</div>\";\r\n\r\n\t}\r\n\tvar first = true;\r\n\tfor (var box_inst_id in changeList.boxes)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Added Boxes</h3><ul style='margin: 4px;'>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\thtmlStr += \"<li>\";\r\n\r\n\t\tif (changeList.boxes.hasOwnProperty(box_inst_id))\r\n\t\t{\r\n\t\t\tvar title = $(\"#box_inst_id_\" + box_inst_id).data('box_label');\r\n\r\n\t\t\tif (changeList.boxes[box_inst_id] > 0)\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Added \" + changeList.boxes[box_inst_id] + \"<i>\" + title + \"</i>\";\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\thtmlStr += \"Removed \" + changeList.boxes[box_inst_id] * -1 + \"<i>\" + boxesDeletedFromActiveOrder[box_inst_id] + \"</i>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtmlStr += \"</li>\";\r\n\r\n\t}\r\n\r\n\tif (!first)\r\n\t{\r\n\t\thtmlStr += \"</ul>\";\r\n\t}\r\n\r\n\tfor (var item in changeList.miscCosts)\r\n\t{\r\n\r\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\r\n\t\t{\r\n\r\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\r\n\t\t\t{\r\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tfor (var item in changeList.miscDescs)\r\n\t{\r\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\r\n\t\t{\r\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\r\n\t\t}\r\n\t}\r\n\r\n\tfirst = true;\r\n\tfor (var item in changeList.discounts)\r\n\t{\r\n\t\tif (first)\r\n\t\t{\r\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\r\n\t\tif (changeList.discounts.hasOwnProperty(item))\r\n\t\t{\r\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\r\n\t\t\t{\r\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tif ($('#autoAdjust').is(\":checked\"))\r\n\t{\r\n\t\thtmlStr += \"<span style='color:red'>Auto-Adjust is checked and will \" + $(\"#adj_action\").html() + \"</span>\";\r\n\r\n\t}\r\n\r\n\thtmlStr = \"<div id='finalize_changes_div'>\" + htmlStr + \"</div>\";\r\n\treturn htmlStr;\r\n}\r\n\r\nfunction addPaymentToLockedOrder()\r\n{\r\n\tvar billing_name = $(\"#payment1_ccNameOnCard\").val();\r\n\tvar billing_address = $(\"#billing_address_1\").val();\r\n\tvar billing_zip = $(\"#billing_postal_code_1\").val();\r\n\tvar amt = $(\"#payment1_cc_total_amount\").val();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tasync: true,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\tstore_id: STORE_DETAILS.id,\r\n\t\t\top: 'get_token',\r\n\t\t\torder_id: order_id,\r\n\t\t\tamount: amt,\r\n\t\t\tuser_id: user_id,\r\n\t\t\tbilling_name: billing_name,\r\n\t\t\tbilling_address: billing_address,\r\n\t\t\tbilling_zip: billing_zip,\r\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val(),\r\n\t\t\tchain_token: true\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\r\n\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\r\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder() get_token successful\");\r\n\r\n\t\t\t\tvar token = json.token;\r\n\r\n\t\t\t\tsend(token, 1, false, true, true, false);\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + json.processor_message);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t$(\"#paying_div\").remove();\r\n\r\n\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: response\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n}\r\n\r\nfunction submitPage()\r\n{\r\n\tintenseLogging(\"submitPage() called\");\r\n\r\n\tvar form = $(\"#editorForm\")[0];\r\n\r\n\tvar is_valid = confirm_and_check_form(form);\r\n\r\n\tif (is_valid)\r\n\t{\r\n\t\tvar message = \"This can not be undone. Are you sure you want to submit the changes?\";\r\n\t\tvar changesBlurb = getAbbreviatedChangeString();\r\n\t\tmessage += \"<br /><br />\" + changesBlurb;\r\n\r\n\t\tvar dialogHeight = 460;\r\n\r\n\t\tif (message.length < 128)\r\n\t\t{\r\n\t\t\tdialogHeight = 160;\r\n\t\t}\r\n\t\telse if (message.length < 256)\r\n\t\t{\r\n\t\t\tdialogHeight = 260;\r\n\t\t}\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Finalize',\r\n\t\t\tmessage: message,\r\n\t\t\tmodal: true,\r\n\t\t\twidth: 400,\r\n\t\t\theight: dialogHeight,\r\n\t\t\tconfirm: function () {\r\n\r\n\t\t\t\tif (supports_transparent_redirect && $(\"#payment1_type\").val() == 'CC')\r\n\t\t\t\t{\r\n\t\t\t\t\tintenseLogging(\"submitPage() confirmed\");\r\n\r\n\t\t\t\t\tif (!discountEligable.limited_access)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tupdateActiveOrder(true, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\taddPaymentToLockedOrder(true, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$('<input>').attr({\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'changeList',\r\n\t\t\t\t\t\tvalue: JSON.stringify(changeList)\r\n\t\t\t\t\t}).appendTo($(form));\r\n\r\n\t\t\t\t\t$('<input>').attr({\r\n\t\t\t\t\t\ttype: 'hidden',\r\n\t\t\t\t\t\tname: 'changeListStr',\r\n\t\t\t\t\t\tvalue: getChangeListHTML()\r\n\t\t\t\t\t}).appendTo($(form));\r\n\r\n\t\t\t\t\t$(\"#submit_changes\").val(\"true\");\r\n\t\t\t\t\t$(\"#editorForm\").submit();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n}\r\n\r\nfunction resetPage()\r\n{\r\n\tintenseLogging(\"resetPage() called\");\r\n\r\n\tbounce(window.location.href);\r\n}\r\n\r\nfunction confirm_and_check_form(form)\r\n{\r\n\r\n\tintenseLogging(\"confirm_and_check_form() called\");\r\n\r\n\tif (orderState == 'NEW' || orderState == 'SAVED')\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn _check_form(form);\r\n}\r\n\r\n// rounds to the nearest penny\r\n// move to global once this is found to be reliable\r\nfunction dd_round_amount(inAmount)\r\n{\r\n\tinAmount += .000005;\r\n\r\n\tvar tempVal = inAmount * 1000.0;\r\n\ttempVal = parseInt(tempVal);\r\n\ttempVal = tempVal / 10;\r\n\tvar pennyFraction = tempVal - Math.floor(tempVal);\r\n\tif (pennyFraction >= .5)\r\n\t{\r\n\t\ttempVal = Math.floor(tempVal) + 1;\r\n\t}\r\n\telse\r\n\t{\r\n\t\ttempVal = Math.floor(tempVal);\r\n\t}\r\n\r\n\treturn tempVal / 100;\r\n}\r\n\r\n/*\r\n\r\n function reportTestFailure(testNum, actual, correct)\r\n {\r\n if (actual != correct)\r\n {\r\n alert(\"Test #: \" + testNum + \" actual: \" + actual + \" correct: \" + correct);\r\n }\r\n }\r\n\r\n function doTests()\r\n {\r\n\r\n var testmultiplier = \".5\";\r\n\r\n var testNum = \"260.09\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(1, newResult, 130.05);\r\n\r\n var testNum = \"209.10\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(2, newResult, 104.55);\r\n\r\n testNum = \"209.09\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(3, newResult, 104.55);\r\n\r\n testNum = \"209\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(4, newResult, 104.5);\r\n\r\n testNum = \"1\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(5, newResult, .5);\r\n\r\n testNum = \"0\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(6, newResult, 0);\r\n\r\n testNum = \".05\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(7, newResult, .03);\r\n\r\n testNum = \".005\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(8, newResult, 0);\r\n\r\n testNum = \"499.99\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(9, newResult, 250);\r\n\r\n var testNum = \"209.10\";\r\n var testmultiplier = \".12\";\r\n\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(10, newResult, 25.09);\r\n\r\n testNum = \"209.09\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(11, newResult, 25.09);\r\n\r\n testNum = \"209\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(12, newResult, 25.08);\r\n\r\n testNum = \"1\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(13, newResult, .12);\r\n\r\n testNum = \"0\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(14, newResult, 0);\r\n\r\n testNum = \".05\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(15, newResult, .01);\r\n\r\n testNum = \".005\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(16, newResult, 0);\r\n\r\n testNum = \"499.99\";\r\n var testResult = testNum * testmultiplier;\r\n var newResult = dd_round_amount(testResult);\r\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\r\n reportTestFailure(17, newResult, 60);\r\n\r\n }\r\n\r\n doTests();\r\n\r\n */\r\n\r\n// this massive function is called anytime something that affects costs or payments is altered\r\nfunction calculateTotal()\r\n{\r\n\r\n\tvar total = 0;\r\n\tvar servings = 0;\r\n\tvar productsSubTotal = 0;\r\n\tvar discounted_total = 0;\r\n\tvar main_items_count = 0;\r\n\tvar num_boxes = 0;\r\n\r\n\tfor (var x in entreeIDToInventoryMap)\r\n\t{\r\n\t\tentreeIDToInventoryMap[x].remaining = entreeIDToInventoryMap[x].org_remaining;\r\n\t\t$('#inv_' + x).html(entreeIDToInventoryMap[x].org_remaining + \"/serv\");\r\n\t}\r\n\r\n\t// ---------------------------------------------------------- Items\r\n\t$(\"[id^='box_inst_id_']\").each(function () {\r\n\t\tlet box_local_id = this.id.split(\"_\")[2];\r\n\r\n\t\tlet cost = $(this).data(\"box_price\");\r\n\t\tlet items_in_box = $(this).data(\"number_items_required\");\r\n\t\tlet servings_in_box = $(this).data(\"number_servings_required\");\r\n\t\ttotal += (cost * 1);\r\n\t\tmain_items_count += items_in_box;\r\n\t\tservings += servings_in_box;\r\n\t\tnum_boxes++;\r\n\t});\r\n\r\n\tdiscounted_total = total;\r\n\r\n\t// update the entree and serving totals display\r\n\t$('#OEH_item_count').html(main_items_count);\r\n\t$('#OEH_number_servings').html(servings);\r\n\t$('#OEH_number_boxes').html(num_boxes);\r\n\r\n\tdiscounted_total = Math.round(discounted_total * 100) / 100;\r\n\r\n\t// --------------------------------------------------------------------- menu items subtotal\r\n\t$('#orderSubTotal').val(formatAsMoney(Math.round(total * 100) / 100));\r\n\t$('#OEH_menu_subtotal').html(formatAsMoney(discounted_total));\r\n\t$('#orderTotal').val(formatAsMoney(discounted_total));\r\n\r\n\t// ------------------------------------------------------ food subtotal\r\n\r\n\t$('#OEH_menu_subtotal').html(formatAsMoney((discounted_total * 1)));\r\n\r\n\tvar newGrandTotal = discounted_total;\r\n\tvar pre_discounts_grand_total = newGrandTotal;\r\n\r\n\t// -------------------------------DISCOUNTS-----------------------------------------\r\n\t// ---------------------------------------------- Direct Order\r\n\tvar directDiscountVal = Number(0);\r\n\r\n\tdirectDiscount = $('#direct_order_discount');\r\n\r\n\tif (directDiscount.length)\r\n\t{\r\n\t\tdirectDiscountVal = directDiscount.val();\r\n\r\n\t\tif (isNaN(directDiscountVal))\r\n\t\t{\r\n\t\t\tdirectDiscountVal = 0;\r\n\t\t}\r\n\r\n\t\tif (directDiscountVal > pre_discounts_grand_total)\r\n\t\t{\r\n\t\t\tdirectDiscountVal = pre_discounts_grand_total;\r\n\t\t\tdirectDiscount.val(directDiscountVal);\r\n\t\t}\r\n\r\n\t\tif (directDiscountVal)\r\n\t\t{\r\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - directDiscountVal);\r\n\t\t}\r\n\r\n\t\t$('#OEH_direct_order_discount').html(formatAsMoney(directDiscountVal));\r\n\r\n\t}\r\n\r\n\t//----------------------------------------------------Dinner Dollars\r\n\tdiscountablePlatePointsAmount = handleDinnerDollars(newGrandTotal);\r\n\r\n\t// ------------------------------------------------------------------- coupon Discount\r\n\r\n\tif (couponDiscountMethod == 'PERCENT')\r\n\t{\r\n\t\tvar newDiscountAmount = Math.floor(pre_discounts_grand_total * (couponDiscountVar));\r\n\t\tnewDiscountAmount /= 100;\r\n\t\t$('#couponValue').val(newDiscountAmount);\r\n\t}\r\n\r\n\tvar couponDiscountVal = Number(0);\r\n\tcouponDiscount = $('#couponValue');\r\n\r\n\tif (couponDiscount.length)\r\n\t{\r\n\t\tif (couponDiscount.val() == \"\")\r\n\t\t{\r\n\t\t\tcouponDiscount.val('0.00');\r\n\t\t}\r\n\t\tcouponDiscountVal = couponDiscount.val();\r\n\t}\r\n\r\n\tvar couponDiscountValIsDeliveryFee = false;\r\n\r\n\tif (typeof coupon != 'undefined' && coupon.limit_to_delivery_fee == '1' && coupon.discount_method == 'FLAT')\r\n\t{\r\n\t\tvar currentDeliveryFee = $(\"#subtotal_delivery_fee\").val();\r\n\t\tif (couponDiscountVal != currentDeliveryFee)\r\n\t\t{\r\n\t\t\tcouponDiscountVal = currentDeliveryFee;\r\n\t\t\t$('#couponValue').val(couponDiscountVal);\r\n\r\n\t\t}\r\n\r\n\t\tcouponDiscountValIsDeliveryFee = true;\r\n\t}\r\n\r\n\tif (couponDiscountVal)\r\n\t{\r\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - couponDiscountVal);\r\n\t\t$('#OEH_coupon_discount').html(formatAsMoney(couponDiscountVal));\r\n\t}\r\n\r\n\tvar curPPDiscount = 0;\r\n\t// ----------------------------------------------  PLATEPOINTS Discount\r\n\tif ($('#plate_points_discount').length)\r\n\t{\r\n\t\tcurPPDiscount = $('#plate_points_discount').val();\r\n\t\tif (curPPDiscount * 1 > discountablePlatePointsAmount * 1)\r\n\t\t{\r\n\t\t\tcurPPDiscount = discountablePlatePointsAmount;\r\n\r\n\t\t\tif (curPPDiscount == 0)\r\n\t\t\t{\r\n\t\t\t\t$('#plate_points_discount').val(\"\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#plate_points_discount').val(formatAsMoney(curPPDiscount));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(curPPDiscount));\r\n\r\n\r\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - curPPDiscount);\r\n\t}\r\n\r\n\t// ----------------------------------------------------------Membership Discount\r\n\r\n\tif (orderIsEligibleForMembershipDiscount && storeSupportsMembership)\r\n\t{\r\n\t\tvar couponAdjustment = Number(0);\r\n\t\tif (couponDiscountValIsServiceFee || couponDiscountValIsDeliveryFee)\r\n\t\t{\r\n\t\t\tcouponAdjustment = couponDiscountVal;\r\n\t\t}\r\n\r\n\t\tvar membership_discount_basis = Number((newGrandTotal * 1) + (couponAdjustment * 1));\r\n\t\tvar memberDiscountAmount = Number(membership_discount_basis * (membership_status.discount_var / 100));\r\n\t\tmemberDiscountAmount = Math.round(memberDiscountAmount * 100) / 100;\r\n\r\n\t\t$(\"#OEH_membership_discount\").html(formatAsMoney(memberDiscountAmount));\r\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - memberDiscountAmount);\r\n\r\n\t}\r\n\r\n\tvar deliveryFee = Number(0);\r\n\tif ($('#subtotal_delivery_fee')[0])\r\n\t{\r\n\t\tdeliveryFee = Number($('#subtotal_delivery_fee').val());\r\n\t\t$('#OEH_subtotal_delivery_fee').html(formatAsMoney(deliveryFee));\r\n\r\n\t\tnewGrandTotal = Number((newGrandTotal * 1) + (deliveryFee * 1));\r\n\r\n\t\tvar newFoodTotal = newGrandTotal - (deliveryFee * 1);\r\n\t}\r\n\r\n\t// --------------------------------------------------------------------- tax\r\n\tvar newFoodTax = 0;\r\n\tvar avalaraCalcTax = 0;\r\n\tvar newDeliveryTax = 0;\r\n\r\n\tif (orderState != \"NEW\" && newFoodTotal > 0)\r\n\t{\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tasync: false,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\top: 'retrieve_sales_tax',\r\n\t\t\t\torder_id: order_id,\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tstore_id: store_id,\r\n\t\t\t\tsubtotal_all_items: newGrandTotal,\r\n\t\t\t\tsubtotal_delivery_fee: deliveryFee\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tintenseLogging(\"retrieving Sales tax\");\r\n\r\n\t\t\t\tavalaraCalcTax = json.subtotal_food_sales_taxes;\r\n\t\t\t\tnewDeliveryTax = json.subtotal_delivery_tax;\r\n\r\n\t\t\t\t$('#OEH_food_tax_subtotal').text(formatAsMoney(avalaraCalcTax));\r\n\t\t\t\t$('#OEH_delivery_tax_subtotal').text(formatAsMoney(newDeliveryTax));\r\n\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\tintenseLogging(\"retrieving Sales tax: \" + strError + \" | \" + objAJAXRequest.responseText);\r\n\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tvar newNonFoodTax = 0; // convert to float\r\n\tif (productsSubTotal)\r\n\t{\r\n\t\t$('#nonFoodTaxLabel').html('Non-Food & Enrollment Tax');\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#nonFoodTaxLabel').html('Non-Food Tax');\r\n\r\n\t}\r\n\r\n\tnewFoodTax = formatAsMoney(avalaraCalcTax);\r\n\r\n\ttaxElem = document.getElementById('OEH_tax_subtotal');\r\n\tif (taxElem)\r\n\t{\r\n\t\ttaxElem.innerHTML = formatAsMoney(newNonFoodTax);\r\n\t}\r\n\r\n\ttaxElem = document.getElementById('OEH_food_tax_subtotal');\r\n\tif (taxElem)\r\n\t{\r\n\t\ttaxElem.innerHTML = formatAsMoney(newFoodTax);\r\n\t}\r\n\r\n\ttaxElem = document.getElementById('OEH_delivery_tax_subtotal');\r\n\tif (taxElem)\r\n\t{\r\n\t\ttaxElem.innerHTML = formatAsMoney(newDeliveryTax);\r\n\t}\r\n\r\n\tvar preTaxTotal = Number(newGrandTotal);\r\n\tnewGrandTotal = (newGrandTotal * 1) + (newFoodTax * 1) + (newNonFoodTax * 1) + (newDeliveryTax * 1);\r\n\r\n\t// -------------------------------------------------------------------- grand total\r\n\t$('#OEH_grandtotal').html(formatAsMoney(newGrandTotal));\r\n\t$('#OEH_new_total').html(formatAsMoney(newGrandTotal));\r\n\t$('#OEH_delta').html(formatAsMoney((orderInfoGrandTotal - newGrandTotal) * -1));\r\n\r\n\tvar paymentTotal = 0;\r\n\tif ($('#OEH_paymentsTotal').length)\r\n\t{\r\n\t\tpaymentTotal = $('#OEH_paymentsTotal').html();\r\n\t}\r\n\r\n\tvar remainingBalance = Number(formatAsMoney(paymentTotal - newGrandTotal));\r\n\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance * -1));\r\n\r\n\t// Values are now calculated and the summary display updated\r\n\t// Next Display \"balance\" messages and set up payments\r\n\r\n\tif (orderState == 'CANCELLED')\r\n\t{\r\n\t\tremainingBalance = paymentTotal;\r\n\t\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance));\r\n\r\n\t}\r\n\r\n\tif (remainingBalance > 0)\r\n\t{\r\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to the customer.\");\r\n\t\t$(\"#balanceRow\").addClass('balance_msg_customer_owed');\r\n\t\t$(\"#newPaymentDiv\").hide();\r\n\r\n\t\tif (canAdjustDelayedPayment && currentDPAmount > 0)\r\n\t\t{\r\n\t\t\t$('#dp_adjust_down_div').show();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#creditDiv').show();\r\n\t\t}\r\n\r\n\t\t$('#payment1_type').val('');\r\n\t\t$('#payment2_type').val('');\r\n\t\tchangePayment1('');\r\n\t\tchangePayment2('');\r\n\r\n\t\tpaymentChanges = true;\r\n\r\n\t\t$(\"#use_store_credits\").prop('checked', false);\r\n\t\t$(\"#use_store_credits\").prop('disabled', true);\r\n\r\n\t}\r\n\telse if (remainingBalance < 0)\r\n\t{\r\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to your store.\");\r\n\t\t$(\"#balanceRow\").addClass('balance_msg_store_owed');\r\n\t\t$(\"#newPaymentDiv\").show();\r\n\t\t$('#creditDiv').hide();\r\n\r\n\t\tif (canAdjustDelayedPayment)\r\n\t\t{\r\n\t\t\t$('#dp_adjust_down_div').hide();\r\n\t\t}\r\n\r\n\t\t$(\"#use_store_credits\").prop('disabled', false);\r\n\r\n\t\tvar doNewLivePaymentAdjustments = true;\r\n\t\tif (doNewLivePaymentAdjustments)\r\n\t\t{\r\n\r\n\t\t\tvar defaultPaymentAmount = remainingBalance * -1;\r\n\r\n\t\t\tif ($(\"#use_store_credits\").is(\":checked\"))\r\n\t\t\t{\r\n\r\n\t\t\t\tvar amountStoreCredit = Number($(\"#store_credits_amount\").val());\r\n\t\t\t\tif (isNaN(amountStoreCredit.valueOf()))\r\n\t\t\t\t{\r\n\t\t\t\t\tamountStoreCredit = Number(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdefaultPaymentAmount -= amountStoreCredit.valueOf();\r\n\t\t\t}\r\n\r\n\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount);\r\n\r\n\t\t\tif ($('#payment1_type').val() == 'CC')\r\n\t\t\t{\r\n\t\t\t\t$('#payment1_cc_total_amount').val(defaultPaymentAmount);\r\n\t\t\t}\r\n\t\t\telse if ($('#payment1_type').val() == 'CHECK')\r\n\t\t\t{\r\n\t\t\t\t$('#payment1_check_total_amount').val(defaultPaymentAmount);\r\n\t\t\t}\r\n\t\t\telse if ($('#payment1_type').val().split(\"_\")[0] == 'REF')\r\n\t\t\t{\r\n\t\t\t\t$('#payment1_ref_total_amount').val(defaultPaymentAmount);\r\n\t\t\t}\r\n\t\t\telse if (($('#payment1_type').val() == 'GIFT_CERT' || $('#payment1_type').val() == \"GIFT_CARD\") && $('#payment2_type').val() != \"\")\r\n\t\t\t{\r\n\t\t\t\tvar payment1Amount = null;\r\n\t\t\t\tif ($('#payment1_type').val() == 'GIFT_CERT')\r\n\t\t\t\t{\r\n\t\t\t\t\tpayment1Amount = Number($('#payment1_gc_total_amount').val());\r\n\t\t\t\t}\r\n\t\t\t\telse if ($('#payment1_type').val() == 'GIFT_CARD')\r\n\t\t\t\t{\r\n\t\t\t\t\tpayment1Amount = Number($('#debit_gift_card_amount').val());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isNaN(payment1Amount.valueOf()))\r\n\t\t\t\t{\r\n\t\t\t\t\tpayment1Amount = Number(0);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount - payment1Amount.valueOf());\r\n\t\t\t\tif ($('#payment2_type').val() == 'CC')\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment2_cc_total_amount').val(defaultPaymentAmount);\r\n\t\t\t\t}\r\n\t\t\t\telse if ($('#payment2_type').val() == 'CHECK')\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment2_check_total_amount').val(defaultPaymentAmount);\r\n\t\t\t\t}\r\n\t\t\t\telse if ($('#payment2_type').val() == 'CASH')\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment2_cash_total_amount').val(defaultPaymentAmount);\r\n\t\t\t\t}\r\n\t\t\t\telse if ($('#payment2_type').val().split(\"_\")[0] == 'REF')\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#payment2_ref_total_amount').val(defaultPaymentAmount);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\telse // == 0\r\n\t{\r\n\t\t$(\"#balance_msg\").html(\"0.00\");\r\n\t\t$(\"#balanceRow\").addClass('balance_msg_balanced');\r\n\t\t$(\"#newPaymentDiv\").show();\r\n\t\t$('#creditDiv').hide();\r\n\r\n\t\tif (canAdjustDelayedPayment)\r\n\t\t{\r\n\t\t\t$('#dp_adjust_down_div').hide();\r\n\t\t}\r\n\r\n\t\t$(\"#use_store_credits\").prop('disabled', false);\r\n\r\n\t\tassignBalanceToRefTransactions(0);\r\n\t}\r\n\r\n\tvar autoAdjustDiv = $('#autoAdjustDiv');\r\n\tif (autoAdjustDiv.length)\r\n\t{\r\n\r\n\t\tif (remainingBalance != 0 && canAutoAdjust)\r\n\t\t{\r\n\t\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || remainingBalance < 0))\r\n\t\t\t{\r\n\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>adjust customer's delayed payment.</b></span>\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (remainingBalance > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>credit customer's credit card now.</b></span>\");\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>charge original credit card now.</b></span>\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tautoAdjustDiv.show();\r\n\t\t\tif (!forceManualAutoAdjust)\r\n\t\t\t{\r\n\t\t\t\t$('#autoAdjust').prop('checked', true);\r\n\t\t\t\thandleAutoAdjust($('#autoAdjust').get()[0]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// if the div is hidden skip these steps\r\n\r\n\t\t\tif (autoAdjustDiv.is(\":visible\"))\r\n\t\t\t{\r\n\t\t\t\tautoAdjustDiv.hide();\r\n\t\t\t\t$('#autoAdjust').prop('checked', false);\r\n\t\t\t\t$('#payment1_type').val('');\r\n\t\t\t\t$('#payment2_type').val('');\r\n\t\t\t\tchangePayment1('');\r\n\t\t\t\tchangePayment2('');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t$('#help_msg').html(\"\");\r\n\r\n\t// enforce a few rules by disallowing checkout\r\n\tif ($('#submit_changes').length)\r\n\t{\r\n\r\n\t\tif (servings > 0)\r\n\t\t{\r\n\t\t\t$('#submit_changes').prop(\"disabled\", false);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\r\n\t\t}\r\n\r\n\t\tif (directDiscountVal >= (Number(preTaxTotal) + Number(directDiscountVal)) && preTaxTotal != 0)\r\n\t\t{\r\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\r\n\t\t\t$('#help_msg').html($('#help_msg').html() + \"You cannot use a Direct Order Discount that is equal to or greater than the food cost total. Please use the \\\"No Charge\\\" payment type to give away an order.\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif ($('#help_msg').length)\r\n\t{\r\n\t\tif ($('#help_msg').html() != \"\")\r\n\t\t{\r\n\t\t\t$('#help_msg').show();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#help_msg').hide();\r\n\t\t}\r\n\t}\r\n\r\n\treportPaymentStatus(false);\r\n\r\n\tHideLineItemsIfZero();\r\n\r\n\tif (orderState != 'NEW')\r\n\t{\r\n\t\tupdateChangeList();\r\n\t}\r\n\r\n}\r\n\r\nfunction handleDinnerDollars(total){\r\n\r\n\r\n\t//var serviceFee = Number(document.getElementById('OEH_subtotal_delivery_fee').value);\r\n\tvar discountablePlatePointsAmount = total;// + serviceFee.valueOf();\r\n\r\n\tif (discountablePlatePointsAmount != lastMaxPPDiscountAmount && lastMaxPPDiscountAmount != -1)\r\n\t{\r\n\t\tneedPlatePointsMaxDiscountChangeWarning = true;\r\n\t}\r\n\r\n\tlastMaxPPDiscountAmount = discountablePlatePointsAmount;\r\n\r\n\tif (discountablePlatePointsAmount < 0) discountablePlatePointsAmount = 0;\r\n\r\n\t$(\"#max_plate_points_deduction\").html(formatAsMoney(discountablePlatePointsAmount))\r\n\r\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\r\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\r\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\r\n\r\n\tif (maxPPDeduction < curPPDiscount)\r\n\t{\r\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\r\n\t}\r\n\r\n\tif (maxPPCredit > maxPPDeduction)\r\n\t{\r\n\t\t$('#tbody_max_plate_points_deduction').show();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#tbody_max_plate_points_deduction').hide();\r\n\t}\r\n\r\n\tvar platePointsDiscountOrg = Number($('#OEH_plate_points_discount_org_fee').html());\r\n\tvar platePointsDiscount = Number($('#OEH_plate_points_order_discount_fee').html());\r\n\r\n\tif (platePointsDiscountOrg == 0 && platePointsDiscount == 0)\r\n\t{\r\n\t\t$('#dinnerDollarsDiscountRow').hide();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('#dinnerDollarsDiscountRow').show();\r\n\t}\r\n\r\n\r\n\r\n\treturn discountablePlatePointsAmount;\r\n}\r\n\r\n$(document).on('change', '#shipping_phone_number', function (e) {\r\n\r\n\t$('.shipping_phone_number_new_div').hideFlex();\r\n\t$('#shipping_phone_number_new').prop('required', false);\r\n\r\n\tif ($(this).val() == 'new')\r\n\t{\r\n\t\t$('.shipping_phone_number_new_div').showFlex();\r\n\t\t$('#shipping_phone_number_new').prop('required', true);\r\n\r\n\t}\r\n});\r\n\r\n$(document).on('change keyup', '.delivery-input', function (e) {\r\n\r\n\tdeliveryChanges = false;\r\n\r\n\t$('.delivery-input').each(function () {\r\n\r\n\t\tif ($(this).data('org_value'))\r\n\t\t{\r\n\t\t\tvar val = $(this).val();\r\n\t\t\tvar org_value = $(this).data('org_value');\r\n\r\n\t\t\tif (val != org_value)\r\n\t\t\t{\r\n\t\t\t\tdeliveryChanges = true;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tupdateChangeList();\r\n\r\n});\r\n$(document).on('change', '#address_book_select', function (e) {\r\n\r\n\tlet id = $(this).val();\r\n\r\n\tif (id)\r\n\t{\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'admin_order_mgr_processor_delivered',\r\n\t\t\t\top: 'retrieve_address_from_address_book',\r\n\t\t\t\taddress_id: id,\r\n\t\t\t\tuser_id: user_id\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#shipping_firstname').val(json.address.firstname);\r\n\t\t\t\t\t$('#shipping_lastname').val(json.address.lastname);\r\n\t\t\t\t\t$('#shipping_address_line1').val(json.address.address_line1);\r\n\t\t\t\t\t$('#shipping_address_line2').val(json.address.address_line2);\r\n\t\t\t\t\t$('#shipping_city').val(json.address.city);\r\n\t\t\t\t\t$('#shipping_state_id').val(json.address.state_id);\r\n\t\t\t\t\t$('#shipping_postal_code').val(json.address.postal_code);\r\n\t\t\t\t\t$('#shipping_address_note').val(json.address.address_note);\r\n\t\t\t\t\t$('#shipping_phone_number').val(json.address.telephone_1);\r\n\t\t\t\t\t$('#shipping_gift_email_address').val(json.address.email_address);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Address Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n});"],"names":["itemChanges","discountOrPaymentChanges","deliveryChanges","discountChanges","reportingChanges","paymentChanges","changeList","currentlySavingOrder","intenseLoggingOn","boxesDeletedFromActiveOrder","needPlatePointsMaxDiscountChangeWarning","lastMaxPPDiscountAmount","admin_order_mgr_init","store_id","STORE_DETAILS","id","orderState","setupForNewOrder","setupForSavedOrder","setupForActiveOrder","initChangeList","init_inside_box_editing","calculateTotal","setAllPaymentFieldsToUnrequired","setupCouponState","setUpKeyHandlers","handle_special_instruction_notes","handle_cancel_order_delivered","handle_delete_saved_order_delivered","handle_free_menu_item_edit","handleDirectOrderDiscountFocusing","$","trigger","updateInventory","handle_is_gift","handleSessionSelection","on","let","selected_session_id","this","data","sessionDate","doReschedule","is","show","hide","validateBoxes","hasAtLeastOneBox","noCustomBoxesAreIncomplete","each","list_id","split","itemCount","filter","val","number_items_required","countItemsInBox","box_instance_id","retVal","off","itemError","boxError","menu_item_id","box_inst_id","newQty","curTotal","delta","isNaN","Math","floor","lastQty","servings","recipeID","new_servings_needed","current_inventory","html","updateChangeList","dd_message","title","message","addToInitialInventory","curAmount","curInv","initial_inventory","adjInv","document","e","bundle_id","box_id","box_type","box_label","ajax","url","type","timeout","dataType","processor","op","menu_id","order_id","user_id","success","json","processor_success","append","currentDeliveryFee","newDeliveryFee","Number","formatAsMoney","bundle_info","price_shipping","processor_message","error","objAJAXRequest","strError","response","remove","Object","assign","claimedAmount","recipe_id","focus","length","select","blur","curVal","trim","intenseLogging","window","console","log","saveSpecialInstructions","special_instructions","strip_tags","updateInstructionsOrgValues","responseText","booking_id","do_op","do","note","textarea_elem","addClass","special_instruction_note","removeClass","nl2br","onkeypress","OMDefaultKeyHandler","evt","event","charCode","which","keyCode","processCode","stopPropagation","lastCheckedGiftCertNumber","getChangeListHTML","height","width","modal","div_id","dialogClass","noOk","position","my","at","of","close","ui","updateItemsOrgValues","saveAll","saveItems","saveDiscountsUponCompletion","activateOnSaveDiscountsCompletion","dd_toast","boxList","subtotal_delivery_fee","items","itemTabIsDirty","saveDiscounts","setShipToAddressAndSaveOrder","shipping_data","order_state","bounce","Reschedule","org_session_id","session_id","saved_booking_id","new_session_id","new_session_time","new_ship_time","RetrieveCalendar","onSaveItems","HideLineItemsIfZero","timestamp","getQueryVariable","attr","discountEligable","limited_access","click","find","prop","isDeliveryAddressComplete","validated","onDeliveryTabSelected","onDeliveryTabDeselected","onSessionTabSelected","onSessionTabDeselected","onItemsTabSelected","onItemsTabDeselected","onPaymentTabSelected","onPaymentTabDeselected","onNotesTabSelected","handle_guest_account_notes","handle_admin_carryover_notes","handle_admin_order_notes","onNotesTabDeselected","onPaymentSelected","onPaymentDeselected","updateDiscountOrgValues","_validate_discounts","_validate_address","validationSuccess","payOnCompletion","direct_order_discount","dinner_dollars_discount","coupon_id","coupon_free_menu_item","plate_points_discount","updateReportingOrgValues","couponFreeMenuItem","onAddPaymentAndActivate","paymentToken","getPaymentData","payment_number","paymentData","number","amount","cert_type","ccNameOnCard","ccType","ccMonth","ccYear","cc_security_code","billing_address","billing_postal_code","is_store_specific_flat_rate_deposit_delayed_payment","do_not_ref","save_card","DPSetting","alert","indexOf","reference_id","validatePayment1","inputArray","validates","substr","_check_elements","depositWarningStr","CC1Amount","store_specific_deposit","validatePayment2","addPaymentAndActivate","changesBlurb","getAbbreviatedSummaryString","confirm","discounts_are_valid","save2PaymentsAndBookOrder","payment2Type","payment1Data","token","payment2Data","supports_transparent_redirect","DP_State","max_plate_points_deduction","async","payment_data","add_payment_data","delay_remainder","dd_csrf_token","warnOfOutstandingSavedOrdersOnFullSession","billing_name","billing_zip","amt","chain_token","getTokenToken","send","savePayment2","handleDirectPayment","addOnly","go_to_confirm","payment1Type","displayModalWaitDialog","use_store_credits","store_credit_amount","mainPaymentData","additionalPaymentData","store_credits_amount","closeOnEscape","buttons","Refresh","location","href","action","cur_session_id","service_days","service_days_for_current_zip","onDayClick","obj","sessionTime","curSessionDate","open","siblings","onRescheduleClick","isDiscounted","control_message","onSessionClick","monthChange","monthVal","handleSummaryDisplayChange","checked","ShowAllLineItems","deliveryFeeOrg","deliveryFee","doDiscountOrg","doDiscount","couponDiscountOrg","couponDiscount","membershipDiscountOrg","membershipDiscount","foodTaxOrg","foodTax","nonFoodTaxOrg","nonFoodTax","deliveryTaxOrg","deliveryTax","ddOrg","dd","sort_by_price","a","b","price","drawChangeList","htmlStr","first","editedExistingBoxHTML","existingNewBoxHTML","thisBox","box_contents","hasOwnProperty","tempHTML","thisItem","item_name","boxes","hadMiscCostChanges","item","miscCosts","getHumanReadableName","miscDescs","order_type","discounts","reporting","coupon","change_type","ccRefundTotal","parseFloat","descIDStr","desc","discountsHTML","valueOf","showSaveButton","stdMenuItems","FTMenuItems","bundleItems","delivery","box_inst","current_box_ids","curQty","savedQty","orgVal","undefined","newVal","diff","orgCouponVal","curCouponVal","handleAutoAdjust","balance","canAdjustDelayedPayment","currentDPAmount","changePayment1","adjustPendingDelayedPayment","assignBalanceToRefTransactions","ident","existingPaymentAmountArray","reportPaymentStatus","getAbbreviatedChangeString","addedStd","removedStd","addPaymentToLockedOrder","submitPage","form","is_valid","confirm_and_check_form","dialogHeight","updateActiveOrder","name","value","JSON","stringify","appendTo","submit","resetPage","_check_form","dd_round_amount","inAmount","tempVal","parseInt","pennyFraction","total","productsSubTotal","discounted_total","main_items_count","num_boxes","x","entreeIDToInventoryMap","remaining","org_remaining","box_local_id","cost","items_in_box","servings_in_box","round","newGrandTotal","pre_discounts_grand_total","directDiscountVal","directDiscount","discountablePlatePointsAmount","handleDinnerDollars","couponDiscountMethod","newDiscountAmount","couponDiscountVal","couponDiscountValIsDeliveryFee","limit_to_delivery_fee","discount_method","curPPDiscount","orderIsEligibleForMembershipDiscount","storeSupportsMembership","couponAdjustment","couponDiscountValIsServiceFee","membership_discount_basis","memberDiscountAmount","membership_status","discount_var","newFoodTotal","newFoodTax","avalaraCalcTax","newDeliveryTax","subtotal_all_items","subtotal_food_sales_taxes","subtotal_delivery_tax","text","newNonFoodTax","taxElem","getElementById","innerHTML","preTaxTotal","orderInfoGrandTotal","paymentTotal","remainingBalance","changePayment2","doNewLivePaymentAdjustments","defaultPaymentAmount","amountStoreCredit","payment1Amount","autoAdjustDiv","canAutoAdjust","forceManualAutoAdjust","get","maxPPCredit","maxPPDeduction","platePointsDiscountOrg","platePointsDiscount","hideFlex","showFlex","org_value","address_id","address","firstname","lastname","address_line1","address_line2","city","state_id","postal_code","address_note","telephone_1","email_address"],"mappings":"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"}
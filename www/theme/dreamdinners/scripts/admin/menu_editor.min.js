let numberOfCustomerFacingCTSItems=0,numberOfCustomerFacingEFLItems=0,sidesDataArray=[],gNumOptionalsAdded=0,notShown=!0,dp_processing=!1,xmlHttp=null,noOverrideUnderBase=!1;function resetPage(){document.getElementById("action").value="menuChange",document.getElementById("menu_editor_form").submit()}function getPreviewItemPrice(e){let t=Number($("#ovr_"+e).val());return isNaN(t)||0==t.valueOf()?Number($("#row_"+e+" > .preview-price").text()):t}function removeOptionSelected(){let e=document.getElementById("sides");for(let t=e.length-1;t>=1;t--)e.options[t].selected&&e.remove(t)}function removeItem(e){gNumOptionalsAdded--;let t="row_"+e,n=document.getElementById(t);n.parentNode.removeChild(n);let i=sidesDataArray[e],r="("+i.SUPC_number+") "+i.name,a=document.getElementById("sides");a.options[a.length]=new Option(r,e),calculatePage()}function displayValidationErrorMsg(e){e="<span style='color:red; font-size:larger;'>"+e+"</span>",dd_message({title:"Error",message:e})}function clearErrors(){$("#errorMsgText").html(""),$("#errorMsg").hideFlex()}function storeChange(e){document.getElementById("action").value="storeChange",document.getElementById("menu_editor_form").submit()}function menuChange(e){document.getElementById("action").value="menuChange",document.getElementById("menu_editor_form").submit()}function confirm_and_round_form(e){let t=!1;return $("."+e+"-override-price-input").each((function(){t=""!==$(this).val().trim()})),t?dd_message({title:"Attention",message:"Are you sure want to update all Override Prices with rounded Markup Prices? This action will replace existing override prices with the newly calculated price.",modal:!0,confirm:function(){return round_markup_to_override(e),!1},cancel:function(){return!1}}):round_markup_to_override(e),!1}function round_markup_to_override(e){let t=!1;$(".markup-price").each((function(n){if($(this).is("[readonly]"));else{let n=$(this).parent().find("."+e+"-override-price-input");if(n.length){let e=parseFloat($(this).text()),i=Math.ceil(2*e)/2;n.val(i.toFixed(2)),t=!0}}})),t&&(calculatePage(),$("#saved_message, #saved_message_2").showFlex())}function selectedDefault(){notShown&&(bootbox.alert("Any Menus that do not currently have their own specific settings finalized will inherit these default settings."),notShown=!1),calculatePage()}function showPopup(e){var t={type:"GET",height:500,width:600,modal:!1,callBack:!1,resizable:!0};$.extend(t,e),$.ajax({url:"?"+t.module,type:t.type,success:function(e,n){t.message=e,dd_message(t),"function"==typeof t.callBack&&t.callBack()},error:function(e,t){response="Unexpected error"}})}function getXmlHttpObject(){let e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return e}function def_price_save_handleTimeout(){if(dp_processing){dp_processing=!1;let e="The server has not responded. Please try again.";document.getElementById("dp_error").style.display="block",document.getElementById("dp_error").innerHTML=e,document.getElementById("dp_proc_mess").style.display="none"}}function def_price_retreive_handleTimeout(){if(dp_processing){dp_processing=!1;let e="The server has not responded. Please try again.";document.getElementById("dp_error").style.display="block",document.getElementById("dp_error").innerHTML=e,document.getElementById("dp_proc_mess").style.display="none"}}function SaveDefPricingComplete(){if((4==xmlHttp.readyState||"complete"==xmlHttp.readyState)&&dp_processing){dp_processing=!1,document.getElementById("dp_proc_mess").style.display="none";let e="Sides &amp; Sweets default pricing has been saved";document.getElementById("dp_error").style.display="block",document.getElementById("dp_error").innerHTML=e}}function RetrieveDefPricingComplete(){if((4==xmlHttp.readyState||"complete"==xmlHttp.readyState)&&dp_processing)if(dp_processing=!1,xmlHttp.responseText&&"error"!=xmlHttp.responseText&&""!=xmlHttp.responseText){let t=xmlHttp.responseText.split("|"),n=[];for(let i in t){var e=t[i].split("~");e[0]&&(n[e[0]]=[e[1],e[2],e[3]])}calculatePage();let i=numberOfCustomerFacingCTSItems,r=document.getElementById("ctsItemsTbl").rows;for(let e=0;e<r.length;e++){if(-1==r[e].id.indexOf("row_"))continue;let t=null;t=r[e].id.substr(4);let a=document.getElementById("rec_id_"+t).innerHTML;if(n[a]){let e="ovr_"+t,r=document.getElementById(e);r&&(r.value=n[a][2]);let d=document.getElementById("vis_"+t),o=d.checked;d&&("1"==n[a][0]?!o&&i<20&&(d.checked=!0,i++):o&&(d.checked=!1,i--));let s=document.getElementById("hid_"+t);s&&("1"==n[a][1]?s.checked=!0:s.checked=!1)}}calculatePage(),document.getElementById("dp_proc_mess").style.display="none",document.getElementById("dp_error").style.display="none"}else{document.getElementById("dp_proc_mess").style.display="none";let e="There was an error when retrieving the default prices. Please try again.";document.getElementById("dp_error").style.display="block",document.getElementById("dp_error").innerHTML=e}}function SavePricing(){dd_message({title:"Save Default Pricing and Visibility",message:"Are you sure you want to save the default Sides and Sweets pricing and visibility? This cannot be undone.",confirm:function(){let e="data=",t=document.getElementById("ctsItemsTbl").rows;for(let n=0;n<t.length;n++){if(-1==t[n].id.indexOf("row_"))continue;let i=null;i=t[n].id.substr(4);let r=document.getElementById("rec_id_"+i).innerHTML,a=Number(menuInfo.mid[i].price),d=Number($("#row_"+i+" > .preview-price").text()),o=Number(menuInfo.mid[i].base_price);if(""==d||0==d||isNaN(d)||(a=d),a<o)return document.getElementById("dp_proc_mess").style.display="none",document.getElementById("dp_error").style.display="block",void(document.getElementById("dp_error").innerHTML="Override price must be greater than the price.");let s="0";document.getElementById("vis_"+i)&&document.getElementById("vis_"+i).checked&&(s="1");let m="0";document.getElementById("hid_"+i)&&document.getElementById("hid_"+i).checked&&(m="1"),e+=r+"~"+s+"~"+m+"~"+a+"|"}if(xmlHttp=getXmlHttpObject(),null==xmlHttp)return void bootbox.alert("The Default Pricing function is not compatible with your browser. Please contact your store for assistance.");document.getElementById("dp_proc_mess").style.display="inline",document.getElementById("dp_error").style.display="none",document.getElementById("dp_error").innerHTML="";let n="/processor?processor=admin_defaultPricingProcessor&action=save&store_id="+storeInfo.id;xmlHttp.onreadystatechange=SaveDefPricingComplete,xmlHttp.open("POST",n,!0),xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlHttp.setRequestHeader("Content-length",e.length),xmlHttp.setRequestHeader("Connection","close"),xmlHttp.send(e),setTimeout("def_price_save_handleTimeout();",2e4),dp_processing=!0},cancel:function(){}})}function RetrievePricing(){dp_processing||(xmlHttp=getXmlHttpObject(),null!=xmlHttp?dd_message({title:"Retrieve Default Pricing and Visibility",message:"Are you sure you want to retrieve the default Sides and Sweets pricing and visibility? This cannot be undone.",confirm:function(){document.getElementById("dp_proc_mess").style.display="inline",document.getElementById("dp_error").style.display="none",document.getElementById("dp_error").innerHTML="";var e="/processor?processor=admin_defaultPricingProcessor&action=retrieve&store_id="+storeInfo.id;xmlHttp.onreadystatechange=RetrieveDefPricingComplete,xmlHttp.open("GET",e,!0),xmlHttp.send(null),setTimeout("def_price_retreive_handleTimeout();",2e4),dp_processing=!0},cancel:function(){}}):bootbox.alert("The Default Pricing function is not compatible with your browser. Please contact your store for assistance."))}function calculatePage(){numberOfCustomerFacingCTSItems=0,numberOfCustomerFacingEFLItems=0;let e=[],t=!1,n=$("#markup_2_serving").val()?$("#markup_2_serving").val():null,i=$("#markup_3_serving").val()?$("#markup_3_serving").val():null,r=$("#markup_4_serving").val()?$("#markup_4_serving").val():null,a=$("#markup_6_serving").val()?$("#markup_6_serving").val():null,d=$("#markup_sides").val()?$("#markup_sides").val():null,o=$("#assembly_fee").val()?$("#assembly_fee").val():null,s=$("#delivery_assembly_fee").val()?$("#delivery_assembly_fee").val():null,m=document.getElementById("is_default_markupno").checked?0:1;0!=$("#delivery_assembly_fee").length&&formatAsMoney(markupData.delivery_assembly_fee)!=formatAsMoney(s)&&(t=!0),0!=$("#assembly_fee").length&&formatAsMoney(markupData.assembly_fee)!=formatAsMoney(o)&&(t=!0),0!=$("#markup_2_serving").length&&formatAsMoney(markupData.markup_value_2_serving)!=formatAsMoney(n)&&(t=!0),0!=$("#markup_3_serving").length&&formatAsMoney(markupData.markup_value_3_serving)!=formatAsMoney(i)&&(t=!0),0!=$("#markup_4_serving").length&&formatAsMoney(markupData.markup_value_4_serving)!=formatAsMoney(r)&&(t=!0),0!=$("#markup_6_serving").length&&formatAsMoney(markupData.markup_value_6_serving)!=formatAsMoney(a)&&(t=!0),0!=$("#markup_sides").length&&formatAsMoney(markupData.markup_value_sides)!=formatAsMoney(d)&&(t=!0),"100"!=menuInfo.menu_id&&markupData.is_default!=m&&(t=!0);let l=document.getElementById("itemsTbl").rows;for(let e=0;e<l.length;e++){if(-1==l[e].id.indexOf("row_")&&"addonEditorRow"!=l[e].id)continue;let d=null;if("addonEditorRow"==l[e].id){if(d=l[e].getAttribute("item_id"),!d)continue}else d=l[e].id.substr(4);let o=Number(menuInfo.mid[d].base_price),s=Number(menuInfo.mid[d].price),m=0;1==storeInfo.supports_ltd_roundup&&(m=Number(formatAsMoney(menuInfo.mid[d].ltd_menu_item_value))),"1"==menuInfo.mid[d].is_chef_touched&&0;let u=Number(0),c=Number(0);document.getElementById("ovr_"+d)&&(u=Number(formatAsMoney(document.getElementById("ovr_"+d).value)),c=Number(formatAsMoney(document.getElementById("ovr_"+d).getAttribute("data-orgval")))),u>0&&m>0&&(u=Number(formatAsMoney(1*u+1*m)));let _=null;$("#row_"+d+" > .markup-price").html(),"HALF"==menuInfo.mid[d].pricing_type?0==i||null==i||""==i?(_=o,m>0&&(_=Number(1*_+1*m))):(_=formatAsMoney(o+Math.round(o*i+1e-9)/100),$("#row_"+d+" > .markup-price").html(_),m>0&&(_=Number(1*_+1*m))):"TWO"==menuInfo.mid[d].pricing_type?0==n||null==n||""==n?(_=o,m>0&&(_=Number(1*_+1*m))):(_=formatAsMoney(o+Math.round(o*n+1e-9)/100),$("#row_"+d+" > .markup-price").html(_),m>0&&(_=Number(1*_+1*m))):"FOUR"==menuInfo.mid[d].pricing_type?0==r||null==r||""==r?(_=o,m>0&&(_=Number(1*_+1*m))):(_=formatAsMoney(o+Math.round(o*r+1e-9)/100),$("#row_"+d+" > .markup-price").html(_),m>0&&(_=Number(1*_+1*m))):0==a||null==a||""==a?(_=o,m>0&&(_=Number(1*_+1*m))):(_=formatAsMoney(o+Math.round(o*a+1e-8)/100),$("#row_"+d+" > .markup-price").html(_),m>0&&(_=Number(1*_+1*m))),_=1*formatAsMoney(_);let p=u-s,f=!1;0!=_-s&&0!=p&&(f=!0),isEnabled_Markup&&f>0&&0==u?($("#row_"+d+" > .preview-price").text(formatAsMoney(_)),t=!0):u>0&&0!=p?($("#row_"+d+" > .preview-price").text(formatAsMoney(u)),t=!0):isEnabled_Markup&&u>0&&f?($("#row_"+d+" > .preview-price").text(formatAsMoney(_)),t=!0):$("#row_"+d+" > .preview-price").text("");let v=document.getElementById("vis_"+d);v&&(orgState=v.getAttribute("data-orgval"),(v.checked&&"CHECKED"!=orgState||!v.checked&&"CHECKED"==orgState)&&(t=!0))}let u=document.getElementById("EFLitemsTbl").rows;for(let d=0;d<u.length;d++){if(-1==u[d].id.indexOf("row_")&&"addonEditorRow"!=u[d].id)continue;let o=null;if("addonEditorRow"==u[d].id){if(o=u[d].getAttribute("item_id"),!o)continue}else o=u[d].id.substr(4);let s=Number(menuInfo.mid[o].base_price),m=Number(menuInfo.mid[o].price);if(!$("#vis_"+o).is(":checked")){let t=$("#vis_"+o).data("entree_id");e.includes(t)||(numberOfCustomerFacingEFLItems++,e.push(t))}if("1"==menuInfo.mid[o].is_chef_touched&&0,13944==o){}let l=Number(0),c=Number(0);document.getElementById("ovr_"+o)&&(l=Number(formatAsMoney(document.getElementById("ovr_"+o).value)),c=Number(formatAsMoney(document.getElementById("ovr_"+o).getAttribute("data-orgval"))));let _=null;$("#row_"+o+" > .markup-price").html(),"HALF"==menuInfo.mid[o].pricing_type?0==i||null==i||""==i?_=s:(_=formatAsMoney(s+Math.round(s*i+1e-8)/100),$("#row_"+o+" > .markup-price").html(_)):"TWO"==menuInfo.mid[o].pricing_type?0==n||null==n||""==n?_=s:(_=formatAsMoney(s+Math.round(s*n+1e-8)/100),$("#row_"+o+" > .markup-price").html(_)):"FOUR"==menuInfo.mid[o].pricing_type?0==r||null==r||""==r?_=s:(_=formatAsMoney(s+Math.round(s*r+1e-8)/100),$("#row_"+o+" > .markup-price").html(_)):0==a||null==a||""==a?_=s:(_=formatAsMoney(s+Math.round(s*a+1e-8)/100),$("#row_"+o+" > .markup-price").html(_));let p=!1;if(isEnabled_Markup&&$("#mkdn_"+o)[0]){let e=$("#mkdn_"+o),t=formatAsMoney(e.data("markdown_value")),n=e.data("org_val"),i=0;if(l>0)l-=formatAsMoney(l*(t/100)),i=l;else if(_>0){let e=Number(formatAsMoney(_*(t/100)));_=formatAsMoney(100*_/100),_=Math.round(100*(_-e.valueOf()))/100,i=_}n!=t&&(p=!0)}let f=l-m,v=_-m;Math.abs(f)<.005&&(f=0),Math.abs(v)<.005&&(v=0);let g=!1;0!=v&&0!=f&&(g=!0),l>0&&0!=f?($("#row_"+o+" > .preview-price").text(formatAsMoney(l)),t=!0):isEnabled_Markup&&g?($("#row_"+o+" > .preview-price").text(formatAsMoney(_)),t=!0):p?($("#row_"+o+" > .preview-price").text(formatAsMoney(markedDownPrice)),t=!0):$("#row_"+o+" > .preview-price").text("");let h=document.getElementById("vis_"+o);if(h){let e=h.getAttribute("data-orgval");(h.checked&&"CHECKED"!=e||!h.checked&&"CHECKED"==e)&&(t=!0)}let b=document.getElementById("pic_"+o);if(b){let e=b.getAttribute("data-orgval");(b.checked&&"CHECKED"!=e||!b.checked&&"CHECKED"==e)&&(t=!0)}}let c=document.getElementById("ctsItemsTbl").rows;for(let e=0;e<c.length;e++){if(-1==c[e].id.indexOf("row_"))continue;let n=null;n=c[e].id.substr(4);let i=Number(menuInfo.mid[n].base_price),r=Number(menuInfo.mid[n].price);"1"==menuInfo.mid[n].is_chef_touched&&0;let a=Number(0),o=Number(0);document.getElementById("ovr_"+n)&&(a=Number(formatAsMoney(document.getElementById("ovr_"+n).value)),o=Number(formatAsMoney(document.getElementById("ovr_"+n).getAttribute("data-orgval"))));let s=null;$("#vis_"+n).is(":checked")&&numberOfCustomerFacingCTSItems++,0==d||null==d||""==d?($("#row_"+n+" > .markup-price").html(),s=i):(s=formatAsMoney(i+Math.round(i*d+1e-8)/100),$("#row_"+n+" > .markup-price").html(s)),s=1*formatAsMoney(s);let m=a-r,l=!1;0!=s-r&&0!=m&&(l=!0),a>0&&0!=m?($("#row_"+n+" > .preview-price").text(formatAsMoney(a)),t=!0):isEnabled_Markup&&l?($("#row_"+n+" > .preview-price").text(formatAsMoney(s)),t=!0):$("#row_"+n+" > .preview-price").text("");let u=document.getElementById("vis_"+n);if(u){let e=u.getAttribute("data-orgval");(u.checked&&"CHECKED"!=e||!u.checked&&"CHECKED"==e)&&(t=!0)}let _=document.getElementById("hid_"+n);if(_){let e=_.getAttribute("data-orgval");(_.checked&&"CHECKED"!=e||!_.checked&&"CHECKED"==e)&&(t=!0)}let p=document.getElementById("form_"+n);if(p){let e=p.getAttribute("data-orgval");(p.checked&&"CHECKED"!=e||!p.checked&&"CHECKED"==e)&&(t=!0)}}0!=gNumOptionalsAdded&&(t=!0),t?$("#saved_message, #saved_message_2").showFlex():$("#saved_message, #saved_message_2").hideFlex()}function confirm_and_check_form(){let e=$("#menu_editor_form")[0];clearErrors();let t=_check_form(e),n=$("#markup_2_serving").val()?$("#markup_2_serving").val():null,i=$("#markup_3_serving").val()?$("#markup_3_serving").val():null,r=$("#markup_4_serving").val()?$("#markup_4_serving").val():null,a=$("#markup_6_serving").val()?$("#markup_6_serving").val():null,d=$("#markup_sides").val()?$("#markup_sides").val():null,o=!1,s="";if(t){(n<0||r<0||i<0||a<0||d<0)&&(s="Negative per cent markups are not currently permitted.<br />"),(n>70||r>70||i>70||a>70||d>70)&&(s+="Markups greater than 70% are not currently permitted.<br />"),(0!=$("#markup_2_serving").length&&null==n||0!=$("#markup_4_serving").length&&null==r||0!=$("#markup_3_serving").length&&null==i||0!=$("#markup_6_serving").length&&null==a||0!=$("#markup_sides").length&&null==d)&&(o=!0),($("#assembly_fee").val()?$("#assembly_fee").val():0)<0&&(s+="The Assembly Fee must be greater than or equal to 0.<br />"),($("#delivery_assembly_fee").val()?$("#delivery_assembly_fee").val():0)<0&&(s+="The Delivery Assembly Fee must be greater than or equal to 0.<br />");let e=document.getElementById("itemsTbl").rows,m=!1,l="";for(let t=0;t<e.length;t++){if(-1==e[t].id.indexOf("row_"))continue;let n=e[t].id.substr(4),i=Number(menuInfo.mid[n].base_price),r="";if(document.getElementById("ovr_"+n)&&(r=Number(document.getElementById("ovr_"+n).value)),r&&""!=r&&(noOverrideUnderBase&&r<i&&(m=!0,l+=menuInfo.mid[n].menu_item_name+"<br />"),r>999)){s+="The Override Price must be less than $999.00<br />";break}}let u=document.getElementById("EFLitemsTbl").rows;for(let e=0;e<u.length;e++){if(-1==u[e].id.indexOf("row_"))continue;let t=u[e].id.substr(4),n=Number(menuInfo.mid[t].base_price),i=$("#mkdn_"+t)[0],r=$("#upd_mkdn_"+t)[0];if(i){let e=$(i).data("markdown_id")+"|"+$(i).data("markdown_value");if(r)r.val(e);else{let n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("value",e);let r="upd_mkdn_"+t;n.setAttribute("id",r),n.setAttribute("name",r),i.appendChild(n)}}let a="";if(document.getElementById("ovr_"+t)&&(a=Number(document.getElementById("ovr_"+t).value)),a&&""!=a&&(noOverrideUnderBase&&a<n&&(m=!0,l+=menuInfo.mid[t].menu_item_name+"<br />"),a>999)){s+="The Override Price must be less than $999.00<br />";break}}let c=document.getElementById("ctsItemsTbl").rows;for(let e=0;e<c.length;e++){if(-1==c[e].id.indexOf("row_"))continue;let t=c[e].id.substr(4),n=Number(menuInfo.mid[t].base_price),i="";if(document.getElementById("ovr_"+t)&&(i=Number(document.getElementById("ovr_"+t).value)),i&&""!=i&&(noOverrideUnderBase&&i<n&&(m=!0,l+=menuInfo.mid[t].menu_item_name+"<br />"),i>999)){s+="The Override Price must be less than $999.00<br />";break}}m&&(s+="The Override Price must be greater than the base price for:<br />",s+=l),""!=s&&(t=!1,displayValidationErrorMsg(s))}if(t){let e="Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.";o&&(e+="<br /><br /><span class='text-red font-weight-bold'>One or more of the Percentage MarkUp values is empty or 0. Please review and correct if this was unintentional.</span><br />"),dd_message({title:"Attention",message:e,modal:!0,confirm:function(){return document.getElementById("action").value="finalize",$("#menu_editor_form").submit(),!1},cancel:function(){return!1}})}return!1}function getMarkUpPrice(e,t){let n=Number(t);t=Number(t);let i=$("#markup_2_serving").val()?$("#markup_2_serving").val():null,r=$("#markup_3_serving").val()?$("#markup_3_serving").val():null,a=$("#markup_4_serving").val()?$("#markup_4_serving").val():null,d=$("#markup_6_serving").val()?$("#markup_6_serving").val():null;return n="Sm (2)"==e?0==i||null==i||""==i?t.valueOf():formatAsMoney(t.valueOf()+Math.round(t.valueOf()*i)/100):"Md (4)"==e?0==a||null==a||""==a?t.valueOf():formatAsMoney(t.valueOf()+Math.round(t.valueOf()*a)/100):"Md (3)"==e?0==r||null==r||""==r?t.valueOf():formatAsMoney(t.valueOf()+Math.round(t.valueOf()*r)/100):0==d||null==d||""==d?t.valueOf():formatAsMoney(t.valueOf()+Math.round(t.valueOf()*d)/100),n}function addUnsavedEFLItem(e,t,n,i,r,a){let d=0;if(0!=e){var o=document.getElementById("EFLitemsTbl").insertRow(-1);o.setAttribute("id","row_"+e);var s=o.insertCell(0),m=document.createElement("input");m.setAttribute("type","checkbox");var l="vis_"+e;m.setAttribute("id",l),m.setAttribute("name",l),m.setAttribute("class","align-middle"),m.setAttribute("data-orgval","CHECKED"),m.setAttribute("data-menu_item_id",e),m.setAttribute("checked","checked"),s.appendChild(m);var u=o.insertCell(++d),c=document.createElement("input");c.setAttribute("type","checkbox");l="pic_"+e;c.setAttribute("id",l),c.setAttribute("name",l),c.setAttribute("class","align-middle"),c.setAttribute("data-orgval",""),c.setAttribute("step","any"),u.appendChild(c);var _=o.insertCell(++d);_.setAttribute("class","align-middle text-left");var p=document.createTextNode(t);_.appendChild(p);var f=o.insertCell(++d);f.setAttribute("class","align-middle");var v=document.createTextNode(n);if(f.appendChild(v),isEnabled_Markup){var g=o.insertCell(++d);g.setAttribute("class","align-middle");v=document.createTextNode(formatAsMoney(i));g.appendChild(v);var h=getMarkUpPrice(n,i)}var b=o.insertCell(++d);if(b.setAttribute("class","align-middle"),isEnabled_Markup)v=document.createTextNode(h);else v=document.createTextNode(formatAsMoney(i));if(b.appendChild(v),isEnabled_Markup){var y=o.insertCell(++d);y.setAttribute("class","align-middle markup-price");v=document.createTextNode(h);y.appendChild(v)}var k=o.insertCell(++d);(v=document.createElement("input")).setAttribute("type","number"),v.setAttribute("size","3"),v.setAttribute("step","any"),v.setAttribute("class","form-control form-control-sm no-spin-button"),v.setAttribute("maxlength","6"),v.setAttribute("data-orgval","");l="ovr_"+e;v.setAttribute("id",l),v.setAttribute("name",l),isEnabled_Markup||v.setAttribute("value",formatAsMoney(i)),k.appendChild(v);var $=o.insertCell(++d);l="add-mkdn_"+e;(v=document.createElement("button")).setAttribute("id",l),v.setAttribute("class","button");var w=document.createTextNode("Add");v.appendChild(w),$.appendChild(v),o.insertCell(++d).setAttribute("class","align-middle preview-price")}}function addUnsavedSideItem(e,t,n,i,r){let a=0;if(0!=e){var d=document.getElementById("ctsItemsTbl");if(0==$("#temp_category").length){var o;(o=d.insertRow(-1)).setAttribute("id","temp_category"),(f=o.insertCell(0)).setAttribute("class","font-weight-bold py-3"),f.setAttribute("colspan","11");var s=document.createTextNode("Newly Added Items");f.appendChild(s)}(o=d.insertRow(-1)).setAttribute("id","row_"+e);var m=o.insertCell(a++),l=document.createElement("input");l.setAttribute("type","checkbox");var u="vis_"+e;l.setAttribute("id",u),l.setAttribute("name",u),l.setAttribute("class","align-middle"),l.setAttribute("data-orgval","CHECKED"),l.setAttribute("data-menu_item_id",e),l.setAttribute("checked","checked"),m.appendChild(l);var c=o.insertCell(a++);(_=document.createElement("input")).setAttribute("type","checkbox");u="form_"+e;_.setAttribute("id",u),_.setAttribute("name",u),_.setAttribute("class","align-middle"),_.setAttribute("data-orgval",""),_.setAttribute("step","any"),c.appendChild(_);var _,p=o.insertCell(a++);(_=document.createElement("input")).setAttribute("type","checkbox");var f;u="hid_"+e;_.setAttribute("id",u),_.setAttribute("name",u),_.setAttribute("class","align-middle"),_.setAttribute("data-orgval",""),_.setAttribute("step","any"),p.appendChild(_),(f=o.insertCell(a++)).setAttribute("class","align-middle text-left");s=document.createTextNode(t);f.appendChild(s);var v=o.insertCell(a++);v.setAttribute("class","align-middle");var g=document.createTextNode(n);v.appendChild(g);var h=o.insertCell(a++);h.setAttribute("class","align-middle");g=document.createTextNode(formatAsMoney(i));h.appendChild(g);var b=getMarkUpPrice(n,i),y=o.insertCell(a++);y.setAttribute("class","align-middle");g=document.createTextNode(b);y.appendChild(g);var k=o.insertCell(a++);k.setAttribute("class","align-middle markup-price");g=document.createTextNode(b);k.appendChild(g);var w=o.insertCell(a++);(g=document.createElement("input")).setAttribute("type","number"),g.setAttribute("size","3"),g.setAttribute("step","any"),g.setAttribute("class","form-control form-control-sm no-spin-button"),g.setAttribute("maxlength","6"),g.setAttribute("data-orgval","");u="ovr_"+e;g.setAttribute("id",u),g.setAttribute("name",u),w.appendChild(g);var A=o.insertCell(a++);A.setAttribute("class","align-middle preview-price");g=document.createTextNode("");A.appendChild(g);var E=o.insertCell(a++);E.setAttribute("class","align-middle remaining-price");g=document.createTextNode("0");E.appendChild(g)}}function giveTabFocus(){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).tabs;void 0!==e&&null!=e&&(e=e.substring(e.indexOf("menu.")+5),$(document).find("[data-nav='"+e+"']").click())}function initNavTab(){var e=$("#inv-nav-button").attr("href"),t=e.substring(0,e.indexOf("&tabs"));const n=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});void 0!==n.tabs&&null!=n.tabs&&(t=t+"&tabs="+n.tabs,$("#inv-nav-button").attr("href",t)),$(".nav-tab").each((function(){$(this).on("click",(function(){var e=$("#inv-nav-button").attr("href"),t=e.substring(0,e.indexOf("&tabs"));t=t+"&tabs=menu."+$(this).data("nav"),$("#inv-nav-button").attr("href",t)}))}))}$((function(){$(document).ready((function(){calculatePage(),giveTabFocus(),initNavTab()})),$(document).on("change keyup",'#markup_6_serving, #markup_4_serving, #markup_3_serving, #markup_2_serving, #markup_sides, #assembly_fee, #delivery_assembly_fee, #volume_reward, [name="is_default_markup"], [id^=pic_], [id^=form_], [id^=ovr_], [id^=vis_], [id^=hid_]',(function(e){calculatePage()})),$(document).on("change keyup","[id^=vis_]",(function(e){let t=$(this).data("menu_item_id"),n=$(this).is(":checked");"1"==menuInfo.mid[t].is_chef_touched?n&&numberOfCustomerFacingCTSItems>20?($(this).prop({checked:!1}),bootbox.alert("You can only display 20 Sides &amp; Sweets items on the customer facing menu.")):$("#hid_"+t).prop({checked:!1}):"1"==menuInfo.mid[t].is_store_special&&!n&&numberOfCustomerFacingEFLItems>10&&($(this).prop({checked:!0}),bootbox.alert("You can only make 10 Fast Lane items visible at a time. Please hide another store special if you wish to make this item visible."))})),$(document).on("change keyup","[id^=form_]",(function(e){let t=$(this).data("menu_item_id");$("#hid_"+t).prop({checked:!1})})),$(document).on("change keyup","[id^=hid_]",(function(e){let t=$(this).data("menu_item_id");$("#vis_"+t).prop({checked:!1}),$("#form_"+t).prop({checked:!1})})),$(document).on("keyup change","#filter",(function(e){$.uiTableFilter($("#recipe_list"),this.value)})),$(document).on("click","#clear_filter",(function(e){$("#filter").val("").change(),Modernizr.input.placeholder||$("#filter").focus().blur()})),$(document).on("click","[id^=mkdn_]",(function(e){tempArr=this.id.split("_");let t=tempArr[1],n=$(this).data("markdown_value");$(this).data("markdown_id");return dd_message({title:"Edit Markdown",div_id:"edit_mkdn",message:$("#markdown_editor").html(),height:350,width:400,resizable:!0,noOk:!0,open:function(){$("#edit_mkdn").find("#markdown_amount").val(n);let e=getPreviewItemPrice(t),i=e;i-=i*(n/100),$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(i)),$("#edit_mkdn").find("#markdown_amount").on("keyup",(function(t){i=e,newDiscount=$(this).val(),newDiscount<0&&(newDiscount=0,$(this).val(newDiscount)),newDiscount>20&&(newDiscount=20,$(this).val(newDiscount)),i-=i*(newDiscount/100),$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(i))})),$("#edit_mkdn").find("#markdown_price").on("keyup",(function(t){let n=$(this).val(),i=(e-n)/e*100;$("#edit_mkdn").find("#markdown_amount").val(formatAsMoney(i))})),$("#edit_mkdn").find("#current_price").html("$"+formatAsMoney(menuInfo.mid[t].price)),$("#edit_mkdn").find("#base_price").html("$"+formatAsMoney(menuInfo.mid[t].base_price)),$("#edit_mkdn").find("#item_title").html(menuInfo.mid[t].menu_item_name)},buttons:{Accept:function(){let e=getPreviewItemPrice(t),n=$("#edit_mkdn").find("#markdown_amount").val();return n>20?(n=20,price=e*(n/100),$("#edit_mkdn").find("#markdown_amount").val(formatAsMoney(n)),$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(e-price)),void dd_message({title:"Error",message:"The percentage of discount is limited to 20%. The amounts have been adjusted. Please review and re-submit."})):n<0?(n=0,$("#edit_mkdn").find("#markdown_amount").val(formatAsMoney(n)),$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(e)),void dd_message({title:"Error",message:"The percentage of discount cannot be negative. The amounts have been adjusted. Please review and re-submit."})):($("#mkdn_"+t).html(formatAsMoney(n)+"%"),$("#mkdn_"+t).data("markdown_value",n),calculatePage(),void $(this).remove())},Cancel:function(){$(this).remove()}}}),!1})),$(document).on("click","[id^=add-mkdn_]",(function(e){tempArr=this.id.split("_");let t=tempArr[1],n=$(this).data("markdown_value");$(this).data("markdown_id");return dd_message({title:"Add Markdown",div_id:"new_mkdn",message:$("#markdown_editor").html(),height:350,width:400,resizable:!0,noOk:!0,open:function(){$("#new_mkdn").find("#markdown_amount").val(n);let e=getPreviewItemPrice(t);$("#new_mkdn").find("#markdown_price").val(formatAsMoney(e)),$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(0)),$("#new_mkdn").find("#markdown_amount").on("keyup",(function(t){price=e,newDiscount=$(this).val(),newDiscount<0&&(newDiscount=0,$(this).val(newDiscount)),newDiscount>20&&(newDiscount=20,$(this).val(newDiscount)),price-=price*(newDiscount/100),$("#new_mkdn").find("#markdown_price").val(formatAsMoney(price))})),$("#new_mkdn").find("#markdown_price").on("keyup",(function(t){let n=$(this).val(),i=(e-n)/e*100;$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(i))})),$("#new_mkdn").find("#current_price").html("$"+formatAsMoney(menuInfo.mid[t].price)),$("#new_mkdn").find("#base_price").html("$"+formatAsMoney(menuInfo.mid[t].base_price)),$("#new_mkdn").find("#item_title").html(menuInfo.mid[t].menu_item_name)},buttons:{Accept:function(){let e=getPreviewItemPrice(t),n=$("#new_mkdn").find("#markdown_amount").val();if(n>20)return n=20,price=e*(n/100),$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(n)),$("#new_mkdn").find("#markdown_price").val(formatAsMoney(e-price)),void dd_message({title:"Error",message:"The percentage of discount is limited to 20%. The amounts have been adjusted. Please review and re-submit."});if(n<0)return n=0,$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(n)),$("#new_mkdn").find("#markdown_price").val(formatAsMoney(e)),void dd_message({title:"Error",message:"The percentage of discount cannot be negative. The amounts have been adjusted. Please review and re-submit."});let i='<button class="btn btn-primary btn-sm" id="mkdn_'+t+'" data-org_val="0" data-markdown_id="new" data-markdown_value="'+newDiscount+'" >'+formatAsMoney(newDiscount)+"%</button>";$("#add-mkdn_"+t).replaceWith(i),calculatePage(),$(this).remove()},Cancel:function(){$(this).remove()}}}),!1})),$(document).on("click","#add_past_menu_item:not(.disabled)",(function(e){displayModalWaitDialog("wait_for_adding_item_div","Retrieving items. Please wait ..."),showPopup({modal:!0,title:"Add EFL Item",noOk:!0,closeOnEscape:!1,height:720,div_id:"add_menu_item_popup_div",module:"page=admin_menu_editor_add_item&menu_id="+menuInfo.menu_id,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide(),$("#wait_for_adding_item_div").remove()},buttons:{Cancel:function(){$(this).remove()},Okay:function(){let e={};$("#sel_list").find("[data-rmv_menu_item]").each((function(){let t=$(this).data("entree_id");e[t]=t})),dd_message({title:"",message:"This will immediately add the listed items to the menu. Are you sure?",noOk:!0,height:180,buttons:{"Add Items to Menu":function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"add_menu_item",menu_id:menuInfo.menu_id,entree_ids:e},success:function(e){if(e.processor_success)for(let t in e.results){let n=e.results[t].count,i=e.results[t].items,r=1;for(let t in i)menuInfo=e.menuInfo,addUnsavedEFLItem(i[t].item_id,i[t].name,i[t].size,i[t].base_price,r,n),r++;calculatePage(),r>1&&$("#empty_menu_message").remove()}else dd_message({title:"Error",message:e.processor_message})},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Error",message:response})}}),$(this).remove(),$("#add_menu_item_popup_div").remove()},Cancel:function(){$(this).remove()}}})}},close:function(){bounce("/backoffice/menu_editor?tabs=menu.efl")}})})),$(document).on("click","[data-add_menu_item]",(function(e){if($(this).hasClass("disabled"));else{$(this).addClass("disabled");let e=$(this).data("entree_id"),t=$(this).data("recipe_id"),n=$('[data-recipe_id_row="'+t+'"]').clone();n.find("[data-rmv_menu_item="+e+"]").show(),n.find("[data-add_menu_item="+e+"]").remove(),$("#selected_items tbody").append(n)}})),$(document).on("click","[data-rmv_menu_item]",(function(e){let t=$(this).data("entree_id"),n=$(this).data("recipe_id");$('#selected_items tbody [data-recipe_id_row="'+n+'"]').remove(),$('#recipe_list tbody [data-recipe_id_row="'+n+'"]').find('[data-add_menu_item="'+t+'"]').removeClass("disabled")})),$(document).on("click","[data-info_menu_item]",(function(e){let t=$(this).data("entree_id"),n=$(this).data("recipe_id");$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"menu_item_info",menu_id:menuInfo.menu_id,entree_id:t,recipe_id:n},success:function(e){dd_message({modal:!0,title:"Item Information",height:720,width:720,message:e.data,open:function(){handle_tabbed_content()}})},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})})),$(document).on("click","#add_past_menu_item_sides",(function(e){displayModalWaitDialog("wait_for_adding_item_div","Retrieving Sides & Sweets. Please wait ..."),showPopup({modal:!0,title:"Add Sides & Sweets",noOk:!0,closeOnEscape:!1,height:720,div_id:"add_menu_item_popup_div",module:"page=admin_menu_editor_add_sides_sweets&menu_id="+menuInfo.menu_id,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide(),$("#wait_for_adding_item_div").remove()},buttons:{Cancel:function(){$(this).remove()},Okay:function(){let e={},t=!1;$("#sel_list").find("[data-rmv_menu_side]").each((function(){let n=$(this).data("entree_id");e[n]=n;let i=$("[data-recipe_category="+n+"]:visible").find(":selected").val();void 0===i&&(i=$("[data-recipe_category="+n+"]:visible").html()),void 0===i?($("[data-recipe_category="+n+"]").css("border-color","red"),t=!0):e[n]=i})),t?(console.log("Missing"),dd_message({title:"Please select a category for all items",message:"Please select a category for all items"})):dd_message({title:"",message:"This will immediately add the listed Sides & Sweets to the menu. Are you sure?",noOk:!0,height:180,buttons:{"Add Sides & Sweets to Menu":function(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"add_menu_side",menu_id:menuInfo.menu_id,entree_ids:e},success:function(e){if(e.processor_success){let t=0;for(let t in e.results){e.results[t].count;let n=e.results[t].items,i=1;for(let t in n)menuInfo=e.menuInfo,addUnsavedSideItem(n[t].item_id,n[t].name,n[t].size,n[t].base_price,n[t].subcategory_label),i++}calculatePage(),t>1&&$("#empty_menu_message").remove(),$([document.documentElement,document.body]).animate({scrollTop:$("#temp_category").offset().top},2e3)}else dd_message({title:"Error adding Sides & Sweets",message:e.processor_message})},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Network Error adding Sides and Sweets",message:response})}}),$(this).remove(),$("#add_menu_item_popup_div").remove()},Cancel:function(){$(this).remove()}}})}},close:function(){bounce("/backoffice/menu_editor?tabs=menu.efl")}})})),$(document).on("change","[data-recipe_category]",(function(e){void 0===$(this).find(":selected").val()?$(this).css("border-color","red"):$(this).css("border-color","black")})),$(document).on("click","[data-add_menu_side]",(function(e){if($(this).hasClass("disabled"));else{$(this).addClass("disabled");let e=$(this).data("entree_id"),t=$(this).data("recipe_id"),n=$('[data-recipe_id_row="'+t+'"]').clone();n.find("[data-rmv_menu_side="+e+"]").show(),n.find("[data-add_menu_side="+e+"]").remove(),n.find("[data-recipe_category="+e+"]").show();let i=n.find("[data-old_category="+e+"]").html();n.find("[data-old_category="+e+"]").remove(),$("#selected_items tbody").append(n),$("[data-recipe_category="+e+"]").val(i)}})),$(document).on("click","[data-rmv_menu_side]",(function(e){let t=$(this).data("entree_id"),n=$(this).data("recipe_id");$('#selected_items tbody [data-recipe_id_row="'+n+'"]').remove(),$('#recipe_list tbody [data-recipe_id_row="'+n+'"]').find('[data-add_menu_side="'+t+'"]').removeClass("disabled")})),$(document).on("click","[data-info_menu_side]",(function(e){let t=$(this).data("entree_id"),n=$(this).data("recipe_id");$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"menu_item_info",menu_id:menuInfo.menu_id,entree_id:t,recipe_id:n},success:function(e){dd_message({modal:!0,title:"Item Information",height:720,width:720,message:e.data,open:function(){handle_tabbed_content()}})},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}))}));
//# sourceMappingURL=menu_editor.min.js.map
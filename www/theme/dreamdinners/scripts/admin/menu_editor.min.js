let numberOfCustomerFacingCTSItems=0;let numberOfCustomerFacingEFLItems=0;let sidesDataArray=[];let gNumOptionalsAdded=0;let notShown=true;let dp_processing=false;let xmlHttp=null;let noOverrideUnderBase=true;function resetPage(){document.getElementById("action").value="menuChange";document.getElementById("menu_editor_form").submit()}function getPreviewItemPrice(e){let t=Number($("#ovr_"+e).val());if(isNaN(t)||t.valueOf()==0){return Number($("#row_"+e+" > .preview-price").text())}return t}function removeOptionSelected(){let t=document.getElementById("sides");for(let e=t.length-1;e>=1;e--){if(t.options[e].selected){t.remove(e)}}}function removeItem(e){gNumOptionalsAdded--;let t="row_"+e;let n=document.getElementById(t);n.parentNode.removeChild(n);let i=sidesDataArray[e];let r="("+i["SUPC_number"]+") "+i["name"];let a=document.getElementById("sides");a.options[a.length]=new Option(r,e);calculatePage()}function displayValidationErrorMsg(e){e="<span style='color:red; font-size:larger;'>"+e+"</span>";dd_message({title:"Error",message:e})}function clearErrors(){let e=document.getElementById("errorMsg");e.style.display="none";let t=document.getElementById("errorMsgText");t.innerHTML=""}function storeChange(e){document.getElementById("action").value="storeChange";document.getElementById("menu_editor_form").submit()}function menuChange(e){document.getElementById("action").value="menuChange";document.getElementById("menu_editor_form").submit()}function confirm_and_round_form(e){const t="Are you sure want to update all Override Prices with rounded Markup Prices? "+"This action will replace existing override prices with the newly calculated price.";let n=false;$("."+e+"-override-price-input").each(function(){n=$(this).val().trim()!==""});if(n){dd_message({title:"Attention",message:t,modal:true,confirm:function(){round_markup_to_override(e);return false},cancel:function(){return false}})}else{round_markup_to_override(e)}return false}function round_markup_to_override(t){let i=false;$(".markup-price").each(function(e){if($(this).is("[readonly]")){}else{let n=$(this).parent().find("."+t+"-override-price-input");if(n.length){let e=parseFloat($(this).text());let t=Math.ceil(e*2)/2;n.val(t.toFixed(2));i=true}}});if(i){calculatePage();$("#saved_message, #saved_message_2").showFlex()}}function selectedDefault(){if(notShown){bootbox.alert("Any Menus that do not currently have their own specific settings finalized will inherit these default settings.");notShown=false}calculatePage()}function getXmlHttpObject(){let t=null;try{t=new XMLHttpRequest}catch(e){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return t}function def_price_save_handleTimeout(){if(dp_processing){dp_processing=false;let e="The server has not responded. Please try again.";document.getElementById("dp_error").style.display="block";document.getElementById("dp_error").innerHTML=e;document.getElementById("dp_proc_mess").style.display="none"}}function def_price_retreive_handleTimeout(){if(dp_processing){dp_processing=false;let e="The server has not responded. Please try again.";document.getElementById("dp_error").style.display="block";document.getElementById("dp_error").innerHTML=e;document.getElementById("dp_proc_mess").style.display="none"}}function SaveDefPricingComplete(){if((xmlHttp.readyState==4||xmlHttp.readyState=="complete")&&dp_processing){dp_processing=false;document.getElementById("dp_proc_mess").style.display="none";let e="Sides &amp; Sweets default pricing has been saved";document.getElementById("dp_error").style.display="block";document.getElementById("dp_error").innerHTML=e}}function RetrieveDefPricingComplete(){if((xmlHttp.readyState==4||xmlHttp.readyState=="complete")&&dp_processing){dp_processing=false;if(xmlHttp.responseText&&xmlHttp.responseText!="error"&&xmlHttp.responseText!=""){let t=xmlHttp.responseText.split("|");let o=[];for(let e in t){var i=t[e].split("~");if(i[0]){o[i[0]]=[i[1],i[2],i[3]]}}calculatePage();let s=numberOfCustomerFacingCTSItems;let n=document.getElementById("ctsItemsTbl").rows;for(let e=0;e<n.length;e++){if(n[e].id.indexOf("row_")==-1){continue}let a=null;a=n[e].id.substr(4);let d=document.getElementById("rec_id_"+a).innerHTML;if(o[d]){let e="ovr_"+a;let t=document.getElementById(e);if(t){t.value=o[d][2]}let n=document.getElementById("vis_"+a);let i=n.checked;if(n){if(o[d][0]=="1"){if(!i&&s<20){n.checked=true;s++}}else{if(i){n.checked=false;s--}}}let r=document.getElementById("hid_"+a);if(r){if(o[d][1]=="1"){r.checked=true}else{r.checked=false}}}}calculatePage();document.getElementById("dp_proc_mess").style.display="none";document.getElementById("dp_error").style.display="none"}else{document.getElementById("dp_proc_mess").style.display="none";let e="There was an error when retrieving the default prices. Please try again.";document.getElementById("dp_error").style.display="block";document.getElementById("dp_error").innerHTML=e}}}function SavePricing(){dd_message({title:"Save Default Pricing and Visibility",message:"Are you sure you want to save the default Sides and Sweets pricing and visibility? This cannot be undone.",confirm:function(){let s="data=";let l=document.getElementById("ctsItemsTbl").rows;for(let o=0;o<l.length;o++){if(l[o].id.indexOf("row_")==-1){continue}let e=null;e=l[o].id.substr(4);let t=document.getElementById("rec_id_"+e).innerHTML;let n=Number(menuInfo.mid[e].price);let i=Number($("#row_"+e+" > .preview-price").text());let r=Number(menuInfo.mid[e].base_price);if(i!=""&&i!=0&&!isNaN(i)){n=i}if(n<r){document.getElementById("dp_proc_mess").style.display="none";document.getElementById("dp_error").style.display="block";document.getElementById("dp_error").innerHTML="Override price must be greater than the price.";return}let a="0";if(document.getElementById("vis_"+e)&&document.getElementById("vis_"+e).checked){a="1"}let d="0";if(document.getElementById("hid_"+e)&&document.getElementById("hid_"+e).checked){d="1"}s+=t+"~"+a+"~"+d+"~"+n+"|"}xmlHttp=getXmlHttpObject();if(xmlHttp==null){bootbox.alert("The Default Pricing function is not compatible with your browser. Please contact your store for assistance.");return}document.getElementById("dp_proc_mess").style.display="inline";document.getElementById("dp_error").style.display="none";document.getElementById("dp_error").innerHTML="";let e="ddproc.php?processor=admin_defaultPricingProcessor&action=save&store_id="+storeInfo.id;xmlHttp.onreadystatechange=SaveDefPricingComplete;xmlHttp.open("POST",e,true);xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlHttp.setRequestHeader("Content-length",s.length);xmlHttp.setRequestHeader("Connection","close");xmlHttp.send(s);setTimeout("def_price_save_handleTimeout();",2e4);dp_processing=true},cancel:function(){}})}function RetrievePricing(){if(dp_processing){return}xmlHttp=getXmlHttpObject();if(xmlHttp==null){bootbox.alert("The Default Pricing function is not compatible with your browser. Please contact your store for assistance.");return}dd_message({title:"Retrieve Default Pricing and Visibility",message:"Are you sure you want to retrieve the default Sides and Sweets pricing and visibility? This cannot be undone.",confirm:function(){document.getElementById("dp_proc_mess").style.display="inline";document.getElementById("dp_error").style.display="none";document.getElementById("dp_error").innerHTML="";var e="ddproc.php?processor=admin_defaultPricingProcessor&action=retrieve&store_id="+storeInfo.id;xmlHttp.onreadystatechange=RetrieveDefPricingComplete;xmlHttp.open("GET",e,true);xmlHttp.send(null);setTimeout("def_price_retreive_handleTimeout();",2e4);dp_processing=true},cancel:function(){}})}function calculatePage(){numberOfCustomerFacingCTSItems=0;numberOfCustomerFacingEFLItems=0;let _=[];let f=false;let p=0;let v=!$("#markup_2_serving").val()?null:$("#markup_2_serving").val();let g=!$("#markup_3_serving").val()?null:$("#markup_3_serving").val();let h=!$("#markup_4_serving").val()?null:$("#markup_4_serving").val();let b=!$("#markup_6_serving").val()?null:$("#markup_6_serving").val();let y=!$("#markup_sides").val()?null:$("#markup_sides").val();let e=!$("#assembly_fee").val()?null:$("#assembly_fee").val();let t=!$("#delivery_assembly_fee").val()?null:$("#delivery_assembly_fee").val();let n=document.getElementById("is_default_markupno").checked?0:1;if($("#delivery_assembly_fee").length!=0){if(formatAsMoney(markupData.delivery_assembly_fee)!=formatAsMoney(t)){f=true}}if($("#assembly_fee").length!=0){if(formatAsMoney(markupData.assembly_fee)!=formatAsMoney(e)){f=true}}if($("#markup_2_serving").length!=0){if(formatAsMoney(markupData.markup_value_2_serving)!=formatAsMoney(v)){f=true}}if($("#markup_3_serving").length!=0){if(formatAsMoney(markupData.markup_value_3_serving)!=formatAsMoney(g)){f=true}}if($("#markup_4_serving").length!=0){if(formatAsMoney(markupData.markup_value_4_serving)!=formatAsMoney(h)){f=true}}if($("#markup_6_serving").length!=0){if(formatAsMoney(markupData.markup_value_6_serving)!=formatAsMoney(b)){f=true}}if($("#markup_sides").length!=0){if(formatAsMoney(markupData.markup_value_sides)!=formatAsMoney(y)){f=true}}if(menuInfo.menu_id!="100"){if(markupData.is_default!=n){f=true}}let c=document.getElementById("itemsTbl").rows;for(let u=0;u<c.length;u++){if(c[u].id.indexOf("row_")==-1&&c[u].id!="addonEditorRow"){continue}let e=null;if(c[u].id=="addonEditorRow"){e=c[u].getAttribute("item_id");if(!e){continue}}else{e=c[u].id.substr(4)}let t=Number(menuInfo.mid[e].base_price);let n=Number(menuInfo.mid[e].price);let i=0;if(storeInfo.supports_ltd_roundup==1){i=Number(formatAsMoney(menuInfo.mid[e].ltd_menu_item_value))}if(menuInfo.mid[e].is_chef_touched=="1"){p++}let r=Number(0);let a=Number(0);if(document.getElementById("ovr_"+e)){r=Number(formatAsMoney(document.getElementById("ovr_"+e).value));a=Number(formatAsMoney(document.getElementById("ovr_"+e).getAttribute("data-orgval")))}if(r>0&&i>0){r=Number(formatAsMoney(r*1+i*1))}let d=null;$("#row_"+e+" > .markup-price").html();if(menuInfo.mid[e].pricing_type=="HALF"){if(g==0||g==null||g==""){d=t;if(i>0){d=Number(d*1+i*1)}}else{d=formatAsMoney(t+Math.round(t*g+1e-9)/100);$("#row_"+e+" > .markup-price").html(d);if(i>0){d=Number(d*1+i*1)}}}else if(menuInfo.mid[e].pricing_type=="TWO"){if(v==0||v==null||v==""){d=t;if(i>0){d=Number(d*1+i*1)}}else{d=formatAsMoney(t+Math.round(t*v+1e-9)/100);$("#row_"+e+" > .markup-price").html(d);if(i>0){d=Number(d*1+i*1)}}}else if(menuInfo.mid[e].pricing_type=="FOUR"){if(h==0||h==null||h==""){d=t;if(i>0){d=Number(d*1+i*1)}}else{d=formatAsMoney(t+Math.round(t*h+1e-9)/100);$("#row_"+e+" > .markup-price").html(d);if(i>0){d=Number(d*1+i*1)}}}else{if(b==0||b==null||b==""){d=t;if(i>0){d=Number(d*1+i*1)}}else{d=formatAsMoney(t+Math.round(t*b+1e-8)/100);$("#row_"+e+" > .markup-price").html(d);if(i>0){d=Number(d*1+i*1)}}}d=formatAsMoney(d)*1;let o=r-n;let s=d-n;let l=false;if(s!=0&&o!=0){l=true}if(isEnabled_Markup&&l>0&&r==0){$("#row_"+e+" > .preview-price").text(formatAsMoney(d));f=true}else if(r>0&&o!=0){$("#row_"+e+" > .preview-price").text(formatAsMoney(r));f=true}else if(isEnabled_Markup&&r>0&&l){$("#row_"+e+" > .preview-price").text(formatAsMoney(d));f=true}else{$("#row_"+e+" > .preview-price").text("")}let m=document.getElementById("vis_"+e);if(m){orgState=m.getAttribute("data-orgval");if(m.checked&&orgState!="CHECKED"||!m.checked&&orgState=="CHECKED"){f=true}}}let k=document.getElementById("EFLitemsTbl").rows;for(let c=0;c<k.length;c++){if(k[c].id.indexOf("row_")==-1&&k[c].id!="addonEditorRow"){continue}let r=null;if(k[c].id=="addonEditorRow"){r=k[c].getAttribute("item_id");if(!r){continue}}else{r=k[c].id.substr(4)}let e=Number(menuInfo.mid[r].base_price);let t=Number(menuInfo.mid[r].price);if(!$("#vis_"+r).is(":checked")){let e=$("#vis_"+r).data("entree_id");if(!_.includes(e)){numberOfCustomerFacingEFLItems++;_.push(e)}}if(menuInfo.mid[r].is_chef_touched=="1"){p++}if(r==13944){let e=1}let a=Number(0);let n=Number(0);if(document.getElementById("ovr_"+r)){a=Number(formatAsMoney(document.getElementById("ovr_"+r).value));n=Number(formatAsMoney(document.getElementById("ovr_"+r).getAttribute("data-orgval")))}let d=null;$("#row_"+r+" > .markup-price").html();if(menuInfo.mid[r].pricing_type=="HALF"){if(g==0||g==null||g==""){d=e}else{d=formatAsMoney(e+Math.round(e*g+1e-8)/100);$("#row_"+r+" > .markup-price").html(d)}}else if(menuInfo.mid[r].pricing_type=="TWO"){if(v==0||v==null||v==""){d=e}else{d=formatAsMoney(e+Math.round(e*v+1e-8)/100);$("#row_"+r+" > .markup-price").html(d)}}else if(menuInfo.mid[r].pricing_type=="FOUR"){if(h==0||h==null||h==""){d=e}else{d=formatAsMoney(e+Math.round(e*h+1e-8)/100);$("#row_"+r+" > .markup-price").html(d)}}else{if(b==0||b==null||b==""){d=e}else{d=formatAsMoney(e+Math.round(e*b+1e-8)/100);$("#row_"+r+" > .markup-price").html(d)}}let o=false;if(isEnabled_Markup&&$("#mkdn_"+r)[0]){let e=$("#mkdn_"+r);let t=formatAsMoney(e.data("markdown_value"));let n=e.data("org_val");let i=0;if(a>0){a-=formatAsMoney(a*(t/100));i=a}else if(d>0){let e=Number(formatAsMoney(d*(t/100)));d=formatAsMoney(d*100/100);d=Math.round((d-e.valueOf())*100)/100;i=d}if(n!=t){o=true}}let i=a-t;let s=d-t;if(Math.abs(i)<.005){i=0}if(Math.abs(s)<.005){s=0}let l=false;if(s!=0&&i!=0){l=true}if(a>0&&i!=0){$("#row_"+r+" > .preview-price").text(formatAsMoney(a));f=true}else if(isEnabled_Markup&&l){$("#row_"+r+" > .preview-price").text(formatAsMoney(d));f=true}else if(o){$("#row_"+r+" > .preview-price").text(formatAsMoney(markedDownPrice));f=true}else{$("#row_"+r+" > .preview-price").text("")}let m=document.getElementById("vis_"+r);if(m){let e=m.getAttribute("data-orgval");if(m.checked&&e!="CHECKED"||!m.checked&&e=="CHECKED"){f=true}}let u=document.getElementById("pic_"+r);if(u){let e=u.getAttribute("data-orgval");if(u.checked&&e!="CHECKED"||!u.checked&&e=="CHECKED"){f=true}}}let w=document.getElementById("ctsItemsTbl").rows;for(let c=0;c<w.length;c++){if(w[c].id.indexOf("row_")==-1){continue}let e=null;e=w[c].id.substr(4);let t=Number(menuInfo.mid[e].base_price);let n=Number(menuInfo.mid[e].price);if(menuInfo.mid[e].is_chef_touched=="1"){p++}let i=Number(0);let r=Number(0);if(document.getElementById("ovr_"+e)){i=Number(formatAsMoney(document.getElementById("ovr_"+e).value));r=Number(formatAsMoney(document.getElementById("ovr_"+e).getAttribute("data-orgval")))}let a=null;if($("#vis_"+e).is(":checked")){numberOfCustomerFacingCTSItems++}if(y==0||y==null||y==""){$("#row_"+e+" > .markup-price").html();a=t}else{a=formatAsMoney(t+Math.round(t*y+1e-8)/100);$("#row_"+e+" > .markup-price").html(a)}a=formatAsMoney(a)*1;let d=i-n;let o=a-n;let s=false;if(o!=0&&d!=0){s=true}if(i>0&&d!=0){$("#row_"+e+" > .preview-price").text(formatAsMoney(i));f=true}else if(isEnabled_Markup&&s){$("#row_"+e+" > .preview-price").text(formatAsMoney(a));f=true}else{$("#row_"+e+" > .preview-price").text("")}let l=document.getElementById("vis_"+e);if(l){let e=l.getAttribute("data-orgval");if(l.checked&&e!="CHECKED"||!l.checked&&e=="CHECKED"){f=true}}let m=document.getElementById("hid_"+e);if(m){let e=m.getAttribute("data-orgval");if(m.checked&&e!="CHECKED"||!m.checked&&e=="CHECKED"){f=true}}let u=document.getElementById("form_"+e);if(u){let e=u.getAttribute("data-orgval");if(u.checked&&e!="CHECKED"||!u.checked&&e=="CHECKED"){f=true}}}if(gNumOptionalsAdded!=0){f=true}if(f){$("#saved_message, #saved_message_2").showFlex()}else{$("#saved_message, #saved_message_2").hideFlex()}}function confirm_and_check_form(){let e=$("#menu_editor_form")[0];clearErrors();let n=_check_form(e);let i=!$("#markup_2_serving").val()?null:$("#markup_2_serving").val();let l=!$("#markup_3_serving").val()?null:$("#markup_3_serving").val();let m=!$("#markup_4_serving").val()?null:$("#markup_4_serving").val();let u=!$("#markup_6_serving").val()?null:$("#markup_6_serving").val();let c=!$("#markup_sides").val()?null:$("#markup_sides").val();let _=false;let f="0";let p="";if(n){if(i<0||m<0||l<0||u<0||c<0){p="Negative per cent markups are not currently permitted.<br />"}if(i>70||m>70||l>70||u>70||c>70){p+="Markups greater than 70% are not currently permitted.<br />"}if(f<0){p+="Negative volume discounts are not permitted.<br />"}if(f>75){p+="Volume Dscounts greater than $75.00 are not currently permitted.<br />"}if(f==""){p+="Please supply a valid volume discount. Use zero if you want no volume discount applied.<br />"}if($("#markup_2_serving").length!=0&&i==null||$("#markup_4_serving").length!=0&&m==null||$("#markup_3_serving").length!=0&&l==null||$("#markup_6_serving").length!=0&&u==null||$("#markup_sides").length!=0&&c==null){_=true}let e=!$("#assembly_fee").val()?0:$("#assembly_fee").val();if(e<0){p+="The Assembly Fee must be greater than or equal to 0.<br />"}let t=!$("#delivery_assembly_fee").val()?0:$("#delivery_assembly_fee").val();if(t<0){p+="The Delivery Assembly Fee must be greater than or equal to 0.<br />"}let r=document.getElementById("itemsTbl").rows;let d=false;let o="";for(let i=0;i<r.length;i++){if(r[i].id.indexOf("row_")==-1){continue}let e=r[i].id.substr(4);let t=Number(menuInfo.mid[e].base_price);let n="";if(document.getElementById("ovr_"+e)){n=Number(document.getElementById("ovr_"+e).value)}if(n&&n!=""){if(noOverrideUnderBase&&n<t){d=true;o+=menuInfo.mid[e].menu_item_name+"<br />"}if(n>999){p+="The Override Price must be less than $999.00<br />";break}}}let s=document.getElementById("EFLitemsTbl").rows;for(let a=0;a<s.length;a++){if(s[a].id.indexOf("row_")==-1){continue}let i=s[a].id.substr(4);let e=Number(menuInfo.mid[i].base_price);let r=$("#mkdn_"+i)[0];let t=$("#upd_mkdn_"+i)[0];if(r){let n=$(r).data("markdown_id")+"|"+$(r).data("markdown_value");if(!t){let e=document.createElement("input");e.setAttribute("type","hidden");e.setAttribute("value",n);let t="upd_mkdn_"+i;e.setAttribute("id",t);e.setAttribute("name",t);r.appendChild(e)}else{t.val(n)}}let n="";if(document.getElementById("ovr_"+i)){n=Number(document.getElementById("ovr_"+i).value)}if(n&&n!=""){if(noOverrideUnderBase&&n<e){d=true;o+=menuInfo.mid[i].menu_item_name+"<br />"}if(n>999){p+="The Override Price must be less than $999.00<br />";break}}}let a=document.getElementById("ctsItemsTbl").rows;for(let i=0;i<a.length;i++){if(a[i].id.indexOf("row_")==-1){continue}let e=a[i].id.substr(4);let t=Number(menuInfo.mid[e].base_price);let n="";if(document.getElementById("ovr_"+e)){n=Number(document.getElementById("ovr_"+e).value)}if(n&&n!=""){if(noOverrideUnderBase&&n<t){d=true;o+=menuInfo.mid[e].menu_item_name+"<br />"}if(n>999){p+="The Override Price must be less than $999.00<br />";break}}}if(d){p+="The Override Price must be greater than the base price for:<br />";p+=o}if(p!=""){n=false;displayValidationErrorMsg(p)}}if(n){let e="Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.";if(_){e+="<br /><br /><span class='text-red font-weight-bold'>One or more of the Percentage MarkUp values is empty or 0. Please review and correct if this was unintentional.</span><br />"}dd_message({title:"Attention",message:e,modal:true,confirm:function(){document.getElementById("action").value="finalize";$("#menu_editor_form").submit();return false},cancel:function(){return false}})}return false}function getMarkUpPrice(e,t){let n=Number(t);t=Number(t);let i=!$("#markup_2_serving").val()?null:$("#markup_2_serving").val();let r=!$("#markup_3_serving").val()?null:$("#markup_3_serving").val();let a=!$("#markup_4_serving").val()?null:$("#markup_4_serving").val();let d=!$("#markup_6_serving").val()?null:$("#markup_6_serving").val();if(e=="Sm (2)"){if(i==0||i==null||i==""){n=t.valueOf()}else{n=formatAsMoney(t.valueOf()+Math.round(t.valueOf()*i)/100)}}else if(e=="Md (4)"){if(a==0||a==null||a==""){n=t.valueOf()}else{n=formatAsMoney(t.valueOf()+Math.round(t.valueOf()*a)/100)}}else if(e=="Md (3)"){if(r==0||r==null||r==""){n=t.valueOf()}else{n=formatAsMoney(t.valueOf()+Math.round(t.valueOf()*r)/100)}}else{if(d==0||d==null||d==""){n=t.valueOf()}else{n=formatAsMoney(t.valueOf()+Math.round(t.valueOf()*d)/100)}}return n}function addUnsavedEFLItem(e,t,n,i,r,a){let d=0;if(e==0){return}var o=document.getElementById("EFLitemsTbl");var s=o.insertRow(-1);s.setAttribute("id","row_"+e);var l=s.insertCell(0);var m=document.createElement("input");m.setAttribute("type","checkbox");var u="vis_"+e;m.setAttribute("id",u);m.setAttribute("name",u);m.setAttribute("class","align-middle");m.setAttribute("data-orgval","CHECKED");m.setAttribute("data-menu_item_id",e);m.setAttribute("checked","checked");l.appendChild(m);var c=s.insertCell(++d);var _=document.createElement("input");_.setAttribute("type","checkbox");var u="pic_"+e;_.setAttribute("id",u);_.setAttribute("name",u);_.setAttribute("class","align-middle");_.setAttribute("data-orgval","");_.setAttribute("step","any");c.appendChild(_);var f=s.insertCell(++d);f.setAttribute("class","align-middle text-left");var p=document.createTextNode(t);f.appendChild(p);var v=s.insertCell(++d);v.setAttribute("class","align-middle");var g=document.createTextNode(n);v.appendChild(g);if(isEnabled_Markup){var h=s.insertCell(++d);h.setAttribute("class","align-middle");var g=document.createTextNode(formatAsMoney(i));h.appendChild(g);var b=getMarkUpPrice(n,i)}var y=s.insertCell(++d);y.setAttribute("class","align-middle");if(isEnabled_Markup){var g=document.createTextNode(b)}else{var g=document.createTextNode(formatAsMoney(i))}y.appendChild(g);if(isEnabled_Markup){var k=s.insertCell(++d);k.setAttribute("class","align-middle markup-price");var g=document.createTextNode(b);k.appendChild(g)}var $=s.insertCell(++d);var g=document.createElement("input");g.setAttribute("type","number");g.setAttribute("size","3");g.setAttribute("step","any");g.setAttribute("class","form-control form-control-sm no-spin-button");g.setAttribute("maxlength","6");g.setAttribute("data-orgval","");var u="ovr_"+e;g.setAttribute("id",u);g.setAttribute("name",u);if(!isEnabled_Markup){g.setAttribute("value",formatAsMoney(i))}$.appendChild(g);var w=s.insertCell(++d);var g=document.createElement("button");var u="add-mkdn_"+e;g.setAttribute("id",u);g.setAttribute("class","button");var A=document.createTextNode("Add");g.appendChild(A);w.appendChild(g);var E=s.insertCell(++d);E.setAttribute("class","align-middle preview-price")}function addUnsavedSideItem(e,t,n,i,r){let a=0;if(e==0){return}var d=document.getElementById("ctsItemsTbl");if($("#temp_category").length==0){var o=d.insertRow(-1);o.setAttribute("id","temp_category");var s=o.insertCell(0);s.setAttribute("class","font-weight-bold py-3");s.setAttribute("colspan","11");var l=document.createTextNode("Newly Added Items");s.appendChild(l)}var o=d.insertRow(-1);o.setAttribute("id","row_"+e);var m=o.insertCell(a++);var u=document.createElement("input");u.setAttribute("type","checkbox");var c="vis_"+e;u.setAttribute("id",c);u.setAttribute("name",c);u.setAttribute("class","align-middle");u.setAttribute("data-orgval","CHECKED");u.setAttribute("data-menu_item_id",e);u.setAttribute("checked","checked");m.appendChild(u);var _=o.insertCell(a++);var f=document.createElement("input");f.setAttribute("type","checkbox");var c="form_"+e;f.setAttribute("id",c);f.setAttribute("name",c);f.setAttribute("class","align-middle");f.setAttribute("data-orgval","");f.setAttribute("step","any");_.appendChild(f);var p=o.insertCell(a++);var f=document.createElement("input");f.setAttribute("type","checkbox");var c="hid_"+e;f.setAttribute("id",c);f.setAttribute("name",c);f.setAttribute("class","align-middle");f.setAttribute("data-orgval","");f.setAttribute("step","any");p.appendChild(f);var s=o.insertCell(a++);s.setAttribute("class","align-middle text-left");var l=document.createTextNode(t);s.appendChild(l);var v=o.insertCell(a++);v.setAttribute("class","align-middle");var g=document.createTextNode(n);v.appendChild(g);var h=o.insertCell(a++);h.setAttribute("class","align-middle");var g=document.createTextNode(formatAsMoney(i));h.appendChild(g);var b=getMarkUpPrice(n,i);var y=o.insertCell(a++);y.setAttribute("class","align-middle");var g=document.createTextNode(b);y.appendChild(g);var k=o.insertCell(a++);k.setAttribute("class","align-middle markup-price");var g=document.createTextNode(b);k.appendChild(g);var w=o.insertCell(a++);var g=document.createElement("input");g.setAttribute("type","number");g.setAttribute("size","3");g.setAttribute("step","any");g.setAttribute("class","form-control form-control-sm no-spin-button");g.setAttribute("maxlength","6");g.setAttribute("data-orgval","");var c="ovr_"+e;g.setAttribute("id",c);g.setAttribute("name",c);w.appendChild(g);var A=o.insertCell(a++);A.setAttribute("class","align-middle preview-price");var g=document.createTextNode("");A.appendChild(g);var E=o.insertCell(a++);E.setAttribute("class","align-middle remaining-price");var g=document.createTextNode("0");E.appendChild(g)}function giveTabFocus(){const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});let t=e.tabs;if(typeof t!="undefined"&&t!=null){t=t.substring(t.indexOf("menu.")+5);$(document).find("[data-nav='"+t+"']").click()}}function initNavTab(){var e=$("#inv-nav-button").attr("href");var t=e.substring(0,e.indexOf("&tabs"));const n=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});if(typeof n.tabs!="undefined"&&n.tabs!=null){t=t+"&tabs="+n.tabs;$("#inv-nav-button").attr("href",t)}$(".nav-tab").each(function(){$(this).on("click",function(){var e=$("#inv-nav-button").attr("href");var t=e.substring(0,e.indexOf("&tabs"));t=t+"&tabs=menu."+$(this).data("nav");$("#inv-nav-button").attr("href",t)})})}$(function(){$(document).ready(function(){calculatePage();giveTabFocus();initNavTab()});$(document).on("change keyup",'#markup_6_serving, #markup_4_serving, #markup_3_serving, #markup_2_serving, #markup_sides, #assembly_fee, #delivery_assembly_fee, #volume_reward, [name="is_default_markup"], [id^=pic_], [id^=form_], [id^=ovr_], [id^=vis_], [id^=hid_]',function(e){calculatePage()});$(document).on("change keyup","[id^=vis_]",function(e){let t=$(this).data("menu_item_id");let n=$(this).is(":checked");if(menuInfo.mid[t].is_chef_touched=="1"){if(n&&numberOfCustomerFacingCTSItems>20){$(this).prop({checked:false});bootbox.alert("You can only display 20 Sides &amp; Sweets items on the customer facing menu.")}else{$("#hid_"+t).prop({checked:false})}}else if(menuInfo.mid[t].is_store_special=="1"){if(!n&&numberOfCustomerFacingEFLItems>10){$(this).prop({checked:true});bootbox.alert("You can only make 10 Fast Lane items visible at a time. Please hide another store special if you wish to make this item visible.")}}});$(document).on("change keyup","[id^=form_]",function(e){let t=$(this).data("menu_item_id");$("#hid_"+t).prop({checked:false})});$(document).on("change keyup","[id^=hid_]",function(e){let t=$(this).data("menu_item_id");$("#vis_"+t).prop({checked:false});$("#form_"+t).prop({checked:false})});$(document).on("keyup change","#filter",function(e){$.uiTableFilter($("#recipe_list"),this.value)});$(document).on("click","#clear_filter",function(e){$("#filter").val("").change();if(!Modernizr.input.placeholder){$("#filter").focus().blur()}});$(document).on("click","[id^=mkdn_]",function(e){tempArr=this.id.split("_");let n=tempArr[1];let r=$(this).data("markdown_value");let t=$(this).data("markdown_id");dd_message({title:"Edit Markdown",div_id:"edit_mkdn",message:$("#markdown_editor").html(),height:350,width:400,resizable:true,noOk:true,open:function(){$("#edit_mkdn").find("#markdown_amount").val(r);let i=getPreviewItemPrice(n);let t=i;t-=t*(r/100);$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(t));$("#edit_mkdn").find("#markdown_amount").on("keyup",function(e){t=i;newDiscount=$(this).val();if(newDiscount<0){newDiscount=0;$(this).val(newDiscount)}if(newDiscount>20){newDiscount=20;$(this).val(newDiscount)}t-=t*(newDiscount/100);$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(t))});$("#edit_mkdn").find("#markdown_price").on("keyup",function(e){let t=$(this).val();let n=(i-t)/i*100;$("#edit_mkdn").find("#markdown_amount").val(formatAsMoney(n))});$("#edit_mkdn").find("#current_price").html("$"+formatAsMoney(menuInfo.mid[n].price));$("#edit_mkdn").find("#base_price").html("$"+formatAsMoney(menuInfo.mid[n].base_price));$("#edit_mkdn").find("#item_title").html(menuInfo.mid[n].menu_item_name)},buttons:{Accept:function(){let e=getPreviewItemPrice(n);let t=$("#edit_mkdn").find("#markdown_amount").val();if(t>20){t=20;price=e*(t/100);$("#edit_mkdn").find("#markdown_amount").val(formatAsMoney(t));$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(e-price));dd_message({title:"Error",message:"The percentage of discount is limited to 20%. The amounts have been adjusted. Please review and re-submit."});return}else if(t<0){t=0;$("#edit_mkdn").find("#markdown_amount").val(formatAsMoney(t));$("#edit_mkdn").find("#markdown_price").val(formatAsMoney(e));dd_message({title:"Error",message:"The percentage of discount cannot be negative. The amounts have been adjusted. Please review and re-submit."});return}$("#mkdn_"+n).html(formatAsMoney(t)+"%");$("#mkdn_"+n).data("markdown_value",t);calculatePage();$(this).remove()},Cancel:function(){$(this).remove()}}});return false});$(document).on("click","[id^=add-mkdn_]",function(e){tempArr=this.id.split("_");let r=tempArr[1];let t=$(this).data("markdown_value");let n=$(this).data("markdown_id");dd_message({title:"Add Markdown",div_id:"new_mkdn",message:$("#markdown_editor").html(),height:350,width:400,resizable:true,noOk:true,open:function(){$("#new_mkdn").find("#markdown_amount").val(t);let i=getPreviewItemPrice(r);$("#new_mkdn").find("#markdown_price").val(formatAsMoney(i));$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(0));$("#new_mkdn").find("#markdown_amount").on("keyup",function(e){price=i;newDiscount=$(this).val();if(newDiscount<0){newDiscount=0;$(this).val(newDiscount)}if(newDiscount>20){newDiscount=20;$(this).val(newDiscount)}price-=price*(newDiscount/100);$("#new_mkdn").find("#markdown_price").val(formatAsMoney(price))});$("#new_mkdn").find("#markdown_price").on("keyup",function(e){let t=$(this).val();let n=(i-t)/i*100;$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(n))});$("#new_mkdn").find("#current_price").html("$"+formatAsMoney(menuInfo.mid[r].price));$("#new_mkdn").find("#base_price").html("$"+formatAsMoney(menuInfo.mid[r].base_price));$("#new_mkdn").find("#item_title").html(menuInfo.mid[r].menu_item_name)},buttons:{Accept:function(){let e=getPreviewItemPrice(r);let t=$("#new_mkdn").find("#markdown_amount").val();if(t>20){t=20;price=e*(t/100);$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(t));$("#new_mkdn").find("#markdown_price").val(formatAsMoney(e-price));dd_message({title:"Error",message:"The percentage of discount is limited to 20%. The amounts have been adjusted. Please review and re-submit."});return}else if(t<0){t=0;$("#new_mkdn").find("#markdown_amount").val(formatAsMoney(t));$("#new_mkdn").find("#markdown_price").val(formatAsMoney(e));dd_message({title:"Error",message:"The percentage of discount cannot be negative. The amounts have been adjusted. Please review and re-submit."});return}let n='<button class="button" id="mkdn_'+r+'" data-org_val="0" data-markdown_id="new" data-markdown_value="'+newDiscount+'" >'+formatAsMoney(newDiscount)+"%</button>";$("#add-mkdn_"+r).replaceWith(n);calculatePage();$(this).remove()},Cancel:function(){$(this).remove()}}});return false});$(document).on("click","#add_past_menu_item:not(.disabled)",function(e){displayModalWaitDialog("wait_for_adding_item_div","Retrieving items. Please wait ...");showPopup({modal:true,title:"Add EFL Item",noOk:true,closeOnEscape:false,height:720,div_id:"add_menu_item_popup_div",module:"page=admin_menu_editor_add_item&menu_id="+menuInfo.menu_id,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide();$("#wait_for_adding_item_div").remove()},buttons:{Cancel:function(){$(this).remove()},Okay:function(){let t={};$("#sel_list").find("[data-rmv_menu_item]").each(function(){let e=$(this).data("entree_id");t[e]=e});dd_message({title:"",message:"This will immediately add the listed items to the menu. Are you sure?",noOk:true,height:180,buttons:{"Add Items to Menu":function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"add_menu_item",menu_id:menuInfo.menu_id,entree_ids:t},success:function(r){if(r.processor_success){for(let e in r.results){let t=r.results[e]["count"];let n=r.results[e]["items"];let i=1;for(let e in n){menuInfo=r.menuInfo;addUnsavedEFLItem(n[e].item_id,n[e].name,n[e].size,n[e].base_price,i,t);i++}calculatePage();if(i>1){$("#empty_menu_message").remove()}}}else{dd_message({title:"Error",message:r.processor_message})}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}});$(this).remove();$("#add_menu_item_popup_div").remove()},Cancel:function(){$(this).remove()}}})}},close:function(){bounce("main.php?page=admin_menu_editor&tabs=menu.efl")}})});$(document).on("click","[data-add_menu_item]",function(e){if($(this).hasClass("disabled")){}else{$(this).addClass("disabled");let e=$(this).data("entree_id");let t=$(this).data("recipe_id");let n=$('[data-recipe_id_row="'+t+'"]').clone();n.find("[data-rmv_menu_item="+e+"]").show();n.find("[data-add_menu_item="+e+"]").remove();$("#selected_items tbody").append(n)}});$(document).on("click","[data-rmv_menu_item]",function(e){let t=$(this).data("entree_id");let n=$(this).data("recipe_id");$('#selected_items tbody [data-recipe_id_row="'+n+'"]').remove();let i=$('#recipe_list tbody [data-recipe_id_row="'+n+'"]');i.find('[data-add_menu_item="'+t+'"]').removeClass("disabled")});$(document).on("click","[data-info_menu_item]",function(e){let t=$(this).data("entree_id");let n=$(this).data("recipe_id");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"menu_item_info",menu_id:menuInfo.menu_id,entree_id:t,recipe_id:n},success:function(e){dd_message({modal:true,title:"Item Information",height:720,width:720,message:e.data,open:function(){handle_tabbed_content()}})},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})});$(document).on("click","#add_past_menu_item_sides",function(e){displayModalWaitDialog("wait_for_adding_item_div","Retrieving Sides & Sweets. Please wait ...");showPopup({modal:true,title:"Add Sides & Sweets",noOk:true,closeOnEscape:false,height:720,div_id:"add_menu_item_popup_div",module:"page=admin_menu_editor_add_sides_sweets&menu_id="+menuInfo.menu_id,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide();$("#wait_for_adding_item_div").remove()},buttons:{Cancel:function(){$(this).remove()},Okay:function(){let n={};let i=false;$("#sel_list").find("[data-rmv_menu_side]").each(function(){let e=$(this).data("entree_id");n[e]=e;let t=$("[data-recipe_category="+e+"]:visible").find(":selected").val();if(typeof t=="undefined"){t=$("[data-recipe_category="+e+"]:visible").html()}if(typeof t=="undefined"){$("[data-recipe_category="+e+"]").css("border-color","red");i=true}else{n[e]=t}});if(i){console.log("Missing");dd_message({title:"Please select a category for all items",message:"Please select a category for all items"})}else{dd_message({title:"",message:"This will immediately add the listed Sides & Sweets to the menu. Are you sure?",noOk:true,height:180,buttons:{"Add Sides & Sweets to Menu":function(){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"add_menu_side",menu_id:menuInfo.menu_id,entree_ids:n},success:function(r){if(r.processor_success){let e=0;for(let i in r.results){let e=r.results[i]["count"];let t=r.results[i]["items"];let n=1;for(let e in t){menuInfo=r.menuInfo;addUnsavedSideItem(t[e].item_id,t[e].name,t[e].size,t[e].base_price,t[e].subcategory_label);n++}}calculatePage();if(e>1){$("#empty_menu_message").remove()}$([document.documentElement,document.body]).animate({scrollTop:$("#temp_category").offset().top},2e3)}else{dd_message({title:"Error adding Sides & Sweets",message:r.processor_message})}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Network Error adding Sides and Sweets",message:response})}});$(this).remove();$("#add_menu_item_popup_div").remove()},Cancel:function(){$(this).remove()}}})}}},close:function(){bounce("main.php?page=admin_menu_editor&tabs=menu.efl")}})});$(document).on("change","[data-recipe_category]",function(e){let t=$(this).find(":selected").val();if(typeof t=="undefined"){$(this).css("border-color","red")}else{$(this).css("border-color","black")}});$(document).on("click","[data-add_menu_side]",function(e){if($(this).hasClass("disabled")){}else{$(this).addClass("disabled");let e=$(this).data("entree_id");let t=$(this).data("recipe_id");let n=$('[data-recipe_id_row="'+t+'"]').clone();n.find("[data-rmv_menu_side="+e+"]").show();n.find("[data-add_menu_side="+e+"]").remove();n.find("[data-recipe_category="+e+"]").show();let i=n.find("[data-old_category="+e+"]").html();n.find("[data-old_category="+e+"]").remove();$("#selected_items tbody").append(n);$("[data-recipe_category="+e+"]").val(i)}});$(document).on("click","[data-rmv_menu_side]",function(e){let t=$(this).data("entree_id");let n=$(this).data("recipe_id");$('#selected_items tbody [data-recipe_id_row="'+n+'"]').remove();let i=$('#recipe_list tbody [data-recipe_id_row="'+n+'"]');i.find('[data-add_menu_side="'+t+'"]').removeClass("disabled")});$(document).on("click","[data-info_menu_side]",function(e){let t=$(this).data("entree_id");let n=$(this).data("recipe_id");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",store_id:STORE_DETAILS.id,op:"menu_item_info",menu_id:menuInfo.menu_id,entree_id:t,recipe_id:n},success:function(e){dd_message({modal:true,title:"Item Information",height:720,width:720,message:e.data,open:function(){handle_tabbed_content()}})},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})})});
//# sourceMappingURL=menu_editor.min.js.map
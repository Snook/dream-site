$(function(){$("#menu_editor_form").submit(function(e){e.preventDefault();let t=this;bootbox.confirm("Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.",function(e){if(e){t.submit();return true}else{$("#menu_editor_form").removeClass("was-validated");return true}})});$("#menus").on("change",function(e){let t=$(this).val();create_and_submit_form({action:"main.php?page=admin_menu_editor_new",input:{action:"changeMenu",menus:t}})});$("#store").on("change",function(e){let t=$(this).val();create_and_submit_form({action:"main.php?page=admin_menu_editor_new",input:{action:"changeStore",store:t}})});$(document).on("change keyup",".override-price-input",function(e){let t=formatAsMoney($.trim($(this).val()));let i=t.toString().split(".")[1];let a=$(this).data("orgval");let r=$(this).data("ltd_menu_item_value");let d=$(this).data("menu_item_id");let n=$(this).data("tier_1_price");let o=$(this).data("tier_2_price");let s=$(this).data("tier_3_price");let l=null;$(this).removeClass(["border-green","border-orange","border-red","border-width-2"]);$("#row_"+d+" > .preview-price").removeClass(["text-green","text-orange","text-red"]).text("");if($(this).val()&&a!=t){let e=Number(t)+Number(r);$("#row_"+d+" > .preview-price").text(e);if(n&&s&&(t<n||t>s)){$("#row_"+d+" > .preview-price").addClass("text-red");$(this).addClass("border-red border-width-2")}else if(i!="49"&&i!="99"){$("#row_"+d+" > .preview-price").addClass("text-orange");$(this).addClass("border-orange border-width-2")}else{$("#row_"+d+" > .preview-price").addClass("text-green");$(this).addClass("border-green")}}});$(document).on("change keyup",".markup-input",function(e){let t=$(this).attr("name");let a=Number($(this).val());let i=$(this).data("pricing_type");switch(t){case"markup_2_serving":case"markup_3_serving":case"markup_4_serving":case"markup_6_serving":$('.override-price-input[data-pricing_type="'+i+'"]:not([data-category_group="SIDE"][readonly])').each(function(){let e=$(this).data("menu_item_id");let t=Number($(this).data("price"));let i=formatAsMoney(t+Math.round(t*a+1e-8)/100);$('.markup-price[data-menu_item_id="'+e+'"]').text(i)});break;case"markup_sides":$('.override-price-input[data-category_group="SIDE"]:not([readonly])').each(function(){let e=$(this).data("menu_item_id");let t=Number($(this).data("price"));let i=formatAsMoney(t+Math.round(t*a+1e-8)/100);$('.markup-price[data-menu_item_id="'+e+'"]').text(i)});break}});$(".markup-input").trigger("change");$(document).on("change keyup",".visibility-select, .override-price-input, .markup-input",function(e){let a=false;$(".unsaved-message").hideFlex();$(".visibility-select").each(function(){$(this).removeClass(["border-orange"]);if(Number($(this).val())!=Number($(this).data("orgval"))){$(this).addClass(["border-orange"]);a=true}});$(".override-price-input").each(function(){let e=formatAsMoney($.trim($(this).val()));let t=e.toString().split(".")[1];let i=$(this).data("orgval");if(i!=""&&i!=e){a=true}});$(".markup-input").each(function(){let e=formatAsMoney($.trim($(this).val()));let t=e.toString().split(".")[1];let i=$(this).data("orgval");if(i!=""&&i!=e){a=true}});if(a){$(".unsaved-message").showFlex()}});$(document).on("click","[data-add_past_menu_item]:not(.disabled)",function(e){e.preventDefault();let r={menu_id:$("#menus").val(),store_id:STORE_DETAILS.id,item_type:$(this).data("add_past_menu_item"),selected_items:{},dialog:null};r.dialog=bootbox.dialog({message:'<p><i class="fa fa-spin fa-spinner"></i> Loading menu items...</p>',size:"large",closeButton:false,buttons:{add_items:{label:"Add selected menu items",className:"btn-primary disabled add-menu-items-confirm",callback:function(){if(Object.keys(r.selected_items).length===0){return true}if(confirm("This will immediately add the listed items to the menu. Are you sure you wish to add the selected menu items to the menu?")){r.dialog.find(".bootbox-body").html('<p><i class="fa fa-spin fa-spinner"></i> Adding menu items...</p>');r.dialog.find(".modal-footer").hideFlex();$.ajax({url:"ddproc.php",type:"POST",dataType:"json",timeout:6e4,data:{processor:"admin_menu_editor",menu_id:r.menu_id,store_id:r.store_id,op:"add_items",items:r.selected_items},success:function(e){if(e.processor_success){bounce("main.php?page=admin_menu_editor_new&tab=nav-"+r.item_type)}else{r.dialog.find(".bootbox-body").html("<p>"+e.processor_message+"</p>")}},error:function(e,t){r.dialog.find(".bootbox-body").html("<p>Unexpected error: "+t+"</p>")}})}return false}},cancel:{label:"Cancel",className:"btn-danger",callback:function(){return true}}},onShow:function(e){$.ajax({url:"ddproc.php",type:"POST",dataType:"json",timeout:6e4,data:{processor:"admin_menu_editor",menu_id:r.menu_id,store_id:r.store_id,op:"get_items",item_type:r.item_type},success:function(e){if(e.processor_success){r.dialog.find(".bootbox-body").html(e.menu_item_html)}else{r.dialog.find(".bootbox-body").html("<p>"+e.processor_message+"</p>")}},error:function(e,t){r.dialog.find(".bootbox-body").html("<p>Unexpected error: "+t+"</p>")}})}});$(r.dialog).on("click","[data-add_menu_item]:not(.disabled)",function(e){e.preventDefault();$(this).addClass("disabled");let t=$(this).data("add_menu_item");let i=$(this).data("entree_id");let a=$(this).data("recipe_id");r.selected_items[i]=i;r.dialog.find(".modal-footer > .add-menu-items-confirm").removeClass("disabled");$('.row_menu_editor_add_item[data-recipe_id="'+a+'"]').showFlex()});$(r.dialog).on("click","[data-add_menu_item_cancel]:not(.disabled)",function(e){e.preventDefault();let t=$(this).data("add_menu_item_cancel");let i=$(this).data("entree_id");let a=$(this).data("recipe_id");delete r.selected_items[i];if(Object.keys(r.selected_items).length===0){r.dialog.find(".modal-footer > .add-menu-items-confirm").addClass("disabled")}$('[data-add_menu_item="'+t+'"]').removeClass("disabled");$('.row_menu_editor_add_item[data-recipe_id="'+a+'"]').hideFlex()});$(r.dialog).on("keyup change","#add_menu_item_filter",function(e){$.uiTableFilter($("#add_menu_item_recipe_list"),this.value)});$(r.dialog).on("click","#add_menu_item_clear_filter",function(e){$("#add_menu_item_filter").val("").change()});$(r.dialog).on("click","[data-add_menu_item_info]",function(e){let t=$(this).data("entree_id");let i=$(this).data("recipe_id");let a=$('.add_menu_item_info[data-recipe_id="'+i+'"]').data("fetched");if(a){$('.add_menu_item_info[data-recipe_id="'+i+'"]').showFlex();return}$('.add_menu_item_info[data-recipe_id="'+i+'"]').html('<span class="font-weight-bold"><i class="fa fa-spin fa-spinner"></i> Loading menu item info...</span>').showFlex();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menu_editor",menu_id:r.menu_id,store_id:r.store_id,op:"menu_item_info",entree_id:t,recipe_id:i},success:function(e){$('.add_menu_item_info[data-recipe_id="'+i+'"]').data("fetched",true).html(e.data)},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})});$(r.dialog).on("click","[data-add_menu_item_info_close]",function(e){let t=$(this).data("add_menu_item_info_close");$('.add_menu_item_info[data-recipe_id="'+t+'"]').hideFlex()})});$(document).on("click","[data-round_up_markup]",function(e){let t=$(this).data("round_up_markup");bootbox.confirm("Are you sure want to update all Override Prices with rounded Markup Prices? This action will replace existing override prices with the newly calculated price.",function(e){if(e){$('.override-price-input[data-category_group="'+t+'"]:not([readonly])').each(function(){if($.trim($(this).val())!=""){let e=Number($(this).val());let t=Math.ceil(price*2)/2;e.val(t.toFixed(2))}});return true}})});$(document).on("click",".sides-sweets-get-pricing",function(e){let t=$(this).data("operation");if(t==="default_pricing_get"){bootbox.confirm("Are you sure want to update all Override Prices with rounded Markup Prices? This action will replace existing override prices with the newly calculated price.",function(e){if(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menu_editor",store_id:STORE_DETAILS.id,op:t},success:function(e){if(e.processor_success){$.each(e.pricingData,function(i,e){$.each(e,function(e,t){$('.override-price-input[data-recipe_id="'+i+'"][data-pricing_type="'+e+'"]:not([readonly])').val(t.default_price).trigger("change")})})}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}});return true}})}else if(t==="default_pricing_save"){let l={};$('.override-price-input[data-category_group="SIDE"]:not([readonly])').each(function(){let e=0;let t=$(this).data("recipe_id");let i=$(this).data("menu_item_id");let a=Number($(this).data("price"));let r=Number($('.markup-price[data-menu_item_id="'+i+'"]').text());let d=Number($(this).val());let n=$('.visibility-select[data-recipe_id="'+t+'"][data-visibility_type="vis"]').val();let o=$('.visibility-select[data-recipe_id="'+t+'"][data-visibility_type="hid"]').val();let s=$('.visibility-select[data-recipe_id="'+t+'"][data-visibility_type="form"]').val();if(d!==0){e=d}else if(r!==0){e=r}else{e=a}if(e!==0){l[t]={price:e,vis:n,hid:o,form:s}}});if(Object.keys(l).length!==0){bootbox.confirm("Are you sure you want to save the default Sides and Sweets pricing and visibility? This cannot be undone.",function(e){if(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menu_editor",store_id:STORE_DETAILS.id,op:t,prices:l},success:function(e){if(e.processor_success){$.each(e.pricingData,function(i,e){$.each(e,function(e,t){$('.override-price-input[data-recipe_id="'+i+'"][data-pricing_type="'+e+'"]:not([readonly])').val(t.default_price).trigger("change")})})}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}});return true}})}}})});
//# sourceMappingURL=menu_editor.min.js.map
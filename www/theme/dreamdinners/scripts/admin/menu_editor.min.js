$((function(){$("#menu_editor_form").submit((function(e){e.preventDefault();let t=this;bootbox.confirm("Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.",(function(e){return e?(t.submit(),!0):($("#menu_editor_form").removeClass("was-validated"),!0)}))})),$("#menus").on("change",(function(e){let t=$(this).val();create_and_submit_form({action:"main.php?page=admin_menu_editor_new",input:{action:"changeMenu",menus:t}})})),$("#store").on("change",(function(e){let t=$(this).val();create_and_submit_form({action:"main.php?page=admin_menu_editor_new",input:{action:"changeStore",store:t}})})),$(document).on("change keyup",".override-price-input",(function(e){let t=formatAsMoney($.trim($(this).val())),i=t.toString().split(".")[1],a=$(this).data("orgval"),d=$(this).data("ltd_menu_item_value"),r=$(this).data("menu_item_id"),n=$(this).data("tier_1_price"),o=($(this).data("tier_2_price"),$(this).data("tier_3_price"));if($(this).removeClass(["border-green","border-orange","border-red","border-width-2"]),$("#row_"+r+" > .preview-price").removeClass(["text-green","text-orange","text-red"]).text(""),$(this).val()&&a!=t){let e=Number(t)+Number(d);$("#row_"+r+" > .preview-price").text(e),n&&o&&(t<n||t>o)?($("#row_"+r+" > .preview-price").addClass("text-red"),$(this).addClass("border-red border-width-2")):"49"!=i&&"99"!=i?($("#row_"+r+" > .preview-price").addClass("text-orange"),$(this).addClass("border-orange border-width-2")):($("#row_"+r+" > .preview-price").addClass("text-green"),$(this).addClass("border-green"))}})),$(document).on("change keyup",".markup-input",(function(e){let t=$(this).attr("name"),i=Number($(this).val()),a=$(this).data("pricing_type");switch(t){case"markup_2_serving":case"markup_3_serving":case"markup_4_serving":case"markup_6_serving":$('.override-price-input[data-pricing_type="'+a+'"]:not([data-category_group="SIDE"][readonly])').each((function(){let e=$(this).data("menu_item_id"),t=Number($(this).data("price")),a=formatAsMoney(t+Math.round(t*i+1e-8)/100);$('.markup-price[data-menu_item_id="'+e+'"]').text(a)}));break;case"markup_sides":$('.override-price-input[data-category_group="SIDE"]:not([readonly])').each((function(){let e=$(this).data("menu_item_id"),t=Number($(this).data("price")),a=formatAsMoney(t+Math.round(t*i+1e-8)/100);$('.markup-price[data-menu_item_id="'+e+'"]').text(a)}))}})),$(".markup-input").trigger("change"),$(document).on("change keyup",".visibility-select, .override-price-input, .markup-input",(function(e){let t=!1;$(".unsaved-message").hideFlex(),$(".visibility-select").each((function(){$(this).removeClass(["border-orange"]),Number($(this).val())!=Number($(this).data("orgval"))&&($(this).addClass(["border-orange"]),t=!0)})),$(".override-price-input").each((function(){let e=formatAsMoney($.trim($(this).val())),i=(e.toString().split(".")[1],$(this).data("orgval"));""!=i&&i!=e&&(t=!0)})),$(".markup-input").each((function(){let e=formatAsMoney($.trim($(this).val())),i=(e.toString().split(".")[1],$(this).data("orgval"));""!=i&&i!=e&&(t=!0)})),t&&$(".unsaved-message").showFlex()})),$(document).on("click","[data-add_past_menu_item]:not(.disabled)",(function(e){e.preventDefault();let t={menu_id:$("#menus").val(),store_id:STORE_DETAILS.id,item_type:$(this).data("add_past_menu_item"),selected_items:{},dialog:null};t.dialog=bootbox.dialog({message:'<p><i class="fa fa-spin fa-spinner"></i> Loading menu items...</p>',size:"large",closeButton:!1,buttons:{add_items:{label:"Add selected menu items",className:"btn-primary disabled add-menu-items-confirm",callback:function(){return 0===Object.keys(t.selected_items).length||(confirm("This will immediately add the listed items to the menu. Are you sure you wish to add the selected menu items to the menu?")&&(t.dialog.find(".bootbox-body").html('<p><i class="fa fa-spin fa-spinner"></i> Adding menu items...</p>'),t.dialog.find(".modal-footer").hideFlex(),$.ajax({url:"ddproc.php",type:"POST",dataType:"json",timeout:6e4,data:{processor:"admin_menu_editor",menu_id:t.menu_id,store_id:t.store_id,op:"add_items",items:t.selected_items},success:function(e){e.processor_success?bounce("main.php?page=admin_menu_editor_new&tab=nav-"+t.item_type):t.dialog.find(".bootbox-body").html("<p>"+e.processor_message+"</p>")},error:function(e,i){t.dialog.find(".bootbox-body").html("<p>Unexpected error: "+i+"</p>")}})),!1)}},cancel:{label:"Cancel",className:"btn-danger",callback:function(){return!0}}},onShow:function(e){$.ajax({url:"ddproc.php",type:"POST",dataType:"json",timeout:6e4,data:{processor:"admin_menu_editor",menu_id:t.menu_id,store_id:t.store_id,op:"get_items",item_type:t.item_type},success:function(e){e.processor_success?t.dialog.find(".bootbox-body").html(e.menu_item_html):t.dialog.find(".bootbox-body").html("<p>"+e.processor_message+"</p>")},error:function(e,i){t.dialog.find(".bootbox-body").html("<p>Unexpected error: "+i+"</p>")}})}}),$(t.dialog).on("click","[data-add_menu_item]:not(.disabled)",(function(e){e.preventDefault(),$(this).addClass("disabled");$(this).data("add_menu_item");let i=$(this).data("entree_id"),a=$(this).data("recipe_id");t.selected_items[i]=i,t.dialog.find(".modal-footer > .add-menu-items-confirm").removeClass("disabled"),$('.row_menu_editor_add_item[data-recipe_id="'+a+'"]').showFlex()})),$(t.dialog).on("click","[data-add_menu_item_cancel]:not(.disabled)",(function(e){e.preventDefault();let i=$(this).data("add_menu_item_cancel"),a=$(this).data("entree_id"),d=$(this).data("recipe_id");delete t.selected_items[a],0===Object.keys(t.selected_items).length&&t.dialog.find(".modal-footer > .add-menu-items-confirm").addClass("disabled"),$('[data-add_menu_item="'+i+'"]').removeClass("disabled"),$('.row_menu_editor_add_item[data-recipe_id="'+d+'"]').hideFlex()})),$(t.dialog).on("keyup change","#add_menu_item_filter",(function(e){$.uiTableFilter($("#add_menu_item_recipe_list"),this.value)})),$(t.dialog).on("click","#add_menu_item_clear_filter",(function(e){$("#add_menu_item_filter").val("").change()})),$(t.dialog).on("click","[data-add_menu_item_info]",(function(e){let i=$(this).data("entree_id"),a=$(this).data("recipe_id");$('.add_menu_item_info[data-recipe_id="'+a+'"]').data("fetched")?$('.add_menu_item_info[data-recipe_id="'+a+'"]').showFlex():($('.add_menu_item_info[data-recipe_id="'+a+'"]').html('<span class="font-weight-bold"><i class="fa fa-spin fa-spinner"></i> Loading menu item info...</span>').showFlex(),$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menu_editor",menu_id:t.menu_id,store_id:t.store_id,op:"menu_item_info",entree_id:i,recipe_id:a},success:function(e){$('.add_menu_item_info[data-recipe_id="'+a+'"]').data("fetched",!0).html(e.data)},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Error",message:response})}}))})),$(t.dialog).on("click","[data-add_menu_item_info_close]",(function(e){let t=$(this).data("add_menu_item_info_close");$('.add_menu_item_info[data-recipe_id="'+t+'"]').hideFlex()}))})),$(document).on("click","[data-round_up_markup]",(function(e){let t=$(this).data("round_up_markup");bootbox.confirm("Are you sure want to update all Override Prices with rounded Markup Prices? This action will replace existing override prices with the newly calculated price.",(function(e){if(e)return $('.override-price-input[data-category_group="'+t+'"]:not([readonly])').each((function(){if(""!=$.trim($(this).val())){let e=Number($(this).val()),t=Math.ceil(2*price)/2;e.val(t.toFixed(2))}})),!0}))})),$(document).on("click",".sides-sweets-get-pricing",(function(e){let t=$(this).data("operation");if("default_pricing_get"===t)bootbox.confirm("Are you sure want to update all Override Prices with rounded Markup Prices? This action will replace existing override prices with the newly calculated price.",(function(e){if(e)return $.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menu_editor",store_id:STORE_DETAILS.id,op:t},success:function(e){e.processor_success&&$.each(e.pricingData,(function(e,t){$.each(t,(function(t,i){$('.override-price-input[data-recipe_id="'+e+'"][data-pricing_type="'+t+'"]:not([readonly])').val(i.default_price).trigger("change")}))}))},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Error",message:response})}}),!0}));else if("default_pricing_save"===t){let e={};$('.override-price-input[data-category_group="SIDE"]:not([readonly])').each((function(){let t=0,i=$(this).data("recipe_id"),a=$(this).data("menu_item_id"),d=Number($(this).data("price")),r=Number($('.markup-price[data-menu_item_id="'+a+'"]').text()),n=Number($(this).val()),o=$('.visibility-select[data-recipe_id="'+i+'"][data-visibility_type="vis"]').val(),s=$('.visibility-select[data-recipe_id="'+i+'"][data-visibility_type="hid"]').val(),c=$('.visibility-select[data-recipe_id="'+i+'"][data-visibility_type="form"]').val();t=0!==n?n:0!==r?r:d,0!==t&&(e[i]={price:t,vis:o,hid:s,form:c})})),0!==Object.keys(e).length&&bootbox.confirm("Are you sure you want to save the default Sides and Sweets pricing and visibility? This cannot be undone.",(function(i){if(i)return $.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menu_editor",store_id:STORE_DETAILS.id,op:t,prices:e},success:function(e){e.processor_success&&$.each(e.pricingData,(function(e,t){$.each(t,(function(t,i){$('.override-price-input[data-recipe_id="'+e+'"][data-pricing_type="'+t+'"]:not([readonly])').val(i.default_price).trigger("change")}))}))},error:function(e,t){response="Unexpected error: "+t,dd_message({title:"Error",message:response})}}),!0}))}}))}));
//# sourceMappingURL=menu_editor.min.js.map
!function(){"use strict";manageSingleStore&&$(document).on("keyup blur",".notice-message, .notice-title",(function(e){$(this).val()!=strip_tags($(this).val())&&$(this).val(strip_tags($(this).val()))})),$(document).on("click",".storeSelector-select-all",(function(e){$("#storeSelector input[type=checkbox]").prop("checked",!0)})),$(document).on("click",".storeSelector-select-none",(function(e){$("#storeSelector input[type=checkbox]").prop("checked",!1)})),$(document).on("click",".storeSelector-select-corporate",(function(e){$('#storeSelector [data-storeSelect_franchise_id="220"]').prop("checked",!0)})),$(document).on("click",".storeSelector-select-not-corporate",(function(e){$('#storeSelector [data-storeSelect_franchise_id!="220"]').prop("checked",!0)})),$(document).on("click",".notice-store-filter:not(.disabled)",(function(e){$(".notice-select-filter").val($(this).data("filter_store_id")).trigger("change")})),$(document).on("change",".notice-select-filter",(function(e){if($(".notice-list").children().each((function(){$(this).hide()})),$("[data-filter_store_id]").removeClass("disabled"),"home_office_managed"==$(this).val())$(".notice-list").children('[data-home_office_managed="1"]').each((function(){$(this).show()}));else if("home_office_managed_not"==$(this).val())$(".notice-list").children('[data-home_office_managed="0"]').each((function(){$(this).show()}));else if(""!=$(this).val()){var t=$(this).val();$(".notice-list").children().find('[name="store_id"]').each((function(){var e=$(this).val().split(",");$.inArray(t,e)||($(this).parentsUntil("[data-notice_id_div]").parent().show(),$(this).parentsUntil("[data-notice_id_div]").find("[data-filter_store_id]").addClass("disabled"))}))}else $(".notice-list").children().each((function(){$(this).show()}))})),$(document).on("change",".notice-alert_css",(function(e){var t=$(this).parents("form:first"),i=$(this).val();$(this).parent().find("select option").each((function(){var e=$(this).val();$("[name='message']",t).removeClass(e)})),$("[name='message']",t).addClass(i)})),$(document).on("change",".notice-select-audience",(function(e){var t=$(this).parents("form:first"),i=$("[name='id']",t).val(),n=$('[data-notice_id_div="'+i+'"]');"STORE"===$(this).val()?($(n).find(".div-notice-title").show(),$("[name='title']",t).prop("required",!0),$(n).find(".div-notice-select-style").hide(),$(n).find(".div-notice-select-store").show(),$("[name='alert_css']",t).prop("required",!1).val("").trigger("change")):($(n).find(".div-notice-select-style").show(),$("[name='alert_css']",t).prop("required",!0),$(n).find(".div-notice-select-store").hide(),$(n).find(".div-notice-title").hide(),$("[name='title']",t).prop("required",!1))})),$(document).on("click",".notice-create",(function(e){e.preventDefault(),$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_manage_site_notice",op:"get_notice_form"},success:function(e){e.processor_success&&($(".notice-list").prepend(e.html),$('[data-notice_id_div="'+e.notice_id+'"]').slideDown())},error:function(e,t){;"Unexpected error"}})})),$(document).on("click",".notice-store-select:not(.disabled)",(function(e){var t=$(this),i=$(t).parents("form:first"),n=$("[name='store_id']",i).val();$(".notice-store-select").addClass("disabled"),$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_manage_site_notice",op:"get_store_select",store_id:n},success:function(e){e.processor_success&&bootbox.confirm({message:e.html,scrollable:!0,callback:function(e){if(e){var n=$("#storeSelector").serializeArray(),o=[];$.each(n,(function(e,t){o.push(t.value)})),$("[name='store_id']",i).val(o.join()),$(t).find(".notice-store_id-count").text(n.length)}$(".notice-store-select").removeClass("disabled")}})},error:function(e,t){;"Unexpected error"}})})),$(document).on("submit",".notice-form",(function(e){var t=$(this);if(e.preventDefault(),0==$(e.delegateTarget.activeElement).not("input, textarea").length)return $(t).removeClass("was-validated"),$(t).find(".btn-spinning").removeClass("btn-spinning"),$(t).find(".ld-spin").remove(),e.preventDefault(),!1;if(!1!==t[0].checkValidity()){var i={};$.each(t.serializeArray(),(function(){i[this.name]=this.value}));var n=JSON.stringify(i);$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_manage_site_notice",op:"save_site_notice",notice_details:n},success:function(e){e.processor_success&&(e.notice_id&&($("[name='id']",t).val(e.notice_id),$(t).parent().attr("data-notice_id_div",e.notice_id)),$(t).removeClass("was-validated"),$(t).find(".btn-spinning").removeClass("btn-spinning"),$(t).find(".ld-spin").remove())},error:function(e,t){;"Unexpected error"}})}})),$(document).on("click",".notice-delete",(function(e){e.preventDefault();var t=$(this).parents("form:first"),i=$("[name='id']",t).val(),n="<p>Are you sure you wish to delete this notice?</p>";$("[name='message']",t).val()&&(n+='<p class="'+($("[name='alert_css']",t).val()?$("[name='alert_css']",t).val():"alert")+'">'+$("[name='message']",t).val()+"</p>"),bootbox.confirm({message:n,callback:function(e){e&&(i.startsWith("new-")?$('[data-notice_id_div="'+i+'"]').slideUp("normal",(function(){$(this).remove()})):$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_manage_site_notice",op:"delete_site_notice",notice_id:i},success:function(e){e.processor_success&&($('[data-notice_id_div="'+i+'"]').slideUp("normal",(function(){$(this).remove()})),$(".btn-spinning").removeClass("btn-spinning"),$(".ld-spin").remove())},error:function(e,t){;"Unexpected error"}}))}})}))}();
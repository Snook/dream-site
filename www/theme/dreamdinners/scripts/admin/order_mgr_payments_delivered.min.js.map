{"version":3,"file":"order_mgr_payments_delivered.min.js","names":["originalMaxPPDeduction","selectedFreeMenuItem","couponFreeMenuItemRequired","handle_ltd_round_up","$","prop","orderState","is","GUEST_PREFERENCES","user_id","LTD_AUTO_ROUND_UP","value","orderInfo","ltd_round_up_value","attr","val","trigger","on","e","this","cookie","session_id","dd_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","div_id","confirm","remove","set_user_pref","index","buttons","Yes","No","calculateTotal","round_up_val","text","formatAsMoney","slideDown","slideUp","handleCouponCodeResult","json","validation_errors","anError","printString","html","show","coupon_code_discount_total","code_id","discount_method","entree_title","entree_servings","handleFreeMenuItem","coupon_obj","coupon_code","createBonusCredit","coupon","couponDiscountMethod","couponDiscountVar","discount_var","couponlimitedToFT","limit_to_finishing_touch","couponIsValidWithReferralCredit","valid_with_customer_referral_credit","couponIsValidWithPlatePoints","valid_with_plate_points_credits","maxPPDeduction","processCode","code","theForm","get","filterBundle","bundleBox","document","getElementById","checked","parameters","i","elements","length","name","STORE_DETAILS","id","d","Date","ajax","url","type","timeout","dataType","data","processor","op","org_ts","order_id","unique","getTime","order_state","params","success","processor_success","processor_message","error","objAJAXRequest","strError","response","removeCode","removeBonusCredit","couponFreeMenuItem","handle_free_menu_item_edit","menu_item_count","buildFreeMenuItemList","menu_item","price","expression","rebuildOrderItemsArray","menu_item_in_list","selected_menu_item_in_list","s","appendTo","each","orderItems","eval","item_title","stripLeadingZeroes","leadingZeroCount","retVal","len","slice","handlePlatePointsDiscount","isNaN","needPlatePointsMaxDiscountChangeWarning","Math","abs","maxPPCredit","cap","editCashCheckAmount","editCashCheckUpdate","new_total","Number","getGiftCardBalance","card_number","output","card_balance","request_uri","editCashCheckAmountCommit","alert","new_number","PATH","image_admin","fadeOut","showButtonProcessDelayedPaymentNow","PendingDPOriginalStatus","processPayment","order_number","credit_card_number","substr","transaction_id","transaction_date","payment_id","css","color","summary_date","canAdjustDelayedPayment","back_path","setDelayedPaymentStatusTo","PendingDPOriginalTransActionID","toLowerCase","setupCouponState","style","display","disabled","processDelayedPaymentStatus","old_status","new_status","store_id","status","canAutoAdjust","src","alt","pointToTransaction","processPointToTransaction","old_ref_number","new_ref_number","new_card_number","transactionid","new_card_type","unsetAutoAdjust","setAllPaymentFieldsToUnrequired","reqField","setAttribute","lastPayment1Type","changePayment1","mySelect","divGC","divCash","divRefundCash","divCheck","divCC","divCredit","divRef","divRefOther","refundDiv","dpAdjust","divDebitGiftCard","payment2","selected_ref","resetPendingDelayedPayment","amount","changePayment2","onPaymentSelected","balance","innerHTML","paymentsTotal","paySel","autoAdjBox","forceManualAutoAdjust","handleAutoAdjust","adjustPendingDelayedPayment","externalPaymentAmountArray","onPaymentDeselected","reportPaymentStatus","valueOf","divref2","selectedItem","validateRefTrans","field","limit","payAmountChange","org_dp_amount","adjVal","adjustmentAmount","getPendingDPAdjustment","adj_dp_amount","assignBalanceToRefTransactions","paymentCount","prefix","ident","existingPaymentAmountArray","amountCredit","maxStoreCredit","refTransField","remainingFundsThisPayment","current_refunded_amount","thisAmount","storeCreditAmountChange","storeCreditClick","obj","amountElem","balance_elem","updateChangeList","ignorePayment2","paySelElem","pay1Amount","DirCreditCCAmount","pay2Amount","paySel2","storeCreditRefundElem","returnToStoreCredit","cashRefund","CreditCCAmount","diff","PenndingDPAdjustment","removeClass","addClass","toggle","el","target_prefix","scanPosition","charIndex","codes","keyHandler2","evt","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","onkeypress","OMDefaultKeyHandler","prepareForCCSwipe","paymentNumber","focus","receivedText","join","p","SwipeParserObj","card_type","dump","test","account","firstname","surname","exp_month","exp_year"],"sourceRoot":"js/src/dreamdinners/admin","sources":["order_mgr_payments_delivered.js"],"sourcesContent":["var originalMaxPPDeduction = 0;\nvar selectedFreeMenuItem;\nvar couponFreeMenuItemRequired = false;\n\nfunction handle_ltd_round_up()\n{\n\t$('#add_ltd_round_up').prop('disabled', false);\n\n\tif (orderState == 'SAVED' && !$('#add_ltd_round_up').is(':checked') && GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value > 0 && orderInfo.ltd_round_up_value == '')\n\t{\n\t\t$('#add_ltd_round_up').prop('checked', true);\n\n\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == 1)\n\t\t{\n\t\t\t$(\"#ltd_round_up_select option[id='round_up_nearest_dollar']\").attr(\"selected\", \"selected\");\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger('change');\n\t\t}\n\t}\n\telse if ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\t$('#ltd_round_up_select').prop('disabled', false);\n\t}\n\n\t$('#add_ltd_round_up').on('change', function (e)\n\t{\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\n\t\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != user_id + '.' + session_id))\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\tmessage: 'Would <span style=\"font-weight: bold; color: red;\">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style=\"font-weight: bold;\">My Preferences</span>.<div style=\"text-align: center; margin-top: 10px;\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option></select></div>',\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\topen: function (event, ui)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\n\t\t\t\t\t\tvar rup_dialog = $(this);\n\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e)\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\n\n\t\t\t\t\t\t\tif (rup_value > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\n\t\t\t\t\t\t\t\t\tconfirm: function ()\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\n\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value, user_id);\n\n\t\t\t\t\t\t\t\t\t\tif (orderInfo.ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use the selected Round Up value on this order?',\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function ()\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function ()\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"No\": function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0, user_id);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"Ask Again Later\": function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t\t\t$.cookie('ltdru', user_id + '.' + session_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\n\t\t}\n\n\t\t$('#ltd_round_up_select').trigger('change');\n\n\t\tcalculateTotal();\n\t});\n\n\t$('#ltd_round_up_select').on('change', function (e)\n\t{\n\n\t\tvar round_up_val = $(this).val();\n\n\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\n\n\t\tif ($('#add_ltd_round_up').is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_div').slideDown();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_div').slideUp();\n\n\t\t\tround_up_val = 0;\n\t\t}\n\n\t\t/*\n\n\t\t $.ajax({\n\t\t url: '/processor',\n\t\t type: 'POST',\n\t\t timeout: 20000,\n\t\t dataType: 'json',\n\t\t data: {\n\t\t processor: 'cart_add_payment',\n\t\t payment_type: 'ltd_round_up',\n\t\t ltd_round_up_value: round_up_val\n\t\t },\n\t\t success: function (json)\n\t\t {\n\t\t if (json.processor_success)\n\t\t {\n\n\t\t }\n\t\t else\n\t\t {\n\t\t dd_message({\n\t\t title: 'Error',\n\t\t message: json.processor_message\n\t\t });\n\t\t }\n\t\t },\n\t\t error: function (objAJAXRequest, strError)\n\t\t {\n\t\t dd_message({\n\t\t title: 'Error',\n\t\t message: 'Unexpected error: ' + strError\n\t\t });\n\t\t }\n\t\t });\n\n\t\t */\n\n\t\tcalculateTotal();\n\t});\n\n\tcalculateTotal();\n}\n\n\n\nfunction handleCouponCodeResult(json)\n{\n\tif (json.validation_errors)\n\t{\n\t\tprintString = \"\";\n\t\tfor (anError in json.validation_errors)\n\t\t{\n\t\t\tif (json.validation_errors[anError] != \"\" && json.validation_errors[anError] != null)\n\t\t\t{\n\t\t\t\tprintString += json.validation_errors[anError] + \"<br />\";\n\t\t\t}\n\t\t}\n\n\t\t$(\"#coupon_error\").html(printString);\n\t\t$(\"#coupon_error\").show();\n\t\t$('#couponCodeSubmitter').show();\n\t\t$('#proc_mess').hide();\n\t}\n\telse\n\t{\n\t\t$(\"#coupon_error\").hide();\n\t\t$(\"#coupon_error\").html(\"\");\n\n\t\t$('#proc_mess').hide();\n\t\t$('#couponDeleter').show();\n\t\t$('#coupon_code').prop('disabled', true);\n\n\t\t$(\"#couponValue\").val(json.coupon_code_discount_total);\n\t\t$(\"#coupon_id\").val(json.code_id);\n\n\t\t$(\"#coupon_type\").val(json.discount_method);\n\n\t\tif (json.discount_method == \"FREE_MEAL\")\n\t\t{\n\t\t\t$('#coupon_free_meal_row').show();\n\t\t\t$(\"#free_entree\").html(json.entree_title);\n\t\t\t$('#free_entree_servings').val(json.entree_servings);\n\t\t}\n\t\telse if (json.discount_method == \"FREE_MENU_ITEM\")\n\t\t{\n\t\t\thandleFreeMenuItem(json.coupon_obj.coupon_code);\n\t\t}\n\t\telse if (json.discount_method == \"BONUS_CREDIT\")\n\t\t{\n\t\t\tcreateBonusCredit(0);\n\t\t}\n\n\t\tcoupon = json.coupon;\n\t\tcouponDiscountMethod = json.discount_method;\n\t\tcouponDiscountVar = json.discount_var;\n\t\tcouponlimitedToFT = json.limit_to_finishing_touch;\n\t\tcouponIsValidWithReferralCredit = json.valid_with_customer_referral_credit;\n\t\tcouponIsValidWithPlatePoints = json.valid_with_plate_points_credits;\n\t\tcouponFreeMenuItemRequired = true;\n\n\t\tif (couponlimitedToFT)\n\t\t{\n\t\t\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\n\t\t\toriginalMaxPPDeduction = maxPPDeduction;\n\n\t\t\tmaxPPDeduction -= json.coupon_code_discount_total;\n\t\t\tif (maxPPDeduction < 0)\n\t\t\t{\n\t\t\t\tmaxPPDeduction = 0;\n\t\t\t}\n\n\t\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(maxPPDeduction));\n\t\t}\n\n\t\tcalculateTotal();\n\t}\n\n}\n\nfunction processCode()\n{\n\n\tvar code = $(\"#coupon_code\").val();\n\t$(\"#couponCodeSubmitter\").hide();\n\n\tvar theForm = $('#editorForm').get()[0];\n\n\tvar filterBundle = false;\n\tvar bundleBox = document.getElementById('selectedBundle');\n\tif (bundleBox && !bundleBox.checked)\n\t{\n\t\tfilterBundle = true;\n\t}\n\n\tvar parameters = \"\";\n\tfor (i = 0; i < theForm.elements.length; i++)\n\t{\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\n\t\t{\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\n\t\t\tif (i + 1 != theForm.elements.length)\n\t\t\t{\n\t\t\t\tparameters += \"&\";\n\t\t\t}\n\t\t}\n\t}\n\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\n\n\tvar d = new Date();\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessorDelivered',\n\t\t\tuser_id: user_id,\n\t\t\top: 'add',\n\t\t\torg_ts: 'org_order_time',\n\t\t\torder_id: order_id,\n\t\t\tunique: d.getTime(),\n\t\t\tcoupon_code: code,\n\t\t\torder_state: orderState,\n\t\t\tparams: parameters\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\thandleCouponCodeResult(json);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction removeCode()\n{\n\tvar theForm = $('#editorForm').get()[0];\n\n\tvar filterBundle = false;\n\tvar bundleBox = document.getElementById('selectedBundle');\n\tif (bundleBox && !bundleBox.checked)\n\t{\n\t\tfilterBundle = true;\n\t}\n\n\tvar parameters = \"\";\n\tfor (i = 0; i < theForm.elements.length; i++)\n\t{\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\n\t\t{\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\n\t\t\tif (i + 1 != theForm.elements[i])\n\t\t\t{\n\t\t\t\tparameters += \"&\";\n\t\t\t}\n\t\t}\n\t}\n\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\n\n\tvar d = new Date();\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessorDelivered',\n\t\t\top: 'remove',\n\t\t\tuser_id: user_id,\n\t\t\torg_ts: 'org_order_time',\n\t\t\torder_id: order_id,\n\t\t\tunique: d.getTime(),\n\t\t\torder_state: orderState,\n\t\t\tparams: parameters\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif ($(\"#coupon_type\").val() == \"BONUS_CREDIT\")\n\t\t\t{\n\t\t\t\tremoveBonusCredit();\n\t\t\t}\n\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\t\t\t$('#couponDeleter').hide();\n\t\t\t$('#coupon_code').prop('disabled', false);\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#couponValue\").val(0);\n\t\t\t$('#coupon_free_meal_row').hide();\n\t\t\t$(\"#free_entree\").html(\"\");\n\t\t\t$(\"#coupon_id\").val(\"\");\n\t\t\t$(\"#coupon_type\").val(\"\");\n\n\t\t\t$('#coupon_select_free_menu_item_row').hide();\n\t\t\t$('#free_menu_item_coupon option:not([value])').attr('data-dd_required', false);\n\t\t\tcouponFreeMenuItem = false;\n\t\t\tcouponFreeMenuItemRequired = false;\n\n\t\t\tcouponDiscountMethod = 'NONE';\n\t\t\tcouponDiscountVar = 0;\n\t\t\tcouponlimitedToFT = false;\n\t\t\tcouponIsValidWithPlatePoints = true;\n\n\t\t\tcalculateTotal();\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n\n}\n\nfunction handle_free_menu_item_edit()\n{\n\tif (couponFreeMenuItem)\n\t{\n\t\thandleFreeMenuItem($('#coupon_code').val());\n\t}\n}\n\nfunction handleFreeMenuItem(coupon_code)\n{\n\tvar menu_item_count = 0;\n\n\tif (coupon_code == 'SRDessert')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9\");\n\t}\n\telse if (coupon_code == 'SRDinner')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'\");\n\t}\n\telse if (coupon_code == 'CC3RDFREE')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00\");\n\t}\n\telse if (coupon_code == 'SCFinishingTouch')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9 && menu_item.price <= 15.00\");\n\t}\n\telse if (coupon_code == 'HCFastLane')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'\");\n\t}\n\telse if (coupon_code == 'SCFriendDinner')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' && menu_item.intro_item == true\");\n\t}\n\n\tif (menu_item_count > 0)\n\t{\n\t\t$('#coupon_select_free_menu_item_row').show();\n\n\t\t$('#free_menu_item_coupon').attr('data-dd_required', true).on('change', function (e)\n\t\t{\n\t\t\tvar menu_item = $(this).find(':selected').data('menu_item');\n\t\t\tvar price = $(this).find(':selected').data('price');\n\n\t\t\t$('#couponValue').val(price);\n\t\t\tselectedFreeMenuItem = menu_item;\n\n\t\t\tcalculateTotal();\n\t\t});\n\t}\n\telse\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'No valid free items found in cart for this coupon, please add the desired item and then submit the coupon.'\n\t\t});\n\n\t\tremoveCode();\n\t}\n}\n\nfunction buildFreeMenuItemList(expression)\n{\n\trebuildOrderItemsArray();\n\n\tvar menu_item_in_list = false;\n\tvar selected_menu_item_in_list = false; // temp store, used for tab switching\n\tvar menu_item_count = 0;\n\n\t// setup efl free item select\n\tvar s = $('#free_menu_item_coupon').html('').attr('disabled', ((couponFreeMenuItem) ? true : false));\n\n\t$(\"<option />\").val('').text('Select Free Item').appendTo(s);\n\n\t$.each(orderItems, function (index, menu_item)\n\t{\n\t\tif (!menu_item_in_list)\n\t\t{\n\t\t\tmenu_item_in_list = ((couponFreeMenuItem == menu_item.id) ? true : false);\n\t\t}\n\n\t\tif (!selected_menu_item_in_list)\n\t\t{\n\t\t\tselected_menu_item_in_list = ((selectedFreeMenuItem == menu_item.id) ? true : false);\n\t\t}\n\n\t\tif (eval(expression))\n\t\t{\n\t\t\tmenu_item_count++;\n\n\t\t\t$(\"<option />\")\n\t\t\t\t.val(menu_item.id)\n\t\t\t\t.attr('data-menu_item', menu_item.id)\n\t\t\t\t.attr('data-price', menu_item.price)\n\t\t\t\t.attr('selected', ((couponFreeMenuItem == menu_item.id || selectedFreeMenuItem == menu_item.id) ? true : false))\n\t\t\t\t.text(menu_item.item_title + ' (' + menu_item.price + ')').appendTo(s);\n\t\t}\n\t});\n\n\tif (!menu_item_in_list)\n\t{\n\t\t$('#couponValue').val('0.00');\n\n\t\t$('#free_menu_item_coupon').attr('disabled', false);\n\t}\n\n\tcalculateTotal();\n\n\treturn menu_item_count;\n}\n\nfunction stripLeadingZeroes(val)\n{\n\tvar leadingZeroCount = 0;\n\tvar retVal = val;\n\n\tfor (var i = 0, len = val.length; i < len; i++)\n\t{\n\t\tif (val[i] != '0')\n\t\t{\n\t\t\tbreak;\n\t\t}\n\n\t\tleadingZeroCount++;\n\t}\n\n\tif (leadingZeroCount > 0)\n\t{\n\t\tretVal = val.slice(leadingZeroCount)\n\t}\n\n\treturn retVal;\n\n}\n\nfunction handlePlatePointsDiscount(val)\n{\n\tif (!couponIsValidWithPlatePoints)\n\t{\n\t\tdocument.getElementById('plate_points_discount').value = formatAsMoney(0);\n\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'PLATEPOINTS cannot be used with the attached coupon.'\n\t\t});\n\n\t}\n\n\tif ((isNaN(val) || val <= 0) && val != \".\")\n\t{\n\t\t$('#plate_points_discount').val(\"0\");\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(0));\n\t\tcalculateTotal();\n\t\treturn;\n\t}\n\n\tneedPlatePointsMaxDiscountChangeWarning = false;\n\n\tval = formatAsMoney(Math.abs(val)) * 1;\n\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\n\n\tif (maxPPDeduction < curPPDiscount)\n\t{\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\n\t}\n\n\tif (maxPPCredit > maxPPDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tvar cap = maxPPCredit;\n\tif (cap > maxPPDeduction)\n\t{\n\t\tcap = maxPPDeduction;\n\t}\n\n\tif (val > cap)\n\t{\n\t\tval = cap;\n\t\t$('#plate_points_discount').val(val);\n\n\t}\n\n\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(val));\n\n\n\tcalculateTotal();\n}\n\nfunction editCashCheckAmount(id, type)\n{\n\t// Show input form\n\t$('#check_total_input_' + id).show();\n\t$('#check_payment_number_input_' + id).show();\n\t// Hide edit link and text\n\t$('#check_total_' + id).hide();\n\t$('#check_payment_number_' + id).hide();\n\t$('#check_editlink_' + id).hide();\n}\n\nfunction editCashCheckUpdate(id, type)\n{\n\t$('#payment_sum_value_' + id).html($('#check_total_input_form_' + id).val());\n\t$('#payment_sum_name_' + id).html('Check (#' + $('#check_payment_number_input_form_' + id).val() + ')');\n\n\t// Loop through payment summary to get new total\n\tnew_total = 0;\n\t$('[id^=\"payment_sum_value_\"]').each(function (index)\n\t{\n\t\tnew_total = new_total + Number($(this).text());\n\t});\n\n\t// loop through and subtract refunds\n\t$('[id^=\"refund_payment_sum_value_\"]').each(function (index)\n\t{\n\t\tnew_total = new_total - Number($(this).text());\n\t});\n\n\t$('#OEH_paymentsTotal').html(formatAsMoney(new_total));\n\n\tcalculateTotal();\n}\n\n// Check cift card balance\nfunction getGiftCardBalance()\n{\n\t$('#gc_proc_anim').show();\n\t$('#balance_target').hide();\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'giftCardBalance',\n\t\t\tcard_number: $('#debit_gift_card_number').val(),\n\t\t\toutput: 'json'\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html(json.card_balance);\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + request_uri + '\">[login]</a> again.</span>');\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#balance_target').show();\n\t\t\t$('#balance_target').html('Error: ' + strError + '. Please <a href=\"javascript:getGiftCardBalance();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\nfunction editCashCheckAmountCommit(id, type)\n{\n\talert(\"You are only modifying the \" + type + \" details.\\nNo other modifications will be made.\");\n\n\t$('#check_total_mess_' + id).hide();\n\tnew_total = $('#check_total_input_form_' + id).val();\n\tnew_number = $('#check_payment_number_input_form_' + id).val();\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_editCashCheckAmount',\n\t\t\tid: id,\n\t\t\ttype: type,\n\t\t\tnew_total: new_total,\n\t\t\tnew_number: new_number,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t// Hide input form\n\t\t\t\t$('#check_total_input_' + id).hide();\n\t\t\t\t$('#check_payment_number_input_' + id).hide();\n\t\t\t\t// Show edit link and text\n\t\t\t\t$('#check_total_' + id).show();\n\t\t\t\t$('#check_payment_number_' + id).show();\n\t\t\t\t$('#check_editlink_' + id).show();\n\n\t\t\t\t// Update page text with new values\n\t\t\t\t$('#check_total_' + id).html(new_total);\n\t\t\t\t$('#check_payment_number_' + id).html(new_number);\n\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).show().html('<img src=\"' + PATH.image_admin + '/icon/accept.png\" alt=\"Accept\" />').fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + +'\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">' + json.processor_message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t$('#check_total_mess_' + id).html('Error: ' + strError + '. Please <a href=\"javascript:editCashCheckAmountCommit(' + id + ',\\'' + type + '\\');\">[try again]</a>.');\n\t\t}\n\t});\n\n}\n\n// Proccess delayed payment now\nfunction showButtonProcessDelayedPaymentNow(message)\n{\n\tif (PendingDPOriginalStatus == 'PENDING')\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"process_payment\" value=\"Process delayed payment now\" onclick=\"processPayment();\">');\n\t}\n\telse if (message)\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html(message);\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').hide();\n\t}\n}\n\nfunction processPayment()\n{\n\tif (confirm(\"Are you sure you wish to process the delayed payment now? Click OK to process.\"))\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 60000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_delayedPaymentProcessor',\n\t\t\t\torder_number: order_id\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\tif (json.success)\n\t\t\t\t{\n\t\t\t\t\tif ($('#point_to_transaction').length)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar credit_card_number = $('#point_to_transaction option:selected').text();\n\t\t\t\t\t\t$('#cc_payment_number_other').html('XXXXXXXXXXXX' + credit_card_number.substr(-4));\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#cc_delayed_tran_num_other').html(json.transaction_id);\n\t\t\t\t\t$('#cc_delayed_date_other').html(json.transaction_date);\n\t\t\t\t\t$('#cc_delayed_status_other').html('Status: Payment Processed');\n\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'color': ''});\n\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).html(json.summary_date);\n\n\t\t\t\t\tcanAdjustDelayedPayment = false;\n\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:green;font-weight:bold;\">Payment Processed.</span>').fadeOut(4000);\n\t\t\t\t}\n\t\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t\t{\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').show();\n\t\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPayment();\">[try again]</a>.');\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Change delayed payment status\nfunction setDelayedPaymentStatusTo()\n{\n\t//Do not allow the user to reset to FAIL\n\tif ($('#change_delayed_payment_status').val() == 'FAIL' && PendingDPOriginalStatus != 'FAIL')\n\t{\n\t\talert('Can not change transaction back to Fail. Please choose pending or canceled.');\n\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\t\treturn false;\n\t}\n\t// Reset transaction id dropdown, can only set the status of one dropdown a time.\n\tif ($('#change_delayed_payment_status'))\n\t{\n\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\t}\n\n\tif ($('#change_delayed_payment_status').val() == PendingDPOriginalStatus)\n\t{\n\t\tshowButtonProcessDelayedPaymentNow();\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"set_delayed_payment_status\" value=\"Set delayed payment status to ' + $('#change_delayed_payment_status').val().toLowerCase() + '\" onClick=\"processDelayedPaymentStatus();\">');\n\t}\n}\n\nfunction setupCouponState()\n{\n\t// if a coupon is attached we need to update the UI\n\t// 1) set up the coupon code box - disabled with code\n\tif (coupon)\n\t{\n\t\tdocument.getElementById('couponCodeSubmitter').style.display = \"none\";\n\t\tdocument.getElementById('couponDeleter').style.display = \"inline\";\n\t\tdocument.getElementById('coupon_code').value = coupon.coupon_code;\n\t\tdocument.getElementById('coupon_code').disabled = true;\n\t}\n}\n\nfunction processDelayedPaymentStatus()\n{\n\t$('#payment_proc_mess').show();\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_delayedPaymentStatusProcessor',\n\t\t\torder_number: order_id,\n\t\t\told_status: PendingDPOriginalStatus,\n\t\t\tnew_status: $('#change_delayed_payment_status').val(),\n\t\t\tstore_id: store_id\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.success)\n\t\t\t{\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\n\t\t\t\tPendingDPOriginalStatus = json.status;\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\t\t\t\t// Reset transaction id dropdown, only set one at a time.\n\t\t\t\tif ($('#change_delayed_payment_status'))\n\t\t\t\t{\n\t\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\t\t\t\t}\n\n\t\t\t\t// Voodoo, editing cash/check totals element id payment_sum_value_*, so change\n\t\t\t\t// element id to cancelled_payment_sum_value_* which will be skipped over in the total caclulation.\n\t\t\t\tif (json.status == 'CANCELLED' && $('#payment_sum_value_' + json.payment_id))\n\t\t\t\t{\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).attr('id', 'cancelled_payment_sum_value_' + json.payment_id);\n\t\t\t\t}\n\t\t\t\telse if (json.status == 'PENDING' && $('#cancelled_payment_sum_value_' + json.payment_id))\n\t\t\t\t{\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).attr('id', 'payment_sum_value_' + json.payment_id);\n\t\t\t\t}\n\n\t\t\t\t// Update payment status and details\n\t\t\t\tif (json.status == 'CANCELLED')\n\t\t\t\t{\n\t\t\t\t\t// Can only adjust pending payments\n\t\t\t\t\tcanAdjustDelayedPayment = false;\n\n\t\t\t\t\t// Update summary rows\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) - Number($('#cancelled_payment_sum_value_' + json.payment_id).html())));\n\n\t\t\t\t\t// Reset new payment if they have auto adjust selected\n\t\t\t\t\t$('#dp_adjust_div').hide();\n\t\t\t\t\t//\t$('#autoAdjust').attr({ 'checked' : 'checked' });\n\t\t\t\t\t//\thandleAutoAdjust($('#autoAdjust'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t// Payment pending, we are allowed to edit it\n\t\t\t\t\tcanAdjustDelayedPayment = true;\n\n\t\t\t\t\t// Update summary rows\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) + Number($('#payment_sum_value_' + json.payment_id).html())));\n\n\t\t\t\t\t// Allow auto adjust to be used\n\t\t\t\t\tcanAutoAdjust = true;\n\t\t\t\t}\n\n\t\t\t\tcalculateTotal();\n\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Delayed Payment set to ' + PendingDPOriginalStatus + '.</span>');\n\t\t\t\t$('#change_delayed_payment_status_img').attr({\n\t\t\t\t\tsrc: PATH.image_admin + '/icon/accept.png',\n\t\t\t\t\talt: 'Accept'\n\t\t\t\t});\n\t\t\t\t$('#change_delayed_payment_status_img').css({display: 'inline'}).fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#payment_proc_mess').show();\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processDelayedPaymentStatus();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\n// Point to new transaction ID\nfunction pointToTransaction()\n{\n\t// Reset payment status dropdown, only set one at a time.\n\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\tif ($('#point_to_transaction').val() == PendingDPOriginalTransActionID)\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\tshowButtonProcessDelayedPaymentNow();\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"point_to_payment\" value=\"Point payment to selected Credit Card Number\" onClick=\"processPointToTransaction();\">');\n\t}\n}\n\nfunction processPointToTransaction()\n{\n\t$('#payment_proc_mess').show();\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_processPointToTransaction',\n\t\t\torder_number: order_id,\n\t\t\tstore_id: store_id,\n\t\t\told_ref_number: PendingDPOriginalTransActionID,\n\t\t\tnew_ref_number: $('#point_to_transaction').val(),\n\t\t\tnew_card_number: $('#point_to_transaction option:selected').text()\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.success)\n\t\t\t{\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\n\t\t\t\tPendingDPOriginalTransActionID = json.transactionid;\n\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\n\t\t\t\t// Reset payment status dropdown, only set one at a time.\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\t\t\t\t$('#payment_sum_type_' + json.payment_id).html(json.new_card_type);\n\t\t\t\t$('#payment_sum_name_' + json.payment_id).html('Delayed CC Payment (#' + json.new_card_number + ')');\n\n\t\t\t\t$('#cc_credit_card_type_other').html(json.new_card_type);\n\t\t\t\t$('#cc_payment_transaction_number_other').html(json.transactionid);\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Credit card set to ' + json.new_card_type + '.</span>');\n\t\t\t\t$('#point_to_transaction_img').css({display: 'inline'}).fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#payment_proc_mess').show();\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPointToTransaction();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\nfunction unsetAutoAdjust()\n{\n\tif ($('#autoAdjust').length)\n\t{\n\t\tdocument.getElementById('autoAdjust').checked = false;\n\t}\n}\n\nfunction setAllPaymentFieldsToUnrequired()\n{\n\tvar reqField;\n\n\treqField = document.getElementById('payment1_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment1_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_reference_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment2_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment2_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('debit_gift_card_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n}\n\nvar lastPayment1Type = false;\n\nfunction changePayment1(mySelect)\n{\n\n\tif (lastPayment1Type && lastPayment1Type != mySelect)\n\t{\n\t\tif (lastPayment1Type == 'CC')\n\t\t{\n\t\t\t$('#payment1_gc_total_amount').val(\"\");\n\t\t}\n\t\telse if (lastPayment1Type == 'REFERENCE')\n\t\t{\n\t\t\t$('#payment1_reference_total_amount').val(\"\");\n\t\t}\n\n\t}\n\n\tlastPayment1Type = mySelect;\n\n\tvar divGC = document.getElementById('payment1_gc');\n\tvar divCash = document.getElementById('payment1_cash');\n\tvar divRefundCash = document.getElementById('payment1_refund_cash');\n\tvar divCheck = document.getElementById('payment1_check');\n\tvar divCC = document.getElementById('payment1_cc');\n\tvar divCredit = document.getElementById('payment1_credit');\n\tvar divRef = document.getElementById('payment1_reference');\n\tvar divRefOther = document.getElementById('payment1_ref');\n\tvar refundDiv = document.getElementById('payment1RefundCCDiv');\n\n\tvar dpAdjust = document.getElementById('dp_adjust_div'); // can be null\n\n\tdocument.getElementById('new_payments_total').value = 0;\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t{\n\t\tdocument.getElementById('new_payments_total').value = formatAsMoney(document.getElementById('store_credits_amount').value);\n\t}\n\n\tvar divDebitGiftCard = document.getElementById('payment1_debit_gift_card');\n\n\tvar payment2 = document.getElementById('payment2');\n\n\tvar selected_ref = false;\n\tif (mySelect.substr(0, 4) == 'REF_')\n\t{\n\t\tselected_ref = mySelect.substr(4);\n\t\tmySelect = 'REFERENCE_OTHER';\n\t}\n\n\tresetPendingDelayedPayment();\n\n\t// reset so validation does not fail when using payment types other than CC\n\tvar amount = document.getElementById('payment1_cc_total_amount');\n\tamount.value = '';\n\n\tvar reqField;\n\treqField = document.getElementById('payment1_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_reference_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\tswitch (mySelect)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivRef.style.display = 'block';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\n\t\t\tif (dpAdjust && canAdjustDelayedPayment)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t\tunsetAutoAdjust();\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_reference_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'block';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\n\t\t\tif (orderState != 'ACTIVE')\n\t\t\t{\n\t\t\t\tpayment2.style.display = 'block';\n\t\t\t}\n\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_gc_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_gc_payment_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tunsetAutoAdjust();\n\t\t\tdivGC.style.display = 'none';\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivCash.style.display = 'block';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tif (orderState == 'ACTIVE')\n\t\t\t{\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\n\t\t\t\tamount.value = formatAsMoney(0);\n\t\t\t}\n\n\t\t\treqField = document.getElementById('payment1_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_cash_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'block';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'block';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tamount = document.getElementById('payment1_check_total_amount');\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\n\t\t\treqField = document.getElementById('payment1_check_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_check_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\trefundDiv.style.display = 'none';\n\n\t\t\tpaymentsTotal = Number(document.getElementById('OEH_paymentsTotal').innerHTML);\n\n\t\t\tif (paymentsTotal != 0)\n\t\t\t{\n\t\t\t\talert(\"'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away.\");\n\t\t\t\tpaySel = document.getElementById('payment1_type');\n\t\t\t\tpaySel.value = '';\n\t\t\t\tchangePayment1('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tunsetAutoAdjust();\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'block';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'block';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tamount = document.getElementById('payment1_cc_total_amount');\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\n\t\t\treqField = document.getElementById('payment1_ccNameOnCard');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccNumber');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_cc_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccType');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccMonth');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccYear');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'block';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('debit_gift_card_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('debit_gift_card_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tif (orderState != 'ACTIVE')\n\t\t\t{\n\t\t\t\tpayment2.style.display = 'block';\n\t\t\t}\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"DPADJUST\":\n\t\t\tif (!dpAdjust)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t} // should never happen\n\n\t\t\tif (!canAdjustDelayedPayment)\n\t\t\t{\n\t\t\t\talert('Can not adjust delayed payment.\\n\\nDelayed payment status: ' + PendingDPOriginalStatus);\n\t\t\t\tautoAdjBox = document.getElementById('autoAdjust');\n\t\t\t\tif (!forceManualAutoAdjust)\n\t\t\t\t{\n\t\t\t\t\tautoAdjBox.checked = true;\n\t\t\t\t\thandleAutoAdjust(autoAdjBox);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdpAdjust.style.display = 'block';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\tbalance = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\tadjustPendingDelayedPayment(balance);\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'block';\n\n\t\t\tdocument.getElementById('p1_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\n\t\t\tdocument.getElementById('p1_ref_id').innerHTML = selected_ref;\n\n\t\t\treqField = document.getElementById('payment1_ref_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\t\treqField.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\t}\n\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\t\tcase 'CC_REFUND':\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'block';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\n\t\t\tresetPendingDelayedPayment();\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\n\t\t\tonPaymentDeselected();\n\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction changePayment2(mySelect)\n{\n\n\treportPaymentStatus(true);\n\n\tvar textBal = $(\"#bal_due\").html();\n\tvar balance = Number($(\"#bal_due\").html());\n\tif (isNaN(balance.valueOf()))\n\t{\n\t\tbalance = \"\";\n\t}\n\tif (balance.valueOf() == 0)\n\t{\n\t\tbalance = \"\";\n\t}\n\n\tvar divCash = document.getElementById('payment2_cash');\n\tvar divRefundCash = document.getElementById('payment2_refund)_cash');\n\tvar divCheck = document.getElementById('payment2_check');\n\tvar divCC = document.getElementById('payment2_cc');\n\tvar divref2 = document.getElementById('payment2_ref');\n\n\tvar reqField;\n\n\treqField = document.getElementById('payment2_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\tvar selected_ref = false;\n\tif (mySelect.substr(0, 4) == 'REF_')\n\t{\n\t\tselected_ref = mySelect.substr(4);\n\t\tmySelect = 'REFERENCE_OTHER';\n\t}\n\n\tswitch (mySelect)\n\t{\n\t\tcase \"CASH\":\n\t\t\tdivCash.style.display = 'block';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_cash_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'block';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_check_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_check_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'block';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_ccNameOnCard');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccNumber');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccType');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccMonth');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccYear');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_cc_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'block';\n\n\t\t\tdocument.getElementById('p2_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\n\t\t\tdocument.getElementById('p2_ref_id').innerHTML = selected_ref;\n\n\t\t\treqField = document.getElementById('payment2_ref_total_amount');\n\n\t\t\t$(\"#payment2_ref_total_amount\").val(balance);\n\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\treqField = document.getElementById('payment2_type');\n\t\t\treqField.selectedItem = 0;\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction validateRefTrans(field, limit)\n{\n\tif (field.value > limit)\n\t{\n\t\talert('Limited to ' + limit + '.');\n\t\tfield.value = limit;\n\t}\n\n\tif (field.value < 0)\n\t{\n\t\talert('Must be a positive number.');\n\t\tfield.value = 0;\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction payAmountChange(value)\n{\n\treportPaymentStatus(false);\n}\n\nfunction resetPendingDelayedPayment(balance)\n{\n\tvar idElem = document.getElementById('PendingDP');\n\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(org_dp_amount);\n\n\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(org_dp_amount);\n\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(0);\n\n\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(org_dp_amount);\n\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(0);\n\n\t}\n\n}\n\nfunction adjustPendingDelayedPayment(balance)\n{\n\tvar idElem = document.getElementById('PendingDP');\n\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\n\t\tvar adjVal = org_dp_amount + (balance * 1);\n\t\tif (adjVal < 0)\n\t\t{\n\t\t\tbalance = adjVal * -1;\n\t\t\tadjVal = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbalance = 0;\n\t\t}\n\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(adjVal);\n\t\tvar adjustmentAmount = getPendingDPAdjustment();\n\n\t\tif (adjustmentAmount > 0)\n\t\t{\n\t\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(adjVal);\n\t\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(adjustmentAmount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(adjVal);\n\t\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(adjustmentAmount * -1);\n\t\t}\n\n\t\treturn balance;\n\t}\n\telse\n\t{\n\t\treturn balance;\n\t}\n\n}\n\nfunction getPendingDPAdjustment()\n{\n\tvar idElem = document.getElementById('PendingDP');\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\t\tvar adj_dp_amount = Number(document.getElementById('PendingDPAmount').value);\n\t\treturn formatAsMoney(adj_dp_amount - org_dp_amount);\n\t}\n\telse\n\t{\n\t\treturn 0;\n\t}\n\n\treturn 0;\n\n}\n\nfunction assignBalanceToRefTransactions(balance)\n{\n\tvar paymentCount = 0;\n\n\tvar prefix = 'RT_';\n\tif (balance < 0)\n\t{\n\t\tprefix = 'Cr_RT_';\n\t}\n\n\t// clear any previous values\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\t\tvar elname = 'RT_' + ident;\n\t\tpaymentCount++;\n\t\tdocument.getElementById('RT_' + ident).value = \"\";\n\t}\n\n\t// clear any previous values\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\n\t\t// alert('nuulify');\n\t\tvar elname = 'Cr_RT_' + ident;\n\t\t//\talert(elname);\n\t\tdocument.getElementById('Cr_RT_' + ident).value = \"\";\n\t}\n\n\tif (balance == 0)\n\t{\n\t\treportPaymentStatus(false);\n\t\treturn;\n\t}\n\n\tif (balance > 0)\n\t{\n\t\t//alert(\"doing it\");\n\t\t// first, use store credit\n\t\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t\t{\n\t\t\tvar amountCredit = 0;\n\t\t\tvar maxStoreCredit = Number($('#eoTotalStoreCredit').html());\n\t\t\t//alert(\"max: \" + maxStoreCredit);\n\n\t\t\tif (balance > maxStoreCredit)\n\t\t\t{\n\t\t\t\tamountCredit = maxStoreCredit;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tamountCredit = balance;\n\t\t\t}\n\n\t\t\t// alert(\"amountCredit: \" + amountCredit);\n\n\t\t\tdocument.getElementById('store_credits_amount').value = formatAsMoney(amountCredit);\n\t\t\tbalance -= amountCredit;\n\n\t\t\t// alert(\"balance: \" + balance);\n\t\t}\n\n\t\t// second, look for a payment that could handle the full credit/debit\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tif (balance <= existingPaymentAmountArray[ident].amount)\n\t\t\t{\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\n\t\t\t\trefTransField.value = formatAsMoney(balance);\n\t\t\t\treportPaymentStatus(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// otherwise just assign to the first one\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(balance);\n\t\t\tbreak;\n\t\t}\n\t}\n\telse\n\t{\n\t\t// balance < 0\n\t\t// first, look for a payment that could handle the full credit/debit\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t{\n\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t}\n\n\t\t\tif (balance >= (remainingFundsThisPayment * -1))\n\t\t\t{\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\n\t\t\t\trefTransField.value = formatAsMoney(Math.abs(balance));\n\t\t\t\treportPaymentStatus(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t//if not found then we must spread the balance across multiple payments\n\t\tif (paymentCount > 1)\n\t\t{\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t\t{\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t\t}\n\n\t\t\t\tvar thisAmount = (remainingFundsThisPayment * -1);\n\n\t\t\t\tif (thisAmount < balance)\n\t\t\t\t{\n\t\t\t\t\tthisAmount = balance;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(Math.abs(thisAmount));\n\t\t\t\tbalance -= thisAmount;\n\n\t\t\t\tif (balance >= 0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (paymentCount == 1)\n\t\t{\n\t\t\t// just assign the max amount, the remainder will need to be paid through another method\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t\t{\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(remainingFundsThisPayment);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction storeCreditAmountChange(val)\n{\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\n\n\tif (amountCredit.valueOf() < val)\n\t{\n\t\t$('#store_credits_amount').val(amountCredit.valueOf());\n\n\t}\n\n\tpayAmountChange();\n}\n\nfunction storeCreditClick(obj)\n{\n\tvar amountElem = document.getElementById('store_credits_amount');\n\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\n\n\tif (obj.checked && amountCredit > 0)\n\t{\n\n\t\tamountElem.disabled = false;\n\n\t\tvar balance_elem = document.getElementById('OEH_remaing_balance');\n\t\tif (balance_elem)\n\t\t{\n\t\t\tbalance = Number(balance_elem.innerHTML);\n\t\t}\n\n\t\tif (Number(amountElem.value) > balance && balance > 0)\n\t\t{\n\n\t\t\tamountElem.value = formatAsMoney(balance);\n\t\t}\n\n\t\tupdateChangeList();\n\n\t}\n\telse\n\t{\n\t\tamountElem.disabled = true;\n\t}\n\n\tcalculateTotal();\n\n\treportPaymentStatus(false);\n\n}\n\nfunction reportPaymentStatus(ignorePayment2)\n{\n\tvar balance_elem = document.getElementById('OEH_remaing_balance');\n\n\tvar balance = 0;\n\tif (balance_elem)\n\t{\n\t\tbalance = Number(balance_elem.innerHTML);\n\t}\n\n\tvar paymentsTotal = Number(0);\n\n\t// Total up any store credit\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t{\n\t\tpaymentsTotal = (paymentsTotal * 1) + (1 * formatAsMoney(document.getElementById('store_credits_amount').value));\n\t}\n\n\tvar paySelElem = document.getElementById('payment1_type');\n\n\tif (!paySelElem)\n\t{\n\t\treturn;\n\t}\n\n\tvar paySel = paySelElem.value;\n\n\tvar pay1Amount = Number(0);\n\n\tswitch (paySel)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\t\t\t\tpay1Amount += Number(document.getElementById('RT_' + ident).value);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cc_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"CC_REFUND\":\n\t\t\tvar DirCreditCCAmount = Number(0);\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\t\t\t\tDirCreditCCAmount += Number(document.getElementById('Dir_Cr_RT_' + ident).value);\n\t\t\t}\n\t\t\tpay1Amount = DirCreditCCAmount * -1;\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cash_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_refund_cash_total_amount').value);\n\t\t\tpay1Amount = -pay1Amount;\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_check_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_gc_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\n\n\t\t\tbreak;\n\t}\n\n\tif (ignorePayment2)\n\t{\n\t\tpay2Amount = Number(0);\n\t}\n\telse\n\t{\n\t\tpaySel2 = document.getElementById('payment2_type').value;\n\t\tvar pay2Amount = Number(0);\n\t\tswitch (paySel2)\n\t\t{\n\t\t\tcase \"CC\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cc_total_amount').value);\n\t\t\t\tbreak;\n\n\t\t\tcase \"CASH\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cash_total_amount').value);\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_check_total_amount').value);\n\t\t\t\tbreak;\n\t\t}\n\n\t}\n\n\tvar storeCreditRefundElem = document.getElementById('storeCreditRefund');\n\tif (storeCreditRefundElem)\n\t{\n\t\treturnToStoreCredit = Number(storeCreditRefundElem.value * -1);\n\t}\n\telse\n\t{\n\t\treturnToStoreCredit = Number(0);\n\t}\n\n\tvar cashRefund = document.getElementById('credit_to_customer_refund_cash_amount');\n\tif (cashRefund)\n\t{\n\t\tcashRefund = Number(cashRefund.value * -1);\n\t}\n\telse\n\t{\n\t\tcashRefund = Number(0);\n\t}\n\n\t// Credit Card Refunds\n\tvar CreditCCAmount = Number(0);\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\t\tCreditCCAmount += Number(document.getElementById('Cr_RT_' + ident).value);\n\t}\n\n\tif (isNaN(CreditCCAmount))\n\t{\n\t\tCreditCCAmount = Number(0);\n\t}\n\telse\n\t{\n\t\tCreditCCAmount = Number(CreditCCAmount * -1);\n\t}\n\n\tvar PenndingDPAdjustment = Number(getPendingDPAdjustment());\n\n\t// Note: refunds are now expressed as a negative. Payments total can be negative\n\tvar paymentsTotal = Number(paymentsTotal + pay1Amount + pay2Amount +\n\treturnToStoreCredit + CreditCCAmount + PenndingDPAdjustment + cashRefund);\n\n\t$('#payment_help_msg').removeClass('overpaid');\n\t// current costs are greater than current payments - money owed to store\n\n\tif (orderState != 'CANCELLED')\n\t{\n\n\t\tvar diff = Number((paymentsTotal * -1) + balance);\n\n\t\tif (diff < 0)\n\t\t{\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse if (diff > 0)\n\t\t{\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#payment_help_msg').html('').hide();\n\t\t}\n\t}\n\telse\n\t{\n\n\t\tvar diff = Number(paymentsTotal + balance);\n\n\t\tif (diff > 0)\n\t\t{\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse if (diff < 0)\n\t\t{\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#payment_help_msg').html('').hide();\n\t\t}\n\t}\n\n\t/*\n\t balance = Math.abs(balance);\n\t //\talert(\"balance: \" + balance);\n\n\t var diff = new Number(paymentsTotal - balance);\n\t //\talert(\"diff: \" + diff);\n\n\t $('#new_payments_total').val(paymentsTotal);\n\n\t $('#payment_help_msg').removeClass('overpaid').html('<span id=\"bal_due\">0.0</span>').show();\n\n\n\t if (orderState == 'CANCELLED')\n\t {\n\t if (diff < 0)\n\t {\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else if (diff > 0)\n\t {\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else\n\t {\n\t $('#payment_help_msg').html('').hide();\n\t }\n\t }\n\t else\n\t {\n\t if (paySel == 'CREDIT')\n\t {\n\t $('#payment_help_msg').html('<span id=\"bal_due\">No Charge</span>').show();\n\t }\n\t else if (diff < 0)\n\t {\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else if (diff > 0)\n\t {\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else\n\t {\n\t $('#payment_help_msg').html('').hide();\n\t }\n\t }\n\t */\n\tupdateChangeList();\n}\n\nfunction toggle(obj)\n{\n\tvar el = document.getElementById(obj);\n\tel.style.display = (el.style.display != 'none' ? 'none' : '' );\n}\n\nvar target_prefix = \"payment1_\";\nvar scanPosition = 0;\nvar charIndex = 0;\nvar codes = [];\n\nfunction keyHandler2(evt)\n{\n\n\tevt = (evt) ? evt : event;\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\tcodes[charIndex++] = String.fromCharCode(charCode);\n\n\tif ((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\n\t{\n\t\tscanPosition = 1; //start of data\n\t}\n\telse if ((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\n\t{\n\t\tscanPosition = 2; // start of track 1\n\t}\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\n\t{\n\t\tscanPosition = 3;  // end of track 1\n\t}\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\n\t{\n\t\tscanPosition = 0;  // end of track 2\n\t\tcharIndex = 0;\n\t\thandleSwipeCompletion();\n\t}\n}\n\nfunction endScanHandling()\n{\n\tdocument.getElementById('scanArea').style.display = \"none\";\n\tcodes.length = 0;\n\tscanPosition = 0;\n\tcharIndex = 0;\n\tdocument.getElementById('hidden_text_store').value = \"\";\n\n\tdocument.onkeypress = OMDefaultKeyHandler;\n\n}\n\nfunction prepareForCCSwipe(paymentNumber)\n{\n\n\tif (paymentNumber == 2)\n\t{\n\t\ttarget_prefix = 'payment2_';\n\t}\n\telse\n\t{\n\t\ttarget_prefix = 'payment1_';\n\t}\n\n\tdocument.onkeypress = keyHandler2;\n\tdocument.getElementById('scanArea').style.display = \"block\";\n\tdocument.getElementById('hidden_text_store').focus();\n\tdocument.getElementById('hidden_text_store').value = \"\";\n\n}\n\nfunction handleSwipeCompletion()\n{\n\tvar receivedText = codes.join(\"\");\n\n\tvar p = new SwipeParserObj(receivedText);\n\tvar parsedVersion = p.dump();\n\n\tvar re_visa = /^4[0-9]{12}([0-9]{3})?$/;\n\tvar re_mc = /^5[1-5][0-9]{14}$/;\n\tvar re_amex = /^3[47][0-9]{13}$/;\n\tvar re_disc = /^6011[0-9]{12}$/;\n\n\tvar card_type = false;\n\n\tif (re_visa.test(p.account))\n\t{\n\t\tcard_type = 'Visa';\n\t}\n\telse if (re_mc.test(p.account))\n\t{\n\t\tcard_type = 'Mastercard';\n\t}\n\telse if (re_amex.test(p.account))\n\t{\n\t\tcard_type = 'American Express';\n\t}\n\telse if (re_disc.test(p.account))\n\t{\n\t\tcard_type = 'Discover';\n\t}\n\n\tif (card_type)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccType').value = card_type;\n\t}\n\n\tdocument.getElementById(target_prefix + 'ccNumber').value = p.account;\n\tdocument.getElementById(target_prefix + 'ccNameOnCard').value = p.firstname + ' ' + p.surname;\n\tdocument.getElementById(target_prefix + 'ccMonth').value = p.exp_month;\n\n\tvar exp_year = p.exp_year;\n\tif (exp_year.length == 2)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year;\n\t}\n\telse if (exp_year.length == 4)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year.substr(2);\n\t}\n\n\tendScanHandling();\n}"],"mappings":"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"}
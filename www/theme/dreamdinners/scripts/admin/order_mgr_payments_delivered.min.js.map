{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_mgr_payments_delivered.js"],"sourcesContent":["var originalMaxPPDeduction = 0;\nvar selectedFreeMenuItem;\nvar couponFreeMenuItemRequired = false;\n\nfunction handle_ltd_round_up()\n{\n\t$('#add_ltd_round_up').prop('disabled', false);\n\n\tif (orderState == 'SAVED' && !$('#add_ltd_round_up').is(':checked') && GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value > 0 && orderInfo.ltd_round_up_value == '')\n\t{\n\t\t$('#add_ltd_round_up').prop('checked', true);\n\n\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == 1)\n\t\t{\n\t\t\t$(\"#ltd_round_up_select option[id='round_up_nearest_dollar']\").attr(\"selected\", \"selected\");\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).val(GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value).trigger('change');\n\t\t}\n\t}\n\telse if ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\t$('#ltd_round_up_select').prop('disabled', false);\n\t}\n\n\t$('#add_ltd_round_up').on('change', function (e)\n\t{\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\n\t\t\tif (GUEST_PREFERENCES[user_id].LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != user_id + '.' + session_id))\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\tmessage: 'Would <span style=\"font-weight: bold; color: red;\">the guest</span> like to automatically round up every time they order? The guest can edit this setting any time in <span style=\"font-weight: bold;\">My Preferences</span>.<div style=\"text-align: center; margin-top: 10px;\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option></select></div>',\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\topen: function (event, ui)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\n\t\t\t\t\t\tvar rup_dialog = $(this);\n\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e)\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\n\n\t\t\t\t\t\t\tif (rup_value > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\n\t\t\t\t\t\t\t\t\tconfirm: function ()\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\n\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value, user_id);\n\n\t\t\t\t\t\t\t\t\t\tif (orderInfo.ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use the selected Round Up value on this order?',\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function ()\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function ()\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"No\": function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0, user_id);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"Ask Again Later\": function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t\t\t$.cookie('ltdru', user_id + '.' + session_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\n\t\t}\n\n\t\t$('#ltd_round_up_select').trigger('change');\n\n\t\tcalculateTotal();\n\t});\n\n\t$('#ltd_round_up_select').on('change', function (e)\n\t{\n\n\t\tvar round_up_val = $(this).val();\n\n\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\n\n\t\tif ($('#add_ltd_round_up').is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_div').slideDown();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_div').slideUp();\n\n\t\t\tround_up_val = 0;\n\t\t}\n\n\t\t/*\n\n\t\t $.ajax({\n\t\t url: 'ddproc.php',\n\t\t type: 'POST',\n\t\t timeout: 20000,\n\t\t dataType: 'json',\n\t\t data: {\n\t\t processor: 'cart_add_payment',\n\t\t payment_type: 'ltd_round_up',\n\t\t ltd_round_up_value: round_up_val\n\t\t },\n\t\t success: function (json)\n\t\t {\n\t\t if (json.processor_success)\n\t\t {\n\n\t\t }\n\t\t else\n\t\t {\n\t\t dd_message({\n\t\t title: 'Error',\n\t\t message: json.processor_message\n\t\t });\n\t\t }\n\t\t },\n\t\t error: function (objAJAXRequest, strError)\n\t\t {\n\t\t dd_message({\n\t\t title: 'Error',\n\t\t message: 'Unexpected error: ' + strError\n\t\t });\n\t\t }\n\t\t });\n\n\t\t */\n\n\t\tcalculateTotal();\n\t});\n\n\tcalculateTotal();\n}\n\n\n\nfunction handleCouponCodeResult(json)\n{\n\tif (json.validation_errors)\n\t{\n\t\tprintString = \"\";\n\t\tfor (anError in json.validation_errors)\n\t\t{\n\t\t\tif (json.validation_errors[anError] != \"\" && json.validation_errors[anError] != null)\n\t\t\t{\n\t\t\t\tprintString += json.validation_errors[anError] + \"<br />\";\n\t\t\t}\n\t\t}\n\n\t\t$(\"#coupon_error\").html(printString);\n\t\t$(\"#coupon_error\").show();\n\t\t$('#couponCodeSubmitter').show();\n\t\t$('#proc_mess').hide();\n\t}\n\telse\n\t{\n\t\t$(\"#coupon_error\").hide();\n\t\t$(\"#coupon_error\").html(\"\");\n\n\t\t$('#proc_mess').hide();\n\t\t$('#couponDeleter').show();\n\t\t$('#coupon_code').prop('disabled', true);\n\n\t\t$(\"#couponValue\").val(json.coupon_code_discount_total);\n\t\t$(\"#coupon_id\").val(json.code_id);\n\n\t\t$(\"#coupon_type\").val(json.discount_method);\n\n\t\tif (json.discount_method == \"FREE_MEAL\")\n\t\t{\n\t\t\t$('#coupon_free_meal_row').show();\n\t\t\t$(\"#free_entree\").html(json.entree_title);\n\t\t\t$('#free_entree_servings').val(json.entree_servings);\n\t\t}\n\t\telse if (json.discount_method == \"FREE_MENU_ITEM\")\n\t\t{\n\t\t\thandleFreeMenuItem(json.coupon_obj.coupon_code);\n\t\t}\n\t\telse if (json.discount_method == \"BONUS_CREDIT\")\n\t\t{\n\t\t\tcreateBonusCredit(0);\n\t\t}\n\n\t\tcoupon = json.coupon;\n\t\tcouponDiscountMethod = json.discount_method;\n\t\tcouponDiscountVar = json.discount_var;\n\t\tcouponlimitedToFT = json.limit_to_finishing_touch;\n\t\tcouponIsValidWithReferralCredit = json.valid_with_customer_referral_credit;\n\t\tcouponIsValidWithPlatePoints = json.valid_with_plate_points_credits;\n\t\tcouponFreeMenuItemRequired = true;\n\n\t\tif (couponlimitedToFT)\n\t\t{\n\t\t\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\n\t\t\toriginalMaxPPDeduction = maxPPDeduction;\n\n\t\t\tmaxPPDeduction -= json.coupon_code_discount_total;\n\t\t\tif (maxPPDeduction < 0)\n\t\t\t{\n\t\t\t\tmaxPPDeduction = 0;\n\t\t\t}\n\n\t\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(maxPPDeduction));\n\t\t}\n\n\t\tcalculateTotal();\n\t}\n\n}\n\nfunction processCode()\n{\n\n\tvar code = $(\"#coupon_code\").val();\n\t$(\"#couponCodeSubmitter\").hide();\n\n\tvar theForm = $('#editorForm').get()[0];\n\n\tvar filterBundle = false;\n\tvar bundleBox = document.getElementById('selectedBundle');\n\tif (bundleBox && !bundleBox.checked)\n\t{\n\t\tfilterBundle = true;\n\t}\n\n\tvar parameters = \"\";\n\tfor (i = 0; i < theForm.elements.length; i++)\n\t{\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\n\t\t{\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\n\t\t\tif (i + 1 != theForm.elements.length)\n\t\t\t{\n\t\t\t\tparameters += \"&\";\n\t\t\t}\n\t\t}\n\t}\n\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\n\n\tvar d = new Date();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessorDelivered',\n\t\t\tuser_id: user_id,\n\t\t\top: 'add',\n\t\t\torg_ts: 'org_order_time',\n\t\t\torder_id: order_id,\n\t\t\tunique: d.getTime(),\n\t\t\tcoupon_code: code,\n\t\t\torder_state: orderState,\n\t\t\tparams: parameters\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\thandleCouponCodeResult(json);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction removeCode()\n{\n\tvar theForm = $('#editorForm').get()[0];\n\n\tvar filterBundle = false;\n\tvar bundleBox = document.getElementById('selectedBundle');\n\tif (bundleBox && !bundleBox.checked)\n\t{\n\t\tfilterBundle = true;\n\t}\n\n\tvar parameters = \"\";\n\tfor (i = 0; i < theForm.elements.length; i++)\n\t{\n\t\tif (filterBundle && theForm.elements[i].name == 'selectedBundle')\n\t\t{\n\t\t}\n\t\telse\n\t\t{\n\t\t\tparameters += (theForm.elements[i].name + \"=\" + theForm.elements[i].value);\n\t\t\tif (i + 1 != theForm.elements[i])\n\t\t\t{\n\t\t\t\tparameters += \"&\";\n\t\t\t}\n\t\t}\n\t}\n\n\tparameters = parameters + \"&store_id=\" + STORE_DETAILS.id;\n\n\tvar d = new Date();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_orderMgrCouponCodeProcessorDelivered',\n\t\t\top: 'remove',\n\t\t\tuser_id: user_id,\n\t\t\torg_ts: 'org_order_time',\n\t\t\torder_id: order_id,\n\t\t\tunique: d.getTime(),\n\t\t\torder_state: orderState,\n\t\t\tparams: parameters\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif ($(\"#coupon_type\").val() == \"BONUS_CREDIT\")\n\t\t\t{\n\t\t\t\tremoveBonusCredit();\n\t\t\t}\n\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\t\t\t$('#couponDeleter').hide();\n\t\t\t$('#coupon_code').prop('disabled', false);\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#couponValue\").val(0);\n\t\t\t$('#coupon_free_meal_row').hide();\n\t\t\t$(\"#free_entree\").html(\"\");\n\t\t\t$(\"#coupon_id\").val(\"\");\n\t\t\t$(\"#coupon_type\").val(\"\");\n\n\t\t\t$('#coupon_select_free_menu_item_row').hide();\n\t\t\t$('#free_menu_item_coupon option:not([value])').attr('data-dd_required', false);\n\t\t\tcouponFreeMenuItem = false;\n\t\t\tcouponFreeMenuItemRequired = false;\n\n\t\t\tcouponDiscountMethod = 'NONE';\n\t\t\tcouponDiscountVar = 0;\n\t\t\tcouponlimitedToFT = false;\n\t\t\tcouponIsValidWithPlatePoints = true;\n\n\t\t\tcalculateTotal();\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\t$(\"#coupon_error\").html(\"\");\n\t\t\t$(\"#coupon_error\").hide();\n\t\t\t$('#couponCodeSubmitter').show();\n\t\t\t$('#proc_mess').hide();\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n\n}\n\nfunction handle_free_menu_item_edit()\n{\n\tif (couponFreeMenuItem)\n\t{\n\t\thandleFreeMenuItem($('#coupon_code').val());\n\t}\n}\n\nfunction handleFreeMenuItem(coupon_code)\n{\n\tvar menu_item_count = 0;\n\n\tif (coupon_code == 'SRDessert')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9\");\n\t}\n\telse if (coupon_code == 'SRDinner')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane'\");\n\t}\n\telse if (coupon_code == 'CC3RDFREE')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"(menu_item.menu_class == 'Specials' || menu_item.menu_class == 'Extended Fast Lane') && menu_item.price <= 25.00\");\n\t}\n\telse if (coupon_code == 'SCFinishingTouch')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_category_id == 9 && menu_item.price <= 15.00\");\n\t}\n\telse if (coupon_code == 'HCFastLane')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Extended Fast Lane' && menu_item.pricing_type == 'HALF'\");\n\t}\n\telse if (coupon_code == 'SCFriendDinner')\n\t{\n\t\tmenu_item_count = buildFreeMenuItemList(\"menu_item.menu_class == 'Specials' && menu_item.intro_item == true\");\n\t}\n\n\tif (menu_item_count > 0)\n\t{\n\t\t$('#coupon_select_free_menu_item_row').show();\n\n\t\t$('#free_menu_item_coupon').attr('data-dd_required', true).on('change', function (e)\n\t\t{\n\t\t\tvar menu_item = $(this).find(':selected').data('menu_item');\n\t\t\tvar price = $(this).find(':selected').data('price');\n\n\t\t\t$('#couponValue').val(price);\n\t\t\tselectedFreeMenuItem = menu_item;\n\n\t\t\tcalculateTotal();\n\t\t});\n\t}\n\telse\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'No valid free items found in cart for this coupon, please add the desired item and then submit the coupon.'\n\t\t});\n\n\t\tremoveCode();\n\t}\n}\n\nfunction buildFreeMenuItemList(expression)\n{\n\trebuildOrderItemsArray();\n\n\tvar menu_item_in_list = false;\n\tvar selected_menu_item_in_list = false; // temp store, used for tab switching\n\tvar menu_item_count = 0;\n\n\t// setup efl free item select\n\tvar s = $('#free_menu_item_coupon').html('').attr('disabled', ((couponFreeMenuItem) ? true : false));\n\n\t$(\"<option />\").val('').text('Select Free Item').appendTo(s);\n\n\t$.each(orderItems, function (index, menu_item)\n\t{\n\t\tif (!menu_item_in_list)\n\t\t{\n\t\t\tmenu_item_in_list = ((couponFreeMenuItem == menu_item.id) ? true : false);\n\t\t}\n\n\t\tif (!selected_menu_item_in_list)\n\t\t{\n\t\t\tselected_menu_item_in_list = ((selectedFreeMenuItem == menu_item.id) ? true : false);\n\t\t}\n\n\t\tif (eval(expression))\n\t\t{\n\t\t\tmenu_item_count++;\n\n\t\t\t$(\"<option />\")\n\t\t\t\t.val(menu_item.id)\n\t\t\t\t.attr('data-menu_item', menu_item.id)\n\t\t\t\t.attr('data-price', menu_item.price)\n\t\t\t\t.attr('selected', ((couponFreeMenuItem == menu_item.id || selectedFreeMenuItem == menu_item.id) ? true : false))\n\t\t\t\t.text(menu_item.item_title + ' (' + menu_item.price + ')').appendTo(s);\n\t\t}\n\t});\n\n\tif (!menu_item_in_list)\n\t{\n\t\t$('#couponValue').val('0.00');\n\n\t\t$('#free_menu_item_coupon').attr('disabled', false);\n\t}\n\n\tcalculateTotal();\n\n\treturn menu_item_count;\n}\n\nfunction stripLeadingZeroes(val)\n{\n\tvar leadingZeroCount = 0;\n\tvar retVal = val;\n\n\tfor (var i = 0, len = val.length; i < len; i++)\n\t{\n\t\tif (val[i] != '0')\n\t\t{\n\t\t\tbreak;\n\t\t}\n\n\t\tleadingZeroCount++;\n\t}\n\n\tif (leadingZeroCount > 0)\n\t{\n\t\tretVal = val.slice(leadingZeroCount)\n\t}\n\n\treturn retVal;\n\n}\n\nfunction handlePlatePointsDiscount(val)\n{\n\tif (!couponIsValidWithPlatePoints)\n\t{\n\t\tdocument.getElementById('plate_points_discount').value = formatAsMoney(0);\n\n\t\tdd_message({\n\t\t\ttitle: 'Alert',\n\t\t\tmessage: 'PLATEPOINTS cannot be used with the attached coupon.'\n\t\t});\n\n\t}\n\n\tif ((isNaN(val) || val <= 0) && val != \".\")\n\t{\n\t\t$('#plate_points_discount').val(\"0\");\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(0));\n\t\tcalculateTotal();\n\t\treturn;\n\t}\n\n\tneedPlatePointsMaxDiscountChangeWarning = false;\n\n\tval = formatAsMoney(Math.abs(val)) * 1;\n\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\n\n\tif (maxPPDeduction < curPPDiscount)\n\t{\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\n\t}\n\n\tif (maxPPCredit > maxPPDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tvar cap = maxPPCredit;\n\tif (cap > maxPPDeduction)\n\t{\n\t\tcap = maxPPDeduction;\n\t}\n\n\tif (val > cap)\n\t{\n\t\tval = cap;\n\t\t$('#plate_points_discount').val(val);\n\n\t}\n\n\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(val));\n\n\n\tcalculateTotal();\n}\n\nfunction editCashCheckAmount(id, type)\n{\n\t// Show input form\n\t$('#check_total_input_' + id).show();\n\t$('#check_payment_number_input_' + id).show();\n\t// Hide edit link and text\n\t$('#check_total_' + id).hide();\n\t$('#check_payment_number_' + id).hide();\n\t$('#check_editlink_' + id).hide();\n}\n\nfunction editCashCheckUpdate(id, type)\n{\n\t$('#payment_sum_value_' + id).html($('#check_total_input_form_' + id).val());\n\t$('#payment_sum_name_' + id).html('Check (#' + $('#check_payment_number_input_form_' + id).val() + ')');\n\n\t// Loop through payment summary to get new total\n\tnew_total = 0;\n\t$('[id^=\"payment_sum_value_\"]').each(function (index)\n\t{\n\t\tnew_total = new_total + Number($(this).text());\n\t});\n\n\t// loop through and subtract refunds\n\t$('[id^=\"refund_payment_sum_value_\"]').each(function (index)\n\t{\n\t\tnew_total = new_total - Number($(this).text());\n\t});\n\n\t$('#OEH_paymentsTotal').html(formatAsMoney(new_total));\n\n\tcalculateTotal();\n}\n\n// Check cift card balance\nfunction getGiftCardBalance()\n{\n\t$('#gc_proc_anim').show();\n\t$('#balance_target').hide();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'giftCardBalance',\n\t\t\tcard_number: $('#debit_gift_card_number').val(),\n\t\t\toutput: 'json'\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html(json.card_balance);\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + request_uri + '\">[login]</a> again.</span>');\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#balance_target').show();\n\t\t\t\t$('#balance_target').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t\t$('#gc_proc_anim').hide();\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#balance_target').show();\n\t\t\t$('#balance_target').html('Error: ' + strError + '. Please <a href=\"javascript:getGiftCardBalance();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\nfunction editCashCheckAmountCommit(id, type)\n{\n\talert(\"You are only modifying the \" + type + \" details.\\nNo other modifications will be made.\");\n\n\t$('#check_total_mess_' + id).hide();\n\tnew_total = $('#check_total_input_form_' + id).val();\n\tnew_number = $('#check_payment_number_input_form_' + id).val();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_editCashCheckAmount',\n\t\t\tid: id,\n\t\t\ttype: type,\n\t\t\tnew_total: new_total,\n\t\t\tnew_number: new_number,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t// Hide input form\n\t\t\t\t$('#check_total_input_' + id).hide();\n\t\t\t\t$('#check_payment_number_input_' + id).hide();\n\t\t\t\t// Show edit link and text\n\t\t\t\t$('#check_total_' + id).show();\n\t\t\t\t$('#check_payment_number_' + id).show();\n\t\t\t\t$('#check_editlink_' + id).show();\n\n\t\t\t\t// Update page text with new values\n\t\t\t\t$('#check_total_' + id).html(new_total);\n\t\t\t\t$('#check_payment_number_' + id).html(new_number);\n\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).show().html('<img src=\"' + PATH.image_admin + '/icon/accept.png\" alt=\"Accept\" />').fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + +'\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t\t$('#check_total_mess_' + id).html('<span style=\"color:red;font-weight:bold;\">' + json.processor_message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#check_total_mess_' + id).show();\n\t\t\t$('#check_total_mess_' + id).html('Error: ' + strError + '. Please <a href=\"javascript:editCashCheckAmountCommit(' + id + ',\\'' + type + '\\');\">[try again]</a>.');\n\t\t}\n\t});\n\n}\n\n// Proccess delayed payment now\nfunction showButtonProcessDelayedPaymentNow(message)\n{\n\tif (PendingDPOriginalStatus == 'PENDING')\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"process_payment\" value=\"Process delayed payment now\" onclick=\"processPayment();\">');\n\t}\n\telse if (message)\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html(message);\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').hide();\n\t}\n}\n\nfunction processPayment()\n{\n\tif (confirm(\"Are you sure you wish to process the delayed payment now? Click OK to process.\"))\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 60000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_delayedPaymentProcessor',\n\t\t\t\torder_number: order_id\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\tif (json.success)\n\t\t\t\t{\n\t\t\t\t\tif ($('#point_to_transaction').length)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar credit_card_number = $('#point_to_transaction option:selected').text();\n\t\t\t\t\t\t$('#cc_payment_number_other').html('XXXXXXXXXXXX' + credit_card_number.substr(-4));\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#cc_delayed_tran_num_other').html(json.transaction_id);\n\t\t\t\t\t$('#cc_delayed_date_other').html(json.transaction_date);\n\t\t\t\t\t$('#cc_delayed_status_other').html('Status: Payment Processed');\n\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'color': ''});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'color': ''});\n\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).html(json.summary_date);\n\n\t\t\t\t\tcanAdjustDelayedPayment = false;\n\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:green;font-weight:bold;\">Payment Processed.</span>').fadeOut(4000);\n\t\t\t\t}\n\t\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t\t{\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').show();\n\t\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPayment();\">[try again]</a>.');\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Change delayed payment status\nfunction setDelayedPaymentStatusTo()\n{\n\t//Do not allow the user to reset to FAIL\n\tif ($('#change_delayed_payment_status').val() == 'FAIL' && PendingDPOriginalStatus != 'FAIL')\n\t{\n\t\talert('Can not change transaction back to Fail. Please choose pending or canceled.');\n\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\t\treturn false;\n\t}\n\t// Reset transaction id dropdown, can only set the status of one dropdown a time.\n\tif ($('#change_delayed_payment_status'))\n\t{\n\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\t}\n\n\tif ($('#change_delayed_payment_status').val() == PendingDPOriginalStatus)\n\t{\n\t\tshowButtonProcessDelayedPaymentNow();\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"set_delayed_payment_status\" value=\"Set delayed payment status to ' + $('#change_delayed_payment_status').val().toLowerCase() + '\" onClick=\"processDelayedPaymentStatus();\">');\n\t}\n}\n\nfunction setupCouponState()\n{\n\t// if a coupon is attached we need to update the UI\n\t// 1) set up the coupon code box - disabled with code\n\tif (coupon)\n\t{\n\t\tdocument.getElementById('couponCodeSubmitter').style.display = \"none\";\n\t\tdocument.getElementById('couponDeleter').style.display = \"inline\";\n\t\tdocument.getElementById('coupon_code').value = coupon.coupon_code;\n\t\tdocument.getElementById('coupon_code').disabled = true;\n\t}\n}\n\nfunction processDelayedPaymentStatus()\n{\n\t$('#payment_proc_mess').show();\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_delayedPaymentStatusProcessor',\n\t\t\torder_number: order_id,\n\t\t\told_status: PendingDPOriginalStatus,\n\t\t\tnew_status: $('#change_delayed_payment_status').val(),\n\t\t\tstore_id: store_id\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.success)\n\t\t\t{\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\n\t\t\t\tPendingDPOriginalStatus = json.status;\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\t\t\t\t// Reset transaction id dropdown, only set one at a time.\n\t\t\t\tif ($('#change_delayed_payment_status'))\n\t\t\t\t{\n\t\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\t\t\t\t}\n\n\t\t\t\t// Voodoo, editing cash/check totals element id payment_sum_value_*, so change\n\t\t\t\t// element id to cancelled_payment_sum_value_* which will be skipped over in the total caclulation.\n\t\t\t\tif (json.status == 'CANCELLED' && $('#payment_sum_value_' + json.payment_id))\n\t\t\t\t{\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).attr('id', 'cancelled_payment_sum_value_' + json.payment_id);\n\t\t\t\t}\n\t\t\t\telse if (json.status == 'PENDING' && $('#cancelled_payment_sum_value_' + json.payment_id))\n\t\t\t\t{\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).attr('id', 'payment_sum_value_' + json.payment_id);\n\t\t\t\t}\n\n\t\t\t\t// Update payment status and details\n\t\t\t\tif (json.status == 'CANCELLED')\n\t\t\t\t{\n\t\t\t\t\t// Can only adjust pending payments\n\t\t\t\t\tcanAdjustDelayedPayment = false;\n\n\t\t\t\t\t// Update summary rows\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#cancelled_payment_sum_value_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'line-through'});\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) - Number($('#cancelled_payment_sum_value_' + json.payment_id).html())));\n\n\t\t\t\t\t// Reset new payment if they have auto adjust selected\n\t\t\t\t\t$('#dp_adjust_div').hide();\n\t\t\t\t\t//\t$('#autoAdjust').attr({ 'checked' : 'checked' });\n\t\t\t\t\t//\thandleAutoAdjust($('#autoAdjust'));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t// Payment pending, we are allowed to edit it\n\t\t\t\t\tcanAdjustDelayedPayment = true;\n\n\t\t\t\t\t// Update summary rows\n\t\t\t\t\t$('#payment_sum_row_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_type_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_name_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_value_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#payment_sum_date_' + json.payment_id).css({'text-decoration': 'none'});\n\t\t\t\t\t$('#OEH_paymentsTotal').html(formatAsMoney(Number($('#OEH_paymentsTotal').html()) + Number($('#payment_sum_value_' + json.payment_id).html())));\n\n\t\t\t\t\t// Allow auto adjust to be used\n\t\t\t\t\tcanAutoAdjust = true;\n\t\t\t\t}\n\n\t\t\t\tcalculateTotal();\n\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Delayed Payment set to ' + PendingDPOriginalStatus + '.</span>');\n\t\t\t\t$('#change_delayed_payment_status_img').attr({\n\t\t\t\t\tsrc: PATH.image_admin + '/icon/accept.png',\n\t\t\t\t\talt: 'Accept'\n\t\t\t\t});\n\t\t\t\t$('#change_delayed_payment_status_img').css({display: 'inline'}).fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#payment_proc_mess').show();\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processDelayedPaymentStatus();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\n// Point to new transaction ID\nfunction pointToTransaction()\n{\n\t// Reset payment status dropdown, only set one at a time.\n\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\tif ($('#point_to_transaction').val() == PendingDPOriginalTransActionID)\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\tshowButtonProcessDelayedPaymentNow();\n\t}\n\telse\n\t{\n\t\t$('#payment_proc_mess').show();\n\t\t$('#payment_proc_mess').html('<input type=\"button\" class=\"button\" name=\"point_to_payment\" value=\"Point payment to selected Credit Card Number\" onClick=\"processPointToTransaction();\">');\n\t}\n}\n\nfunction processPointToTransaction()\n{\n\t$('#payment_proc_mess').show();\n\t$('#payment_proc_mess').html('<img src=\"' + PATH.image_admin + '/throbber_processing_noborder.gif\" alt=\"Processing\" />');\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_processPointToTransaction',\n\t\t\torder_number: order_id,\n\t\t\tstore_id: store_id,\n\t\t\told_ref_number: PendingDPOriginalTransActionID,\n\t\t\tnew_ref_number: $('#point_to_transaction').val(),\n\t\t\tnew_card_number: $('#point_to_transaction option:selected').text()\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.success)\n\t\t\t{\n\t\t\t\t// Keep dropdown in sync with processed result in case it was changed during processing\n\t\t\t\tPendingDPOriginalTransActionID = json.transactionid;\n\t\t\t\t$('#point_to_transaction').val(PendingDPOriginalTransActionID);\n\n\t\t\t\t// Reset payment status dropdown, only set one at a time.\n\t\t\t\t$('#change_delayed_payment_status').val(PendingDPOriginalStatus);\n\n\t\t\t\t$('#payment_sum_type_' + json.payment_id).html(json.new_card_type);\n\t\t\t\t$('#payment_sum_name_' + json.payment_id).html('Delayed CC Payment (#' + json.new_card_number + ')');\n\n\t\t\t\t$('#cc_credit_card_type_other').html(json.new_card_type);\n\t\t\t\t$('#cc_payment_transaction_number_other').html(json.transactionid);\n\t\t\t\tshowButtonProcessDelayedPaymentNow('<span style=\"color:green;font-weight:bold;\">Credit card set to ' + json.new_card_type + '.</span>');\n\t\t\t\t$('#point_to_transaction_img').css({display: 'inline'}).fadeOut(2000);\n\t\t\t}\n\t\t\telse if (json.message == \"Not logged in\")\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">Session timed out, please <a href=\"' + back_path() + '\">[login]</a> again.</span>');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#payment_proc_mess').html('<span style=\"color:red;font-weight:bold;\">' + json.message + '</span>');\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$('#payment_proc_mess').show();\n\t\t\t$('#payment_proc_mess').html('Error: ' + strError + '. Please <a href=\"javascript:processPointToTransaction();\">[try again]</a>.');\n\t\t}\n\t});\n}\n\nfunction unsetAutoAdjust()\n{\n\tif ($('#autoAdjust').length)\n\t{\n\t\tdocument.getElementById('autoAdjust').checked = false;\n\t}\n}\n\nfunction setAllPaymentFieldsToUnrequired()\n{\n\tvar reqField;\n\n\treqField = document.getElementById('payment1_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment1_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_reference_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment2_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('payment2_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\treqField = document.getElementById('debit_gift_card_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n}\n\nvar lastPayment1Type = false;\n\nfunction changePayment1(mySelect)\n{\n\n\tif (lastPayment1Type && lastPayment1Type != mySelect)\n\t{\n\t\tif (lastPayment1Type == 'CC')\n\t\t{\n\t\t\t$('#payment1_gc_total_amount').val(\"\");\n\t\t}\n\t\telse if (lastPayment1Type == 'REFERENCE')\n\t\t{\n\t\t\t$('#payment1_reference_total_amount').val(\"\");\n\t\t}\n\n\t}\n\n\tlastPayment1Type = mySelect;\n\n\tvar divGC = document.getElementById('payment1_gc');\n\tvar divCash = document.getElementById('payment1_cash');\n\tvar divRefundCash = document.getElementById('payment1_refund_cash');\n\tvar divCheck = document.getElementById('payment1_check');\n\tvar divCC = document.getElementById('payment1_cc');\n\tvar divCredit = document.getElementById('payment1_credit');\n\tvar divRef = document.getElementById('payment1_reference');\n\tvar divRefOther = document.getElementById('payment1_ref');\n\tvar refundDiv = document.getElementById('payment1RefundCCDiv');\n\n\tvar dpAdjust = document.getElementById('dp_adjust_div'); // can be null\n\n\tdocument.getElementById('new_payments_total').value = 0;\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t{\n\t\tdocument.getElementById('new_payments_total').value = formatAsMoney(document.getElementById('store_credits_amount').value);\n\t}\n\n\tvar divDebitGiftCard = document.getElementById('payment1_debit_gift_card');\n\n\tvar payment2 = document.getElementById('payment2');\n\n\tvar selected_ref = false;\n\tif (mySelect.substr(0, 4) == 'REF_')\n\t{\n\t\tselected_ref = mySelect.substr(4);\n\t\tmySelect = 'REFERENCE_OTHER';\n\t}\n\n\tresetPendingDelayedPayment();\n\n\t// reset so validation does not fail when using payment types other than CC\n\tvar amount = document.getElementById('payment1_cc_total_amount');\n\tamount.value = '';\n\n\tvar reqField;\n\treqField = document.getElementById('payment1_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_refund_cash_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_check_total_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_reference_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('debit_gift_card_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment1_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\tswitch (mySelect)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivRef.style.display = 'block';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\n\t\t\tif (dpAdjust && canAdjustDelayedPayment)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t\tunsetAutoAdjust();\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_reference_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'block';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\n\t\t\tif (orderState != 'ACTIVE')\n\t\t\t{\n\t\t\t\tpayment2.style.display = 'block';\n\t\t\t}\n\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_gc_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_gc_payment_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tunsetAutoAdjust();\n\t\t\tdivGC.style.display = 'none';\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivCash.style.display = 'block';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tif (orderState == 'ACTIVE')\n\t\t\t{\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tamount = document.getElementById('payment1_cash_total_amount');\n\t\t\t\tamount.value = formatAsMoney(0);\n\t\t\t}\n\n\t\t\treqField = document.getElementById('payment1_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_cash_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'block';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_refund_cash_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'block';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tamount = document.getElementById('payment1_check_total_amount');\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\n\t\t\treqField = document.getElementById('payment1_check_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_check_total_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'false');\n\t\t\t}\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\trefundDiv.style.display = 'none';\n\n\t\t\tpaymentsTotal = Number(document.getElementById('OEH_paymentsTotal').innerHTML);\n\n\t\t\tif (paymentsTotal != 0)\n\t\t\t{\n\t\t\t\talert(\"'No Charge' can only be selected if there are no existing payments. It is intended to be used only when you are giving an order away.\");\n\t\t\t\tpaySel = document.getElementById('payment1_type');\n\t\t\t\tpaySel.value = '';\n\t\t\t\tchangePayment1('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tunsetAutoAdjust();\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'block';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'block';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tamount = document.getElementById('payment1_cc_total_amount');\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\n\t\t\tamount.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\n\t\t\treqField = document.getElementById('payment1_ccNameOnCard');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccNumber');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_cc_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccType');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccMonth');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment1_ccYear');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'block';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\treqField = document.getElementById('debit_gift_card_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('debit_gift_card_number');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tif (orderState != 'ACTIVE')\n\t\t\t{\n\t\t\t\tpayment2.style.display = 'block';\n\t\t\t}\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"DPADJUST\":\n\t\t\tif (!dpAdjust)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t} // should never happen\n\n\t\t\tif (!canAdjustDelayedPayment)\n\t\t\t{\n\t\t\t\talert('Can not adjust delayed payment.\\n\\nDelayed payment status: ' + PendingDPOriginalStatus);\n\t\t\t\tautoAdjBox = document.getElementById('autoAdjust');\n\t\t\t\tif (!forceManualAutoAdjust)\n\t\t\t\t{\n\t\t\t\t\tautoAdjBox.checked = true;\n\t\t\t\t\thandleAutoAdjust(autoAdjBox);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdpAdjust.style.display = 'block';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\tbalance = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\tadjustPendingDelayedPayment(balance);\n\n\t\t\tchangePayment2('');\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'block';\n\n\t\t\tdocument.getElementById('p1_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\n\t\t\tdocument.getElementById('p1_ref_id').innerHTML = selected_ref;\n\n\t\t\treqField = document.getElementById('payment1_ref_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t\tbalance = Number(document.getElementById('OEH_remaing_balance').innerHTML);\n\t\t\t\treqField.value = formatAsMoney(balance - document.getElementById('new_payments_total').value);\n\t\t\t}\n\n\t\t\tchangePayment2('');\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\t\tcase 'CC_REFUND':\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'block';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\n\t\t\tonPaymentSelected();\n\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tunsetAutoAdjust();\n\t\t\trefundDiv.style.display = 'none';\n\t\t\tdivGC.style.display = 'none';\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivRefundCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivCredit.style.display = 'none';\n\t\t\tpayment2.style.display = 'none';\n\t\t\tdivRef.style.display = 'none';\n\t\t\tdivRefOther.style.display = 'none';\n\t\t\tdivDebitGiftCard.style.display = 'none';\n\n\t\t\tresetPendingDelayedPayment();\n\t\t\tif (dpAdjust)\n\t\t\t{\n\t\t\t\tdpAdjust.style.display = 'none';\n\t\t\t}\n\n\t\t\tonPaymentDeselected();\n\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction changePayment2(mySelect)\n{\n\n\treportPaymentStatus(true);\n\n\tvar textBal = $(\"#bal_due\").html();\n\tvar balance = Number($(\"#bal_due\").html());\n\tif (isNaN(balance.valueOf()))\n\t{\n\t\tbalance = \"\";\n\t}\n\tif (balance.valueOf() == 0)\n\t{\n\t\tbalance = \"\";\n\t}\n\n\tvar divCash = document.getElementById('payment2_cash');\n\tvar divRefundCash = document.getElementById('payment2_refund)_cash');\n\tvar divCheck = document.getElementById('payment2_check');\n\tvar divCC = document.getElementById('payment2_cc');\n\tvar divref2 = document.getElementById('payment2_ref');\n\n\tvar reqField;\n\n\treqField = document.getElementById('payment2_gc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_gc_payment_number');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNameOnCard');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccNumber');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cash_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_cc_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ref_total_amount');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccType');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccMonth');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\treqField = document.getElementById('payment2_ccYear');\n\tif (reqField)\n\t{\n\t\treqField.setAttribute('data-dd_required', 'false');\n\t}\n\n\tvar selected_ref = false;\n\tif (mySelect.substr(0, 4) == 'REF_')\n\t{\n\t\tselected_ref = mySelect.substr(4);\n\t\tmySelect = 'REFERENCE_OTHER';\n\t}\n\n\tswitch (mySelect)\n\t{\n\t\tcase \"CASH\":\n\t\t\tdivCash.style.display = 'block';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_cash_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_cash_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'block';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_check_total_amount');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_check_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'block';\n\t\t\tdivref2.style.display = 'none';\n\n\t\t\treqField = document.getElementById('payment2_ccNameOnCard');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccNumber');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccType');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccMonth');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\treqField = document.getElementById('payment2_ccYear');\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\n\t\t\t$(\"#payment2_cc_total_amount\").val(balance);\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t\t\tdivref2.style.display = 'block';\n\n\t\t\tdocument.getElementById('p2_card_num').innerHTML = externalPaymentAmountArray[selected_ref]['cc_number'];\n\t\t\tdocument.getElementById('p2_ref_id').innerHTML = selected_ref;\n\n\t\t\treqField = document.getElementById('payment2_ref_total_amount');\n\n\t\t\t$(\"#payment2_ref_total_amount\").val(balance);\n\n\t\t\tif (reqField)\n\t\t\t{\n\t\t\t\treqField.setAttribute('data-dd_required', 'true');\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\treqField = document.getElementById('payment2_type');\n\t\t\treqField.selectedItem = 0;\n\t\t\tdivCash.style.display = 'none';\n\t\t\tdivCheck.style.display = 'none';\n\t\t\tdivCC.style.display = 'none';\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction validateRefTrans(field, limit)\n{\n\tif (field.value > limit)\n\t{\n\t\talert('Limited to ' + limit + '.');\n\t\tfield.value = limit;\n\t}\n\n\tif (field.value < 0)\n\t{\n\t\talert('Must be a positive number.');\n\t\tfield.value = 0;\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction payAmountChange(value)\n{\n\treportPaymentStatus(false);\n}\n\nfunction resetPendingDelayedPayment(balance)\n{\n\tvar idElem = document.getElementById('PendingDP');\n\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(org_dp_amount);\n\n\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(org_dp_amount);\n\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(0);\n\n\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(org_dp_amount);\n\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(0);\n\n\t}\n\n}\n\nfunction adjustPendingDelayedPayment(balance)\n{\n\tvar idElem = document.getElementById('PendingDP');\n\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\n\t\tvar adjVal = org_dp_amount + (balance * 1);\n\t\tif (adjVal < 0)\n\t\t{\n\t\t\tbalance = adjVal * -1;\n\t\t\tadjVal = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbalance = 0;\n\t\t}\n\n\t\tdocument.getElementById('PendingDPAmount').value = formatAsMoney(adjVal);\n\t\tvar adjustmentAmount = getPendingDPAdjustment();\n\n\t\tif (adjustmentAmount > 0)\n\t\t{\n\t\t\tdocument.getElementById('adj_dp_amount_up').value = formatAsMoney(adjVal);\n\t\t\tdocument.getElementById('adjustment_amount_up').innerHTML = formatAsMoney(adjustmentAmount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdocument.getElementById('adj_dp_amount_down').value = formatAsMoney(adjVal);\n\t\t\tdocument.getElementById('adjustment_amount_down').innerHTML = formatAsMoney(adjustmentAmount * -1);\n\t\t}\n\n\t\treturn balance;\n\t}\n\telse\n\t{\n\t\treturn balance;\n\t}\n\n}\n\nfunction getPendingDPAdjustment()\n{\n\tvar idElem = document.getElementById('PendingDP');\n\tif (idElem)\n\t{\n\t\t// get original amount\n\t\tvar org_dp_amount = Number(document.getElementById('OriginalPendingDPAmount').value);\n\t\tvar adj_dp_amount = Number(document.getElementById('PendingDPAmount').value);\n\t\treturn formatAsMoney(adj_dp_amount - org_dp_amount);\n\t}\n\telse\n\t{\n\t\treturn 0;\n\t}\n\n\treturn 0;\n\n}\n\nfunction assignBalanceToRefTransactions(balance)\n{\n\tvar paymentCount = 0;\n\n\tvar prefix = 'RT_';\n\tif (balance < 0)\n\t{\n\t\tprefix = 'Cr_RT_';\n\t}\n\n\t// clear any previous values\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\t\tvar elname = 'RT_' + ident;\n\t\tpaymentCount++;\n\t\tdocument.getElementById('RT_' + ident).value = \"\";\n\t}\n\n\t// clear any previous values\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\n\t\t// alert('nuulify');\n\t\tvar elname = 'Cr_RT_' + ident;\n\t\t//\talert(elname);\n\t\tdocument.getElementById('Cr_RT_' + ident).value = \"\";\n\t}\n\n\tif (balance == 0)\n\t{\n\t\treportPaymentStatus(false);\n\t\treturn;\n\t}\n\n\tif (balance > 0)\n\t{\n\t\t//alert(\"doing it\");\n\t\t// first, use store credit\n\t\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t\t{\n\t\t\tvar amountCredit = 0;\n\t\t\tvar maxStoreCredit = Number($('#eoTotalStoreCredit').html());\n\t\t\t//alert(\"max: \" + maxStoreCredit);\n\n\t\t\tif (balance > maxStoreCredit)\n\t\t\t{\n\t\t\t\tamountCredit = maxStoreCredit;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tamountCredit = balance;\n\t\t\t}\n\n\t\t\t// alert(\"amountCredit: \" + amountCredit);\n\n\t\t\tdocument.getElementById('store_credits_amount').value = formatAsMoney(amountCredit);\n\t\t\tbalance -= amountCredit;\n\n\t\t\t// alert(\"balance: \" + balance);\n\t\t}\n\n\t\t// second, look for a payment that could handle the full credit/debit\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tif (balance <= existingPaymentAmountArray[ident].amount)\n\t\t\t{\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\n\t\t\t\trefTransField.value = formatAsMoney(balance);\n\t\t\t\treportPaymentStatus(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// otherwise just assign to the first one\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(balance);\n\t\t\tbreak;\n\t\t}\n\t}\n\telse\n\t{\n\t\t// balance < 0\n\t\t// first, look for a payment that could handle the full credit/debit\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t{\n\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t}\n\n\t\t\tif (balance >= (remainingFundsThisPayment * -1))\n\t\t\t{\n\t\t\t\trefTransField = document.getElementById(prefix + ident);\n\t\t\t\trefTransField.value = formatAsMoney(Math.abs(balance));\n\t\t\t\treportPaymentStatus(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t//if not found then we must spread the balance across multiple payments\n\t\tif (paymentCount > 1)\n\t\t{\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t\t{\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t\t}\n\n\t\t\t\tvar thisAmount = (remainingFundsThisPayment * -1);\n\n\t\t\t\tif (thisAmount < balance)\n\t\t\t\t{\n\t\t\t\t\tthisAmount = balance;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(Math.abs(thisAmount));\n\t\t\t\tbalance -= thisAmount;\n\n\t\t\t\tif (balance >= 0)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (paymentCount == 1)\n\t\t{\n\t\t\t// just assign the max amount, the remainder will need to be paid through another method\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\n\t\t\t\tvar remainingFundsThisPayment = existingPaymentAmountArray[ident].amount;\n\t\t\t\tif (existingPaymentAmountArray[ident].current_refunded_amount)\n\t\t\t\t{\n\t\t\t\t\tremainingFundsThisPayment = existingPaymentAmountArray[ident].amount - existingPaymentAmountArray[ident].current_refunded_amount;\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById(prefix + ident).value = formatAsMoney(remainingFundsThisPayment);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction storeCreditAmountChange(val)\n{\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\n\n\tif (amountCredit.valueOf() < val)\n\t{\n\t\t$('#store_credits_amount').val(amountCredit.valueOf());\n\n\t}\n\n\tpayAmountChange();\n}\n\nfunction storeCreditClick(obj)\n{\n\tvar amountElem = document.getElementById('store_credits_amount');\n\n\tvar amountCredit = Number($('#eoTotalStoreCredit').html());\n\n\tif (obj.checked && amountCredit > 0)\n\t{\n\n\t\tamountElem.disabled = false;\n\n\t\tvar balance_elem = document.getElementById('OEH_remaing_balance');\n\t\tif (balance_elem)\n\t\t{\n\t\t\tbalance = Number(balance_elem.innerHTML);\n\t\t}\n\n\t\tif (Number(amountElem.value) > balance && balance > 0)\n\t\t{\n\n\t\t\tamountElem.value = formatAsMoney(balance);\n\t\t}\n\n\t\tupdateChangeList();\n\n\t}\n\telse\n\t{\n\t\tamountElem.disabled = true;\n\t}\n\n\tcalculateTotal();\n\n\treportPaymentStatus(false);\n\n}\n\nfunction reportPaymentStatus(ignorePayment2)\n{\n\tvar balance_elem = document.getElementById('OEH_remaing_balance');\n\n\tvar balance = 0;\n\tif (balance_elem)\n\t{\n\t\tbalance = Number(balance_elem.innerHTML);\n\t}\n\n\tvar paymentsTotal = Number(0);\n\n\t// Total up any store credit\n\tif (document.getElementById('use_store_credits') && document.getElementById('use_store_credits').checked)\n\t{\n\t\tpaymentsTotal = (paymentsTotal * 1) + (1 * formatAsMoney(document.getElementById('store_credits_amount').value));\n\t}\n\n\tvar paySelElem = document.getElementById('payment1_type');\n\n\tif (!paySelElem)\n\t{\n\t\treturn;\n\t}\n\n\tvar paySel = paySelElem.value;\n\n\tvar pay1Amount = Number(0);\n\n\tswitch (paySel)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\t\t\t\tpay1Amount += Number(document.getElementById('RT_' + ident).value);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cc_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"CC_REFUND\":\n\t\t\tvar DirCreditCCAmount = Number(0);\n\t\t\tfor (ident in existingPaymentAmountArray)\n\t\t\t{\n\t\t\t\tDirCreditCCAmount += Number(document.getElementById('Dir_Cr_RT_' + ident).value);\n\t\t\t}\n\t\t\tpay1Amount = DirCreditCCAmount * -1;\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_cash_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_refund_cash_total_amount').value);\n\t\t\tpay1Amount = -pay1Amount;\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_check_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tpay1Amount = Number(document.getElementById('payment1_gc_total_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\tpay1Amount = Number(document.getElementById('debit_gift_card_amount').value);\n\n\t\t\tbreak;\n\t}\n\n\tif (ignorePayment2)\n\t{\n\t\tpay2Amount = Number(0);\n\t}\n\telse\n\t{\n\t\tpaySel2 = document.getElementById('payment2_type').value;\n\t\tvar pay2Amount = Number(0);\n\t\tswitch (paySel2)\n\t\t{\n\t\t\tcase \"CC\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cc_total_amount').value);\n\t\t\t\tbreak;\n\n\t\t\tcase \"CASH\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_cash_total_amount').value);\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpay2Amount = Number(document.getElementById('payment2_check_total_amount').value);\n\t\t\t\tbreak;\n\t\t}\n\n\t}\n\n\tvar storeCreditRefundElem = document.getElementById('storeCreditRefund');\n\tif (storeCreditRefundElem)\n\t{\n\t\treturnToStoreCredit = Number(storeCreditRefundElem.value * -1);\n\t}\n\telse\n\t{\n\t\treturnToStoreCredit = Number(0);\n\t}\n\n\tvar cashRefund = document.getElementById('credit_to_customer_refund_cash_amount');\n\tif (cashRefund)\n\t{\n\t\tcashRefund = Number(cashRefund.value * -1);\n\t}\n\telse\n\t{\n\t\tcashRefund = Number(0);\n\t}\n\n\t// Credit Card Refunds\n\tvar CreditCCAmount = Number(0);\n\tfor (ident in existingPaymentAmountArray)\n\t{\n\t\tCreditCCAmount += Number(document.getElementById('Cr_RT_' + ident).value);\n\t}\n\n\tif (isNaN(CreditCCAmount))\n\t{\n\t\tCreditCCAmount = Number(0);\n\t}\n\telse\n\t{\n\t\tCreditCCAmount = Number(CreditCCAmount * -1);\n\t}\n\n\tvar PenndingDPAdjustment = Number(getPendingDPAdjustment());\n\n\t// Note: refunds are now expressed as a negative. Payments total can be negative\n\tvar paymentsTotal = Number(paymentsTotal + pay1Amount + pay2Amount +\n\treturnToStoreCredit + CreditCCAmount + PenndingDPAdjustment + cashRefund);\n\n\t$('#payment_help_msg').removeClass('overpaid');\n\t// current costs are greater than current payments - money owed to store\n\n\tif (orderState != 'CANCELLED')\n\t{\n\n\t\tvar diff = Number((paymentsTotal * -1) + balance);\n\n\t\tif (diff < 0)\n\t\t{\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse if (diff > 0)\n\t\t{\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#payment_help_msg').html('').hide();\n\t\t}\n\t}\n\telse\n\t{\n\n\t\tvar diff = Number(paymentsTotal + balance);\n\n\t\tif (diff > 0)\n\t\t{\n\t\t\t$('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse if (diff < 0)\n\t\t{\n\t\t\t$('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#payment_help_msg').html('').hide();\n\t\t}\n\t}\n\n\t/*\n\t balance = Math.abs(balance);\n\t //\talert(\"balance: \" + balance);\n\n\t var diff = new Number(paymentsTotal - balance);\n\t //\talert(\"diff: \" + diff);\n\n\t $('#new_payments_total').val(paymentsTotal);\n\n\t $('#payment_help_msg').removeClass('overpaid').html('<span id=\"bal_due\">0.0</span>').show();\n\n\n\t if (orderState == 'CANCELLED')\n\t {\n\t if (diff < 0)\n\t {\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else if (diff > 0)\n\t {\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else\n\t {\n\t $('#payment_help_msg').html('').hide();\n\t }\n\t }\n\t else\n\t {\n\t if (paySel == 'CREDIT')\n\t {\n\t $('#payment_help_msg').html('<span id=\"bal_due\">No Charge</span>').show();\n\t }\n\t else if (diff < 0)\n\t {\n\t $('#payment_help_msg').addClass('overpaid').html('Overpaid by: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else if (diff > 0)\n\t {\n\t $('#payment_help_msg').html('Balance Due: $<span id=\"bal_due\">' + formatAsMoney(Math.abs(diff))).show() + \"</span>\";\n\t }\n\t else\n\t {\n\t $('#payment_help_msg').html('').hide();\n\t }\n\t }\n\t */\n\tupdateChangeList();\n}\n\nfunction toggle(obj)\n{\n\tvar el = document.getElementById(obj);\n\tel.style.display = (el.style.display != 'none' ? 'none' : '' );\n}\n\nvar target_prefix = \"payment1_\";\nvar scanPosition = 0;\nvar charIndex = 0;\nvar codes = [];\n\nfunction keyHandler2(evt)\n{\n\n\tevt = (evt) ? evt : event;\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\tcodes[charIndex++] = String.fromCharCode(charCode);\n\n\tif ((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\n\t{\n\t\tscanPosition = 1; //start of data\n\t}\n\telse if ((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\n\t{\n\t\tscanPosition = 2; // start of track 1\n\t}\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\n\t{\n\t\tscanPosition = 3;  // end of track 1\n\t}\n\telse if ((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\n\t{\n\t\tscanPosition = 0;  // end of track 2\n\t\tcharIndex = 0;\n\t\thandleSwipeCompletion();\n\t}\n}\n\nfunction endScanHandling()\n{\n\tdocument.getElementById('scanArea').style.display = \"none\";\n\tcodes.length = 0;\n\tscanPosition = 0;\n\tcharIndex = 0;\n\tdocument.getElementById('hidden_text_store').value = \"\";\n\n\tdocument.onkeypress = OMDefaultKeyHandler;\n\n}\n\nfunction prepareForCCSwipe(paymentNumber)\n{\n\n\tif (paymentNumber == 2)\n\t{\n\t\ttarget_prefix = 'payment2_';\n\t}\n\telse\n\t{\n\t\ttarget_prefix = 'payment1_';\n\t}\n\n\tdocument.onkeypress = keyHandler2;\n\tdocument.getElementById('scanArea').style.display = \"block\";\n\tdocument.getElementById('hidden_text_store').focus();\n\tdocument.getElementById('hidden_text_store').value = \"\";\n\n}\n\nfunction handleSwipeCompletion()\n{\n\tvar receivedText = codes.join(\"\");\n\n\tvar p = new SwipeParserObj(receivedText);\n\tvar parsedVersion = p.dump();\n\n\tvar re_visa = /^4[0-9]{12}([0-9]{3})?$/;\n\tvar re_mc = /^5[1-5][0-9]{14}$/;\n\tvar re_amex = /^3[47][0-9]{13}$/;\n\tvar re_disc = /^6011[0-9]{12}$/;\n\n\tvar card_type = false;\n\n\tif (re_visa.test(p.account))\n\t{\n\t\tcard_type = 'Visa';\n\t}\n\telse if (re_mc.test(p.account))\n\t{\n\t\tcard_type = 'Mastercard';\n\t}\n\telse if (re_amex.test(p.account))\n\t{\n\t\tcard_type = 'American Express';\n\t}\n\telse if (re_disc.test(p.account))\n\t{\n\t\tcard_type = 'Discover';\n\t}\n\n\tif (card_type)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccType').value = card_type;\n\t}\n\n\tdocument.getElementById(target_prefix + 'ccNumber').value = p.account;\n\tdocument.getElementById(target_prefix + 'ccNameOnCard').value = p.firstname + ' ' + p.surname;\n\tdocument.getElementById(target_prefix + 'ccMonth').value = p.exp_month;\n\n\tvar exp_year = p.exp_year;\n\tif (exp_year.length == 2)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year;\n\t}\n\telse if (exp_year.length == 4)\n\t{\n\t\tdocument.getElementById(target_prefix + 'ccYear').value = exp_year.substr(2);\n\t}\n\n\tendScanHandling();\n}"],"names":["originalMaxPPDeduction","selectedFreeMenuItem","couponFreeMenuItemRequired","handle_ltd_round_up","$","prop","orderState","is","GUEST_PREFERENCES","user_id","LTD_AUTO_ROUND_UP","value","orderInfo","ltd_round_up_value","attr","val","trigger","on","e","this","cookie","session_id","dd_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","div_id","confirm","remove","set_user_pref","index","buttons","Yes","No","Ask Again Later","calculateTotal","round_up_val","text","formatAsMoney","slideDown","slideUp","handleCouponCodeResult","json","validation_errors","printString","anError","html","show","coupon_code_discount_total","code_id","discount_method","entree_title","entree_servings","handleFreeMenuItem","coupon_obj","coupon_code","createBonusCredit","coupon","couponDiscountMethod","couponDiscountVar","discount_var","couponlimitedToFT","limit_to_finishing_touch","couponIsValidWithReferralCredit","valid_with_customer_referral_credit","couponIsValidWithPlatePoints","valid_with_plate_points_credits","maxPPDeduction","processCode","code","theForm","get","filterBundle","bundleBox","document","getElementById","checked","parameters","i","elements","length","name","STORE_DETAILS","id","d","Date","ajax","url","type","timeout","dataType","data","processor","op","org_ts","order_id","unique","getTime","order_state","params","success","processor_success","processor_message","error","objAJAXRequest","strError","response","removeCode","removeBonusCredit","couponFreeMenuItem","handle_free_menu_item_edit","menu_item_count","buildFreeMenuItemList","menu_item","price","expression","rebuildOrderItemsArray","menu_item_in_list","selected_menu_item_in_list","s","appendTo","each","orderItems","eval","item_title","stripLeadingZeroes","leadingZeroCount","retVal","len","slice","handlePlatePointsDiscount","isNaN","needPlatePointsMaxDiscountChangeWarning","Math","abs","maxPPCredit","curPPDiscount","cap","editCashCheckAmount","editCashCheckUpdate","new_total","Number","getGiftCardBalance","card_number","output","card_balance","request_uri","editCashCheckAmountCommit","alert","new_number","PATH","image_admin","fadeOut","showButtonProcessDelayedPaymentNow","PendingDPOriginalStatus","processPayment","order_number","credit_card_number","substr","transaction_id","transaction_date","payment_id","css","color","summary_date","canAdjustDelayedPayment","back_path","setDelayedPaymentStatusTo","PendingDPOriginalTransActionID","toLowerCase","setupCouponState","style","display","disabled","processDelayedPaymentStatus","old_status","new_status","store_id","status","text-decoration","canAutoAdjust","src","alt","pointToTransaction","processPointToTransaction","old_ref_number","new_ref_number","new_card_number","transactionid","new_card_type","unsetAutoAdjust","setAllPaymentFieldsToUnrequired","reqField","setAttribute","lastPayment1Type","changePayment1","mySelect","divGC","divCash","divRefundCash","divCheck","divCC","divCredit","divRef","divRefOther","refundDiv","dpAdjust","divDebitGiftCard","payment2","selected_ref","resetPendingDelayedPayment","amount","changePayment2","onPaymentSelected","balance","innerHTML","paymentsTotal","paySel","autoAdjBox","forceManualAutoAdjust","handleAutoAdjust","adjustPendingDelayedPayment","externalPaymentAmountArray","onPaymentDeselected","reportPaymentStatus","textBal","valueOf","divref2","selectedItem","validateRefTrans","field","limit","payAmountChange","idElem","org_dp_amount","adjVal","adjustmentAmount","getPendingDPAdjustment","adj_dp_amount","assignBalanceToRefTransactions","paymentCount","prefix","ident","existingPaymentAmountArray","elname","amountCredit","maxStoreCredit","refTransField","remainingFundsThisPayment","current_refunded_amount","thisAmount","storeCreditAmountChange","storeCreditClick","obj","amountElem","balance_elem","updateChangeList","ignorePayment2","paySelElem","pay1Amount","DirCreditCCAmount","pay2Amount","paySel2","storeCreditRefundElem","returnToStoreCredit","cashRefund","CreditCCAmount","PenndingDPAdjustment","removeClass","diff","addClass","toggle","el","target_prefix","scanPosition","charIndex","codes","keyHandler2","evt","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","onkeypress","OMDefaultKeyHandler","prepareForCCSwipe","paymentNumber","focus","receivedText","join","p","SwipeParserObj","parsedVersion","dump","re_visa","re_mc","re_amex","re_disc","card_type","test","account","firstname","surname","exp_month","exp_year"],"mappings":"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"}
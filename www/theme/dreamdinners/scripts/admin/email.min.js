function email_init(){handle_email_submit(),handle_recipient_delete()}function handle_email_submit(){$("#email_form").submit((function(){if(message="",$("#sender_name").length&&!$("#sender_name").val()&&(message+="<li>From Name</li>"),$("#sender_email").val()||$("#sender_email_dropdown").val()||(message+="<li>From Email</li>"),$("#recipient_list").find(".recipient").length||(message+="<li>Recipient</li>"),$("#email_subject").val()||(message+="<li>Subject</li>"),$("iframe").contents().find("#tinyeditor").html()&&$("#email_body").val($("iframe").contents().find("#tinyeditor").html()),$("#email_body").val()||(message+="<li>Message</li>"),message)return dd_message({title:"The following fields are required",message:"<ul>"+message+"</ul>"}),!1;if($("#email_attachment").val()){var e=$("#email_attachment").val().split(".").pop().toLowerCase();if(-1==$.inArray(e,$.phpVar.js_extensions))return dd_message({title:"Invalid file extension",message:"Only "+$.phpVar.extensions+" allowed."}),!1}$("#email_submit").hide(),$("#processing_message").show()}))}function addRecipient(e){$('.delete[data-user_id="'+$(e).data("user_id")+'"]').length?$('.delete[data-user_id="'+$(e).data("user_id")+'"]').parent().parent().hide().show("pulsate"):($("#recipient_list_end").before($('<div class="recipient"><span class="name" data-tooltip="'+$(e).data("primary_email")+'">'+$(e).data("firstname")+" "+$(e).data("lastname")+' <svg class="delete icon white icon-cancel-circle" data-user_id="'+$(e).data("user_id")+'"><use xlink:href="#icon-cancel-circle"></use></svg></span></div>').show("pulsate")),$("#email_form").prepend($('<input type="hidden" name="recipient['+$(e).data("user_id")+']" id="recipient['+$(e).data("user_id")+']" value="'+$(e).data("user_id")+'" />')),data_tooltips_init())}function handle_recipient_delete(){$("#recipient_list").on("click",".recipient",(function(e){e.stopPropagation()})),$("#recipient_list").on("click",".delete",(function(e){e.stopPropagation();var i=$(this).data("user_id"),t=$(this).parent().parent();$("#recipient\\["+i+"\\]").remove(),$.fn.qtip&&$(this).parent().qtip("destroy"),$(t).hide("puff",(function(){$(t).remove()}))}))}function emailCancel(){bounce($.phpVar.page_back)}function resetAttachment(){$("#email_attachment").val("")}function tinyeditor(){new TINY.editor.edit("editor",{id:"email_body",width:"100%",height:175,cssclass:"te",controlclass:"tecontrol",rowclass:"teheader",dividerclass:"tedivider",controls:["bold","italic","underline","strikethrough","|","subscript","superscript","|","orderedlist","unorderedlist","|","outdent","indent","|","leftalign","centeralign","rightalign","blockjustify","|","unformat","|","undo","redo","n","font","size","style","|","image","hr","link","unlink","|","cut","copy","paste","print"],footer:!1,fonts:["Verdana","Arial","Georgia","Trebuchet MS"],xhtml:!0,cssfile:PATH.css+"/admin/tinyeditor.css",bodyid:"tinyeditor",footerclass:"tefooter",toggle:{text:"show source",activetext:"show wysiwyg",cssclass:"toggle"},resize:{cssclass:"resize"}})}
let sidesDataArray=[];let notShown=true;function menu_editor_init(){init_sales_mix_editing();init_week_inventory_editing();init_override_inventory_editing();init_inventory_calculation();init_saving_guest_counts();init_saving_store_sales_mix();init_resetting_store_sales_mix();init_finalize_preorder();init_save_sides_inventory();init_save_EFL_inventory();init_saving_override_inventory();init_saving_week_inventory();init_show_actuals();init_export_sales();init_reset_to_current();reconcile_data();calculatePage();initNavTab();$("#itemsTbl, #ctsItemsTbl").stickyTableHeaders();if(!menuState.hasSavedPreOrder){$("[id^='finalize_week_']").each(function(){$(this).addClass("disabled")})}}function initNavTab(){var e=$("#inv_mgr").attr("href");var t=e.substring(0,e.indexOf("&tabs"));const a=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});t=t+"&tabs="+a.tabs;$("#inv_mgr").attr("href",t);$(".tab").each(function(){$(this).on("click",function(){var e=$("#inv_mgr").attr("href");var t=e.substring(0,e.indexOf("&tab"));t=t+"&tabs=menu."+$(this).data("tabid");$("#inv_mgr").attr("href",t)})})}function init_reset_to_current(){$("#reset_to_current").on("click",function(){bootbox.confirm("Are you sure you wish to reset the Inventory Manager to last published values? You will lose any unsaved changes.",function(e){if(e){location.reload()}})})}function init_export_sales(){$("#export_menu_sales").on("click",function(){let t=false;$("[id^='wta']").each(function(){if($(this).hasClass("dirty")){t=true}});if(!menuState.hasSavedPreOrder||t){let e="";if(!menuState.hasSavedPreOrder){e="The Pre-Order has not been finalized. This export function will export values currently stored in the database."}if(t){if(e==""){e="There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first."}else{e+="There are also unsaved weekly projections. You may want to save these value first."}}e+="<br /><br />Do you want to continue with the export?";dd_message({title:"Export PreOrder",message:e,modal:true,width:400,height:300,confirm:function(){let e="main.php?page=admin_menu_inventory_mgr&op=export_month_sales_projection&store="+gStore_ID+"&menu_id="+menu_id;window.location=e}})}else{let e="main.php?page=admin_menu_inventory_mgr&op=export_month_sales_projection&store="+gStore_ID+"&menu_id="+menu_id;window.location=e}});$("[id^='export_week_']").on("click",function(){let e=this.id.split("_")[2];let t=false;$("[id^='wta"+e+"']").each(function(){if($(this).hasClass("dirty")){t=true}});if(!menuState.hasSavedPreOrder||t){let e="";if(!menuState.hasSavedPreOrder){e="The Pre-Order has not been finalized. This export function will export values currently stored in the database."}if(t){if(e==""){e="There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first."}else{e+="There are also unsaved weekly projections. You may want to save these value first."}}e+="<br /><br />Do you want to continue with the export?";dd_message({title:"Export PreOrder",message:e,modal:true,width:400,height:300,confirm:function(){let e=$(this).data("week_start");let t="main.php?page=admin_menu_inventory_mgr&op=export_weekly_sales&store="+gStore_ID+"&weekStart="+e+"&menu_id="+menu_id;window.location=t}})}else{let e=$(this).data("week_start");let t="main.php?page=admin_menu_inventory_mgr&op=export_weekly_sales&store="+gStore_ID+"&weekStart="+e+"&menu_id="+menu_id;window.location=t}});$("[id^='export_by_range']").on("click",function(){let e=this.id.split("_")[2];let t=false;$("[id^='wta"+e+"']").each(function(){if($(this).hasClass("dirty")){t=true}});if(!menuState.hasSavedPreOrder||t){let e="";if(!menuState.hasSavedPreOrder){e="The Pre-Order has not been finalized. This export function will export values currently stored in the database."}if(t){if(e==""){e="There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first."}else{e+="There are also unsaved weekly projections. You may want to save these value first."}}e+="<br /><br />Do you want to continue with the export?";dd_message({title:"Export PreOrder By Range",message:e,modal:true,width:400,height:300,confirm:function(){let e=$("[name='range_day_start']").val();let t=$("[name='range_day_end']").val();let a="main.php?page=admin_menu_inventory_mgr&op=export_sales_by_range&store="+gStore_ID+"&start="+e+"&end="+t+"&menu_id="+menu_id;window.location=a}})}else{let e=$("[name='range_day_start']").val();let t=$("[name='range_day_end']").val();let a="main.php?page=admin_menu_inventory_mgr&op=export_sales_by_range&store="+gStore_ID+"&start="+e+"&end="+t+"&menu_id="+menu_id;window.location=a}});$("#export_EFL_sales").on("click",function(){let e="main.php?page=admin_menu_inventory_mgr&op=export_EFL_sales&store="+gStore_ID+"&menu_id="+menu_id;window.location=e});$(".expand_export").click(function(){$header=$(this);$content=$("#export_by_dates");$header.html(function(){return"<span class='button'>Export By Date</span>"});$content.slideToggle(500,function(){})})}function init_show_actuals(){$("#show_actuals").on("click",function(){let e=$(this).html();if(e=="View Servings Sold"){$(this).html("Hide Servings Sold");$("[id^='tr_act_']").each(function(){let e=$(this).val();let t=this.id.split("_")[2];$(this).removeClass("collapse")})}else{$(this).html("View Servings Sold");$("[id^='tr_act_']").each(function(){let e=$(this).val();let t=this.id.split("_")[2];$(this).addClass("collapse")})}})}function init_save_EFL_inventory(){$("#save_efl_inv").on("click",function(){dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to save EFL Available to Promise inventory?",modal:true,width:400,height:180,confirm:function(){let a={};$("[id^='ofi_']").each(function(){let e=$(this).val();let t=this.id.split("_")[1];a[t]=e});displayModalWaitDialog("MIM_progress","Saving EFL Inventory ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:a},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='ofi_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved");let e=$(this).val()*1;$(this).data("org_val",e);$(this).removeClass("dirty")})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}})})}function init_save_sides_inventory(){$("#save_sides_inv").on("click",function(){dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to save Sides Available to Promise inventory?",modal:true,width:400,height:150,confirm:function(){var a={};$("[id^='ori_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];a[t]=e});displayModalWaitDialog("MIM_progress","Saving Sides Inventory ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:a,save_to_global:true},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='ori_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved");var e=$(this).val()*1;$(this).data("org_val",e);$(this).removeClass("dirty")})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}})})}function dd_round_amount(e){e+=5e-6;var t=e*1e3;t=parseInt(t);t=t/10;var a=t-Math.floor(t);if(a>=.5){t=Math.floor(t)+1}else{t=Math.floor(t)}return t/100}function validateSalesMix(){var t=0;$("[id^='ssmx_']").each(function(){var e=dd_round_amount($(this).val()*1);t+=e;t=dd_round_amount(t);if(t>1e4){alert("Invalid entry");return false}});if(t*100!=1e4){var e=dd_round_amount(Math.abs(t-100));var a="";if(t>100){a+="Remove a total of "+e+" from one more items to establish a 100.0% total"}else{a+="Add a total of "+e+" from one more items to establish a 100.0% total"}$("#page_error_display").html("The Store Sales Mix does not equal 100% ("+t+"). <br />"+a);return false}$("#page_error_display").html("");return true}function init_week_inventory_editing(){$("[id^='wta']").on("change",function(){var e=$(this).data("org_val")*1;var t=$(this).val()*1;if(e!=t){$(this).addClass("dirty")}else{$(this).removeClass("dirty")}reconcile_weeks_to_monthly_projection()})}function init_override_inventory_editing(){$("[id^='ofi_']").on("change",function(){var e=$(this).data("org_val")*1;var t=$(this).val()*1;if(e!=t){$(this).addClass("dirty")}else{$(this).removeClass("dirty")}var a=Number($(this).data("numsold"));if($(this).val()<a){dd_message({title:"Error",message:"The Override Inventory must be greater than or equal to the number sold."});$(this).val(a)}var i=this.id.split("_")[1];$("#atos_"+i).html($(this).val()-a.valueOf())});$("[id^='ori_']").on("change",function(){var e=$(this).data("org_val")*1;var t=$(this).val()*1;if(e!=t){$(this).addClass("dirty")}else{$(this).removeClass("dirty")}var a=Number($(this).data("number_sold"));if($(this).val()<a){dd_message({title:"Error",message:"The Override Inventory must be greater than or equal to the number sold."});$(this).val(a)}var i=this.id.split("_")[1];$("#atos_"+i).html($(this).val()-a.valueOf())})}function reconcile_data(){validateSalesMix();reconcile_weeks_to_monthly_projection()}function reconcile_weeks_to_monthly_projection(){$("[id^='poi_']").each(function(){var e=$(this).html();var t=this.id.split("_")[1];var a=$("#wta1_"+t).val()*1+$("#wta2_"+t).val()*1+$("#wta3_"+t).val()*1+$("#wta4_"+t).val()*1;if($("#wta5_"+t)[0]){a+=$("#wta5_"+t).val()*1}$("#pwt_"+t).html(a);var i=Number($("#ovi_"+t).data("numsold"));if(a==0){a=$("#cur_adj_inv_"+t).data("default_inventory")*1}$("#cur_adj_inv_"+t).html(a);$("#cur_rmg_"+t).html(a-i.valueOf());if(a!=e&&a!=0){let e=USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING;if(!USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING){let e="The entered servings number for a particular menu item have deviated from the original preordered amount. Please note that deviations from the preorder can create excess or a shortage of inventory. If you have exceeded your preorder, please contact your AE to secure adequate inventory. By clicking 'Okay' you are acknowledging this information.";dd_message({title:"Variance from Pre-order",message:"<div>"+e+"</div><div style='margin:5px;'><input type='checkbox' id='WEEKLY_INVENTORY_WARNING' name='WEEKLY_INVENTORY_WARNING' />&nbsp;<label for='WEEKLY_INVENTORY_WARNING'>Do not show this warning.</label></div>",closeCallback:function(){if($("#WEEKLY_INVENTORY_WARNING").is(":checked")){USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING=1;set_user_pref("HAS_SEEN_ELEMENT",USER_PREFERENCES.HAS_SEEN_ELEMENT.value,USER_DETAILS.id,null)}}})}$(this).addClass("warning_text")}else{$(this).removeClass("warning_text")}})}function init_finalize_preorder(){$("#finalize_preorder").on("click",function(){$("[id^='poi_']").each(function(){var e=$(this).html();if(e=="0"){dd_message({title:"Error",message:"<h4>Zero Projected Inventory Encountered</h4> Please be sure that all items have a non-zero sales mix or that you have clicked the 'Calculate Projected Inventory' Button."})}});dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to Finalize the Pre-Order Projected  Inventory?",modal:true,width:400,height:150,confirm:function(){var e={};var a={};var i={};var s={};var r={};var o={};var t=false;var n=null;var d=null;var l=null;var _=null;$("[id^='pwt_']").each(function(){n=$(this).html();d=this.id.split("_")[1];e[d]=n;l=$("#ovi_"+d).data("numsold");if(l>n&&!t){_=$("#rname_"+d).html();t=true;return false}});if(t){dd_message({title:"Error",div_id:"neg_warn",height:300,modal:true,message:"Recipe "+_+" (ID "+d+") has currently sold "+l+" servings and the projected amount is less than that."+" This would create negative inventory.  Please increase the projection."})}else{$("[id^='wta1_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];a[t]=e});$("[id^='wta2_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];i[t]=e});$("[id^='wta3_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];s[t]=e});$("[id^='wta4_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];r[t]=e});$("[id^='wta5_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];o[t]=e});displayModalWaitDialog("MIM_progress","Finalizing Core Menu Projections ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_preorder_inventory",store_id:gStore_ID,menu_id:menu_id,preorderInventory:e,week1Inv:a,week2Inv:i,week3Inv:s,week4Inv:r,week5Inv:o},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='finalize_week_']").each(function(){$(this).removeClass("disabled")});$("[id^='td_poi_']").each(function(){$(this).removeClass("static_unsaved_even");$(this).addClass("static_saved_even")});$("[id^='td_pwt_']").each(function(){$(this).removeClass("static_unsaved_odd");$(this).addClass("static_saved_odd")});$("[id^='td_wt1_']").each(function(){$(this).removeClass("static_unsaved_even");$(this).addClass("static_saved_even")});$("[id^='wta1_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved")});$("[id^='td_wt2_']").each(function(){$(this).removeClass("static_unsaved_even");$(this).addClass("static_saved_even")});$("[id^='wta2_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved")});$("[id^='td_wt3_']").each(function(){$(this).removeClass("static_unsaved_even");$(this).addClass("static_saved_even")});$("[id^='wta3_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved")});$("[id^='td_wt4_']").each(function(){$(this).removeClass("static_unsaved_even");$(this).addClass("static_saved_even")});$("[id^='wta4_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved")});$("[id^='td_wt5_']").each(function(){$(this).removeClass("static_unsaved_even");$(this).addClass("static_saved_even")});$("[id^='wta5_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved")});$("[id^='ovi_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved")});$("[id^='pwt_']").each(function(){var e=$(this).html();var t=this.id.split("_")[1];$("#cur_adj_inv_"+t).html(e);$("#cur_adj_inv_"+t).data("default_inventory",e);var a=$("#ovi_"+t).data("numsold");$("#cur_rmg_"+t).html(e-a);$("#ovi_"+t).val(e);$("#ovi_"+t).data("org_val",e);$("#pts-td_"+t).data("tooltip","Stored inventory: "+e+" Remaining: "+(e-a))});data_tooltips_init();$("[id^='wta1_']").each(function(){var e=$(this).val();$(this).data("org_val",e)});$("[id^='wta2_']").each(function(){var e=$(this).val();$(this).data("org_val",e)});$("[id^='wta3_']").each(function(){var e=$(this).val();$(this).data("org_val",e)});$("[id^='wta4_']").each(function(){var e=$(this).val();$(this).data("org_val",e)});$("[id^='wta5_']").each(function(){var e=$(this).val();$(this).data("org_val",e)})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}}})})}function init_saving_guest_counts(){$("#save_guest_counts").on("click",function(){var e=$("#regular_guest_count_goal").val();var t=$("#taste_guest_count_goal").val();var a=$("#intro_guest_count_goal").val();displayModalWaitDialog("MIM_progress","Saving  Guest Count Projections ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_guest_counts",store_id:gStore_ID,menu_anchor_date:menu_anchor_date,numRegGuests:e,numTasteGuests:t,numIntroGuests:a},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("#regular_guest_count_goal").removeClass("unsaved");$("#regular_guest_count_goal").addClass("saved");$("#intro_guest_count_goal").removeClass("unsaved");$("#intro_guest_count_goal").addClass("saved");$("#taste_guest_count_goal").removeClass("unsaved");$("#taste_guest_count_goal").addClass("saved")}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})})}function init_saving_week_inventory(){$("[id^='finalize_week_']").on("click",function(){if($(this).hasClass("disabled")){return}var t=this.id.split("_")[2];var e=sumAndStoreOverrideInventory(t,true);if(e!==false){var a=e[0];var i=e[1];var s=$("#rname_"+a).html();dd_message({title:"Error",div_id:"neg_warn",height:300,modal:true,message:"Recipe "+s+" (ID "+a+") has currently sold "+i+" servings and the projected amount is less than that."+" This would create negative inventory.  Please increase the projection."});return false}dd_message({title:"Finalize Week",message:"Are you sure you wish to Finalize the Weekly Projected Inventory for week"+t+"?<br /><br />(This will increase the Available to Promise total that controls availability on your menus.)",modal:true,width:400,height:150,confirm:function(){var a={};$("[id^='wta"+t+"_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];a[t]=e});displayModalWaitDialog("MIM_progress","Saving Week "+t+" Inventory ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"finalize_week",week_number:t,store_id:gStore_ID,menu_id:menu_id,overrideValues:a},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='wta"+t+"_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved");var e=$(this).val()*1;$(this).data("org_val",e);$(this).removeClass("dirty")});sumAndStoreOverrideInventory(t,false)}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}})})}function sumAndStoreOverrideInventory(i,e){var s={};$("[id^='poi_']").each(function(){var e=this.id.split("_")[1];var t=0;if(i==1){t+=$("#wta1_"+e).val()*1}else{t+=$("#wta1_"+e).data("org_val")*1}if(i==2){t+=$("#wta2_"+e).val()*1}else{t+=$("#wta2_"+e).data("org_val")*1}if(i==3){t+=$("#wta3_"+e).val()*1}else{t+=$("#wta3_"+e).data("org_val")*1}if(i==4){t+=$("#wta4_"+e).val()*1}else{t+=$("#wta4_"+e).data("org_val")*1}if($("#wta5_"+e)[0]){if(i==5){t+=$("#wta5_"+e).val()*1}else{t+=$("#wta5_"+e).data("org_val")*1}}s[e]=t;var a=Number($("#ovi_"+e).data("numsold"));$("cur_rmg_"+e).html(t-a.valueOf())});if(e){var t=false;var a=null;var r=null;$("[id^='ovi_']").each(function(){a=this.id.split("_")[1];var e=s[a];r=$(this).data("numsold");if(r>e){t=true;return false}});if(t){return[a,r]}else{return false}}displayModalWaitDialog("MIM_progress","Saving Override Inventory ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:s},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='ovi_']").each(function(){var e=this.id.split("_")[1];var t=s[e];$(this).data("org_val",t);$(this).val(t);$("#cur_adj_inv_"+e).html(t);var a=$(this).data("numsold");$("#cur_rmg_"+e).html(t-a);$("#pts-td_"+e).data("tooltip","Stored inventory: "+t+" Remaining: "+(t-a));$("#cur_adj_inv_"+e).data("default_inventory",t)})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}function init_saving_override_inventory(){$("#save_override_inventory").on("click",function(){dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to save the Core Menu Available to Promise inventory?",modal:true,width:400,height:150,confirm:function(){var a={};$("[id^='ovi_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];a[t]=e});displayModalWaitDialog("MIM_progress","Saving Core Inventory ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:a},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='ovi_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved");var e=$(this).val()*1;$(this).data("org_val",e);$(this).removeClass("dirty")})}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})}})})}function init_resetting_store_sales_mix(){$("#reset_sales_mix").on("click",function(){dd_message({title:"Finalize Week",message:"Are you sure you want to reset your store's sales mix to national values?",modal:true,width:400,height:150,confirm:function(){$("[id^='nsm_']").each(function(){var e=$(this).html();var t=this.id.split("_")[1];$("#ssmx_"+t).val(e)});validateSalesMix();$("[id^='ssmx_']").each(function(){var e=$(this).data("org_val")*1;var t=$(this).val()*1;if(e!=t){$(this).addClass("dirty")}else{$(this).removeClass("dirty")}})}})})}function init_saving_store_sales_mix(){$("#save_sales_mix").on("click",function(){var a={};$("[id^='ssmx_']").each(function(){var e=$(this).val();var t=this.id.split("_")[1];a[t]=e});displayModalWaitDialog("MIM_progress","Saving Store Sales Mix  ...");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_store_sales_mix",store_id:gStore_ID,menu_id:menu_id,storeSalesMix:a},success:function(e){$("#MIM_progress").remove();if(e.processor_success){$("[id^='ssmx_']").each(function(){$(this).removeClass("unsaved");$(this).addClass("saved");var e=$(this).val()*1;$(this).data("org_val",e);$(this).removeClass("dirty")});menuState.hasSavedStoreMix=true}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,t){$("#MIM_progress").remove();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})})}let starterPackMix={};function setNormalizedStarterPackMix(){$("[id^='ssmx_']").each(function(){var e=$(this).val()/100;var t=this.id.split("_")[1];var a=$(this).data("is_intro");if(a){starterPackMix[t]=e}});let t=0;for(let e in starterPackMix){t+=starterPackMix[e]}let a=1/t;for(let e in starterPackMix){starterPackMix[e]=starterPackMix[e]*a}}let workShopMix={};function setNormalizedWorkshopMix(){$("[id^='ssmx_']").each(function(){var e=$(this).val()/100;var t=this.id.split("_")[1];var a=$(this).data("is_taste");if(a){workShopMix[t]=e}});let t=0;for(let e in workShopMix){t+=workShopMix[e]}let a=1/t;for(let e in workShopMix){workShopMix[e]=workShopMix[e]*a}}function init_inventory_calculation(){$("#calc_inv").on("click",function(){if(!validateSalesMix()){return}setNormalizedWorkshopMix();setNormalizedStarterPackMix();var v=29;var c=$("#regular_guest_count_goal").val();var h=$("#taste_guest_count_goal").val();var m=$("#intro_guest_count_goal").val();$("[id^='ssmx_']").not('[data-is_bundle="1"]').each(function(){var e=$(this).val()/100;var t=this.id.split("_")[1];var a=$(this).data("is_intro");var i=$(this).data("is_taste");var s=c*v*e;if(a){s+=m*12*starterPackMix[t]}if(i){s+=h*9*workShopMix[t]}s=Math.round(s);$("#poi_"+t).html(s);$("#pwt_"+t).html(s);$("#cur_adj_inv_"+t).html(s);$("#ovi_"+t).val(s);var r=0;for(x in weekInfo){var o=weekInfo[x]["menu_week_number"];var n="wt"+o+"_"+t;var d="wta"+o+"_"+t;var l=weekInfo[x]["distribution_percent"]/100;var _=Math.round(l*s);r+=_;$("#"+n).html(_);$("#"+d).val(_)}if(r!=s){var u=r-s;_-=u;$("#"+n).html(_);$("#"+d).val(_)}reconcile_weeks_to_monthly_projection()})})}function init_sales_mix_editing(){$("[id^='ssmx_']").on("change",function(){validateSalesMix();var e=$(this).data("org_val")*1;var t=$(this).val()*1;if(e!=t){$(this).addClass("dirty")}else{$(this).removeClass("dirty")}})}function resetPage(){document.getElementById("action").value="menuChange";document.getElementById("menu_editor_form").submit()}function displayValidationErrorMsg(e){e="<span style='color:red; font-size:larger;'>"+e+"</span>";dd_message({title:"Error",message:e})}function clearErrors(){var e=document.getElementById("errorMsg");e.style.display="none";statusTextDiv=document.getElementById("errorMsgText");statusTextDiv.innerHTML=""}function storeChange(e){document.getElementById("action").value="storeChange";document.getElementById("menu_editor_form").submit()}function menuChange(e){document.getElementById("action").value="menuChange";document.getElementById("menu_editor_form").submit()}function calculatePage(){var e=false;var t=0;var a=document.getElementById("itemsTbl").rows;for(var i=0;i<a.length;i++){if(a[i].id.indexOf("row_")==-1){continue}var s=null;if(a[i].id=="addonEditorRow"){s=a[i].getAttribute("item_id");if(!s){}}else{s=a[i].id.substr(4)}}var r=document.getElementById("EFLitemsTbl").rows;for(var i=0;i<r.length;i++){if(r[i].id.indexOf("row_")==-1){continue}var s=null;if(r[i].id=="addonEditorRow"){s=r[i].getAttribute("item_id");if(!s){}}else{s=r[i].id.substr(4)}}var o=document.getElementById("ctsItemsTbl").rows;for(i=0;i<o.length;i++){if(o[i].id.indexOf("row_")==-1){continue}var s=null;s=o[i].id.substr(4)}}function confirm_and_check_form(){var e=$("#menu_editor_form")[0];clearErrors();validated=_check_form(e);var t=document.getElementById("itemsTbl").rows;for(var a=0;a<t.length;a++){if(t[a].id.indexOf("row_")==-1){continue}var i=t[a].id.substr(4)}var s=document.getElementById("EFLitemsTbl").rows;for(var a=0;a<s.length;a++){if(s[a].id.indexOf("row_")==-1){continue}var i=s[a].id.substr(4)}var r=document.getElementById("ctsItemsTbl").rows;for(a=0;a<r.length;a++){if(r[a].id.indexOf("row_")==-1){continue}var i=r[a].id.substr(4)}if(message!=""){validated=false;displayValidationErrorMsg(message)}if(validated){var o="Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.";dd_message({title:"Attention",message:o,modal:true,confirm:function(){document.getElementById("action").value="finalize";$("#menu_editor_form").submit();return false},cancel:function(){return false}});``}return false}
//# sourceMappingURL=menu_inv_mgr.min.js.map
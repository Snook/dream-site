let sidesDataArray=[],notShown=!0;function menu_editor_init(){init_sales_mix_editing(),init_week_inventory_editing(),init_override_inventory_editing(),init_inventory_calculation(),init_saving_guest_counts(),init_saving_store_sales_mix(),init_resetting_store_sales_mix(),init_finalize_preorder(),init_save_sides_inventory(),init_save_EFL_inventory(),init_saving_override_inventory(),init_saving_week_inventory(),init_show_actuals(),init_export_sales(),init_reset_to_current(),reconcile_data(),calculatePage(),initNavTab(),$("#itemsTbl, #ctsItemsTbl").stickyTableHeaders(),menuState.hasSavedPreOrder||$("[id^='finalize_week_']").each((function(){$(this).addClass("disabled")}))}function initNavTab(){var e=$("#inv_mgr").attr("href"),t=e.substring(0,e.indexOf("&tabs"));t=t+"&tabs="+new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).tabs,$("#inv_mgr").attr("href",t),$(".tab").each((function(){$(this).on("click",(function(){var e=$("#inv_mgr").attr("href"),t=e.substring(0,e.indexOf("&tab"));t=t+"&tabs=menu."+$(this).data("tabid"),$("#inv_mgr").attr("href",t)}))}))}function init_reset_to_current(){$("#reset_to_current").on("click",(function(){bootbox.confirm("Are you sure you wish to reset the Inventory Manager to last published values? You will lose any unsaved changes.",(function(e){e&&location.reload()}))}))}function init_export_sales(){$("#export_menu_sales").on("click",(function(){let e=!1;if($("[id^='wta']").each((function(){$(this).hasClass("dirty")&&(e=!0)})),!menuState.hasSavedPreOrder||e){let t="";menuState.hasSavedPreOrder||(t="The Pre-Order has not been finalized. This export function will export values currently stored in the database."),e&&(""==t?t="There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first.":t+="There are also unsaved weekly projections. You may want to save these value first."),t+="<br /><br />Do you want to continue with the export?",dd_message({title:"Export PreOrder",message:t,modal:!0,width:400,height:300,confirm:function(){let e="/backoffice/menu_inventory_mgr?op=export_month_sales_projection&store="+gStore_ID+"&menu_id="+menu_id;window.location=e}})}else{let e="/backoffice/menu_inventory_mgr?op=export_month_sales_projection&store="+gStore_ID+"&menu_id="+menu_id;window.location=e}})),$("[id^='export_week_']").on("click",(function(){let e=this.id.split("_")[2],t=!1;if($("[id^='wta"+e+"']").each((function(){$(this).hasClass("dirty")&&(t=!0)})),!menuState.hasSavedPreOrder||t){let e="";menuState.hasSavedPreOrder||(e="The Pre-Order has not been finalized. This export function will export values currently stored in the database."),t&&(""==e?e="There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first.":e+="There are also unsaved weekly projections. You may want to save these value first."),e+="<br /><br />Do you want to continue with the export?",dd_message({title:"Export PreOrder",message:e,modal:!0,width:400,height:300,confirm:function(){let e=$(this).data("week_start"),t="/backoffice/menu_inventory_mgr?op=export_weekly_sales&store="+gStore_ID+"&weekStart="+e+"&menu_id="+menu_id;window.location=t}})}else{let e=$(this).data("week_start"),t="/backoffice/menu_inventory_mgr?op=export_weekly_sales&store="+gStore_ID+"&weekStart="+e+"&menu_id="+menu_id;window.location=t}})),$("[id^='export_by_range']").on("click",(function(){let e=this.id.split("_")[2],t=!1;if($("[id^='wta"+e+"']").each((function(){$(this).hasClass("dirty")&&(t=!0)})),!menuState.hasSavedPreOrder||t){let e="";menuState.hasSavedPreOrder||(e="The Pre-Order has not been finalized. This export function will export values currently stored in the database."),t&&(""==e?e="There are unsaved weekly projections. The export will use values currently stored in the database. You may want to save these value first.":e+="There are also unsaved weekly projections. You may want to save these value first."),e+="<br /><br />Do you want to continue with the export?",dd_message({title:"Export PreOrder By Range",message:e,modal:!0,width:400,height:300,confirm:function(){let e=$("[name='range_day_start']").val(),t=$("[name='range_day_end']").val(),s="/backoffice/menu_inventory_mgr?op=export_sales_by_range&store="+gStore_ID+"&start="+e+"&end="+t+"&menu_id="+menu_id;window.location=s}})}else{let e=$("[name='range_day_start']").val(),t=$("[name='range_day_end']").val(),s="/backoffice/menu_inventory_mgr?op=export_sales_by_range&store="+gStore_ID+"&start="+e+"&end="+t+"&menu_id="+menu_id;window.location=s}})),$("#export_EFL_sales").on("click",(function(){let e="/backoffice/menu_inventory_mgr?op=export_EFL_sales&store="+gStore_ID+"&menu_id="+menu_id;window.location=e})),$(".expand_export").click((function(){$header=$(this),$content=$("#export_by_dates"),$header.html((function(){return"<span class='btn btn-primary btn-sm'>Export By Date</span>"})),$content.slideToggle(500,(function(){}))}))}function init_show_actuals(){$("#show_actuals").on("click",(function(){"View Servings Sold"==$(this).html()?($(this).html("Hide Servings Sold"),$("[id^='tr_act_']").each((function(){$(this).val(),this.id.split("_")[2];$(this).removeClass("collapse")}))):($(this).html("View Servings Sold"),$("[id^='tr_act_']").each((function(){$(this).val(),this.id.split("_")[2];$(this).addClass("collapse")})))}))}function init_save_EFL_inventory(){$("#save_efl_inv").on("click",(function(){dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to save EFL Available to Promise inventory?",modal:!0,width:400,height:180,confirm:function(){let e={};$("[id^='ofi_']").each((function(){let t=$(this).val(),s=this.id.split("_")[1];e[s]=t})),displayModalWaitDialog("MIM_progress","Saving EFL Inventory ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:e},success:function(e){$("#MIM_progress").remove(),e.processor_success?$("[id^='ofi_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved");let e=1*$(this).val();$(this).data("org_val",e),$(this).removeClass("dirty")})):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}})}))}function init_save_sides_inventory(){$("#save_sides_inv").on("click",(function(){dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to save Sides Available to Promise inventory?",modal:!0,width:400,height:150,confirm:function(){var e={};$("[id^='ori_']").each((function(){var t=$(this).val(),s=this.id.split("_")[1];e[s]=t})),displayModalWaitDialog("MIM_progress","Saving Sides Inventory ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:e,save_to_global:!0},success:function(e){$("#MIM_progress").remove(),e.processor_success?$("[id^='ori_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved");var e=1*$(this).val();$(this).data("org_val",e),$(this).removeClass("dirty")})):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}})}))}function dd_round_amount(e){var t=1e3*(e+=5e-6);return t=parseInt(t),(t=(t/=10)-Math.floor(t)>=.5?Math.floor(t)+1:Math.floor(t))/100}function validateSalesMix(){var e=0;if($("[id^='ssmx_']").each((function(){var t=dd_round_amount(1*$(this).val());if((e=dd_round_amount(e+=t))>1e4)return alert("Invalid entry"),!1})),100*e!=1e4){var t=dd_round_amount(Math.abs(e-100)),s="";return s+=e>100?"Remove a total of "+t+" from one more items to establish a 100.0% total":"Add a total of "+t+" from one more items to establish a 100.0% total",$("#page_error_display").html("The Store Sales Mix does not equal 100% ("+e+"). <br />"+s),!1}return $("#page_error_display").html(""),!0}function init_week_inventory_editing(){$("[id^='wta']").on("change",(function(){1*$(this).data("org_val")!=1*$(this).val()?$(this).addClass("dirty"):$(this).removeClass("dirty"),reconcile_weeks_to_monthly_projection()}))}function init_override_inventory_editing(){$("[id^='ofi_']").on("change",(function(){1*$(this).data("org_val")!=1*$(this).val()?$(this).addClass("dirty"):$(this).removeClass("dirty");var e=Number($(this).data("numsold"));$(this).val()<e&&(dd_message({title:"Error",message:"The Override Inventory must be greater than or equal to the number sold."}),$(this).val(e));var t=this.id.split("_")[1];$("#atos_"+t).html($(this).val()-e.valueOf())})),$("[id^='ori_']").on("change",(function(){1*$(this).data("org_val")!=1*$(this).val()?$(this).addClass("dirty"):$(this).removeClass("dirty");var e=Number($(this).data("number_sold"));$(this).val()<e&&(dd_message({title:"Error",message:"The Override Inventory must be greater than or equal to the number sold."}),$(this).val(e));var t=this.id.split("_")[1];$("#atos_"+t).html($(this).val()-e.valueOf())}))}function reconcile_data(){validateSalesMix(),reconcile_weeks_to_monthly_projection()}function reconcile_weeks_to_monthly_projection(){$("[id^='poi_']").each((function(){var e=$(this).html(),t=this.id.split("_")[1],s=1*$("#wta1_"+t).val()+1*$("#wta2_"+t).val()+1*$("#wta3_"+t).val()+1*$("#wta4_"+t).val();$("#wta5_"+t)[0]&&(s+=1*$("#wta5_"+t).val()),$("#pwt_"+t).html(s);var a=Number($("#ovi_"+t).data("numsold"));if(0==s&&(s=1*$("#cur_adj_inv_"+t).data("default_inventory")),$("#cur_adj_inv_"+t).html(s),$("#cur_rmg_"+t).html(s-a.valueOf()),s!=e&&0!=s){USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING;if(!USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING){dd_message({title:"Variance from Pre-order",message:"<div>"+"The entered servings number for a particular menu item have deviated from the original preordered amount. Please note that deviations from the preorder can create excess or a shortage of inventory. If you have exceeded your preorder, please contact your AE to secure adequate inventory. By clicking 'Okay' you are acknowledging this information."+"</div><div style='margin:5px;'><input type='checkbox' id='WEEKLY_INVENTORY_WARNING' name='WEEKLY_INVENTORY_WARNING' />&nbsp;<label for='WEEKLY_INVENTORY_WARNING'>Do not show this warning.</label></div>",closeCallback:function(){$("#WEEKLY_INVENTORY_WARNING").is(":checked")&&(USER_PREFERENCES.HAS_SEEN_ELEMENT.value.WEEKLY_INVENTORY_WARNING=1,set_user_pref("HAS_SEEN_ELEMENT",USER_PREFERENCES.HAS_SEEN_ELEMENT.value,USER_DETAILS.id,null))}})}$(this).addClass("warning_text")}else $(this).removeClass("warning_text")}))}function init_finalize_preorder(){$("#finalize_preorder").on("click",(function(){$("[id^='poi_']").each((function(){"0"==$(this).html()&&dd_message({title:"Error",message:"<h4>Zero Projected Inventory Encountered</h4> Please be sure that all items have a non-zero sales mix or that you have clicked the 'Calculate Projected Inventory' Button."})})),dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to Finalize the Pre-Order Projected  Inventory?",modal:!0,width:400,height:150,confirm:function(){var e={},t={},s={},a={},i={},r={},o=!1,n=null,d=null,_=null,l=null;$("[id^='pwt_']").each((function(){if(n=$(this).html(),d=this.id.split("_")[1],e[d]=n,(_=$("#ovi_"+d).data("numsold"))>n&&!o)return l=$("#rname_"+d).html(),o=!0,!1})),o?dd_message({title:"Error",div_id:"neg_warn",height:300,modal:!0,message:"Recipe "+l+" (ID "+d+") has currently sold "+_+" servings and the projected amount is less than that. This would create negative inventory.  Please increase the projection."}):($("[id^='wta1_']").each((function(){var e=$(this).val(),s=this.id.split("_")[1];t[s]=e})),$("[id^='wta2_']").each((function(){var e=$(this).val(),t=this.id.split("_")[1];s[t]=e})),$("[id^='wta3_']").each((function(){var e=$(this).val(),t=this.id.split("_")[1];a[t]=e})),$("[id^='wta4_']").each((function(){var e=$(this).val(),t=this.id.split("_")[1];i[t]=e})),$("[id^='wta5_']").each((function(){var e=$(this).val(),t=this.id.split("_")[1];r[t]=e})),displayModalWaitDialog("MIM_progress","Finalizing Core Menu Projections ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_preorder_inventory",store_id:gStore_ID,menu_id:menu_id,preorderInventory:e,week1Inv:t,week2Inv:s,week3Inv:a,week4Inv:i,week5Inv:r},success:function(e){$("#MIM_progress").remove(),e.processor_success?($("[id^='finalize_week_']").each((function(){$(this).removeClass("disabled")})),$("[id^='td_poi_']").each((function(){$(this).removeClass("static_unsaved_even"),$(this).addClass("static_saved_even")})),$("[id^='td_pwt_']").each((function(){$(this).removeClass("static_unsaved_odd"),$(this).addClass("static_saved_odd")})),$("[id^='td_wt1_']").each((function(){$(this).removeClass("static_unsaved_even"),$(this).addClass("static_saved_even")})),$("[id^='wta1_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved")})),$("[id^='td_wt2_']").each((function(){$(this).removeClass("static_unsaved_even"),$(this).addClass("static_saved_even")})),$("[id^='wta2_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved")})),$("[id^='td_wt3_']").each((function(){$(this).removeClass("static_unsaved_even"),$(this).addClass("static_saved_even")})),$("[id^='wta3_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved")})),$("[id^='td_wt4_']").each((function(){$(this).removeClass("static_unsaved_even"),$(this).addClass("static_saved_even")})),$("[id^='wta4_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved")})),$("[id^='td_wt5_']").each((function(){$(this).removeClass("static_unsaved_even"),$(this).addClass("static_saved_even")})),$("[id^='wta5_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved")})),$("[id^='ovi_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved")})),$("[id^='pwt_']").each((function(){var e=$(this).html(),t=this.id.split("_")[1];$("#cur_adj_inv_"+t).html(e),$("#cur_adj_inv_"+t).data("default_inventory",e);var s=$("#ovi_"+t).data("numsold");$("#cur_rmg_"+t).html(e-s),$("#ovi_"+t).val(e),$("#ovi_"+t).data("org_val",e),$("#pts-td_"+t).data("tooltip","Stored inventory: "+e+" Remaining: "+(e-s))})),data_tooltips_init(),$("[id^='wta1_']").each((function(){var e=$(this).val();$(this).data("org_val",e)})),$("[id^='wta2_']").each((function(){var e=$(this).val();$(this).data("org_val",e)})),$("[id^='wta3_']").each((function(){var e=$(this).val();$(this).data("org_val",e)})),$("[id^='wta4_']").each((function(){var e=$(this).val();$(this).data("org_val",e)})),$("[id^='wta5_']").each((function(){var e=$(this).val();$(this).data("org_val",e)}))):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}}))}})}))}function init_saving_guest_counts(){$("#save_guest_counts").on("click",(function(){var e=$("#regular_guest_count_goal").val(),t=$("#taste_guest_count_goal").val(),s=$("#intro_guest_count_goal").val();displayModalWaitDialog("MIM_progress","Saving  Guest Count Projections ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_guest_counts",store_id:gStore_ID,menu_anchor_date:menu_anchor_date,numRegGuests:e,numTasteGuests:t,numIntroGuests:s},success:function(e){$("#MIM_progress").remove(),e.processor_success?($("#regular_guest_count_goal").removeClass("unsaved"),$("#regular_guest_count_goal").addClass("saved"),$("#intro_guest_count_goal").removeClass("unsaved"),$("#intro_guest_count_goal").addClass("saved"),$("#taste_guest_count_goal").removeClass("unsaved"),$("#taste_guest_count_goal").addClass("saved")):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}))}function init_saving_week_inventory(){$("[id^='finalize_week_']").on("click",(function(){if(!$(this).hasClass("disabled")){var e=this.id.split("_")[2],t=sumAndStoreOverrideInventory(e,!0);if(!1!==t){var s=t[0],a=t[1],i=$("#rname_"+s).html();return dd_message({title:"Error",div_id:"neg_warn",height:300,modal:!0,message:"Recipe "+i+" (ID "+s+") has currently sold "+a+" servings and the projected amount is less than that. This would create negative inventory.  Please increase the projection."}),!1}dd_message({title:"Finalize Week",message:"Are you sure you wish to Finalize the Weekly Projected Inventory for week"+e+"?<br /><br />(This will increase the Available to Promise total that controls availability on your menus.)",modal:!0,width:400,height:150,confirm:function(){var t={};$("[id^='wta"+e+"_']").each((function(){var e=$(this).val(),s=this.id.split("_")[1];t[s]=e})),displayModalWaitDialog("MIM_progress","Saving Week "+e+" Inventory ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"finalize_week",week_number:e,store_id:gStore_ID,menu_id:menu_id,overrideValues:t},success:function(t){$("#MIM_progress").remove(),t.processor_success?($("[id^='wta"+e+"_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved");var e=1*$(this).val();$(this).data("org_val",e),$(this).removeClass("dirty")})),sumAndStoreOverrideInventory(e,!1)):dd_message({title:"Error",message:t.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}})}}))}function sumAndStoreOverrideInventory(e,t){var s={};if($("[id^='poi_']").each((function(){var t=this.id.split("_")[1],a=0;a+=1==e?1*$("#wta1_"+t).val():1*$("#wta1_"+t).data("org_val"),a+=2==e?1*$("#wta2_"+t).val():1*$("#wta2_"+t).data("org_val"),a+=3==e?1*$("#wta3_"+t).val():1*$("#wta3_"+t).data("org_val"),a+=4==e?1*$("#wta4_"+t).val():1*$("#wta4_"+t).data("org_val"),$("#wta5_"+t)[0]&&(a+=5==e?1*$("#wta5_"+t).val():1*$("#wta5_"+t).data("org_val")),s[t]=a;var i=Number($("#ovi_"+t).data("numsold"));$("cur_rmg_"+t).html(a-i.valueOf())})),t){var a=!1,i=null,r=null;return $("[id^='ovi_']").each((function(){i=this.id.split("_")[1];var e=s[i];if((r=$(this).data("numsold"))>e)return a=!0,!1})),!!a&&[i,r]}displayModalWaitDialog("MIM_progress","Saving Override Inventory ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:s},success:function(e){$("#MIM_progress").remove(),e.processor_success?$("[id^='ovi_']").each((function(){var e=this.id.split("_")[1],t=s[e];$(this).data("org_val",t),$(this).val(t),$("#cur_adj_inv_"+e).html(t);var a=$(this).data("numsold");$("#cur_rmg_"+e).html(t-a),$("#pts-td_"+e).data("tooltip","Stored inventory: "+t+" Remaining: "+(t-a)),$("#cur_adj_inv_"+e).data("default_inventory",t)})):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}function init_saving_override_inventory(){$("#save_override_inventory").on("click",(function(){dd_message({title:"Finalize PreOrder",message:"Are you sure you wish to save the Core Menu Available to Promise inventory?",modal:!0,width:400,height:150,confirm:function(){var e={};$("[id^='ovi_']").each((function(){var t=$(this).val(),s=this.id.split("_")[1];e[s]=t})),displayModalWaitDialog("MIM_progress","Saving Core Inventory ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_override_inventory",store_id:gStore_ID,menu_id:menu_id,overrideValues:e},success:function(e){$("#MIM_progress").remove(),e.processor_success?$("[id^='ovi_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved");var e=1*$(this).val();$(this).data("org_val",e),$(this).removeClass("dirty")})):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}})}))}function init_resetting_store_sales_mix(){$("#reset_sales_mix").on("click",(function(){dd_message({title:"Finalize Week",message:"Are you sure you want to reset your store's sales mix to national values?",modal:!0,width:400,height:150,confirm:function(){$("[id^='nsm_']").each((function(){var e=$(this).html(),t=this.id.split("_")[1];$("#ssmx_"+t).val(e)})),validateSalesMix(),$("[id^='ssmx_']").each((function(){1*$(this).data("org_val")!=1*$(this).val()?$(this).addClass("dirty"):$(this).removeClass("dirty")}))}})}))}function init_saving_store_sales_mix(){$("#save_sales_mix").on("click",(function(){var e={};$("[id^='ssmx_']").each((function(){var t=$(this).val(),s=this.id.split("_")[1];e[s]=t})),displayModalWaitDialog("MIM_progress","Saving Store Sales Mix  ..."),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_menuEditor",op:"save_store_sales_mix",store_id:gStore_ID,menu_id:menu_id,storeSalesMix:e},success:function(e){$("#MIM_progress").remove(),e.processor_success?($("[id^='ssmx_']").each((function(){$(this).removeClass("unsaved"),$(this).addClass("saved");var e=1*$(this).val();$(this).data("org_val",e),$(this).removeClass("dirty")})),menuState.hasSavedStoreMix=!0):dd_message({title:"Error",message:e.processor_message})},error:function(e,t){$("#MIM_progress").remove(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}))}let starterPackMix={};function setNormalizedStarterPackMix(){$("[id^='ssmx_']").each((function(){var e=$(this).val()/100,t=this.id.split("_")[1];$(this).data("is_intro")&&(starterPackMix[t]=e)}));let e=0;for(let t in starterPackMix)e+=starterPackMix[t];let t=1/e;for(let e in starterPackMix)starterPackMix[e]=starterPackMix[e]*t}let workShopMix={};function setNormalizedWorkshopMix(){$("[id^='ssmx_']").each((function(){var e=$(this).val()/100,t=this.id.split("_")[1];$(this).data("is_taste")&&(workShopMix[t]=e)}));let e=0;for(let t in workShopMix)e+=workShopMix[t];let t=1/e;for(let e in workShopMix)workShopMix[e]=workShopMix[e]*t}function init_inventory_calculation(){$("#calc_inv").on("click",(function(){if(validateSalesMix()){setNormalizedWorkshopMix(),setNormalizedStarterPackMix();var e=$("#regular_guest_count_goal").val(),t=$("#taste_guest_count_goal").val(),s=$("#intro_guest_count_goal").val();$("[id^='ssmx_']").not('[data-is_bundle="1"]').each((function(){var a=$(this).val()/100,i=this.id.split("_")[1],r=$(this).data("is_intro"),o=$(this).data("is_taste"),n=29*e*a;r&&(n+=12*s*starterPackMix[i]),o&&(n+=9*t*workShopMix[i]),n=Math.round(n),$("#poi_"+i).html(n),$("#pwt_"+i).html(n),$("#cur_adj_inv_"+i).html(n),$("#ovi_"+i).val(n);var d=0;for(x in weekInfo){var _=weekInfo[x].menu_week_number,l="wt"+_+"_"+i,c="wta"+_+"_"+i,u=weekInfo[x].distribution_percent/100,v=Math.round(u*n);d+=v,$("#"+l).html(v),$("#"+c).val(v)}d!=n&&(v-=d-n,$("#"+l).html(v),$("#"+c).val(v));reconcile_weeks_to_monthly_projection()}))}}))}function init_sales_mix_editing(){$("[id^='ssmx_']").on("change",(function(){validateSalesMix(),1*$(this).data("org_val")!=1*$(this).val()?$(this).addClass("dirty"):$(this).removeClass("dirty")}))}function resetPage(){document.getElementById("action").value="menuChange",document.getElementById("menu_editor_form").submit()}function displayValidationErrorMsg(e){e="<span style='color:red; font-size:larger;'>"+e+"</span>",dd_message({title:"Error",message:e})}function clearErrors(){document.getElementById("errorMsg").style.display="none",statusTextDiv=document.getElementById("errorMsgText"),statusTextDiv.innerHTML=""}function storeChange(e){document.getElementById("action").value="storeChange",document.getElementById("menu_editor_form").submit()}function menuChange(e){document.getElementById("action").value="menuChange",document.getElementById("menu_editor_form").submit()}function calculatePage(){for(var e=document.getElementById("itemsTbl").rows,t=0;t<e.length;t++)if(-1!=e[t].id.indexOf("row_")){"addonEditorRow"==e[t].id?e[t].getAttribute("item_id"):e[t].id.substr(4)}var s=document.getElementById("EFLitemsTbl").rows;for(t=0;t<s.length;t++)if(-1!=s[t].id.indexOf("row_")){"addonEditorRow"==s[t].id?s[t].getAttribute("item_id"):s[t].id.substr(4)}var a=document.getElementById("ctsItemsTbl").rows;for(t=0;t<a.length;t++)if(-1!=a[t].id.indexOf("row_")){a[t].id.substr(4)}}function confirm_and_check_form(){var e=$("#menu_editor_form")[0];clearErrors(),validated=_check_form(e);for(var t=document.getElementById("itemsTbl").rows,s=0;s<t.length;s++)if(-1!=t[s].id.indexOf("row_"))t[s].id.substr(4);var a=document.getElementById("EFLitemsTbl").rows;for(s=0;s<a.length;s++)if(-1!=a[s].id.indexOf("row_"))a[s].id.substr(4);var i=document.getElementById("ctsItemsTbl").rows;for(s=0;s<i.length;s++)if(-1!=i[s].id.indexOf("row_"))i[s].id.substr(4);if(""!=message&&(validated=!1,displayValidationErrorMsg(message)),validated){dd_message({title:"Attention",message:"Are you sure want to submit these changes to your menu? If the menu is active the changes will be immediately available to your customers.",modal:!0,confirm:function(){return document.getElementById("action").value="finalize",$("#menu_editor_form").submit(),!1},cancel:function(){return!1}})}return!1}
//# sourceMappingURL=menu_inv_mgr.min.js.map
var hasChangedCOGS=false;function reports_p_and_l_init(){$("html").bind("keypress",function(e){if(e.keyCode==13){return false}});init_money_formatting();init_update_p_and_l_data();$(".gt_input").each(function(){$(this).val(addFormatting($(this).val()))});window.onbeforeunload=function(e){if(detectChanges()){var t="Important: Please click on 'Save' button to leave this page.";if(typeof e=="undefined"){e=window.event}if(e){e.returnValue=t}return t}}}function init_money_formatting(){$(".gt_input").focus(function(){$(this).val(removeFormatting($(this).val()))});$(".gt_input").blur(function(){$(this).val(addFormatting($(this).val()))});$(".gt_input").keypress(function(e){if(e.which==188||e.which==190||e.which==46||e.which==45||e.keyCode==8||e.keyCode==9||e.keyCode==37||e.keyCode==39||e.keyCode==45||e.which>47&&e.which<58){return true}else if(e.keyCode==13){$(this).blur();return true}else return false});$(".gt_input").change(function(){if(isNaN($(this).val()))return false})}function detectChanges(){var a=false;$("#finance_div input").each(function(){if(this.id!="other_expenses"){var e=$(this).data("org_value");var t=removeFormatting($(this).val());if(e*1!=t*1){$(this).addClass("unsaved_field");a=true}else{$(this).removeClass("unsaved_field")}}});return a}function init_update_p_and_l_data(){var e=new Number(0);$('[data-dd_subtype="expense"]').each(function(){e+=new Number(removeFormatting($(this).val()))});var t=new Number(removeFormatting($("#p_and_l_total_agr").html()));var n=new Number(removeFormatting($("#p_and_l_marketing_total").html()));var r=new Number(removeFormatting($("#p_and_l_royalty_total").html()));var a=new Number(removeFormatting($("#net_income").val()));var o=new Number(removeFormatting($("#p_and_l_salesforce_fee").html()));$("#other_expenses").val(addFormatting(t-(e+n+r+o)-a));$(".gt_input").keyup(function(){var e=new Number(removeFormatting($("#net_income").val()));var t=new Number(0);$('[data-dd_subtype="expense"]').each(function(){t+=new Number(removeFormatting($(this).val()))});var a=new Number(removeFormatting($("#p_and_l_total_agr").html()));$("#other_expenses").val(addFormatting(a-(t+n+r+o)-e))});$("#update_p_and_l").click(function(){var e=false;$("#owner_hours, #employee_hours, #manager_hours").each(function(){if(isNaN($(this).val())){dd_message({title:"Error",message:"The hours fields must be a number."});e=true}});if(e){return false}var t=new Object;$("#finance_div input").each(function(){t[this.id]=removeFormatting($(this).val())});$("#finance_div input").each(function(){if(t[this.id]=="")t[this.id]="not supplied"});if($("#cost_of_goods_and_services").data("org_value")!=$("#cost_of_goods_and_services").val()){hasChangedCOGS=true}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_p_and_l_data",store_id:store_id,month:month,year:year,p_and_l_data:t},success:function(e){if(e.processor_success){dd_toast({message:"Your data was saved."});if(hasChangedCOGS){hasChangedCOGS=false;$("#cogs_msg").html("")}$("#finance_div input").each(function(){if(this.id!="other_expenses"){var e=removeFormatting($(this).val());$(this).data("org_value",e);$(this).removeClass("unsaved_field")}})}else{dd_message({title:"Error",message:e.processor_message});detectChanges()}},error:function(e,t){response="Unexpected error: "+t;dd_message({title:"Error",message:response})}});return false})}function roundToTenths(e){e-=0;e=Math.round(e*10)/10;return e==Math.floor(e)?e+".0":e==Math.floor(e)?e+"0":e}function doRunReport(){var e=parseInt($("#year_field_001").val());if(isNaN(e)){dd_message({title:"Error",message:"The year is not an integer."});return false}else if(e<2011){dd_message({title:"Error",message:"The year must be greater than 2010."});return false}$("#avg_ticket_goal").remove();$("#finishing_touch_goal").remove();$("#taste_sessions_goal").remove();$("#regular_guest_count_goal").remove();$("#taste_guest_count_goal").remove();$("#intro_guest_count_goal").remove();$("[data-dd_type='p&l_widget']").remove();$("#p_and_l_form").submit()}function _report_submitClick(e){var t=true;if(detectChanges()){t=false;dd_message({title:"Unsaved Changes",message:"You have some unsaved changes. Click 'Cancel' to return and save your changes.",cancel:function(){},confirm:function(){return doRunReport()}})}if(t){return doRunReport()}}function removeFormatting(e){if(e==null||e=="")return e;e=e.replace(/,/,"");e=e.replace(/\$/,"");return e}function addFormatting(e){if(e==null||e=="")return"";e=accounting.formatMoney(e,"$",2,",",".","%s%v");return e}
//# sourceMappingURL=reports_p_and_l_input.min.js.map
var open_state_cookie_name="";var select_state_cookie_name="";var current_date_range_start=null;var current_date_range_duration=null;var current_selected_item=null;function reports_food_sales_init(){open_state_cookie_name=false;select_state_cookie_name=false;if(show_store_selectors){init_store_selector();init_store_selection()}init_date_selection()}function init_store_selection(){$("#set_selected_stores").off("click").on("click",function(e){var t=[];var r={};var s=$("#store_selector").jstree(true).get_selected();for(var i=0;i<s.length;++i){var o=$("#store_selector").jstree(true).get_node("#"+s[i]);if(o.state.hidden){$("#store_selector").jstree(true).deselect_node("#"+s[i]);continue}if(s[i].indexOf("tree_store")==0){var n=s[i].split("-");t[i]=n[1]}else if(s[i].indexOf("tree_state")==0){var _=$("#store_selector").jstree(true).get_node("#"+s[i]);r[_.text]={name:_.text,children:{}}}}for(var i=0;i<s.length;++i){var o=$("#store_selector").jstree(true).get_node("#"+s[i]);if(o.state.hidden){$("#store_selector").jstree(true).deselect_node("#"+s[i]);continue}if(s[i].indexOf("tree_store")==0){var _=$("#store_selector").jstree(true).get_node("#"+s[i]);var a=$("#store_selector").jstree(true).get_node("#"+_.parent);if(!r[a.text]){r[a.text]={name:a.text,children:{}}}r[a.text]["children"][_.text]=_.text}}var c="<div><ul>";for(var l in r){c+="<li>"+l;c+="<ul>";var d=r[l].children;for(thisTown in d){c+="<li>"+d[thisTown]+"</li>"}c+="</ul>"}c+="</ul>";$("#chosen_stores_inner").html(c);$("#chosen_stores").show();store_id=t;$("#store_selector_open").hide();$("#store_selector_closed").show()});$("#unset_selected_stores").off("click").on("click",function(e){$("#store_selector_open").show();$("#store_selector_closed").hide()})}function select_session(e){bounce("main.php?page=admin_main&session="+e,"_blank");$("#dd_session_selector").remove()}function select_order(e,t){bounce("main.php?page=admin_main&session="+t+"&order="+e,"_blank");$("#dd_session_selector").remove()}function init_session_popups(){$("[data-session_starts]").off("click").on("click",function(e){var t=$(this).data("session_starts");var r=$(this).data("session_ids");var s=$(this).data("order_ids");t=t.split(",");r=r.toString().split(",");s=s.toString().split(",");var o="<div>";for(i=0;i<t.length;i++){o+="<div><button class='button' onclick='select_session("+r[i]+");'>Go to "+t[i]+"</button>";o+="<button class='button' onclick='select_order("+s[i]+", "+r[i]+");'>Order "+s[i]+"</button></div>"}o+="</div>";dd_message({title:"Go to Session or Orders",width:300,message:o,div_id:"dd_session_selector"})})}function init_export_purchasers(){$("#export_purchasers").off("click").on("click",function(){var e=$("#order_since_menu_id").val();create_and_submit_form({action:"main.php?page=admin_reports_food_sales",input:{export:"xlsx",range_start:current_date_range_start,duration:current_date_range_duration,store_id:store_id,omit_menu_id:e,items:current_selected_item}})})}function init_show_purchasers(){$("#guest_list_outer").html("");$("[id^='rid_']").off("click").on("click",function(){var e=[];var t=$("#order_since_menu_id").val();e.push(this.id.split("_")[1]);current_selected_item=this.id.split("_")[1];$("#menu_info_outer").hide();$("#guest_list_outer").html('<img style="margin-left:auto; margin-right:auto;" src="'+PATH.image+'/style/throbber_circle.gif" alt="" /> Processing...');$("#guest_list_outer").show();$.ajax({url:"ddproc.php?processor=admin_food_sales",type:"POST",dataType:"json",data:{op:"show_purchasers",range_start:current_date_range_start,duration:current_date_range_duration,store_id:store_id,omit_menu_id:t,items:e},success:function(e){$("#guest_list_outer").html(e.guest_data);$("#menu_info_outer").hide();init_session_popups();init_export_purchasers()},error:function(e,t){$("#guest_list_outer").hide();dd_message({title:"Error",message:t})}});return true})}function init_date_selection(){$("#set_date_range").off("click").on("click",function(){var e=$("input[name='pickDate']:checked").val();var t=false;var r=false;var s=false;var i=false;var o=true;switch(e){case"1":s=$("input[name='single_date']").val();break;case"2":s=$("input[name='range_day_start']").val();i=$("input[name='range_day_end']").val();break;case"3":t=$("#month_popup").val();r=$("#year_field_001").val();if($("input[name='menu_or_calendar']:checked").val()=="cal"){o=false}break;default:}$("#item_selector_inner").html('<img style="margin-left:auto; margin-right:auto;" src="'+PATH.image+'/style/throbber_circle.gif" alt="" /> Processing...');$("#menu_info_outer").html("");$("#guest_list_outer").html("");var n=$("#search_string").val();$.ajax({url:"ddproc.php?processor=admin_food_sales",type:"POST",dataType:"json",data:{op:"set_date_range",rangeType:e,month:t,year:r,dateStart:s,dateEnd:i,store_id:store_id,useMenuMonth:o,search_string:n},success:function(e){current_date_range_start=e.range_start_date;current_date_range_duration=e.range_duration;$("#item_list_title").html(e.title);$("#item_list_title").show();$("#item_selector_inner").html(e.item_data);init_show_purchasers();handle_menu_item_info_button();$("#item_selector_inner").removeClass("processing")},error:function(e,t){dd_message({title:"Error",message:t})}})})}function handle_menu_item_info_button(){$("[id^='rmid_']").off("click").on("click",function(){var e=$(this).data("entree_id");var t=this.id.split("_")[1];var r=$(this).data("menu_id");$("#menu_info_outer").show();$("#guest_list_outer").hide();current_selected_item=t;$("#menu_info_outer").html('<img style="margin-left:auto; margin-right:auto;" src="'+PATH.image+'/style/throbber_circle.gif" alt="" /> Processing...');$.ajax({url:"ddproc.php?processor=admin_food_sales",type:"POST",dataType:"json",data:{processor:"admin_food_sales",store_id:store_id,op:"menu_item_info",menu_id:r,entree_id:e,recipe_id:t},success:function(e){$("#menu_info_outer").html(e.data);handle_tabbed_content()},error:function(e,t){$("#menu_info_outer").hide();$("#guest_list_outer").show();response="Unexpected error: "+t;dd_message({title:"Error",message:response})}})})}
//# sourceMappingURL=reports_food_sales.min.js.map
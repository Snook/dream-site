var open_state_cookie_name="",select_state_cookie_name="",current_date_range_start=null,current_date_range_duration=null,current_selected_item=null;function reports_food_sales_init(){open_state_cookie_name=!1,select_state_cookie_name=!1,show_store_selectors&&(init_store_selector(),init_store_selection()),init_date_selection()}function init_store_selection(){$("#set_selected_stores").off("click").on("click",(function(e){for(var t=[],s={},r=$("#store_selector").jstree(!0).get_selected(),o=0;o<r.length;++o){if($("#store_selector").jstree(!0).get_node("#"+r[o]).state.hidden)$("#store_selector").jstree(!0).deselect_node("#"+r[o]);else if(0==r[o].indexOf("tree_store")){var i=r[o].split("-");t[o]=i[1]}else if(0==r[o].indexOf("tree_state")){s[(n=$("#store_selector").jstree(!0).get_node("#"+r[o])).text]={name:n.text,children:{}}}}for(o=0;o<r.length;++o){if($("#store_selector").jstree(!0).get_node("#"+r[o]).state.hidden)$("#store_selector").jstree(!0).deselect_node("#"+r[o]);else if(0==r[o].indexOf("tree_store")){var n=$("#store_selector").jstree(!0).get_node("#"+r[o]),_=$("#store_selector").jstree(!0).get_node("#"+n.parent);s[_.text]||(s[_.text]={name:_.text,children:{}}),s[_.text].children[n.text]=n.text}}var a="<div><ul>";for(var c in s){a+="<li>"+c,a+="<ul>";var l=s[c].children;for(thisTown in l)a+="<li>"+l[thisTown]+"</li>";a+="</ul>"}a+="</ul>",$("#chosen_stores_inner").html(a),$("#chosen_stores").show(),store_id=t,$("#store_selector_open").hide(),$("#store_selector_closed").show()})),$("#unset_selected_stores").off("click").on("click",(function(e){$("#store_selector_open").show(),$("#store_selector_closed").hide()}))}function select_session(e){bounce("/backoffice?session="+e,"_blank"),$("#dd_session_selector").remove()}function select_order(e,t){bounce("/backoffice?session="+t+"&order="+e,"_blank"),$("#dd_session_selector").remove()}function init_session_popups(){$("[data-session_starts]").off("click").on("click",(function(e){var t=$(this).data("session_starts"),s=$(this).data("session_ids"),r=$(this).data("order_ids");t=t.split(","),s=s.toString().split(","),r=r.toString().split(",");var o="<div>";for(i=0;i<t.length;i++)o+="<div><button class='button' onclick='select_session("+s[i]+");'>Go to "+t[i]+"</button>",o+="<button class='button' onclick='select_order("+r[i]+", "+s[i]+");'>Order "+r[i]+"</button></div>";o+="</div>",dd_message({title:"Go to Session or Orders",width:300,message:o,div_id:"dd_session_selector"})}))}function init_export_purchasers(){$("#export_purchasers").off("click").on("click",(function(){var e=$("#order_since_menu_id").val();create_and_submit_form({action:"/backoffice/reports_food_sales",input:{export:"xlsx",range_start:current_date_range_start,duration:current_date_range_duration,store_id:store_id,omit_menu_id:e,items:current_selected_item}})}))}function init_show_purchasers(){$("#guest_list_outer").html(""),$("[id^='rid_']").off("click").on("click",(function(){var e=[],t=$("#order_since_menu_id").val();return e.push(this.id.split("_")[1]),current_selected_item=this.id.split("_")[1],$("#menu_info_outer").hide(),$("#guest_list_outer").html('<img style="margin-left:auto; margin-right:auto;" src="'+PATH.image+'/style/throbber_circle.gif" alt="" /> Processing...'),$("#guest_list_outer").show(),$.ajax({url:"/processor?processor=admin_food_sales",type:"POST",dataType:"json",data:{op:"show_purchasers",range_start:current_date_range_start,duration:current_date_range_duration,store_id:store_id,omit_menu_id:t,items:e},success:function(e){$("#guest_list_outer").html(e.guest_data),$("#menu_info_outer").hide(),init_session_popups(),init_export_purchasers()},error:function(e,t){$("#guest_list_outer").hide(),dd_message({title:"Error",message:t})}}),!0}))}function init_date_selection(){$("#set_date_range").off("click").on("click",(function(){var e=$("input[name='pickDate']:checked").val(),t=!1,s=!1,r=!1,o=!1,i=!0;switch(e){case"1":r=$("input[name='single_date']").val();break;case"2":r=$("input[name='range_day_start']").val(),o=$("input[name='range_day_end']").val();break;case"3":t=$("#month_popup").val(),s=$("#year_field_001").val(),"cal"==$("input[name='menu_or_calendar']:checked").val()&&(i=!1)}$("#item_selector_inner").html('<img style="margin-left:auto; margin-right:auto;" src="'+PATH.image+'/style/throbber_circle.gif" alt="" /> Processing...'),$("#menu_info_outer").html(""),$("#guest_list_outer").html("");var n=$("#search_string").val();$.ajax({url:"/processor?processor=admin_food_sales",type:"POST",dataType:"json",data:{op:"set_date_range",rangeType:e,month:t,year:s,dateStart:r,dateEnd:o,store_id:store_id,useMenuMonth:i,search_string:n},success:function(e){current_date_range_start=e.range_start_date,current_date_range_duration=e.range_duration,$("#item_list_title").html(e.title),$("#item_list_title").show(),$("#item_selector_inner").html(e.item_data),init_show_purchasers(),handle_menu_item_info_button(),$("#item_selector_inner").removeClass("processing")},error:function(e,t){dd_message({title:"Error",message:t})}})}))}function handle_menu_item_info_button(){$("[id^='rmid_']").off("click").on("click",(function(){var e=$(this).data("entree_id"),t=this.id.split("_")[1],s=$(this).data("menu_id");$("#menu_info_outer").show(),$("#guest_list_outer").hide(),current_selected_item=t,$("#menu_info_outer").html('<img style="margin-left:auto; margin-right:auto;" src="'+PATH.image+'/style/throbber_circle.gif" alt="" /> Processing...'),$.ajax({url:"/processor?processor=admin_food_sales",type:"POST",dataType:"json",data:{processor:"admin_food_sales",store_id:store_id,op:"menu_item_info",menu_id:s,entree_id:e,recipe_id:t},success:function(e){$("#menu_info_outer").html(e.data),handle_tabbed_content()},error:function(e,t){$("#menu_info_outer").hide(),$("#guest_list_outer").show(),response="Unexpected error: "+t,dd_message({title:"Error",message:response})}})}))}
//# sourceMappingURL=reports_food_sales.min.js.map
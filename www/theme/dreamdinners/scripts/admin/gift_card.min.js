var useTransparentRedirect=false;var codes="";var i=0;var x=0;var browser=navigator.appName;function keyHandler(e){if(browser=="Microsoft Internet Explorer"){var a=document.all?event.keyCode:e.keyCode}else{var a=e.keyCode?e.keyCode:e.charCode}if(a==13){return false}if(a==94){if(codes.length>=15){var r=document.getElementById("gift_card_number");if(r)r.value=codes}else{codes="";i=0}return false}if(codes.length==15){return false}if(String.fromCharCode(a)=="%"&&i==0){i=1}else if(String.fromCharCode(a)=="B"&&i==1){i=2}else if(i==2&&(parseInt(a)>57||parseInt(a)<48)&&a!=94&&a!=8){return false}else if((parseInt(a)>57||parseInt(a)<48)&&i<2&&a!=94&&String.fromCharCode(a)!="B"&&a!=8){return false}if(String.fromCharCode(a)!="B"&&i==2){if(String.fromCharCode(a)!="^"){codes+=String.fromCharCode(a)}}}function _override_check_form(e){return false}function _submit_click(e){e.style.display="none";var a=$("#gift_card_load")[0];var r=_check_form(a);if(!r){document.getElementById("procCardLoadBtn").style.display="block"}else{var o=$("#amount").val();if(isNaN(o)||o<25||o>500){dd_message({title:"Error",message:"Please enter a dollar amount greater or equal to $25 and no greater than $500."});$("#amount").addClass("input_in_error");document.getElementById("procCardLoadBtn").style.display="block";return true}var t="Load Gift Card #"+$("#gift_card_number").val()+" by the amount of $"+formatAsMoney($("#amount").val())+"?";dd_message({title:"Submit Gift Card Order",message:t,modal:true,confirm:function(){if(useTransparentRedirect){getTokenAndSubmit()}else{submitDirect()}},cancel:function(){$("#procCardLoadBtn").show()}})}return true}function submitDirect(){$("<input>").attr({type:"hidden",name:"load_submit",value:"load_submit"}).appendTo($("#gift_card_load"));$("#gift_card_load").submit()}function getTokenAndSubmit(){displayModalWaitDialog("TR_process_dialog","Please wait as the payment is processed. This may take a short while.");var e=$("#billing_name").val();var a=$("#billing_address").val();var r=$("#billing_zip").val();var o=$("#primary_email").val();var t=new PayFlow_Payload;var d={bname:e,badd:a,bzip:r,bemail:o};var n=new PayFlow_Payload;n.addNameValuePair("UserID",0);n.addNameValuePair("StoreID",0);n.addNameValuePair("OrderID",0);n.addNameValuePair("Email",o);t.addAssocArray("billing_data",d);var i=$("#amount").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"admin_order_mgr_processor",store_id:store_id,op:"get_token",order_id:0,amount:i,billing_name:e,billing_address:a,billing_zip:r,use_corp:true,check_smart_transactions:true,dd_csrf_token:$("input[name=dd_csrf_token]","#gift_card_load").val(),chain_token:true},success:function(e){$("input[name=dd_csrf_token]","#gift_card_load").val(e.getTokenToken);if(e.processor_success){var a=e.token;submit_to_paypal(a,t,n)}else{$("#procCardLoadBtn").show();$("#TR_process_dialog").remove();dd_message({title:"Error",message:e.processor_message})}},error:function(e,a){$("#procCardLoadBtn").show();$("#TR_process_dialog").remove();response="Unexpected error: "+a;dd_message({title:"Error",message:response})}})}function submit_to_paypal(e,a,r){$("#paypal-result").on("load",function(){dd_console_log("frame is loading in submit_to_paypal()");try{var e=$("#paypal-result").get(0).contentWindow.next_dest;var a=$("#paypal-result").get(0).contentWindow.pp_success;dd_console_log("successful access with next_dest as "+e)}catch(e){dd_console_log("exception thrown accessing iFrame: "+e.message);$("#TR_process_dialog").remove();$("#procCardLoadBtn").show();dd_message({title:"Exception",message:"Some required information is missing or incorrect. Please correct the fields below and try again."});return}if(a){dd_console_log("sucess! about to bounce to "+e);bounce(e)}else{dd_console_log("failure! ");var r=$("#paypal-result").get(0).contentWindow.error_code;var o=$("#paypal-result").get(0).contentWindow.message;if(typeof o=="undefined"){dd_console_log("failure with no data! ");r="Generic";o="An unexpected error has occurred. It appears that the Gift Card processor is currently unavailable. Please contact Dream Dinners support at 1-360-804-2020."}$("#TR_process_dialog").remove();dd_message({title:"Error: "+r,message:o});$("#procCardLoadBtn").show()}});var o=$("#credit_card_exp_month").val();o+=$("#credit_card_exp_year").val();var t=$("#credit_card_cvv").val();var d=$("#amount").val();var n=$("#gift_card_number").val();var i=$("#credit_card_type").val();a.addNameValuePair("user_id",0);a.addNameValuePair("store_id",store_id);a.addNameValuePair("order_id","none");a.addNameValuePair("caller_id","fadmin_load");a.addNameValuePair("card_type",i);a.addNameValuePair("gcnum",n);a.addNameValuePair("admin_user_id",USER_DETAILS.id);if(typeof payflowErrorURL=="undefined"){payflowErrorURL="https://dreamdinners.com/ddproc.php?processor=admin_payflow_callback"}var s="ERRORURL="+payflowErrorURL+"&ACCT="+$("#credit_card_number").val()+"&EXPDATE="+o+"&CSC="+t+"&AMT="+d+"&USER1="+a.retrieveEncodedString()+"&COMMENT1="+r.retrieveEncodedString();var l="https://payflowlink.paypal.com";if(typeof pfp_test_mode!="undefined"&&pfp_test_mode){var l="https://pilot-payflowlink.paypal.com"}if(typeof transparent_redirect_link!="undefined"){l=transparent_redirect_link}dd_console_log("About to send! ");create_and_submit_form({action:l,target:"paypal-result",input:{SECURETOKEN:e.token,SECURETOKENID:e.tokenID,PARMLIST:s}})}
//# sourceMappingURL=gift_card.min.js.map
{"version":3,"file":"reports_p_and_l_input.min.js","names":["hasChangedCOGS","reports_p_and_l_init","$","bind","e","keyCode","init_money_formatting","init_update_p_and_l_data","each","this","val","addFormatting","window","onbeforeunload","event","detectChanges","message","returnValue","focus","removeFormatting","blur","keypress","which","change","isNaN","foundChange","id","data","addClass","removeClass","total_expenses","Number","agr","html","marketing_total","royalty_total","net_income","salesforce_fee","keyup","click","validation_error_occurred","dd_message","title","dataObj","ajax","url","type","timeout","dataType","processor","store_id","month","year","p_and_l_data","success","json","processor_success","dd_toast","cur","processor_message","error","objAJAXRequest","strError","response","roundToTenths","mnt","Math","round","floor","doRunReport","parseInt","remove","submit","_report_submitClick","form","canProceed","cancel","confirm","stringVal","replace","numericVal","accounting","formatMoney"],"sourceRoot":"js/src/dreamdinners/admin","sources":["reports_p_and_l_input.js"],"sourcesContent":["var hasChangedCOGS = false;\n\nfunction reports_p_and_l_init()\n{\n\n\t$('html').bind('keypress', function(e)\n\t{\n\t   if(e.keyCode == 13)\n\t   {\n\t      return false;\n\t   }\n\t});\n\n\n\tinit_money_formatting();\n\n\tinit_update_p_and_l_data();\n\n\n\t$(\".gt_input\").each(function() {\n\t\t$(this).val(addFormatting($(this).val()));\n\t});\n\n\n\twindow.onbeforeunload = function (event) {\n\t\tif (detectChanges())\n\t\t{\n\t\t    var message = 'Important: Please click on \\'Save\\' button to leave this page.';\n\t\t    if (typeof event == 'undefined') {\n\t\t        event = window.event;\n\t\t    }\n\t\t    if (event) {\n\t\t        event.returnValue = message;\n\t\t    }\n\t\t    return message;\n\t\t}\n\t};\n\n\n}\n\nfunction init_money_formatting()\n{\n\t$(\".gt_input\").focus(function() {\n\t\t$(this).val(removeFormatting($(this).val()));\n\t});\n\n\n\t$(\".gt_input\").blur(function() {\n\t\t$(this).val(addFormatting($(this).val()));\n\t});\n\n\n\t$(\".gt_input\").keypress(function(e) {\n\t\tif (e.which == 188 ||  // comma\n\t\t\te.which == 190 ||  //  ...? ...\n\t\t\te.which  == 46 || // decimal\n\t\t\te.which == 45  || // negative sign for FireFox\n\t\t\te.keyCode == 8 ||  // delete\n\t\t\te.keyCode == 9 ||  // tab\n\t\t\te.keyCode == 37 || //left arrow\n\t\t\te.keyCode == 39 || // right arrow\n\t\t\te.keyCode == 45 || // negative sign\n\t\t\t(e.which > 47 && e.which < 58 )) // numbers\n\t\t{\n\t\t\t\treturn true;\n\t\t}\n\t\telse if (e.keyCode == 13)\n\t\t{\n\t\t\t$(this).blur();\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t\treturn false;\n\t});\n\n\t$(\".gt_input\").change(function() {\n\t\t\tif (isNaN($(this).val()))\n\t\t\t\treturn false;\n\t});\n\n\n}\n\nfunction detectChanges()\n{\n\tvar foundChange = false;\n\n\t$(\"#finance_div input\").each(function() {\n\n\t\tif (this.id != 'other_expenses')\n\t\t{\n\t\t\tvar org = $(this).data('org_value');\n\t\t\tvar cur = removeFormatting($(this).val());\n\n\t\t\tif (org * 1 != cur * 1)\n\t\t\t{\n\t\t\t\t$(this).addClass('unsaved_field');\n\t\t\t\tfoundChange = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(this).removeClass('unsaved_field');\n\t\t\t}\n\t\t}\n\t});\n\n\treturn foundChange;\n\n}\n\n\nfunction init_update_p_and_l_data()\n{\n\n\tvar total_expenses = Number(0);\n\t$('[data-dd_subtype=\"expense\"]').each(function() {\n\t\ttotal_expenses += Number(removeFormatting($(this).val()));\n\t});\n\n\tvar agr = Number(removeFormatting($(\"#p_and_l_total_agr\").html()));\n\tvar marketing_total = Number(removeFormatting($(\"#p_and_l_marketing_total\").html()));\n\tvar royalty_total = Number(removeFormatting($(\"#p_and_l_royalty_total\").html()));\n\tvar net_income = Number(removeFormatting($(\"#net_income\").val()));\n\tvar salesforce_fee =  Number(removeFormatting($(\"#p_and_l_salesforce_fee\").html()));\n\n\n\t$(\"#other_expenses\").val(addFormatting(agr - (total_expenses + marketing_total + royalty_total + salesforce_fee) - net_income));\n\n\n\n\t$(\".gt_input\").keyup(function() {\n\n\t\tvar net_income = Number(removeFormatting($(\"#net_income\").val()));\n\n\t\tvar total_expenses =  Number(0);\n\t\t$('[data-dd_subtype=\"expense\"]').each(function() {\n\t\t\ttotal_expenses += Number(removeFormatting($(this).val()));\n\t\t});\n\n\t\tvar agr = Number(removeFormatting($(\"#p_and_l_total_agr\").html()));\n\n\t\t$(\"#other_expenses\").val(addFormatting(agr - (total_expenses + marketing_total + royalty_total + salesforce_fee)- net_income));\n\t});\n\n\n\t$(\"#update_p_and_l\").click(function()\n\t{\n\n\t\tvar validation_error_occurred = false;\n\n\t\t$(\"#owner_hours, #employee_hours, #manager_hours\").each(function()\n\t\t{\n\t\t\tif (isNaN($(this).val()))\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: \"The hours fields must be a number.\"\n\t\t\t\t});\n\n\t\t\t\tvalidation_error_occurred = true;\n\n\t\t\t}\n\t\t});\n\n\t\tif (validation_error_occurred)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tvar dataObj = {};\n\n\t\t$(\"#finance_div input\").each(function() {\n\t\t\tdataObj[this.id] = removeFormatting($(this).val());\n\t\t});\n\n\t\t$(\"#finance_div input\").each(function() {\n\t\t\tif (dataObj[this.id] == \"\") dataObj[this.id] = \"not supplied\";\n\t\t});\n\n\t\tif ($(\"#cost_of_goods_and_services\").data(\"org_value\") != $(\"#cost_of_goods_and_services\").val())\n\t\t{\n\t\t\thasChangedCOGS = true;\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata : {\n\t\t\t\tprocessor: 'admin_p_and_l_data',\n\t\t\t\tstore_id: store_id,\n\t\t\t\tmonth: month,\n\t\t\t\tyear: year,\n\t\t\t\tp_and_l_data: dataObj,\n\t\t\t},\n\t\t\tsuccess: function(json)\n\t\t\t{\n\t\t\t\tif(json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tdd_toast({message: \"Your data was saved.\"});\n\n\t\t\t\t\tif (hasChangedCOGS)\n\t\t\t\t\t{\n\t\t\t\t\t\thasChangedCOGS = false;\n\t\t\t\t\t\t$(\"#cogs_msg\").html(\"\");\n\t\t\t\t\t}\n\n\t\t\t\t\t$(\"#finance_div input\").each(function() {\n\n\t\t\t\t\t\tif (this.id != 'other_expenses')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar cur = removeFormatting($(this).val());\n\t\t\t\t\t\t\t$(this).data('org_value', cur);\n\t\t\t\t\t\t\t$(this).removeClass('unsaved_field');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t\tdetectChanges();\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function(objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\n\t\treturn false;\n\n\t});\n}\n\n\nfunction roundToTenths(mnt)\n{\n\tmnt -= 0;\n\tmnt = (Math.round(mnt*10))/10;\n\treturn (mnt == Math.floor(mnt)) ? mnt + '.0'\n\t\t\t : ( (mnt == Math.floor(mnt)) ?\n\t\t\t\t\t mnt + '0' : mnt);\n}\n\nfunction doRunReport()\n{\n\tvar year = parseInt($(\"#year_field_001\").val());\n\n\tif (isNaN(year))\n\t{\n\t\t// error\n\t\tdd_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'The year is not an integer.'\n\t\t});\n\t\treturn false;\n\t}\n\telse if (year < 2011)\n\t{\n\t\t//error\n\t\tdd_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'The year must be greater than 2010.'\n\t\t});\n\n\t\treturn false;\n\t}\n\n \t $(\"#avg_ticket_goal\").remove();\n\t $(\"#finishing_touch_goal\").remove();\n\t $(\"#taste_sessions_goal\").remove();\n\t $(\"#regular_guest_count_goal\").remove();\n\t $(\"#taste_guest_count_goal\").remove();\n\t $(\"#intro_guest_count_goal\").remove();\n\n\t $(\"[data-dd_type='p&l_widget']\").remove();\n\n\n\t$(\"#p_and_l_form\").submit();\n\n}\n\nfunction _report_submitClick(form)\n{\n\tvar canProceed = true;\n\tif (detectChanges())\n\t{\n\t\tcanProceed = false;\n\n\t\tdd_message({\n\t\t\ttitle: 'Unsaved Changes',\n\t\t\tmessage: \"You have some unsaved changes. Click 'Cancel' to return and save your changes.\",\n\t\t\tcancel: function ()\n\t\t\t{\n\t\t\t},\n\t\t\tconfirm: function ()\n\t\t\t{\n\t\t\t\treturn doRunReport();\n\t\t\t}\n\t\t});\n\t}\n\n\tif (canProceed)\n\t{\n\t\treturn doRunReport();\n\t}\n}\n\nfunction removeFormatting(stringVal)\n{\n\n\tif (stringVal == null || stringVal == \"\") return stringVal;\n\n\tstringVal = stringVal.replace(/,/, \"\");\n\tstringVal = stringVal.replace(/\\$/, \"\");\n\n\treturn stringVal;\n}\n\n\nfunction addFormatting(numericVal)\n{\n\tif (numericVal == null || numericVal == \"\") return \"\";\n\n\tnumericVal = accounting.formatMoney(numericVal,\"$\",2,\",\",\".\",\"%s%v\");\n\n\treturn numericVal;\n}"],"mappings":"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","ignoreList":[]}
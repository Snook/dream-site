{"version":3,"names":["hasChangedCOGS","reports_p_and_l_init","$","bind","e","keyCode","init_money_formatting","init_update_p_and_l_data","each","this","val","addFormatting","window","onbeforeunload","event","detectChanges","message","returnValue","focus","removeFormatting","blur","keypress","which","change","isNaN","foundChange","id","data","addClass","removeClass","total_expenses","Number","agr","html","marketing_total","royalty_total","net_income","salesforce_fee","keyup","click","validation_error_occurred","dd_message","title","dataObj","Object","ajax","url","type","timeout","dataType","processor","store_id","month","year","p_and_l_data","success","json","processor_success","dd_toast","cur","processor_message","error","objAJAXRequest","strError","response","roundToTenths","mnt","Math","round","floor","doRunReport","parseInt","remove","submit","_report_submitClick","form","canProceed","cancel","confirm","stringVal","replace","numericVal","accounting","formatMoney"],"sourceRoot":"js/src/admin","sources":["reports_p_and_l_input.js"],"sourcesContent":["var hasChangedCOGS = false;\r\n\r\nfunction reports_p_and_l_init()\r\n{\r\n\r\n\t$('html').bind('keypress', function(e)\r\n\t{\r\n\t   if(e.keyCode == 13)\r\n\t   {\r\n\t      return false;\r\n\t   }\r\n\t});\r\n\r\n\r\n\tinit_money_formatting();\r\n\r\n\tinit_update_p_and_l_data();\r\n\r\n\r\n\t$(\".gt_input\").each(function() {\r\n\t\t$(this).val(addFormatting($(this).val()));\r\n\t});\r\n\t\r\n\t\r\n\twindow.onbeforeunload = function (event) {\r\n\t\tif (detectChanges())\r\n\t\t{\r\n\t\t    var message = 'Important: Please click on \\'Save\\' button to leave this page.';\r\n\t\t    if (typeof event == 'undefined') {\r\n\t\t        event = window.event;\r\n\t\t    }\r\n\t\t    if (event) {\r\n\t\t        event.returnValue = message;\r\n\t\t    }\r\n\t\t    return message;\r\n\t\t}\r\n\t};\r\n\r\n\r\n}\r\n\r\nfunction init_money_formatting()\r\n{\r\n\t$(\".gt_input\").focus(function() {\r\n\t\t$(this).val(removeFormatting($(this).val()));\r\n\t});\r\n\r\n\r\n\t$(\".gt_input\").blur(function() {\r\n\t\t$(this).val(addFormatting($(this).val()));\r\n\t});\r\n\r\n\r\n\t$(\".gt_input\").keypress(function(e) {\r\n\t\tif (e.which == 188 ||  // comma\r\n\t\t\te.which == 190 ||  //  ...? ...\r\n\t\t\te.which  == 46 || // decimal\r\n\t\t\te.which == 45  || // negative sign for FireFox\r\n\t\t\te.keyCode == 8 ||  // delete\r\n\t\t\te.keyCode == 9 ||  // tab\r\n\t\t\te.keyCode == 37 || //left arrow\r\n\t\t\te.keyCode == 39 || // right arrow\r\n\t\t\te.keyCode == 45 || // negative sign\r\n\t\t\t(e.which > 47 && e.which < 58 )) // numbers\r\n\t\t{\t\t\t\t\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (e.keyCode == 13)\r\n\t\t{\r\n\t\t\t$(this).blur();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t\treturn false;\r\n\t});\r\n\r\n\t$(\".gt_input\").change(function() {\r\n\t\t\tif (isNaN($(this).val()))\r\n\t\t\t\treturn false;\r\n\t});\r\n\r\n\r\n}\r\n\r\nfunction detectChanges()\r\n{\r\n\tvar foundChange = false;\r\n\t\r\n\t$(\"#finance_div input\").each(function() {\r\n\r\n\t\tif (this.id != 'other_expenses')\r\n\t\t{\r\n\t\t\tvar org = $(this).data('org_value');\r\n\t\t\tvar cur = removeFormatting($(this).val());\r\n\t\t\t\r\n\t\t\tif (org * 1 != cur * 1)\r\n\t\t\t{\r\n\t\t\t\t$(this).addClass('unsaved_field');\r\n\t\t\t\tfoundChange = true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$(this).removeClass('unsaved_field');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn foundChange;\r\n\r\n}\r\n\r\n\r\nfunction init_update_p_and_l_data()\r\n{\r\n\t\r\n\tvar total_expenses = new Number(0);\r\n\t$('[data-dd_subtype=\"expense\"]').each(function() {\r\n\t\ttotal_expenses += new Number(removeFormatting($(this).val()));\r\n\t});\r\n\t\t\r\n\tvar agr = new Number(removeFormatting($(\"#p_and_l_total_agr\").html()));\r\n\tvar marketing_total = new Number(removeFormatting($(\"#p_and_l_marketing_total\").html()));\r\n\tvar royalty_total = new Number(removeFormatting($(\"#p_and_l_royalty_total\").html()));\r\n\tvar net_income = new Number(removeFormatting($(\"#net_income\").val()));\r\n\tvar salesforce_fee =  new Number(removeFormatting($(\"#p_and_l_salesforce_fee\").html()));\r\n\t\r\n\t\r\n\t$(\"#other_expenses\").val(addFormatting(agr - (total_expenses + marketing_total + royalty_total + salesforce_fee) - net_income));\r\n\r\n\t\r\n\t\r\n\t$(\".gt_input\").keyup(function() {\r\n\r\n\t\tvar net_income = new Number(removeFormatting($(\"#net_income\").val()));\r\n\t\t\r\n\t\tvar total_expenses =  new Number(0);\r\n\t\t$('[data-dd_subtype=\"expense\"]').each(function() {\r\n\t\t\ttotal_expenses += new Number(removeFormatting($(this).val()));\r\n\t\t});\r\n\r\n\t\tvar agr = new Number(removeFormatting($(\"#p_and_l_total_agr\").html()));\r\n\t\t\r\n\t\t$(\"#other_expenses\").val(addFormatting(agr - (total_expenses + marketing_total + royalty_total + salesforce_fee)- net_income));\r\n\t});\r\n\t\r\n\t\r\n\t$(\"#update_p_and_l\").click(function()\r\n\t{\r\n\t\t\t\t\r\n\t\tvar validation_error_occurred = false;\r\n\t\t\r\n\t\t$(\"#owner_hours, #employee_hours, #manager_hours\").each(function()\r\n\t\t{\r\n\t\t\tif (isNaN($(this).val()))\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: \"The hours fields must be a number.\"\r\n\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tvalidation_error_occurred = true;\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tif (validation_error_occurred)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tvar dataObj = new Object();\r\n\r\n\t\t$(\"#finance_div input\").each(function() {\r\n\t\t\tdataObj[this.id] = removeFormatting($(this).val());\r\n\t\t});\r\n\r\n\t\t$(\"#finance_div input\").each(function() {\r\n\t\t\tif (dataObj[this.id] == \"\") dataObj[this.id] = \"not supplied\";\r\n\t\t});\r\n\r\n\t\tif ($(\"#cost_of_goods_and_services\").data(\"org_value\") != $(\"#cost_of_goods_and_services\").val())\r\n\t\t{\r\n\t\t\thasChangedCOGS = true;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata : {\r\n\t\t\t\tprocessor: 'admin_p_and_l_data',\r\n\t\t\t\tstore_id: store_id,\r\n\t\t\t\tmonth: month,\r\n\t\t\t\tyear: year,\r\n\t\t\t\tp_and_l_data: dataObj,\r\n\t\t\t},\r\n\t\t\tsuccess: function(json)\r\n\t\t\t{\r\n\t\t\t\tif(json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_toast({message: \"Your data was saved.\"});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (hasChangedCOGS)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\thasChangedCOGS = false;\r\n\t\t\t\t\t\t$(\"#cogs_msg\").html(\"\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$(\"#finance_div input\").each(function() {\r\n\r\n\t\t\t\t\t\tif (this.id != 'other_expenses')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar cur = removeFormatting($(this).val());\r\n\t\t\t\t\t\t\t$(this).data('org_value', cur);\r\n\t\t\t\t\t\t\t$(this).removeClass('unsaved_field');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tdetectChanges();\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function(objAJAXRequest, strError)\r\n\t\t\t{\r\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: response\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\r\n\t});\r\n}\r\n\r\n\r\nfunction roundToTenths(mnt)\r\n{\r\n\tmnt -= 0;\r\n\tmnt = (Math.round(mnt*10))/10;\r\n\treturn (mnt == Math.floor(mnt)) ? mnt + '.0'\r\n\t\t\t : ( (mnt == Math.floor(mnt)) ?\r\n\t\t\t\t\t mnt + '0' : mnt);\r\n}\r\n\r\nfunction doRunReport()\r\n{\r\n\tvar year = parseInt($(\"#year_field_001\").val());\r\n\r\n\tif (isNaN(year))\r\n\t{\r\n\t\t// error\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'The year is not an integer.'\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\telse if (year < 2011)\r\n\t{\r\n\t\t//error\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'The year must be greater than 2010.'\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n \t $(\"#avg_ticket_goal\").remove();\r\n\t $(\"#finishing_touch_goal\").remove();\r\n\t $(\"#taste_sessions_goal\").remove();\r\n\t $(\"#regular_guest_count_goal\").remove();\r\n\t $(\"#taste_guest_count_goal\").remove();\r\n\t $(\"#intro_guest_count_goal\").remove();\r\n\r\n\t $(\"[data-dd_type='p&l_widget']\").remove();\r\n\r\n\r\n\t$(\"#p_and_l_form\").submit();\r\n\r\n}\r\n\r\nfunction _report_submitClick(form)\r\n{\r\n\tvar canProceed = true;\r\n\tif (detectChanges())\r\n\t{\r\n\t\tcanProceed = false;\t\t\r\n\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Unsaved Changes',\r\n\t\t\tmessage: \"You have some unsaved changes. Click 'Cancel' to return and save your changes.\",\r\n\t\t\tcancel: function ()\r\n\t\t\t{\r\n\t\t\t},\r\n\t\t\tconfirm: function ()\r\n\t\t\t{\r\n\t\t\t\treturn doRunReport();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\t\r\n\tif (canProceed)\r\n\t{\r\n\t\treturn doRunReport();\r\n\t}\r\n}\r\n\r\nfunction removeFormatting(stringVal)\r\n{\r\n\t\r\n\tif (stringVal == null || stringVal == \"\") return stringVal;\r\n\t\r\n\tstringVal = stringVal.replace(/,/, \"\");\r\n\tstringVal = stringVal.replace(/\\$/, \"\");\r\n\r\n\treturn stringVal;\r\n}\r\n\r\n\r\nfunction addFormatting(numericVal)\r\n{\r\n\tif (numericVal == null || numericVal == \"\") return \"\";\r\n\t\r\n\tnumericVal = accounting.formatMoney(numericVal,\"$\",2,\",\",\".\",\"%s%v\");\r\n\r\n\treturn numericVal;\r\n}\r\n"],"mappings":"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"}
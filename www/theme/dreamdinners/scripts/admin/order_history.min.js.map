{"version":3,"file":"order_history.min.js","names":["order_history_init","currentUser","handle_order_notes_click","handle_order_details_click","$","stickyTableHeaders","handle_cancel_order","handle_cancel_order_delivered","handle_delete_saved_order","handle_reschedule_button","restorePagingLocation","handlePaging","each","this","hasClass","on","e","preventDefault","order_id","data","booking_id","parent","hide","historyPush","url","getQueryVariable","text","show","animate","scrollTop","offset","top","stop","ajax","type","timeout","dataType","processor","op","success","json","processor_success","html","order_details_table","history_table","error","objAJAXRequest","strError","response","document","trigger","unbind","removeClass","addClass","event","user_id","current_page","cached","localStorage","setItem","page","status","alert","getItem"],"sourceRoot":"js/src/dreamdinners/admin","sources":["order_history.js"],"sourcesContent":["function order_history_init(currentUser)\n{\n\thandle_order_notes_click();\n\thandle_order_details_click();\n\n\t$('#orders_history_table').stickyTableHeaders();\n\n\thandle_cancel_order();\n\thandle_cancel_order_delivered();\n\thandle_delete_saved_order();\n\thandle_reschedule_button();\n\n\trestorePagingLocation(currentUser);\n\thandlePaging();\n}\n\nfunction handle_order_details_click()\n{\n\t$('[data-view_order_details]').each(function ()\n\t{\n\n\t\tif ($(this).hasClass('disabled'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// handle view order details\n\t\t$(this).on('click', function (e)\n\t\t{\n\t\t\te.preventDefault();\n\n\t\t\tvar order_id = $(this).data('view_order_details');\n\t\t\tvar booking_id = $(this).data('booking_id');\n\n\t\t\t// hide existing open order\n\t\t\t$('[data-view_order_details_table]').parent().hide();\n\n\t\t\tif ($(this).data('is_shown') == true)\n\t\t\t{\n\t\t\t\thistoryPush({url: '?id=' + getQueryVariable('id')});\n\t\t\t\t$(this).text('View Order').data('is_shown', false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$('[data-view_order_details]').text('View Order').data('is_shown', false);\n\n\t\t\t// show this order\n\t\t\t$('[data-view_order_details_table=\"' + booking_id + '\"]').parent().show();\n\t\t\t$(this).text('Close Order').data('is_shown', true);\n\n\t\t\t// scroll to guest details\n\t\t\t$('html, body').animate({\n\n\t\t\t\tscrollTop: $('[data-view_order_details=\"' + order_id + '\"]').offset().top - 40\n\n\t\t\t}, 500);\n\n\t\t\t// cancel scroll if user manually interrupts the scroll\n\t\t\t$('html, body').on('scroll mousedown DOMMouseScroll mousewheel keyup', function (e)\n\t\t\t{\n\n\t\t\t\t$('html, body').stop();\n\n\t\t\t});\n\n\t\t\t$.ajax({\n\t\t\t\turl: '/processor',\n\t\t\t\ttype: 'POST',\n\t\t\t\ttimeout: 60000,\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tprocessor: 'admin_fadmin_home_order_details',\n\t\t\t\t\top: 'order_details',\n\t\t\t\t\torder_id: order_id,\n\t\t\t\t\tbooking_id: booking_id\n\t\t\t\t},\n\t\t\t\tsuccess: function (json)\n\t\t\t\t{\n\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('[data-view_order_details_table=\"' + json.booking_id + '\"]').html(json.order_details_table +json.history_table );\n\n\t\t\t\t\t\thistoryPush({url: '?id=' + getQueryVariable('id') + '&order=' + json.order_id});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t\t{\n\t\t\t\t\tresponse = 'Unexpected error';\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\n\t\t// handle closing of order details\n\t\t$(document).on(\"click\",'.close_order_details_table', function (e)\n\t\t{\n\n\t\t\t$('#order_details_tbody_id_' + $(this).data('booking_id')).hide();\n\n\t\t\thistoryPush({url: '?id=' + getQueryVariable('id')});\n\n\t\t});\n\n\t});\n\n\tif (getQueryVariable('order'))\n\t{\n\t\t$('[data-view_order_details=\"' + getQueryVariable('order') + '\"]').trigger('click');\n\t}\n}\n\nfunction handle_order_notes_click()\n{\n\t$('[id^=\"view_notes-\"]').each(function ()\n\t{\n\n\t\t$(this).unbind('click').on('click', function ()\n\t\t{\n\n\t\t\tif ($(this).hasClass('selected'))\n\t\t\t{\n\t\t\t\t$(this).removeClass('selected');\n\n\t\t\t\t$('[id^=\"order_user_notes-\"], [id^=\"order_admin_notes-\"]').hide();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('.button.selected').removeClass('selected');\n\n\t\t\t\t$('[id^=\"order_user_notes-\"], [id^=\"order_admin_notes-\"]').hide();\n\n\t\t\t\t$(this).addClass('selected');\n\n\t\t\t\t$('#order_user_notes-' + $(this).data('order_id') + ', #order_admin_notes-' + $(this).data('order_id')).show();\n\t\t\t}\n\n\t\t});\n\n\t});\n}\n\nfunction handlePaging(){\n\n\t//***** Paging Controls\n\t$(document).on(\"click\", \".orders-page-prev\", function (event) {\n\t\tevent.preventDefault();\n\n\t\tlet user_id = $(this).data('user');\n\t\tlet current_page = $(this).data('current');\n\n\t\tlet cached = current_page;\n\n\t\tif(cached > 0){\n\t\t\tcached = cached -2;\n\t\t}\n\n\t\tlocalStorage.setItem('orders-paging-current',cached);\n\t\tlocalStorage.setItem('history-paging-user',user_id);\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 100000000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpage: current_page,\n\t\t\t\tprocessor: 'admin_order_history',\n\t\t\t\top: 'prev'\n\t\t\t},\n\t\t\tsuccess: function (json, status) {\n\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\t$('#order_history').html(json.html);\n\t\t\t\t\thandle_order_details_click();\n\t\t\t\t\thandle_order_notes_click();\n\t\t\t\t\thandle_cancel_order();\n\t\t\t\t\thandle_cancel_order_delivered();\n\t\t\t\t\thandle_delete_saved_order();\n\t\t\t\t\thandle_reschedule_button();\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\talert('NOT OK');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t\talert('AJAX ERROR');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t});\n\n\t$(document).on(\"click\", \".orders-page-next\",function (event) {\n\t\tevent.preventDefault();\n\n\n\t\tlet user_id = $(this).data('user');\n\t\tlet current_page = $(this).data('current');\n\n\t\tlocalStorage.setItem('orders-paging-current',current_page);\n\t\tlocalStorage.setItem('history-paging-user',user_id);\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 100000000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpage: current_page,\n\t\t\t\tprocessor: 'admin_order_history',\n\t\t\t\top: 'next'\n\t\t\t},\n\t\t\tsuccess: function (json, status) {\n\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\t$('#order_history').html(json.html);\n\t\t\t\t\thandle_order_details_click();\n\t\t\t\t\thandle_order_notes_click();\n\t\t\t\t\thandle_cancel_order();\n\t\t\t\t\thandle_cancel_order_delivered();\n\t\t\t\t\thandle_delete_saved_order();\n\t\t\t\t\thandle_reschedule_button();\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\talert('NOT OK');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t\talert('AJAX ERROR');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t});\n}\n\n\nfunction restorePagingLocation(currentUser)\n{\n\tlet page = localStorage.getItem('orders-paging-current');\n\tlet user_id = localStorage.getItem('history-paging-user');\n\n\tif(user_id != currentUser){\n\t\tlocalStorage.setItem('orders-paging-current',null);\n\t\tlocalStorage.setItem('history-paging-user',null);\n\n\t\treturn;\n\t}\n\n\tif (page != null && typeof page !== 'undefined' && user_id != null && typeof user_id !== 'undefined'){\n\t\t$('#order_history').html('');\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 100000000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpage: page,\n\t\t\t\tprocessor: 'admin_order_history',\n\t\t\t\top: 'next'\n\t\t\t},\n\t\t\tsuccess: function (json, status) {\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\t$('#order_history').html(json.html);\n\t\t\t\t\thandle_order_details_click();\n\t\t\t\t\thandle_order_notes_click();\n\t\t\t\t\thandle_cancel_order();\n\t\t\t\t\thandle_cancel_order_delivered();\n\t\t\t\t\thandle_delete_saved_order();\n\t\t\t\t\thandle_reschedule_button();\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\talert('NOT OK');\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t\talert('AJAX ERROR');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n}"],"mappings":"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"}
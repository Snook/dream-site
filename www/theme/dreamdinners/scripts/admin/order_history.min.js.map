{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_history.js"],"sourcesContent":["function order_history_init(currentUser)\r\n{\r\n\thandle_order_notes_click();\r\n\thandle_order_details_click();\r\n\r\n\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\thandle_cancel_order();\r\n\thandle_cancel_order_delivered();\r\n\thandle_delete_saved_order();\r\n\thandle_reschedule_button();\r\n\r\n\trestorePagingLocation(currentUser);\r\n\thandlePaging();\r\n}\r\n\r\nfunction handle_order_details_click()\r\n{\r\n\t$('[data-view_order_details]').each(function ()\r\n\t{\r\n\r\n\t\tif ($(this).hasClass('disabled'))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// handle view order details\r\n\t\t$(this).on('click', function (e)\r\n\t\t{\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar order_id = $(this).data('view_order_details');\r\n\t\t\tvar booking_id = $(this).data('booking_id');\r\n\r\n\t\t\t// hide existing open order\r\n\t\t\t$('[data-view_order_details_table]').parent().hide();\r\n\r\n\t\t\tif ($(this).data('is_shown') == true)\r\n\t\t\t{\r\n\t\t\t\thistoryPush({url: 'main.php?page=' + getQueryVariable('page') + '&id=' + getQueryVariable('id')});\r\n\t\t\t\t$(this).text('View Order').data('is_shown', false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t$('[data-view_order_details]').text('View Order').data('is_shown', false);\r\n\r\n\t\t\t// show this order\r\n\t\t\t$('[data-view_order_details_table=\"' + booking_id + '\"]').parent().show();\r\n\t\t\t$(this).text('Close Order').data('is_shown', true);\r\n\r\n\t\t\t// scroll to guest details\r\n\t\t\t$('html, body').animate({\r\n\r\n\t\t\t\tscrollTop: $('[data-view_order_details=\"' + order_id + '\"]').offset().top - 40\r\n\r\n\t\t\t}, 500);\r\n\r\n\t\t\t// cancel scroll if user manually interrupts the scroll\r\n\t\t\t$('html, body').on('scroll mousedown DOMMouseScroll mousewheel keyup', function (e)\r\n\t\t\t{\r\n\r\n\t\t\t\t$('html, body').stop();\r\n\r\n\t\t\t});\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 60000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_fadmin_home_order_details',\r\n\t\t\t\t\top: 'order_details',\r\n\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\tbooking_id: booking_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('[data-view_order_details_table=\"' + json.booking_id + '\"]').html(json.order_details_table +json.history_table );\r\n\r\n\t\t\t\t\t\thistoryPush({url: 'main.php?page=' + getQueryVariable('page') + '&id=' + getQueryVariable('id') + '&order=' + json.order_id});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError)\r\n\t\t\t\t{\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t\t// handle closing of order details\r\n\t\t$(document).on(\"click\",'.close_order_details_table', function (e)\r\n\t\t{\r\n\r\n\t\t\t$('#order_details_tbody_id_' + $(this).data('booking_id')).hide();\r\n\r\n\t\t\thistoryPush({url: 'main.php?page=' + getQueryVariable('page') + '&id=' + getQueryVariable('id')});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n\tif (getQueryVariable('order'))\r\n\t{\r\n\t\t$('[data-view_order_details=\"' + getQueryVariable('order') + '\"]').trigger('click');\r\n\t}\r\n}\r\n\r\nfunction handle_order_notes_click()\r\n{\r\n\t$('[id^=\"view_notes-\"]').each(function ()\r\n\t{\r\n\r\n\t\t$(this).unbind('click').on('click', function ()\r\n\t\t{\r\n\r\n\t\t\tif ($(this).hasClass('selected'))\r\n\t\t\t{\r\n\t\t\t\t$(this).removeClass('selected');\r\n\r\n\t\t\t\t$('[id^=\"order_user_notes-\"], [id^=\"order_admin_notes-\"]').hide();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('.button.selected').removeClass('selected');\r\n\r\n\t\t\t\t$('[id^=\"order_user_notes-\"], [id^=\"order_admin_notes-\"]').hide();\r\n\r\n\t\t\t\t$(this).addClass('selected');\r\n\r\n\t\t\t\t$('#order_user_notes-' + $(this).data('order_id') + ', #order_admin_notes-' + $(this).data('order_id')).show();\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handlePaging(){\r\n\r\n\t//***** Paging Controls\r\n\t$(document).on(\"click\", \".orders-page-prev\", function (event) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tlet user_id = $(this).data('user');\r\n\t\tlet current_page = $(this).data('current');\r\n\r\n\t\tlet cached = current_page;\r\n\r\n\t\tif(cached > 0){\r\n\t\t\tcached = cached -2;\r\n\t\t}\r\n\r\n\t\tlocalStorage.setItem('orders-paging-current',cached);\r\n\t\tlocalStorage.setItem('history-paging-user',user_id);\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 100000000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpage: current_page,\r\n\t\t\t\tprocessor: 'admin_order_history',\r\n\t\t\t\top: 'prev'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json, status) {\r\n\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#order_history').html(json.html);\r\n\t\t\t\t\thandle_order_details_click();\r\n\t\t\t\t\thandle_order_notes_click();\r\n\t\t\t\t\thandle_cancel_order();\r\n\t\t\t\t\thandle_cancel_order_delivered();\r\n\t\t\t\t\thandle_delete_saved_order();\r\n\t\t\t\t\thandle_reschedule_button();\r\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\talert('NOT OK');\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\talert('AJAX ERROR');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn false;\r\n\t});\r\n\r\n\t$(document).on(\"click\", \".orders-page-next\",function (event) {\r\n\t\tevent.preventDefault();\r\n\r\n\r\n\t\tlet user_id = $(this).data('user');\r\n\t\tlet current_page = $(this).data('current');\r\n\r\n\t\tlocalStorage.setItem('orders-paging-current',current_page);\r\n\t\tlocalStorage.setItem('history-paging-user',user_id);\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 100000000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpage: current_page,\r\n\t\t\t\tprocessor: 'admin_order_history',\r\n\t\t\t\top: 'next'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json, status) {\r\n\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#order_history').html(json.html);\r\n\t\t\t\t\thandle_order_details_click();\r\n\t\t\t\t\thandle_order_notes_click();\r\n\t\t\t\t\thandle_cancel_order();\r\n\t\t\t\t\thandle_cancel_order_delivered();\r\n\t\t\t\t\thandle_delete_saved_order();\r\n\t\t\t\t\thandle_reschedule_button();\r\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\talert('NOT OK');\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\talert('AJAX ERROR');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn false;\r\n\t});\r\n}\r\n\r\n\r\nfunction restorePagingLocation(currentUser)\r\n{\r\n\tlet page = localStorage.getItem('orders-paging-current');\r\n\tlet user_id = localStorage.getItem('history-paging-user');\r\n\r\n\tif(user_id != currentUser){\r\n\t\tlocalStorage.setItem('orders-paging-current',null);\r\n\t\tlocalStorage.setItem('history-paging-user',null);\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (page != null && typeof page !== 'undefined' && user_id != null && typeof user_id !== 'undefined'){\r\n\t\t$('#order_history').html('');\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 100000000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpage: page,\r\n\t\t\t\tprocessor: 'admin_order_history',\r\n\t\t\t\top: 'next'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json, status) {\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#order_history').html(json.html);\r\n\t\t\t\t\thandle_order_details_click();\r\n\t\t\t\t\thandle_order_notes_click();\r\n\t\t\t\t\thandle_cancel_order();\r\n\t\t\t\t\thandle_cancel_order_delivered();\r\n\t\t\t\t\thandle_delete_saved_order();\r\n\t\t\t\t\thandle_reschedule_button();\r\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\talert('NOT OK');\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\talert('AJAX ERROR');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n"],"names":["order_history_init","currentUser","handle_order_notes_click","handle_order_details_click","$","stickyTableHeaders","handle_cancel_order","handle_cancel_order_delivered","handle_delete_saved_order","handle_reschedule_button","restorePagingLocation","handlePaging","each","this","hasClass","on","e","preventDefault","order_id","data","booking_id","parent","hide","historyPush","url","getQueryVariable","text","show","animate","scrollTop","offset","top","stop","ajax","type","timeout","dataType","processor","op","success","json","processor_success","html","order_details_table","history_table","error","objAJAXRequest","strError","response","document","trigger","unbind","removeClass","addClass","event","let","user_id","current_page","cached","localStorage","setItem","page","status","alert","getItem"],"mappings":"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"}
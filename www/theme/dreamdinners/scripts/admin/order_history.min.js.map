{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["order_history.js"],"sourcesContent":["function order_history_init(currentUser)\r\n{\r\n\thandle_order_notes_click();\r\n\thandle_order_details_click();\r\n\r\n\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\thandle_cancel_order();\r\n\thandle_cancel_order_delivered();\r\n\thandle_delete_saved_order();\r\n\thandle_reschedule_button();\r\n\r\n\trestorePagingLocation(currentUser);\r\n\thandlePaging();\r\n}\r\n\r\nfunction handle_order_details_click()\r\n{\r\n\t$('[data-view_order_details]').each(function ()\r\n\t{\r\n\r\n\t\tif ($(this).hasClass('disabled'))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// handle view order details\r\n\t\t$(this).on('click', function (e)\r\n\t\t{\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar order_id = $(this).data('view_order_details');\r\n\t\t\tvar booking_id = $(this).data('booking_id');\r\n\r\n\t\t\t// hide existing open order\r\n\t\t\t$('[data-view_order_details_table]').parent().hide();\r\n\r\n\t\t\tif ($(this).data('is_shown') == true)\r\n\t\t\t{\r\n\t\t\t\thistoryPush({url: 'main.php?page=' + getQueryVariable('page') + '&id=' + getQueryVariable('id')});\r\n\t\t\t\t$(this).text('View Order').data('is_shown', false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t$('[data-view_order_details]').text('View Order').data('is_shown', false);\r\n\r\n\t\t\t// show this order\r\n\t\t\t$('[data-view_order_details_table=\"' + booking_id + '\"]').parent().show();\r\n\t\t\t$(this).text('Close Order').data('is_shown', true);\r\n\r\n\t\t\t// scroll to guest details\r\n\t\t\t$('html, body').animate({\r\n\r\n\t\t\t\tscrollTop: $('[data-view_order_details=\"' + order_id + '\"]').offset().top - 40\r\n\r\n\t\t\t}, 500);\r\n\r\n\t\t\t// cancel scroll if user manually interrupts the scroll\r\n\t\t\t$('html, body').on('scroll mousedown DOMMouseScroll mousewheel keyup', function (e)\r\n\t\t\t{\r\n\r\n\t\t\t\t$('html, body').stop();\r\n\r\n\t\t\t});\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 60000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'admin_fadmin_home_order_details',\r\n\t\t\t\t\top: 'order_details',\r\n\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\tbooking_id: booking_id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('[data-view_order_details_table=\"' + json.booking_id + '\"]').html(json.order_details_table +json.history_table );\r\n\r\n\t\t\t\t\t\thistoryPush({url: 'main.php?page=' + getQueryVariable('page') + '&id=' + getQueryVariable('id') + '&order=' + json.order_id});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError)\r\n\t\t\t\t{\r\n\t\t\t\t\tresponse = 'Unexpected error';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t\t// handle closing of order details\r\n\t\t$(document).on(\"click\",'.close_order_details_table', function (e)\r\n\t\t{\r\n\r\n\t\t\t$('#order_details_tbody_id_' + $(this).data('booking_id')).hide();\r\n\r\n\t\t\thistoryPush({url: 'main.php?page=' + getQueryVariable('page') + '&id=' + getQueryVariable('id')});\r\n\r\n\t\t});\r\n\r\n\t});\r\n\r\n\tif (getQueryVariable('order'))\r\n\t{\r\n\t\t$('[data-view_order_details=\"' + getQueryVariable('order') + '\"]').trigger('click');\r\n\t}\r\n}\r\n\r\nfunction handle_order_notes_click()\r\n{\r\n\t$('[id^=\"view_notes-\"]').each(function ()\r\n\t{\r\n\r\n\t\t$(this).unbind('click').on('click', function ()\r\n\t\t{\r\n\r\n\t\t\tif ($(this).hasClass('selected'))\r\n\t\t\t{\r\n\t\t\t\t$(this).removeClass('selected');\r\n\r\n\t\t\t\t$('[id^=\"order_user_notes-\"], [id^=\"order_admin_notes-\"]').hide();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('.button.selected').removeClass('selected');\r\n\r\n\t\t\t\t$('[id^=\"order_user_notes-\"], [id^=\"order_admin_notes-\"]').hide();\r\n\r\n\t\t\t\t$(this).addClass('selected');\r\n\r\n\t\t\t\t$('#order_user_notes-' + $(this).data('order_id') + ', #order_admin_notes-' + $(this).data('order_id')).show();\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction handlePaging(){\r\n\r\n\t//***** Paging Controls\r\n\t$(document).on(\"click\", \".orders-page-prev\", function (event) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tlet user_id = $(this).data('user');\r\n\t\tlet current_page = $(this).data('current');\r\n\r\n\t\tlet cached = current_page;\r\n\r\n\t\tif(cached > 0){\r\n\t\t\tcached = cached -2;\r\n\t\t}\r\n\r\n\t\tlocalStorage.setItem('orders-paging-current',cached);\r\n\t\tlocalStorage.setItem('history-paging-user',user_id);\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 100000000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpage: current_page,\r\n\t\t\t\tprocessor: 'admin_order_history',\r\n\t\t\t\top: 'prev'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json, status) {\r\n\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#order_history').html(json.html);\r\n\t\t\t\t\thandle_order_details_click();\r\n\t\t\t\t\thandle_order_notes_click();\r\n\t\t\t\t\thandle_cancel_order();\r\n\t\t\t\t\thandle_cancel_order_delivered();\r\n\t\t\t\t\thandle_delete_saved_order();\r\n\t\t\t\t\thandle_reschedule_button();\r\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\talert('NOT OK');\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\talert('AJAX ERROR');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn false;\r\n\t});\r\n\r\n\t$(document).on(\"click\", \".orders-page-next\",function (event) {\r\n\t\tevent.preventDefault();\r\n\r\n\r\n\t\tlet user_id = $(this).data('user');\r\n\t\tlet current_page = $(this).data('current');\r\n\r\n\t\tlocalStorage.setItem('orders-paging-current',current_page);\r\n\t\tlocalStorage.setItem('history-paging-user',user_id);\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 100000000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpage: current_page,\r\n\t\t\t\tprocessor: 'admin_order_history',\r\n\t\t\t\top: 'next'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json, status) {\r\n\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#order_history').html(json.html);\r\n\t\t\t\t\thandle_order_details_click();\r\n\t\t\t\t\thandle_order_notes_click();\r\n\t\t\t\t\thandle_cancel_order();\r\n\t\t\t\t\thandle_cancel_order_delivered();\r\n\t\t\t\t\thandle_delete_saved_order();\r\n\t\t\t\t\thandle_reschedule_button();\r\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\talert('NOT OK');\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\talert('AJAX ERROR');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn false;\r\n\t});\r\n}\r\n\r\n\r\nfunction restorePagingLocation(currentUser)\r\n{\r\n\tlet page = localStorage.getItem('orders-paging-current');\r\n\tlet user_id = localStorage.getItem('history-paging-user');\r\n\r\n\tif(user_id != currentUser){\r\n\t\tlocalStorage.setItem('orders-paging-current',null);\r\n\t\tlocalStorage.setItem('history-paging-user',null);\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (page != null && typeof page !== 'undefined' && user_id != null && typeof user_id !== 'undefined'){\r\n\t\t$('#order_history').html('');\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 100000000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tuser_id: user_id,\r\n\t\t\t\tpage: page,\r\n\t\t\t\tprocessor: 'admin_order_history',\r\n\t\t\t\top: 'next'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json, status) {\r\n\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#order_history').html(json.html);\r\n\t\t\t\t\thandle_order_details_click();\r\n\t\t\t\t\thandle_order_notes_click();\r\n\t\t\t\t\thandle_cancel_order();\r\n\t\t\t\t\thandle_cancel_order_delivered();\r\n\t\t\t\t\thandle_delete_saved_order();\r\n\t\t\t\t\thandle_reschedule_button();\r\n\t\t\t\t\t$('#orders_history_table').stickyTableHeaders();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\talert('NOT OK');\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\talert('AJAX ERROR');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n"],"names":["order_history_init","currentUser","handle_order_notes_click","handle_order_details_click","$","stickyTableHeaders","handle_cancel_order","handle_cancel_order_delivered","handle_delete_saved_order","handle_reschedule_button","restorePagingLocation","handlePaging","each","this","hasClass","on","e","preventDefault","order_id","data","booking_id","parent","hide","historyPush","url","getQueryVariable","text","show","animate","scrollTop","offset","top","stop","ajax","type","timeout","dataType","processor","op","success","json","processor_success","html","order_details_table","history_table","error","objAJAXRequest","strError","response","document","trigger","unbind","removeClass","addClass","event","let","user_id","current_page","cached","localStorage","setItem","page","status","alert","getItem"],"mappings":"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"}
{"version":3,"file":"order_mgr_test.min.js","names":["itemChanges","discountOrPaymentChanges","discountChanges","reportingChanges","paymentChanges","initialSessionDiscountSetting","initialPreferredUserDiscountSetting","changeList","isFactoringCredit","currentCreditAvailable","stationNeedsAttention","relatedOrdersAreLoaded","currentlySavingOrder","onTimeShotAtSupplyingZeroPaymentHasOccurred","needPlatePointsMaxDiscountChangeWarning","lastMaxPPDiscountAmount","admin_order_mgr_init","store_id","STORE_DETAILS","id","orderState","setupForNewOrder","setupForSavedOrder","setupForActiveOrder","hasBundle","bundleSetup","setupSiteAdminFunctions","initChangeList","calculateTotal","setAllPaymentFieldsToUnrequired","setupCouponState","setUpKeyHandlers","getQueryVariable","vars","window","location","search","substring","split","newQueryString","first","i","length","historyPush","url","handle_special_instruction_notes","handle_cancel_order","handle_delete_saved_order","handle_free_menu_item_edit","handle_fundraiser_selection","intenseLoggingOn","intenseLogging","message","console","log","saveSpecialInstructions","special_instructions","strip_tags","$","val","ajax","type","timeout","dataType","data","processor","user_id","op","order_id","success","json","processor_success","updateInstructionsOrgValues","processor_message","dd_message","title","error","objAJAXRequest","strError","responseText","response","each","this","on","e","booking_id","do_op","do","note","textarea_elem","addClass","special_instruction_note","html","removeClass","hide","show","nl2br","lastCheckedGiftCertNumber","document","onkeypress","OMDefaultKeyHandler","evt","event","charCode","which","keyCode","processCode","stopPropagation","isNaN","getChangeListHTML","height","width","modal","div_id","dialogClass","noOk","position","my","at","of","close","ui","remove","flagName","checkbox","newState","is","oldState","cancel","prop","confirm","flag","new_state","attr","updateItemsOrgValues","isDreamTaste","isFundraiser","updateChangeList","saveAll","saveItems","saveDiscountsUponCompletion","dd_toast","itemsList","introItemsList","subItemsList","is_intro","item_id","misc_food_subtotal","misc_nonfood_subtotal","subtotal_service_fee","misc_food_subtotal_desc","misc_nonfood_subtotal_desc","service_fee_description","items","intro_items","sub_items","itemTabIsDirty","saveDiscounts","setSessionAndSave","session_id","displayModalWaitDialog","dd_csrf_token","full_session_warning_required","bounce","getTokenToken","Reschedule","org_session_id","saved_booking_id","new_session_id","new_session_time","RetrieveCalendar","canDelayPayment","showFlex","hideFlex","session_discount","value","activeSessionDiscount","session_info","session_type_text","remaining_slots","remaining_intro_slots","serviceFeeUpdate","formatAsMoney","serviceFeeDescUpdate","onSetSessionAndSave","obj","onSaveItems","HideLineItemsIfZero","timestamp","discountEligable","limited_access","click","find","onSessionTabSelected","onSessionTabDeselected","onItemsTabSelected","onItemsTabDeselected","onPaymentTabSelected","onPaymentTabDeselected","onRelatedOrdersTabSelected","onRelatedOrdersTabDeselected","onNotesTabSelected","handle_guest_account_notes","handle_admin_carryover_notes","handle_admin_order_notes","onNotesTabDeselected","onPaymentSelected","onPaymentDeselected","onSiteAdminTabSelected","onSiteAdminTabDeselected","updateDiscountOrgValues","updateActiveOrder","payOnCompletion","go_to_confirm","direct_order_discount","PUDSetting","plate_points_discount","SessDiscSetting","DR_level","curOrderLevel","dream_rewards_level","JSON","stringify","changeListStr","onAddPaymentAndActivate","_validate_discounts","couponFreeMenuItemRequired","_check_elements","get","coupon_id","coupon_free_menu_item","fundraiser_id","fundraiser_value","updateReportingOrgValues","couponFreeMenuItem","paymentToken","send","token","paymentNumber","warnOfOutstandingSavedOrdersOnFullSession","addOnly","payment1Data","next_dest","contentWindow","pp_success","error_code","buttons","Okay","reloadOnFailure","href","comment_payload","PayFlow_Payload","addNameValuePair","user_email","expdate","csc","amt","payload","USER_DETAILS","store_credit_amount","DP_State","depositAmount","store_specific_deposit","payflowErrorURL","parmList","retrieveEncodedString","key","hasOwnProperty","tr_action","pfp_test_mode","transparent_redirect_link","create_and_submit_form","action","target","input","SECURETOKEN","SECURETOKENID","tokenID","PARMLIST","getPaymentData","payment_number","paymentData","number","amount","cert_type","ccNameOnCard","ccType","ccMonth","ccYear","cc_security_code","billing_address","billing_postal_code","is_store_specific_flat_rate_deposit_delayed_payment","do_not_ref","DPSetting","alert","indexOf","reference_id","validatePayment1","inputArray","validates","substr","depositWarningStr","validatePayment2","addPaymentAndActivate","Number","valueOf","changesBlurb","getAbbreviatedSummaryString","bundleIsSelected","numBundItems","countSelectedBundleItems","save2PaymentsAndBookOrder","payment2Type","payment2Data","supports_transparent_redirect","billing_name","billing_zip","async","chain_token","payment_data","add_payment_data","delay_remainder","savePayment2","handleDirectPayment","payment1Type","use_store_credits","mainPaymentData","additionalPaymentData","store_credits_amount","closeOnEscape","Refresh","cur_session_id","onDayClick","doReschedule","sessionTime","curSessionDate","open","siblings","focus","onRescheduleClick","isDiscounted","control_message","onSessionClick","monthChange","monthVal","handle_delayed_payment","tc_delayed_payment_agree","lang","en","tc","terms_and_conditions","delayed_payment","parent","Agree","off","set_user_pref","Decline","trigger","delayed_payment_decline","createBonusCredit","creditConsumed","creditBasis","removeBonusCredit","handleSummaryDisplayChange","checked","ShowAllLineItems","serviceFeeOrg","serviceFee","serviceTaxOrg","serviceTax","miscFoodOrg","miscFood","miscNonFoodOrg","miscNonFood","doDiscountOrg","doDiscount","couponDiscountOrg","couponDiscount","platePointsDiscountOrg","platePointsDiscount","foodTaxOrg","foodTax","nonFoodTaxOrg","nonFoodTax","productsSubtotalOrg","productsSubtotal","sort_by_price","a","b","price","getPlatePointsDiscountableAmount","total","retVal","nonDiscountableAmount","servingsCount","sort","thisItem","servingThisItem","qty","serving_size","costThisItem","getElementById","miscFoodSubtotal","drawChangeList","htmlStr","item","stdMenuItems","pricing_type","FTMenuItems","hadMiscCostChanges","miscCosts","getHumanReadableName","miscDescs","order_type","bundleItems","discounts","reporting","coupon","change_type","ccRefundTotal","parseFloat","bundleChecked","stdItemCount","FTItemCount","curVal","descIDStr","desc","discountsHTML","newSDValue","newPUDValue","showSaveButton","orgVal","newVal","diff","bundleOrgVal","orgCouponVal","curCouponVal","allowLimitedAccess","handleAutoAdjust","balance","canAdjustDelayedPayment","currentDPAmount","changePayment1","adjustPendingDelayedPayment","assignBalanceToRefTransactions","ident","existingPaymentAmountArray","reportPaymentStatus","getAbbreviatedChangeString","addedStd","removedStd","addedFT","removedFT","addedBI","removedBI","addPaymentToLockedOrder","submitPage","form","confirm_and_check_form","dialogHeight","name","appendTo","submit","resetPage","_check_form","dd_round_amount","inAmount","tempVal","parseInt","Math","floor","updateSideStationStatus","entree_id","help_message","stationHelpName","stationHelpElem","css","requiredItemCount","sideStationBundleInfo","number_items_required","numSelected","bundle","sid","sinfo","itemQty","inv_qty","entreeIDToInventoryMap","remaining","servings_per_item","servings","halfQty","wholeQty","sideDishQty","sideDishSubTotal","discounted_total","creditContribution","sortedCoreItemList","itemsSelected","x","org_remaining","itemId","orgAmount","getAttribute","push","originallyHadBundle","selectedBundleItemCount","selectedBundleServingsCount","bundleInfo","tasteBundleMenuData","hasDreamTasteBundle","selectedWholeBundleItemCount","selectedHalfBundleItemCount","dreamTastePrice","tasteItemQty","discountablePlatePointsAmount","couponlimitedToFT","color","removeAttr","maxPPCredit","maxPPDeduction","curPPDiscount","addonsSubtotal","addonsQty","itemNumber","qty_str","prc_str","addQty","addonsQtyNumber","addPrc","addPrcNumber","toString","itemCountLabel","itemCountAdjustmentAmount","displayServingsAdjustment","couponTypeElem","cfm_size","displayMealCount","displayServingCount","orderEditSuccess","newAddonQty","freeMealValue","newAddonAmount","round","food_costs","session_discount_basis","newGrandTotal","pre_discounts_grand_total","directDiscountVal","directDiscount","couponDiscountMethod","newDiscountAmount","couponDiscountVar","newDiscountVal","couponDiscountVal","PUDElem","selectedUP","UPDiscount","premarkup_discounted_total","UPType","PcntTypeValue","originalUP","cost","rounded_pud_result","activeUP","promoVal","UPDiscountElem","food_portion_of_points_credit","fee_portion_of_points_credit","discountMFYFeeFirst","foodPortionOfMaxDeduction","SessDisc","selectedSD","sessionDiscount","originalSD","SDiscountElem","miscNonFoodSubtotal","newNonFoodTax","curNonFoodTax","curEnrollmentTax","newFoodTax","newServiceTax","curFoodTax","curServiceTax","taxElem","innerHTML","preTaxTotal","orderInfoGrandTotal","paymentTotal","remainingBalance","changePayment2","defaultPaymentAmount","amountStoreCredit","payment1Amount","autoAdjustDiv","canAutoAdjust","forceManualAutoAdjust"],"sourceRoot":"js/src/dreamdinners/admin","sources":["order_mgr_test.js"],"sourcesContent":["var itemChanges = false;\nvar discountOrPaymentChanges = false;\nvar discountChanges = false;\nvar reportingChanges = false;\nvar paymentChanges = false;\nvar initialSessionDiscountSetting = \"noSD\";\nvar initialPreferredUserDiscountSetting = \"noUP\";\nvar changeList = null;\nvar isFactoringCredit = false;\nvar currentCreditAvailable = 0;\nvar stationNeedsAttention = false;\nvar relatedOrdersAreLoaded = false;\nvar currentlySavingOrder = false;\nvar onTimeShotAtSupplyingZeroPaymentHasOccurred = false;\nvar needPlatePointsMaxDiscountChangeWarning = false;\nvar lastMaxPPDiscountAmount = -1;\n\nfunction admin_order_mgr_init()\n{\n\n\tif (store_id != STORE_DETAILS.id)\n\t{\n\t\tSTORE_DETAILS.id = store_id;\n\n\t\t//STORE_DETAILS.id is either the current fadmin store - in which case a match is guaranteed or\n\t\t// is the current Site Admin store (last selection from a store drop down.) However in this case if the order was accessed by the address\n\t\t// bar a match is not guaranteed so force STORE_DETAILS.id to store_id which is always the store of the order\n\t}\n\n\tif (orderState == 'NEW')\n\t{\n\t\tsetupForNewOrder();\n\t}\n\telse if (orderState == 'SAVED')\n\t{\n\t\tsetupForSavedOrder();\n\t}\n\telse\n\t{\n\t\tsetupForActiveOrder();\n\t}\n\n\tif (hasBundle)\n\t{\n\t\tbundleSetup();\n\t}\n\n\tsetupSiteAdminFunctions();\n\n\tinitChangeList();\n\n\tif (orderState != 'NEW')\n\t{\n\t\tcalculateTotal();\n\n\t\tsetAllPaymentFieldsToUnrequired();\n\n\t\tsetupCouponState();\n\t}\n\n\tsetUpKeyHandlers();\n\n\tif (getQueryVariable(\"session_full\") == \"true\")\n\t{\n\t\tvar query = window.location.search.substring(1);\n\t\tvar vars = query.split(\"&\");\n\t\tvar newQueryString = \"?\";\n\n\t\tvar first = true;\n\t\tfor (var i = 0; i < vars.length; i++)\n\t\t{\n\n\t\t\tvar pair = vars[i].split(\"=\");\n\t\t\tif (pair[0] != 'session_full')\n\t\t\t{\n\t\t\t\tif (!first)\n\t\t\t\t{\n\t\t\t\t\tnewQueryString += \"&\";\n\t\t\t\t}\n\n\t\t\t\tnewQueryString += vars[i];\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\thistoryPush({url: newQueryString});\n\t}\n\n\thandle_special_instruction_notes();\n\thandle_cancel_order();\n\thandle_delete_saved_order();\n\n\thandle_free_menu_item_edit();\n\thandle_fundraiser_selection();\n}\n\nvar intenseLoggingOn = true;\n\nfunction intenseLogging(message)\n{\n\tif (window.console && intenseLoggingOn)\n\t{\n\t\tconsole.log('OM Intense logging: ' + message);\n\t}\n}\n\nfunction saveSpecialInstructions()\n{\n\n\tvar special_instructions = strip_tags($(\"#order_user_notes\").val());\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_special_instructions',\n\t\t\torder_id: order_id,\n\t\t\tspecial_instructions: special_instructions\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tupdateInstructionsOrgValues();\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveSpecialInstructions: \" + json.processor_message);\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\tintenseLogging(\"saveSpecialInstructions: \" + strError + \" | \" + objAJAXRequest.responseText);\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\t});\n}\n\nfunction handle_special_instruction_notes()\n{\n\t$('[id^=\"gd_special_instruction_note_button-\"]').each(function ()\n\t{\n\n\t\t$(this).on('click', function (e)\n\t\t{\n\n\t\t\tvar booking_id = $(this).data('booking_id');\n\t\t\tvar user_id = $(this).data('user_id');\n\t\t\tvar do_op = 'get';\n\t\t\tvar special_instructions = '';\n\n\t\t\tif ($(this).data('edit_mode') == true)\n\t\t\t{\n\t\t\t\tdo_op = 'save';\n\n\t\t\t\tspecial_instructions = strip_tags($('#gd_special_instruction_note-' + booking_id + ' > textarea').val());\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\turl: 'ddproc.php',\n\t\t\t\ttype: 'POST',\n\t\t\t\ttimeout: 20000,\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\t\top: 'update_special_instructions',\n\t\t\t\t\t'do': do_op,\n\t\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\t\tuser_id: user_id,\n\t\t\t\t\torder_id: order_id,\n\t\t\t\t\tnote: special_instructions\n\t\t\t\t},\n\t\t\t\tsuccess: function (json)\n\t\t\t\t{\n\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (do_op == 'get')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar textarea_elem = $('<textarea></textarea>').addClass('form-control').val((json.special_instruction_note ? json.special_instruction_note : \"\")).on('keyup', function (e)\n\t\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t\tif ($(this).val() != strip_tags($(this).val()))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$(this).val(strip_tags($(this).val()));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).addClass('special_instruction_note_edit').html(textarea_elem);\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', true).html('Save Note');\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).data('special_instruction_note_value', (json.special_instruction_note ? json.special_instruction_note : \"\")).on('click', function (e)\n\t\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + $(this).data('booking_id')).removeClass('special_instruction_note_edit').html($(this).data('special_instruction_note_value'));\n\n\t\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + $(this).data('booking_id')).data('edit_mode', false).html('Special Instructions');\n\n\t\t\t\t\t\t\t\t$(this).hide();\n\n\t\t\t\t\t\t\t}).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#gd_special_instruction_note-' + booking_id).removeClass('special_instruction_note_edit').html(nl2br(json.special_instruction_note));\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_cancel_button-' + booking_id).hide();\n\n\t\t\t\t\t\t\t$('#gd_special_instruction_note_button-' + booking_id).data('edit_mode', false).html('Special Instructions');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"handle_special_instruction_notes: \" + strError + \" | \" + objAJAXRequest.responseText);\n\t\t\t\t\tresponse = 'Unexpected error';\n\t\t\t\t}\n\t\t\t});\n\n\t\t});\n\n\t});\n}\n\nvar lastCheckedGiftCertNumber = null;\n\nfunction setUpKeyHandlers()\n{\n\tdocument.onkeypress = OMDefaultKeyHandler;\n\n\t$(\"#coupon_code\").on('keypress', function (evt)\n\t{\n\t\t// the enter key will submit a coupon code\n\t\tevt = (evt) ? evt : event;\n\t\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\t\tif (charCode == 13)\n\t\t{\n\t\t\tprocessCode();\n\t\t\tevt.stopPropagation();\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t});\n\n\t$(\"#order_user_notes\").on('keypress', function (evt)\n\t{\n\t\tevt.stopPropagation();\n\t\treturn true;\n\t});\n\n\t$(\"#payment1_gc_payment_number\").on('keyup', function (evt)\n\t{\n\n\t\tif ($(this).val().length == 15 && !isNaN($(this).val()) && $(this).val() != lastCheckedGiftCertNumber)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Warning',\n\t\t\t\tmessage: \"It appears that you may be entering a gift Card number. If so, select Gift Card from payment selector. This is the Certificate (Gift Certificate) payment type.\"\n\t\t\t});\n\t\t}\n\n\t\tlastCheckedGiftCertNumber = $(this).val();\n\n\t\treturn true;\n\t});\n\n}\n\nfunction OMDefaultKeyHandler(evt)\n{\n\t// by default the document just eats the enter key\n\n\tevt = (evt) ? evt : event;\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\n\n\tif (charCode == 13)\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n\n}\n\nfunction initChangeList()\n{\n\t$(\"#changeListTab\").on('click', function ()\n\t{\n\n\t\tvar html = getChangeListHTML();\n\n\t\tif (!html || html == \"\")\n\t\t{\n\t\t\thtml = \"<h3><i>No Changes</i></h3>\"\n\t\t}\n\n\t\tdd_message({\n\t\t\ttitle: 'Change List',\n\t\t\tmessage: html,\n\t\t\theight: 620,\n\t\t\twidth: 300,\n\t\t\tmodal: false,\n\t\t\tdiv_id: 'changelist',\n\t\t\tdialogClass: 'fixedDialog',\n\t\t\tnoOk: true,\n\t\t\tposition: {\n\t\t\t\tmy: \"left top\",\n\t\t\t\tat: \"left bottom\",\n\t\t\t\tof: this\n\t\t\t},\n\t\t\tclose: function (event, ui)\n\t\t\t{\n\t\t\t\t$(\"#changelist\").remove();\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction setupSiteAdminFunctions()\n{\n\t$(\"#in-store_status, #plate_points_status\").on('click', function ()\n\t{\n\n\t\tvar flagName = this.id;\n\t\tvar checkbox = $(this);\n\t\tif (orderState != 'ACTIVE')\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: \"These flags can only be set on ACTIVE orders.\"\n\t\t\t});\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar newState = \"off\";\n\t\t\tif ($(this).is(\":checked\"))\n\t\t\t{\n\t\t\t\tnewState = \"on\";\n\t\t\t}\n\n\t\t\tvar oldState = 1;\n\t\t\tif (newState == \"on\")\n\t\t\t{\n\t\t\t\toldState = 0;\n\t\t\t}\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Status Update',\n\t\t\t\tmessage: \"Are you sure you want to update the order status?\",\n\t\t\t\tcancel: function ()\n\t\t\t\t{\n\t\t\t\t\tcheckbox.prop('checked', oldState ? true : false)\n\n\t\t\t\t},\n\t\t\t\tconfirm: function ()\n\t\t\t\t{\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: 'ddproc.php',\n\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\ttimeout: 20000,\n\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\t\t\t\tuser_id: user_id,\n\t\t\t\t\t\t\top: 'update_status_flag',\n\t\t\t\t\t\t\torder_id: order_id,\n\t\t\t\t\t\t\tflag: flagName,\n\t\t\t\t\t\t\tnew_state: newState\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsuccess: function (json)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\ttitle: 'Update Success',\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t\tintenseLogging(\"update_status_flag: \" + json.processor_message);\n\n\t\t\t\t\t\t\t\t$(this).attr(\"checked\", oldState);\n\n\t\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tintenseLogging(\"update_status_flag: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\t\t\t\t$(this).attr(\"checked\", oldState);\n\n\t\t\t\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\t\t\t\tdd_message({\n\t\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\t\tmessage: response\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction updateItemsOrgValues()\n{\n\n\t$(\"[id^='qty_']\").each(function ()\n\t{\n\t\t$(this).data('org_value', $(this).val());\n\t});\n\n\t$(\"[data-dd_type='item_field']\").each(function ()\n\t{\n\t\t$(this).data('org_value', $(this).val());\n\t});\n\n\t$('#selectedBundle').data('org_value', $('#selectedBundle').is(':checked') ? \"1\" : \"0\");\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t{\n\t\t\t$(this).data('org_value', $(this).val());\n\t\t});\n\t}\n\telse\n\t{\n\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t{\n\t\t\t$(this).data('org_value', $(this).is(':checked') ? \"1\" : \"0\");\n\t\t});\n\t}\n\n\tupdateChangeList();\n\n}\n\nfunction saveAll()\n{\n\tsaveItems(true);\n}\n\nfunction saveItems(saveDiscountsUponCompletion)\n{\n\n\tintenseLogging(\"saveItems() called\");\n\n\tif (currentlySavingOrder)\n\t{\n\t\tdd_toast({\n\t\t\tmessage: 'Items are still being saved',\n\t\t\tposition: 'topcenter'\n\t\t});\n\t\treturn;\n\t}\n\n\tdd_toast({\n\t\tmessage: 'Items Saved',\n\t\tposition: 'topcenter'\n\t});\n\n\tvar itemsList = {};\n\tvar introItemsList = {};\n\tvar subItemsList = {};\n\n\tvar is_intro = \"false\";\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\t$(\"[id^=bnd_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t// this will pick up any FT items\n\t\t$(\"[id^=qty_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\telse\n\t{\n\n\t\tif ($(\"#selectedBundle\").is(\":checked\"))\n\t\t{\n\n\t\t\tis_intro = \"true\";\n\n\t\t\t$(\"[id^=bnd_]\").each(function ()\n\t\t\t{\n\n\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t{\n\t\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\t\tintroItemsList[item_id] = \"on\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t\t$(\"[id^=qty_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t$(\"[id^=sbi_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\tsubItemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\n\tvar misc_food_subtotal = $(\"#misc_food_subtotal\").val();\n\tif (isNaN(misc_food_subtotal))\n\t{\n\t\tmisc_food_subtotal = \"0.00\";\n\t}\n\n\tvar misc_nonfood_subtotal = $(\"#misc_nonfood_subtotal\").val();\n\tif (isNaN(misc_nonfood_subtotal))\n\t{\n\t\tmisc_nonfood_subtotal = \"0.00\";\n\t}\n\n\tvar subtotal_service_fee = $(\"#subtotal_service_fee\").val();\n\tif (isNaN(subtotal_service_fee))\n\t{\n\t\tsubtotal_service_fee = \"0.00\";\n\t}\n\n\tvar misc_food_subtotal_desc = $(\"#misc_food_subtotal_desc\").val();\n\tvar misc_nonfood_subtotal_desc = $(\"#misc_nonfood_subtotal_desc\").val();\n\tvar service_fee_description = $(\"#service_fee_description\").val();\n\n\tvar special_instructions = $(\"#order_user_notes\").val();\n\n\tcurrentlySavingOrder = true;\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_items',\n\t\t\torder_id: order_id,\n\t\t\titems: itemsList,\n\t\t\tmisc_food_subtotal: misc_food_subtotal,\n\t\t\tmisc_nonfood_subtotal: misc_nonfood_subtotal,\n\t\t\tsubtotal_service_fee: subtotal_service_fee,\n\t\t\tmisc_food_subtotal_desc: misc_food_subtotal_desc,\n\t\t\tmisc_nonfood_subtotal_desc: misc_nonfood_subtotal_desc,\n\t\t\tservice_fee_description: service_fee_description,\n\t\t\tis_intro: is_intro,\n\t\t\tintro_items: introItemsList,\n\t\t\tsub_items: subItemsList,\n\t\t\tspecial_instructions: special_instructions\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\titemTabIsDirty = false;\n\t\t\t\tupdateItemsOrgValues();\n\n\t\t\t\tcurrentlySavingOrder = false;\n\n\t\t\t\tintenseLogging(\"saveItems() successful\");\n\n\t\t\t\tif (saveDiscountsUponCompletion)\n\t\t\t\t{\n\t\t\t\t\tsaveDiscounts(false);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcurrentlySavingOrder = false;\n\n\t\t\t\tintenseLogging(\"update_items: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\tcurrentlySavingOrder = false;\n\t\t\tintenseLogging(\"update_items: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction setSessionAndSave(session_id)\n{\n\n\tintenseLogging(\"setSessionAndSave() called\");\n\n\tdisplayModalWaitDialog('saving_div', \"Setting session. Please wait ...\");\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 90000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'set_session_and_save',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val()\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"setSessionAndSave() successful\");\n\n\t\t\t\tif (json.full_session_warning_required)\n\t\t\t\t{\n\t\t\t\t\tbounce(\"/?page=admin_order_mgr&order=\" + json.order_id + \"&session_full=true\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbounce(\"/?page=admin_order_mgr&order=\" + json.order_id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\t$(\"#saving_div\").remove();\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tintenseLogging(\"set_session_and_save: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$(\"#saving_div\").remove();\n\n\t\t\tintenseLogging(\"set_session_and_save: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction Reschedule(org_session_id)\n{\n\n\tintenseLogging(\"Reschedule() called\");\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'reschedule',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\torder_id: order_id,\n\t\t\tsaved_booking_id: saved_booking_id,\n\t\t\torg_session_id: org_session_id\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"Reschedule() successful\");\n\n\t\t\t\tsession_id = json.new_session_id;\n\t\t\t\t$(\"#curSessionDate\").html(json.new_session_time);\n\n\t\t\t\tRetrieveCalendar(0);\n\n\t\t\t\tif (!json.canDelayPayment)\n\t\t\t\t{\n\t\t\t\t\t$(\".delayedPaymentSection\").hideFlex();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\".delayedPaymentSection\").showFlex();\n\t\t\t\t}\n\n\t\t\t\tif (json.session_discount)\n\t\t\t\t{\n\t\t\t\t\t$(\"#noSessionDiscountRow\").hide();\n\t\t\t\t\t$(\"#newSessionDiscountBody\").show();\n\t\t\t\t\t$(\"#sessionDiscountTypeSpan\").html(json.session_discount.type);\n\t\t\t\t\t$(\"#sessionDiscountValueSpan\").html(json.session_discount.value);\n\t\t\t\t\tactiveSessionDiscount.id = json.session_discount.id;\n\t\t\t\t\tactiveSessionDiscount.type = json.session_discount.type;\n\t\t\t\t\tactiveSessionDiscount.value = json.session_discount.value;\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#noSessionDiscountRow\").show();\n\t\t\t\t\t$(\"#newSessionDiscountBody\").hide();\n\t\t\t\t\tactiveSessionDiscount.id = 0;\n\t\t\t\t\tactiveSessionDiscount.type = 'none';\n\t\t\t\t\tactiveSessionDiscount.value = 0;\n\n\t\t\t\t}\n\n\t\t\t\t$(\"#curSessionTypeSpan\").html(json.session_info.session_type_text);\n\t\t\t\t$(\"#curSessionRemainingSlotsSpan\").html(json.session_info.remaining_slots);\n\t\t\t\t$(\"#curSessionRemainingIntroSlotsSpan\").html(json.session_info.remaining_intro_slots);\n\n\t\t\t\tif (json.serviceFeeUpdate != -1)\n\t\t\t\t{\n\n\t\t\t\t\t//bounce(window.location.href);\n\n\t\t\t\t\t$(\"#subtotal_service_fee\").val(formatAsMoney(json.serviceFeeUpdate));\n\t\t\t\t\t$(\"#service_fee_description\").val(json.serviceFeeDescUpdate);\n\t\t\t\t\tcalculateTotal();\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"reschedule: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\n\t\t\tintenseLogging(\"reschedule: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\nfunction onSetSessionAndSave(obj)\n{\n\tintenseLogging(\"onSetSessionAndSave() called\");\n\n\tvar session_id = $(\"#selected_session\").attr(\"data-session_id\");\n\tsetSessionAndSave(session_id);\n\treturn false;\n}\n\nfunction onSaveItems()\n{\n\tintenseLogging(\"onSaveItems() called\");\n\n\tsaveItems();\n\treturn false;\n\n}\n\nfunction setupForNewOrder()\n{\n\tHideLineItemsIfZero();\n\tvar timestamp = getQueryVariable('month');\n\tif (!timestamp)\n\t{\n\t\ttimestamp = \"0\";\n\t}\n\tRetrieveCalendar(timestamp);\n\t$(\"#addPaymentAndActivate\").show();\n\n}\n\nfunction setupForSavedOrder()\n{\n\t$(\"#addPaymentAndActivate\").show();\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tinitialSessionDiscountSetting = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tinitialPreferredUserDiscountSetting = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\t}\n}\n\nfunction setupForActiveOrder()\n{\n\tif (discountEligable.limited_access)\n\t{\n\t\t$(\"#payments_tab_li\").click();\n\n\t\t$(\"#items_tab_li\").addClass(\"disabled\");\n\t\t$(\"#sessions_tab_li\").addClass(\"disabled\");\n\t\t$(\"#discountsDiv\").find(\":input\").prop(\"disabled\", true);\n\t\t$(\"#discountsDiv\").find(\"*\").addClass(\"om_disabled\");\n\n\t}\n\n\t$(\"#addPaymentAndActivate\").hide();\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tinitialSessionDiscountSetting = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tinitialPreferredUserDiscountSetting = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\t}\n\n}\n\nfunction onSessionTabSelected()\n{\n\tRetrieveCalendar(0);\n}\n\nfunction onSessionTabDeselected()\n{\n\treturn true;\n}\n\nfunction onItemsTabSelected()\n{\n}\n\nfunction onItemsTabDeselected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\tif (itemTabIsDirty)\n\t\t{\n\t\t\t/*\n\t\t\t dd_message({\n\t\t\t title: 'Attention',\n\t\t\t message: 'You have unsaved changes. Do you wish to save changes to the items tab?',\n\t\t\t confirm: function() {\n\t\t\t }\n\t\t\t });\n\t\t\t */\n\n\t\t\tsaveItems();\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction onPaymentTabSelected()\n{\n\thandle_free_menu_item_edit();\n}\n\nfunction onPaymentTabDeselected()\n{\n\tif (orderState != 'ACTIVE' && (discountChanges || reportingChanges))\n\t{\n\t\tsaveDiscounts(false);\n\t}\n\n\treturn true;\n}\n\nfunction onRelatedOrdersTabSelected()\n{\n\tif (!relatedOrdersAreLoaded)\n\t{\n\n\t\tintenseLogging(\"Loading related Orders\");\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'retrieve_related_orders',\n\t\t\t\tsession_id: session_id,\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"Loading related Orders successful\");\n\n\t\t\t\t$(\"#related_orders\").html(json.data);\n\t\t\t\t$(\"#loading_related_orders\").remove();\n\t\t\t\trelatedOrdersAreLoaded = true;\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#loading_related_orders\").remove();\n\n\t\t\t\tintenseLogging(\"retrieve_related_orders: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t});\n\t}\n\n}\n\nfunction onRelatedOrdersTabDeselected()\n{\n\treturn true;\n}\n\nfunction onNotesTabSelected()\n{\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'get_history',\n\t\t\tsession_id: session_id,\n\t\t\tuser_id: user_id,\n\t\t\torder_id: order_id\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\t$(\"#history_div\").html(json.html);\n\n\t\t\thandle_guest_account_notes();\n\n\t\t\thandle_admin_carryover_notes();\n\n\t\t\thandle_admin_order_notes();\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\n\t\t\tintenseLogging(\"get_history: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onNotesTabDeselected()\n{\n\treturn true;\n}\n\nfunction onPaymentSelected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\n\t\tpaymentChanges = true;\n\t\tupdateChangeList();\n\t}\n\telse\n\t{\n\t\tpaymentChanges = true;\n\t\tupdateChangeList();\n\t}\n}\n\nfunction onPaymentDeselected()\n{\n\tif (orderState != 'ACTIVE')\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\n\t\tupdateChangeList();\n\t\tpaymentChanges = false;\n\t}\n\telse\n\t{\n\t\tpaymentChanges = false;\n\t\tupdateChangeList();\n\t}\n\n\treturn true;\n\n}\n\nfunction onSiteAdminTabSelected()\n{\n\n}\n\nfunction onSiteAdminTabDeselected()\n{\n\treturn true;\n}\n\nfunction updateDiscountOrgValues()\n{\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tinitialSessionDiscountSetting = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tinitialPreferredUserDiscountSetting = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\t}\n\n\t$(\"#org_coupon_id\").val($(\"#coupon_id\").val());\n\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function ()\n\t{\n\t\t$(this).data('org_value', $(this).val());\n\t});\n\n\tupdateChangeList();\n\n}\n\nfunction updateActiveOrder(payOnCompletion, go_to_confirm)\n{\n\tintenseLogging(\"updateActiveOrder() called\");\n\n\tvar itemsList = {};\n\tvar introItemsList = {};\n\tvar subItemsList = {};\n\n\tvar is_intro = \"false\";\n\n\tif (isDreamTaste || isFundraiser)\n\t{\n\t\t$(\"[id^=bnd_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t//pick up any sides\n\t\t$(\"[id^=qty_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\telse\n\t{\n\n\t\tif ($(\"#selectedBundle\").is(\":checked\"))\n\t\t{\n\n\t\t\tis_intro = \"true\";\n\n\t\t\t$(\"[id^=bnd_]\").each(function ()\n\t\t\t{\n\n\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t{\n\t\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\t\tintroItemsList[item_id] = \"on\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t\t$(\"[id^=qty_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\titemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t\t$(\"[id^=sbi_]\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tvar item_id = this.id.split(\"_\")[1];\n\t\t\t\tsubItemsList[item_id] = $(this).val();\n\t\t\t}\n\t\t});\n\n\t}\n\n\tvar misc_food_subtotal = $(\"#misc_food_subtotal\").val();\n\tif (isNaN(misc_food_subtotal))\n\t{\n\t\tmisc_food_subtotal = \"0.00\";\n\t}\n\n\tvar misc_nonfood_subtotal = $(\"#misc_nonfood_subtotal\").val();\n\tif (isNaN(misc_nonfood_subtotal))\n\t{\n\t\tmisc_nonfood_subtotal = \"0.00\";\n\t}\n\n\tvar subtotal_service_fee = $(\"#subtotal_service_fee\").val();\n\tif (isNaN(subtotal_service_fee))\n\t{\n\t\tsubtotal_service_fee = \"0.00\";\n\t}\n\n\tvar misc_food_subtotal_desc = $(\"#misc_food_subtotal_desc\").val();\n\tvar misc_nonfood_subtotal_desc = $(\"#misc_nonfood_subtotal_desc\").val();\n\tvar service_fee_description = $(\"#service_fee_description\").val();\n\n\tvar direct_order_discount = $(\"#direct_order_discount\").val();\n\tif (isNaN(direct_order_discount))\n\t{\n\t\tdirect_order_discount = \"0.00\";\n\t}\n\n\tvar PUDSetting = $('input[name=PUD]:checked', '#editorForm').val();\n\n\tif (PUDSetting == null || PUDSetting == \"\")\n\t{\n\t\tPUDSetting = \"noUP\";\n\t}\n\n\tvar plate_points_discount = $(\"#plate_points_discount\").val();\n\tif (isNaN(plate_points_discount))\n\t{\n\t\tplate_points_discount = \"0.00\";\n\t}\n\n\tvar SessDiscSetting = $('input[name=SessDisc]:checked', '#editorForm').val();\n\n\tif (SessDiscSetting == null || SessDiscSetting == \"\")\n\t{\n\t\tSessDiscSetting = \"noSD\";\n\t}\n\n\tvar DR_level = 0;\n\tif ($(\"#dr_level_for_order\").length)\n\t{\n\t\tvar curOrderLevel = $(\"#dr_level_for_order\").val();\n\t\tif (curOrderLevel > 0)\n\t\t{\n\t\t\tDR_level = curOrderLevel;\n\t\t}\n\t}\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\tuser_id: user_id,\n\t\t\top: 'update_active_order',\n\t\t\torder_id: order_id,\n\t\t\titems: itemsList,\n\t\t\tmisc_food_subtotal: misc_food_subtotal,\n\t\t\tmisc_nonfood_subtotal: misc_nonfood_subtotal,\n\t\t\tsubtotal_service_fee: subtotal_service_fee,\n\t\t\tmisc_food_subtotal_desc: misc_food_subtotal_desc,\n\t\t\tmisc_nonfood_subtotal_desc: misc_nonfood_subtotal_desc,\n\t\t\tservice_fee_description: service_fee_description,\n\t\t\tis_intro: is_intro,\n\t\t\tintro_items: introItemsList,\n\t\t\tsub_items: subItemsList,\n\t\t\tdirect_order_discount: direct_order_discount,\n\t\t\tPUDSetting: PUDSetting,\n\t\t\tplate_points_discount: plate_points_discount,\n\t\t\tSessDiscSetting: SessDiscSetting,\n\t\t\tdream_rewards_level: DR_level,\n\t\t\tchangeList: JSON.stringify(changeList),\n\t\t\tchangeListStr: getChangeListHTML(),\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val()\n\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"updateActiveOrder() successful\");\n\n\t\t\t\titemTabIsDirty = false;\n\t\t\t\tupdateItemsOrgValues();\n\t\t\t\tupdateDiscountOrgValues();\n\n\t\t\t\tif (payOnCompletion)\n\t\t\t\t{\n\t\t\t\t\tonAddPaymentAndActivate(payOnCompletion, go_to_confirm, json.getTokenToken);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"update_active_order: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\tintenseLogging(\"update_active_order: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction _validate_discounts()\n{\n\t// check to see if coupon requires free menu selection\n\tif (couponFreeMenuItemRequired)\n\t{\n\t\treturn _check_elements([$('#free_menu_item_coupon').get(0)]);\n\t}\n\n\treturn true;\n}\n\nfunction saveDiscounts(payOnCompletion)\n{\n\tintenseLogging(\"saveDiscounts() called\");\n\n\tif (!_validate_discounts())\n\t{\n\t\treturn false;\n\t}\n\n\tif (!payOnCompletion)\n\t{\n\t\tdd_toast({\n\t\t\tmessage: 'Discounts Saved',\n\t\t\tposition: 'topcenter'\n\t\t});\n\t}\n\n\tvar direct_order_discount = $(\"#direct_order_discount\").val();\n\tif (isNaN(direct_order_discount))\n\t{\n\t\tdirect_order_discount = \"0.00\";\n\t}\n\n\tvar PUDSetting = $('input[name=PUD]:checked', '#editorForm').val();\n\n\tif (PUDSetting == null || PUDSetting == \"\")\n\t{\n\t\tPUDSetting = \"noUP\";\n\t}\n\n\tvar plate_points_discount = $(\"#plate_points_discount\").val();\n\tif (isNaN(plate_points_discount))\n\t{\n\t\tplate_points_discount = \"0.00\";\n\t}\n\n\tvar SessDiscSetting = $('input[name=SessDisc]:checked', '#editorForm').val();\n\n\tif (SessDiscSetting == null || SessDiscSetting == \"\")\n\t{\n\t\tSessDiscSetting = \"noSD\";\n\t}\n\n\tvar DR_level = 0;\n\tif ($(\"#dr_level_for_order\").length)\n\t{\n\t\tvar curOrderLevel = $(\"#dr_level_for_order\").val();\n\t\tif (curOrderLevel > 0)\n\t\t{\n\t\t\tDR_level = curOrderLevel;\n\t\t}\n\t}\n\n\tvar coupon_id = 0;\n\tvar coupon_free_menu_item = 0;\n\tif ($(\"#coupon_id\").val())\n\t{\n\t\tif (couponFreeMenuItemRequired)\n\t\t{\n\t\t\tif ($('#free_menu_item_coupon').val())\n\t\t\t{\n\t\t\t\tcoupon_free_menu_item = $('#free_menu_item_coupon').val();\n\t\t\t}\n\t\t}\n\n\t\tcoupon_id = $(\"#coupon_id\").val();\n\t}\n\n\tvar fundraiser_id = $('#fundraiser_id').val();\n\tvar fundraiser_value = $('#fundraiser_value').val();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'update_discounts',\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id,\n\t\t\tdirect_order_discount: direct_order_discount,\n\t\t\tPUDSetting: PUDSetting,\n\t\t\tplate_points_discount: plate_points_discount,\n\t\t\tSessDiscSetting: SessDiscSetting,\n\t\t\tcoupon_id: coupon_id,\n\t\t\tcoupon_free_menu_item: coupon_free_menu_item,\n\t\t\tdream_rewards_level: DR_level,\n\t\t\tfundraiser_id: fundraiser_id,\n\t\t\tfundraiser_value: fundraiser_value\n\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"saveDiscounts() successful\");\n\n\t\t\t\tupdateDiscountOrgValues();\n\t\t\t\tupdateReportingOrgValues();\n\n\t\t\t\tif (coupon_free_menu_item)\n\t\t\t\t{\n\t\t\t\t\t$('#free_menu_item_coupon').attr('disabled', true);\n\t\t\t\t\tcouponFreeMenuItem = coupon_free_menu_item;\n\t\t\t\t}\n\n\t\t\t\tif (payOnCompletion)\n\t\t\t\t{\n\t\t\t\t\tonAddPaymentAndActivate(false, true, json.paymentToken);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tintenseLogging(\"update_discounts: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\n\t\t\tintenseLogging(\"update_discounts: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n}\n\n\nfunction updateReportingOrgValues()\n{\n\t$('#fundraiser_id').data('org_value', $('#fundraiser_id').val());\n\t$('#fundraiser_value').data('org_value', $('#fundraiser_value').val());\n\n\tupdateChangeList();\n}\n\nfunction send(token, paymentNumber, warnOfOutstandingSavedOrdersOnFullSession, addOnly, go_to_confirm, payment1Data)\n{\n\n\tintenseLogging(\"send() called for payment# \" + paymentNumber);\n\n\t$('#paypal-result').on(\"load\", function ()\n\t{\n\n\t\tintenseLogging(\"result iFrame loading\");\n\n\t\ttry\n\t\t{\n\t\t\tvar next_dest = $('#paypal-result').get(0).contentWindow.next_dest;\n\t\t\tvar success = $('#paypal-result').get(0).contentWindow.pp_success;\n\n\t\t}\n\t\tcatch (e)\n\t\t{\n\n\t\t\tintenseLogging(\"exception occurred accessing result iframe\");\n\n\t\t\t$(\"#paying_div\").remove();\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Exception',\n\t\t\t\tmessage: 'We are sorry but an unexpected error occurred during payment processing. Please try again or contact support.'\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\t// in Safari - exception is not thrown and success is undefined\n\t\t// the test is false and we drop into the success = false block\n\t\t// then error_code and message also are set to undefined\n\n\t\tif (success)\n\t\t{\n\t\t\tintenseLogging(\"success found in iframe\");\n\n\t\t\tbounce(next_dest);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar error_code = $('#paypal-result').get(0).contentWindow.error_code;\n\t\t\tvar message = $('#paypal-result').get(0).contentWindow.message;\n\n\t\t\tintenseLogging(\"error found in iframe: #\" + error_code + \" | \" + message);\n\n\t\t\tif (typeof error_code == 'undefined')\n\t\t\t{\n\t\t\t\terror_code = \"Generic\";\n\t\t\t\tmessage = 'Some required information is missing or incorrect. Please correct the fields below and try again.';\n\n\t\t\t\tintenseLogging(\"error code undefined in iframe\");\n\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\tmessage: message\n\t\t\t\t});\n\n\t\t\t}\n\t\t\telse if (next_dest && next_dest.length > 0)\n\t\t\t{\n\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"Okay\": function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbounce(next_dest);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tvar reload = $('#paypal-result').get(0).contentWindow.reloadOnFailure;\n\n\t\t\t\tif (reload)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"reloadOnFailure found in iframe: reloading\");\n\n\t\t\t\t\tmessage += \"<br /><br /><span style='color:red'>The credit card payment failed however the order was booked with the gift certificate. The page will now reload.</span>\";\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\tnoOk: true,\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\"Okay\": function ()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbounce(window.location.href);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error: ' + error_code,\n\t\t\t\t\t\tmessage: message\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t});\n\n\tvar comment_payload = new PayFlow_Payload();\n\n\tcomment_payload.addNameValuePair('UserID', user_id);\n\tcomment_payload.addNameValuePair('StoreID', STORE_DETAILS.id);\n\tcomment_payload.addNameValuePair('OrderID', order_id); // TODO: need id here of somekind so the payment can be tracked to an order. Either we create a \"blank\" order\n\t// or we use another id that is tied to the order when it is later inserted.\n\tcomment_payload.addNameValuePair('Email', user_email);\n\n\tif (paymentNumber == 1)\n\t{\n\t\tvar expdate = $(\"#payment1_ccMonth\").val();\n\t\texpdate += $(\"#payment1_ccYear\").val();\n\t\tvar csc = $(\"#payment1_cc_security_code\").val();\n\t\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t\tvar payload = new PayFlow_Payload();\n\n\t\tpayload.addNameValuePair('admin_user_id', USER_DETAILS.id);\n\t\tpayload.addNameValuePair('user_id', user_id);\n\t\tpayload.addNameValuePair('store_id', STORE_DETAILS.id);\n\t\tpayload.addNameValuePair('order_id', order_id);\n\t\tpayload.addNameValuePair('caller_id', 'fadmin_order');\n\t\tif (addOnly)\n\t\t{\n\t\t\tpayload.addNameValuePair('add_only', 'true');\n\t\t}\n\t\tif (go_to_confirm)\n\t\t{\n\t\t\tpayload.addNameValuePair('go_to_confirm', 'true');\n\t\t}\n\t\tpayload.addNameValuePair('is_second_payment', 'false');\n\n\t\tvar use_store_credits = false;\n\t\tvar store_credit_amount = 0;\n\t\tif ($(\"#use_store_credits\").length)\n\t\t{\n\t\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t\t{\n\t\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\t\tpayload.addNameValuePair('use_sc', 'true');\n\t\t\t\tpayload.addNameValuePair('sc_amt', store_credit_amount);\n\t\t\t}\n\t\t}\n\n\t\tvar DP_State = 0;\n\t\tif ($('#payment1_is_store_specific_flat_rate_deposit_delayed_payment1').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\tpayload.addNameValuePair('DP_State', DP_State);\n\t\t\t\tpayload.addNameValuePair('org_amount', amt);\n\n\n\t\t\t\tvar depositAmount = 20;\n\t\t\t\tif (DP_State == 1 && store_specific_deposit && store_specific_deposit > 20)\n\t\t\t\t{\n\t\t\t\t\tdepositAmount = store_specific_deposit;\n\t\t\t\t}\n\n\t\t\t\tif (amt * 1 <= depositAmount * 1)\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Delayed Payment Error',\n\t\t\t\t\t\tmessage: \"The amount of the payment is less than or equal to the deposit. Delayed Payment cannot be used.\"\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tamt = depositAmount;\n\n\t\t\t}\n\t\t}\n\n\t\tif (typeof payflowErrorURL == 'undefined')\n\t\t{\n\t\t\tpayflowErrorURL = \"https://dreamdinners.com/ddproc.php?processor=admin_payflow_callback\";\n\t\t}\n\n\t\t// make PARMLIST\n\t\tvar parmList = 'ERRORURL=' + payflowErrorURL + \"&ACCT=\" + $(\"#payment1_ccNumber\").val() + \"&EXPDATE=\" + expdate + \"&CSC=\" + csc + \"&AMT=\" + amt + \"&USER1=\" + payload.retrieveEncodedString() + \"&COMMENT1=\" + comment_payload.retrieveEncodedString();\n\t}\n\telse\n\t{\n\t\tvar expdate = $(\"#payment2_ccMonth\").val();\n\t\texpdate += $(\"#payment2_ccYear\").val();\n\t\tvar csc = $(\"#payment2_cc_security_code\").val();\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\tvar payload = new PayFlow_Payload();\n\n\t\tpayload.addNameValuePair('user_id', user_id);\n\t\tpayload.addNameValuePair('store_id', STORE_DETAILS.id);\n\t\tpayload.addNameValuePair('order_id', order_id);\n\t\tpayload.addNameValuePair('caller_id', 'fadmin_order');\n\t\tpayload.addNameValuePair('add_only', 'false');\n\t\tpayload.addNameValuePair('is_second_payment', 'true');\n\t\tif (go_to_confirm)\n\t\t{\n\t\t\tpayload.addNameValuePair('go_to_confirm', 'true');\n\t\t}\n\n\t\tif (payment1Data)\n\t\t{\n\t\t\tpayload.addNameValuePair(\"hasPayment1\", true);\n\n\t\t\tfor (var key in payment1Data)\n\t\t\t{\n\t\t\t\tif (payment1Data.hasOwnProperty(key))\n\t\t\t\t{\n\t\t\t\t\tpayload.addNameValuePair(\"p1_\" + key, payment1Data[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar DP_State = 0;\n\t\tif ($('#payment2_is_store_specific_flat_rate_deposit_delayed_payment1').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\tpayload.addNameValuePair('DP_State', DP_State);\n\t\t\t\tpayload.addNameValuePair('org_amount', amt);\n\n\t\t\t\tvar depositAmount = 20;\n\t\t\t\tif (DP_State == 1 && store_specific_deposit && store_specific_deposit > 20)\n\t\t\t\t{\n\t\t\t\t\tdepositAmount = store_specific_deposit;\n\t\t\t\t}\n\n\n\t\t\t\tif (amt * 1 <= depositAmount * 1)\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Delayed Payment Error',\n\t\t\t\t\t\tmessage: \"The amount of the payment is less than or equal to the deposit. Delayed Payment cannot be used.\"\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tamt = depositAmount;\n\n\t\t\t}\n\t\t}\n\n\t\tif (typeof payflowErrorURL == 'undefined')\n\t\t{\n\t\t\tpayflowErrorURL = \"https://dreamdinners.com/ddproc.php?processor=admin_payflow_callback\";\n\t\t}\n\n\t\t// make PARMLIST\n\t\tvar parmList = 'ERRORURL=' + payflowErrorURL + \"&ACCT=\" + $(\"#payment2_ccNumber\").val() + \"&EXPDATE=\" + expdate + \"&CSC=\" + csc + \"&AMT=\" + amt + \"&USER1=\" + payload.retrieveEncodedString() + \"&COMMENT1=\" + comment_payload.retrieveEncodedString();\n\t}\n\n\tvar tr_action = 'https://payflowlink.paypal.com';\n\tif (typeof pfp_test_mode != 'undefined' && pfp_test_mode)\n\t{\n\t\tvar tr_action = 'https://pilot-payflowlink.paypal.com';\n\t}\n\n\tif (typeof transparent_redirect_link != 'undefined')\n\t{\n\t\ttr_action = transparent_redirect_link;\n\t}\n\n\tintenseLogging(\"posting to PayFlow\");\n\n\t// Create dynamic form to post and redirect to session_menu\n\tcreate_and_submit_form({\n\t\taction: tr_action,\n\t\ttarget: \"paypal-result\",\n\t\tinput: ({\n\t\t\tSECURETOKEN: token.token,\n\t\t\tSECURETOKENID: token.tokenID,\n\t\t\tPARMLIST: parmList\n\t\t})\n\t});\n\n}\n\nfunction getPaymentData(type, payment_number)\n{\n\n\tif (type != 'CC')\n\t{\n\t\tvar paymentData = {\n\t\t\ttype: type,\n\t\t\tnumber: 0,\n\t\t\tamount: 0,\n\t\t\tcert_type: '',\n\t\t\tnote: $(\"#payment_note\").val()\n\t\t}\n\t}\n\telse\n\t{\n\t\tvar paymentData = {\n\t\t\ttype: type,\n\t\t\tnumber: 0,\n\t\t\tamount: 0,\n\t\t\tcert_type: '',\n\t\t\tnote: $(\"#payment_note\").val(),\n\t\t\tccNameOnCard: \"\",\n\t\t\tccType: 'CC',\n\t\t\tccMonth: \"\",\n\t\t\tccYear: \"\",\n\t\t\tcc_security_code: \"\",\n\t\t\tbilling_address: \"\",\n\t\t\tbilling_postal_code: \"\",\n\t\t\tis_store_specific_flat_rate_deposit_delayed_payment: 0,\n\t\t\tdo_not_ref: 0\n\t\t}\n\t}\n\n\tif (payment_number == 1)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase \"REFERENCE\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_reference_total_amount\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"GIFT_CERT\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_gc_total_amount\").val();\n\t\t\t\tpaymentData.cert_type = $(\"#payment1_gift_cert_type\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_gc_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFUND_CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_refund_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_refund_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_check_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_check_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CREDIT\":\n\t\t\t\tpaymentData.amount = $(\"#OEH_remaing_balance\").html();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CC\":\n\t\t\t\tpaymentData.amount = $(\"#payment1_cc_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment1_ccNumber\").val();\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment1_ccNameOnCard\").val();\n\t\t\t\tpaymentData.ccType = $(\"#payment1_ccType\").val();\n\t\t\t\tpaymentData.ccMonth = $(\"#payment1_ccMonth\").val();\n\t\t\t\tpaymentData.ccYear = $(\"#payment1_ccYear\").val();\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment1_cc_security_code\").val();\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_1\").val();\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_1\").val();\n\n\t\t\t\tvar DPSetting = $('input[name=payment1_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"GIFT_CARD\":\n\t\t\t\tpaymentData.amount = $(\"#debit_gift_card_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#debit_gift_card_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"DPADJUST\":\n\t\t\t\t// TODO: ???\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFERENCE_OTHER\":\n\t\t\t\talert('investigate REFERENCE_OTHER');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\n\t\t\t\t{\n\t\t\t\t\tpaymentData.amount = $(\"#payment1_ref_total_amount\").val();\n\t\t\t\t\tpaymentData.reference_id = $(\"#p1_ref_id\").html();\n\t\t\t\t}\n\n\t\t}\n\n\t\treturn paymentData;\n\n\t}\n\telse if (payment_number == 2)\n\t{\n\t\tswitch (type)\n\t\t{\n\t\t\tcase \"CASH\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_cash_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_cash_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CHECK\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_check_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_check_payment_number\").val();\n\t\t\t\tbreak;\n\n\t\t\tcase \"CC\":\n\t\t\t\tpaymentData.amount = $(\"#payment2_cc_total_amount\").val();\n\t\t\t\tpaymentData.number = $(\"#payment2_ccNumber\").val();\n\t\t\t\tpaymentData.ccNameOnCard = $(\"#payment2_ccNameOnCard\").val();\n\t\t\t\tpaymentData.ccType = $(\"#payment2_ccType\").val();\n\t\t\t\tpaymentData.ccMonth = $(\"#payment2_ccMonth\").val();\n\t\t\t\tpaymentData.ccYear = $(\"#payment2_ccYear\").val();\n\t\t\t\tpaymentData.cc_security_code = $(\"#payment2_cc_security_code\").val();\n\t\t\t\tpaymentData.billing_address = $(\"#billing_address_2\").val();\n\t\t\t\tpaymentData.billing_postal_code = $(\"#billing_postal_code_2\").val();\n\n\t\t\t\tvar DPSetting = $('input[name=payment2_is_store_specific_flat_rate_deposit_delayed_payment]:checked').val();\n\n\t\t\t\tpaymentData.is_store_specific_flat_rate_deposit_delayed_payment = DPSetting;\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"REFERENCE_OTHER\":\n\t\t\t\talert('investigate REFERENCE_OTHER');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (type.indexOf(\"REF_\") == 0)\n\t\t\t\t{\n\t\t\t\t\tpaymentData.amount = $(\"#payment2_ref_total_amount\").val();\n\t\t\t\t\tpaymentData.reference_id = $(\"#p2_ref_id\").html();\n\t\t\t\t}\n\n\t\t}\n\n\t\treturn paymentData;\n\t}\n\n}\n\nfunction validatePayment1(type)\n{\n\n\tvar inputArray = null;\n\tvar validates = true;\n\n\tif (type.substr(0, 4) == \"REF_\")\n\t{\n\t\ttype = \"REFERENCE_OTHER\";\n\t}\n\n\tswitch (type)\n\t{\n\t\tcase \"REFERENCE\":\n\t\t\tinputArray = $(\"#payment1_reference :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CERT\":\n\t\t\tinputArray = $(\"#payment1_gc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CASH\":\n\t\t\tinputArray = $(\"#payment1_cash :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"REFUND_CASH\":\n\t\t\tinputArray = $(\"#payment1_refund_cash :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tinputArray = $(\"#payment1_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CREDIT\":\n\t\t\tinputArray = $(\"#payment1_credit :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tinputArray = $(\"#payment1_cc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment1_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment1_cc_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment1_CC_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"GIFT_CARD\":\n\t\t\tinputArray = $(\"#payment1_debit_gift_card :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"DPADJUST\":\n\t\t\tinputArray = $(\"#dp_adjust_div :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tinputArray = $(\"#payment1_ref :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment1_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment1_ref_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment1_Ref_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t}\n\n\treturn validates;\n\n}\n\nfunction validatePayment2(type)\n{\n\n\tvar inputArray = null;\n\tvar validates = true;\n\n\tif (type.substr(0, 4) == \"REF_\")\n\t{\n\t\ttype = \"REFERENCE_OTHER\";\n\t}\n\n\tswitch (type)\n\t{\n\n\t\tcase \"CASH\":\n\t\t\tinputArray = $(\"#payment2_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CHECK\":\n\t\t\tinputArray = $(\"#payment2_check :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\t\t\tbreak;\n\n\t\tcase \"CC\":\n\t\t\tinputArray = $(\"#payment2_cc :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment1\").is(\":checked\") || $(\"#payment2_is_store_specific_flat_rate_deposit_delayed_payment2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment2_cc_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment2_CC_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"REFERENCE_OTHER\":\n\t\t\tinputArray = $(\"#payment2_ref :input\");\n\t\t\tvalidates = _check_elements(inputArray);\n\n\t\t\tvar depositWarningStr = \"The deposit must be less than the payment amount entered. Note that the amount entered should be for the full payment (both deposit and delayed payment). The deposit will be deducted automatically.\";\n\n\t\t\tif ($(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed1\").is(\":checked\") || $(\"#ref_payment2_is_store_specific_flat_rate_deposit_delayed2\").is(\":checked\"))\n\t\t\t{\n\t\t\t\tvar CC1Amount = $(\"#payment2_ref_total_amount\").val();\n\t\t\t\tif (CC1Amount * 1 <= store_specific_deposit * 1)\n\t\t\t\t{\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").html(depositWarningStr);\n\t\t\t\t\t$(\"#payment2_Ref_DP_note\").show();\n\t\t\t\t\tvalidates = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\t}\n\n\treturn validates;\n}\n\nfunction addPaymentAndActivate()\n{\n\n\tintenseLogging(\"addPaymentAndActivate() called\");\n\n\tvar servingsCount = Number($('#OEH_number_servings').html());\n\n\tif (servingsCount.valueOf() < 36 && !isDreamTaste && !isFundraiser && !$(\"#selectedBundle\").is(\":checked\"))\n\t{\n\n\t\tintenseLogging(\"addPaymentAndActivate() - warning for less than 36 servings\");\n\n\t\tdd_message({\n\t\t\ttitle: 'Warning',\n\t\t\tmessage: 'This order is for less than 36 servings. Do you wish to continue?',\n\t\t\tconfirm: function ()\n\t\t\t{\n\t\t\t\t// always first ensure that discounts are updated on server\n\t\t\t\tintenseLogging(\"addPaymentAndActivate() - confirm dialog\");\n\n\t\t\t\tvar message = \"You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?\";\n\t\t\t\tvar changesBlurb = getAbbreviatedSummaryString();\n\t\t\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Add Payment and Book Order',\n\t\t\t\t\tdiv_id: 'aPaBO',\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tmodal: true,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 460,\n\t\t\t\t\tconfirm: function ()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar discounts_are_valid = saveDiscounts(true);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n\telse\n\t{\n\n\t\tintenseLogging(\"addPaymentAndActivate() - confirm dialog\");\n\n\t\tif (hasBundle)\n\t\t{\n\t\t\tvar bundleIsSelected = false;\n\t\t\tif ($('#selectedBundle').is(':checked'))\n\t\t\t{\n\t\t\t\tbundleIsSelected = true;\n\t\t\t}\n\n\t\t\tif (bundleIsSelected)\n\t\t\t{\n\n\t\t\t\tvar numBundItems = countSelectedBundleItems();\n\t\t\t\tif (numBundItems < 18)\n\t\t\t\t{\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: 'Please select at least 18-servings of Meal Prep Starter Pack items.'\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse if (numBundItems > 18)\n\t\t\t\t{\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: 'Please select no more than 18 servings of Meal Prep Starter Pack items.'\n\t\t\t\t\t});\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (stationNeedsAttention)\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Please review the Side Station and ensure the correct number of items are selected.'\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\n\t\t// always first ensure that discounts are updated on server\n\t\tvar message = \"You are about to activate a Saved order. This will consume inventory and a session slot. Are you sure you want to continue?\";\n\t\tvar changesBlurb = getAbbreviatedSummaryString();\n\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\tdd_message({\n\t\t\ttitle: 'Add Payment and Book Order',\n\t\t\tmessage: message,\n\t\t\tmodal: true,\n\t\t\twidth: 400,\n\t\t\theight: 460,\n\t\t\tconfirm: function ()\n\t\t\t{\n\t\t\t\tvar discounts_are_valid = saveDiscounts(true);\n\t\t\t}\n\t\t});\n\n\t}\n\n\treturn true;\n}\n\nfunction save2PaymentsAndBookOrder(payment2Type, payment1Data, token)\n{\n\n\tintenseLogging(\"save2PaymentsAndBookOrder() called\");\n\n\tvar payment2Data = getPaymentData(payment2Type, 2);\n\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\n\t{\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'save_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tsession_id: session_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment1Data,\n\t\t\t\tadd_payment_data: payment2Data,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() save_payment successful\");\n\n\t\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\telse if (payment2Type == \"CC\")\n\t{\n\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_2\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\n\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 2, json.warnOfOutstandingSavedOrdersOnFullSession, false, false, payment1Data);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"save2PaymentsAndBookOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction savePayment2(payment2Type, warnOfOutstandingSavedOrdersOnFullSession, token)\n{\n\n\tintenseLogging(\"savePayment2() called\");\n\n\tvar payment2Data = getPaymentData(payment2Type, 2);\n\n\tif (payment2Type != \"CC\" || !supports_transparent_redirect)\n\t{\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment2_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment2_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'add_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment2Data,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"savePayment2() add_payment successful\");\n\n\t\t\t\t\tif (warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"savePayment2 add_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\telse if (payment2Type == \"CC\")\n\t{\n\n\t\tvar billing_name = $(\"#payment2_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_2\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_2\").val();\n\n\t\tvar amt = $(\"#payment2_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"savePayment2() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 2, warnOfOutstandingSavedOrdersOnFullSession, false, false);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"savePayment2 get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction handleDirectPayment(addOnly, go_to_confirm, token)\n{\n\n\tintenseLogging(\"handleDirectPayment() called\");\n\n\tvar payment1Type = $(\"#payment1_type\").val();\n\tvar payment2Type = false;\n\n\tif (payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD')\n\t{\n\t\tpayment2Type = $(\"#payment2_type\").val();\n\t}\n\n\t// validation\n\tif (!validatePayment1(payment1Type))\n\t{\n\t\treturn false;\n\t}\n\n\t// validation\n\tif (payment2Type && payment2Type != \"\" && !validatePayment2(payment2Type))\n\t{\n\t\treturn false;\n\t}\n\n\tdisplayModalWaitDialog('paying_div', \"Sending Payment. Please wait ...\");\n\n\tvar payment1Data = getPaymentData(payment1Type, 1);\n\n\t// Handle Payment 1 for certain\n\t// Then handle Payment 2 unless it's a CC payment.\n\n\tvar DP_State = 0;\n\tif ($('#ref_payment1_is_store_specific_flat_rate_deposit_delayed0').length)\n\t{\n\t\tDP_State = $('input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\tif (DP_State == 1)\n\t\t{\n\t\t\tDP_State = 4;\n\t\t} // translate to CPayment constants - for now\n\t\tif (DP_State == 2)\n\t\t{\n\t\t\tDP_State = 5;\n\t\t}\n\n\t\tif (DP_State > 0)\n\t\t{\n\t\t\t// TODO: validate amounts\n\t\t}\n\t}\n\n\tvar use_store_credits = false;\n\tvar store_credit_amount = 0;\n\tif ($(\"#use_store_credits\").length)\n\t{\n\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t{\n\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\tuse_store_credits = true;\n\t\t}\n\t}\n\n\tvar mainPaymentData = null;\n\tvar additionalPaymentData = null;\n\n\tif (payment2Type)\n\t{\n\t\tmainPaymentData = getPaymentData(payment2Type, 2);\n\t\tadditionalPaymentData = payment1Data;\n\t}\n\telse\n\t{\n\t\tmainPaymentData = payment1Data;\n\t}\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 90000,\n\t\tasync: true,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: store_id,\n\t\t\top: 'save_payment',\n\t\t\torder_id: order_id,\n\t\t\tuser_id: user_id,\n\t\t\tpayment_data: mainPaymentData,\n\t\t\tadd_payment_data: additionalPaymentData,\n\t\t\tdelay_remainder: DP_State,\n\t\t\tuse_store_credits: use_store_credits,\n\t\t\tstore_credits_amount: store_credit_amount,\n\t\t\tdd_csrf_token: token,\n\t\t\tpayment2Type: payment2Type\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tintenseLogging(\"handleDirectPayment() save_payment successful\");\n\n\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t{\n\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\tif (strError == 'timeout')\n\t\t\t{\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Order Processing Timed Out',\n\t\t\t\t\tmessage: \"The request to finalized the order has timed out. This may be due to network congestion. The order may have been successful. The page will refresh and show the actual current status.\",\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t'Refresh': function ()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\tbounce(window.location.href);\n\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t$(\"#paying_div\").remove();\n\n\t\t\tintenseLogging(\"handleDirectPayment save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\t\t}\n\t\t}\n\t});\n}\n\nfunction onAddPaymentAndActivate(addOnly, go_to_confirm, token)\n{\n\n\tintenseLogging(\"onAddPaymentAndActivate() called\");\n\n\tif (!supports_transparent_redirect)\n\t{\n\t\treturn handleDirectPayment(addOnly, go_to_confirm, token);\n\t}\n\n\tvar payment1Type = $(\"#payment1_type\").val();\n\tvar payment2Type = false;\n\n\tif (payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD')\n\t{\n\t\tpayment2Type = $(\"#payment2_type\").val();\n\t}\n\n\t// validation\n\tif (!validatePayment1(payment1Type))\n\t{\n\t\treturn false;\n\t}\n\n\t// validation\n\tif (payment2Type && payment2Type != \"\" && !validatePayment2(payment2Type))\n\t{\n\t\treturn false;\n\t}\n\n\tdisplayModalWaitDialog('paying_div', \"Sending Payment. Please wait ...\");\n\n\tvar payment1Data = getPaymentData(payment1Type, 1);\n\n\tif (payment2Type && payment2Type != \"\")\n\t{\n\t\tsave2PaymentsAndBookOrder(payment2Type, payment1Data, token);\n\t\treturn;\n\t}\n\n\tif (payment1Type != \"\" && payment1Type != \"CC\")\n\t{\n\t\t// Handle Payment 1 for certain\n\t\t// Then handle Payment 2 unless it's a CC payment.\n\n\t\tvar DP_State = 0;\n\t\tif ($('#ref_payment1_is_store_specific_flat_rate_deposit_delayed0').length)\n\t\t{\n\t\t\tDP_State = $('input:radio[name=ref_payment1_is_store_specific_flat_rate_deposit_delayed]:checked').val();\n\n\t\t\tif (DP_State == 1)\n\t\t\t{\n\t\t\t\tDP_State = 4;\n\t\t\t} // translate to CPayment constants - for now\n\t\t\tif (DP_State == 2)\n\t\t\t{\n\t\t\t\tDP_State = 5;\n\t\t\t}\n\n\t\t\tif (DP_State > 0)\n\t\t\t{\n\t\t\t\t// TODO: validate amounts\n\t\t\t}\n\t\t}\n\n\t\tvar use_store_credits = false;\n\t\tvar store_credit_amount = 0;\n\t\tif ($(\"#use_store_credits\").length)\n\t\t{\n\t\t\tif ($(\"#use_store_credits\").is(':checked'))\n\t\t\t{\n\t\t\t\tstore_credit_amount = $(\"#store_credits_amount\").val();\n\t\t\t\tuse_store_credits = true;\n\t\t\t}\n\t\t}\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'save_payment',\n\t\t\t\torder_id: order_id,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tpayment_data: payment1Data,\n\t\t\t\tdelay_remainder: DP_State,\n\t\t\t\tuse_store_credits: use_store_credits,\n\t\t\t\tstore_credits_amount: store_credit_amount,\n\t\t\t\tdd_csrf_token: token\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate() save_payment successful\");\n\n\t\t\t\t\tif (json.warnOfOutstandingSavedOrdersOnFullSession)\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id + '&full_session=true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbounce(\"/?page=admin_order_mgr_thankyou&order=\" + json.order_id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate save_payment: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"onAddPaymentAndActivate save_payment: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t}\n\telse if (payment1Type != \"\" && payment1Type == \"CC\")\n\t{\n\t\t/*\n\n\t\t '#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t ' #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2, ' +\n\t\t ' #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t ' #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2'\n\t\t */\n\n\t\tvar billing_name = $(\"#payment1_ccNameOnCard\").val();\n\t\tvar billing_address = $(\"#billing_address_1\").val();\n\t\tvar billing_zip = $(\"#billing_postal_code_1\").val();\n\t\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t\t$.ajax({\n\t\t\turl: 'ddproc.php',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tasync: true,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\t\top: 'get_token',\n\t\t\t\torder_id: order_id,\n\t\t\t\tamount: amt,\n\t\t\t\tuser_id: user_id,\n\t\t\t\tbilling_name: billing_name,\n\t\t\t\tbilling_address: billing_address,\n\t\t\t\tbilling_zip: billing_zip,\n\t\t\t\tdd_csrf_token: token,\n\t\t\t\tchain_token: true\n\t\t\t},\n\t\t\tsuccess: function (json)\n\t\t\t{\n\t\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate() get_token successful\");\n\n\t\t\t\t\tvar token = json.token;\n\n\t\t\t\t\tsend(token, 1, false, addOnly, go_to_confirm, false);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\t\tintenseLogging(\"onAddPaymentAndActivate get_token: \" + json.processor_message);\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError)\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"onAddPaymentAndActivate get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: response\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t});\n\t}\n}\n\nfunction RetrieveCalendar(timestamp)\n{\n\n\tintenseLogging(\"RetrieveCalendar() called\");\n\n\tvar op = 'retrieve';\n\tif (orderState != 'NEW')\n\t{\n\t\top = 'retrieve_for_reschedule';\n\t}\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'GET',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_calendarProcessor',\n\t\t\tstore_id: store_id,\n\t\t\taction: op,\n\t\t\tcur_session_id: session_id,\n\t\t\ttimestamp: timestamp\n\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"RetrieveCalendar() successful\");\n\n\t\t\t\t$(\"#calendar_holder\").html(json.data);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"RetrieveCalendar: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\tintenseLogging(\"RetrieveCalendar: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction onDayClick(obj)\n{\n}\n\nfunction doReschedule(id, sessionTime)\n{\n\tvar curSessionDate = $(\"#curSessionDate\").html();\n\n\tdd_message({\n\t\ttitle: 'Reschedule',\n\t\tmessage: '<div style=\"text-align: center;\"><div>From</div><div style=\"font-weight: bold;\">' + curSessionDate + '</div><div>to</div><div style=\"font-weight: bold;\">' + sessionTime + '</div>',\n\t\tmodal: true,\n\t\tconfirm: function ()\n\t\t{\n\n\t\t\tvar org_session_id = session_id;\n\t\t\tsession_id = id;\n\t\t\tReschedule(org_session_id);\n\n\t\t},\n\t\topen: function ()\n\t\t{\n\n\t\t\t$(this).siblings('.ui-dialog-buttonpane').find(\"button:contains('Confirm')\").focus();\n\t\t}\n\n\t});\n\n}\n\nfunction onRescheduleClick(id, sessionTime, isDiscounted, control_message)\n{\n\tif (orderState != 'NEW')\n\t{\n\t\tif (control_message == \"locked\")\n\t\t{\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"You cannot reschedule to this session as it is in the previous calendar month and all activity for that month has been locked and finalized.\"\n\t\t\t});\n\n\n\t\t}\n\t\telse if (control_message == \"tononpreasm\")\n\t\t{\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"This session is a standard customer assembly session; your order is for Made for You items. Are you sure you want to select a Standard session? The service fee will be removed.\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"tononpreasm_div\",\n\t\t\t\tconfirm: function ()\n\t\t\t\t{\n\t\t\t\t\tdoReschedule(id, sessionTime);\n\t\t\t\t\t$(\"#tononpreasm_div\").remove();\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t}\n\t\telse if (control_message == \"topreasm\")\n\t\t{\n\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Reschedule',\n\t\t\t\tmessage: \"This session is a Made for You session; your order is for standard customer assembly items. Are you sure you want to select a Special Event session? A service fee will be applied.\",\n\t\t\t\tmodal: true,\n\t\t\t\tdiv_id: \"topreasm_div\",\n\t\t\t\tconfirm: function ()\n\t\t\t\t{\n\t\t\t\t\tdoReschedule(id, sessionTime);\n\t\t\t\t\t$(\"#topreasm_div\").remove();\n\t\t\t\t}\n\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdoReschedule(id, sessionTime);\n\t\t}\n\t}\n}\n\nfunction onSessionClick(id, sessionTime, isDiscounted)\n{\n\tif (orderState == 'NEW')\n\t{\n\t\tsetSessionAndSave(id);\n\t}\n}\n\nfunction monthChange(monthVal)\n{\n\tRetrieveCalendar(monthVal);\n}\n\nfunction handle_delayed_payment()\n{\n\tif (tc_delayed_payment_agree)\n\t{\n\t\treturn;\n\t}\n\n\t$('#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t' #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2, ' +\n\t' #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t' #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2').on('click', function (e)\n\t{\n\n\t\tdd_message({\n\t\t\ttitle: lang.en.tc.terms_and_conditions,\n\t\t\tmessage: lang.en.tc.delayed_payment,\n\t\t\tmodal: true,\n\t\t\tnoOk: true,\n\t\t\tcloseOnEscape: false,\n\t\t\topen: function (event, ui)\n\t\t\t{\n\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t},\n\t\t\tbuttons: {\n\t\t\t\t'Agree': function ()\n\t\t\t\t{\n\n\t\t\t\t\t$(this).remove();\n\n\t\t\t\t\t$('#payment1_is_store_specific_flat_rate_deposit_delayed_payment1, #payment1_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t\t\t\t' #ref_payment1_is_store_specific_flat_rate_deposit_delayed1, #ref_payment1_is_store_specific_flat_rate_deposit_delayed2, ' +\n\t\t\t\t\t' #payment2_is_store_specific_flat_rate_deposit_delayed_payment1, #payment2_is_store_specific_flat_rate_deposit_delayed_payment2, ' +\n\t\t\t\t\t' #ref_payment2_is_store_specific_flat_rate_deposit_delayed1, #ref_payment2_is_store_specific_flat_rate_deposit_delayed2').off('click');\n\n\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 1, user_id);\n\n\t\t\t\t},\n\t\t\t\t'Decline': function ()\n\t\t\t\t{\n\n\t\t\t\t\t$('#payment1_is_store_specific_flat_rate_deposit_delayed_payment0, #payment2_is_store_specific_flat_rate_deposit_delayed_payment0, ' +\n\t\t\t\t\t'#ref_payment1_is_store_specific_flat_rate_deposit_delayed0, #ref_payment2_is_store_specific_flat_rate_deposit_delayed0').trigger('click');\n\n\t\t\t\t\tdd_message({\n\t\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\n\t\t\t\t\t\tmessage: lang.en.tc.delayed_payment_decline\n\t\t\t\t\t});\n\n\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 0, user_id);\n\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t});\n}\n\nfunction createBonusCredit(creditConsumed)\n{\n\tisFactoringCredit = true;\n\tcurrentCreditAvailable = creditBasis * 0.10;\n\n\tif (creditConsumed > currentCreditAvailable)\n\t{\n\t\tcreditConsumed = currentCreditAvailable;\n\t\tcurrentCreditAvailable = 0;\n\t}\n\telse\n\t{\n\t\tcurrentCreditAvailable -= creditConsumed;\n\n\t}\n\n\t$('#couponValue').val(creditConsumed);\n\t$(\"#OEH_bonus_credit\").html(\" ( Bonus Credit: \" + formatAsMoney(currentCreditAvailable) + \" )\");\n}\n\nfunction removeBonusCredit()\n{\n\tisFactoringCredit = false;\n\t$(\"#OEH_bonus_credit\").html(\"\");\n}\n\nfunction handleSummaryDisplayChange(obj)\n{\n\tif (obj.checked)\n\t{\n\t\tShowAllLineItems();\n\t}\n\telse\n\t{\n\t\tHideLineItemsIfZero();\n\t}\n}\n\nfunction HideLineItemsIfZero()\n{\n\tvar serviceFeeOrg = Number($('#OEH_subtotal_service_fee_org').html());\n\tvar serviceFee = Number($('#OEH_subtotal_service_fee').html());\n\n\tif (serviceFeeOrg == 0 && serviceFee == 0)\n\t{\n\t\t$('#ServiceFeeRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#ServiceFeeRow').show();\n\t}\n\n\tvar serviceTaxOrg = Number($('#OEH_service_tax_subtotal_org').html());\n\tvar serviceTax = Number($('#OEH_service_tax_subtotal').html());\n\n\tif (serviceTaxOrg == 0 && serviceTax == 0)\n\t{\n\t\t$('#ServiceTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#ServiceTaxRow').show();\n\t}\n\n\tvar miscFoodOrg = Number($('#OEH_misc_food_subtotal_org').html());\n\tvar miscFood = Number($('#OEH_misc_food_subtotal').html());\n\n\tif (miscFoodOrg == 0 && miscFood == 0)\n\t{\n\t\t$('#miscFoodRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#miscFoodRow').show();\n\t}\n\n\tvar miscNonFoodOrg = Number($('#OEH_misc_nonfood_subtotal_org').html());\n\tvar miscNonFood = Number($('#OEH_misc_nonfood_subtotal').html());\n\n\tif (miscNonFoodOrg == 0 && miscNonFood == 0)\n\t{\n\t\t$('#miscNonFoodRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#miscNonFoodRow').show();\n\t}\n\n\tvar doDiscountOrg = Number($('#OEH_direct_order_discount_org').html());\n\tvar doDiscount = Number($('#OEH_direct_order_discount').html());\n\n\tif (doDiscountOrg == 0 && doDiscount == 0)\n\t{\n\t\t$('#directDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#directDiscountRow').show();\n\t}\n\n\tvar couponDiscountOrg = Number($('#OEH_coupon_discount_org').html());\n\tvar couponDiscount = Number($('#OEH_coupon_discount').html());\n\n\tif (couponDiscountOrg == 0 && couponDiscount == 0)\n\t{\n\t\t$('#couponDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#couponDiscountRow').show();\n\t}\n\n\tvar platePointsDiscountOrg = Number($('#OEH_plate_points_discount_org_food').html());\n\tvar platePointsDiscount = Number($('#OEH_plate_points_order_discount_food').html());\n\n\tif (platePointsDiscountOrg == 0 && platePointsDiscount == 0)\n\t{\n\t\t$('#platePointsDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#platePointsDiscountRow').show();\n\t}\n\n\tvar platePointsDiscountOrg = Number($('#OEH_plate_points_discount_org_fee').html());\n\tvar platePointsDiscount = Number($('#OEH_plate_points_order_discount_fee').html());\n\n\tif (platePointsDiscountOrg == 0 && platePointsDiscount == 0)\n\t{\n\t\t$('#platePointsFeeDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#platePointsFeeDiscountRow').show();\n\t}\n\n\tvar sessionDiscountOrg = Number($('#OEH_session_discount').html());\n\n\tif (sessionDiscountOrg == 0)\n\t{\n\t\t$('#sessionDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#sessionDiscountRow').show();\n\t}\n\n\tvar pudDiscount = Number($('#OEH_preferred').html());\n\n\tif (pudDiscount == 0)\n\t{\n\t\t$('#preferredUserDiscountRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#preferredUserDiscountRow').show();\n\t}\n\n\tvar foodTaxOrg = Number($('#OEH_food_tax_subtotal_org').html());\n\tvar foodTax = Number($('#OEH_food_tax_subtotal').html());\n\n\tif (foodTaxOrg == 0 && foodTax == 0)\n\t{\n\t\t$('#foodTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#foodTaxRow').show();\n\t}\n\n\tvar nonFoodTaxOrg = Number($('#OEH_tax_subtotal_org').html());\n\tvar nonFoodTax = Number($('#OEH_tax_subtotal').html());\n\n\tif (nonFoodTaxOrg == 0 && nonFoodTax == 0)\n\t{\n\t\t$('#nonFoodTaxRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#nonFoodTaxRow').show();\n\t}\n\n\tvar productsSubtotalOrg = Number($('#OEH_products_subtotal_org').html());\n\tvar productsSubtotal = Number($('#OEH_products_subtotal').html());\n\n\tif (productsSubtotalOrg == 0 && productsSubtotal == 0)\n\t{\n\t\t$('#productSubtotalRow').hide();\n\t}\n\telse\n\t{\n\t\t$('#productSubtotalRow').show();\n\t}\n}\n\nfunction ShowAllLineItems()\n{\n\t$('#ServiceFeeRow').show();\n\t$('#ServiceTaxRow').show();\n\t$('#miscFoodRow').show();\n\t$('#miscNonFoodRow').show();\n\t$('#directDiscountRow').show();\n\t$('#couponDiscountRow').show();\n\t$('#foodTaxRow').show();\n\t$('#nonFoodTaxRow').show();\n\t$('#productSubtotalRow').show();\n\t$('#platePointsDiscountRow').show();\n\t$('#preferredUserDiscountRow').show();\n\t$('#sessionDiscountRow').show();\n}\n\nfunction sort_by_price(a, b)\n{\n\tif (a.price == b.price)\n\t{\n\t\treturn 0;\n\t}\n\n\treturn (a.price < b.price) ? 1 : -1;\n}\n\nfunction getPlatePointsDiscountableAmount(items, total)\n{\n\tretVal = 0;\n\n\tvar nonDiscountableAmount = 0;\n\tvar servingsCount = 0;\n\n\tif (items.length > 0)\n\t{\n\t\titems.sort(sort_by_price);\n\n\t\tfor (var i = 0; i < items.length; i++)\n\t\t{\n\n\t\t\tvar thisItem = items[i];\n\n\t\t\tvar servingThisItem = thisItem.qty * thisItem.serving_size;\n\t\t\tvar costThisItem = thisItem.qty * thisItem.price;\n\t\t\tservingsCount += servingThisItem;\n\n\t\t\tif (servingsCount == 36)\n\t\t\t{\n\t\t\t\tnonDiscountableAmount += costThisItem;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse if (servingsCount > 36)\n\t\t\t{\n\t\t\t\tvar orgAmount = servingsCount - servingThisItem;\n\t\t\t\tvar remainingServings = 36 - orgAmount;\n\t\t\t\tvar remainingItems = remainingServings / thisItem.serving_size;\n\t\t\t\tnonDiscountableAmount += (remainingItems * thisItem.price);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnonDiscountableAmount += costThisItem;\n\t\t\t}\n\t\t}\n\n\t\tretVal = total - nonDiscountableAmount;\n\n\t}\n\n\tif (servingsCount < 36)\n\t{\n\t\treturn 0;\n\t}\n\n\tvar serviceFee = Number(document.getElementById('subtotal_service_fee').value);\n\tretVal += serviceFee.valueOf();\n\n\tvar miscFoodSubtotal = Number(document.getElementById('misc_food_subtotal').value);\n\tretVal += miscFoodSubtotal.valueOf();\n\n\treturn retVal;\n}\n\nfunction drawChangeList()\n{\n\tvar html = getChangeListHTML();\n\t$(\"#changelist\").html(html);\n\n}\n\nfunction getChangeListHTML()\n{\n\n\tvar htmlStr = \"\";\n\tvar first = true;\n\tfor (var item in changeList.stdMenuItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Standard Items List</h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.stdMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tvar title = $(\"#qty_\" + item).data(\"item_title\");\n\t\t\tvar pricing_type = \"(\" + $(\"#qty_\" + item).data(\"servings\") + \" Serving)\";\n\n\t\t\tif (changeList.stdMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.stdMenuItems[item] + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.stdMenuItems[item] * -1 + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.FTMenuItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Sides List</h3><ul style='margin: 4px;'>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.FTMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tvar title = $(\"#qty_\" + item).data(\"item_title\");\n\n\t\t\tif (changeList.FTMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.FTMenuItems[item] + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.FTMenuItems[item] * -1 + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tvar hadMiscCostChanges = false;\n\tfor (var item in changeList.miscCosts)\n\t{\n\t\thadMiscCostChanges = true;\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.miscDescs)\n\t{\n\t\tif (!hadMiscCostChanges && first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Misc Costs</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\n\t\t{\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\n\t\t}\n\t}\n\n\tif (changeList.order_type != \"\")\n\t{\n\t\thtmlStr += \"<h3>Order changed \" + changeList.order_type + \"</h3>\";\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.bundleItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\tif (isDreamTaste)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Meal Prep Workshop Items List</h3><ul style='margin: 4px;'>\";\n\n\t\t\t}\n\t\t\telse if (isFundraiser)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Fundraiser Event Items List</h3><ul style='margin: 4px;'>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Intro Items List</h3><ul style='margin: 4px;'>\";\n\t\t\t}\n\t\t\tfirst = false;\n\t\t}\n\n\t\thtmlStr += \"<li>\";\n\n\t\tif (changeList.bundleItems.hasOwnProperty(item))\n\t\t{\n\n\t\t\tvar title = $(\"#bnd_\" + item).data(\"item_title\");\n\t\t\tvar pricing_type = \"(\" + $(\"#bnd_\" + item).data(\"servings\") + \" Serving)\";\n\n\t\t\tif (changeList.bundleItems[item] > 0)\n\t\t\t{\n\t\t\t\thtmlStr += \"Added \" + changeList.bundleItems[item] + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"Removed \" + changeList.bundleItems[item] * -1 + \" \" + pricing_type + \" <i>\" + title + \"</i>\";\n\t\t\t}\n\n\t\t}\n\n\t\thtmlStr += \"</li>\";\n\n\t}\n\n\tif (!first)\n\t{\n\t\thtmlStr += \"</ul>\";\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.discounts)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.discounts.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.reporting)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Reporting</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.reporting.hasOwnProperty(item))\n\t\t{\n\t\t\tif (item == 'fundraiser')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse if (changeList.reporting[item][\"orgVal\"] > 0 && changeList.reporting[item][\"orgVal\"] != changeList.reporting[item][\"newVal\"])\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Changed \" + getHumanReadableName(item) + \" to \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" \" + changeList.reporting[item][\"title\"] + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (item == 'fundraiser_value')\n\t\t\t{\n\t\t\t\tif (changeList.reporting[item][\"diff\"] > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.reporting[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.reporting[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (changeList.coupon)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.coupon.change_type = 'added')\n\t\t{\n\t\t\thtmlStr += \"Added coupon code: \" + \"<br />\";\n\t\t}\n\t\telse if (changeList.coupon.change_type = 'removed')\n\t\t{\n\t\t\thtmlStr += \"Removed coupon code: \" + \"<br />\";\n\t\t}\n\t\telse if (changeList.coupon.change_type = 'added')\n\t\t{\n\t\t\thtmlStr += \"Change coupon code to: \" + \"<br />\";\n\t\t}\n\t}\n\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\n\t{\n\t\thtmlStr += \"<h3>Payments</h3>\";\n\n\t\tvar payment1Type = $('#payment1_type').val();\n\n\t\tif (payment1Type != '')\n\t\t{\n\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').is(\":visible\");\n\t\t\t{\n\t\t\t\tif ($(\"#credit_to_customer_refund_cash_amount\").val() > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding Cash to customer.<br />\";\n\t\t\t\t}\n\n\t\t\t\tvar ccRefundTotal = 0;\n\t\t\t\t$(\"[id^='Cr_RT_'\").each(function() {\n\t\t\t\t\tccRefundTotal += parseFloat($(this).val());\n\t\t\t\t});\n\n\t\t\t\tif (ccRefundTotal > 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Refunding to customer credit card(s).<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment2_type').val() != \"\")\n\t\t{\n\t\t\tvar payment2Type = $('#payment2_type').val();\n\t\t\tif (payment2Type && payment2Type != \"\")\n\t\t\t{\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\n\t\t\t}\n\t\t}\n\n\t\tif ($('#use_store_credit').is(':checked'))\n\t\t{\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\n\t\t}\n\t}\n\treturn htmlStr;\n}\n\nfunction getHumanReadableName(id)\n{\n\tswitch (id)\n\t{\n\t\tcase 'direct_order_discount':\n\t\t\treturn \"Direct Order Discount\";\n\t\tcase 'plate_points_discount':\n\t\t\treturn \"Dinner Dollars\";\n\t\tcase \"misc_food_subtotal\":\n\t\t\treturn \"Miscellaneous Food Cost\";\n\t\tcase \"misc_nonfood_subtotal\":\n\t\t\treturn \"Miscellaneous Non-food Cost\";\n\t\tcase \"subtotal_service_fee\":\n\t\t\treturn \"Service Fee\";\n\t\tcase 'misc_food_subtotal_desc':\n\t\t\treturn 'Misc Food Description';\n\t\tcase 'misc_nonfood_subtotal_desc':\n\t\t\treturn 'Misc Non-food Description';\n\t\tcase 'service_fee_description':\n\t\t\treturn 'Service Fee Description';\n\t\tcase 'session_discount':\n\t\t\treturn 'Session Discount';\n\t\tdefault:\n\t\t\treturn 'error';\n\t}\n}\n\nfunction getAbbreviatedSummaryString()\n{\n\tvar htmlStr = \"\";\n\n\tvar bundleChecked = $('#selectedBundle').is(':checked');\n\n\tif (isDreamTaste)\n\t{\n\t\thtmlStr += \"<h3>Meal Prep Workshop Order</h3>\";\n\t}\n\telse if (bundleChecked)\n\t{\n\t\thtmlStr += \"<h3>Starter Pack Order</h3>\";\n\t}\n\telse\n\t{\n\t\thtmlStr += \"<h3>Standard Order</h3>\";\n\t}\n\n\tvar stdItemCount = 0;\n\tvar FTItemCount = 0;\n\t// Items\n\t$(\"[id^='qty_']\").each(function ()\n\t{\n\t\tif ($(this).val() > 0)\n\t\t{\n\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t{\n\t\t\t\tFTItemCount += ($(this).val() * 1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstdItemCount += ($(this).val() * 1);\n\t\t\t}\n\t\t}\n\t});\n\n\tif (stdItemCount > 0)\n\t{\n\t\thtmlStr += stdItemCount + \" Standard Items Selected.<br />\"\n\t}\n\tif (FTItemCount > 0)\n\t{\n\t\thtmlStr += FTItemCount + \" Sides &amp; Sweets Items Selected.<br />\"\n\t}\n\n\t$(\"[data-dd_type='item_field']\").each(function ()\n\t{\n\t\tvar curVal = $(this).val();\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\n\t\t\tif (curVal > 0)\n\t\t\t{\n\t\t\t\thtmlStr += getHumanReadableName(this.id) + \" costs of $\" + formatAsMoney(curVal);\n\n\t\t\t\tvar descIDStr = \"\";\n\n\t\t\t\tswitch (this.id)\n\t\t\t\t{\n\t\t\t\t\tcase \"misc_food_subtotal\":\n\t\t\t\t\t\tdescIDStr = \"misc_food_subtotal_desc\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"misc_nonfood_subtotal\":\n\t\t\t\t\t\tdescIDStr = \"misc_nonfood_subtotal_desc\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"subtotal_service_fee\":\n\t\t\t\t\t\tdescIDStr = \"service_fee_description\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar desc = $(\"#\" + descIDStr).val();\n\n\t\t\t\tif (desc)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \". <span>( \" + desc + \" )</span><br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \".<br />\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tvar bundleChecked = $('#selectedBundle').is(':checked');\n\tvar bundleOrgVal = $('#selectedBundle').data('org_value');\n\n\tvar bundleItems = 0;\n\t$(\"[id^='bnd_']\").each(function ()\n\t{\n\n\t\tif ($(this).is(\":checked\"))\n\t\t{\n\t\t\tbundleItems++;\n\t\t}\n\t});\n\n\tif (bundleItems > 0)\n\t{\n\t\thtmlStr += bundleItems + \" Intro Items Selected.<br />\"\n\t}\n\n\tif (isDreamTaste)\n\t{\n\t\tvar bundleItems = 0;\n\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() > 0)\n\t\t\t{\n\t\t\t\tbundleItems += ($(this).val() * 1);\n\t\t\t}\n\t\t});\n\n\t\tif (bundleItems > 0)\n\t\t{\n\t\t\thtmlStr += bundleItems + \" Items Selected.<br />\"\n\t\t}\n\t}\n\n\t// Discounts\n\n\tvar discountsHTML = \"\";\n\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function ()\n\t{\n\n\t\tvar curVal = $(this).val();\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (curVal.valueOf() > 0)\n\t\t{\n\t\t\tdiscountsHTML += getHumanReadableName(this.id) + \" applied.<br />\";\n\t\t}\n\t});\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\n\t\tvar newSDValue = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\n\t\tif (newSDValue && newSDValue != \"noSD\")\n\t\t{\n\t\t\tdiscountsHTML += \"Session discount is applied.<br />\";\n\t\t}\n\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tvar newPUDValue = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\n\t\tif (newPUDValue && newPUDValue != \"noUP\")\n\t\t{\n\t\t\tdiscountsHTML += \"Preferred User Discount is applied.<br />\";\n\t\t}\n\t}\n\n\tif (discountsHTML != \"\")\n\t{\n\t\thtmlStr += \"<h3>Discounts</h3>\" + discountsHTML;\n\t}\n\n\tif (paymentChanges || $('#use_store_credit').is(':checked'))\n\t{\n\t\thtmlStr += \"<h3>Payments</h3>\";\n\n\t\tvar payment1Type = $('#payment1_type').val();\n\t\thtmlStr += \"Payment of type \" + payment1Type + \" selected.<br />\";\n\n\t\tif ((payment1Type == 'GIFT_CERT' || payment1Type == 'GIFT_CARD') && $('#payment1_type').val() != \"\")\n\t\t{\n\t\t\tvar payment2Type = $('#payment2_type').val();\n\t\t\tif (payment2Type && payment2Type != \"\")\n\t\t\t{\n\t\t\t\thtmlStr += \"Payment of type \" + payment2Type + \" selected.<br />\";\n\t\t\t}\n\t\t}\n\n\t\tif ($('#use_store_credit').is(':checked'))\n\t\t{\n\t\t\thtmlStr += \"Store Credit selected for payment.<br />\";\n\t\t}\n\n\t}\n\n\treturn htmlStr;\n}\n\nfunction updateChangeList()\n{\n\n\titemChanges = false;\n\tdiscountChanges = false;\n\n\tdiscountOrPaymentChanges = false;\n\tvar showSaveButton = false;\n\n\tchangeList = {};\n\tchangeList.stdMenuItems = {};\n\tchangeList.FTMenuItems = {};\n\tchangeList.miscCosts = {};\n\tchangeList.miscDescs = {};\n\tchangeList.bundleItems = {};\n\tchangeList.order_type = \"\";\n\tchangeList.discounts = {};\n\n\t// Items\n\t$(\"[id^='qty_']\").each(function ()\n\t{\n\t\tif ($(this).val() != $(this).data('org_value'))\n\t\t{\n\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t{\n\t\t\t\tchangeList.FTMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.stdMenuItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t}\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\t// Misc Costs\n\t$(\"[data-dd_type='item_field']\").each(function ()\n\t{\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\t\t\t$(this).addClass('unsaved_data');\n\n\t\t\tif ($(this).data(\"number\") == true)\n\t\t\t{\n\t\t\t\t// we're not tracking description fields for now\n\t\t\t\tchangeList.miscCosts[this.id] = {\n\t\t\t\t\tnewVal: $(this).val(),\n\t\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t\t};\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.miscDescs[this.id] = 1;\n\t\t\t}\n\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\tvar bundleChecked = $('#selectedBundle').is(':checked');\n\tvar bundleOrgVal = $('#selectedBundle').data('org_value');\n\n\tif (bundleChecked)\n\t{\n\t\tif (bundleOrgVal == \"0\")\n\t\t{\n\t\t\t$('#bundle_header_div').addClass('unsaved_data_cb');\n\t\t\tchangeList.order_type = \"to Intro\";\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#bundle_header_div').removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\telse\n\t{\n\t\tif (bundleOrgVal == \"1\")\n\t\t{\n\t\t\t$('#bundle_header_div').addClass('unsaved_data_cb');\n\t\t\tchangeList.order_type = \"to Standard\";\n\t\t\titemChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#bundle_header_div').removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\n\tif (isDreamTaste)\n\t{\n\n\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).val() != $(this).data('org_value'))\n\t\t\t{\n\t\t\t\tif ($(this).data('dd_type') == 'cts')\n\t\t\t\t{\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = $(this).val() - $(this).data('org_value');\n\t\t\t\t}\n\n\t\t\t\t$(this).addClass('unsaved_data');\n\t\t\t\titemChanges = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(this).removeClass('unsaved_data');\n\t\t\t}\n\t\t});\n\n\t}\n\telse\n\t{\n\n\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t{\n\n\t\t\tif ($(this).is(\":checked\"))\n\t\t\t{\n\t\t\t\tif ($(this).data('org_value') == \"0\")\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().addClass('unsaved_data_cb');\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = 1;\n\t\t\t\t\titemChanges = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().removeClass('unsaved_data_cb');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ($(this).data('org_value') == \"1\")\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().addClass('unsaved_data_cb');\n\t\t\t\t\tchangeList.bundleItems[this.id.split(\"_\")[1]] = -1;\n\t\t\t\t\titemChanges = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(this).parent().removeClass('unsaved_data_cb');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tif (itemChanges)\n\t{\n\t\t$(\"#items_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#items_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\t// Discounts\n\n\t$(\"#plate_points_discount, #direct_order_discount\").each(function ()\n\t{\n\n\t\tvar curVal = $(this).val();\n\t\tvar orgVal = $(this).data('org_value');\n\n\t\tif ($(this).data(\"number\") == true)\n\t\t{\n\t\t\t// reduce to similar formatting for numeric vs textual equivalency\n\t\t\tcurVal = parseFloat(curVal);\n\t\t\torgVal = parseFloat(orgVal);\n\n\t\t\tif (isNaN(curVal))\n\t\t\t{\n\t\t\t\tcurVal = 0;\n\t\t\t}\n\t\t\tif (isNaN(orgVal))\n\t\t\t{\n\t\t\t\torgVal = 0;\n\t\t\t}\n\n\t\t}\n\n\t\tif (curVal.valueOf() != orgVal.valueOf())\n\t\t{\n\n\t\t\t// we're not  tracking description fields for now\n\n\t\t\tchangeList.discounts[this.id] = {\n\t\t\t\tnewVal: $(this).val(),\n\t\t\t\torgVal: $(this).data('org_value'),\n\t\t\t\tdiff: $(this).val() - $(this).data('org_value')\n\t\t\t};\n\n\t\t\t$(this).addClass('unsaved_data');\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).removeClass('unsaved_data');\n\t\t}\n\t});\n\n\tif ($(\"#SessDiscnoSD\").length)\n\t{\n\t\tif (initialSessionDiscountSetting != $(\"input[name='SessDisc']:checked\", '#editorForm').val())\n\t\t{\n\t\t\t$(\".SD_area\").addClass('unsaved_data_cb');\n\n\t\t\tvar newSDValue = $(\"input[name='SessDisc']:checked\", '#editorForm').val();\n\n\t\t\tif (newSDValue == \"noSD\")\n\t\t\t{\n\t\t\t\tchangeList.discounts['session_discount'] = {\n\t\t\t\t\tnewVal: 0,\n\t\t\t\t\torgVal: $(\"#OEH_session_discount_org\").html(),\n\t\t\t\t\tdiff: $(\"#OEH_session_discount_org\").html() * -1\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.discounts['session_discount'] = {\n\t\t\t\t\tnewVal: $(\"#OEH_session_discount\").html(),\n\t\t\t\t\torgVal: 0,\n\t\t\t\t\tdiff: $(\"#OEH_session_discount\").html()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\".SD_area\").removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\n\tif ($(\"#PUDnoUP\").length)\n\t{\n\t\tif (initialPreferredUserDiscountSetting != $(\"input[name='PUD']:checked\", '#editorForm').val())\n\t\t{\n\t\t\t$(\"#PUD_area\").addClass('unsaved_data_cb');\n\n\t\t\tvar newPUDValue = $(\"input[name='PUD']:checked\", '#editorForm').val();\n\n\t\t\tif (newPUDValue == \"noUP\")\n\t\t\t{\n\t\t\t\tchangeList.discounts['preferred_user_discount'] = {\n\t\t\t\t\tnewVal: 0,\n\t\t\t\t\torgVal: $(\"#OEH_preferred_org\").html(),\n\t\t\t\t\tdiff: $(\"#OEH_preferred_org\").html() * -1\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tchangeList.discounts['preferred_user_discount'] = {\n\t\t\t\t\tnewVal: $(\"#OEH_preferred\").html(),\n\t\t\t\t\torgVal: 0,\n\t\t\t\t\tdiff: $(\"#OEH_preferred\").html()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\tdiscountChanges = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#PUD_area\").removeClass('unsaved_data_cb');\n\t\t}\n\t}\n\n\t// coupons\n\tvar orgCouponVal = $(\"#org_coupon_id\").val();\n\tvar curCouponVal = $(\"#coupon_id\").val();\n\n\tif (orgCouponVal != curCouponVal)\n\t{\n\t\tdiscountOrPaymentChanges = true;\n\n\t\tif (orgCouponVal == \"\")\n\t\t{\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tchange_type: \"added\"\n\t\t\t};\n\t\t}\n\t\telse if (curCouponVal == \"\")\n\t\t{\n\t\t\t//removed\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tchange_type: \"removed\"\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//added\n\t\t\tchangeList.coupon = {\n\t\t\t\tnewVal: curCouponVal,\n\t\t\t\torgVal: orgCouponVal,\n\t\t\t\tchange_type: \"changed\"\n\t\t\t};\n\t\t}\n\n\t}\n\n\tif (discountOrPaymentChanges)\n\t{\n\t\t$(\"#payments_tab_li\").addClass(\"unsaved_data_on_tab\");\n\t\tshowSaveButton = true;\n\t}\n\telse\n\t{\n\t\t$(\"#payments_tab_li\").removeClass(\"unsaved_data_on_tab\");\n\t}\n\n\tif (orderState == 'SAVED' && (showSaveButton || $('#use_store_credit').is(':checked')))\n\t{\n\t\t$(\"#saveOrderSpan\").show();\n\t}\n\telse\n\t{\n\t\t$(\"#saveOrderSpan\").hide();\n\t}\n\n\tif (orderState == 'SAVED' && ($('#use_store_credit').is(':checked') || paymentChanges))\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", false);\n\t}\n\telse\n\t{\n\t\t$(\"#addPaymentAndActivateButton\").attr(\"disabled\", true);\n\n\t}\n\n\tif (orderState == 'ACTIVE' || allowLimitedAccess)\n\t{\n\t\t$(\"#finalizeOrderSpan\").show();\n\t\tif (showSaveButton || paymentChanges || $('#use_store_credits').is(':checked'))\n\t\t{\n\t\t\tdiscountOrPaymentChanges = true;\n\t\t\t$(\"#submit_button\").attr(\"disabled\", false);\n\t\t\t$(\"#finalize_msg\").show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#submit_button\").attr(\"disabled\", true);\n\t\t\t$(\"#finalize_msg\").hide();\n\t\t}\n\t}\n\telse\n\t{\n\t\t$(\"#finalizeOrderSpan\").hide();\n\t}\n\n\tif (itemChanges || discountOrPaymentChanges)\n\t{\n\t\t$(\"#changeListTab\").addClass('unsaved_data_list');\n\t}\n\telse\n\t{\n\t\t$(\"#changeListTab\").removeClass('unsaved_data_list');\n\t}\n\n\tdrawChangeList();\n}\n\nfunction handleAutoAdjust(obj)\n{\n\t// called when the document is loaded or when the \"autoAdjust\" check box changes\n\n\t// if checked then setup the amounts to be credited/debited\n\tif (obj.checked)\n\t{\n\t\tvar balance = Number($('#OEH_remaing_balance').html());\n\n\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || balance > 0))\n\t\t{\n\t\t\tif (balance > 0)\n\t\t\t{\n\t\t\t\t$('#payment1_type').val('DPADJUST');\n\t\t\t\tchangePayment1('DPADJUST');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tadjustPendingDelayedPayment(balance);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tif (balance > 0)\n\t\t\t{\n\t\t\t\t$('#payment1_type').val('REFERENCE');\n\t\t\t\tchangePayment1('REFERENCE');\n\t\t\t}\n\n\t\t\tassignBalanceToRefTransactions(balance);\n\t\t}\n\t}\n\telse\n\t{\n\n\t\tif ($('#payment1_type').val() != \"\")\n\t\t{\n\t\t\t$('#payment1_type').val('');\n\t\t\tchangePayment1('');\n\t\t}\n\n\t\t// also clear any credits\n\t\tfor (ident in existingPaymentAmountArray)\n\t\t{\n\t\t\t$('#Cr_RT_' + ident).val(\"\");\n\t\t}\n\n\t\t// or if trying to credit\n\n\t}\n\n\treportPaymentStatus(false);\n}\n\nfunction getAbbreviatedChangeString()\n{\n\tvar htmlStr = \"\";\n\tvar addedStd = 0;\n\tvar removedStd = 0;\n\n\tif (needPlatePointsMaxDiscountChangeWarning)\n\t{\n\t\thtmlStr += \"<div style='color:red;'>Warning: The amount discountable by Dinner Dollars has changed. You may wish to review and adjust the Dinner Dollars discount.</div>\";\n\n\t}\n\n\tfor (var item in changeList.stdMenuItems)\n\t{\n\t\tif (changeList.stdMenuItems.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.stdMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\taddedStd++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedStd++;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (addedStd)\n\t{\n\t\thtmlStr += addedStd + \" Standard items were added.<br />\"\n\t}\n\tif (removedStd)\n\t{\n\t\thtmlStr += removedStd + \" Standard items were removed.<br />\"\n\t}\n\n\tvar addedFT = 0;\n\tvar removedFT = 0;\n\n\tfor (var item in changeList.FTMenuItems)\n\t{\n\t\tif (changeList.FTMenuItems.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.FTMenuItems[item] > 0)\n\t\t\t{\n\t\t\t\taddedFT++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedFT++;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (addedFT)\n\t{\n\t\thtmlStr += addedFT + \" Sides &amp; Sweets items were added.<br />\"\n\t}\n\tif (removedFT)\n\t{\n\t\thtmlStr += removedFT + \" Sides &amp; Sweets items were removed.<br />\"\n\t}\n\n\tfor (var item in changeList.miscCosts)\n\t{\n\n\t\tif (changeList.miscCosts.hasOwnProperty(item))\n\t\t{\n\n\t\t\tif (changeList.miscCosts[item][\"newVal\"] > changeList.miscCosts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.miscCosts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.miscCosts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.miscCosts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.miscCosts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tfor (var item in changeList.miscDescs)\n\t{\n\t\tif (changeList.miscDescs.hasOwnProperty(item))\n\t\t{\n\t\t\thtmlStr += getHumanReadableName(item) + \" updated<br />\";\n\t\t}\n\t}\n\n\tif (changeList.order_type != \"\")\n\t{\n\t\thtmlStr += \"<h3>Order changed \" + changeList.order_type + \"</h3>\";\n\t}\n\n\tvar addedBI = 0;\n\tvar removedBI = 0;\n\n\tfirst = true;\n\tfor (var item in changeList.bundleItems)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\tif (isDreamTaste)\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Meal Prep Workshop Items List</h3>\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtmlStr += \"<h3>Intro Items List</h3>\";\n\t\t\t}\n\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.bundleItems.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.bundleItems[item] > 0)\n\t\t\t{\n\t\t\t\taddedBI++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tremovedBI++;\n\t\t\t}\n\t\t}\n\t}\n\tif (addedBI)\n\t{\n\t\thtmlStr += addedBI + \" items were added.<br />\"\n\t}\n\tif (removedBI)\n\t{\n\t\thtmlStr += removedBI + \" items were removed.<br />\"\n\t}\n\n\tif (htmlStr != \"\")\n\t{\n\t\thtmlStr = \"<h3>Purchase Changes</h3>\" + htmlStr;\n\t}\n\n\tfirst = true;\n\tfor (var item in changeList.discounts)\n\t{\n\t\tif (first)\n\t\t{\n\t\t\thtmlStr += \"<h3>Discounts</h3>\";\n\t\t\tfirst = false;\n\t\t}\n\n\t\tif (changeList.discounts.hasOwnProperty(item))\n\t\t{\n\t\t\tif (changeList.discounts[item][\"newVal\"] > changeList.discounts[item][\"orgVal\"])\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"orgVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Added \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was increased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"]) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (changeList.discounts[item][\"newVal\"] == 0)\n\t\t\t\t{\n\t\t\t\t\thtmlStr += \"Removed \" + getHumanReadableName(item) + \" of $\" + formatAsMoney(changeList.discounts[item][\"orgVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\thtmlStr += getHumanReadableName(item) + \" was decreased by $\" + formatAsMoney(changeList.discounts[item][\"diff\"] * -1) + \" to $\" + formatAsMoney(changeList.discounts[item][\"newVal\"]) + \"<br />\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tif ($('#autoAdjust').is(\":checked\"))\n\t{\n\t\thtmlStr += \"<span style='color:red'>Auto-Adjust is checked and will \" + $(\"#adj_action\").html() + \"</span>\";\n\n\t}\n\n\thtmlStr = \"<div id='finalize_changes_div'>\" + htmlStr + \"</div>\";\n\treturn htmlStr;\n}\n\nfunction addPaymentToLockedOrder()\n{\n\tvar billing_name = $(\"#payment1_ccNameOnCard\").val();\n\tvar billing_address = $(\"#billing_address_1\").val();\n\tvar billing_zip = $(\"#billing_postal_code_1\").val();\n\tvar amt = $(\"#payment1_cc_total_amount\").val();\n\n\t$.ajax({\n\t\turl: 'ddproc.php',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tasync: true,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'admin_order_mgr_processor',\n\t\t\tstore_id: STORE_DETAILS.id,\n\t\t\top: 'get_token',\n\t\t\torder_id: order_id,\n\t\t\tamount: amt,\n\t\t\tuser_id: user_id,\n\t\t\tbilling_name: billing_name,\n\t\t\tbilling_address: billing_address,\n\t\t\tbilling_zip: billing_zip,\n\t\t\tdd_csrf_token: $('input[name=dd_csrf_token]', '#editorForm').val(),\n\t\t\tchain_token: true\n\t\t},\n\t\tsuccess: function (json)\n\t\t{\n\t\t\t$('input[name=dd_csrf_token]', '#editorForm').val(json.getTokenToken);\n\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder() get_token successful\");\n\n\t\t\t\tvar token = json.token;\n\n\t\t\t\tsend(token, 1, false, true, true, false);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$(\"#paying_div\").remove();\n\n\t\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + json.processor_message);\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError)\n\t\t{\n\t\t\t$(\"#paying_div\").remove();\n\n\t\t\tintenseLogging(\"addPaymentToLockedOrder get_token: \" + strError + \" | \" + objAJAXRequest.responseText);\n\n\t\t\tresponse = 'Unexpected error: ' + strError;\n\t\t\tdd_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: response\n\t\t\t});\n\n\t\t}\n\n\t});\n\n}\n\nfunction submitPage()\n{\n\tintenseLogging(\"submitPage() called\");\n\n\tvar form = $(\"#editorForm\")[0];\n\n\tvar is_valid = confirm_and_check_form(form);\n\n\tif (is_valid)\n\t{\n\t\tvar message = \"This can not be undone. Are you sure you want to submit the changes?\";\n\t\tvar changesBlurb = getAbbreviatedChangeString();\n\t\tmessage += \"<br /><br />\" + changesBlurb;\n\n\t\tvar dialogHeight = 460;\n\n\t\tif (message.length < 128)\n\t\t{\n\t\t\tdialogHeight = 160;\n\t\t}\n\t\telse if (message.length < 256)\n\t\t{\n\t\t\tdialogHeight = 260;\n\t\t}\n\n\t\tdd_message({\n\t\t\ttitle: 'Finalize',\n\t\t\tmessage: message,\n\t\t\tmodal: true,\n\t\t\twidth: 400,\n\t\t\theight: dialogHeight,\n\t\t\tconfirm: function ()\n\t\t\t{\n\n\t\t\t\tif (supports_transparent_redirect && $(\"#payment1_type\").val() == 'CC')\n\t\t\t\t{\n\t\t\t\t\tintenseLogging(\"submitPage() confirmed\");\n\n\t\t\t\t\tif (!allowLimitedAccess)\n\t\t\t\t\t{\n\t\t\t\t\t\tupdateActiveOrder(true, true);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\taddPaymentToLockedOrder(true, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('<input>').attr({\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'changeList',\n\t\t\t\t\t\tvalue: JSON.stringify(changeList)\n\t\t\t\t\t}).appendTo($(form));\n\n\t\t\t\t\t$('<input>').attr({\n\t\t\t\t\t\ttype: 'hidden',\n\t\t\t\t\t\tname: 'changeListStr',\n\t\t\t\t\t\tvalue: getChangeListHTML()\n\t\t\t\t\t}).appendTo($(form));\n\n\t\t\t\t\t$(\"#submit_changes\").val(\"true\");\n\t\t\t\t\t$(\"#editorForm\").submit();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n}\n\nfunction resetPage()\n{\n\tintenseLogging(\"resetPage() called\");\n\n\tbounce(window.location.href);\n}\n\nfunction confirm_and_check_form(form)\n{\n\n\tintenseLogging(\"confirm_and_check_form() called\");\n\n\tif (orderState == 'NEW' || orderState == 'SAVED')\n\t{\n\t\treturn false;\n\t}\n\n\tif (hasBundle)\n\t{\n\t\tvar bundleIsSelected = false;\n\t\tif ($('#selectedBundle').is(':checked'))\n\t\t{\n\t\t\tbundleIsSelected = true;\n\t\t}\n\n\t\tif (bundleIsSelected)\n\t\t{\n\n\t\t\tvar numBundItems = countSelectedBundleItems();\n\t\t\tif (numBundItems < 18)\n\t\t\t{\n\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Please select at least 18-servings of Meal Prep Starter Pack items.'\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse if (numBundItems > 18)\n\t\t\t{\n\t\t\t\tdd_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Please select no more than 18 servings of Meal Prep Starter Pack items.'\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (stationNeedsAttention)\n\t{\n\t\tdd_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please review the Side Station and ensure the correct number of items are selected.'\n\t\t});\n\t\treturn false;\n\t}\n\n\treturn _check_form(form);\n}\n\n// rounds to the nearest penny\n// move to global once this is found to be reliable\nfunction dd_round_amount(inAmount)\n{\n\tinAmount += .000005;\n\n\tvar tempVal = inAmount * 1000.0;\n\ttempVal = parseInt(tempVal);\n\ttempVal = tempVal / 10;\n\tvar pennyFraction = tempVal - Math.floor(tempVal);\n\tif (pennyFraction >= .5)\n\t{\n\t\ttempVal = Math.floor(tempVal) + 1;\n\t}\n\telse\n\t{\n\t\ttempVal = Math.floor(tempVal);\n\t}\n\n\treturn tempVal / 100;\n}\n\n/*\n\n function reportTestFailure(testNum, actual, correct)\n {\n if (actual != correct)\n {\n alert(\"Test #: \" + testNum + \" actual: \" + actual + \" correct: \" + correct);\n }\n }\n\n function doTests()\n {\n\n var testmultiplier = \".5\";\n\n var testNum = \"260.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(1, newResult, 130.05);\n\n var testNum = \"209.10\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(2, newResult, 104.55);\n\n testNum = \"209.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(3, newResult, 104.55);\n\n testNum = \"209\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(4, newResult, 104.5);\n\n testNum = \"1\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(5, newResult, .5);\n\n testNum = \"0\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(6, newResult, 0);\n\n testNum = \".05\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(7, newResult, .03);\n\n testNum = \".005\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(8, newResult, 0);\n\n testNum = \"499.99\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(9, newResult, 250);\n\n var testNum = \"209.10\";\n var testmultiplier = \".12\";\n\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(10, newResult, 25.09);\n\n testNum = \"209.09\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(11, newResult, 25.09);\n\n testNum = \"209\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(12, newResult, 25.08);\n\n testNum = \"1\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(13, newResult, .12);\n\n testNum = \"0\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(14, newResult, 0);\n\n testNum = \".05\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(15, newResult, .01);\n\n testNum = \".005\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(16, newResult, 0);\n\n testNum = \"499.99\";\n var testResult = testNum * testmultiplier;\n var newResult = dd_round_amount(testResult);\n console.log('testResult: ' + testResult + '   New Result: ' + newResult);\n reportTestFailure(17, newResult, 60);\n\n }\n\n doTests();\n\n */\n\nfunction updateSideStationStatus(entree_id, qty)\n{\n\tif (qty == 0)\n\t{\n\t\tstationNeedsAttention = false;\n\t\thelp_message = \"You must set the Bundle quantity to greater than zero.\";\n\t\tvar stationHelpName = \"sidestation_help_\" + entree_id;\n\t\tvar stationHelpElem = $(\"#\" + stationHelpName);\n\t\tstationHelpElem.css('color', \"#bb0000\");\n\t\tstationHelpElem.html(help_message);\n\n\t\treturn;\n\t}\n\n\tvar requiredItemCount = qty * sideStationBundleInfo[entree_id].number_items_required;\n\tvar numRequiredSpanName = \"required_items_station_\" + entree_id;\n\t$(\"#\" + numRequiredSpanName).html(requiredItemCount);\n\n\tvar numSelected = 0;\n\n\t$.each(sideStationBundleInfo[entree_id].bundle, function (sid, sinfo)\n\t{\n\n\t\tvar itemQty = $('#sbi_' + sid);\n\n\t\tif (itemQty && itemQty.val() != \"\")\n\t\t{\n\t\t\tif (isNaN(itemQty.val()) == true || itemQty.val() - parseInt(itemQty.val()) != 0)\n\t\t\t{\n\t\t\t\titemQty.val(0);\n\t\t\t}\n\n\t\t\tif (itemQty.val() > 0)\n\t\t\t{\n\t\t\t\titemQty.val(parseInt(itemQty.val()));\n\t\t\t\tnumSelected += (itemQty.val() * 1);\n\t\t\t}\n\n\t\t\tvar inv_qty = entreeIDToInventoryMap[sid].remaining;\n\t\t\tinv_qty -= (itemQty.val() * sinfo.servings_per_item);\n\n\t\t\t$('#sbi_inv_' + sid).html(inv_qty);\n\n\t\t\t$('#inv_' + sid).html(inv_qty);\n\n\t\t\tentreeIDToInventoryMap[sid].remaining = inv_qty;\n\n\t\t}\n\n\t});\n\n\tvar numSelectedSpanName = \"selected_items_station_\" + entree_id;\n\t$(\"#\" + numSelectedSpanName).html(numSelected);\n\n\tvar stationHelpName = \"sidestation_help_\" + entree_id;\n\tvar stationHelpElem = $(\"#\" + stationHelpName);\n\tvar help_message = \"\";\n\tif (numSelected == 0)\n\t{\n\t\thelp_message = \"Please select \" + requiredItemCount + \" items.\";\n\t\tstationHelpElem.css('color', \"#bb0000\");\n\t\tstationNeedsAttention = true;\n\t}\n\telse if (numSelected > requiredItemCount)\n\t{\n\t\thelp_message = \"You have selected \" + (numSelected - requiredItemCount) + \" items more than the required amount. Please remove \" + (numSelected - requiredItemCount) + \" items.\";\n\t\tstationHelpElem.css('color', \"#bb0000\");\n\t\tstationNeedsAttention = true;\n\t}\n\telse if (numSelected < requiredItemCount)\n\t{\n\t\thelp_message = \"You have selected \" + (requiredItemCount - numSelected) + \" items less than the required amount. Please add \" + (requiredItemCount - numSelected ) + \" items.\";\n\t\tstationHelpElem.css('color', \"#bb0000\");\n\t\tstationNeedsAttention = true;\n\t}\n\telse\n\t{\n\t\thelp_message = \"You have selected the correct number of sidestation items. You may continue with item selection or checkout.\";\n\t\tstationHelpElem.css('color', \"#00bb00\");\n\t\tstationNeedsAttention = false;\n\t}\n\n\tstationHelpElem.html(help_message);\n\n}\n\n// this massive function is called anytime something that affects costs or payments is altered\nfunction calculateTotal()\n{\n\n\tvar total = 0;\n\tvar entrees = 0;\n\tvar servings = 0;\n\tvar halfQty = 0;\n\tvar wholeQty = 0;\n\tvar introQty = 0;\n\tvar sideDishQty = 0;\n\tvar sideDishSubTotal = 0;\n\tvar bundlesSubTotal = 0;\n\tvar productsSubTotal = 0;\n\tvar bundlesQty = 0;\n\tvar discounted_total = 0;\n\tvar creditContribution = 0;\n\tvar DRSubjectCreditContribution = 0;\n\tvar main_items_count = 0;\n\tvar aux_items_count = 0;\n\tvar bundleIsSelected = false;\n\tvar PUDExcludedItemsTotal = 0;\n\tvar PUDExcludedFullItemsCount = 0;\n\tvar PUDExcludedHalfItemsCount = 0;\n\tvar creditConsumed = 0;\n\n\tvar sortedCoreItemList = [];\n\tvar itemsSelected = [];\n\n\tif (hasBundle)\n\t{\n\t\tif ($('#selectedBundle').is(':checked'))\n\t\t{\n\t\t\tbundleIsSelected = true;\n\t\t}\n\t}\n\n\n\tfor (var x in entreeIDToInventoryMap)\n\t{\n\t\tentreeIDToInventoryMap[x].remaining = entreeIDToInventoryMap[x].org_remaining;\n\t\t$('#inv_' + x).html(entreeIDToInventoryMap[x].org_remaining);\n\n\t}\n\n\t// ---------------------------------------------------------- Items\n\t// loop through all the quantity input boxes and gather up the totals\n\n\n\t// var count = 0;\n\t$(\"[id^='qty_']\").each(function ()\n\t{\n\t\t//  count++;\n\n\t\tif ($(this).val() != \"\")\n\t\t{\n\t\t\tif (isNaN($(this).val()) == true || $(this).val() - parseInt($(this).val(), 10) != 0)\n\t\t\t{\n\t\t\t\t$(this).val(0);\n\t\t\t}\n\n\t\t\tvar itemQty = $(this).val();\n\t\t\tvar itemId = this.id.split(\"_\")[1];\n\n\t\t\tif ( isFactoringCredit )\n\t\t\t{\n\t\t\t\tvar orgAmount = $(this).data('org_value');\n\t\t\t\tif ($(this).data('dd_type') == 'std')\n\t\t\t\t{\n\t\t\t\t\tif (orgAmount < itemQty)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = itemQty - orgAmount;\n\t\t\t\t\t\tcreditContribution += (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t\telse if (itemQty  < orgAmount)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = orgAmount - itemQty ;\n\t\t\t\t\t\tcreditContribution -= (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse // addon\n\t\t\t\t{\n\t\t\t\t\tvar orgAmount = itemQty.getAttribute('data-org_value');\n\t\t\t\t\tif (orgAmount < itemQty )\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = itemQty  - orgAmount;\n\t\t\t\t\t\tcreditConsumed += (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t\telse if (itemQty < orgAmount)\n\t\t\t\t\t{\n\t\t\t\t\t\tdiff = orgAmount - itemQty;\n\t\t\t\t\t\tcreditContribution -= (diff * $(this).data('price'));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( (isNaN(itemQty) == false) )\n\t\t\t{\n\t\t\t\tvar entree_id = $(this).data('entreeid');\n\t\t\t\tvar inv_qty = entreeIDToInventoryMap[entree_id].remaining;\n\t\t\t\tvar temp_servings = Number($(this).data('servings'));\n\t\t\t\tinv_qty = inv_qty - (itemQty * temp_servings);\n\t\t\t\t$('#inv_' + entree_id).html(inv_qty);\n\t\t\t\tentreeIDToInventoryMap[entree_id].remaining = inv_qty;\n\n\t\t\t\tif ($(this).data('dd_type') != 'cts')\n\t\t\t\t{\n\n\t\t\t\t\tif (itemQty > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar obj = {\n\t\t\t\t\t\t\tid: itemId,\n\t\t\t\t\t\t\tqty: itemQty,\n\t\t\t\t\t\t\tprice: $(this).data('price'),\n\t\t\t\t\t\t\tserving_size: $(this).data('servings')\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tsortedCoreItemList.push(obj)\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t\t\t\ttotal += itemQty * $(this).data('price');\n\n\t\t\t\tif ($(this).data('dd_type') != 'cts')\n\t\t\t\t{\n\t\t\t\t\tentrees += itemQty * 1;\n\t\t\t\t\tservings += itemQty * $(this).data('servings');\n\n\t\t\t\t\tif ($(this).data('pricing_type') == 'FULL')\n\t\t\t\t\t{\n\t\t\t\t\t\twholeQty += itemQty * 1;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thalfQty += itemQty * 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsideDishQty += itemQty * 1;\n\t\t\t\t\tsideDishSubTotal += itemQty * $(this).data('price');\n\t\t\t\t}\n\n\t\t\t\tif ($(this).data('is_bundle') == 'true')\n\t\t\t\t{\n\t\t\t\t\tbundlesSubTotal += itemQty * $(this).data('price');\n\t\t\t\t\tbundlesQty += (itemQty * 1);\n\t\t\t\t}\n\n\t\t\t\titemsSelected[itemId] = itemQty;\n\n\t\t\t\t$('#sbi_inv_' + entree_id).html(inv_qty);\n\t\t\t}\n\n\t\t\tif ($(this).data('is_bundle') == 'true')\n\t\t\t{\n\t\t\t\tupdateSideStationStatus(entree_id, itemQty);\n\t\t\t}\n\t\t}\n\t});\n\n\tmain_items_count = halfQty + wholeQty  + sideDishQty;\n\n\tif (hasBundle)\n\t{\n\t\tif (originallyHadBundle)\n\t\t{\n\t\t\t// bundle support\n\t\t\tvar selectedBundleItemCount = 0;\n\t\t\tvar selectedBundleServingsCount = 0;\n\n\t\t\tif (bundleIsSelected)\n\t\t\t{\n\n\t\t\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t\t\t{\n\t\t\t\t\tif ($(this).data('org_value') == \"1\") //was initially chosen\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!$(this).is(\":checked\"))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar inv_qty = entreeIDToInventoryMap[$(this).data('entreeid')].remaining;\n\t\t\t\t\t\t\tinv_qty = inv_qty + $(this).data('servings');\n\t\t\t\t\t\t\t$('#inv_' + $(this).data('entreeid')).html(inv_qty);\n\t\t\t\t\t\t\tentreeIDToInventoryMap[$(this).data('entreeid')].remaining = inv_qty;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselectedBundleItemCount++;\n\t\t\t\t\t\t\tselectedBundleServingsCount += $(this).data('servings');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar inv_qty = entreeIDToInventoryMap[$(this).data('entreeid')].remaining;\n\t\t\t\t\t\t\tinv_qty = inv_qty - $(this).data('servings');\n\t\t\t\t\t\t\t$('#inv_ ' + $(this).data('entreeid')).html(inv_qty);\n\t\t\t\t\t\t\tentreeIDToInventoryMap[$(this).data('entreeid')].remaining = inv_qty;\n\t\t\t\t\t\t\tselectedBundleItemCount++;\n\t\t\t\t\t\t\tselectedBundleServingsCount += $(this).data('servings');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t\t}\n\t\t\telse\n\t\t\t{ //bundle is not selected\n\n\t\t\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t\t\t{\n\t\t\t\t\tif ($(this).data('org_value') == \"1\") //was initially chosen\n\t\t\t\t\t{\n\t\t\t\t\t\tvar inv_qty = entreeIDToInventoryMap[$(this).data('entreeid')].remaining;\n\t\t\t\t\t\tinv_qty = inv_qty + $(this).data('servings');\n\t\t\t\t\t\t$('#inv_' + $(this).data('entreeid')).html(inv_qty);\n\t\t\t\t\t\tentreeIDToInventoryMap[$(this).data('entreeid')].remaining = inv_qty;\n\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar selectedBundleItemCount = 0;\n\t\t\tvar selectedBundleServingsCount = 0;\n\t\t\tif (bundleIsSelected)\n\t\t\t{\n\n\t\t\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t\t\t{\n\t\t\t\t\tif ($(this).is(\":checked\"))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar inv_qty = entreeIDToInventoryMap[$(this).data('entreeid')].remaining;\n\t\t\t\t\t\tinv_qty = inv_qty - $(this).data('servings');\n\t\t\t\t\t\t$('#inv_' + $(this).data('entreeid')).html(inv_qty);\n\t\t\t\t\t\tentreeIDToInventoryMap[$(this).data('entreeid')].remaining = inv_qty;\n\t\t\t\t\t\tselectedBundleItemCount++;\n\t\t\t\t\t\tselectedBundleServingsCount += $(this).data('servings');\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tif (hasBundle)\n\t{\n\t\t// bundle support\n\t\tif (bundleIsSelected)\n\t\t{\n\t\t\ttotal += (bundleInfo.price * 1);\n\t\t\twholeQty += selectedBundleItemCount;\n\t\t\tservings += selectedBundleServingsCount;\n\t\t}\n\t}\n\n\tif (tasteBundleMenuData)\n\t{\n\t\tif (hasDreamTasteBundle)\n\t\t{\n\t\t\t// bundle support\n\t\t\tvar selectedWholeBundleItemCount = 0;\n\t\t\tvar selectedHalfBundleItemCount = 0;\n\t\t\tvar selectedBundleServingsCount = 0;\n\n\t\t\ttotal += dreamTastePrice;\n\n\t\t\t$(\"[id^='bnd_']\").each(function ()\n\t\t\t{\n\n\t\t\t\tvar tasteItemQty = $(this).val();\n\t\t\t\tif (tasteItemQty > 0)\n\t\t\t\t{\n\t\t\t\t\tservings += ($(this).data('servings') * tasteItemQty);\n\t\t\t\t\tif ($(this).data('servings') == 3)\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedHalfBundleItemCount += (tasteItemQty * 1);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tselectedWholeBundleItemCount += (tasteItemQty * 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar inv_qty = entreeIDToInventoryMap[$(this).data('entreeid')].remaining;\n\t\t\t\t\tinv_qty = inv_qty - (tasteItemQty * 3);\n\t\t\t\t\t$('#inv_' + $(this).data('entreeid')).html(inv_qty);\n\t\t\t\t\tentreeIDToInventoryMap[$(this).data('entreeid')].remaining = inv_qty;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twholeQty += (selectedWholeBundleItemCount * 1);\n\t\t\thalfQty += (selectedHalfBundleItemCount * 1);\n\n\t\t}\n\t}\n\n\tvar discountablePlatePointsAmount = 0;\n\n\tif ($(\"#selectedBundle\").is(':checked') )\n\t{\n\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(0))\n\t}\n\telse\n\t{\n\t\tdiscountablePlatePointsAmount = getPlatePointsDiscountableAmount(sortedCoreItemList, total);\n\n\t    needPlatePointsMaxDiscountChangeWarning = false;\n\n\t    if (discountablePlatePointsAmount != lastMaxPPDiscountAmount && lastMaxPPDiscountAmount != -1)\n\t    {\n\t    \tneedPlatePointsMaxDiscountChangeWarning = true;\n\t    }\n\n\t    lastMaxPPDiscountAmount = discountablePlatePointsAmount;\n\n\n\t\tif (couponlimitedToFT)\n\t\t{\n\t\t\tvar tempCouponVal = Number(document.getElementById('couponValue').value);\n\t\t\tdiscountablePlatePointsAmount -= tempCouponVal;\n\t\t\tif (discountablePlatePointsAmount < 0)\n\t\t\t{\n\t\t\t\tdiscountablePlatePointsAmount = 0;\n\t\t\t}\n\n\t\t}\n\n\t\t$(\"#max_plate_points_deduction\").html(formatAsMoney(discountablePlatePointsAmount))\n\t}\n\n\tif (discountablePlatePointsAmount <= 0)\n\t{\n\t\t$(\"#plate_points_discount\").attr(\"disabled\", \"disabled\");\n\t\t$(\"#plate_points_discount\").css({\n\t\t\t\"background-color\": \"#c0c0c0\",\n\t\t\t\"color\": \"#060606\"\n\t\t});\n\t\t$(\"#pp_discountable_cost_msg\").show();\n\n\t}\n\telse if (!allowLimitedAccess)\n\t{\n\t\t$(\"#plate_points_discount\").removeAttr(\"disabled\");\n\t\t$(\"#plate_points_discount\").css({\n\t\t\t\"background-color\": \"#ffffff\",\n\t\t\t\"color\": \"#000000\"\n\t\t});\n\t\t$(\"#pp_discountable_cost_msg\").hide();\n\n\t}\n\n\n\tvar maxPPCredit = $(\"#plate_points_available\").html() * 1;\n\tvar maxPPDeduction = $(\"#max_plate_points_deduction\").html() * 1;\n\tvar curPPDiscount = $(\"#plate_points_discount\").val() * 1;\n\n\tif (maxPPDeduction < curPPDiscount)\n\t{\n\t\t$(\"#plate_points_discount\").val(maxPPDeduction);\n\t}\n\n\tif (maxPPCredit > maxPPDeduction)\n\t{\n\t\t$('#tbody_max_plate_points_deduction').show();\n\t}\n\telse\n\t{\n\t\t$('#tbody_max_plate_points_deduction').hide();\n\t}\n\n\tdiscounted_total = total;\n\n\tvar addonsSubtotal = 0;\n\tvar addonsQty = 0;\n\n\n\t//var itemRows = document.getElementById('itemsTbl').rows;\n\t//for (i = 0; i < itemRows.length; i++)\n\n\t$(\"#itemsTbl tr\").each(function ()\n\t{\n\n\t\tif (this.id.indexOf('row_') != -1)\n\t\t{\n\t\t\tvar itemNumber = this.id.substr(4);\n\n\t\t\tvar qty_str = 'qna_' + itemNumber;\n\t\t\tvar prc_str = 'prc_' + itemNumber;\n\n\t\t\tvar addQty = $('#' + qty_str).val();\n\t\t\tvar addonsQtyNumber = Number(addQty);\n\t\t\tvar addPrc = $(\"#\" + prc_str).html();\n\t\t\tvar addPrcNumber = Number(addPrc);\n\t\t\taddonsSubtotal += (Number(addPrc) * addQty);\n\t\t\taddonsQty += addonsQtyNumber;\n\n\t\t\t/// var inv_qty =  Number(document.getElementById('inv_org_' + itemNumber).innerHTML);\n\t\t\tvar inv_qty = entreeIDToInventoryMap[itemNumber].remaining;\n\n\t\t\tinv_qty = inv_qty - addQty;\n\t\t\t$('#inv_' + itemNumber).html(inv_qty.toString());\n\t\t\tentreeIDToInventoryMap[itemNumber].remaining = inv_qty;\n\n\t\t\tif ( isFactoringCredit )\n\t\t\t{\n\t\t\t\torgAmount = document.getElementById(qty_str).getAttribute('data-org_value');\n\t\t\t\tif (orgAmount < addonsQtyNumber)\n\t\t\t\t{\n\t\t\t\t\tdiff = addonsQtyNumber - orgAmount;\n\t\t\t\t\tcreditConsumed += (diff * addPrcNumber);\n\t\t\t\t}\n\t\t\t\telse if (addQty < orgAmount)\n\t\t\t\t{\n\t\t\t\t\tdiff = orgAmount - addQty;\n\t\t\t\t\tcreditContribution -= (diff * addPrcNumber);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tvar totalMealQuantity = Number(halfQty + wholeQty);\n\n\tvar itemCountLabel = $('#OEH_item_count_label');\n\n\tvar itemCountAdjustmentAmount = 0;\n\tvar displayServingsAdjustment = 0;\n\n\t// coupon code free meal count contribution\n\tvar couponTypeElem = $('#coupon_type');\n\tif (couponTypeElem.length && couponTypeElem.val() == 'FREE_MEAL')\n\t{\n\t\tcfm_size = Number($('#free_entree_servings').val());\n\n\t\tif (cfm_size > 0)\n\t\t{\n\t\t\tdisplayServingsAdjustment += cfm_size;\n\t\t\titemCountAdjustmentAmount++;\n\t\t}\n\t}\n\n\tif (itemCountAdjustmentAmount == 0)\n\t{\n\t\tdisplayMealCount = introQty + wholeQty + halfQty + sideDishQty + addonsQty;\n\t\tdisplayServingCount = servings;\n\t\titemCountLabel.html(\"Total Item Count\");\n\t}\n\telse\n\t{\n\t\tdisplayMealCount = introQty + wholeQty +  sideDishQty + halfQty + itemCountAdjustmentAmount + addonsQty;\n\t\tdisplayServingCount = servings + displayServingsAdjustment;\n\t\titemCountLabel.html(\"Total # Items (incl. free meals)\");\n\t}\n\n\tif (orderEditSuccess)\n\t{\n\t\tdisplayMealCount += newAddonQty;\n\t}\n\n\t// update the entree and serving totals display\n\t$('#OEH_item_count').html(displayMealCount);\n\t$('#OEH_number_servings').html(displayServingCount);\n\n\tvar premarkup_total = 0;\n\n\tvar freeMealValue = 0;\n\n\t// also must add coupon code free meal\n\t// coupon code free meal count contribution\n\tcouponTypeElem = $('#coupon_type');\n\tif (couponTypeElem.length && couponTypeElem.val() == 'FREE_MEAL')\n\t{\n\t\tfreeMealValue = Number($('#couponValue').val());\n\n\t\tif (freeMealValue > 0)\n\t\t{\n\t\t\tdiscounted_total += freeMealValue;\n\t\t}\n\t}\n\n\tdiscounted_total += addonsSubtotal;\n\n\tif (orderEditSuccess)\n\t{\n\t\tdiscounted_total += newAddonAmount;\n\t}\n\n\tdiscounted_total = Math.round(discounted_total*100)/100;\n\n\t// --------------------------------------------------------------------- menu items subtotal\n\t$('#orderSubTotal').val(formatAsMoney(Math.round(total*100)/100));\n\t$('#OEH_menu_subtotal').html(formatAsMoney(discounted_total));\n\t$('#orderTotal').val(formatAsMoney(discounted_total));\n\n\t// ------------------------------------------------------ food subtotal\n\n\tvar miscFoodSubtotal = Number(document.getElementById('misc_food_subtotal').value);\n\n\t// menu items total plus misc food cost\n\t//(Note that discountedTotal is misleading here. This reflects legacy of Family savings discount on menu items which no longer applies)\n\tvar food_costs = (discounted_total * 1) + (miscFoodSubtotal *1);\n\tvar session_discount_basis = food_costs;\n\t$('#OEH_food_cost_subtotal').html(formatAsMoney((discounted_total * 1) + (miscFoodSubtotal *1)));\n\n\tvar newGrandTotal = discounted_total;\n\tvar pre_discounts_grand_total = newGrandTotal;\n\n\n\t// -------------------------------DISCOUNTS-----------------------------------------\n\n\n\tvar curPPDiscount = 0;\n\t// ----------------------------------------------  PLATEPOINTS Discount\n\tif ( $('#plate_points_discount').length)\n\t{\n\t\tcurPPDiscount = $('#plate_points_discount').val();\n\t\tif (curPPDiscount > discountablePlatePointsAmount)\n\t\t{\n\t\t\tcurPPDiscount = discountablePlatePointsAmount;\n\t\t\t$('#plate_points_discount').val(formatAsMoney(curPPDiscount));\n\t\t}\n\n\n\t\t//$('#OEH_plate_points_order_discount').html(formatAsMoney(curPPDiscount));\n\t\t// This is now done in the taxesd section\n\n\n\t\tnewGrandTotal = formatAsMoney(newGrandTotal - curPPDiscount);\n\t}\n\n\t// ---------------------------------------------- Direct Order\n\tvar directDiscountVal = Number(0);\n\n\tdirectDiscount = $('#direct_order_discount');\n\tif (directDiscount.val() == \"\")\n\t{\n\t\tdirectDiscount.val('0.00');\n\t}\n\tif ( directDiscount.length )\n\t{\n\t\tdirectDiscountVal = directDiscount.val();\n\n\t\tif (directDiscountVal > food_costs)\n\t\t{\n\t\t\tdirectDiscountVal = food_costs;\n\t\t\tdirectDiscount.val(directDiscountVal);\n\t\t}\n\n\t\tif (directDiscountVal)\n\t\t{\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - directDiscountVal);\n\t\t\t$('#OEH_direct_order_discount').html(formatAsMoney(directDiscountVal));\n\t\t}\n\t}\n\n\n\t// Adjust Bonus Credit and discount\n\tif (isFactoringCredit)\n\t{\n\t\t//alert(creditContribution);\n\t\t//alert(creditConsumed);\n\t\tcreditBasis += \tcreditContribution;\n\t\tcreateBonusCredit(creditConsumed);\n\t}\n\n\n\t// ------------------------------------------------------------------- coupon Discount\n\n\tif (couponDiscountMethod == 'PERCENT')\n\t{\n\t\tvar newDiscountAmount = pre_discounts_grand_total * (couponDiscountVar / 100);\n\n\t\t$('#couponValue').val(newDiscountAmount);\n\t}\n\n\tif (couponlimitedToFT)\n\t{\n\t\tvar newDiscountVal = sideDishSubTotal;\n\t\tif (newDiscountVal > couponDiscountVar)\n\t\t{\n\t\t\tnewDiscountVal = couponDiscountVar;\n\t\t}\n\n\t\t$('#couponValue').val(newDiscountVal);\n\n\t}\n\n\tvar couponDiscountVal = Number(0);\n\tcouponDiscount = $('#couponValue');\n\n\tif ( couponDiscount.length)\n\t{\n\t\tif (couponDiscount.val() == \"\")\n\t\t{\n\t\t\tcouponDiscount.val('0.00');\n\t\t}\n\t\tcouponDiscountVal = couponDiscount.val();\n\n\t\tif (couponDiscountVal)\n\t\t{\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - couponDiscountVal);\n\t\t\t$('#OEH_coupon_discount').html(formatAsMoney(couponDiscountVal));\n\t\t\tsession_discount_basis -= couponDiscountVal;\n\t\t}\n\t}\n\n\t// ------------------------------------------------ Preferred Customer\n\tPUDElem = $('#PUDnoUP');\n\tif (PUDElem.length)\n\t{\n\t\tvar selectedUP = $('input[name=PUD]:checked', '#editorForm').val();\n\n\t\tif (selectedUP == null || selectedUP == \"\")\n\t\t{\n\t\t\tselectedUP = \"noUP\";\n\t\t}\n\n\t\tvar UPDiscount = -1;\n\n\t\tpremarkup_discounted_total = premarkup_total - (total - discounted_total);\n\t\tvar UPType = 'none';\n\t\tvar PcntTypeValue = 0.0;\n\n\tif (originalUP != false)\n\t{\n\t\tif (selectedUP == \"originalUP\")\n\t\t{\n\t\t\tif (originalUP.type == \"FLAT\")\n\t\t\t{\n\t\t\t\tvar cost = (wholeQty - PUDExcludedFullItemsCount) * originalUP.value;\n\t\t\t\tvar halfCost = Number(formatAsMoney(((halfQty - PUDExcludedHalfItemsCount) * (originalUP.value / 2))));\n\t\t\t\tcost += halfCost;\n\t\t\t\tUPDiscount = formatAsMoney(discounted_total - cost - sideDishSubTotal - addonsSubtotal - productsSubTotal - PUDExcludedItemsTotal);\n\t\t\t\tUPType = 'flat';\n\n\t\t\t}\n\t\t\telse if (originalUP.type == \"PERCENT\")\n\t\t\t{\n\t\t\t\tvar basis = pre_discounts_grand_total - sideDishSubTotal - addonsSubtotal - productsSubTotal;\n\t\t\t\tvar multiplier = originalUP.value / 100;\n\t\t\t\tvar pud_result = basis * multiplier;\n\t\t\t\tvar rounded_pud_result = dd_round_amount(pud_result);\n\t\t\t\tUPDiscount = formatAsMoney( rounded_pud_result );\n\t\t\t\tUPType = 'pcnt';\n\t\t\t\tPcntTypeValue = originalUP.value / 100;\n\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (activeUP != false)\n\t\t{\n\t\t\tif (selectedUP == \"activeUP\")\n\t\t\t{\n\t\t\t\tif (activeUP.type == \"FLAT\")\n\t\t\t\t{\n\t\t\t\t\tvar cost = (wholeQty - PUDExcludedFullItemsCount) * activeUP.value;\n\t\t\t\t\tvar halfCost2 = Number(formatAsMoney(((halfQty - PUDExcludedHalfItemsCount) * (originalUP.value / 2))));\n\t\t\t\t\tcost += halfCost2;\n\n\t\t\t\t\tUPDiscount = formatAsMoney((premarkup_discounted_total - cost - sideDishSubTotal- addonsSubtotal - productsSubTotal - PUDExcludedItemsTotal) * -1);\n\t\t\t\t\tUPType = 'flat';\n\t\t\t\t}\n\t\t\t\telse if (activeUP.type == \"PERCENT\")\n\t\t\t\t{\n\t\t\t\t\tvar basis = pre_discounts_grand_total - sideDishSubTotal - addonsSubtotal - productsSubTotal;\n\t\t\t\t\tvar multiplier = activeUP.value / 100;\n\t\t\t\t\tvar pud_result = basis * multiplier;\n\t\t\t\t\tvar rounded_pud_result = dd_round_amount(pud_result);\n\t\t\t\t\tUPDiscount = formatAsMoney( rounded_pud_result );\n\t\t\t\t\tUPType = 'pcnt';\n\t\t\t\t\tPcntTypeValue = activeUP.value / 100;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (selectedUP == \"noUP\")\n\t\t{\n\t\t\tUPDiscount = 0;\n\t\t}\n\n\t\tif (UPType == 'flat')\n\t\t{\n\t\t\tif (typeof promoVal  != 'undefined' && promoVal > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= promoVal;\n\t\t\t}\n\n\t\t\tif (freeMealValue > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= freeMealValue;\n\t\t\t}\n\t\t}\n\t\telse if (UPType == 'pcnt')\n\t\t{\n\t\t\tif (typeof promoVal  != 'undefined' && promoVal > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= (promoVal * PcntTypeValue);\n\t\t\t\tUPDiscount = Math.round(UPDiscount * 100) / 100;\n\t\t\t}\n\n\t\t\tif (freeMealValue > 0 && UPDiscount > 0)\n\t\t\t{\n\t\t\t\tUPDiscount -= (freeMealValue * PcntTypeValue);\n\t\t\t\tUPDiscount = Math.round(UPDiscount * 100) / 100;\n\t\t\t}\n\t\t}\n\n\t\tif (UPDiscount != -1)\n\t\t{\n\t\t\tUPDiscountElem = $('#OEH_preferred');\n\t\t\tif (UPDiscountElem.length)\n\t\t\t{\n\t\t\t\tUPDiscountElem.html(formatAsMoney(UPDiscount));\n\t\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - UPDiscount);\n\t\t\t\tsession_discount_basis -= UPDiscount;\n\t\t\t}\n\t\t}\n\n\t}\n\n\t// Need to break food and service fee portions early enough to\n\t// calculate session discount\n\tnewGrandTotal = Number((newGrandTotal * 1) + (miscFoodSubtotal * 1));\n\t$('#OEH_misc_food_subtotal').html(formatAsMoney(miscFoodSubtotal));\n\n\tvar serviceFee = Number($('#subtotal_service_fee').val());\n\t$('#OEH_subtotal_service_fee').html(formatAsMoney(serviceFee));\n\tnewGrandTotal = Number((newGrandTotal * 1) + (serviceFee * 1));\n\n\tif (curPPDiscount > 0)\n\t{\n\t\tvar food_portion_of_points_credit = 0;\n\t\tvar fee_portion_of_points_credit = 0;\n\n\t\tif (discountMFYFeeFirst && serviceFee > 0)\n\t\t{\n\n\t\t\tif (curPPDiscount > serviceFee)\n\t\t\t{\n\t\t\t\tfood_portion_of_points_credit = curPPDiscount - serviceFee;\n\t\t\t\tfee_portion_of_points_credit = serviceFee;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfee_portion_of_points_credit = curPPDiscount;\n\t\t\t\tfood_portion_of_points_credit = 0;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar foodPortionOfMaxDeduction = discountablePlatePointsAmount - serviceFee;\n\n\t\t\tif (curPPDiscount > foodPortionOfMaxDeduction)\n\t\t\t{\n\t\t\t\tvar remainderAfterFoodDiscount = curPPDiscount - foodPortionOfMaxDeduction;\n\t\t\t\tfood_portion_of_points_credit = foodPortionOfMaxDeduction;\n\t\t\t\tfee_portion_of_points_credit = remainderAfterFoodDiscount;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfood_portion_of_points_credit = curPPDiscount;\n\t\t\t\tfee_portion_of_points_credit = 0;\n\t\t\t}\n\t\t}\n\n\t\t$('#OEH_plate_points_order_discount_food').html(formatAsMoney(food_portion_of_points_credit));\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(fee_portion_of_points_credit));\n\t}\n\telse\n\t{\n\t\t$('#OEH_plate_points_order_discount_food').html(formatAsMoney(0));\n\t\t$('#OEH_plate_points_order_discount_fee').html(formatAsMoney(0));\n\t}\n\n\n\n\t// -------------------------------------------------------- Session Discount\n\n\tSessDisc = $('#SessDiscnoSD');\n\tif (SessDisc.length)\n\t{\n\n\t\tsession_discount_basis = Number((session_discount_basis * 1) - (directDiscountVal * 1) - (food_portion_of_points_credit * 1));\n\n\t\tvar selectedSD = $('input[name=SessDisc]:checked', '#editorForm').val();\n\n\t\tif (selectedSD == null || selectedSD == \"\")\n\t\t\tselectedSD = \"noSD\";\n\n\t\tvar sessionDiscount = -1;\n\n\t\tif (selectedSD == \"originalSD\")\n\t\t{\n\t\t\tsessionDiscount = formatAsMoney((session_discount_basis * (originalSD) ? originalSD.value : \"0\") / 100);\n\t\t}\n\t\telse if (selectedSD == \"activeSD\")\n\t\t{\n\t\t\tsessionDiscount = formatAsMoney((session_discount_basis * activeSessionDiscount.value) / 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsessionDiscount = 0;\n\t\t}\n\n\n\t\tSDiscountElem = $('#OEH_session_discount');\n\t\tif (SDiscountElem.length)\n\t\t{\n\t\t\tSDiscountElem.html(formatAsMoney(sessionDiscount));\n\t\t\tnewGrandTotal = formatAsMoney(newGrandTotal - sessionDiscount);\n\t\t}\n\n\t}\n\n\t// nonFood\n\tvar miscNonFoodSubtotal = Number($('#misc_nonfood_subtotal').val());\n\t$('#OEH_misc_nonfood_subtotal').html(formatAsMoney(miscNonFoodSubtotal));\n\tnewGrandTotal = Number((newGrandTotal * 1) + (miscNonFoodSubtotal * 1));\n\n\n\t// --------------------------------------------------------------------- tax\n\n\t// Currently the only taxed product is the enrollment fee which is taxed at a special rate\n\tvar newNonFoodTax = formatAsMoney(miscNonFoodSubtotal * (curNonFoodTax / 100 ));\n\tvar enrollmentTax = formatAsMoney(productsSubTotal * (curEnrollmentTax / 100 ));\n\tnewNonFoodTax *= 1; // convert to float\n\tnewNonFoodTax += (enrollmentTax * 1);\n\t//TODO: will have other products than enrollment someday.\n\tif (productsSubTotal)\n\t{\n\t\t$('#nonFoodTaxLabel').html('Non-Food & Enrollment Tax');\n\t}\n\telse\n\t{\n\t\t$('#nonFoodTaxLabel').html('Non-Food Tax');\n\t}\n\n\tvar newFoodTax = 0;\n\tvar newServiceTax = 0;\n\n\n\tif (curPPDiscount > 0)\n\t{\n\t\tnewFoodTax = formatAsMoney(((newGrandTotal + (curPPDiscount * 1) - miscNonFoodSubtotal - serviceFee - food_portion_of_points_credit) * (curFoodTax / 100 )) + .000001);\n\t\tnewServiceTax = formatAsMoney(((serviceFee -  fee_portion_of_points_credit) * (curServiceTax / 100 )) + .000001);\n\t}\n\telse\n\t{\n\t\tnewFoodTax = formatAsMoney(((newGrandTotal - miscNonFoodSubtotal - serviceFee) * (curFoodTax / 100 )) + .000001);\n\t\tnewServiceTax = formatAsMoney(serviceFee * (curServiceTax / 100 ) + .000001);\n\t}\n\n\ttaxElem = document.getElementById('OEH_tax_subtotal');\n\tif ( taxElem )\n\t\ttaxElem.innerHTML = formatAsMoney(newNonFoodTax);\n\n\ttaxElem = document.getElementById('OEH_food_tax_subtotal');\n\tif ( taxElem )\n\t\ttaxElem.innerHTML = formatAsMoney(newFoodTax);\n\n\ttaxElem = document.getElementById('OEH_service_tax_subtotal');\n\tif ( taxElem )\n\t\ttaxElem.innerHTML = formatAsMoney(newServiceTax);\n\n\tvar preTaxTotal = Number(newGrandTotal);\n\tnewGrandTotal = (newGrandTotal * 1) + (newFoodTax * 1) + (newNonFoodTax * 1) + (newServiceTax * 1);\n\n\t// -------------------------------------------------------------------- grand total\n\t$('#OEH_grandtotal').html(formatAsMoney(newGrandTotal));\n\t$('#OEH_new_total').html(formatAsMoney(newGrandTotal));\n\t$('#OEH_delta').html(formatAsMoney((orderInfoGrandTotal - newGrandTotal) * -1));\n\n\tvar paymentTotal = 0;\n\tif($('#OEH_paymentsTotal').length)\n\t{\n\t\tpaymentTotal = $('#OEH_paymentsTotal').html();\n\t}\n\n\tvar remainingBalance = Number(formatAsMoney(paymentTotal - newGrandTotal));\n\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance * -1));\n\n\t// Values are now calculated and the summary display updated\n\t// Next Display \"balance\" messages and set up payments\n\n\tif (orderState == 'CANCELLED')\n\t{\n\t\tremainingBalance = paymentTotal;\n\t\t$('#OEH_remaing_balance').html(formatAsMoney(remainingBalance));\n\n\t}\n\n\tif (remainingBalance > 0)\n\t{\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to the customer.\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_customer_owed');\n\t\t$(\"#newPaymentDiv\").hide();\n\n\t\tif (canAdjustDelayedPayment && currentDPAmount > 0)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#creditDiv').show();\n\t\t}\n\n\n\t\t$('#payment1_type').val('');\n\t\t$('#payment2_type').val('');\n\t\tchangePayment1('');\n\t\tchangePayment2('');\n\n\t\tpaymentChanges = true;\n\n\t\t$(\"#use_store_credits\").prop('checked', false);\n\t\t$(\"#use_store_credits\").prop('disabled', true);\n\n\t}\n\telse if (remainingBalance < 0)\n\t{\n\t\t$(\"#balance_msg\").html(formatAsMoney(remainingBalance * -1) + \" owed to your store.\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_store_owed');\n\t\t$(\"#newPaymentDiv\").show();\n\t\t$('#creditDiv').hide();\n\n\t\tif (canAdjustDelayedPayment)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').hide();\n\t\t}\n\n\t\t$(\"#use_store_credits\").prop('disabled', false);\n\n\n\t\tvar doNewLivePaymentAdjustments = true;\n\t\tif (doNewLivePaymentAdjustments)\n\t\t{\n\n\t\t\tvar defaultPaymentAmount = remainingBalance * -1;\n\n\t\t\tif ($(\"#use_store_credits\").is(\":checked\"))\n\t\t\t{\n\n\t\t\t\tvar amountStoreCredit = Number($(\"#store_credits_amount\").val());\n\t\t\t\tif (isNaN(amountStoreCredit.valueOf()))\n\t\t\t\t{\n\t\t\t\t\tamountStoreCredit = Number(0);\n\t\t\t\t}\n\n\t\t\t\tdefaultPaymentAmount -= amountStoreCredit.valueOf();\n\t\t\t}\n\n\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount);\n\n\t\t\tif ($('#payment1_type').val()  == 'CC')\n\t\t\t{\n\t\t\t\t$('#payment1_cc_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if ($('#payment1_type').val() == 'CHECK')\n\t\t\t{\n\t\t\t\t$('#payment1_check_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if ($('#payment1_type').val().split(\"_\")[0] == 'REF')\n\t\t\t{\n\t\t\t\t$('#payment1_ref_total_amount').val(defaultPaymentAmount);\n\t\t\t}\n\t\t\telse if (($('#payment1_type').val() == 'GIFT_CERT' || $('#payment1_type').val() == \"GIFT_CARD\") && $('#payment2_type').val() != \"\")\n\t\t\t{\n\t\t\t\tvar payment1Amount = null;\n    \t\t\tif ($('#payment1_type').val()  == 'GIFT_CERT')\n    \t\t\t{\n\t\t\t\t\tpayment1Amount = Number($('#payment1_gc_total_amount').val());\n    \t\t\t}\n    \t\t\telse if ($('#payment1_type').val() == 'GIFT_CARD')\n    \t\t\t{\n\t\t\t\t\tpayment1Amount = Number($('#debit_gift_card_amount').val());\n\t\t\t\t}\n\n\t\t\t\tif (isNaN(payment1Amount.valueOf()))\n\t\t\t\t{\n\t\t\t\t\tpayment1Amount = Number(0);\n\t\t\t\t}\n\n\t\t\t\tdefaultPaymentAmount = formatAsMoney(defaultPaymentAmount - payment1Amount.valueOf());\n    \t\t\tif ($('#payment2_type').val()  == 'CC')\n    \t\t\t{\n    \t\t\t\t$('#payment2_cc_total_amount').val(defaultPaymentAmount);\n    \t\t\t}\n    \t\t\telse if ($('#payment2_type').val() == 'CHECK')\n    \t\t\t{\n    \t\t\t\t$('#payment2_check_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n    \t\t\telse if ($('#payment2_type').val() == 'CASH')\n    \t\t\t{\n    \t\t\t\t$('#payment2_cash_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n    \t\t\telse if ($('#payment2_type').val().split(\"_\")[0] == 'REF')\n    \t\t\t{\n    \t\t\t\t$('#payment2_ref_total_amount').val(defaultPaymentAmount);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t}\n\telse // == 0\n\t{\n\t\t$(\"#balance_msg\").html(\"0.00\");\n\t\t$(\"#balanceRow\").addClass('balance_msg_balanced');\n\t\t$(\"#newPaymentDiv\").show();\n\t\t$('#creditDiv').hide();\n\n\t\tif (canAdjustDelayedPayment)\n\t\t{\n\t\t\t$('#dp_adjust_down_div').hide();\n\t\t}\n\n\t\t$(\"#use_store_credits\").prop('disabled', false);\n\n\t\tassignBalanceToRefTransactions(0);\n\t}\n\n\tif (newGrandTotal == 0 && $('#payment1_type').val() == \"\" && $('#payment2_type').val() == \"\" && !onTimeShotAtSupplyingZeroPaymentHasOccurred && orderState == 'SAVED')\n\t{\n\t\t$('#payment1_type').val('CASH');\n\t\tchangePayment1('CASH');\n\t\t$('#payment1_cash_total_amount').val(\"0.00\");\n\n\t\tonTimeShotAtSupplyingZeroPaymentHasOccurred = true;\n\t}\n\n\n\tvar autoAdjustDiv = $('#autoAdjustDiv');\n\tif \t(autoAdjustDiv.length)\n\t{\n\n\t\tif (remainingBalance != 0 && canAutoAdjust)\n\t\t{\n\t\t\tif (canAdjustDelayedPayment && (currentDPAmount > 0 || remainingBalance < 0))\n\t\t\t{\n\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>adjust customer's delayed payment.</b></span>\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (remainingBalance > 0)\n\t\t\t\t{\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>credit customer's credit card now.</b></span>\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#OEH_auto_pay_msg').html(\"Check this to <span id='adj_action'><b>charge original credit card now.</b></span>\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tautoAdjustDiv.show();\n\t\t\tif (!forceManualAutoAdjust)\n\t\t\t{\n\t\t\t\t$('#autoAdjust').prop('checked', true);\n\t\t\t\thandleAutoAdjust($('#autoAdjust').get()[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t    // if the div is hidden skip these steps\n\n\t\t    if (autoAdjustDiv.is(\":visible\"))\n\t\t    {\n\t\t\t\tautoAdjustDiv.hide();\n\t\t\t\t$('#autoAdjust').prop('checked', false);\n\t\t\t\t$('#payment1_type').val('');\n\t\t\t\t$('#payment2_type').val('');\n\t\t\t\tchangePayment1('');\n\t\t\t\tchangePayment2('');\n\t\t    }\n\t\t}\n\t}\n\n\t$('#help_msg').html(\"\");\n\n\t// enforce a few rules by disallowing checkout\n\tif ( $('#submit_changes').length )\n\t{\n\n\t\tif ( servings > 0 || sideDishQty > 0 || addonsSubtotal > 0)\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\n\t\t}\n\n\t\tif (directDiscountVal >= (Number(preTaxTotal) + Number(directDiscountVal)) && preTaxTotal != 0)\n\t\t{\n\t\t\t$('#submit_changes').prop(\"disabled\", true);\n\t\t\t$('#help_msg').html($('#help_msg').html() + \"You cannot use a Direct Order Discount that is equal to or greater than the new grand total. Please use the \\\"No Charge\\\" payment type to give away an order.\");\n\t\t}\n\n\t}\n\n\tif ($('#help_msg').length)\n\t{\n\t\tif ($('#help_msg').html() != \"\")\n\t\t{\n\t\t\t$('#help_msg').show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#help_msg').hide();\n\t\t}\n\t}\n\n\treportPaymentStatus(false);\n\n\tHideLineItemsIfZero();\n\n\tif (orderState != 'NEW')\n\t{\n\t\tupdateChangeList();\n\t}\n\n}"],"mappings":"AAAA,IAAIA,aAAc,EACdC,0BAA2B,EAC3BC,iBAAkB,EAClBC,kBAAmB,EACnBC,gBAAiB,EACjBC,8BAAgC,OAChCC,oCAAsC,OACtCC,WAAa,KACbC,mBAAoB,EACpBC,uBAAyB,EACzBC,uBAAwB,EACxBC,wBAAyB,EACzBC,sBAAuB,EACvBC,6CAA8C,EAC9CC,yCAA0C,EAC1CC,yBAA2B,EAE/B,SAASC,uBA6CR,GA1CIC,UAAYC,cAAcC,KAE7BD,cAAcC,GAAKF,UAOF,OAAdG,WAEHC,mBAEsB,SAAdD,WAERE,qBAIAC,sBAGGC,WAEHC,cAGDC,0BAEAC,iBAEkB,OAAdP,aAEHQ,iBAEAC,kCAEAC,oBAGDC,mBAEwC,QAApCC,iBAAiB,gBACrB,CAMC,IALA,IACIC,EADQC,OAAOC,SAASC,OAAOC,UAAU,GAC5BC,MAAM,KACnBC,EAAiB,IAEjBC,GAAQ,EACHC,EAAI,EAAGA,EAAIR,EAAKS,OAAQD,IACjC,CAGgB,gBADJR,EAAKQ,GAAGH,MAAM,KAChB,KAEHE,IAEJD,GAAkB,KAGnBA,GAAkBN,EAAKQ,IAGxBD,GAAQ,CACT,CAEAG,YAAY,CAACC,IAAKL,GACnB,CAEAM,mCACAC,sBACAC,4BAEAC,6BACAC,6BACD,CAEA,IAAIC,kBAAmB,EAEvB,SAASC,eAAeC,GAEnBlB,OAAOmB,SAAWH,kBAErBG,QAAQC,IAAI,uBAAyBF,EAEvC,CAEA,SAASG,0BAGR,IAAIC,EAAuBC,WAAWC,EAAE,qBAAqBC,OAE7DD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxB+C,QAASA,QACTC,GAAI,8BACJC,SAAUA,SACVZ,qBAAsBA,GAEvBa,QAAS,SAAUC,GAEdA,EAAKC,kBAERC,+BAKArB,eAAe,4BAA8BmB,EAAKG,mBAClDC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhC3B,eAAe,4BAA8B2B,EAAW,MAAQD,EAAeE,cAC/EC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAEF,CAEA,SAASnC,mCAERa,EAAE,+CAA+CuB,MAAK,WAGrDvB,EAAEwB,MAAMC,GAAG,SAAS,SAAUC,GAG7B,IAAIC,EAAa3B,EAAEwB,MAAMlB,KAAK,cAC1BE,EAAUR,EAAEwB,MAAMlB,KAAK,WACvBsB,EAAQ,MACR9B,EAAuB,GAEM,GAA7BE,EAAEwB,MAAMlB,KAAK,eAEhBsB,EAAQ,OAER9B,EAAuBC,WAAWC,EAAE,gCAAkC2B,EAAa,eAAe1B,QAGnGD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXE,GAAI,8BACJoB,GAAMD,EACNrE,SAAUC,cAAcC,GACxB+C,QAASA,EACTE,SAAUA,SACVoB,KAAMhC,GAEPa,QAAS,SAAUC,GAElB,GAAIA,EAAKC,kBAER,GAAa,OAATe,EACJ,CACC,IAAIG,EAAgB/B,EAAE,yBAAyBgC,SAAS,gBAAgB/B,IAAKW,EAAKqB,yBAA2BrB,EAAKqB,yBAA2B,IAAKR,GAAG,SAAS,SAAUC,GAGnK1B,EAAEwB,MAAMvB,OAASF,WAAWC,EAAEwB,MAAMvB,QAEvCD,EAAEwB,MAAMvB,IAAIF,WAAWC,EAAEwB,MAAMvB,OAGjC,IAEAD,EAAE,gCAAkC2B,GAAYK,SAAS,iCAAiCE,KAAKH,GAE/F/B,EAAE,uCAAyC2B,GAAYrB,KAAK,aAAa,GAAM4B,KAAK,aAEpFlC,EAAE,8CAAgD2B,GAAYrB,KAAK,iCAAmCM,EAAKqB,yBAA2BrB,EAAKqB,yBAA2B,IAAKR,GAAG,SAAS,SAAUC,GAGhM1B,EAAE,gCAAkCA,EAAEwB,MAAMlB,KAAK,eAAe6B,YAAY,iCAAiCD,KAAKlC,EAAEwB,MAAMlB,KAAK,mCAE/HN,EAAE,uCAAyCA,EAAEwB,MAAMlB,KAAK,eAAeA,KAAK,aAAa,GAAO4B,KAAK,wBAErGlC,EAAEwB,MAAMY,MAET,IAAGC,MACJ,MAGCrC,EAAE,gCAAkC2B,GAAYQ,YAAY,iCAAiCD,KAAKI,MAAM1B,EAAKqB,2BAE7GjC,EAAE,8CAAgD2B,GAAYS,OAE9DpC,EAAE,uCAAyC2B,GAAYrB,KAAK,aAAa,GAAO4B,KAAK,uBAGxF,EACAhB,MAAO,SAAUC,EAAgBC,GAEhC3B,eAAe,qCAAuC2B,EAAW,MAAQD,EAAeE,cACxFC,SAAW,kBACZ,GAGF,GAED,GACD,CAEA,IAAIiB,0BAA4B,KAEhC,SAASlE,mBAERmE,SAASC,WAAaC,oBAEtB1C,EAAE,gBAAgByB,GAAG,YAAY,SAAUkB,GAM1C,OAAgB,MAHhBA,EAAM,GAAcC,OACQ,SAAID,EAAIE,SAAaF,EAAS,MAAIA,EAAIG,MAAQH,EAAII,WAI7EC,cACAL,EAAIM,mBACG,EAIT,IAEAjD,EAAE,qBAAqByB,GAAG,YAAY,SAAUkB,GAG/C,OADAA,EAAIM,mBACG,CACR,IAEAjD,EAAE,+BAA+ByB,GAAG,SAAS,SAAUkB,GAatD,OAV4B,IAAxB3C,EAAEwB,MAAMvB,MAAMjB,QAAiBkE,MAAMlD,EAAEwB,MAAMvB,QAAUD,EAAEwB,MAAMvB,OAASsC,2BAE3EvB,WAAW,CACVC,MAAO,UACPvB,QAAS,oKAIX6C,0BAA4BvC,EAAEwB,MAAMvB,OAE7B,CACR,GAED,CAEA,SAASyC,oBAAoBC,GAO5B,OAAgB,MAHhBA,EAAM,GAAcC,OACQ,SAAID,EAAIE,SAAaF,EAAS,MAAIA,EAAIG,MAAQH,EAAII,QAS/E,CAEA,SAAS9E,iBAER+B,EAAE,kBAAkByB,GAAG,SAAS,WAG/B,IAAIS,EAAOiB,oBAENjB,GAAgB,IAARA,IAEZA,EAAO,8BAGRlB,WAAW,CACVC,MAAO,cACPvB,QAASwC,EACTkB,OAAQ,IACRC,MAAO,IACPC,OAAO,EACPC,OAAQ,aACRC,YAAa,cACbC,MAAM,EACNC,SAAU,CACTC,GAAI,WACJC,GAAI,cACJC,GAAIrC,MAELsC,MAAO,SAAUlB,EAAOmB,GAEvB/D,EAAE,eAAegE,QAClB,GAEF,GACD,CAEA,SAAShG,0BAERgC,EAAE,0CAA0CyB,GAAG,SAAS,WAGvD,IAAIwC,EAAWzC,KAAK/D,GAChByG,EAAWlE,EAAEwB,MACjB,GAAkB,UAAd9D,WAEHsD,WAAW,CACVC,MAAO,QACPvB,QAAS,sDAKX,CACC,IAAIyE,EAAW,MACXnE,EAAEwB,MAAM4C,GAAG,cAEdD,EAAW,MAGZ,IAAIE,EAAW,EACC,MAAZF,IAEHE,EAAW,GAGZrD,WAAW,CACVC,MAAO,gBACPvB,QAAS,oDACT4E,OAAQ,WAEPJ,EAASK,KAAK,YAAWF,EAE1B,EACAG,QAAS,WAERxE,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxB+C,QAASA,QACTC,GAAI,qBACJC,SAAUA,SACV+D,KAAMR,EACNS,UAAWP,GAEZxD,QAAS,SAAUC,GAEdA,EAAKC,kBAERG,WAAW,CACVC,MAAO,iBACPvB,QAASkB,EAAKG,qBAMftB,eAAe,uBAAyBmB,EAAKG,mBAE7Cf,EAAEwB,MAAMmD,KAAK,UAAWN,GAExBrD,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAGhC3B,eAAe,uBAAyB2B,EAAW,MAAQD,EAAeE,cAE1ErB,EAAEwB,MAAMmD,KAAK,UAAWN,GAExB/C,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAIF,GAEF,CACD,GACD,CAEA,SAASsD,uBAGR5E,EAAE,gBAAgBuB,MAAK,WAEtBvB,EAAEwB,MAAMlB,KAAK,YAAaN,EAAEwB,MAAMvB,MACnC,IAEAD,EAAE,+BAA+BuB,MAAK,WAErCvB,EAAEwB,MAAMlB,KAAK,YAAaN,EAAEwB,MAAMvB,MACnC,IAEAD,EAAE,mBAAmBM,KAAK,YAAaN,EAAE,mBAAmBoE,GAAG,YAAc,IAAM,KAE/ES,cAAgBC,aAEnB9E,EAAE,gBAAgBuB,MAAK,WAEtBvB,EAAEwB,MAAMlB,KAAK,YAAaN,EAAEwB,MAAMvB,MACnC,IAIAD,EAAE,gBAAgBuB,MAAK,WAEtBvB,EAAEwB,MAAMlB,KAAK,YAAaN,EAAEwB,MAAM4C,GAAG,YAAc,IAAM,IAC1D,IAGDW,kBAED,CAEA,SAASC,UAERC,WAAU,EACX,CAEA,SAASA,UAAUC,GAKlB,GAFAzF,eAAe,sBAEXvC,qBAEHiI,SAAS,CACRzF,QAAS,8BACTgE,SAAU,kBAJZ,CASAyB,SAAS,CACRzF,QAAS,cACTgE,SAAU,cAGX,IAAI0B,EAAY,CAAC,EACbC,EAAiB,CAAC,EAClBC,EAAe,CAAC,EAEhBC,EAAW,QAEXV,cAAgBC,cAEnB9E,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCwG,EAAUI,GAAWxF,EAAEwB,MAAMvB,KAC9B,CACD,IAGAD,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCwG,EAAUI,GAAWxF,EAAEwB,MAAMvB,KAC9B,CACD,MAMID,EAAE,mBAAmBoE,GAAG,cAG3BmB,EAAW,OAEXvF,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAM4C,GAAG,YACf,CACC,IAAIoB,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCyG,EAAeG,GAAW,IAC3B,CACD,KAIDxF,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCwG,EAAUI,GAAWxF,EAAEwB,MAAMvB,KAC9B,CACD,IAEAD,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjC0G,EAAaE,GAAWxF,EAAEwB,MAAMvB,KACjC,CACD,KAID,IAAIwF,EAAqBzF,EAAE,uBAAuBC,MAC9CiD,MAAMuC,KAETA,EAAqB,QAGtB,IAAIC,EAAwB1F,EAAE,0BAA0BC,MACpDiD,MAAMwC,KAETA,EAAwB,QAGzB,IAAIC,EAAuB3F,EAAE,yBAAyBC,MAClDiD,MAAMyC,KAETA,EAAuB,QAGxB,IAAIC,EAA0B5F,EAAE,4BAA4BC,MACxD4F,EAA6B7F,EAAE,+BAA+BC,MAC9D6F,EAA0B9F,EAAE,4BAA4BC,MAExDH,EAAuBE,EAAE,qBAAqBC,MAElD/C,sBAAuB,EAEvB8C,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxB+C,QAASA,QACTC,GAAI,eACJC,SAAUA,SACVqF,MAAOX,EACPK,mBAAoBA,EACpBC,sBAAuBA,EACvBC,qBAAsBA,EACtBC,wBAAyBA,EACzBC,2BAA4BA,EAC5BC,wBAAyBA,EACzBP,SAAUA,EACVS,YAAaX,EACbY,UAAWX,EACXxF,qBAAsBA,GAEvBa,QAAS,SAAUC,GAEdA,EAAKC,mBAERqF,gBAAiB,EACjBtB,uBAEA1H,sBAAuB,EAEvBuC,eAAe,0BAEXyF,GAEHiB,eAAc,KAKfjJ,sBAAuB,EAEvBuC,eAAe,iBAAmBmB,EAAKG,mBAEvCC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAGhClE,sBAAuB,EACvBuC,eAAe,iBAAmB2B,EAAW,MAAQD,EAAeE,cAEpEC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAzKD,CA4KD,CAEA,SAAS8E,kBAAkBC,GAG1B5G,eAAe,8BAEf6G,uBAAuB,aAAc,oCAErCtG,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,uBACJ4F,WAAYA,EACZ7F,QAASA,QACT+F,cAAevG,EAAE,4BAA6B,eAAeC,OAE9DU,QAAS,SAAUC,GAEdA,EAAKC,mBAGRpB,eAAe,kCAEXmB,EAAK4F,8BAERC,OAAO,gCAAkC7F,EAAKF,SAAW,sBAIzD+F,OAAO,gCAAkC7F,EAAKF,YAM/CV,EAAE,eAAegE,SACjBhE,EAAE,4BAA6B,eAAeC,IAAIW,EAAK8F,eAEvDjH,eAAe,yBAA2BmB,EAAKG,mBAE/CC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,yBAA2B2B,EAAW,MAAQD,EAAeE,cAE5EC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAGF,CAEA,SAASqF,WAAWC,GAGnBnH,eAAe,uBAEfO,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,aACJ4F,WAAYA,WACZ7F,QAASA,QACTE,SAAUA,SACVmG,iBAAkBA,iBAClBD,eAAgBA,GAEjBjG,QAAS,SAAUC,GAEdA,EAAKC,mBAGRpB,eAAe,2BAEf4G,WAAazF,EAAKkG,eAClB9G,EAAE,mBAAmBkC,KAAKtB,EAAKmG,kBAE/BC,iBAAiB,GAEZpG,EAAKqG,gBAMTjH,EAAE,0BAA0BkH,WAJ5BlH,EAAE,0BAA0BmH,WAOzBvG,EAAKwG,kBAERpH,EAAE,yBAAyBoC,OAC3BpC,EAAE,2BAA2BqC,OAC7BrC,EAAE,4BAA4BkC,KAAKtB,EAAKwG,iBAAiBjH,MACzDH,EAAE,6BAA6BkC,KAAKtB,EAAKwG,iBAAiBC,OAC1DC,sBAAsB7J,GAAKmD,EAAKwG,iBAAiB3J,GACjD6J,sBAAsBnH,KAAOS,EAAKwG,iBAAiBjH,KACnDmH,sBAAsBD,MAAQzG,EAAKwG,iBAAiBC,QAKpDrH,EAAE,yBAAyBqC,OAC3BrC,EAAE,2BAA2BoC,OAC7BkF,sBAAsB7J,GAAK,EAC3B6J,sBAAsBnH,KAAO,OAC7BmH,sBAAsBD,MAAQ,GAI/BrH,EAAE,uBAAuBkC,KAAKtB,EAAK2G,aAAaC,mBAChDxH,EAAE,iCAAiCkC,KAAKtB,EAAK2G,aAAaE,iBAC1DzH,EAAE,sCAAsCkC,KAAKtB,EAAK2G,aAAaG,wBAEjC,GAA1B9G,EAAK+G,mBAKR3H,EAAE,yBAAyBC,IAAI2H,cAAchH,EAAK+G,mBAClD3H,EAAE,4BAA4BC,IAAIW,EAAKiH,sBACvC3J,oBAODuB,eAAe,eAAiBmB,EAAKG,mBAErCC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCE,SAAW,qBAAuBF,EAElC3B,eAAe,eAAiB2B,EAAW,MAAQD,EAAeE,cAElEL,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAGF,CAEA,SAASwG,oBAAoBC,GAM5B,OAJAtI,eAAe,gCAGf2G,kBADiBpG,EAAE,qBAAqB2E,KAAK,qBAEtC,CACR,CAEA,SAASqD,cAKR,OAHAvI,eAAe,wBAEfwF,aACO,CAER,CAEA,SAAStH,mBAERsK,sBACA,IAAIC,EAAY5J,iBAAiB,SAC5B4J,IAEJA,EAAY,KAEblB,iBAAiBkB,GACjBlI,EAAE,0BAA0BqC,MAE7B,CAEA,SAASzE,qBAERoC,EAAE,0BAA0BqC,OAExBrC,EAAE,iBAAiBhB,SAEtBrC,8BAAgCqD,EAAE,iCAAkC,eAAeC,OAGhFD,EAAE,YAAYhB,SAEjBpC,oCAAsCoD,EAAE,4BAA6B,eAAeC,MAEtF,CAEA,SAASpC,sBAEJsK,iBAAiBC,iBAEpBpI,EAAE,oBAAoBqI,QAEtBrI,EAAE,iBAAiBgC,SAAS,YAC5BhC,EAAE,oBAAoBgC,SAAS,YAC/BhC,EAAE,iBAAiBsI,KAAK,UAAU/D,KAAK,YAAY,GACnDvE,EAAE,iBAAiBsI,KAAK,KAAKtG,SAAS,gBAIvChC,EAAE,0BAA0BoC,OAExBpC,EAAE,iBAAiBhB,SAEtBrC,8BAAgCqD,EAAE,iCAAkC,eAAeC,OAGhFD,EAAE,YAAYhB,SAEjBpC,oCAAsCoD,EAAE,4BAA6B,eAAeC,MAGtF,CAEA,SAASsI,uBAERvB,iBAAiB,EAClB,CAEA,SAASwB,yBAER,OAAO,CACR,CAEA,SAASC,qBAET,CAEA,SAASC,uBAmBR,MAjBkB,UAAdhL,YAECwI,gBAWHjB,aAIK,CACR,CAEA,SAAS0D,uBAERrJ,4BACD,CAEA,SAASsJ,yBAOR,MALkB,UAAdlL,aAA2BlB,iBAAmBC,mBAEjD0J,eAAc,IAGR,CACR,CAEA,SAAS0C,6BAEH5L,yBAGJwC,eAAe,0BAEfO,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,0BACJ4F,WAAYA,WACZ3F,SAAUA,SACVF,QAASA,SAEVG,QAAS,SAAUC,GAGlBnB,eAAe,qCAEfO,EAAE,mBAAmBkC,KAAKtB,EAAKN,MAC/BN,EAAE,2BAA2BgE,SAC7B/G,wBAAyB,CAC1B,EACAiE,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,2BAA2BgE,SAE7BvE,eAAe,4BAA8B2B,EAAW,MAAQD,EAAeE,cAE/EC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,IAKH,CAEA,SAASwH,+BAER,OAAO,CACR,CAEA,SAASC,qBAER/I,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,cACJ4F,WAAYA,WACZ7F,QAASA,QACTE,SAAUA,UAEXC,QAAS,SAAUC,GAElBZ,EAAE,gBAAgBkC,KAAKtB,EAAKsB,MAE5B8G,6BAEAC,+BAEAC,0BACD,EACAhI,MAAO,SAAUC,EAAgBC,GAEhCE,SAAW,qBAAuBF,EAElC3B,eAAe,gBAAkB2B,EAAW,MAAQD,EAAeE,cAEnEL,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAIF,CAEA,SAAS6H,uBAER,OAAO,CACR,CAEA,SAASC,oBAEU,UAAd1L,YAEHsC,EAAE,gCAAgC2E,KAAK,YAAY,GACnDjI,gBAAiB,EACjBqI,qBAIArI,gBAAiB,EACjBqI,mBAEF,CAEA,SAASsE,sBAcR,MAZkB,UAAd3L,YAEHsC,EAAE,gCAAgC2E,KAAK,YAAY,GACnDI,mBACArI,gBAAiB,IAIjBA,gBAAiB,EACjBqI,qBAGM,CAER,CAEA,SAASuE,yBAGT,CAEA,SAASC,2BAER,OAAO,CACR,CAEA,SAASC,0BAEJxJ,EAAE,iBAAiBhB,SAEtBrC,8BAAgCqD,EAAE,iCAAkC,eAAeC,OAGhFD,EAAE,YAAYhB,SAEjBpC,oCAAsCoD,EAAE,4BAA6B,eAAeC,OAGrFD,EAAE,kBAAkBC,IAAID,EAAE,cAAcC,OAExCD,EAAE,kDAAkDuB,MAAK,WAExDvB,EAAEwB,MAAMlB,KAAK,YAAaN,EAAEwB,MAAMvB,MACnC,IAEA8E,kBAED,CAEA,SAAS0E,kBAAkBC,EAAiBC,GAE3ClK,eAAe,8BAEf,IAAI2F,EAAY,CAAC,EACbC,EAAiB,CAAC,EAClBC,EAAe,CAAC,EAEhBC,EAAW,QAEXV,cAAgBC,cAEnB9E,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCwG,EAAUI,GAAWxF,EAAEwB,MAAMvB,KAC9B,CACD,IAGAD,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCwG,EAAUI,GAAWxF,EAAEwB,MAAMvB,KAC9B,CACD,MAMID,EAAE,mBAAmBoE,GAAG,cAG3BmB,EAAW,OAEXvF,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAM4C,GAAG,YACf,CACC,IAAIoB,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCyG,EAAeG,GAAW,IAC3B,CACD,KAIDxF,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjCwG,EAAUI,GAAWxF,EAAEwB,MAAMvB,KAC9B,CACD,IAEAD,EAAE,cAAcuB,MAAK,WAGpB,GAAIvB,EAAEwB,MAAMvB,MAAQ,EACpB,CACC,IAAIuF,EAAUhE,KAAK/D,GAAGmB,MAAM,KAAK,GACjC0G,EAAaE,GAAWxF,EAAEwB,MAAMvB,KACjC,CACD,KAID,IAAIwF,EAAqBzF,EAAE,uBAAuBC,MAC9CiD,MAAMuC,KAETA,EAAqB,QAGtB,IAAIC,EAAwB1F,EAAE,0BAA0BC,MACpDiD,MAAMwC,KAETA,EAAwB,QAGzB,IAAIC,EAAuB3F,EAAE,yBAAyBC,MAClDiD,MAAMyC,KAETA,EAAuB,QAGxB,IAAIC,EAA0B5F,EAAE,4BAA4BC,MACxD4F,EAA6B7F,EAAE,+BAA+BC,MAC9D6F,EAA0B9F,EAAE,4BAA4BC,MAExD2J,EAAwB5J,EAAE,0BAA0BC,MACpDiD,MAAM0G,KAETA,EAAwB,QAGzB,IAAIC,EAAa7J,EAAE,0BAA2B,eAAeC,MAE3C,MAAd4J,GAAoC,IAAdA,IAEzBA,EAAa,QAGd,IAAIC,EAAwB9J,EAAE,0BAA0BC,MACpDiD,MAAM4G,KAETA,EAAwB,QAGzB,IAAIC,EAAkB/J,EAAE,+BAAgC,eAAeC,MAEhD,MAAnB8J,GAA8C,IAAnBA,IAE9BA,EAAkB,QAGnB,IAAIC,EAAW,EACf,GAAIhK,EAAE,uBAAuBhB,OAC7B,CACC,IAAIiL,EAAgBjK,EAAE,uBAAuBC,MACzCgK,EAAgB,IAEnBD,EAAWC,EAEb,CAEAjK,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxB+C,QAASA,QACTC,GAAI,sBACJC,SAAUA,SACVqF,MAAOX,EACPK,mBAAoBA,EACpBC,sBAAuBA,EACvBC,qBAAsBA,EACtBC,wBAAyBA,EACzBC,2BAA4BA,EAC5BC,wBAAyBA,EACzBP,SAAUA,EACVS,YAAaX,EACbY,UAAWX,EACXsE,sBAAuBA,EACvBC,WAAYA,EACZC,sBAAuBA,EACvBC,gBAAiBA,EACjBG,oBAAqBF,EACrBnN,WAAYsN,KAAKC,UAAUvN,YAC3BwN,cAAelH,oBACfoD,cAAevG,EAAE,4BAA6B,eAAeC,OAG9DU,QAAS,SAAUC,GAEdA,EAAKC,mBAERpB,eAAe,kCAEfyG,gBAAiB,EACjBtB,uBACA4E,0BAEIE,GAEHY,wBAAwBZ,EAAiBC,EAAe/I,EAAK8F,iBAK9DjH,eAAe,wBAA0BmB,EAAKG,mBAE9CC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAGhC3B,eAAe,wBAA0B2B,EAAW,MAAQD,EAAeE,cAE3EC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAEX,GAEF,CAEA,SAASiJ,sBAGR,OAAIC,4BAEIC,gBAAgB,CAACzK,EAAE,0BAA0B0K,IAAI,IAI1D,CAEA,SAASvE,cAAcuD,GAItB,GAFAjK,eAAe,2BAEV8K,sBAEJ,OAAO,EAGHb,GAEJvE,SAAS,CACRzF,QAAS,kBACTgE,SAAU,cAIZ,IAAIkG,EAAwB5J,EAAE,0BAA0BC,MACpDiD,MAAM0G,KAETA,EAAwB,QAGzB,IAAIC,EAAa7J,EAAE,0BAA2B,eAAeC,MAE3C,MAAd4J,GAAoC,IAAdA,IAEzBA,EAAa,QAGd,IAAIC,EAAwB9J,EAAE,0BAA0BC,MACpDiD,MAAM4G,KAETA,EAAwB,QAGzB,IAAIC,EAAkB/J,EAAE,+BAAgC,eAAeC,MAEhD,MAAnB8J,GAA8C,IAAnBA,IAE9BA,EAAkB,QAGnB,IAAIC,EAAW,EACf,GAAIhK,EAAE,uBAAuBhB,OAC7B,CACC,IAAIiL,EAAgBjK,EAAE,uBAAuBC,MACzCgK,EAAgB,IAEnBD,EAAWC,EAEb,CAEA,IAAIU,EAAY,EACZC,EAAwB,EACxB5K,EAAE,cAAcC,QAEfuK,4BAECxK,EAAE,0BAA0BC,QAE/B2K,EAAwB5K,EAAE,0BAA0BC,OAItD0K,EAAY3K,EAAE,cAAcC,OAG7B,IAAI4K,EAAgB7K,EAAE,kBAAkBC,MACpC6K,EAAmB9K,EAAE,qBAAqBC,MAE9CD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,mBACJC,SAAUA,SACVF,QAASA,QACToJ,sBAAuBA,EACvBC,WAAYA,EACZC,sBAAuBA,EACvBC,gBAAiBA,EACjBY,UAAWA,EACXC,sBAAuBA,EACvBV,oBAAqBF,EACrBa,cAAeA,EACfC,iBAAkBA,GAGnBnK,QAAS,SAAUC,GAEdA,EAAKC,mBAERpB,eAAe,8BAEf+J,0BACAuB,2BAEIH,IAEH5K,EAAE,0BAA0B2E,KAAK,YAAY,GAC7CqG,mBAAqBJ,GAGlBlB,GAEHY,yBAAwB,GAAO,EAAM1J,EAAKqK,gBAK3CxL,eAAe,qBAAuBmB,EAAKG,mBAE3CC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAGhC3B,eAAe,qBAAuB2B,EAAW,MAAQD,EAAeE,cAExEC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAGF,CAGA,SAASyJ,2BAER/K,EAAE,kBAAkBM,KAAK,YAAaN,EAAE,kBAAkBC,OAC1DD,EAAE,qBAAqBM,KAAK,YAAaN,EAAE,qBAAqBC,OAEhE8E,kBACD,CAEA,SAASmG,KAAKC,EAAOC,EAAeC,EAA2CC,EAAS3B,EAAe4B,GAGtG9L,eAAe,8BAAgC2L,GAE/CpL,EAAE,kBAAkByB,GAAG,QAAQ,WAG9BhC,eAAe,yBAEf,IAEC,IAAI+L,EAAYxL,EAAE,kBAAkB0K,IAAI,GAAGe,cAAcD,UACrD7K,EAAUX,EAAE,kBAAkB0K,IAAI,GAAGe,cAAcC,UAExD,CACA,MAAOhK,GAYN,OATAjC,eAAe,8CAEfO,EAAE,eAAegE,cAEjBhD,WAAW,CACVC,MAAO,YACPvB,QAAS,iHAIX,CAMA,GAAIiB,EAEHlB,eAAe,2BAEfgH,OAAO+E,OAGR,CACC,IAAIG,EAAa3L,EAAE,kBAAkB0K,IAAI,GAAGe,cAAcE,WACtDjM,EAAUM,EAAE,kBAAkB0K,IAAI,GAAGe,cAAc/L,QAIvD,GAFAD,eAAe,2BAA6BkM,EAAa,MAAQjM,QAExC,IAAdiM,EAEVA,EAAa,UACbjM,EAAU,oGAEVD,eAAe,kCAEfO,EAAE,eAAegE,SAEjBhD,WAAW,CACVC,MAAO,UAAY0K,EACnBjM,QAASA,SAIN,GAAI8L,GAAaA,EAAUxM,OAAS,EAGxCgB,EAAE,eAAegE,SAEjBhD,WAAW,CACVC,MAAO,UAAY0K,EACnBjM,QAASA,EACT+D,MAAM,EACNmI,QAAS,CACRC,KAAQ,WAEPpF,OAAO+E,EACR,SAKH,CACCxL,EAAE,eAAegE,SAEJhE,EAAE,kBAAkB0K,IAAI,GAAGe,cAAcK,iBAKrDrM,eAAe,8CAEfC,GAAW,8JAEXsB,WAAW,CACVC,MAAO,UAAY0K,EACnBjM,QAASA,EACT+D,MAAM,EACNmI,QAAS,CACRC,KAAQ,WAEPpF,OAAOjI,OAAOC,SAASsN,KACxB,MAMF/K,WAAW,CACVC,MAAO,UAAY0K,EACnBjM,QAASA,GAIZ,CAED,CACD,IAEA,IAAIsM,EAAkB,IAAIC,gBAQ1B,GANAD,EAAgBE,iBAAiB,SAAU1L,SAC3CwL,EAAgBE,iBAAiB,UAAW1O,cAAcC,IAC1DuO,EAAgBE,iBAAiB,UAAWxL,UAE5CsL,EAAgBE,iBAAiB,QAASC,YAErB,GAAjBf,EACJ,CACC,IAAIgB,EAAUpM,EAAE,qBAAqBC,MACrCmM,GAAWpM,EAAE,oBAAoBC,MACjC,IAAIoM,EAAMrM,EAAE,8BAA8BC,MACtCqM,EAAMtM,EAAE,6BAA6BC,OAErCsM,EAAU,IAAIN,iBAEVC,iBAAiB,gBAAiBM,aAAa/O,IACvD8O,EAAQL,iBAAiB,UAAW1L,SACpC+L,EAAQL,iBAAiB,WAAY1O,cAAcC,IACnD8O,EAAQL,iBAAiB,WAAYxL,UACrC6L,EAAQL,iBAAiB,YAAa,gBAClCZ,GAEHiB,EAAQL,iBAAiB,WAAY,QAElCvC,GAEH4C,EAAQL,iBAAiB,gBAAiB,QAE3CK,EAAQL,iBAAiB,oBAAqB,SAE9C,IACIO,EAAsB,EACtBzM,EAAE,sBAAsBhB,QAEvBgB,EAAE,sBAAsBoE,GAAG,cAE9BqI,EAAsBzM,EAAE,yBAAyBC,MACjDsM,EAAQL,iBAAiB,SAAU,QACnCK,EAAQL,iBAAiB,SAAUO,IAIrC,IAAIC,EAAW,EACf,GAAI1M,EAAE,kEAAkEhB,SAEvE0N,EAAW1M,EAAE,0FAA0FC,OAExF,EACf,CACCsM,EAAQL,iBAAiB,WAAYQ,GACrCH,EAAQL,iBAAiB,aAAcI,GAGvC,IAAIK,EAAgB,GAMpB,GALgB,GAAZD,GAAiBE,wBAA0BA,uBAAyB,KAEvED,EAAgBC,wBAGP,EAANN,GAA2B,EAAhBK,EAMd,YAJA3L,WAAW,CACVC,MAAO,wBACPvB,QAAS,oGAKX4M,EAAMK,CAEP,CAG6B,oBAAnBE,kBAEVA,gBAAkB,wEAInB,IAAIC,EAAW,YAAcD,gBAAkB,SAAW7M,EAAE,sBAAsBC,MAAQ,YAAcmM,EAAU,QAAUC,EAAM,QAAUC,EAAM,UAAYC,EAAQQ,wBAA0B,aAAef,EAAgBe,uBAChO,KAEA,CACKX,EAAUpM,EAAE,qBAAqBC,MACrCmM,GAAWpM,EAAE,oBAAoBC,MACjC,IAGIsM,EAHAF,EAAMrM,EAAE,8BAA8BC,MACtCqM,EAAMtM,EAAE,6BAA6BC,MAezC,IAbIsM,EAAU,IAAIN,iBAEVC,iBAAiB,UAAW1L,SACpC+L,EAAQL,iBAAiB,WAAY1O,cAAcC,IACnD8O,EAAQL,iBAAiB,WAAYxL,UACrC6L,EAAQL,iBAAiB,YAAa,gBACtCK,EAAQL,iBAAiB,WAAY,SACrCK,EAAQL,iBAAiB,oBAAqB,QAC1CvC,GAEH4C,EAAQL,iBAAiB,gBAAiB,QAGvCX,EAIH,IAAK,IAAIyB,KAFTT,EAAQL,iBAAiB,eAAe,GAExBX,EAEXA,EAAa0B,eAAeD,IAE/BT,EAAQL,iBAAiB,MAAQc,EAAKzB,EAAayB,IAKlDN,EAAW,EACf,GAAI1M,EAAE,kEAAkEhB,SAEvE0N,EAAW1M,EAAE,0FAA0FC,OAExF,EACf,CACCsM,EAAQL,iBAAiB,WAAYQ,GACrCH,EAAQL,iBAAiB,aAAcI,GAEnCK,EAAgB,GAOpB,GANgB,GAAZD,GAAiBE,wBAA0BA,uBAAyB,KAEvED,EAAgBC,wBAIP,EAANN,GAA2B,EAAhBK,EAMd,YAJA3L,WAAW,CACVC,MAAO,wBACPvB,QAAS,oGAKX4M,EAAMK,CAEP,CAG6B,oBAAnBE,kBAEVA,gBAAkB,wEAIfC,EAAW,YAAcD,gBAAkB,SAAW7M,EAAE,sBAAsBC,MAAQ,YAAcmM,EAAU,QAAUC,EAAM,QAAUC,EAAM,UAAYC,EAAQQ,wBAA0B,aAAef,EAAgBe,uBAChO,CAEA,IAAIG,EAAY,iCAChB,GAA4B,oBAAjBC,eAAgCA,cAEtCD,EAAY,uCAGuB,oBAA7BE,4BAEVF,EAAYE,2BAGb3N,eAAe,sBAGf4N,uBAAuB,CACtBC,OAAQJ,EACRK,OAAQ,gBACRC,MAAO,CACNC,YAAatC,EAAMA,MACnBuC,cAAevC,EAAMwC,QACrBC,SAAUd,IAIb,CAEA,SAASe,eAAe1N,EAAM2N,GAG7B,GAAY,MAAR3N,EAEH,IAAI4N,EAAc,CACjB5N,KAAMA,EACN6N,OAAQ,EACRC,OAAQ,EACRC,UAAW,GACXpM,KAAM9B,EAAE,iBAAiBC,YAKtB8N,EAAc,CACjB5N,KAAMA,EACN6N,OAAQ,EACRC,OAAQ,EACRC,UAAW,GACXpM,KAAM9B,EAAE,iBAAiBC,MACzBkO,aAAc,GACdC,OAAQ,KACRC,QAAS,GACTC,OAAQ,GACRC,iBAAkB,GAClBC,gBAAiB,GACjBC,oBAAqB,GACrBC,oDAAqD,EACrDC,WAAY,GAId,GAAsB,GAAlBb,EACJ,CACC,OAAQ3N,GAEP,IAAK,YACJ4N,EAAYE,OAASjO,EAAE,oCAAoCC,MAC3D,MAED,IAAK,YACJ8N,EAAYE,OAASjO,EAAE,6BAA6BC,MACpD8N,EAAYG,UAAYlO,EAAE,4BAA4BC,MACtD8N,EAAYC,OAAShO,EAAE,+BAA+BC,MACtD,MAED,IAAK,OACJ8N,EAAYE,OAASjO,EAAE,+BAA+BC,MACtD8N,EAAYC,OAAShO,EAAE,iCAAiCC,MACxD,MAED,IAAK,cACJ8N,EAAYE,OAASjO,EAAE,sCAAsCC,MAC7D8N,EAAYC,OAAShO,EAAE,wCAAwCC,MAC/D,MAED,IAAK,QACJ8N,EAAYE,OAASjO,EAAE,gCAAgCC,MACvD8N,EAAYC,OAAShO,EAAE,kCAAkCC,MACzD,MAED,IAAK,SACJ8N,EAAYE,OAASjO,EAAE,wBAAwBkC,OAC/C,MAED,IAAK,KACJ6L,EAAYE,OAASjO,EAAE,6BAA6BC,MACpD8N,EAAYC,OAAShO,EAAE,sBAAsBC,MAC7C8N,EAAYI,aAAenO,EAAE,0BAA0BC,MACvD8N,EAAYK,OAASpO,EAAE,oBAAoBC,MAC3C8N,EAAYM,QAAUrO,EAAE,qBAAqBC,MAC7C8N,EAAYO,OAAStO,EAAE,oBAAoBC,MAC3C8N,EAAYQ,iBAAmBvO,EAAE,8BAA8BC,MAC/D8N,EAAYS,gBAAkBxO,EAAE,sBAAsBC,MACtD8N,EAAYU,oBAAsBzO,EAAE,0BAA0BC,MAE9D,IAAI2O,EAAY5O,EAAE,oFAAoFC,MAEtG8N,EAAYW,oDAAsDE,EAElE,MAED,IAAK,YACJb,EAAYE,OAASjO,EAAE,2BAA2BC,MAClD8N,EAAYC,OAAShO,EAAE,2BAA2BC,MAClD,MAED,IAAK,WAEJ,MAED,IAAK,kBACJ4O,MAAM,+BACN,MAED,QAE6B,GAAxB1O,EAAK2O,QAAQ,UAEhBf,EAAYE,OAASjO,EAAE,8BAA8BC,MACrD8N,EAAYgB,aAAe/O,EAAE,cAAckC,QAK9C,OAAO6L,CAER,CACK,GAAsB,GAAlBD,EACT,CACC,OAAQ3N,GAEP,IAAK,OACJ4N,EAAYE,OAASjO,EAAE,+BAA+BC,MACtD8N,EAAYC,OAAShO,EAAE,iCAAiCC,MACxD,MAED,IAAK,QACJ8N,EAAYE,OAASjO,EAAE,gCAAgCC,MACvD8N,EAAYC,OAAShO,EAAE,kCAAkCC,MACzD,MAED,IAAK,KACJ8N,EAAYE,OAASjO,EAAE,6BAA6BC,MACpD8N,EAAYC,OAAShO,EAAE,sBAAsBC,MAC7C8N,EAAYI,aAAenO,EAAE,0BAA0BC,MACvD8N,EAAYK,OAASpO,EAAE,oBAAoBC,MAC3C8N,EAAYM,QAAUrO,EAAE,qBAAqBC,MAC7C8N,EAAYO,OAAStO,EAAE,oBAAoBC,MAC3C8N,EAAYQ,iBAAmBvO,EAAE,8BAA8BC,MAC/D8N,EAAYS,gBAAkBxO,EAAE,sBAAsBC,MACtD8N,EAAYU,oBAAsBzO,EAAE,0BAA0BC,MAE1D2O,EAAY5O,EAAE,oFAAoFC,MAEtG8N,EAAYW,oDAAsDE,EAElE,MAED,IAAK,kBACJC,MAAM,+BACN,MAED,QAE6B,GAAxB1O,EAAK2O,QAAQ,UAEhBf,EAAYE,OAASjO,EAAE,8BAA8BC,MACrD8N,EAAYgB,aAAe/O,EAAE,cAAckC,QAK9C,OAAO6L,CACR,CAED,CAEA,SAASiB,iBAAiB7O,GAGzB,IAAI8O,EAAa,KACbC,GAAY,EAOhB,OALyB,QAArB/O,EAAKgP,OAAO,EAAG,KAElBhP,EAAO,mBAGAA,GAEP,IAAK,YACJ8O,EAAajP,EAAE,8BACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,YACJA,EAAajP,EAAE,uBACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,OACJA,EAAajP,EAAE,yBACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,cACJA,EAAajP,EAAE,gCACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,QACJA,EAAajP,EAAE,0BACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,SACJA,EAAajP,EAAE,2BACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,KACJA,EAAajP,EAAE,uBACfkP,EAAYzE,gBAAgBwE,GAE5B,IAAIG,EAAoB,wMAExB,GAAIpP,EAAE,kEAAkEoE,GAAG,aAAepE,EAAE,kEAAkEoE,GAAG,YAGhJ,EADApE,EAAE,6BAA6BC,OACD,EAAzB2M,yBAEpB5M,EAAE,wBAAwBkC,KAAKkN,GAC/BpP,EAAE,wBAAwBqC,OAC1B6M,GAAY,GAId,MAED,IAAK,YACJD,EAAajP,EAAE,oCACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,WACJA,EAAajP,EAAE,yBACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,kBACJA,EAAajP,EAAE,wBACfkP,EAAYzE,gBAAgBwE,GAExBG,EAAoB,wMAExB,GAAIpP,EAAE,8DAA8DoE,GAAG,aAAepE,EAAE,8DAA8DoE,GAAG,YAGxI,EADApE,EAAE,8BAA8BC,OACF,EAAzB2M,yBAEpB5M,EAAE,yBAAyBkC,KAAKkN,GAChCpP,EAAE,yBAAyBqC,OAC3B6M,GAAY,GAQhB,OAAOA,CAER,CAEA,SAASG,iBAAiBlP,GAGzB,IAAI8O,EAAa,KACbC,GAAY,EAOhB,OALyB,QAArB/O,EAAKgP,OAAO,EAAG,KAElBhP,EAAO,mBAGAA,GAGP,IAAK,OAKL,IAAK,QACJ8O,EAAajP,EAAE,0BACfkP,EAAYzE,gBAAgBwE,GAC5B,MAED,IAAK,KACJA,EAAajP,EAAE,uBACfkP,EAAYzE,gBAAgBwE,GAE5B,IAAIG,EAAoB,wMAExB,GAAIpP,EAAE,kEAAkEoE,GAAG,aAAepE,EAAE,kEAAkEoE,GAAG,YAGhJ,EADApE,EAAE,6BAA6BC,OACD,EAAzB2M,yBAEpB5M,EAAE,wBAAwBkC,KAAKkN,GAC/BpP,EAAE,wBAAwBqC,OAC1B6M,GAAY,GAId,MAED,IAAK,kBACJD,EAAajP,EAAE,wBACfkP,EAAYzE,gBAAgBwE,GAExBG,EAAoB,wMAExB,GAAIpP,EAAE,8DAA8DoE,GAAG,aAAepE,EAAE,8DAA8DoE,GAAG,YAGxI,EADApE,EAAE,8BAA8BC,OACF,EAAzB2M,yBAEpB5M,EAAE,yBAAyBkC,KAAKkN,GAChCpP,EAAE,yBAAyBqC,OAC3B6M,GAAY,GAShB,OAAOA,CACR,CAEA,SAASI,wBAOR,GAJA7P,eAAe,kCAEK8P,OAAOvP,EAAE,wBAAwBkC,QAEnCsN,UAAY,KAAO3K,eAAiBC,eAAiB9E,EAAE,mBAAmBoE,GAAG,YAG9F3E,eAAe,+DAEfuB,WAAW,CACVC,MAAO,UACPvB,QAAS,oEACT8E,QAAS,WAGR/E,eAAe,4CAEf,IAAIC,EAAU,8HACV+P,EAAeC,8BAGnB1O,WAAW,CACVC,MAAO,6BACPsC,OAAQ,QACR7D,QALDA,GAAW,eAAiB+P,EAM3BnM,OAAO,EACPD,MAAO,IACPD,OAAQ,IACRoB,QAAS,WAEkB2B,eAAc,EACzC,GAGF,QAIF,CAIC,GAFA1G,eAAe,4CAEX3B,UACJ,CACC,IAAI6R,GAAmB,EAMvB,GALI3P,EAAE,mBAAmBoE,GAAG,cAE3BuL,GAAmB,GAGhBA,EACJ,CAEC,IAAIC,EAAeC,2BACnB,GAAID,EAAe,GAQlB,OALA5O,WAAW,CACVC,MAAO,QACPvB,QAAS,yEAGH,EAEH,GAAIkQ,EAAe,GAOvB,OALA5O,WAAW,CACVC,MAAO,QACPvB,QAAS,6EAGH,CAET,CACD,CAEA,GAAI1C,sBAMH,OAJAgE,WAAW,CACVC,MAAO,QACPvB,QAAS,yFAEH,EAKR,IAAIA,EAAU,8HACV+P,EAAeC,8BAGnB1O,WAAW,CACVC,MAAO,6BACPvB,QAJDA,GAAW,eAAiB+P,EAK3BnM,OAAO,EACPD,MAAO,IACPD,OAAQ,IACRoB,QAAS,WAEkB2B,eAAc,EACzC,GAGF,CAEA,OAAO,CACR,CAEA,SAAS2J,0BAA0BC,EAAcxE,EAAcJ,GAG9D1L,eAAe,sCAEf,IAAIuQ,EAAenC,eAAekC,EAAc,GAEhD,GAAoB,MAAhBA,GAAyBE,+BAmFxB,GAAoB,MAAhBF,EACT,CAEC,IAAIG,EAAelQ,EAAE,0BAA0BC,MAC3CuO,EAAkBxO,EAAE,sBAAsBC,MAC1CkQ,EAAcnQ,EAAE,0BAA0BC,MAE1CqM,EAAMtM,EAAE,6BAA6BC,MAEzCD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxB+C,QAASA,QACTC,GAAI,YACJC,SAAUA,SACVuN,OAAQ3B,EACR4D,aAAcA,EACd1B,gBAAiBA,EACjB2B,YAAaA,EACb5J,cAAe4E,EACfkF,aAAa,GAEd1P,QAAS,SAAUC,IAElBZ,EAAE,4BAA6B,eAAeC,IAAIW,EAAK8F,eAEnD9F,EAAKC,oBAGRpB,eAAe,oDAIfyL,KAFYtK,EAAKuK,MAEL,EAAGvK,EAAKyK,2CAA2C,GAAO,EAAOE,KAK7EvL,EAAE,eAAegE,SAEjBvE,eAAe,wCAA0CmB,EAAKG,mBAE9DC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,wCAA0C2B,EAAW,MAAQD,EAAeE,cAE3FC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAEF,MAvJA,CAEC,IAAIoL,EAAW,EACX1M,EAAE,8DAA8DhB,SAInD,IAFhB0N,EAAW1M,EAAE,sFAAsFC,SAIlGyM,EAAW,GAEI,GAAZA,IAEHA,EAAW,IASb1M,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,eACJC,SAAUA,SACV2F,WAAYA,WACZ7F,QAASA,QACT8P,aAAc/E,EACdgF,iBAAkBP,EAClBQ,gBAAiB9D,EACjBnG,cAAe4E,GAEhBxK,QAAS,SAAUC,GAEdA,EAAKC,mBAERpB,eAAe,uDAEXmB,EAAKyK,0CAER5E,OAAO,yCAA2C7F,EAAKF,SAAW,sBAIlE+F,OAAO,yCAA2C7F,EAAKF,YAMxDV,EAAE,eAAegE,SAEjBvE,eAAe,2CAA6CmB,EAAKG,mBAEjEC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAGjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,2CAA6C2B,EAAW,MAAQD,EAAeE,cAE9FC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAEX,GAEF,CAuED,CAEA,SAASmP,aAAaV,EAAc1E,EAA2CF,GAG9E1L,eAAe,yBAEf,IAAIuQ,EAAenC,eAAekC,EAAc,GAEhD,GAAoB,MAAhBA,GAAyBE,+BAiFxB,GAAoB,MAAhBF,EACT,CAEC,IAAIG,EAAelQ,EAAE,0BAA0BC,MAC3CuO,EAAkBxO,EAAE,sBAAsBC,MAC1CkQ,EAAcnQ,EAAE,0BAA0BC,MAE1CqM,EAAMtM,EAAE,6BAA6BC,MAEzCD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxB+C,QAASA,QACTC,GAAI,YACJC,SAAUA,SACVuN,OAAQ3B,EACR4D,aAAcA,EACd1B,gBAAiBA,EACjB2B,YAAaA,EACb5J,cAAe4E,EACfkF,aAAa,GAEd1P,QAAS,SAAUC,IAElBZ,EAAE,4BAA6B,eAAeC,IAAIW,EAAK8F,eAEnD9F,EAAKC,oBAGRpB,eAAe,uCAIfyL,KAFYtK,EAAKuK,MAEL,EAAGE,GAA2C,GAAO,KAKjErL,EAAE,eAAegE,SAEjBvE,eAAe,2BAA6BmB,EAAKG,mBAEjDC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,2BAA6B2B,EAAW,MAAQD,EAAeE,cAE9EC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAEF,MArJA,CAEC,IAAIoL,EAAW,EACX1M,EAAE,8DAA8DhB,SAInD,IAFhB0N,EAAW1M,EAAE,sFAAsFC,SAIlGyM,EAAW,GAEI,GAAZA,IAEHA,EAAW,IASb1M,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,cACJC,SAAUA,SACVF,QAASA,QACT8P,aAAcN,EACdQ,gBAAiB9D,EACjBnG,cAAe4E,GAEhBxK,QAAS,SAAUC,GAEdA,EAAKC,mBAERpB,eAAe,yCAEX4L,EAEH5E,OAAO,yCAA2C7F,EAAKF,SAAW,sBAIlE+F,OAAO,yCAA2C7F,EAAKF,YAMxDV,EAAE,eAAegE,SAEjBvE,eAAe,6BAA+BmB,EAAKG,mBAEnDC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAGjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,6BAA+B2B,EAAW,MAAQD,EAAeE,cAEhFC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAEX,GAEF,CAuED,CAEA,SAASoP,oBAAoBpF,EAAS3B,EAAewB,GAGpD1L,eAAe,gCAEf,IAAIkR,EAAe3Q,EAAE,kBAAkBC,MACnC8P,GAAe,EAQnB,GANoB,aAAhBY,GAA+C,aAAhBA,IAElCZ,EAAe/P,EAAE,kBAAkBC,QAI/B+O,iBAAiB2B,GAErB,OAAO,EAIR,GAAIZ,GAAgC,IAAhBA,IAAuBV,iBAAiBU,GAE3D,OAAO,EAGRzJ,uBAAuB,aAAc,oCAErC,IAAIiF,EAAesC,eAAe8C,EAAc,GAK5CjE,EAAW,EACX1M,EAAE,8DAA8DhB,SAInD,IAFhB0N,EAAW1M,EAAE,sFAAsFC,SAIlGyM,EAAW,GAEI,GAAZA,IAEHA,EAAW,IASb,IAAIkE,GAAoB,EACpBnE,EAAsB,EACtBzM,EAAE,sBAAsBhB,QAEvBgB,EAAE,sBAAsBoE,GAAG,cAE9BqI,EAAsBzM,EAAE,yBAAyBC,MACjD2Q,GAAoB,GAItB,IAAIC,EAAkB,KAClBC,EAAwB,KAExBf,GAEHc,EAAkBhD,eAAekC,EAAc,GAC/Ce,EAAwBvF,GAIxBsF,EAAkBtF,EAGnBvL,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUA,SACVkD,GAAI,eACJC,SAAUA,SACVF,QAASA,QACT8P,aAAcO,EACdN,iBAAkBO,EAClBN,gBAAiB9D,EACjBkE,kBAAmBA,EACnBG,qBAAsBtE,EACtBlG,cAAe4E,EACf4E,aAAcA,GAEfpP,QAAS,SAAUC,GAEdA,EAAKC,mBAERpB,eAAe,iDAEXmB,EAAKyK,0CAER5E,OAAO,yCAA2C7F,EAAKF,SAAW,sBAIlE+F,OAAO,yCAA2C7F,EAAKF,YAKxDV,EAAE,eAAegE,SAEjBvE,eAAe,qCAAuCmB,EAAKG,mBAE3DC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAGjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhB,WAAZA,EAGHJ,WAAW,CACVC,MAAO,6BACPvB,QAAS,yLACT4D,OAAO,EACPG,MAAM,EACNuN,eAAe,EACfpF,QAAS,CACRqF,QAAW,WAEVjR,EAAEwB,MAAMwC,SACRyC,OAAOjI,OAAOC,SAASsN,KAExB,MAMH/L,EAAE,eAAegE,SAEjBvE,eAAe,qCAAuC2B,EAAW,MAAQD,EAAeE,cAExFC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,WAGX,GAEF,CAEA,SAASgJ,wBAAwBgB,EAAS3B,EAAewB,GAKxD,GAFA1L,eAAe,qCAEVwQ,8BAEJ,OAAOS,oBAAoBpF,EAAS3B,EAAewB,GAGpD,IAAIwF,EAAe3Q,EAAE,kBAAkBC,MACnC8P,GAAe,EAQnB,GANoB,aAAhBY,GAA+C,aAAhBA,IAElCZ,EAAe/P,EAAE,kBAAkBC,QAI/B+O,iBAAiB2B,GAErB,OAAO,EAIR,GAAIZ,GAAgC,IAAhBA,IAAuBV,iBAAiBU,GAE3D,OAAO,EAGRzJ,uBAAuB,aAAc,oCAErC,IAAIiF,EAAesC,eAAe8C,EAAc,GAEhD,GAAIZ,GAAgC,IAAhBA,EAEnBD,0BAA0BC,EAAcxE,EAAcJ,QAIvD,GAAoB,IAAhBwF,GAAsC,MAAhBA,EAC1B,CAIC,IAAIjE,EAAW,EACX1M,EAAE,8DAA8DhB,SAInD,IAFhB0N,EAAW1M,EAAE,sFAAsFC,SAIlGyM,EAAW,GAEI,GAAZA,IAEHA,EAAW,IASb,IAAIkE,GAAoB,EACpBnE,EAAsB,EACtBzM,EAAE,sBAAsBhB,QAEvBgB,EAAE,sBAAsBoE,GAAG,cAE9BqI,EAAsBzM,EAAE,yBAAyBC,MACjD2Q,GAAoB,GAItB5Q,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,eACJC,SAAUA,SACVF,QAASA,QACT8P,aAAc/E,EACdiF,gBAAiB9D,EACjBkE,kBAAmBA,EACnBG,qBAAsBtE,EACtBlG,cAAe4E,GAEhBxK,QAAS,SAAUC,GAEdA,EAAKC,mBAGRpB,eAAe,qDAEXmB,EAAKyK,0CAER5E,OAAO,yCAA2C7F,EAAKF,SAAW,sBAIlE+F,OAAO,yCAA2C7F,EAAKF,YAKxDV,EAAE,eAAegE,SAEjBvE,eAAe,yCAA2CmB,EAAKG,mBAE/DC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,yCAA2C2B,EAAW,MAAQD,EAAeE,cAE5FC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAEX,GAGF,MACK,GAAoB,IAAhBqP,GAAsC,MAAhBA,EAC/B,CASC,IAAIT,EAAelQ,EAAE,0BAA0BC,MAC3CuO,EAAkBxO,EAAE,sBAAsBC,MAC1CkQ,EAAcnQ,EAAE,0BAA0BC,MAC1CqM,EAAMtM,EAAE,6BAA6BC,MAEzCD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,YACJC,SAAUA,SACVuN,OAAQ3B,EACR9L,QAASA,QACT0P,aAAcA,EACd1B,gBAAiBA,EACjB2B,YAAaA,EACb5J,cAAe4E,EACfkF,aAAa,GAEd1P,QAAS,SAAUC,IAElBZ,EAAE,4BAA6B,eAAeC,IAAIW,EAAK8F,eAEnD9F,EAAKC,oBAGRpB,eAAe,kDAIfyL,KAFYtK,EAAKuK,MAEL,GAAG,EAAOG,EAAS3B,GAAe,KAK9C3J,EAAE,eAAegE,SAEjBvE,eAAe,sCAAwCmB,EAAKG,mBAE5DC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,sCAAwC2B,EAAW,MAAQD,EAAeE,cAEzFC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAGF,CACD,CAEA,SAAS0F,iBAAiBkB,GAGzBzI,eAAe,6BAEf,IAAIgB,EAAK,WACS,OAAd/C,aAEH+C,EAAK,2BAGNT,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,MACNC,QAAS,IACTC,SAAU,OACVC,KAAM,CACLC,UAAW,0BACXhD,SAAUA,SACV+P,OAAQ7M,EACRyQ,eAAgB7K,WAChB6B,UAAWA,GAGZvH,QAAS,SAAUC,GAEdA,EAAKC,mBAGRpB,eAAe,iCAEfO,EAAE,oBAAoBkC,KAAKtB,EAAKN,QAKhCb,eAAe,qBAAuBmB,EAAKG,mBAE3CC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhC3B,eAAe,qBAAuB2B,EAAW,MAAQD,EAAeE,cAExEC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAIF,CAEA,SAAS6P,WAAWpJ,GAEpB,CAEA,SAASqJ,aAAa3T,EAAI4T,GAEzB,IAAIC,EAAiBtR,EAAE,mBAAmBkC,OAE1ClB,WAAW,CACVC,MAAO,aACPvB,QAAS,mFAAqF4R,EAAiB,sDAAwDD,EAAc,SACrL/N,OAAO,EACPkB,QAAS,WAGR,IAAIoC,EAAiBP,WACrBA,WAAa5I,EACbkJ,WAAWC,EAEZ,EACA2K,KAAM,WAGLvR,EAAEwB,MAAMgQ,SAAS,yBAAyBlJ,KAAK,8BAA8BmJ,OAC9E,GAIF,CAEA,SAASC,kBAAkBjU,EAAI4T,EAAaM,EAAcC,GAEvC,OAAdlU,aAEoB,UAAnBkU,EAEH5Q,WAAW,CACVC,MAAO,aACPvB,QAAS,iJAKiB,eAAnBkS,EAGR5Q,WAAW,CACVC,MAAO,aACPvB,QAAS,mLACT4D,OAAO,EACPC,OAAQ,kBACRiB,QAAS,WAER4M,aAAa3T,EAAI4T,GACjBrR,EAAE,oBAAoBgE,QACvB,IAK0B,YAAnB4N,EAGR5Q,WAAW,CACVC,MAAO,aACPvB,QAAS,sLACT4D,OAAO,EACPC,OAAQ,eACRiB,QAAS,WAER4M,aAAa3T,EAAI4T,GACjBrR,EAAE,iBAAiBgE,QACpB,IAMDoN,aAAa3T,EAAI4T,GAGpB,CAEA,SAASQ,eAAepU,EAAI4T,EAAaM,GAEtB,OAAdjU,YAEH0I,kBAAkB3I,EAEpB,CAEA,SAASqU,YAAYC,GAEpB/K,iBAAiB+K,EAClB,CAEA,SAASC,yBAEJC,0BAKJjS,EAAE,qfAGyHyB,GAAG,SAAS,SAAUC,GAGhJV,WAAW,CACVC,MAAOiR,KAAKC,GAAGC,GAAGC,qBAClB3S,QAASwS,KAAKC,GAAGC,GAAGE,gBACpBhP,OAAO,EACPG,MAAM,EACNuN,eAAe,EACfO,KAAM,SAAU3O,EAAOmB,GAEtB/D,EAAEwB,MAAM+Q,SAASjK,KAAK,6BAA6BlG,MACpD,EACAwJ,QAAS,CACR4G,MAAS,WAGRxS,EAAEwB,MAAMwC,SAERhE,EAAE,qfAGyHyS,IAAI,SAE/HC,cAAc,2BAA4B,EAAGlS,QAE9C,EACAmS,QAAW,WAGV3S,EAAE,0PACwH4S,QAAQ,SAElI5R,WAAW,CACVC,MAAOiR,KAAKC,GAAGC,GAAGC,qBAClB3S,QAASwS,KAAKC,GAAGC,GAAGS,0BAGrBH,cAAc,2BAA4B,EAAGlS,QAE9C,IAIH,GACD,CAEA,SAASsS,kBAAkBC,GAE1BjW,mBAAoB,EAGhBiW,GAFJhW,uBAAuC,GAAdiW,cAIxBD,EAAiBhW,uBACjBA,uBAAyB,GAIzBA,wBAA0BgW,EAI3B/S,EAAE,gBAAgBC,IAAI8S,GACtB/S,EAAE,qBAAqBkC,KAAK,oBAAsB0F,cAAc7K,wBAA0B,KAC3F,CAEA,SAASkW,oBAERnW,mBAAoB,EACpBkD,EAAE,qBAAqBkC,KAAK,GAC7B,CAEA,SAASgR,2BAA2BnL,GAE/BA,EAAIoL,QAEPC,mBAIAnL,qBAEF,CAEA,SAASA,sBAER,IAAIoL,EAAgB9D,OAAOvP,EAAE,iCAAiCkC,QAC1DoR,EAAa/D,OAAOvP,EAAE,6BAA6BkC,QAElC,GAAjBmR,GAAoC,GAAdC,EAEzBtT,EAAE,kBAAkBoC,OAIpBpC,EAAE,kBAAkBqC,OAGrB,IAAIkR,EAAgBhE,OAAOvP,EAAE,iCAAiCkC,QAC1DsR,EAAajE,OAAOvP,EAAE,6BAA6BkC,QAElC,GAAjBqR,GAAoC,GAAdC,EAEzBxT,EAAE,kBAAkBoC,OAIpBpC,EAAE,kBAAkBqC,OAGrB,IAAIoR,EAAclE,OAAOvP,EAAE,+BAA+BkC,QACtDwR,EAAWnE,OAAOvP,EAAE,2BAA2BkC,QAEhC,GAAfuR,GAAgC,GAAZC,EAEvB1T,EAAE,gBAAgBoC,OAIlBpC,EAAE,gBAAgBqC,OAGnB,IAAIsR,EAAiBpE,OAAOvP,EAAE,kCAAkCkC,QAC5D0R,EAAcrE,OAAOvP,EAAE,8BAA8BkC,QAEnC,GAAlByR,GAAsC,GAAfC,EAE1B5T,EAAE,mBAAmBoC,OAIrBpC,EAAE,mBAAmBqC,OAGtB,IAAIwR,EAAgBtE,OAAOvP,EAAE,kCAAkCkC,QAC3D4R,EAAavE,OAAOvP,EAAE,8BAA8BkC,QAEnC,GAAjB2R,GAAoC,GAAdC,EAEzB9T,EAAE,sBAAsBoC,OAIxBpC,EAAE,sBAAsBqC,OAGzB,IAAI0R,EAAoBxE,OAAOvP,EAAE,4BAA4BkC,QACzD8R,EAAiBzE,OAAOvP,EAAE,wBAAwBkC,QAE7B,GAArB6R,GAA4C,GAAlBC,EAE7BhU,EAAE,sBAAsBoC,OAIxBpC,EAAE,sBAAsBqC,OAGzB,IAAI4R,EAAyB1E,OAAOvP,EAAE,uCAAuCkC,QACzEgS,EAAsB3E,OAAOvP,EAAE,yCAAyCkC,QAE9C,GAA1B+R,GAAsD,GAAvBC,EAElClU,EAAE,2BAA2BoC,OAI7BpC,EAAE,2BAA2BqC,OAG1B4R,EAAyB1E,OAAOvP,EAAE,sCAAsCkC,QACxEgS,EAAsB3E,OAAOvP,EAAE,wCAAwCkC,QAE7C,GAA1B+R,GAAsD,GAAvBC,EAElClU,EAAE,8BAA8BoC,OAIhCpC,EAAE,8BAA8BqC,OAKP,GAFDkN,OAAOvP,EAAE,yBAAyBkC,QAI1DlC,EAAE,uBAAuBoC,OAIzBpC,EAAE,uBAAuBqC,OAKP,GAFDkN,OAAOvP,EAAE,kBAAkBkC,QAI5ClC,EAAE,6BAA6BoC,OAI/BpC,EAAE,6BAA6BqC,OAGhC,IAAI8R,EAAa5E,OAAOvP,EAAE,8BAA8BkC,QACpDkS,EAAU7E,OAAOvP,EAAE,0BAA0BkC,QAE/B,GAAdiS,GAA8B,GAAXC,EAEtBpU,EAAE,eAAeoC,OAIjBpC,EAAE,eAAeqC,OAGlB,IAAIgS,EAAgB9E,OAAOvP,EAAE,yBAAyBkC,QAClDoS,EAAa/E,OAAOvP,EAAE,qBAAqBkC,QAE1B,GAAjBmS,GAAoC,GAAdC,EAEzBtU,EAAE,kBAAkBoC,OAIpBpC,EAAE,kBAAkBqC,OAGrB,IAAIkS,EAAsBhF,OAAOvP,EAAE,8BAA8BkC,QAC7DsS,EAAmBjF,OAAOvP,EAAE,0BAA0BkC,QAE/B,GAAvBqS,GAAgD,GAApBC,EAE/BxU,EAAE,uBAAuBoC,OAIzBpC,EAAE,uBAAuBqC,MAE3B,CAEA,SAAS+Q,mBAERpT,EAAE,kBAAkBqC,OACpBrC,EAAE,kBAAkBqC,OACpBrC,EAAE,gBAAgBqC,OAClBrC,EAAE,mBAAmBqC,OACrBrC,EAAE,sBAAsBqC,OACxBrC,EAAE,sBAAsBqC,OACxBrC,EAAE,eAAeqC,OACjBrC,EAAE,kBAAkBqC,OACpBrC,EAAE,uBAAuBqC,OACzBrC,EAAE,2BAA2BqC,OAC7BrC,EAAE,6BAA6BqC,OAC/BrC,EAAE,uBAAuBqC,MAC1B,CAEA,SAASoS,cAAcC,EAAGC,GAEzB,OAAID,EAAEE,OAASD,EAAEC,MAET,EAGAF,EAAEE,MAAQD,EAAEC,MAAS,GAAK,CACnC,CAEA,SAASC,iCAAiC9O,EAAO+O,GAEhDC,OAAS,EAET,IAAIC,EAAwB,EACxBC,EAAgB,EAEpB,GAAIlP,EAAM/G,OAAS,EACnB,CACC+G,EAAMmP,KAAKT,eAEX,IAAK,IAAI1V,EAAI,EAAGA,EAAIgH,EAAM/G,OAAQD,IAClC,CAEC,IAAIoW,EAAWpP,EAAMhH,GAEjBqW,EAAkBD,EAASE,IAAMF,EAASG,aAC1CC,EAAeJ,EAASE,IAAMF,EAASP,MAG3C,GAAqB,KAFrBK,GAAiBG,GAGjB,CACCJ,GAAyBO,EACzB,KACD,CACK,GAAIN,EAAgB,GACzB,CAICD,IAFwB,IADRC,EAAgBG,IAESD,EAASG,aACPH,EAASP,MACpD,KACD,CAGCI,GAAyBO,CAE3B,CAEAR,OAASD,EAAQE,CAElB,CAEA,GAAIC,EAAgB,GAEnB,OAAO,EAGR,IAAI3B,EAAa/D,OAAO/M,SAASgT,eAAe,wBAAwBnO,OACxE0N,QAAUzB,EAAW9D,UAErB,IAAIiG,EAAmBlG,OAAO/M,SAASgT,eAAe,sBAAsBnO,OAG5E,OAFA0N,QAAUU,EAAiBjG,UAEpBuF,MACR,CAEA,SAASW,iBAER,IAAIxT,EAAOiB,oBACXnD,EAAE,eAAekC,KAAKA,EAEvB,CAEA,SAASiB,oBAGR,IAAIwS,EAAU,GACV7W,GAAQ,EACZ,IAAK,IAAI8W,KAAQ/Y,WAAWgZ,aAC5B,CASC,GARI/W,IAEH6W,GAAW,wDACX7W,GAAQ,GAGT6W,GAAW,OAEP9Y,WAAWgZ,aAAa5I,eAAe2I,GAC3C,CACC,IAAI3U,EAAQjB,EAAE,QAAU4V,GAAMtV,KAAK,cAC/BwV,EAAe,IAAM9V,EAAE,QAAU4V,GAAMtV,KAAK,YAAc,YAE1DzD,WAAWgZ,aAAaD,GAAQ,EAEnCD,GAAW,SAAW9Y,WAAWgZ,aAAaD,GAAQ,IAAME,EAAe,OAAS7U,EAAQ,OAI5F0U,GAAW,YAA8C,EAAjC9Y,WAAWgZ,aAAaD,GAAa,IAAME,EAAe,OAAS7U,EAAQ,MAErG,CAEA0U,GAAW,OAEZ,CAQA,IAAK,IAAIC,KANJ9W,IAEJ6W,GAAW,SAGZ7W,GAAQ,EACSjC,WAAWkZ,YAC5B,CASC,GARIjX,IAEH6W,GAAW,+CACX7W,GAAQ,GAGT6W,GAAW,OAEP9Y,WAAWkZ,YAAY9I,eAAe2I,GAC1C,CACK3U,EAAQjB,EAAE,QAAU4V,GAAMtV,KAAK,cAE/BzD,WAAWkZ,YAAYH,GAAQ,EAElCD,GAAW,SAAW9Y,WAAWkZ,YAAYH,GAAQ,OAAS3U,EAAQ,OAItE0U,GAAW,YAA6C,EAAhC9Y,WAAWkZ,YAAYH,GAAa,OAAS3U,EAAQ,MAE/E,CAEA0U,GAAW,OAEZ,CAEK7W,IAEJ6W,GAAW,SAGZ7W,GAAQ,EACR,IAAIkX,GAAqB,EACzB,IAAK,IAAIJ,KAAQ/Y,WAAWoZ,UAE3BD,GAAqB,EACjBlX,IAEH6W,GAAW,sBACX7W,GAAQ,GAGLjC,WAAWoZ,UAAUhJ,eAAe2I,KAGnC/Y,WAAWoZ,UAAUL,GAAc,OAAI/Y,WAAWoZ,UAAUL,GAAc,OAEjC,GAAxC/Y,WAAWoZ,UAAUL,GAAc,OAEtCD,GAAW,SAAWO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,SAInHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,cAAc/K,WAAWoZ,UAAUL,GAAY,MAAK,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,SAMzI,GAAxC/Y,WAAWoZ,UAAUL,GAAc,OAEtCD,GAAW,WAAaO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,SAIrHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,eAAoD,EAAtC/K,WAAWoZ,UAAUL,GAAY,MAAU,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,UAQ7L,IAAK,IAAIA,KADT9W,GAAQ,EACSjC,WAAWsZ,WAEtBH,GAAsBlX,IAE1B6W,GAAW,sBACX7W,GAAQ,GAGLjC,WAAWsZ,UAAUlJ,eAAe2I,KAEvCD,GAAWO,qBAAqBN,GAAQ,kBAU1C,IAAK,IAAIA,IANoB,IAAzB/Y,WAAWuZ,aAEdT,GAAW,qBAAuB9Y,WAAWuZ,WAAa,SAG3DtX,GAAQ,EACSjC,WAAWwZ,YAC5B,CAqBC,GApBIvX,IAEC+F,aAEH8Q,GAAW,kEAGH7Q,aAER6Q,GAAW,gEAIXA,GAAW,qDAEZ7W,GAAQ,GAGT6W,GAAW,OAEP9Y,WAAWwZ,YAAYpJ,eAAe2I,GAC1C,CAEK3U,EAAQjB,EAAE,QAAU4V,GAAMtV,KAAK,cAC/BwV,EAAe,IAAM9V,EAAE,QAAU4V,GAAMtV,KAAK,YAAc,YAE1DzD,WAAWwZ,YAAYT,GAAQ,EAElCD,GAAW,SAAW9Y,WAAWwZ,YAAYT,GAAQ,IAAME,EAAe,OAAS7U,EAAQ,OAI3F0U,GAAW,YAA6C,EAAhC9Y,WAAWwZ,YAAYT,GAAa,IAAME,EAAe,OAAS7U,EAAQ,MAGpG,CAEA0U,GAAW,OAEZ,CAQA,IAAK,IAAIC,KANJ9W,IAEJ6W,GAAW,SAGZ7W,GAAQ,EACSjC,WAAWyZ,UAEvBxX,IAEH6W,GAAW,qBACX7W,GAAQ,GAGLjC,WAAWyZ,UAAUrJ,eAAe2I,KAEnC/Y,WAAWyZ,UAAUV,GAAc,OAAI/Y,WAAWyZ,UAAUV,GAAc,OAEjC,GAAxC/Y,WAAWyZ,UAAUV,GAAc,OAEtCD,GAAW,SAAWO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,SAInHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,cAAc/K,WAAWyZ,UAAUV,GAAY,MAAK,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,SAMzI,GAAxC/Y,WAAWyZ,UAAUV,GAAc,OAEtCD,GAAW,WAAaO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,SAIrHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,eAAoD,EAAtC/K,WAAWyZ,UAAUV,GAAY,MAAU,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,UAQ7L,IAAK,IAAIA,KADT9W,GAAQ,EACSjC,WAAW0Z,UAEvBzX,IAEH6W,GAAW,qBACX7W,GAAQ,GAGLjC,WAAW0Z,UAAUtJ,eAAe2I,KAE3B,cAARA,EAEyC,GAAxC/Y,WAAW0Z,UAAUX,GAAc,OAEtCD,GAAW,WAAaO,qBAAqBN,GAAQ,IAAM/Y,WAAW0Z,UAAUX,GAAa,MAAI,SAEzF/Y,WAAW0Z,UAAUX,GAAc,OAAI,GAAK/Y,WAAW0Z,UAAUX,GAAc,QAAK/Y,WAAW0Z,UAAUX,GAAc,OAE/HD,GAAW,WAAaO,qBAAqBN,GAAQ,OAAS/Y,WAAW0Z,UAAUX,GAAa,MAAI,SAIpGD,GAAW,SAAWO,qBAAqBN,GAAQ,IAAM/Y,WAAW0Z,UAAUX,GAAa,MAAI,SAGhF,oBAARA,IAEJ/Y,WAAW0Z,UAAUX,GAAY,KAAI,EAExCD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,cAAc/K,WAAW0Z,UAAUX,GAAY,MAAK,QAAUhO,cAAc/K,WAAW0Z,UAAUX,GAAc,QAAK,SAIpLD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,eAAoD,EAAtC/K,WAAW0Z,UAAUX,GAAY,MAAU,QAAUhO,cAAc/K,WAAW0Z,UAAUX,GAAc,QAAK,WA4B7L,GAtBI/Y,WAAW2Z,SAEV1X,IAEH6W,GAAW,qBACX7W,GAAQ,IAGLjC,WAAW2Z,OAAOC,YAAc,SAEnCd,GAAW,6BAEH9Y,WAAW2Z,OAAOC,YAAc,WAExCd,GAAW,+BAEH9Y,WAAW2Z,OAAOC,YAAc,WAExCd,GAAW,kCAITjZ,gBAAkBsD,EAAE,qBAAqBoE,GAAG,YAChD,CACCuR,GAAW,oBAEX,IAAIhF,EAAe3Q,EAAE,kBAAkBC,MAEvC,GAAoB,IAAhB0Q,EAEJgF,GAAW,mBAAqBhF,EAAe,uBAG/C,CACC3Q,EAAE,cAAcoE,GAAG,YAEdpE,EAAE,0CAA0CC,MAAQ,IAEvD0V,GAAW,qCAGZ,IAAIe,EAAgB,EACpB1W,EAAE,iBAAiBuB,MAAK,WACvBmV,GAAiBC,WAAW3W,EAAEwB,MAAMvB,MACrC,IAEIyW,EAAgB,IAEnBf,GAAW,8CAGd,CAGA,IAAqB,aAAhBhF,GAA+C,aAAhBA,IAA6D,IAA7B3Q,EAAE,kBAAkBC,MACxF,CACC,IAAI8P,EAAe/P,EAAE,kBAAkBC,MACnC8P,GAAgC,IAAhBA,IAEnB4F,GAAW,mBAAqB5F,EAAe,mBAEjD,CAEI/P,EAAE,qBAAqBoE,GAAG,cAE7BuR,GAAW,2CAEb,CACA,OAAOA,CACR,CAEA,SAASO,qBAAqBzY,GAE7B,OAAQA,GAEP,IAAK,wBACJ,MAAO,wBACR,IAAK,wBACJ,MAAO,iBACR,IAAK,qBACJ,MAAO,0BACR,IAAK,wBACJ,MAAO,8BACR,IAAK,uBACJ,MAAO,cACR,IAAK,0BACJ,MAAO,wBACR,IAAK,6BACJ,MAAO,4BACR,IAAK,0BACJ,MAAO,0BACR,IAAK,mBACJ,MAAO,mBACR,QACC,MAAO,QAEV,CAEA,SAASiS,8BAER,IAAIiG,EAAU,GAEViB,EAAgB5W,EAAE,mBAAmBoE,GAAG,YAExCS,aAEH8Q,GAAW,oCAIXA,GAFQiB,EAEG,8BAIA,0BAGZ,IAAIC,EAAe,EACfC,EAAc,EAElB9W,EAAE,gBAAgBuB,MAAK,WAElBvB,EAAEwB,MAAMvB,MAAQ,IAEY,OAA3BD,EAAEwB,MAAMlB,KAAK,WAEhBwW,GAAgC,EAAhB9W,EAAEwB,MAAMvB,MAIxB4W,GAAiC,EAAhB7W,EAAEwB,MAAMvB,MAG5B,IAEI4W,EAAe,IAElBlB,GAAWkB,EAAe,mCAEvBC,EAAc,IAEjBnB,GAAWmB,EAAc,6CAG1B9W,EAAE,+BAA+BuB,MAAK,WAErC,IAAIwV,EAAS/W,EAAEwB,MAAMvB,MAErB,GAA8B,GAA1BD,EAAEwB,MAAMlB,KAAK,YAGhByW,EAASJ,WAAWI,GAChB7T,MAAM6T,KAETA,EAAS,GAGNA,EAAS,GACb,CACCpB,GAAWO,qBAAqB1U,KAAK/D,IAAM,cAAgBmK,cAAcmP,GAEzE,IAAIC,EAAY,GAEhB,OAAQxV,KAAK/D,IAEZ,IAAK,qBACJuZ,EAAY,0BACZ,MACD,IAAK,wBACJA,EAAY,6BACZ,MACD,IAAK,uBACJA,EAAY,0BAId,IAAIC,EAAOjX,EAAE,IAAMgX,GAAW/W,MAI7B0V,GAFGsB,EAEQ,aAAeA,EAAO,kBAItB,SAEb,CAEF,IAEIL,EAAgB5W,EAAE,mBAAmBoE,GAAG,YACzBpE,EAAE,mBAAmBM,KAAK,aAD7C,IAGI+V,EAAc,EAelB,GAdArW,EAAE,gBAAgBuB,MAAK,WAGlBvB,EAAEwB,MAAM4C,GAAG,aAEdiS,GAEF,IAEIA,EAAc,IAEjBV,GAAWU,EAAc,gCAGtBxR,aACJ,CACKwR,EAAc,EAClBrW,EAAE,gBAAgBuB,MAAK,WAGlBvB,EAAEwB,MAAMvB,MAAQ,IAEnBoW,GAAgC,EAAhBrW,EAAEwB,MAAMvB,MAE1B,IAEIoW,EAAc,IAEjBV,GAAWU,EAAc,yBAE3B,CAIA,IAAIa,EAAgB,GAuBpB,GArBAlX,EAAE,kDAAkDuB,MAAK,WAGxD,IAAIwV,EAAS/W,EAAEwB,MAAMvB,MAES,GAA1BD,EAAEwB,MAAMlB,KAAK,YAGhByW,EAASJ,WAAWI,GAChB7T,MAAM6T,KAETA,EAAS,IAIPA,EAAOvH,UAAY,IAEtB0H,GAAiBhB,qBAAqB1U,KAAK/D,IAAM,kBAEnD,IAEIuC,EAAE,iBAAiBhB,OACvB,CAEC,IAAImY,EAAanX,EAAE,iCAAkC,eAAeC,MAEhEkX,GAA4B,QAAdA,IAEjBD,GAAiB,qCAGnB,CAEA,GAAIlX,EAAE,YAAYhB,OAClB,CACC,IAAIoY,EAAcpX,EAAE,4BAA6B,eAAeC,MAE5DmX,GAA8B,QAAfA,IAElBF,GAAiB,4CAEnB,CAOA,GALqB,IAAjBA,IAEHvB,GAAW,qBAAuBuB,GAG/Bxa,gBAAkBsD,EAAE,qBAAqBoE,GAAG,YAChD,CACCuR,GAAW,oBAEX,IAAIhF,EAAe3Q,EAAE,kBAAkBC,MAGvC,GAFA0V,GAAW,mBAAqBhF,EAAe,oBAE1B,aAAhBA,GAA+C,aAAhBA,IAA6D,IAA7B3Q,EAAE,kBAAkBC,MACxF,CACC,IAAI8P,EAAe/P,EAAE,kBAAkBC,MACnC8P,GAAgC,IAAhBA,IAEnB4F,GAAW,mBAAqB5F,EAAe,mBAEjD,CAEI/P,EAAE,qBAAqBoE,GAAG,cAE7BuR,GAAW,2CAGb,CAEA,OAAOA,CACR,CAEA,SAAS5Q,mBAGRzI,aAAc,EACdE,iBAAkB,EAElBD,0BAA2B,EAC3B,IAAI8a,GAAiB,GAErBxa,WAAa,CAAC,GACHgZ,aAAe,CAAC,EAC3BhZ,WAAWkZ,YAAc,CAAC,EAC1BlZ,WAAWoZ,UAAY,CAAC,EACxBpZ,WAAWsZ,UAAY,CAAC,EACxBtZ,WAAWwZ,YAAc,CAAC,EAC1BxZ,WAAWuZ,WAAa,GACxBvZ,WAAWyZ,UAAY,CAAC,EAGxBtW,EAAE,gBAAgBuB,MAAK,WAElBvB,EAAEwB,MAAMvB,OAASD,EAAEwB,MAAMlB,KAAK,cAEF,OAA3BN,EAAEwB,MAAMlB,KAAK,WAEhBzD,WAAWkZ,YAAYvU,KAAK/D,GAAGmB,MAAM,KAAK,IAAMoB,EAAEwB,MAAMvB,MAAQD,EAAEwB,MAAMlB,KAAK,aAI7EzD,WAAWgZ,aAAarU,KAAK/D,GAAGmB,MAAM,KAAK,IAAMoB,EAAEwB,MAAMvB,MAAQD,EAAEwB,MAAMlB,KAAK,aAG/EN,EAAEwB,MAAMQ,SAAS,gBACjB1F,aAAc,GAId0D,EAAEwB,MAAMW,YAAY,eAEtB,IAGAnC,EAAE,+BAA+BuB,MAAK,WAErC,IAAIwV,EAAS/W,EAAEwB,MAAMvB,MACjBqX,EAAStX,EAAEwB,MAAMlB,KAAK,aAEI,GAA1BN,EAAEwB,MAAMlB,KAAK,YAGhByW,EAASJ,WAAWI,GACpBO,EAASX,WAAWW,GAEhBpU,MAAM6T,KAETA,EAAS,GAEN7T,MAAMoU,KAETA,EAAS,IAKPP,EAAOvH,WAAa8H,EAAO9H,WAE9BxP,EAAEwB,MAAMQ,SAAS,gBAEa,GAA1BhC,EAAEwB,MAAMlB,KAAK,UAGhBzD,WAAWoZ,UAAUzU,KAAK/D,IAAM,CAC/B8Z,OAAQvX,EAAEwB,MAAMvB,MAChBqX,OAAQtX,EAAEwB,MAAMlB,KAAK,aACrBkX,KAAMxX,EAAEwB,MAAMvB,MAAQD,EAAEwB,MAAMlB,KAAK,cAMpCzD,WAAWsZ,UAAU3U,KAAK/D,IAAM,EAGjCnB,aAAc,GAId0D,EAAEwB,MAAMW,YAAY,eAEtB,IAEA,IAAIyU,EAAgB5W,EAAE,mBAAmBoE,GAAG,YACxCqT,EAAezX,EAAE,mBAAmBM,KAAK,aAoJ7C,GAlJIsW,EAEiB,KAAhBa,GAEHzX,EAAE,sBAAsBgC,SAAS,mBACjCnF,WAAWuZ,WAAa,WACxB9Z,aAAc,GAId0D,EAAE,sBAAsBmC,YAAY,mBAKjB,KAAhBsV,GAEHzX,EAAE,sBAAsBgC,SAAS,mBACjCnF,WAAWuZ,WAAa,cACxB9Z,aAAc,GAId0D,EAAE,sBAAsBmC,YAAY,mBAIlC0C,aAGH7E,EAAE,gBAAgBuB,MAAK,WAGlBvB,EAAEwB,MAAMvB,OAASD,EAAEwB,MAAMlB,KAAK,cAE7BN,EAAEwB,MAAMlB,KAAK,WAEhBzD,WAAWwZ,YAAY7U,KAAK/D,GAAGmB,MAAM,KAAK,IAAMoB,EAAEwB,MAAMvB,MAAQD,EAAEwB,MAAMlB,KAAK,aAO9EN,EAAEwB,MAAMQ,SAAS,gBACjB1F,aAAc,GAId0D,EAAEwB,MAAMW,YAAY,eAEtB,IAMAnC,EAAE,gBAAgBuB,MAAK,WAGlBvB,EAAEwB,MAAM4C,GAAG,YAEmB,KAA7BpE,EAAEwB,MAAMlB,KAAK,cAEhBN,EAAEwB,MAAM+Q,SAASvQ,SAAS,mBAC1BnF,WAAWwZ,YAAY7U,KAAK/D,GAAGmB,MAAM,KAAK,IAAM,EAChDtC,aAAc,GAId0D,EAAEwB,MAAM+Q,SAASpQ,YAAY,mBAKG,KAA7BnC,EAAEwB,MAAMlB,KAAK,cAEhBN,EAAEwB,MAAM+Q,SAASvQ,SAAS,mBAC1BnF,WAAWwZ,YAAY7U,KAAK/D,GAAGmB,MAAM,KAAK,KAAO,EACjDtC,aAAc,GAId0D,EAAEwB,MAAM+Q,SAASpQ,YAAY,kBAGhC,IAIG7F,aAEH0D,EAAE,iBAAiBgC,SAAS,uBAC5BqV,GAAiB,GAIjBrX,EAAE,iBAAiBmC,YAAY,uBAKhCnC,EAAE,kDAAkDuB,MAAK,WAGxD,IAAIwV,EAAS/W,EAAEwB,MAAMvB,MACjBqX,EAAStX,EAAEwB,MAAMlB,KAAK,aAEI,GAA1BN,EAAEwB,MAAMlB,KAAK,YAGhByW,EAASJ,WAAWI,GACpBO,EAASX,WAAWW,GAEhBpU,MAAM6T,KAETA,EAAS,GAEN7T,MAAMoU,KAETA,EAAS,IAKPP,EAAOvH,WAAa8H,EAAO9H,WAK9B3S,WAAWyZ,UAAU9U,KAAK/D,IAAM,CAC/B8Z,OAAQvX,EAAEwB,MAAMvB,MAChBqX,OAAQtX,EAAEwB,MAAMlB,KAAK,aACrBkX,KAAMxX,EAAEwB,MAAMvB,MAAQD,EAAEwB,MAAMlB,KAAK,cAGpCN,EAAEwB,MAAMQ,SAAS,gBACjBzF,0BAA2B,EAC3BC,iBAAkB,GAIlBwD,EAAEwB,MAAMW,YAAY,eAEtB,IAEInC,EAAE,iBAAiBhB,OAEtB,GAAIrC,+BAAiCqD,EAAE,iCAAkC,eAAeC,MACxF,CACCD,EAAE,YAAYgC,SAAS,mBAEvB,IAAImV,EAAanX,EAAE,iCAAkC,eAAeC,MAInEpD,WAAWyZ,UAA4B,iBAFtB,QAAda,EAEwC,CAC1CI,OAAQ,EACRD,OAAQtX,EAAE,6BAA6BkC,OACvCsV,MAA+C,EAAzCxX,EAAE,6BAA6BkC,QAKK,CAC1CqV,OAAQvX,EAAE,yBAAyBkC,OACnCoV,OAAQ,EACRE,KAAMxX,EAAE,yBAAyBkC,QAInC3F,0BAA2B,EAC3BC,iBAAkB,CACnB,MAGCwD,EAAE,YAAYmC,YAAY,mBAI5B,GAAInC,EAAE,YAAYhB,OAEjB,GAAIpC,qCAAuCoD,EAAE,4BAA6B,eAAeC,MACzF,CACCD,EAAE,aAAagC,SAAS,mBAExB,IAAIoV,EAAcpX,EAAE,4BAA6B,eAAeC,MAI/DpD,WAAWyZ,UAAmC,wBAF5B,QAAfc,EAE+C,CACjDG,OAAQ,EACRD,OAAQtX,EAAE,sBAAsBkC,OAChCsV,MAAwC,EAAlCxX,EAAE,sBAAsBkC,QAKmB,CACjDqV,OAAQvX,EAAE,kBAAkBkC,OAC5BoV,OAAQ,EACRE,KAAMxX,EAAE,kBAAkBkC,QAI5B3F,0BAA2B,EAC3BC,iBAAkB,CACnB,MAGCwD,EAAE,aAAamC,YAAY,mBAK7B,IAAIuV,EAAe1X,EAAE,kBAAkBC,MACnC0X,EAAe3X,EAAE,cAAcC,MAE/ByX,GAAgBC,IAEnBpb,0BAA2B,EAK1BM,WAAW2Z,OAHQ,IAAhBkB,EAGiB,CACnBH,OAAQI,EACRL,OAAQI,EACRjB,YAAa,SAGU,IAAhBkB,EAIY,CACnBJ,OAAQI,EACRL,OAAQI,EACRjB,YAAa,WAMM,CACnBc,OAAQI,EACRL,OAAQI,EACRjB,YAAa,YAMZla,0BAEHyD,EAAE,oBAAoBgC,SAAS,uBAC/BqV,GAAiB,GAIjBrX,EAAE,oBAAoBmC,YAAY,uBAGjB,SAAdzE,aAA0B2Z,GAAkBrX,EAAE,qBAAqBoE,GAAG,aAEzEpE,EAAE,kBAAkBqC,OAIpBrC,EAAE,kBAAkBoC,OAGH,SAAd1E,aAA0BsC,EAAE,qBAAqBoE,GAAG,aAAe1H,gBAEtEsD,EAAE,gCAAgC2E,KAAK,YAAY,GAInD3E,EAAE,gCAAgC2E,KAAK,YAAY,GAIlC,UAAdjH,YAA0Bka,oBAE7B5X,EAAE,sBAAsBqC,OACpBgV,GAAkB3a,gBAAkBsD,EAAE,sBAAsBoE,GAAG,aAElE7H,0BAA2B,EAC3ByD,EAAE,kBAAkB2E,KAAK,YAAY,GACrC3E,EAAE,iBAAiBqC,SAInBrC,EAAE,kBAAkB2E,KAAK,YAAY,GACrC3E,EAAE,iBAAiBoC,SAKpBpC,EAAE,sBAAsBoC,OAGrB9F,aAAeC,yBAElByD,EAAE,kBAAkBgC,SAAS,qBAI7BhC,EAAE,kBAAkBmC,YAAY,qBAGjCuT,gBACD,CAEA,SAASmC,iBAAiB9P,GAKzB,GAAIA,EAAIoL,QACR,CACC,IAAI2E,EAAUvI,OAAOvP,EAAE,wBAAwBkC,QAE3C6V,0BAA4BC,gBAAkB,GAAKF,EAAU,GAE5DA,EAAU,GAEb9X,EAAE,kBAAkBC,IAAI,YACxBgY,eAAe,aAIfC,4BAA4BJ,IAMzBA,EAAU,IAEb9X,EAAE,kBAAkBC,IAAI,aACxBgY,eAAe,cAGhBE,+BAA+BL,GAEjC,MAWC,IAAKM,QAP4B,IAA7BpY,EAAE,kBAAkBC,QAEvBD,EAAE,kBAAkBC,IAAI,IACxBgY,eAAe,KAIFI,2BAEbrY,EAAE,UAAYoY,OAAOnY,IAAI,IAO3BqY,qBAAoB,EACrB,CAEA,SAASC,6BAER,IAAI5C,EAAU,GACV6C,EAAW,EACXC,EAAa,EAQjB,IAAK,IAAI7C,KANLxY,0CAEHuY,GAAW,gKAIK9Y,WAAWgZ,aAEvBhZ,WAAWgZ,aAAa5I,eAAe2I,KAGtC/Y,WAAWgZ,aAAaD,GAAQ,EAEnC4C,IAIAC,KAKCD,IAEH7C,GAAW6C,EAAW,qCAEnBC,IAEH9C,GAAW8C,EAAa,uCAGzB,IAAIC,EAAU,EACVC,EAAY,EAEhB,IAAK,IAAI/C,KAAQ/Y,WAAWkZ,YAEvBlZ,WAAWkZ,YAAY9I,eAAe2I,KAErC/Y,WAAWkZ,YAAYH,GAAQ,EAElC8C,IAIAC,KAcH,IAAK,IAAI/C,KATL8C,IAEH/C,GAAW+C,EAAU,+CAElBC,IAEHhD,GAAWgD,EAAY,iDAGP9b,WAAWoZ,UAGvBpZ,WAAWoZ,UAAUhJ,eAAe2I,KAGnC/Y,WAAWoZ,UAAUL,GAAc,OAAI/Y,WAAWoZ,UAAUL,GAAc,OAEjC,GAAxC/Y,WAAWoZ,UAAUL,GAAc,OAEtCD,GAAW,SAAWO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,SAInHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,cAAc/K,WAAWoZ,UAAUL,GAAY,MAAK,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,SAMzI,GAAxC/Y,WAAWoZ,UAAUL,GAAc,OAEtCD,GAAW,WAAaO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,SAIrHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,eAAoD,EAAtC/K,WAAWoZ,UAAUL,GAAY,MAAU,QAAUhO,cAAc/K,WAAWoZ,UAAUL,GAAc,QAAK,UAO7L,IAAK,IAAIA,KAAQ/Y,WAAWsZ,UAEvBtZ,WAAWsZ,UAAUlJ,eAAe2I,KAEvCD,GAAWO,qBAAqBN,GAAQ,kBAIb,IAAzB/Y,WAAWuZ,aAEdT,GAAW,qBAAuB9Y,WAAWuZ,WAAa,SAG3D,IAAIwC,EAAU,EACVC,EAAY,EAGhB,IAAK,IAAIjD,KADT9W,OAAQ,EACSjC,WAAWwZ,YAEvBvX,QAEC+F,aAEH8Q,GAAW,yCAIXA,GAAW,4BAGZ7W,OAAQ,GAGLjC,WAAWwZ,YAAYpJ,eAAe2I,KAErC/Y,WAAWwZ,YAAYT,GAAQ,EAElCgD,IAIAC,KAmBH,IAAK,IAAIjD,KAfLgD,IAEHjD,GAAWiD,EAAU,4BAElBC,IAEHlD,GAAWkD,EAAY,8BAGT,IAAXlD,IAEHA,EAAU,4BAA8BA,GAGzC7W,OAAQ,EACSjC,WAAWyZ,UAEvBxX,QAEH6W,GAAW,qBACX7W,OAAQ,GAGLjC,WAAWyZ,UAAUrJ,eAAe2I,KAEnC/Y,WAAWyZ,UAAUV,GAAc,OAAI/Y,WAAWyZ,UAAUV,GAAc,OAEjC,GAAxC/Y,WAAWyZ,UAAUV,GAAc,OAEtCD,GAAW,SAAWO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,SAInHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,cAAc/K,WAAWyZ,UAAUV,GAAY,MAAK,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,SAMzI,GAAxC/Y,WAAWyZ,UAAUV,GAAc,OAEtCD,GAAW,WAAaO,qBAAqBN,GAAQ,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,SAIrHD,GAAWO,qBAAqBN,GAAQ,sBAAwBhO,eAAoD,EAAtC/K,WAAWyZ,UAAUV,GAAY,MAAU,QAAUhO,cAAc/K,WAAWyZ,UAAUV,GAAc,QAAK,UAc7L,OAPI5V,EAAE,eAAeoE,GAAG,cAEvBuR,GAAW,2DAA6D3V,EAAE,eAAekC,OAAS,WAInGyT,EAAU,kCAAoCA,EAAU,QAEzD,CAEA,SAASmD,0BAER,IAAI5I,EAAelQ,EAAE,0BAA0BC,MAC3CuO,EAAkBxO,EAAE,sBAAsBC,MAC1CkQ,EAAcnQ,EAAE,0BAA0BC,MAC1CqM,EAAMtM,EAAE,6BAA6BC,MAEzCD,EAAEE,KAAK,CACNhB,IAAK,aACLiB,KAAM,OACNC,QAAS,IACTgQ,OAAO,EACP/P,SAAU,OACVC,KAAM,CACLC,UAAW,4BACXhD,SAAUC,cAAcC,GACxBgD,GAAI,YACJC,SAAUA,SACVuN,OAAQ3B,EACR9L,QAASA,QACT0P,aAAcA,EACd1B,gBAAiBA,EACjB2B,YAAaA,EACb5J,cAAevG,EAAE,4BAA6B,eAAeC,MAC7DoQ,aAAa,GAEd1P,QAAS,SAAUC,IAElBZ,EAAE,4BAA6B,eAAeC,IAAIW,EAAK8F,eAEnD9F,EAAKC,oBAGRpB,eAAe,kDAIfyL,KAFYtK,EAAKuK,MAEL,GAAG,GAAO,GAAM,GAAM,KAKlCnL,EAAE,eAAegE,SAEjBvE,eAAe,sCAAwCmB,EAAKG,mBAE5DC,WAAW,CACVC,MAAO,QACPvB,QAASkB,EAAKG,oBAIjB,EACAG,MAAO,SAAUC,EAAgBC,GAEhCpB,EAAE,eAAegE,SAEjBvE,eAAe,sCAAwC2B,EAAW,MAAQD,EAAeE,cAEzFC,SAAW,qBAAuBF,EAClCJ,WAAW,CACVC,MAAO,QACPvB,QAAS4B,UAGX,GAIF,CAEA,SAASyX,aAERtZ,eAAe,uBAEf,IAAIuZ,EAAOhZ,EAAE,eAAe,GAI5B,GAFeiZ,uBAAuBD,GAGtC,CACC,IAAItZ,EAAU,uEAIVwZ,EAAe,KAFnBxZ,GAAW,eADQ6Y,8BAKPvZ,OAAS,IAEpBka,EAAe,IAEPxZ,EAAQV,OAAS,MAEzBka,EAAe,KAGhBlY,WAAW,CACVC,MAAO,WACPvB,QAASA,EACT4D,OAAO,EACPD,MAAO,IACPD,OAAQ8V,EACR1U,QAAS,WAGJyL,+BAA8D,MAA7BjQ,EAAE,kBAAkBC,OAExDR,eAAe,0BAEVmY,mBAMJkB,yBAAwB,GAAM,GAJ9BrP,mBAAkB,GAAM,KASzBzJ,EAAE,WAAW2E,KAAK,CACjBxE,KAAM,SACNgZ,KAAM,aACN9R,MAAO8C,KAAKC,UAAUvN,cACpBuc,SAASpZ,EAAEgZ,IAEdhZ,EAAE,WAAW2E,KAAK,CACjBxE,KAAM,SACNgZ,KAAM,gBACN9R,MAAOlE,sBACLiW,SAASpZ,EAAEgZ,IAEdhZ,EAAE,mBAAmBC,IAAI,QACzBD,EAAE,eAAeqZ,SAEnB,GAGF,CACD,CAEA,SAASC,YAER7Z,eAAe,sBAEfgH,OAAOjI,OAAOC,SAASsN,KACxB,CAEA,SAASkN,uBAAuBD,GAK/B,GAFAvZ,eAAe,mCAEG,OAAd/B,YAAqC,SAAdA,WAE1B,OAAO,EAGR,GAAII,UACJ,CACC,IAAI6R,GAAmB,EAMvB,GALI3P,EAAE,mBAAmBoE,GAAG,cAE3BuL,GAAmB,GAGhBA,EACJ,CAEC,IAAIC,EAAeC,2BACnB,GAAID,EAAe,GAQlB,OALA5O,WAAW,CACVC,MAAO,QACPvB,QAAS,yEAGH,EAEH,GAAIkQ,EAAe,GAOvB,OALA5O,WAAW,CACVC,MAAO,QACPvB,QAAS,6EAGH,CAET,CACD,CAEA,OAAI1C,uBAEHgE,WAAW,CACVC,MAAO,QACPvB,QAAS,yFAEH,GAGD6Z,YAAYP,EACpB,CAIA,SAASQ,gBAAgBC,GAIxB,IAAIC,EAAqB,KAFzBD,GAAY,MAeZ,OAZAC,EAAUC,SAASD,IAKlBA,GAJDA,GAAoB,IACUE,KAAKC,MAAMH,IACpB,GAEVE,KAAKC,MAAMH,GAAW,EAItBE,KAAKC,MAAMH,IAGL,GAClB,CA+HA,SAASI,wBAAwBC,EAAW1E,GAE3C,GAAW,GAAPA,EACJ,CACCrY,uBAAwB,EACxBgd,EAAe,yDACf,IAAIC,EAAkB,oBAAsBF,EAK5C,OAJIG,EAAkBla,EAAE,IAAMia,IACdE,IAAI,QAAS,gBAC7BD,EAAgBhY,KAAK8X,EAGtB,CAEA,IAAII,EAAoB/E,EAAMgF,sBAAsBN,GAAWO,sBAE/Dta,EAAE,KADwB,0BAA4B+Z,IACzB7X,KAAKkY,GAElC,IAAIG,EAAc,EAElBva,EAAEuB,KAAK8Y,sBAAsBN,GAAWS,QAAQ,SAAUC,EAAKC,GAG9D,IAAIC,EAAU3a,EAAE,QAAUya,GAE1B,GAAIE,GAA4B,IAAjBA,EAAQ1a,MACvB,CAC6B,GAAxBiD,MAAMyX,EAAQ1a,QAAkB0a,EAAQ1a,MAAQ0Z,SAASgB,EAAQ1a,QAAU,GAE9E0a,EAAQ1a,IAAI,GAGT0a,EAAQ1a,MAAQ,IAEnB0a,EAAQ1a,IAAI0Z,SAASgB,EAAQ1a,QAC7Bsa,GAAgC,EAAhBI,EAAQ1a,OAGzB,IAAI2a,EAAUC,uBAAuBJ,GAAKK,UAC1CF,GAAYD,EAAQ1a,MAAQya,EAAMK,kBAElC/a,EAAE,YAAcya,GAAKvY,KAAK0Y,GAE1B5a,EAAE,QAAUya,GAAKvY,KAAK0Y,GAEtBC,uBAAuBJ,GAAKK,UAAYF,CAEzC,CAED,IAGA5a,EAAE,KADwB,0BAA4B+Z,IACzB7X,KAAKqY,GAE9BN,EAAkB,oBAAsBF,EAA5C,IACIG,EAAkBla,EAAE,IAAMia,GAC1BD,EAAe,GACA,GAAfO,GAEHP,EAAe,iBAAmBI,EAAoB,UACtDF,EAAgBC,IAAI,QAAS,WAC7Bnd,uBAAwB,GAEhBud,EAAcH,GAEtBJ,EAAe,sBAAwBO,EAAcH,GAAqB,wDAA0DG,EAAcH,GAAqB,UACvKF,EAAgBC,IAAI,QAAS,WAC7Bnd,uBAAwB,GAEhBud,EAAcH,GAEtBJ,EAAe,sBAAwBI,EAAoBG,GAAe,qDAAuDH,EAAoBG,GAAgB,UACrKL,EAAgBC,IAAI,QAAS,WAC7Bnd,uBAAwB,IAIxBgd,EAAe,+GACfE,EAAgBC,IAAI,QAAS,WAC7Bnd,uBAAwB,GAGzBkd,EAAgBhY,KAAK8X,EAEtB,CAGA,SAAS9b,iBAGR,IAAI4W,EAAQ,EAERkG,EAAW,EACXC,EAAU,EACVC,EAAW,EAEXC,EAAc,EACdC,EAAmB,EAInBC,EAAmB,EACnBC,EAAqB,EAIrB3L,GAAmB,EAInBoD,EAAiB,EAEjBwI,EAAqB,GACrBC,EAAgB,GAWpB,IAAK,IAAIC,KATL3d,WAECkC,EAAE,mBAAmBoE,GAAG,cAE3BuL,GAAmB,GAKPkL,uBAEbA,uBAAuBY,GAAGX,UAAYD,uBAAuBY,GAAGC,cAChE1b,EAAE,QAAUyb,GAAGvZ,KAAK2Y,uBAAuBY,GAAGC,eA8H/C,GArHA1b,EAAE,gBAAgBuB,MAAK,WAItB,GAAqB,IAAjBvB,EAAEwB,MAAMvB,MACZ,CAC6B,GAAxBiD,MAAMlD,EAAEwB,MAAMvB,QAAkBD,EAAEwB,MAAMvB,MAAQ0Z,SAAS3Z,EAAEwB,MAAMvB,MAAO,KAAO,GAElFD,EAAEwB,MAAMvB,IAAI,GAGb,IAAI0a,EAAU3a,EAAEwB,MAAMvB,MAClB0b,EAASna,KAAK/D,GAAGmB,MAAM,KAAK,GAEhC,GAAK9B,kBACL,CACC,IAAI8e,EAAY5b,EAAEwB,MAAMlB,KAAK,aAC7B,GAA+B,OAA3BN,EAAEwB,MAAMlB,KAAK,WAEZsb,EAAYjB,GAEfnD,KAAOmD,EAAUiB,EACjBN,GAAuB9D,KAAOxX,EAAEwB,MAAMlB,KAAK,UAEnCqa,EAAWiB,IAEnBpE,KAAOoE,EAAYjB,EACnBW,GAAuB9D,KAAOxX,EAAEwB,MAAMlB,KAAK,eAKxCsb,EAAYjB,EAAQkB,aAAa,mBACrBlB,GAEfnD,KAAOmD,EAAWiB,EAClB7I,GAAmByE,KAAOxX,EAAEwB,MAAMlB,KAAK,UAE/Bqa,EAAUiB,IAElBpE,KAAOoE,EAAYjB,EACnBW,GAAuB9D,KAAOxX,EAAEwB,MAAMlB,KAAK,SAG9C,CAEA,GAAwB,GAAlB4C,MAAMyX,GACZ,CACC,IAAIZ,EAAY/Z,EAAEwB,MAAMlB,KAAK,YACzBsa,EAAUC,uBAAuBd,GAAWe,UAMhD,GAJAF,GAAqBD,EADDpL,OAAOvP,EAAEwB,MAAMlB,KAAK,aAExCN,EAAE,QAAU+Z,GAAW7X,KAAK0Y,GAC5BC,uBAAuBd,GAAWe,UAAYF,EAEf,OAA3B5a,EAAEwB,MAAMlB,KAAK,YAGZqa,EAAU,EACd,CACC,IAAI5S,EAAM,CACTtK,GAAIke,EACJtG,IAAKsF,EACL/F,MAAO5U,EAAEwB,MAAMlB,KAAK,SACpBgV,aAActV,EAAEwB,MAAMlB,KAAK,aAG5Bib,EAAmBO,KAAK/T,EAEzB,CAID+M,GAAS6F,EAAU3a,EAAEwB,MAAMlB,KAAK,SAED,OAA3BN,EAAEwB,MAAMlB,KAAK,YAEK,EAAVqa,EACXK,GAAYL,EAAU3a,EAAEwB,MAAMlB,KAAK,YAEC,QAAhCN,EAAEwB,MAAMlB,KAAK,gBAEhB4a,GAAsB,EAAVP,EAIZM,GAAqB,EAAVN,IAOZQ,GAAyB,EAAVR,EACfS,GAAoBT,EAAU3a,EAAEwB,MAAMlB,KAAK,UAGX,QAA7BN,EAAEwB,MAAMlB,KAAK,eAEGqa,EAAU3a,EAAEwB,MAAMlB,KAAK,SACjB,EAAVqa,GAGhBa,EAAcG,GAAUhB,EAExB3a,EAAE,YAAc+Z,GAAW7X,KAAK0Y,EACjC,CAEiC,QAA7B5a,EAAEwB,MAAMlB,KAAK,cAEhBwZ,wBAAwBC,EAAWY,EAErC,CACD,IAEmBM,EAAUC,EAAYC,EAErCrd,UAEH,GAAIie,oBACJ,CAEC,IAAIC,EAA0B,EAC1BC,EAA8B,EAE9BtM,EAGH3P,EAAE,gBAAgBuB,MAAK,WAEtB,GAAiC,KAA7BvB,EAAEwB,MAAMlB,KAAK,aAEhB,GAAKN,EAAEwB,MAAM4C,GAAG,YASf4X,IACAC,GAA+Bjc,EAAEwB,MAAMlB,KAAK,gBAT7C,CACC,IAAIsa,EAAUC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAC/DF,GAAoB5a,EAAEwB,MAAMlB,KAAK,YACjCN,EAAE,QAAUA,EAAEwB,MAAMlB,KAAK,aAAa4B,KAAK0Y,GAC3CC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAAYF,CAC9D,MASA,GAAI5a,EAAEwB,MAAM4C,GAAG,YACf,CACKwW,EAAUC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAC/DF,GAAoB5a,EAAEwB,MAAMlB,KAAK,YACjCN,EAAE,SAAWA,EAAEwB,MAAMlB,KAAK,aAAa4B,KAAK0Y,GAC5CC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAAYF,EAC7DoB,IACAC,GAA+Bjc,EAAEwB,MAAMlB,KAAK,WAC7C,CAGF,IAMAN,EAAE,gBAAgBuB,MAAK,WAEtB,GAAiC,KAA7BvB,EAAEwB,MAAMlB,KAAK,aACjB,CACC,IAAIsa,EAAUC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAC/DF,GAAoB5a,EAAEwB,MAAMlB,KAAK,YACjCN,EAAE,QAAUA,EAAEwB,MAAMlB,KAAK,aAAa4B,KAAK0Y,GAC3CC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAAYF,CAE9D,CACD,GAGF,KAEA,CACKoB,EAA0B,EAC1BC,EAA8B,EAC9BtM,GAGH3P,EAAE,gBAAgBuB,MAAK,WAEtB,GAAIvB,EAAEwB,MAAM4C,GAAG,YACf,CACC,IAAIwW,EAAUC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAC/DF,GAAoB5a,EAAEwB,MAAMlB,KAAK,YACjCN,EAAE,QAAUA,EAAEwB,MAAMlB,KAAK,aAAa4B,KAAK0Y,GAC3CC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAAYF,EAC7DoB,IACAC,GAA+Bjc,EAAEwB,MAAMlB,KAAK,WAC7C,CAED,GAIF,CAeD,GAXIxC,WAGC6R,IAEHmF,GAA6B,EAAnBoH,WAAWtH,MACrBsG,GAAYc,EACZhB,GAAYiB,GAIVE,qBAECC,oBACJ,CAEC,IAAIC,EAA+B,EAC/BC,EAA8B,EAC9BL,EAA8B,EAElCnH,GAASyH,gBAETvc,EAAE,gBAAgBuB,MAAK,WAGtB,IAAIib,EAAexc,EAAEwB,MAAMvB,MAC3B,GAAIuc,EAAe,EACnB,CACCxB,GAAahb,EAAEwB,MAAMlB,KAAK,YAAckc,EACR,GAA5Bxc,EAAEwB,MAAMlB,KAAK,YAEhBgc,GAA+C,EAAfE,EAIhCH,GAAgD,EAAfG,EAGlC,IAAI5B,EAAUC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAC/DF,GAAoC,EAAf4B,EACrBxc,EAAE,QAAUA,EAAEwB,MAAMlB,KAAK,aAAa4B,KAAK0Y,GAC3CC,uBAAuB7a,EAAEwB,MAAMlB,KAAK,aAAawa,UAAYF,CAC9D,CACD,IAEAM,GAA4C,EAA/BmB,EACbpB,GAA0C,EAA9BqB,CAEb,CAGD,IAAIG,EAAgC,EAEpC,GAAIzc,EAAE,mBAAmBoE,GAAG,YAE3BpE,EAAE,+BAA+BkC,KAAK0F,cAAc,QAGrD,CAaC,GAZA6U,EAAgC5H,iCAAiC0G,EAAoBzG,GAElF1X,yCAA0C,EAEtCqf,GAAiCpf,0BAAuD,GAA5BA,0BAE/DD,yCAA0C,GAG3CC,wBAA0Bof,EAGzBC,mBAGHD,GADoBlN,OAAO/M,SAASgT,eAAe,eAAenO,QAE9B,IAEnCoV,EAAgC,GAKlCzc,EAAE,+BAA+BkC,KAAK0F,cAAc6U,GACrD,CAEIA,GAAiC,GAEpCzc,EAAE,0BAA0B2E,KAAK,WAAY,YAC7C3E,EAAE,0BAA0Bma,IAAI,CAC/B,mBAAoB,UACpBwC,MAAS,YAEV3c,EAAE,6BAA6BqC,QAGtBuV,qBAET5X,EAAE,0BAA0B4c,WAAW,YACvC5c,EAAE,0BAA0Bma,IAAI,CAC/B,mBAAoB,UACpBwC,MAAS,YAEV3c,EAAE,6BAA6BoC,QAKhC,IAAIya,EAAoD,EAAtC7c,EAAE,2BAA2BkC,OAC3C4a,EAA2D,EAA1C9c,EAAE,+BAA+BkC,OAGlD4a,GAFAC,EAAoD,EAApC/c,EAAE,0BAA0BC,QAI/CD,EAAE,0BAA0BC,IAAI6c,GAG7BD,EAAcC,EAEjB9c,EAAE,qCAAqCqC,OAIvCrC,EAAE,qCAAqCoC,OAGxCiZ,EAAmBvG,EAEnB,IAAIkI,EAAiB,EACjBC,EAAY,EAMhBjd,EAAE,gBAAgBuB,MAAK,WAGtB,IAAgC,GAA5BC,KAAK/D,GAAGqR,QAAQ,QACpB,CACC,IAAIoO,EAAa1b,KAAK/D,GAAG0R,OAAO,GAE5BgO,EAAU,OAASD,EACnBE,EAAU,OAASF,EAEnBG,EAASrd,EAAE,IAAMmd,GAASld,MAC1Bqd,EAAkB/N,OAAO8N,GACzBE,EAASvd,EAAE,IAAMod,GAASlb,OAC1Bsb,EAAejO,OAAOgO,GAC1BP,GAAmBzN,OAAOgO,GAAUF,EACpCJ,GAAaK,EAGb,IAAI1C,EAAUC,uBAAuBqC,GAAYpC,UAEjDF,GAAoByC,EACpBrd,EAAE,QAAUkd,GAAYhb,KAAK0Y,EAAQ6C,YACrC5C,uBAAuBqC,GAAYpC,UAAYF,EAE1C9d,oBAEJ8e,UAAYpZ,SAASgT,eAAe2H,GAAStB,aAAa,kBACtDD,UAAY0B,GAEf9F,KAAO8F,EAAkB1B,UACzB7I,GAAmByE,KAAOgG,GAElBH,EAASzB,YAEjBpE,KAAOoE,UAAYyB,EACnB/B,GAAuB9D,KAAOgG,GAGjC,CACD,IAEwBjO,OAAO0L,EAAUC,GAAzC,IAEIwC,EAAiB1d,EAAE,yBAEnB2d,EAA4B,EAC5BC,EAA4B,EAG5BC,EAAiB7d,EAAE,gBACnB6d,EAAe7e,QAAkC,aAAxB6e,EAAe5d,QAE3C6d,SAAWvO,OAAOvP,EAAE,yBAAyBC,OAEzC6d,SAAW,IAEdF,GAA6BE,SAC7BH,MAI+B,GAA7BA,GAEHI,iBA3bc,EA2bgB7C,EAAWD,EAAUE,EAAc8B,EACjEe,oBAAsBhD,EACtB0C,EAAexb,KAAK,sBAIpB6b,iBAjcc,EAicgB7C,EAAYC,EAAcF,EAAU0C,EAA4BV,EAC9Fe,oBAAsBhD,EAAW4C,EACjCF,EAAexb,KAAK,qCAGjB+b,mBAEHF,kBAAoBG,aAIrBle,EAAE,mBAAmBkC,KAAK6b,kBAC1B/d,EAAE,wBAAwBkC,KAAK8b,qBAE/B,IAEIG,EAAgB,GAIpBN,EAAiB7d,EAAE,iBACAhB,QAAkC,aAAxB6e,EAAe5d,QAE3Cke,EAAgB5O,OAAOvP,EAAE,gBAAgBC,QAErB,IAEnBob,GAAoB8C,GAItB9C,GAAoB2B,EAEhBiB,mBAEH5C,GAAoB+C,gBAGrB/C,EAAmBzB,KAAKyE,MAAuB,IAAjBhD,GAAsB,IAGpDrb,EAAE,kBAAkBC,IAAI2H,cAAcgS,KAAKyE,MAAY,IAANvJ,GAAW,MAC5D9U,EAAE,sBAAsBkC,KAAK0F,cAAcyT,IAC3Crb,EAAE,eAAeC,IAAI2H,cAAcyT,IAInC,IAAI5F,EAAmBlG,OAAO/M,SAASgT,eAAe,sBAAsBnO,OAIxEiX,EAAiC,EAAnBjD,EAA2C,EAAlB5F,EACvC8I,EAAyBD,EAC7Bte,EAAE,2BAA2BkC,KAAK0F,cAAkC,EAAnByT,EAA2C,EAAlB5F,IAE1E,IAAI+I,EAAgBnD,EAChBoD,EAA4BD,EAM5BzB,EAAgB,EAEf/c,EAAE,0BAA0BhB,UAEhC+d,EAAgB/c,EAAE,0BAA0BC,OACxBwc,IAEnBM,EAAgBN,EAChBzc,EAAE,0BAA0BC,IAAI2H,cAAcmV,KAQ/CyB,EAAgB5W,cAAc4W,EAAgBzB,IAI/C,IAAI2B,EAAoBnP,OAAO,GAqC/B,GAnCAoP,eAAiB3e,EAAE,0BACS,IAAxB2e,eAAe1e,OAElB0e,eAAe1e,IAAI,QAEf0e,eAAe3f,UAEnB0f,EAAoBC,eAAe1e,OAEXqe,IAEvBI,EAAoBJ,EACpBK,eAAe1e,IAAIye,IAGhBA,IAEHF,EAAgB5W,cAAc4W,EAAgBE,GAC9C1e,EAAE,8BAA8BkC,KAAK0F,cAAc8W,MAMjD5hB,oBAIHkW,aAAgBsI,EAChBxI,kBAAkBC,IAMS,WAAxB6L,qBACJ,CACC,IAAIC,EAAoBJ,GAA6BK,kBAAoB,KAEzE9e,EAAE,gBAAgBC,IAAI4e,EACvB,CAEA,GAAInC,kBACJ,CACC,IAAIqC,EAAiB3D,EACjB2D,EAAiBD,oBAEpBC,EAAiBD,mBAGlB9e,EAAE,gBAAgBC,IAAI8e,EAEvB,CAEA,IAAIC,EAAoBzP,OAAO,GAqB/B,GApBAyE,eAAiBhU,EAAE,gBAEdgU,eAAehV,SAES,IAAxBgV,eAAe/T,OAElB+T,eAAe/T,IAAI,SAEpB+e,EAAoBhL,eAAe/T,SAIlCue,EAAgB5W,cAAc4W,EAAgBQ,GAC9Chf,EAAE,wBAAwBkC,KAAK0F,cAAcoX,IAC7CT,GAA0BS,IAK5BC,QAAUjf,EAAE,YACRif,QAAQjgB,OACZ,CACC,IAAIkgB,EAAalf,EAAE,0BAA2B,eAAeC,MAE3C,MAAdif,GAAoC,IAAdA,IAEzBA,EAAa,QAGd,IAAIC,GAAc,EAElBC,2BA5JqB,GA4J2BtK,EAAQuG,GACxD,IAAIgE,EAAS,OACTC,EAAgB,EAErB,GAAkB,GAAdC,YAEe,cAAdL,EAEH,GAAuB,QAAnBK,WAAWpf,KACf,CACC,IAAIqf,GAAQtE,EAxmBiB,GAwmBuBqE,WAAWlY,MAE/DmY,GADejQ,OAAO3H,eAAgBqT,EAxmBT,IAwmBiDsE,WAAWlY,MAAQ,KAEjG8X,EAAavX,cAAcyT,EAAmBmE,EAAOpE,EAAmB4B,EApnBpD,EAQK,GA6mBzBqC,EAAS,MAEV,MACK,GAAuB,WAAnBE,WAAWpf,KACpB,CACC,IAGIsf,EAAqBjG,iBAHbiF,EAA4BrD,EAAmB4B,EA1nBvC,IA2nBHuC,WAAWlY,MAAQ,MAGpC8X,EAAavX,cAAe6X,GAC5BJ,EAAS,OACTC,EAAgBC,WAAWlY,MAAQ,GACpC,CAID,GAAgB,GAAZqY,UAEe,YAAdR,EAEH,GAAqB,QAAjBQ,SAASvf,KACb,CACKqf,GAAQtE,EAloBgB,GAkoBwBwE,SAASrY,MAE7DmY,GADgBjQ,OAAO3H,eAAgBqT,EAloBX,IAkoBmDsE,WAAWlY,MAAQ,KAGlG8X,EAAavX,eAAmI,GAApHwX,2BAA6BI,EAAOpE,EAAkB4B,EA/oB/D,EAQK,IAwoBxBqC,EAAS,MACV,MACK,GAAqB,WAAjBK,SAASvf,KAClB,CAIKsf,EAAqBjG,iBAHbiF,EAA4BrD,EAAmB4B,EAppBxC,IAqpBF0C,SAASrY,MAAQ,MAGlC8X,EAAavX,cAAe6X,GAC5BJ,EAAS,OACTC,EAAgBI,SAASrY,MAAQ,GAClC,CAKgB,QAAd6X,IAEHC,EAAa,GAGA,QAAVE,GAEqB,oBAAbM,UAA4BA,SAAW,GAAKR,EAAa,IAEnEA,GAAcQ,UAGXxB,EAAgB,GAAKgB,EAAa,IAErCA,GAAchB,IAGG,QAAVkB,IAEgB,oBAAbM,UAA4BA,SAAW,GAAKR,EAAa,IAEnEA,GAAeQ,SAAWL,EAC1BH,EAAavF,KAAKyE,MAAmB,IAAbc,GAAoB,KAGzChB,EAAgB,GAAKgB,EAAa,IAErCA,GAAehB,EAAgBmB,EAC/BH,EAAavF,KAAKyE,MAAmB,IAAbc,GAAoB,OAI3B,GAAfA,IAEHS,eAAiB5f,EAAE,kBACf4f,eAAe5gB,SAElB4gB,eAAe1d,KAAK0F,cAAcuX,IAClCX,EAAgB5W,cAAc4W,EAAgBW,GAC9CZ,GAA0BY,GAI7B,CAIAX,EAAgBjP,OAAwB,EAAhBiP,EAAyC,EAAnB/I,GAC9CzV,EAAE,2BAA2BkC,KAAK0F,cAAc6N,IAEhD,IAAInC,EAAa/D,OAAOvP,EAAE,yBAAyBC,OAInD,GAHAD,EAAE,6BAA6BkC,KAAK0F,cAAc0L,IAClDkL,EAAgBjP,OAAwB,EAAhBiP,EAAmC,EAAblL,GAE1CyJ,EAAgB,EACpB,CACC,IAAI8C,EAAgC,EAChCC,EAA+B,EAEnC,GAAIC,qBAAuBzM,EAAa,EAGnCyJ,EAAgBzJ,GAEnBuM,EAAgC9C,EAAgBzJ,EAChDwM,EAA+BxM,IAI/BwM,EAA+B/C,EAC/B8C,EAAgC,OAIlC,CACC,IAAIG,EAA4BvD,EAAgCnJ,EAEhE,GAAIyJ,EAAgBiD,EAGnBH,EAAgCG,EAChCF,EAFiC/C,EAAgBiD,OAMjDH,EAAgC9C,EAChC+C,EAA+B,CAEjC,CAEA9f,EAAE,yCAAyCkC,KAAK0F,cAAciY,IAC9D7f,EAAE,wCAAwCkC,KAAK0F,cAAckY,GAC9D,MAGC9f,EAAE,yCAAyCkC,KAAK0F,cAAc,IAC9D5H,EAAE,wCAAwCkC,KAAK0F,cAAc,IAQ9D,GADAqY,SAAWjgB,EAAE,iBACTigB,SAASjhB,OACb,CAECuf,EAAyBhP,OAAiC,EAAzBgP,EAAmD,EAApBG,EAA0D,EAAhCmB,GAE1F,IAAIK,EAAalgB,EAAE,+BAAgC,eAAeC,MAEhD,MAAdigB,GAAoC,IAAdA,IACzBA,EAAa,QAEd,IAAIC,GAAmB,EAItBA,EAFiB,cAAdD,EAEetY,eAAe2W,EAAyB,WAAe6B,WAAW/Y,MAAQ,KAAO,KAE7E,YAAd6Y,EAEUtY,cAAe2W,EAAyBjX,sBAAsBD,MAAS,KAIvE,EAInBgZ,cAAgBrgB,EAAE,yBACdqgB,cAAcrhB,SAEjBqhB,cAAcne,KAAK0F,cAAcuY,IACjC3B,EAAgB5W,cAAc4W,EAAgB2B,GAGhD,CAGA,IAAIG,EAAsB/Q,OAAOvP,EAAE,0BAA0BC,OAC7DD,EAAE,8BAA8BkC,KAAK0F,cAAc0Y,IACnD9B,EAAgBjP,OAAwB,EAAhBiP,EAA4C,EAAtB8B,GAM9C,IAAIC,EAAgB3Y,cAAc0Y,GAAuBE,cAAgB,MAEzED,GAAiB,EACjBA,GAAkC,EAFd3Y,cAAkC6Y,iBAAmB,IArzBlD,GA+zBtBzgB,EAAE,oBAAoBkC,KAAK,gBAG5B,IAAIwe,EAAa,EACbC,EAAgB,EAGhB5D,EAAgB,GAEnB2D,EAAa9Y,eAAgB4W,EAAiC,EAAhBzB,EAAqBuD,EAAsBhN,EAAauM,IAAkCe,WAAa,KAAS,MAC9JD,EAAgB/Y,eAAgB0L,EAAcwM,IAAiCe,cAAgB,KAAS,QAIxGH,EAAa9Y,eAAgB4W,EAAgB8B,EAAsBhN,IAAesN,WAAa,KAAS,MACxGD,EAAgB/Y,cAAc0L,GAAcuN,cAAgB,KAAQ,OAGrEC,QAAUte,SAASgT,eAAe,oBAC7BsL,UACJA,QAAQC,UAAYnZ,cAAc2Y,IAEnCO,QAAUte,SAASgT,eAAe,yBAC7BsL,UACJA,QAAQC,UAAYnZ,cAAc8Y,IAEnCI,QAAUte,SAASgT,eAAe,4BAC7BsL,UACJA,QAAQC,UAAYnZ,cAAc+Y,IAEnC,IAAIK,GAAczR,OAAOiP,GACzBA,EAAiC,EAAhBA,EAAmC,EAAbkC,EAAmC,EAAhBH,EAAsC,EAAhBI,EAGhF3gB,EAAE,mBAAmBkC,KAAK0F,cAAc4W,IACxCxe,EAAE,kBAAkBkC,KAAK0F,cAAc4W,IACvCxe,EAAE,cAAckC,KAAK0F,eAAuD,GAAxCqZ,oBAAsBzC,KAE1D,IAAI0C,GAAe,EAChBlhB,EAAE,sBAAsBhB,SAE1BkiB,GAAelhB,EAAE,sBAAsBkC,QAGxC,IAAIif,GAAmB5R,OAAO3H,cAAcsZ,GAAe1C,IAa3D,GAZAxe,EAAE,wBAAwBkC,KAAK0F,eAAkC,EAApBuZ,KAK3B,aAAdzjB,aAEHyjB,GAAmBD,GACnBlhB,EAAE,wBAAwBkC,KAAK0F,cAAcuZ,MAI1CA,GAAmB,EAEtBnhB,EAAE,gBAAgBkC,KAAK0F,eAAkC,EAApBuZ,IAAyB,0BAC9DnhB,EAAE,eAAegC,SAAS,6BAC1BhC,EAAE,kBAAkBoC,OAEhB2V,yBAA2BC,gBAAkB,EAEhDhY,EAAE,uBAAuBqC,OAIzBrC,EAAE,cAAcqC,OAIjBrC,EAAE,kBAAkBC,IAAI,IACxBD,EAAE,kBAAkBC,IAAI,IACxBgY,eAAe,IACfmJ,eAAe,IAEf1kB,gBAAiB,EAEjBsD,EAAE,sBAAsBuE,KAAK,WAAW,GACxCvE,EAAE,sBAAsBuE,KAAK,YAAY,QAGrC,GAAI4c,GAAmB,EAC5B,CACCnhB,EAAE,gBAAgBkC,KAAK0F,eAAkC,EAApBuZ,IAAyB,wBAC9DnhB,EAAE,eAAegC,SAAS,0BAC1BhC,EAAE,kBAAkBqC,OACpBrC,EAAE,cAAcoC,OAEZ2V,yBAEH/X,EAAE,uBAAuBoC,OAG1BpC,EAAE,sBAAsBuE,KAAK,YAAY,GAGzC,IAIK8c,IAA2C,EAApBF,GAE3B,GAAInhB,EAAE,sBAAsBoE,GAAG,YAC/B,CAEC,IAAIkd,GAAoB/R,OAAOvP,EAAE,yBAAyBC,OACtDiD,MAAMoe,GAAkB9R,aAE3B8R,GAAoB/R,OAAO,IAG5B8R,IAAwBC,GAAkB9R,SAC3C,CAIA,GAFA6R,GAAuBzZ,cAAcyZ,IAEH,MAA9BrhB,EAAE,kBAAkBC,MAEvBD,EAAE,6BAA6BC,IAAIohB,SAE/B,GAAiC,SAA7BrhB,EAAE,kBAAkBC,MAE5BD,EAAE,gCAAgCC,IAAIohB,SAElC,GAA+C,OAA3CrhB,EAAE,kBAAkBC,MAAMrB,MAAM,KAAK,GAE7CoB,EAAE,8BAA8BC,IAAIohB,SAEhC,IAAkC,aAA7BrhB,EAAE,kBAAkBC,OAAqD,aAA7BD,EAAE,kBAAkBC,QAAsD,IAA7BD,EAAE,kBAAkBC,MACvH,CACC,IAAIshB,GAAiB,KACgB,aAA9BvhB,EAAE,kBAAkBC,MAE1BshB,GAAiBhS,OAAOvP,EAAE,6BAA6BC,OAEf,aAA7BD,EAAE,kBAAkBC,QAE/BshB,GAAiBhS,OAAOvP,EAAE,2BAA2BC,QAGlDiD,MAAMqe,GAAe/R,aAExB+R,GAAiBhS,OAAO,IAGzB8R,GAAuBzZ,cAAcyZ,GAAuBE,GAAe/R,WACtC,MAA9BxP,EAAE,kBAAkBC,MAEvBD,EAAE,6BAA6BC,IAAIohB,IAEE,SAA7BrhB,EAAE,kBAAkBC,MAE5BD,EAAE,gCAAgCC,IAAIohB,IAED,QAA7BrhB,EAAE,kBAAkBC,MAE5BD,EAAE,+BAA+BC,IAAIohB,IAEc,OAA3CrhB,EAAE,kBAAkBC,MAAMrB,MAAM,KAAK,IAE7CoB,EAAE,8BAA8BC,IAAIohB,GAGzC,CAGF,MAGCrhB,EAAE,gBAAgBkC,KAAK,QACvBlC,EAAE,eAAegC,SAAS,wBAC1BhC,EAAE,kBAAkBqC,OACpBrC,EAAE,cAAcoC,OAEZ2V,yBAEH/X,EAAE,uBAAuBoC,OAG1BpC,EAAE,sBAAsBuE,KAAK,YAAY,GAEzC4T,+BAA+B,GAGX,GAAjBqG,GAAmD,IAA7Bxe,EAAE,kBAAkBC,OAA4C,IAA7BD,EAAE,kBAAkBC,OAAgB9C,6CAA6D,SAAdO,aAE/IsC,EAAE,kBAAkBC,IAAI,QACxBgY,eAAe,QACfjY,EAAE,+BAA+BC,IAAI,QAErC9C,6CAA8C,GAI/C,IAAIqkB,GAAgBxhB,EAAE,kBACjBwhB,GAAcxiB,SAGM,GAApBmiB,IAAyBM,eAExB1J,0BAA4BC,gBAAkB,GAAKmJ,GAAmB,GAEzEnhB,EAAE,qBAAqBkC,KAAK,wFAIxBif,GAAmB,EAEtBnhB,EAAE,qBAAqBkC,KAAK,wFAI5BlC,EAAE,qBAAqBkC,KAAK,sFAI9Bsf,GAAcnf,OACTqf,wBAEJ1hB,EAAE,eAAeuE,KAAK,WAAW,GACjCsT,iBAAiB7X,EAAE,eAAe0K,MAAM,MAOlC8W,GAAcpd,GAAG,cAEvBod,GAAcpf,OACdpC,EAAE,eAAeuE,KAAK,WAAW,GACjCvE,EAAE,kBAAkBC,IAAI,IACxBD,EAAE,kBAAkBC,IAAI,IACxBgY,eAAe,IACfmJ,eAAe,MAKlBphB,EAAE,aAAakC,KAAK,IAGflC,EAAE,mBAAmBhB,SAGpBgc,EAAW,GAAKG,EAAc,GAAK6B,EAAiB,EAExDhd,EAAE,mBAAmBuE,KAAK,YAAY,GAItCvE,EAAE,mBAAmBuE,KAAK,YAAY,GAGnCma,GAAsBnP,OAAOyR,IAAezR,OAAOmP,IAAsC,GAAfsC,KAE7EhhB,EAAE,mBAAmBuE,KAAK,YAAY,GACtCvE,EAAE,aAAakC,KAAKlC,EAAE,aAAakC,OAAS,iKAK1ClC,EAAE,aAAahB,SAEW,IAAzBgB,EAAE,aAAakC,OAElBlC,EAAE,aAAaqC,OAIfrC,EAAE,aAAaoC,QAIjBkW,qBAAoB,GAEpBrQ,sBAEkB,OAAdvK,YAEHqH,kBAGF"}
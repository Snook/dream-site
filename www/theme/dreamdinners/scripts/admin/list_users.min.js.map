{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["list_users.js"],"sourcesContent":["var manualSearchTypeChange = false;\r\n\r\nfunction list_users_init()\r\n{\r\n\tshowHelpText();\r\n\t$('#q').focus();\r\n\t$('#q').bind('input', function() { detectType(); });\r\n}\r\n\r\nfunction searchTypeChange()\r\n{\r\n\tshowHelpText();\r\n\t$('#q').focus();\r\n\tmanualSearchTypeChange = true;\r\n}\r\n\r\nfunction showHelpText()\r\n{\r\n\tvar helpString = \"\";\r\n\tvar value = $('#search_type').val();\r\n\r\n\t$('#q').removeClass('telephone').unmask();\r\n\r\n\tswitch(value)\r\n\t{\r\n\t\tcase 'firstname':\r\n\t\t\thelpString = \"Enter full or partial first name\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'lastname':\r\n\t\t\thelpString = \"Enter full or partial last name\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'firstlast':\r\n\t\t\thelpString = \"Search Text Example: John Smith (Enter full or partial first and last name)\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'email':\r\n\t\thelpString = \"Instruction Text: Enter full or partial email address\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'phone':\r\n\t\t\thelpString = \"Instruction Text: Enter phone number in 555-555-5555 format\";\r\n\t\t\t$('#q').addClass('telephone');\r\n\t\t\t$('.telephone').mask('999-999-9999');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'id':\r\n\t\t\thelpString = \"Enter the exact Guest ID (No partial entries)\";\r\n\t\tbreak;\r\n\t}\r\n\r\n\t$('#search_help').show();\r\n\t$('#search_help').html(helpString);\r\n}\r\n\r\nvar codes = [];\r\nvar target_prefix = \"payment1_\";\r\nvar scanPosition = 0;\r\nvar charIndex = 0;\r\n\r\nfunction keyHandler2(evt)\r\n{\r\n\tevt = (evt) ? evt : event;\r\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\r\n\r\n\tif(charCode == 13)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcodes[charIndex++] = String.fromCharCode(charCode);\r\n\r\n\tif((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\r\n\t{\r\n\t\tscanPosition = 1; //start of data\r\n\t}\r\n\telse if((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\r\n\t{\r\n\t\tscanPosition = 2; // start of track 1\r\n\t}\r\n\telse if((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\r\n\t{\r\n\t\tscanPosition = 3;  // end of track 1\r\n\t}\r\n\telse if((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\r\n\t{\r\n\t\tscanPosition = 0;  // end of track 2\r\n\t\tcharIndex = 0;\r\n\t\thandleSwipeCompletion();\r\n\t}\r\n}\r\n\r\nfunction endScanHandling()\r\n{\r\n\tdocument.getElementById('scanArea').style.display = \"none\";\r\n\tcodes.length = 0;\r\n\tscanPosition = 0;\r\n\tcharIndex = 0;\r\n\tdocument.getElementById('hidden_text_store').value= \"\";\r\n}\r\n\r\nfunction prepareForCCSwipe(paymentNumber)\r\n{\r\n\tdocument.onkeypress = keyHandler2;\r\n\tdocument.getElementById('scanArea').style.display = \"block\";\r\n\tdocument.getElementById('hidden_text_store').focus();\r\n\tdocument.getElementById('hidden_text_store').value= \"\";\r\n}\r\n\r\nfunction handleSwipeCompletion( )\r\n{\r\n\tvar receivedText = codes.join(\"\");\r\n\r\n\tvar p = new SwipeParserObj(receivedText);\r\n\r\n\tdocument.getElementById('q').value = p.surname;\r\n\r\n\tendScanHandling();\r\n\r\n\tdocument.getElementById('list_users_form').submit();\r\n}\r\n\r\nfunction detectType()\r\n{\r\n\t// user manually changed search type, don't automatically change it\r\n\tif (manualSearchTypeChange == true)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar value = $('#q').val();\r\n\r\n\t// not numeric entry, start with last name\r\n\tif (!$.isNumeric(value))\r\n\t{\r\n\t\t$('#search_type').val('lastname');\r\n\t}\r\n\r\n\t// numeric entry, probably guest id\r\n\tif ($.isNumeric(value))\r\n\t{\r\n\t\t$('#search_type').val('id');\r\n\t}\r\n\r\n\t// has @ symbol, probably email\r\n\tif (value.indexOf(\"@\") != -1)\r\n\t{\r\n\t\t$('#search_type').val('email');\r\n\t}\r\n\r\n\t// has space, probably first and last name\r\n\tif (value.indexOf(\" \") != -1)\r\n\t{\r\n\t\t$('#search_type').val('firstlast');\r\n\t}\r\n\r\n\tshowHelpText();\r\n}\r\n\r\n// ------------------------------------ Processor Support\r\n\r\nfunction processorGuestSearch()\r\n{\r\n\r\n\tvar searchtype = $('#search_type').val();\r\n\tvar searchvalue = $('#q').val();\r\n\tvar store_filter = $('#all_stores').prop(\"checked\") ? 1 : 0;\r\n\tvar currentStore = $('#currentStore').val();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php?processor=admin_guestSearch',\r\n\t\ttype: 'POST',\r\n\t\tdataType : 'json',\r\n\t\tdata : {\r\n\t\t\tsearch_type: searchtype,\r\n\t\t\tq: searchvalue,\r\n\t\t\tresults_type:'compact_list',\r\n\t\t\tstore: (currentStore ? currentStore : 'none'),\r\n\t\t\tfilter: store_filter\r\n\t\t},\r\n\t\tsuccess: function(json)\r\n\t\t{\r\n\t\t\tif (json.result_code == 1)\r\n\t\t\t{\r\n\t\t\t\t$('#user_list_target').html(json.data);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({ title: 'Error', message: json.processor_message});\r\n\r\n\t\t\t}\r\n\t    },\r\n\t\terror: function(objAJAXRequest, strError)\r\n\t\t{\r\n\t\t\tdd_message({ title: 'Error', message: strError});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\nvar user_ref_action = \"none\";\r\n\r\nfunction user_referral_init()\r\n{\r\n\r\n\t$(\":submit\").on('click', function () { user_ref_action = this.name; });\r\n\r\n\t// If enter key is pressed on input handle zipcode search\r\n\t$(\"#q\").keypress(function(e) {\r\n\t\tif(e.which == 13)\r\n\t\t{\r\n\t\t\tprocessorGuestSearch();\r\n\t\t}\r\n\t});\r\n\r\n\r\n}\r\n\r\nfunction checkReferralSubmission(formElem)\r\n{\r\n\tvar retVal = true;\r\n\r\n\tif ($('#operation').val() == 'ineligible' && user_ref_action == 'submit_referral')\r\n\t{\r\n\t\tif (active_referral_email == $('#overrideReferral').val())\r\n\t\t{\r\n\t\t\tretVal = false;\r\n\t\t\tdd_message({\r\n\t\t\t\tmodal : true,\r\n\t\t\t\tmessage : 'The referral source is aleady set to this user account.'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\treturn retVal;\r\n}\r\n\r\n\r\nfunction useGuestAccount(ref_id, email, id, isPending, isInPlatePoints )\r\n{\r\n\t$('#ur_select_message').hide();\r\n\t$('#user_list_target').html(\"\");\r\n\t$('#customer_referral_result').html(email);\r\n\t$('#overrideReferral').val(email);\r\n\t$('#customer_referral_id').val(ref_id);\r\n\t$('#submit_referral').prop('disabled', false);\r\n\t$('#optionsDiv').show();\r\n\r\n\tvar foundReferralOption = false;\r\n\r\n\tif (isInPlatePoints)\r\n\t{\r\n\t\t$(\"span[data-reward_type='points']\").show();\r\n\t\t$(\"span[data-reward_type='credit']\").hide();\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"span[data-reward_type='points']\").hide();\r\n\t\t$(\"span[data-reward_type='credit']\").show();\r\n\t}\r\n\r\n\tif (isPending)\r\n\t{\r\n\t\tif ($('#pendingOptions').length)\r\n\t\t{\r\n\t\t\tfoundReferralOption = true;\r\n\r\n\t\t\t$('#pendingOptions').show();\r\n\t\t\tif ($('#leave_queued').length)\r\n\t\t\t\t$('#leave_queued').prop(\"checked\", true);\r\n\t\t}\r\n\r\n\t\tif ($('#nonpendingOptions').length)\r\n\t\t{\r\n\t\t\t$('#nonpendingOptions').hide();\r\n\r\n\t\t\tif ($('#queue_new').length)\r\n\t\t\t\t$('#queue_new').prop(\"checked\", false);\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif ($('#pendingOptions').length)\r\n\t\t{\r\n\t\t\t$('#pendingOptions').hide();\r\n\t\t\tif ($('#leave_queued').length)\r\n\t\t\t\t$('#leave_queued').prop(\"checked\", false);\r\n\t\t}\r\n\r\n\t\tif ($('#nonpendingOptions').length)\r\n\t\t{\r\n\t\t\tfoundReferralOption = true;\r\n\t\t\t$('#nonpendingOptions').show();\r\n\t\t\tif ($('#queue_new').length)\r\n\t\t\t\t$('#queue_new').prop(\"checked\", true);\r\n\t\t}\r\n\t}\r\n\r\n\tif (!foundReferralOption)\r\n\t{\r\n\t\t$('#operation').val(\"referral_source_update_only\");\r\n\t}\r\n\r\n\r\n}\r\n"],"names":["manualSearchTypeChange","list_users_init","showHelpText","$","focus","bind","detectType","searchTypeChange","helpString","value","val","removeClass","unmask","addClass","mask","show","html","codes","target_prefix","scanPosition","charIndex","keyHandler2","evt","event","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","document","getElementById","style","display","length","prepareForCCSwipe","paymentNumber","onkeypress","receivedText","join","p","SwipeParserObj","surname","submit","isNumeric","indexOf","processorGuestSearch","searchtype","searchvalue","store_filter","prop","currentStore","ajax","url","type","dataType","data","search_type","q","results_type","store","filter","success","json","result_code","dd_message","title","message","processor_message","error","objAJAXRequest","strError","user_ref_action","user_referral_init","on","this","name","keypress","e","checkReferralSubmission","formElem","retVal","active_referral_email","modal","useGuestAccount","ref_id","email","id","isPending","isInPlatePoints","hide","foundReferralOption"],"mappings":"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"}
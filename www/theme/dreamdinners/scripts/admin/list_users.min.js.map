{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["list_users.js"],"sourcesContent":["var manualSearchTypeChange = false;\r\n\r\nfunction list_users_init()\r\n{\r\n\tshowHelpText();\r\n\t$('#q').focus();\r\n\t$('#q').bind('input', function() { detectType(); });\r\n}\r\n\r\nfunction searchTypeChange()\r\n{\r\n\tshowHelpText();\r\n\t$('#q').focus();\r\n\tmanualSearchTypeChange = true;\r\n}\r\n\r\nfunction showHelpText()\r\n{\r\n\tvar helpString = \"\";\r\n\tvar value = $('#search_type').val();\r\n\r\n\t$('#q').removeClass('telephone').unmask();\r\n\r\n\tswitch(value)\r\n\t{\r\n\t\tcase 'firstname':\r\n\t\t\thelpString = \"Enter full or partial first name\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'lastname':\r\n\t\t\thelpString = \"Enter full or partial last name\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'firstlast':\r\n\t\t\thelpString = \"Search Text Example: John Smith (Enter full or partial first and last name)\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'email':\r\n\t\thelpString = \"Instruction Text: Enter full or partial email address\";\r\n\t\tbreak;\r\n\r\n\t\tcase 'phone':\r\n\t\t\thelpString = \"Instruction Text: Enter phone number in 555-555-5555 format\";\r\n\t\t\t$('#q').addClass('telephone');\r\n\t\t\t$('.telephone').mask('999-999-9999');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'id':\r\n\t\t\thelpString = \"Enter the exact Guest ID (No partial entries)\";\r\n\t\tbreak;\r\n\t}\r\n\r\n\t$('#search_help').show();\r\n\t$('#search_help').html(helpString);\r\n}\r\n\r\nvar codes = [];\r\nvar target_prefix = \"payment1_\";\r\nvar scanPosition = 0;\r\nvar charIndex = 0;\r\n\r\nfunction keyHandler2(evt)\r\n{\r\n\tevt = (evt) ? evt : event;\r\n\tvar charCode = (evt.charCode) ? evt.charCode : ((evt.which) ? evt.which : evt.keyCode);\r\n\r\n\tif(charCode == 13)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcodes[charIndex++] = String.fromCharCode(charCode);\r\n\r\n\tif((String.fromCharCode(charCode) == '%') && (scanPosition == 0))\r\n\t{\r\n\t\tscanPosition = 1; //start of data\r\n\t}\r\n\telse if((String.fromCharCode(charCode) == 'B') && (scanPosition == 1))\r\n\t{\r\n\t\tscanPosition = 2; // start of track 1\r\n\t}\r\n\telse if((String.fromCharCode(charCode) == '?') && (scanPosition == 2))\r\n\t{\r\n\t\tscanPosition = 3;  // end of track 1\r\n\t}\r\n\telse if((String.fromCharCode(charCode) == '?') && (scanPosition == 3))\r\n\t{\r\n\t\tscanPosition = 0;  // end of track 2\r\n\t\tcharIndex = 0;\r\n\t\thandleSwipeCompletion();\r\n\t}\r\n}\r\n\r\nfunction endScanHandling()\r\n{\r\n\tdocument.getElementById('scanArea').style.display = \"none\";\r\n\tcodes.length = 0;\r\n\tscanPosition = 0;\r\n\tcharIndex = 0;\r\n\tdocument.getElementById('hidden_text_store').value= \"\";\r\n}\r\n\r\nfunction prepareForCCSwipe(paymentNumber)\r\n{\r\n\tdocument.onkeypress = keyHandler2;\r\n\tdocument.getElementById('scanArea').style.display = \"block\";\r\n\tdocument.getElementById('hidden_text_store').focus();\r\n\tdocument.getElementById('hidden_text_store').value= \"\";\r\n}\r\n\r\nfunction handleSwipeCompletion( )\r\n{\r\n\tvar receivedText = codes.join(\"\");\r\n\r\n\tvar p = new SwipeParserObj(receivedText);\r\n\r\n\tdocument.getElementById('q').value = p.surname;\r\n\r\n\tendScanHandling();\r\n\r\n\tdocument.getElementById('list_users_form').submit();\r\n}\r\n\r\nfunction detectType()\r\n{\r\n\t// user manually changed search type, don't automatically change it\r\n\tif (manualSearchTypeChange == true)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar value = $('#q').val();\r\n\r\n\t// not numeric entry, start with last name\r\n\tif (!$.isNumeric(value))\r\n\t{\r\n\t\t$('#search_type').val('lastname');\r\n\t}\r\n\r\n\t// numeric entry, probably guest id\r\n\tif ($.isNumeric(value))\r\n\t{\r\n\t\t$('#search_type').val('id');\r\n\t}\r\n\r\n\t// has @ symbol, probably email\r\n\tif (value.indexOf(\"@\") != -1)\r\n\t{\r\n\t\t$('#search_type').val('email');\r\n\t}\r\n\r\n\t// has space, probably first and last name\r\n\tif (value.indexOf(\" \") != -1)\r\n\t{\r\n\t\t$('#search_type').val('firstlast');\r\n\t}\r\n\r\n\tshowHelpText();\r\n}\r\n\r\n// ------------------------------------ Processor Support\r\n\r\nfunction processorGuestSearch()\r\n{\r\n\r\n\tvar searchtype = $('#search_type').val();\r\n\tvar searchvalue = $('#q').val();\r\n\tvar store_filter = $('#all_stores').prop(\"checked\") ? 1 : 0;\r\n\tvar currentStore = $('#currentStore').val();\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php?processor=admin_guestSearch',\r\n\t\ttype: 'POST',\r\n\t\tdataType : 'json',\r\n\t\tdata : {\r\n\t\t\tsearch_type: searchtype,\r\n\t\t\tq: searchvalue,\r\n\t\t\tresults_type:'compact_list',\r\n\t\t\tstore: (currentStore ? currentStore : 'none'),\r\n\t\t\tfilter: store_filter\r\n\t\t},\r\n\t\tsuccess: function(json)\r\n\t\t{\r\n\t\t\tif (json.result_code == 1)\r\n\t\t\t{\r\n\t\t\t\t$('#user_list_target').html(json.data);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({ title: 'Error', message: json.processor_message});\r\n\r\n\t\t\t}\r\n\t    },\r\n\t\terror: function(objAJAXRequest, strError)\r\n\t\t{\r\n\t\t\tdd_message({ title: 'Error', message: strError});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\nvar user_ref_action = \"none\";\r\n\r\nfunction user_referral_init()\r\n{\r\n\r\n\t$(\":submit\").on('click', function () { user_ref_action = this.name; });\r\n\r\n\t// If enter key is pressed on input handle zipcode search\r\n\t$(\"#q\").keypress(function(e) {\r\n\t\tif(e.which == 13)\r\n\t\t{\r\n\t\t\tprocessorGuestSearch();\r\n\t\t}\r\n\t});\r\n\r\n\r\n}\r\n\r\nfunction checkReferralSubmission(formElem)\r\n{\r\n\tvar retVal = true;\r\n\r\n\tif ($('#operation').val() == 'ineligible' && user_ref_action == 'submit_referral')\r\n\t{\r\n\t\tif (active_referral_email == $('#overrideReferral').val())\r\n\t\t{\r\n\t\t\tretVal = false;\r\n\t\t\tdd_message({\r\n\t\t\t\tmodal : true,\r\n\t\t\t\tmessage : 'The referral source is aleady set to this user account.'\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\treturn retVal;\r\n}\r\n\r\n\r\nfunction useGuestAccount(ref_id, email, id, isPending, isInPlatePoints )\r\n{\r\n\t$('#ur_select_message').hide();\r\n\t$('#user_list_target').html(\"\");\r\n\t$('#customer_referral_result').html(email);\r\n\t$('#overrideReferral').val(email);\r\n\t$('#customer_referral_id').val(ref_id);\r\n\t$('#submit_referral').prop('disabled', false);\r\n\t$('#optionsDiv').show();\r\n\r\n\tvar foundReferralOption = false;\r\n\r\n\tif (isInPlatePoints)\r\n\t{\r\n\t\t$(\"span[data-reward_type='points']\").show();\r\n\t\t$(\"span[data-reward_type='credit']\").hide();\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$(\"span[data-reward_type='points']\").hide();\r\n\t\t$(\"span[data-reward_type='credit']\").show();\r\n\t}\r\n\r\n\tif (isPending)\r\n\t{\r\n\t\tif ($('#pendingOptions').length)\r\n\t\t{\r\n\t\t\tfoundReferralOption = true;\r\n\r\n\t\t\t$('#pendingOptions').show();\r\n\t\t\tif ($('#leave_queued').length)\r\n\t\t\t\t$('#leave_queued').prop(\"checked\", true);\r\n\t\t}\r\n\r\n\t\tif ($('#nonpendingOptions').length)\r\n\t\t{\r\n\t\t\t$('#nonpendingOptions').hide();\r\n\r\n\t\t\tif ($('#queue_new').length)\r\n\t\t\t\t$('#queue_new').prop(\"checked\", false);\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif ($('#pendingOptions').length)\r\n\t\t{\r\n\t\t\t$('#pendingOptions').hide();\r\n\t\t\tif ($('#leave_queued').length)\r\n\t\t\t\t$('#leave_queued').prop(\"checked\", false);\r\n\t\t}\r\n\r\n\t\tif ($('#nonpendingOptions').length)\r\n\t\t{\r\n\t\t\tfoundReferralOption = true;\r\n\t\t\t$('#nonpendingOptions').show();\r\n\t\t\tif ($('#queue_new').length)\r\n\t\t\t\t$('#queue_new').prop(\"checked\", true);\r\n\t\t}\r\n\t}\r\n\r\n\tif (!foundReferralOption)\r\n\t{\r\n\t\t$('#operation').val(\"referral_source_update_only\");\r\n\t}\r\n\r\n\r\n}\r\n"],"names":["manualSearchTypeChange","list_users_init","showHelpText","$","focus","bind","detectType","searchTypeChange","helpString","value","val","removeClass","unmask","addClass","mask","show","html","codes","target_prefix","scanPosition","charIndex","keyHandler2","evt","event","charCode","which","keyCode","String","fromCharCode","handleSwipeCompletion","endScanHandling","document","getElementById","style","display","length","prepareForCCSwipe","paymentNumber","onkeypress","receivedText","join","p","SwipeParserObj","surname","submit","isNumeric","indexOf","processorGuestSearch","searchtype","searchvalue","store_filter","prop","currentStore","ajax","url","type","dataType","data","search_type","q","results_type","store","filter","success","json","result_code","dd_message","title","message","processor_message","error","objAJAXRequest","strError","user_ref_action","user_referral_init","on","this","name","keypress","e","checkReferralSubmission","formElem","retVal","active_referral_email","modal","useGuestAccount","ref_id","email","id","isPending","isInPlatePoints","hide","foundReferralOption"],"mappings":"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"}
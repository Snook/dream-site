{"version":3,"file":"checkout.min.js","names":["handle_ltd_round_up","$","document","on","e","this","is","prop","USER_PREFERENCES","LTD_AUTO_ROUND_UP","value","cookie","session_id","modal_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","val","div_id","confirm","remove","set_user_pref","ltd_round_up_value","index","buttons","Yes","trigger","No","round_up_val","text","formatAsMoney","slideDown","slideUp","ajax","url","type","timeout","dataType","data","processor","payment_type","success","json","processor_success","processor_message","error","objAJAXRequest","strError","updateFinancials","attr","handle_checkout_delayed_payment","get_user_pref","user_preferences","lang","en","tc","terms_and_conditions","delayed_payment","Agree","unbind","Decline","click","delayed_payment_decline","handle_special_instructions","strip_tags","submit_gift_card_purchase","field","append","submit","submit_order","create_and_submit_form","action","input","special_insts","customers_terms","handlePlatePointsDiscount","inVal","isNaN","cap","maxPPCredit","maxPPDeduction","editSaveAllPlatePointsCredits","editSavePlatePointsCredits","force","html","op","new_credit_value","orderInfo","grand_total","subtotal_all_taxes","showFlex","hideFlex","coupon_code_discount_total","avgCostPerServingEntreeCost","points_discount_total","membership_discount","can_checkout","run_as_guest","foodCost","bag_fee","length","Number","giftCardCost","each","thisCost","service_fee","delivery_fee","delivery_tip","totalTax","prediscountFoodTotal","couponDiscount","volumeDiscount","preferredDiscount","dreamRewardsDiscount","sessionDiscount","pointsDiscount","membershipDiscount","customization_fee","paymentsTotal","credit_card_food_total","round_up_donation","subtotal_round_up","Math","ceil","subtotal_round_up_diff","parseFloat","toFixed","hasEnoughNonCCFunds","isEditOrder","show","cost_per_serving","avgCostPerServing","handleCardRefChange","is_discounts_page","addClass","removeClass","remove_item_payment","settings","item","remove_food","removeAllStoreCredit","remove_payment_coupon","remove_payment","remove_gift_card_purchase","remove_dinner_dollars","remove_credit_card_reference","runAsGuest","allowGuest","rewardsCreditClick","obj","checked","add_all_store_credit","gcoid","item_number","page","is_edit_order","location","reload","couponAmount","toUpperCase","coupon","limit_to_mfy_fee","update_special_instructions","special_inst","update_bag_opt_out","opt_out","supports_bag_fee","default_bag_fee","number_bags_required","bagLabel","cbagLabel","add_payment_coupon","add_coupon_code","coupon_code","edit_order_diff","balance","originalOrderInfo","coupon_title","dd_val","valueOf","calculateMaxNewGiftCardPayment","newPaymentNumber","grandtotal","existingPaymentTotal","PaymentNumber","PaymentAmount","get_gift_card_balance","gc_number","trim","card_number","output","card_balance","getGiftCardNumberAndAmount","returnData","dataValid","gc_amount","is_update","didHandleDuplicate","replacementObj","do_add_gift_card","cancel","transaction_data","is_processing","replacingID","id","split","maxNewPayment","toString","amount","c_total","current_subtotal","original_order_total","payment_id","edit_order_html","replaceWith","add_payment_gift_card","getDomObjectToRemove","get","store_id","store_id_of_order","domObjectToRemove","payment_number","empty","handleNewCardFormShown","disabled","required","requireCreditCardFields","handleNewCardFormHidden","parents","doNotRequireCreditCardFields","handleOrderCustomizations","form","requiredOptionSelected","setTimeout","console","log","selectedRef","cc_ref_id","numRefs","add_payment_credit_card","elementsToCheck","_check_elements","doDelayedPayment","name_on_card","exp_month","exp_year","security_code","card_type","billing_zip","billing_addr","do_delayed_payment","cart_subtotal","default_meal_customization_to_selected","initMealCustomizationFields","canContinue","preventDefault","min","max","maxlength","pattern","validateCreditCard","result","validatorType","name","currentTypeWidgetValue","accept","multiple","undefined","which","prev_id","valCheckDiffRemove","addy","JSON","parse","address","status","Cancel","delivered_zip","postal_code","Close","location_type","valCheckDiff","firstname","group","lastname","address_line1","address_line2","city","state_id","address_note","telephone_1","email_address","diffData","checkdiff","Object","keys","href","bounce","handleMealCustomizationAccordion","checkbox","getElementById","$header","$content","slideToggle","has_meal_customization_selected","toggleMealCustomizationOptions","removeAttr","toggleMealCustomizationMasterCheckbox","handleMealCustomizationMasterCheckbox","allow_customization","customizations","stringify","meal_customization_preferences","customization","opted_to_customize_recipes","cost","preferenceChangeListener","pref","setting","user_id","callback","includes","pref_value","isPlainObject","extend","addEventListener","readonly"],"sourceRoot":"js/src/dreamdinners/customer","sources":["checkout.js"],"sourcesContent":["cart_subtotal = 0;\n\nfunction handle_ltd_round_up()\n{\n\t$(document).on('change', '#add_ltd_round_up', function (e) {\n\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\n\n\t\t\tif (USER_PREFERENCES.LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != session_id))\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\tmessage: 'Would you like to automatically round up every time you order? You can edit this setting any time in <span class=\"font-weight-bold\">My Preferences</span>.<div class=\"text-center; mt-1\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option><option value=\"2\">2 Dollars</option><option value=\"5\">5 Dollars</option><option value=\"10\">10 Dollars</option><option value=\"35\">35 Dollars</option><option value=\"54\">54 Dollars</option></select></div>',\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\topen: function (event, ui) {\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\n\t\t\t\t\t\tvar rup_dialog = $(this);\n\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e) {\n\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\n\n\t\t\t\t\t\t\tif (rup_value > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\n\t\t\t\t\t\t\t\t\tconfirm: function () {\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\n\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value);\n\n\t\t\t\t\t\t\t\t\t\tif (ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use your selected Round Up value on this order? This can be reviewed and edited.',\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"No\": function () {\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"Ask Again Later\": function () {\n\t\t\t\t\t\t\t$.cookie('ltdru', session_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\n\t\t}\n\n\t\t$('#ltd_round_up_select').trigger('change');\n\n\t});\n\n\t$('#ltd_round_up_select').on('change', function (e) {\n\n\t\tvar round_up_val = $(this).val();\n\n\t\tif (round_up_val != null)\n\t\t{\n\t\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\n\n\t\t\tif ($('#add_ltd_round_up').is(':checked'))\n\t\t\t{\n\t\t\t\t$('#ltd_round_up_div').slideDown();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#ltd_round_up_div').slideUp();\n\n\t\t\t\tround_up_val = 0;\n\t\t\t}\n\n\t\t\t$.ajax({\n\t\t\t\turl: '/processor',\n\t\t\t\ttype: 'POST',\n\t\t\t\ttimeout: 20000,\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tprocessor: 'cart_add_payment',\n\t\t\t\t\tpayment_type: 'ltd_round_up',\n\t\t\t\t\tltd_round_up_value: round_up_val\n\t\t\t\t},\n\t\t\t\tsuccess: function (json) {\n\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t{\n\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t\t//\tconsole.log('OM Intense logging: ' + message);\n\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tupdateFinancials();\n\t});\n\n\tif (!$('#add_ltd_round_up').is(':checked') && USER_PREFERENCES.LTD_AUTO_ROUND_UP.value > 0 && ltd_round_up_value == null)\n\t{\n\t\t$('#add_ltd_round_up').prop('checked', true);\n\n\t\tif (USER_PREFERENCES.LTD_AUTO_ROUND_UP.value > 1)\n\t\t{\n\t\t\t$('#ltd_round_up_select').val(USER_PREFERENCES.LTD_AUTO_ROUND_UP.value).prop('disabled', false).trigger('change');\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#ltd_round_up_select option:first-child').attr('selected', true);\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).trigger('change');\n\n\t\t}\n\t}\n\telse if ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\t$('#ltd_round_up_select').prop('disabled', false).trigger('change');\n\t}\n}\n\nfunction handle_checkout_delayed_payment()\n{\n\tif (USER_PREFERENCES)\n\t{\n\t\tget_user_pref('TC_DELAYED_PAYMENT_AGREE', null, function (json) {\n\n\t\t\tif (json.user_preferences['TC_DELAYED_PAYMENT_AGREE'].value == 1 || json.user_preferences['TC_DELAYED_PAYMENT_AGREE'].value == '1')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment1, #is_flat_rate_delayed_payment1, #is_delayed_payment1').on('click', function (e) {\n\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\n\t\t\t\t\tmessage: lang.en.tc.delayed_payment,\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tnoOk: true,\n\t\t\t\t\tcloseOnEscape: false,\n\t\t\t\t\topen: function (event, ui) {\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\"Agree\": function () {\n\n\t\t\t\t\t\t\t$('#is_store_specific_flat_rate_delayed_payment1, #is_flat_rate_delayed_payment1, #is_delayed_payment1').unbind(\"click\");\n\n\t\t\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 1);\n\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"Decline\": function () {\n\n\t\t\t\t\t\t\t$('#is_store_specific_flat_rate_delayed_payment0, #is_flat_rate_delayed_payment0, #is_delayed_payment0').click();\n\n\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\n\t\t\t\t\t\t\t\tmessage: lang.en.tc.delayed_payment_decline\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 0);\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t});\n\t}\n}\n\nfunction handle_special_instructions()\n{\n\t$(document).on('keyup', '#special_insts', function (e) {\n\n\t\tif ($(this).val() != strip_tags($(this).val()))\n\t\t{\n\t\t\t$(this).val(strip_tags($(this).val()));\n\t\t}\n\n\t});\n}\n\nfunction submit_gift_card_purchase()\n{\n\tvar field = $('<input></input>');\n\tfield.attr(\"type\", \"hidden\");\n\tfield.attr(\"name\", \"checkout_submit\");\n\tfield.attr(\"value\", \"true\");\n\t$(\"#gift_card_checkout\").append(field);\n\n\t$(\"#gift_card_checkout\").submit();\n}\n\nfunction submit_order()\n{\n\tcreate_and_submit_form({\n\t\taction: '/checkout',\n\t\tinput: ({\n\t\t\tspecial_insts: $('#special_insts').val(),\n\t\t\tcustomers_terms: $('#customers_terms').val()\n\t\t})\n\t});\n}\n\nfunction handlePlatePointsDiscount(val)\n{\n\tinVal = val;\n\n\tif ((isNaN(val) || val <= 0) && val != \".\")\n\t{\n\t\tval = 0;\n\t}\n\n\tvar cap = maxPPCredit;\n\tif (cap > maxPPDeduction)\n\t{\n\t\tcap = maxPPDeduction;\n\t}\n\n\tif (val > cap)\n\t{\n\t\tval = cap;\n\t}\n\n\tif (val < 0)\n\t{\n\t\tval = 0;\n\t}\n\n\tif (val != inVal || isNaN(inVal) || inVal == \"\")\n\t{\n\t\t$('#plate_points_discount').val(val);\n\t}\n\n}\n\nfunction editSaveAllPlatePointsCredits()\n{\n\t$('#plate_points_discount').val(formatAsMoney(maxPPDeduction));\n\teditSavePlatePointsCredits(false);\n}\n\nfunction editSavePlatePointsCredits(force)\n{\n\tif (force)\n\t{\n\t\t$(\"#max_plate_points_deduction\").html(maxPPDeduction);\n\t}\n\n\tvar val = $('#plate_points_discount').val();\n\n\tif (typeof val !== 'undefined')\n\t{\n\t\tvar cap = maxPPCredit;\n\t\tif (cap > maxPPDeduction)\n\t\t{\n\t\t\tcap = maxPPDeduction;\n\t\t}\n\n\t\tif (val > cap)\n\t\t{\n\t\t\tval = cap;\n\t\t}\n\n\t\tif (val < 0)\n\t\t{\n\t\t\tval = 0;\n\t\t}\n\n\t\t$('#plate_points_discount').val(formatAsMoney(val));\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'cart_modify_plate_points_credits',\n\t\t\t\top: 'modify',\n\t\t\t\tnew_credit_value: val\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\t// update subtotal\n\t\t\t\t\t$('#sum_checkout_total-subtotal').html(formatAsMoney(json.orderInfo.grand_total));\n\n\t\t\t\t\t$('#checkout_total-tax').html(formatAsMoney(json.orderInfo.subtotal_all_taxes));\n\n\t\t\t\t\tif (val > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#row-discount_plate_points').showFlex();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#row-discount_plate_points').hideFlex();\n\t\t\t\t\t}\n\n\t\t\t\t\t// update coupon total\n\t\t\t\t\t$('#checkout_total-coupon').html(formatAsMoney(json.orderInfo.coupon_code_discount_total));\n\n\t\t\t\t\tavgCostPerServingEntreeCost -= json.orderInfo.coupon_code_discount_total;\n\n\t\t\t\t\t$(\"#checkout_total-points_discount_total\").html(formatAsMoney(json.orderInfo.points_discount_total));\n\t\t\t\t\t$(\"#checkout_total-membership_discount\").html(formatAsMoney(json.orderInfo.membership_discount));\n\n\t\t\t\t\t// calculate the balance\n\t\t\t\t\tcan_checkout();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n}\n\nfunction run_as_guest()\n{\n\tcreate_and_submit_form({\n\t\taction: '/checkout',\n\t\tinput: ({\n\t\t\trun_as_guest: \"true\"\n\t\t})\n\t});\n}\n\nfunction updateFinancials()\n{\n\tvar foodCost = 0;\n\tvar bag_fee = 0;\n\n\tif ($('#checkout_total-food').length)\n\t{\n\t\tfoodCost = Number($('#checkout_total-food').html());\n\t}\n\n\tvar giftCardCost = 0;\n\t$('[id^=\"checkout_total-giftcard_purchase\"]').each(function () {\n\t\tvar thisCost = Number($(this).html());\n\t\tgiftCardCost += thisCost;\n\t});\n\n\tvar service_fee = 0;\n\tif ($('#checkout_total-service_fee').length)\n\t{\n\t\tservice_fee = Number($('#checkout_total-service_fee').html());\n\t}\n\n\tvar delivery_fee = 0;\n\tif ($('#checkout_total-delivery_fee').length)\n\t{\n\t\tdelivery_fee = Number($('#checkout_total-delivery_fee').html());\n\t}\n\n\tvar delivery_tip = 0;\n\tif ($('.checkout_total-delivery_tip').length)\n\t{\n\t\tdelivery_tip = Number($('.checkout_total-delivery_tip').html());\n\t}\n\n\tvar totalTax = 0;\n\tif ($('#checkout_total-tax').length)\n\t{\n\t\ttotalTax = Number($('#checkout_total-tax').html());\n\t}\n\n\tvar prediscountFoodTotal = foodCost;\n\n\t// Note: coupon code and points discount are the only discounts that can affect price\n\t// without a page refresh. If there is a change we need to recalculate tax\n\tvar couponDiscount = 0;\n\tif ($('#checkout_total-coupon').length)\n\t{\n\t\tcouponDiscount = Number($('#checkout_total-coupon').html());\n\t}\n\n\tvar volumeDiscount = 0;\n\tif ($('#checkout_total-volume_discount').length)\n\t{\n\t\tvolumeDiscount = Number($('#checkout_total-volume_discount').html());\n\t}\n\n\tvar preferredDiscount = 0;\n\tif ($('#checkout_total-preferred_discount').length)\n\t{\n\t\tpreferredDiscount = Number($('#checkout_total-preferred_discount').html());\n\t}\n\n\tvar dreamRewardsDiscount = 0;\n\tif ($('#checkout_total-dream_rewards_discount').length)\n\t{\n\t\tdreamRewardsDiscount = Number($('#checkout_total-dream_rewards_discount').html());\n\t}\n\n\tvar sessionDiscount = 0;\n\tif ($('#checkout_total-session_discount_total').length)\n\t{\n\t\tsessionDiscount = Number($('#checkout_total-session_discount_total').html());\n\t}\n\n\tvar pointsDiscount = 0;\n\tif ($('#checkout_total-points_discount_total').length)\n\t{\n\t\tpointsDiscount = Number($('#checkout_total-points_discount_total').html());\n\t}\n\n\tvar membershipDiscount = 0;\n\tif ($('#checkout_total-membership_discount').length)\n\t{\n\t\tmembershipDiscount = Number($('#checkout_total-membership_discount').html());\n\t}\n\n\tvar bag_fee = 0;\n\tif ($('#checkout_total-bag_fee').length)\n\t{\n\t\tbag_fee = Number($('#checkout_total-bag_fee').html());\n\t}\n\n\tvar customization_fee = 0;\n\tif ($('#checkout_total-customization_fee').length)\n\t{\n\t\tcustomization_fee = Number($('#checkout_total-customization_fee').html());\n\t}\n\n\tvar foodCost = prediscountFoodTotal - (couponDiscount + preferredDiscount + volumeDiscount + dreamRewardsDiscount + sessionDiscount + pointsDiscount + membershipDiscount);\n\tvar grand_total = Number(formatAsMoney(foodCost + giftCardCost + service_fee + delivery_fee + delivery_tip + bag_fee + totalTax + customization_fee));\n\n\t$('#sum_checkout_total-subtotal').html(formatAsMoney(grand_total));\n\n\tvar paymentsTotal = 0;\n\t$('[id^=\"checkout_total_payment-\"]').each(function () {\n\n\t\tif ($(this).is(':visible'))\n\t\t{\n\t\t\tpaymentsTotal += Number($(this).html());\n\t\t}\n\t});\n\n\tif (paymentsTotal > foodCost + service_fee + delivery_fee + delivery_tip + bag_fee + totalTax)\n\t{\n\t\t//more store credit than food cost so we must cap the store credit that can be used\n\t\tpaymentsTotal = foodCost + service_fee + delivery_fee + delivery_tip + bag_fee + totalTax;\n\t\t$('[id^=\"checkout_total_payment-credits\"]').html(formatAsMoney(paymentsTotal));\n\t}\n\n\tif (giftCardCost > 0)\n\t{\n\t\t//\t$('[id^=\"gc_checkout_total_adj_payment-creditcard-\"]').html(formatAsMoney(giftCardCost ));\n\t}\n\n\tvar credit_card_food_total = grand_total - paymentsTotal - giftCardCost;\n\n\tvar round_up_donation = 0;\n\n\tvar subtotal_round_up = Math.ceil(credit_card_food_total + giftCardCost);\n\tvar subtotal_round_up_diff = parseFloat((subtotal_round_up - (credit_card_food_total + giftCardCost)).toFixed(2));\n\n\tif (subtotal_round_up_diff == 0)\n\t{\n\t\tsubtotal_round_up_diff = 1.00;\n\t}\n\n\tif ($('#round_up_nearest_dollar').val() != subtotal_round_up_diff)\n\t{\n\t\t$('#round_up_nearest_dollar').val(subtotal_round_up_diff).text('$ ' + formatAsMoney(subtotal_round_up_diff));\n\t\t$('#add_ltd_round_up').trigger('change');\n\t}\n\n\tif ($('#add_ltd_round_up').is(':checked'))\n\t{\n\t\tif ($('#ltd_round_up_select').find(':selected').attr('id') == 'round_up_nearest_dollar')\n\t\t{\n\t\t\tround_up_donation = subtotal_round_up_diff;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tround_up_donation = parseFloat($('#ltd_round_up_select').val());\n\t\t}\n\t}\n\n\t$('[id^=\"credit_card_amount\"]').html(formatAsMoney(credit_card_food_total + giftCardCost + round_up_donation));\n\t$('#debit_credit_card_amount').html(formatAsMoney(credit_card_food_total + giftCardCost + round_up_donation));\n\n\tvar hasEnoughNonCCFunds = false;\n\n\tvar isEditOrder = false;\n\tif ($('#isEditDeliveredOrder').length)\n\t{\n\t\tisEditOrder = true;\n\t}\n\n\tif (isEditOrder)\n\t{\n\t\tcredit_card_food_total = $('#cc_amount_diff').html();\n\n\t}\n\n\tif (credit_card_food_total == 0 && giftCardCost == 0)\n\t{\n\t\t$('[id^=\"cc\"]').prop('disabled', true);\n\t\t$('#billing_postal_code').prop('disabled', true);\n\t\t$('#billing_address').prop('disabled', true);\n\t\t$('#addCreditCard').prop('disabled', true);\n\t\t$('#save_cc_as_ref').prop('disabled', true);\n\n\t\tif ($('#is_store_specific_flat_rate_delayed_payment1').length)\n\t\t{\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment1').prop('disabled', true);\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment0').prop('disabled', true);\n\t\t}\n\n\t\t$('#enough_funds_alert').show();\n\n\t\thasEnoughNonCCFunds = true;\n\n\t}\n\telse\n\t{\n\t\t$('[id^=\"cc\"]').prop('disabled', false);\n\t\t$('#billing_postal_code').prop('disabled', false);\n\t\t$('#billing_address').prop('disabled', false);\n\t\t$('#addCreditCard').prop('disabled', false);\n\t\t$('#save_cc_as_ref').prop('disabled', false);\n\n\t\tif ($('#is_store_specific_flat_rate_delayed_payment1').length)\n\t\t{\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment1').prop('disabled', false);\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment0').prop('disabled', false);\n\t\t}\n\n\t\t$('#enough_funds_alert').hide();\n\t}\n\n\t//$('#debit_credit_card_amount').html(formatAsMoney(credit_card_food_total + giftCardCost));\n\n\tvar cost_per_serving = formatAsMoney(avgCostPerServingEntreeCost / avgCostPerServing);\n\n\t$('#checkout-cost_per_serving').html(cost_per_serving);\n\n\t$('#sum_checkout_total-balance').html(formatAsMoney(0));\n\n\treturn hasEnoughNonCCFunds;\n}\n\nfunction can_checkout()\n{\n\thandleCardRefChange();\n\n\tvar hasEnoughNonCCFunds = updateFinancials();\n\n\tif (is_discounts_page)\n\t{\n\t\tif (hasEnoughNonCCFunds)\n\t\t{\n\t\t\t$('#checkoutOption').addClass('show');\n\t\t\t$('#toPaymentOption').removeClass('show');\n\n\t\t\t// if balance is 0 and terms and conditions have been checked, enable checkout\n\t\t\tif ($('#customers_terms').is(':checked'))\n\t\t\t{\n\t\t\t\t$('#complete_order').attr('disabled', false);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$('#complete_order').attr('disabled', true);\n\t\t\t}\n\n\t\t\t$('#customers_terms').attr('required', 'required');\n\t\t\t$(\"#to_payment_or_checkout_form\").prop(\"action\", '/checkout');\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#checkoutOption').removeClass('show');\n\t\t\t$('#toPaymentOption').addClass('show');\n\n\t\t\t$(\"#to_payment\").attr('disabled', false);\n\n\t\t\t$('#customers_terms').attr('required', false);\n\t\t\t$(\"#to_payment_or_checkout_form\").prop(\"action\", '/payment');\n\n\t\t}\n\n\t}\n\telse\n\t{\n\t\t// if balance is 0 and terms and conditions have been checked, enable checkout\n\t\tif ($('#customers_terms').is(':checked'))\n\t\t{\n\t\t\t$('#complete_order').attr('disabled', false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#complete_order').attr('disabled', true);\n\t\t}\n\t}\n}\n\nfunction remove_item_payment(settings)\n{\n\tif (settings.item == 'food')\n\t{\n\t\tremove_food();\n\t}\n\n\tif (settings.item == 'nonfood')\n\t{\n\t\t// remove_item_nonfood(settings);\n\t}\n\n\tif (settings.item == 'credits')\n\t{\n\t\tremoveAllStoreCredit(settings);\n\t}\n\n\tif (settings.item == 'coupon')\n\t{\n\t\tremove_payment_coupon();\n\t}\n\n\tif (settings.item == 'giftcard')\n\t{\n\t\tremove_payment(settings);\n\t}\n\n\tif (settings.item == 'giftcard_purchase')\n\t{\n\t\tremove_gift_card_purchase(settings);\n\t}\n\n\tif (settings.item == 'creditcard')\n\t{\n\t\tremove_payment(settings);\n\t}\n\n\tif (settings.item == 'dinner_dollars')\n\t{\n\t\tremove_dinner_dollars(settings);\n\t}\n\n\tif (settings.item == 'cc_ref')\n\t{\n\t\tremove_credit_card_reference(settings);\n\t}\n\n\tcan_checkout();\n}\n\nfunction remove_food()\n{\n\tvar runAsGuest = \"false\";\n\n\tif (allowGuest)\n\t{\n\t\trunAsGuest = \"true\";\n\t}\n\n\tcreate_and_submit_form({\n\t\taction: '/checkout',\n\t\tinput: ({\n\t\t\tremove: \"food\",\n\t\t\trun_as_guest: runAsGuest\n\n\t\t})\n\t});\n}\n\nfunction rewardsCreditClick(obj)\n{\n\tif (obj.checked)\n\t{\n\t\tadd_all_store_credit();\n\t}\n\telse\n\t{\n\t\tvar settings = {\n\t\t\titem: \"credits\"\n\t\t};\n\n\t\tremoveAllStoreCredit(settings);\n\t}\n\n\tcan_checkout();\n}\n\nfunction remove_gift_card_purchase(settings)\n{\n\tvar runAsGuest = \"false\";\n\n\tif (allowGuest)\n\t{\n\t\trunAsGuest = \"true\";\n\t}\n\n\tcreate_and_submit_form({\n\t\taction: '/checkout-gift-card',\n\t\tinput: ({\n\t\t\tremove: \"gift_card_purchase\",\n\t\t\tgcoid: settings.item_number,\n\t\t\trun_as_guest: runAsGuest\n\t\t})\n\t});\n}\n\nfunction remove_dinner_dollars()\n{\n\n\t$('#plate_points_discount').val(formatAsMoney(0));\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_modify_plate_points_credits',\n\t\t\top: 'modify',\n\t\t\tnew_credit_value: 0\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\n\t\t\t\t// update subtotal\n\t\t\t\t$('#sum_checkout_total-subtotal').html(formatAsMoney(json.orderInfo.grand_total));\n\n\t\t\t\t$('#checkout_total-tax').html(formatAsMoney(json.orderInfo.subtotal_all_taxes));\n\n\t\t\t\t$('#row-discount_plate_points').hideFlex();\n\n\t\t\t\t// update coupon total\n\t\t\t\t$('#checkout_total-coupon').html(formatAsMoney(json.orderInfo.coupon_code_discount_total));\n\n\t\t\t\tavgCostPerServingEntreeCost -= json.orderInfo.coupon_code_discount_total;\n\n\t\t\t\t$(\"#checkout_total-points_discount_total\").html(formatAsMoney(json.orderInfo.points_discount_total));\n\t\t\t\t$(\"#checkout_total-membership_discount\").html(formatAsMoney(json.orderInfo.membership_discount));\n\n\t\t\t\t// calculate the balance\n\t\t\t\tcan_checkout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction remove_payment_coupon()\n{\n\n\tvar service_fee = Number($('#checkout_total-service_fee').html());\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_remove_payment',\n\t\t\tpayment_type: 'coupon',\n\t\t\tpage: 'checkout'\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t// restore coupon input\n\t\t\t\t$('#add_coupon_code').prop('disabled', false);\n\t\t\t\t$('#add_coupon_add').prop('disabled', false);\n\t\t\t\t$('#checkout_total-tax').html(json.orderInfo.subtotal_all_taxes);\n\n\t\t\t\t// update coupon total\n\t\t\t\t$('#checkout_title-coupon_code').html('');\n\n\t\t\t\tif (json.is_edit_order !== 'undefined' && json.is_edit_order == true)\n\t\t\t\t{\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}\n\n\t\t\t\tvar couponAmount = Number($('#checkout_total-coupon').html());\n\n\t\t\t\tavgCostPerServingEntreeCost += couponAmount;\n\n\t\t\t\t// update coupon total\n\t\t\t\t$('#checkout_total-coupon').html('0.00');\n\n\t\t\t\t// hide coupon row\n\t\t\t\t$('#row-coupon').hideFlex();\n\n\t\t\t\tvar couponCodeVal = $('#add_coupon_code').val().toUpperCase();\n\n\t\t\t\tif (coupon.limit_to_mfy_fee == '1')\n\t\t\t\t{\n\t\t\t\t\tmaxPPDeduction += service_fee;\n\t\t\t\t\teditSavePlatePointsCredits(true);\n\n\t\t\t\t\tif (maxPPCredit > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(\"#edit_plate_points\").attr(\"disabled\", false);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tcoupon = false;\n\n\t\t\t\t// can we checkout?\n\t\t\t\tcan_checkout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction update_special_instructions()\n{\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_item_processor',\n\t\t\top: 'store_inst',\n\t\t\tspecial_inst: $('#special_insts').val()\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t// nothing to do\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction update_bag_opt_out()\n{\n\n\tlet opt_out = 0;\n\tif (supports_bag_fee)\n\t{\n\t\tif ($(\"#opted_to_bring_bags\").is(\":checked\"))\n\t\t{\n\t\t\topt_out = 1;\n\t\t}\n\t}\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_bag_fee',\n\t\t\top: 'set_opt_out',\n\t\t\topt_out: opt_out\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t// update subtotal\n\t\t\t\t$('#sum_checkout_total-subtotal').html(formatAsMoney(json.orderInfo.grand_total));\n\t\t\t\t$('#checkout_total-tax').html(formatAsMoney(json.orderInfo.subtotal_all_taxes));\n\n\t\t\t\tif ($(\"#opted_to_bring_bags\").is(\":checked\"))\n\t\t\t\t{\n\t\t\t\t\t$(\"#checkout_total-bag_fee_info\").html(\"(You will provide bags)\");\n\t\t\t\t\t$(\"#checkout_total-bag_fee\").html(formatAsMoney(0));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbag_fee = default_bag_fee * number_bags_required;\n\t\t\t\t\tlet bagLabel = number_bags_required > 1 ? ' bags' : ' bag';\n\t\t\t\t\tlet cbagLabel = number_bags_required > 1 ? ' Bags' : ' Bag';\n\n\t\t\t\t\t$(\"#checkout_total-bag_fee_info\").html('(' + number_bags_required + bagLabel + \" * $\" + formatAsMoney(default_bag_fee) + ')');\n\t\t\t\t\t$(\"#checkout_total-bag_fee\").html(formatAsMoney(bag_fee));\n\t\t\t\t\t$(\"#bag_text\").html(number_bags_required + cbagLabel);\n\n\t\t\t\t}\n\n\t\t\t\t// calculate the balance\n\t\t\t\tcan_checkout();\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction add_payment_coupon()\n{\n\tvar add_coupon_code = $('#add_coupon_code').val().toUpperCase();\n\tvar service_fee = Number($('#checkout_total-service_fee').html());\n\n\tif (!add_coupon_code)\n\t{\n\t\tmodal_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please enter a promo code.'\n\t\t});\n\t}\n\telse\n\t{\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'cart_add_payment',\n\t\t\t\tpayment_type: 'coupon',\n\t\t\t\tpage: 'checkout',\n\t\t\t\tcoupon_code: add_coupon_code\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tcoupon = json.coupon;\n\n\t\t\t\t\t// disable input form\n\t\t\t\t\t$('#add_coupon_code').prop('disabled', true);\n\t\t\t\t\t$('#add_coupon_add').prop('disabled', true);\n\n\t\t\t\t\t// update subtotal\n\t\t\t\t\t$('#sum_checkout_total-subtotal').html(json.orderInfo.grand_total);\n\n\t\t\t\t\tif (typeof json.edit_order_diff !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#cc_amount_diff').html(json.balance);\n\t\t\t\t\t\t$('#original_order_total').html(json.originalOrderInfo.grand_total);\n\t\t\t\t\t\t$('.edit-order-field').removeClass(\"collapse\");\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#checkout_total-tax').html(json.orderInfo.subtotal_all_taxes);\n\n\t\t\t\t\t// update coupon total\n\t\t\t\t\t$('#checkout_title-coupon_code').html(json.coupon_title);\n\n\t\t\t\t\t// update coupon total\n\t\t\t\t\t$('#checkout_total-coupon').html(formatAsMoney(json.orderInfo.coupon_code_discount_total));\n\n\t\t\t\t\tavgCostPerServingEntreeCost -= json.orderInfo.coupon_code_discount_total;\n\n\t\t\t\t\t// show coupon row\n\t\t\t\t\t$('#row-coupon').showFlex();\n\n\t\t\t\t\tif (coupon.limit_to_mfy_fee == '1' && maxPPDeduction > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar dd_val = $('#plate_points_discount').val();\n\t\t\t\t\t\tif (maxPPDeduction >= service_fee && maxPPDeduction - dd_val < service_fee)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\t\tmessage: 'The Service fee is already discounted by using Dinner Dollars. If you wish to use this coupon please lower the amount of Dinner Dollars applied.'\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tremove_payment_coupon();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar service_fee = Number($('#checkout_total-service_fee').html());\n\n\t\t\t\t\t\t\tmaxPPDeduction = maxPPDeduction - service_fee.valueOf();\n\t\t\t\t\t\t\tif (maxPPDeduction < 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmaxPPDeduction = 0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tmaxPPDeduction = formatAsMoney(maxPPDeduction);\n\t\t\t\t\t\t\teditSavePlatePointsCredits(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// calculate the balance\n\t\t\t\t\tcan_checkout();\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction calculateMaxNewGiftCardPayment(newPaymentNumber)\n{\n\tvar grandtotal = Number($('#sum_checkout_total-subtotal').html());\n\tvar existingPaymentTotal = 0;\n\n\t$('[id^=\"row-giftcard-\"]').each(function () {\n\n\t\tvar PaymentNumber = $(this).data(\"gc_number\");\n\t\tvar PaymentAmount = $(this).data(\"gc_amount\");\n\n\t\tif (PaymentNumber != newPaymentNumber)\n\t\t{\n\t\t\texistingPaymentTotal += (Number(formatAsMoney(PaymentAmount)));\n\t\t}\n\t});\n\n\tif ($('#checkout_total_payment-credits').length)\n\t{\n\t\texistingPaymentTotal += (Number($('#checkout_total_payment-credits').html()).valueOf());\n\t}\n\n\tvar maxNewPayment = grandtotal.valueOf() - existingPaymentTotal;\n\n\treturn maxNewPayment;\n\n}\n\nfunction get_gift_card_balance()\n{\n\tvar gc_number = $('#debit_gift_card_number').val();\n\tgc_number = gc_number.trim();\n\n\tif (!gc_number)\n\t{\n\t\tmodal_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please enter a gift card number.'\n\t\t});\n\t}\n\telse\n\t{\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'GET',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'giftCardBalance',\n\t\t\t\tcard_number: gc_number,\n\t\t\t\toutput: 'json'\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Gift Card Balance',\n\t\t\t\t\t\tmessage: \"Balance for card number <b>\" + json.card_number + \"</b> is <b>\" + json.card_balance + \"</b>\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Gift Card Balance Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction getGiftCardNumberAndAmount()\n{\n\tvar gc_number = $('#debit_gift_card_number').val();\n\tvar new_amount = $('#debit_gift_card_amount').val();\n\n\tvar returnData =\n\t\t{\n\t\t\tdataValid: true,\n\t\t\tgc_number: gc_number,\n\t\t\tgc_amount: new_amount,\n\t\t\tis_update: true\n\t\t};\n\n\tvar didHandleDuplicate = false;\n\n\t// check if this card number was added already\n\t// Note: this is not adequate for handling rapid clicking\n\t// Additional checks are done in do_add_gift_card\n\t$('#giftcard_container').find('[data-gc_number=\"' + gc_number + '\"]').each(function () {\n\n\t\tdidHandleDuplicate = true;\n\t\treturnData.replacementObj = this;\n\t\tmodal_message({\n\t\t\ttitle: 'Attention',\n\t\t\tmessage: 'You have already entered this gift card number. If you proceed the current amount will be replaced by the amount you are now submitting.',\n\t\t\tmodal: true,\n\t\t\tconfirm: function () {\n\t\t\t\tdo_add_gift_card(returnData);\n\t\t\t},\n\t\t\tcancel: function () {\n\t\t\t\t$('#giftCardRedeem').removeClass('disabled');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t});\n\n\tif (!didHandleDuplicate)\n\t{\n\t\tdo_add_gift_card(returnData);\n\t}\n}\n\nfunction do_add_gift_card(transaction_data)\n{\n\n\tvar is_processing = $('#debit_gift_card_number').data('processing');\n\n\tif (!transaction_data || is_processing)\n\t{\n\t\treturn;\n\t}\n\n\tif (transaction_data.gc_number)\n\t{\n\t\ttransaction_data.gc_number = transaction_data.gc_number.trim();\n\t}\n\n\tif (!transaction_data.gc_number)\n\t{\n\t\tmodal_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please enter a gift card number.'\n\t\t});\n\t}\n\telse if (!transaction_data.gc_amount)\n\t{\n\t\tmodal_message({\n\t\t\ttitle: 'Error',\n\t\t\tmessage: 'Please enter a gift card amount.'\n\t\t});\n\t}\n\telse\n\t{\n\t\tvar replacingID = 0;\n\n\t\tif (transaction_data.replacementObj)\n\t\t{\n\t\t\treplacingID = transaction_data.replacementObj.id.split(\"-\")[2];\n\t\t}\n\n\t\t$('#debit_gift_card_number').data('processing', true);\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'GET',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'giftCardBalance',\n\t\t\t\tcard_number: transaction_data.gc_number,\n\t\t\t\toutput: 'json'\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\t$('#giftCardRedeem').removeClass('disabled');\n\n\t\t\t\t\tif (json.card_balance == \"Invalid Card\")\n\t\t\t\t\t{\n\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\ttitle: 'Gift Card Error',\n\t\t\t\t\t\t\tmessage: 'The card number is invalid.'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse if ((json.card_balance * 1) < (transaction_data.gc_amount * 1))\n\t\t\t\t\t{\n\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\ttitle: 'Gift Card Error',\n\t\t\t\t\t\t\tmessage: 'There are not enough funds on the gift card for this amount. Available balance: ' + json.card_balance\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar maxNewPayment = calculateMaxNewGiftCardPayment(transaction_data.gc_number);\n\t\t\t\t\t\tif (transaction_data.gc_amount > maxNewPayment)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttransaction_data.gc_amount = maxNewPayment.toString();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\turl: '/processor',\n\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\ttimeout: 20000,\n\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tprocessor: 'cart_add_payment',\n\t\t\t\t\t\t\t\tpayment_type: 'gift_card',\n\t\t\t\t\t\t\t\tcard_number: transaction_data.gc_number,\n\t\t\t\t\t\t\t\tamount: transaction_data.gc_amount,\n\t\t\t\t\t\t\t\tc_total: $('#sum_checkout_total-subtotal').html(),\n\t\t\t\t\t\t\t\tcurrent_subtotal: $('#sum_checkout_total-subtotal').html(),\n\t\t\t\t\t\t\t\toriginal_order_total: $('#original_order_total').html(),\n\t\t\t\t\t\t\t\tpayment_id: replacingID,\n\t\t\t\t\t\t\t\toutput: 'json'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsuccess: function (json) {\n\t\t\t\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t//var payment_id = json.payment_id;\n\t\t\t\t\t\t\t\t\tif (transaction_data.replacementObj)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$(transaction_data.replacementObj).remove();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t$('#debit_gift_card_number').val('');\n\t\t\t\t\t\t\t\t\t$('#debit_gift_card_amount').val('');\n\n\t\t\t\t\t\t\t\t\t$('#giftcard_container').append(json.html);\n\n\t\t\t\t\t\t\t\t\t// show coupon row\n\t\t\t\t\t\t\t\t\t$('#giftcard_container').slideDown();\n\n\t\t\t\t\t\t\t\t\tif (typeof json.edit_order_html !== 'undefined' && json.edit_order_html != null)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t//location.reload();\n\t\t\t\t\t\t\t\t\t\t$('#edit-order-total-container').replaceWith(json.edit_order_html);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// calculate the balance\n\t\t\t\t\t\t\t\t\tcan_checkout();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\t\t\ttitle: 'Gift Card Error',\n\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#debit_gift_card_number').data('processing', false);\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#debit_gift_card_number').data('processing', false);\n\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Gift Card Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\n\t\t\t\t$('#debit_gift_card_number').data('processing', false);\n\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction add_payment_gift_card()\n{\n\tgetGiftCardNumberAndAmount();\n}\n\nfunction getDomObjectToRemove(settings)\n{\n\tvar obj = null;\n\tif (settings.item == \"giftcard\")\n\t{\n\t\tobj = $('#row-giftcard-' + settings.item_number).get();\n\n\t\treturn obj;\n\t}\n\tif (settings.item == \"creditcard\")\n\t{\n\t\tobj = $('#row-creditcard-' + settings.item_number).get();\n\n\t\treturn obj;\n\t}\n\tif (settings.item == \"credits\")\n\t{\n\t\tobj = $('#row-credits').get();\n\n\t\treturn obj;\n\t}\n\tif (settings.item == \"cc_ref\")\n\t{\n\t\tobj = $('#row-cc_ref-' + settings.item_number).get();\n\t\treturn obj;\n\t}\n\n\treturn null;\n}\n\nfunction add_all_store_credit()\n{\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_add_payment',\n\t\t\tpayment_type: 'all_store_credit',\n\t\t\tstore_id: store_id_of_order,\n\t\t\toutput: 'json'\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$('#row-credits').html(json.html);\n\t\t\t\t$('#row-credits').slideDown();\n\n\t\t\t\t// calculate the balance\n\t\t\t\tcan_checkout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Gift Card Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction removeAllStoreCredit(settings)\n{\n\tvar domObjectToRemove = getDomObjectToRemove(settings);\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_remove_payment',\n\t\t\tpayment_type: 'store_credit',\n\t\t\tpayment_number: 'all'\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$(domObjectToRemove).slideUp();\n\t\t\t\t$(domObjectToRemove).empty();\n\t\t\t\t$('#SC-total').prop(\"checked\", false);\n\n\t\t\t\tcan_checkout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction remove_payment(settings)\n{\n\tvar domObjectToRemove = getDomObjectToRemove(settings);\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_remove_payment',\n\t\t\tpayment_type: settings.item,\n\t\t\tpayment_number: settings.item_number\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tif (settings.item == 'creditcard')\n\t\t\t\t{\n\t\t\t\t\t$('[id^=\"cc\"]').prop('disabled', false);\n\t\t\t\t\t$('#billing_postal_code').prop('disabled', false);\n\t\t\t\t\t$('#billing_address').prop('disabled', false);\n\t\t\t\t\t$('#addCreditCard').prop('disabled', false);\n\t\t\t\t}\n\n\t\t\t\tif ($('#is_delayed_payment1').length)\n\t\t\t\t{\n\t\t\t\t\t$('#is_delayed_payment1').prop('disabled', false);\n\t\t\t\t\t$('#is_delayed_payment0').prop('disabled', false);\n\t\t\t\t}\n\n\t\t\t\t$(domObjectToRemove).slideUp();\n\n\t\t\t\tif (settings.item == 'creditcard')\n\t\t\t\t{\n\t\t\t\t\t$(domObjectToRemove).remove();\n\t\t\t\t}\n\n\t\t\t\tif (settings.item == 'giftcard')\n\t\t\t\t{\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}\n\n\t\t\t\tcan_checkout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction handleNewCardFormShown()\n{\n\t$('[id^=\"cc_pay_id\"]').prop({\n\t\t'disabled': true,\n\t\t'checked': false,\n\t\t'required': false\n\t});\n\t$('[id^=\"gc_pay_id\"]').prop({\n\t\t'disabled': true,\n\t\t'checked': false,\n\t\t'required': false\n\t});\n\n\trequireCreditCardFields();\n}\n\nfunction handleNewCardFormHidden()\n{\n\t$('[id^=\"cc_pay_id\"]').prop({\n\t\t'disabled': false,\n\t\t'required': true\n\t}).parents('form:first').removeClass('was-validated').find('.form-feedback').hide();\n\t$('[id^=\"gc_pay_id\"]').prop({\n\t\t'disabled': false,\n\t\t'required': true\n\t}).parents('form:first').removeClass('was-validated').find('.form-feedback').hide();\n\n\tdoNotRequireCreditCardFields();\n}\n\nfunction handleOrderCustomizations(form)\n{\n\ttry\n\t{\n\t\tif (form.attr('id') == 'to_payment_or_checkout_form')\n\t\t{\n\t\t\tlet requiredOptionSelected = false;\n\t\t\tif ($('#apply-customization').is(':checked'))\n\t\t\t{\n\t\t\t\t$('[data-user_pref_meal][type=checkbox]').each(function () {\n\t\t\t\t\tif ($(this).is(':checked'))\n\t\t\t\t\t{\n\t\t\t\t\t\trequiredOptionSelected = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!requiredOptionSelected)\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Missing Customization Options',\n\t\t\t\t\t\tmessage: \"At least one meal customization option is required if 'Customize this order' is checked.\"\n\t\t\t\t\t});\n\t\t\t\t\t$('#to_payment').removeClass('btn-spinning');\n\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t$('#to_payment').removeClass('disabled');\n\t\t\t\t\t}, 2000);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcatch (error)\n\t{\n\t\t//not worth failing over\n\t\tconsole.log('Issue checking if meal customizations are selected')\n\t}\n\n\treturn true;\n}\n\nfunction handleCardRefChange()\n{\n\tvar selectedRef = false;\n\t$('[id^=\"cc_pay_id\"]').each(function () {\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\tselectedRef = $(this).val();\n\t\t}\n\t});\n\n\t$('[id^=\"gc_pay_id\"]').each(function () {\n\t\tif ($(this).is(':checked'))\n\t\t{\n\t\t\tselectedRef = $(this).val();\n\t\t}\n\t});\n\n\tif (selectedRef)\n\t{\n\t\tdoNotRequireCreditCardFields();\n\t}\n\n}\n\nfunction requireCreditCardFields()\n{\n\t$('#ccNameOnCard, #ccType, #ccNumber, #ccMonth, #ccYear, #ccSecurityCode, #billing_address, #billing_postal_code, #billing_city').prop('required', true);\n}\n\nfunction doNotRequireCreditCardFields()\n{\n\t$('#ccNameOnCard, #ccType, #ccNumber, #ccMonth, #ccYear, #ccSecurityCode, #billing_address, #billing_postal_code, #billing_city').prop('required', false);\n}\n\nfunction remove_credit_card_reference(settings)\n{\n\tvar domObjectToRemove = getDomObjectToRemove(settings);\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_remove_payment',\n\t\t\tpayment_type: 'cc_ref',\n\t\t\tcc_ref_id: settings.item_number\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tvar numRefs = $(domObjectToRemove).data('num_cc_refs');\n\t\t\t\t$(domObjectToRemove).slideUp();\n\t\t\t\t$(domObjectToRemove).remove();\n\n\t\t\t\tif (numRefs > 1)\n\t\t\t\t{\n\t\t\t\t\t$('[id^=\"row-cc_ref\"]').data('num_cc_refs', numRefs - 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t// select add new card and expose - no refs left\n\n\t\t\t\t}\n\n\t\t\t\tcan_checkout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction add_payment_credit_card()\n{\n\tvar elementsToCheck = $('[id^=\"cc\"]').get();\n\n\tif (!_check_elements(elementsToCheck))\n\t{\n\t\treturn;\n\t}\n\n\t$('#addCreditCard').prop('disabled', true);\n\n\tvar doDelayedPayment = false;\n\n\tif ($('#is_delayed_payment1').length)\n\t{\n\t\tif ($('#is_delayed_payment1').attr('checked'))\n\t\t{\n\t\t\tdoDelayedPayment = true;\n\t\t}\n\t}\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: 'json',\n\t\tdata: {\n\t\t\tprocessor: 'cart_add_payment',\n\t\t\tpayment_type: 'credit_card',\n\t\t\tcard_number: $('#ccNumber').val(),\n\t\t\tname_on_card: $('#ccNameOnCard').val(),\n\t\t\texp_month: $('#ccMonth').val(),\n\t\t\texp_year: $('#ccYear').val(),\n\t\t\tsecurity_code: $('#ccSecurityCode').val(),\n\t\t\tcard_type: $('#ccType').val(),\n\t\t\tbilling_zip: $('#billing_postal_code').val(),\n\t\t\tbilling_addr: $('#billing_address').val(),\n\t\t\tdo_delayed_payment: doDelayedPayment,\n\t\t\toutput: 'json'\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\t$('[id^=\"cc\"]').prop('disabled', true);\n\t\t\t\t$('#billing_postal_code').prop('disabled', true);\n\t\t\t\t$('#billing_address').prop('disabled', true);\n\t\t\t\t$('#addCreditCard').prop('disabled', true);\n\n\t\t\t\tif ($('#is_delayed_payment1').length)\n\t\t\t\t{\n\t\t\t\t\t$('#is_delayed_payment1').prop('disabled', true);\n\t\t\t\t\t$('#is_delayed_payment0').prop('disabled', true);\n\t\t\t\t}\n\n\t\t\t\t$('#creditcard_container').append(json.html);\n\t\t\t\t$('#creditcard_container').slideDown();\n\n\t\t\t\t// calculate the balance\n\t\t\t\tcan_checkout();\n\n\t\t\t\tif (cart_subtotal == 0)\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Alert',\n\t\t\t\t\t\tmessage: 'You have added all required payments, you may now submit your order.'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Credit Card Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t\t$('#addCreditCard').prop('disabled', false);\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\n\t\t\t$('#addCreditCard').prop('disabled', false);\n\t\t}\n\t});\n}\n\n$(function () {\n\n\tif ($('#apply-customization').length && default_meal_customization_to_selected == true)\n\t{\n\t\t$('#apply-customization').click();\n\t}\n\telse\n\t{\n\t\tinitMealCustomizationFields();\n\t}\n\n\t$(\"form\").submit(function (e) {\n\n\t\tlet canContinue = handleOrderCustomizations($(this));\n\t\tif ($(this).data('was_submitted') === true || !canContinue)\n\t\t{\n\t\t\t// Previously submitted - don't submit again\n\t\t\te.preventDefault();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(this).data('was_submitted', true);\n\t\t}\n\t});\n\n\t$(document).on('click', '.help-cvv', function (e) {\n\t\tmodal_message({\n\t\t\ttitle: 'Help',\n\t\t\tmessage: 'The security code is a 3 digit number located on the back of MasterCard, Visa, Discover. On American Express cards, the security code is a group of 4 digits printed on the front.'\n\t\t})\n\t});\n\n\t$(document).on('change', '#ccType', function (e) {\n\n\t\tif ($(this).val() == 'American Express')\n\t\t{\n\t\t\t$('#ccSecurityCode').prop({\n\t\t\t\t'min': '0',\n\t\t\t\t'max': '9999',\n\t\t\t\t'maxlength': '4',\n\t\t\t\t'pattern': '^[0-9]{4}$'\n\t\t\t});\n\t\t}\n\t\telse if ($(this).val() != '' && $(this).val() != null)\n\t\t{\n\t\t\t$('#ccSecurityCode').prop({\n\t\t\t\t'min': '0',\n\t\t\t\t'max': '999',\n\t\t\t\t'maxlength': '3',\n\t\t\t\t'pattern': '^[0-9]{3}$'\n\t\t\t});\n\t\t}\n\t});\n\n\tif (USER_PREFERENCES && $('#ccNumber').length)\n\t{\n\t\t$('#ccNumber').validateCreditCard(function (result) {\n\n\t\t\t\tvar validatorType = false;\n\t\t\t\tif (result.card_type != null && result.card_type.name != null)\n\t\t\t\t{\n\t\t\t\t\tvalidatorType = result.card_type.name;\n\t\t\t\t}\n\n\t\t\t\tif (($('#ccType').val() == '' || $('#ccType').val() == null) && validatorType)\n\t\t\t\t{\n\t\t\t\t\tswitch (validatorType)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'visa':\n\t\t\t\t\t\t\t$('#ccType').val('Visa');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'mastercard':\n\t\t\t\t\t\t\t$('#ccType').val('Mastercard');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'amex':\n\t\t\t\t\t\t\t$('#ccType').val('American Express');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'discover':\n\t\t\t\t\t\t\t$('#ccType').val('Discover');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($('#ccType').val() != '')\n\t\t\t\t{\n\t\t\t\t\t// get validator type name of current type setting\n\t\t\t\t\tvar currentTypeWidgetValue = false;\n\t\t\t\t\tswitch ($('#ccType').val())\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'Visa':\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'visa';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Mastercard':\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'mastercard';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'American Express':\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'amex';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'Discover':\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'discover';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentTypeWidgetValue && currentTypeWidgetValue != validatorType && $(\"#ccNumber\").val().length > 2)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(\".credit_card_warning\").removeClass('collapse');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$(\".credit_card_warning\").addClass('collapse');\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\taccept: [\n\t\t\t\t\t'visa',\n\t\t\t\t\t'mastercard',\n\t\t\t\t\t'discover',\n\t\t\t\t\t'amex'\n\t\t\t\t]\n\t\t\t});\n\t}\n\n\t// Register click handler for CC logos\n\t$(document).on('click', '[data-credit_card_logo]', function (e) {\n\t\t$('#ccType').val($(this).data('credit_card_logo')).trigger('change');\n\t});\n\n\t// Click handler for remove items\n\t$(document).on('click', '[id^=\"remove-\"]', function (e) {\n\t\t// store the id and some of its parts\n\t\tvar remove = {\n\t\t\tid: this.id,\n\t\t\titem: this.id.split(\"-\")[1],\n\t\t\titem_number: this.id.split(\"-\")[2],\n\t\t\ttype: 'Payment'\n\t\t};\n\n\t\t// figure out if it has multiples like gift cards\n\t\tvar multiple = (remove.item_number != undefined) ? '-' + remove.item_number : '';\n\n\t\t// get the friendly item description to display in the popup\n\t\tremove.title = $('#checkout_title-' + remove.item + multiple).text();\n\n\t\t// it's payment by default, figure out if it is an item\n\t\tif (remove.item == 'nonfood' || remove.item == 'food' || remove.item == 'giftcard_purchase')\n\t\t{\n\t\t\tremove.type = 'Item';\n\t\t}\n\n\t\t// show removal confirmation\n\t\tmodal_message({\n\t\t\ttitle: 'Remove ' + remove.type,\n\t\t\tmessage: 'Are you sure you wish to remove ' + remove.title + '.',\n\t\t\tconfirm: function () {\n\t\t\t\tremove_item_payment(remove);\n\t\t\t}\n\t\t});\n\t});\n\n\t// Watch for change on terms checkbox\n\t$(document).on('change', '#customers_terms', function (e) {\n\t\tcan_checkout();\n\t});\n\n\t// Coupon add handler\n\t$(document).on('click', '#add_coupon_add', function (e) {\n\t\tadd_payment_coupon();\n\t\te.preventDefault();\n\t});\n\n\t// Coupon add enter key\n\t$(document).on('keyup', '#add_coupon_code', function (e) {\n\t\tif (e.which == 13)\n\t\t{\n\t\t\tadd_payment_coupon();\n\t\t}\n\t});\n\n\t// credit card\n\t$(document).on('click', '#addCreditCard', function (e) {\n\t\tadd_payment_credit_card();\n\t});\n\n\t//Gift Card Add handler\n\t$(document).on('click', '#giftCardBalance', function (e) {\n\t\te.preventDefault();\n\t\tget_gift_card_balance();\n\t});\n\n\t// Gift Card Button click\n\t$(document).on('click', '#giftCardRedeem:not(.disabled)', function (e) {\n\t\te.preventDefault();\n\t\t$(this).addClass('disabled');\n\t\tadd_payment_gift_card();\n\t});\n\n\t$(document).on('change', '#shipping_phone_number', function (e) {\n\n\t\t$('.shipping_phone_number_new_div').hideFlex();\n\t\t$('#shipping_phone_number_new').prop('required', false);\n\n\t\tif ($(this).val() == 'new')\n\t\t{\n\t\t\t$('.shipping_phone_number_new_div').showFlex();\n\t\t\t$('#shipping_phone_number_new').prop('required', true);\n\n\t\t}\n\t});\n\n\t$(document).on('change', '#address_book_select', function (e) {\n\n\t\tlet id = $(this).val();\n\t\tlet prev_id = (($('#address_book_update_update').val() == 'update') ? '' : $('#address_book_update_update').val());\n\n\t\tif (id == '')\n\t\t{\n\t\t\t$('#address_book_update_update').val('update');\n\n\t\t\t$('#shipping_firstname').valCheckDiffRemove('');\n\t\t\t$('#shipping_lastname').valCheckDiffRemove('');\n\t\t\t$('#shipping_address_line1').valCheckDiffRemove('');\n\t\t\t$('#shipping_address_line2').valCheckDiffRemove('');\n\t\t\t$('#shipping_city').valCheckDiffRemove('');\n\t\t\t$('#shipping_state_id').valCheckDiffRemove('');\n\t\t\t$('#shipping_address_note').valCheckDiffRemove('');\n\t\t\t$('#shipping_phone_number').valCheckDiffRemove('');\n\t\t\t$('#shipping_gift_email_address').valCheckDiffRemove('');\n\n\t\t\t$('#shipping_postal_code').valCheckDiffRemove();\n\t\t}\n\t\telse if (id)\n\t\t{\n\t\t\t$.ajax({\n\t\t\t\turl: '/processor',\n\t\t\t\ttype: 'POST',\n\t\t\t\ttimeout: 20000,\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tprocessor: 'delivered_box',\n\t\t\t\t\top: 'update_address',\n\t\t\t\t\tid: id\n\t\t\t\t},\n\t\t\t\tsuccess: function (json) {\n\t\t\t\t\tif (json.processor_success)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet addy = JSON.parse(json.address);\n\n\t\t\t\t\t\tswitch (json.status)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'no_inventory':\n\t\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message,\n\t\t\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\t\t\t\"Cancel\": function () {\n\t\t\t\t\t\t\t\t\t\t\t$('#address_book_select').val(prev_id);\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\"Change Address\": function () {\n\t\t\t\t\t\t\t\t\t\t\tcreate_and_submit_form({\n\t\t\t\t\t\t\t\t\t\t\t\taction: '/box-select',\n\t\t\t\t\t\t\t\t\t\t\t\tinput: ({\n\t\t\t\t\t\t\t\t\t\t\t\t\tdelivered_zip: addy.postal_code\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'not_eligible':\n\t\t\t\t\t\t\t\tmodal_message({\n\t\t\t\t\t\t\t\t\tmessage: 'We are sorry, Dream Dinners does not currently ship to ' + addy.postal_code,\n\t\t\t\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\t\t\t\t\"Close\": function () {\n\t\t\t\t\t\t\t\t\t\t\t$('#address_book_select').val(prev_id);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tif (addy.location_type == 'ADDRESS_BOOK')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$('#address_book_update_update').val(addy.id);\n\n\t\t\t\t\t\t\t\t\t$('#shipping_firstname').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.firstname,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_lastname').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.lastname,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line1').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.address_line1,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line2').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.address_line2,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_city').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.city,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_state_id').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.state_id,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_address_note').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.address_note,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_phone_number').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.telephone_1,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$('#shipping_gift_email_address').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.email_address,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t$('#shipping_postal_code').valCheckDiff({\n\t\t\t\t\t\t\t\t\t\tvalue: addy.postal_code,\n\t\t\t\t\t\t\t\t\t\tgroup: 'shipaddy'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$('#shipping_firstname').val(addy.firstname);\n\t\t\t\t\t\t\t\t\t$('#shipping_lastname').val(addy.lastname);\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line1').val(addy.address_line1);\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line2').val(addy.address_line2);\n\t\t\t\t\t\t\t\t\t$('#shipping_city').val(addy.city);\n\t\t\t\t\t\t\t\t\t$('#shipping_state_id').val(addy.state_id);\n\t\t\t\t\t\t\t\t\t$('#shipping_address_note').val(addy.address_note);\n\t\t\t\t\t\t\t\t\t$('#shipping_phone_number').val(addy.telephone_1);\n\t\t\t\t\t\t\t\t\t$('#shipping_gift_email_address').val(addy.email_address);\n\n\t\t\t\t\t\t\t\t\t$('#shipping_postal_code').val(addy.postal_code);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t});\n\n\t$(document).on('dd:checkdiff', function (e) {\n\n\t\tlet diffData = $(document).data().checkdiff;\n\n\t\tif (Object.keys(diffData['shipaddy']).length === 0)\n\t\t{\n\t\t\t$('.update_contact_row').hideFlex();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('.update_contact_row').showFlex();\n\t\t}\n\n\t});\n\n\t$(document).on('shown.bs.collapse', '#add_new_cc', function (e) {\n\t\thandleNewCardFormShown();\n\t});\n\n\t$(document).on('hidden.bs.collapse', '#add_new_cc', function (e) {\n\t\thandleNewCardFormHidden();\n\t});\n\n\t$(document).on('change', '[id^=\"cc_pay_id\"]', function (e) {\n\t\thandleCardRefChange();\n\t});\n\n\t$(document).on('change', '[id^=\"gc_pay_id\"]', function (e) {\n\t\thandleCardRefChange();\n\t});\n\n\t$(document).on('click', '.box-change-zip', function (e) {\n\n\t\te.preventDefault();\n\n\t\tlet href = $(this).attr('href');\n\n\t\tmodal_message({\n\t\t\tmessage: 'Menu item availability and taxes may be different for another delivery area. In order to change the zip code, we need to send you through the order process again.',\n\t\t\tbuttons: {\n\t\t\t\t\"Change Zip\": function () {\n\t\t\t\t\tbounce(href);\n\t\t\t\t},\n\t\t\t\t\"Cancel\": function () {\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t});\n\n\t// Logged in functions\n\tif (USER_PREFERENCES)\n\t{\n\t\thandle_ltd_round_up();\n\t\thandle_checkout_delayed_payment();\n\t\thandle_special_instructions();\n\t\thandleMealCustomizationAccordion();\n\n\t\t$(document).on('click', '#apply_plate_points', function (e) {\n\t\t\teditSavePlatePointsCredits(false);\n\t\t});\n\n\t\t$(document).on('click', '#apply_all_plate_points', function (e) {\n\t\t\teditSaveAllPlatePointsCredits(false);\n\t\t});\n\n\t\t/*\n\t\t\t\t$(document).on('keyup', '#plate_points_discount', function (e) {\n\t\t\t\t\tif (e.which == 13)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#edit_plate_points').trigger('click');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t*/\n\t\tif ($(\"#apply_plate_points\").length && maxPPDeduction <= 0)\n\t\t{\n\t\t\t$(\"#apply_plate_points\").attr(\"disabled\", true);\n\t\t\t$(\"#apply_all_plate_points\").attr(\"disabled\", true);\n\n\t\t}\n\t}\n\n\tcan_checkout();\n\n});\n\nconst checkbox = document.getElementById('opted_to_bring_bags');\nif (checkbox)\n{\n\tcheckbox.addEventListener('click', function handleClick() {\n\t\tif (checkbox.checked)\n\t\t{\n\t\t\t$(\"#bag_text\").hideFlex();\n\t\t\t$(\"#opted_to_bring_bags_hidden\").val(\"1\");\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#bag_text\").showFlex();\n\t\t\t$(\"#opted_to_bring_bags_hidden\").val(\"0\");\n\t\t}\n\t\tupdate_bag_opt_out();\n\t});\n}\n\nfunction handleMealCustomizationAccordion()\n{\n\t$(\"#customization-header\").click(function (e) {\n\t\te.preventDefault();\n\n\t\t$header = $(this);\n\t\t$content = $(\"#customization-row\");\n\t\t$header.html(function () {\n\t\t\treturn \"Meal Customizations\" + ($content.is(\":visible\") ? \" &#8744;\" : \" &#8743;\");\n\t\t});\n\t\t$content.slideToggle(500, function () {\n\t\t});\n\n\t});\n}\n\nfunction initMealCustomizationFields()\n{\n\tif (typeof has_meal_customization_selected === 'undefined')\n\t{\n\t\thas_meal_customization_selected = false;\n\t}\n\ttoggleMealCustomizationOptions(has_meal_customization_selected);\n}\n\nfunction toggleMealCustomizationOptions(on)\n{\n\tif (on)\n\t{\n\t\t$('[data-user_pref_meal][type=checkbox]').removeAttr(\"disabled\");\n\t\t$('.customization-readonly-option').removeClass('text-gray-400')\n\t}\n\telse\n\t{\n\t\t$('[data-user_pref_meal][type=checkbox]').attr(\"disabled\", true);\n\t\t$('.customization-readonly-option').addClass('text-gray-400')\n\t}\n}\n\nfunction toggleMealCustomizationMasterCheckbox(on)\n{\n\tif (on)\n\t{\n\t\t$('#apply-customization').prop('checked', true);\n\t\t$('#apply-customization').attr('checked', true);\n\t\thas_meal_customization_selected = true;\n\t}\n\telse\n\t{\n\t\t$('#apply-customization').prop('checked', false);\n\t\t$('#apply-customization').attr('checked', true);\n\t\thas_meal_customization_selected = false;\n\t\thandleMealCustomizationMasterCheckbox(false);\n\t}\n}\n\nfunction handleMealCustomizationMasterCheckbox(allow_customization)\n{\n\thas_meal_customization_selected = allow_customization;\n\ttoggleMealCustomizationOptions(allow_customization);\n\n\t$.ajax({\n\t\turl: '/processor',\n\t\ttype: 'POST',\n\t\ttimeout: 20000,\n\t\tdataType: \"JSON\",\n\t\tdata: {\n\t\t\tprocessor: 'cart_order_customization_preference',\n\t\t\top: 'set_customization_applies_to_order',\n\t\t\tallow_customization: allow_customization,\n\t\t\tcustomizations: JSON.stringify(meal_customization_preferences)\n\t\t},\n\t\tsuccess: function (json) {\n\t\t\tif (json.processor_success)\n\t\t\t{\n\t\t\t\tcustomization = json;\n\t\t\t\tif (customization.opted_to_customize_recipes == true)\n\t\t\t\t{\n\t\t\t\t\t$('#customization-fee-row').show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$('#customization-fee-row').hide();\n\t\t\t\t}\n\t\t\t\t$('#checkout_total-customization_fee').text(formatAsMoney(customization.cost));\n\t\t\t\t$('#sum_checkout_total-subtotal').text(formatAsMoney(customization.orderInfo.grand_total));\n\t\t\t\t$('#credit_card_amount').text(formatAsMoney(customization.orderInfo.grand_total));\n\t\t\t\t$('#checkout_total-tax').text(formatAsMoney(customization.orderInfo.subtotal_all_taxes));\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\terror: function (objAJAXRequest, strError) {\n\t\t\tmodal_message({\n\t\t\t\ttitle: 'Error',\n\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t});\n\t\t}\n\t});\n}\n\n$(document).on('click', '.checkout-edit-delivery-tip:not(.disabled)', function (e) {\n\te.preventDefault();\n\tlet delivery_tip= ($('#delivery_tip').val() == '') ? 0 : $('#delivery_tip').val();\n\n\tif (!$('#delivery_tip').data('editing'))\n\t{\n\t\t$('#delivery_tip').prop({readonly: false}).data('editing', true, 'org-val', delivery_tip);\n\t\t$(this).text('Apply');\n\t}\n\telse\n\t{\n\t\t$('#delivery_tip').prop({readonly: true}).data('editing', false);\n\t\t$(this).addClass('disabled').text('Updating');\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'cart_add_payment',\n\t\t\t\tpayment_type: 'delivery_tip',\n\t\t\t\tvalue: delivery_tip\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\t$('.checkout-edit-delivery-tip').removeClass('disabled').text('Edit');\n\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\t\t\t\t\t$('.checkout_total-delivery_tip').text(formatAsMoney(json.delivery_tip));\n\t\t\t\t\t$('#sum_checkout_total-subtotal, #credit_card_amount').text(formatAsMoney(json.grand_total));\n\n\t\t\t\t\tif (json.delivery_tip > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.row-delivery_tip').showFlex();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.row-delivery_tip').hideFlex();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tcan_checkout();\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n});\n\n$(document).on('click', '#apply-customization', function (e) {\n\tlet allow_customization = $(this).prop('checked');\n\thandleMealCustomizationMasterCheckbox(allow_customization);\n});\n\nfunction preferenceChangeListener(pref, setting, user_id, callback)\n{\n\n\tpref = pref.toUpperCase();\n\n\tif (!pref.includes('MEAL'))\n\t{\n\t\tset_user_pref(pref, setting, user_id, callback);\n\t}\n\telse\n\t{\n\t\tlet pref_value = USER_PREFERENCES[pref].value;\n\n\t\tif ($.isPlainObject(pref_value) && $.isPlainObject(setting))\n\t\t{\n\t\t\tsetting = JSON.stringify($.extend(USER_PREFERENCES[pref].value, setting));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsetting = setting.toString()\n\t\t}\n\n\t\tmeal_customization_preferences[pref].value = setting;\n\n\t\t$.ajax({\n\t\t\turl: '/processor',\n\t\t\ttype: 'POST',\n\t\t\ttimeout: 20000,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tprocessor: 'cart_order_customization_preference',\n\t\t\t\top: 'update_order_meal_customization',\n\t\t\t\tcustomizations: JSON.stringify(meal_customization_preferences)\n\t\t\t},\n\t\t\tsuccess: function (json) {\n\t\t\t\tif (json.processor_success)\n\t\t\t\t{\n\n\t\t\t\t\tif (json.opted_to_customize_recipes == true)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#customization-fee-row').show();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#customization-fee-row').hide();\n\t\t\t\t\t\t//toggleMealCustomizationMasterCheckbox(false);\n\t\t\t\t\t}\n\t\t\t\t\t$('#checkout_total-customization_fee').text(formatAsMoney(json.cost));\n\t\t\t\t\t$('#sum_checkout_total-subtotal').text(formatAsMoney(json.orderInfo.grand_total));\n\t\t\t\t\t$('#credit_card_amount').text(formatAsMoney(json.orderInfo.grand_total));\n\n\t\t\t\t\tif (typeof callback !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback(json);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tmodal_message({\n\t\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\t\tmessage: json.processor_message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function (objAJAXRequest, strError) {\n\t\t\t\tmodal_message({\n\t\t\t\t\ttitle: 'Error',\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n}"],"mappings":"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"}
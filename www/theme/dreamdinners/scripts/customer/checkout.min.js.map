{"version":3,"sourceRoot":"js/src/dreamdinners","sources":["checkout.js"],"sourcesContent":["cart_subtotal = 0;\r\n\r\nfunction handle_ltd_round_up()\r\n{\r\n\t$(document).on('change', '#add_ltd_round_up', function (e) {\r\n\r\n\t\tif ($(this).is(':checked'))\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false);\r\n\r\n\t\t\tif (USER_PREFERENCES.LTD_AUTO_ROUND_UP.value == '' && (!$.cookie('ltdru') || $.cookie('ltdru') != session_id))\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\tmessage: 'Would you like to automatically round up every time you order? You can edit this setting any time in <span class=\"font-weight-bold\">My Preferences</span>.<div class=\"text-center; mt-1\"><select id=\"ltd-round_up_opt_in\"><option>Select a Round Up value</option><option value=\"1\">Nearest Dollar</option><option value=\"2\">2 Dollars</option><option value=\"5\">5 Dollars</option><option value=\"10\">10 Dollars</option><option value=\"35\">35 Dollars</option><option value=\"54\">54 Dollars</option></select></div>',\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\r\n\t\t\t\t\t\tvar rup_dialog = $(this);\r\n\r\n\t\t\t\t\t\t$('#ltd-round_up_opt_in').on('change', function (e) {\r\n\r\n\t\t\t\t\t\t\tvar rup_value = $(this).val();\r\n\r\n\t\t\t\t\t\t\tif (rup_value > 0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\tdiv_id: 'rup_confirm',\r\n\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\t\t\t\t\tmessage: 'You have chosen to set your auto Round Up to ' + ((rup_value == 1) ? 'the nearest dollar.' : '$' + rup_value),\r\n\t\t\t\t\t\t\t\t\tconfirm: function () {\r\n\t\t\t\t\t\t\t\t\t\t$(rup_dialog).remove();\r\n\r\n\t\t\t\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', rup_value);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (ltd_round_up_value == 0 && rup_value != 1 || ($('#ltd_round_up_select option:selected').index() == 0 && !$.cookie('ltdru')))\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'My Preferences',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Preference saved. Would you like to use your selected Round Up value on this order? This can be reviewed and edited.',\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\t\t\t\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Yes\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rup_value == 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select option:eq(0)').prop('selected', true).trigger('change');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$('#ltd_round_up_select').val(rup_value).trigger('change');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"No\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\"No\": function () {\r\n\t\t\t\t\t\t\tset_user_pref('LTD_AUTO_ROUND_UP', 0);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"Ask Again Later\": function () {\r\n\t\t\t\t\t\t\t$.cookie('ltdru', session_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', true);\r\n\t\t}\r\n\r\n\t\t$('#ltd_round_up_select').trigger('change');\r\n\r\n\t});\r\n\r\n\t$('#ltd_round_up_select').on('change', function (e) {\r\n\r\n\t\tvar round_up_val = $(this).val();\r\n\r\n\t\tif (round_up_val != null)\r\n\t\t{\r\n\t\t\t$('#checkout_total-roundup_donation').text(formatAsMoney(round_up_val));\r\n\r\n\t\t\tif ($('#add_ltd_round_up').is(':checked'))\r\n\t\t\t{\r\n\t\t\t\t$('#ltd_round_up_div').slideDown();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#ltd_round_up_div').slideUp();\r\n\r\n\t\t\t\tround_up_val = 0;\r\n\t\t\t}\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'cart_add_payment',\r\n\t\t\t\t\tpayment_type: 'ltd_round_up',\r\n\t\t\t\t\tltd_round_up_value: round_up_val\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t//\tconsole.log('OM Intense logging: ' + message);\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tupdateFinancials();\r\n\t});\r\n\r\n\tif (!$('#add_ltd_round_up').is(':checked') && USER_PREFERENCES.LTD_AUTO_ROUND_UP.value > 0 && ltd_round_up_value == null)\r\n\t{\r\n\t\t$('#add_ltd_round_up').prop('checked', true);\r\n\r\n\t\tif (USER_PREFERENCES.LTD_AUTO_ROUND_UP.value > 1)\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select').val(USER_PREFERENCES.LTD_AUTO_ROUND_UP.value).prop('disabled', false).trigger('change');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#ltd_round_up_select option:first-child').attr('selected', true);\r\n\t\t\t$('#ltd_round_up_select').prop('disabled', false).trigger('change');\r\n\r\n\t\t}\r\n\t}\r\n\telse if ($('#add_ltd_round_up').is(':checked'))\r\n\t{\r\n\t\t$('#ltd_round_up_select').prop('disabled', false).trigger('change');\r\n\t}\r\n}\r\n\r\nfunction handle_checkout_delayed_payment()\r\n{\r\n\tif (USER_PREFERENCES)\r\n\t{\r\n\t\tget_user_pref('TC_DELAYED_PAYMENT_AGREE', null, function (json) {\r\n\r\n\t\t\tif (json.user_preferences['TC_DELAYED_PAYMENT_AGREE'].value == 1 || json.user_preferences['TC_DELAYED_PAYMENT_AGREE'].value == '1')\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment1, #is_flat_rate_delayed_payment1, #is_delayed_payment1').on('click', function (e) {\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\r\n\t\t\t\t\tmessage: lang.en.tc.delayed_payment,\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tnoOk: true,\r\n\t\t\t\t\tcloseOnEscape: false,\r\n\t\t\t\t\topen: function (event, ui) {\r\n\t\t\t\t\t\t$(this).parent().find('.ui-dialog-titlebar-close').hide();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\"Agree\": function () {\r\n\r\n\t\t\t\t\t\t\t$('#is_store_specific_flat_rate_delayed_payment1, #is_flat_rate_delayed_payment1, #is_delayed_payment1').unbind(\"click\");\r\n\r\n\t\t\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 1);\r\n\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"Decline\": function () {\r\n\r\n\t\t\t\t\t\t\t$('#is_store_specific_flat_rate_delayed_payment0, #is_flat_rate_delayed_payment0, #is_delayed_payment0').click();\r\n\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: lang.en.tc.terms_and_conditions,\r\n\t\t\t\t\t\t\t\tmessage: lang.en.tc.delayed_payment_decline\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tset_user_pref('TC_DELAYED_PAYMENT_AGREE', 0);\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction handle_special_instructions()\r\n{\r\n\t$(document).on('keyup', '#special_insts', function (e) {\r\n\r\n\t\tif ($(this).val() != strip_tags($(this).val()))\r\n\t\t{\r\n\t\t\t$(this).val(strip_tags($(this).val()));\r\n\t\t}\r\n\r\n\t});\r\n}\r\n\r\nfunction submit_gift_card_purchase()\r\n{\r\n\tvar field = $('<input></input>');\r\n\tfield.attr(\"type\", \"hidden\");\r\n\tfield.attr(\"name\", \"checkout_submit\");\r\n\tfield.attr(\"value\", \"true\");\r\n\t$(\"#gift_card_checkout\").append(field);\r\n\r\n\t$(\"#gift_card_checkout\").submit();\r\n}\r\n\r\n\r\nfunction submit_order()\r\n{\r\n\tcreate_and_submit_form({\r\n\t\taction: 'main.php?page=checkout',\r\n\t\tinput: ({\r\n\t\t\tspecial_insts: $('#special_insts').val(),\r\n\t\t\tcustomers_terms: $('#customers_terms').val()\r\n\t\t})\r\n\t});\r\n}\r\n\r\nfunction handlePlatePointsDiscount(val)\r\n{\r\n\tinVal = val;\r\n\r\n\tif ((isNaN(val) || val <= 0) && val != \".\")\r\n\t{\r\n\t\tval = 0;\r\n\t}\r\n\r\n\tvar cap = maxPPCredit;\r\n\tif (cap > maxPPDeduction)\r\n\t{\r\n\t\tcap = maxPPDeduction;\r\n\t}\r\n\r\n\tif (val > cap)\r\n\t{\r\n\t\tval = cap;\r\n\t}\r\n\r\n\tif (val < 0)\r\n\t{\r\n\t\tval = 0;\r\n\t}\r\n\r\n\tif (val != inVal || isNaN(inVal) || inVal == \"\")\r\n\t{\r\n\t\t$('#plate_points_discount').val(val);\r\n\t}\r\n\r\n}\r\n\r\nfunction editSaveAllPlatePointsCredits()\r\n{\r\n\t$('#plate_points_discount').val(formatAsMoney(maxPPDeduction));\r\n\teditSavePlatePointsCredits(false);\r\n}\r\n\r\n\r\n\r\n\r\nfunction editSavePlatePointsCredits(force)\r\n{\r\n\tif (force)\r\n\t{\r\n\t\t$(\"#max_plate_points_deduction\").html(maxPPDeduction);\r\n\t}\r\n\r\n\tvar val = $('#plate_points_discount').val();\r\n\r\n\tif (typeof val !== 'undefined')\r\n\t{\r\n\t\tvar cap = maxPPCredit;\r\n\t\tif (cap > maxPPDeduction)\r\n\t\t{\r\n\t\t\tcap = maxPPDeduction;\r\n\t\t}\r\n\r\n\t\tif (val > cap)\r\n\t\t{\r\n\t\t\tval = cap;\r\n\t\t}\r\n\r\n\t\tif (val < 0)\r\n\t\t{\r\n\t\t\tval = 0;\r\n\t\t}\r\n\r\n\t\t$('#plate_points_discount').val(formatAsMoney(val));\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'cart_modify_plate_points_credits',\r\n\t\t\t\top: 'modify',\r\n\t\t\t\tnew_credit_value: val\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\t// update subtotal\r\n\t\t\t\t\t$('#sum_checkout_total-subtotal').html(formatAsMoney(json.orderInfo.grand_total));\r\n\r\n\t\t\t\t\t$('#checkout_total-tax').html(formatAsMoney(json.orderInfo.subtotal_all_taxes));\r\n\r\n\t\t\t\t\tif (val > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('#row-discount_plate_points').showFlex();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('#row-discount_plate_points').hideFlex();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// update coupon total\r\n\t\t\t\t\t$('#checkout_total-coupon').html(formatAsMoney(json.orderInfo.coupon_code_discount_total));\r\n\r\n\t\t\t\t\tavgCostPerServingEntreeCost -= json.orderInfo.coupon_code_discount_total;\r\n\r\n\t\t\t\t\t$(\"#checkout_total-points_discount_total\").html(formatAsMoney(json.orderInfo.points_discount_total));\r\n\t\t\t\t\t$(\"#checkout_total-membership_discount\").html(formatAsMoney(json.orderInfo.membership_discount));\r\n\r\n\r\n\r\n\t\t\t\t\t// calculate the balance\r\n\t\t\t\t\tcan_checkout();\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\nfunction run_as_guest()\r\n{\r\n\tcreate_and_submit_form({\r\n\t\taction: 'main.php?page=checkout',\r\n\t\tinput: ({\r\n\t\t\trun_as_guest: \"true\"\r\n\t\t})\r\n\t});\r\n}\r\n\r\nfunction updateFinancials()\r\n{\r\n\tvar foodCost = 0;\r\n\tvar bag_fee = 0;\r\n\r\n\tif ($('#checkout_total-food').length)\r\n\t{\r\n\t\tfoodCost = Number($('#checkout_total-food').html());\r\n\t}\r\n\r\n\tvar giftCardCost = 0;\r\n\t$('[id^=\"checkout_total-giftcard_purchase\"]').each(function () {\r\n\t\tvar thisCost = Number($(this).html());\r\n\t\tgiftCardCost += thisCost;\r\n\t});\r\n\r\n\tvar service_fee = 0;\r\n\tif ($('#checkout_total-service_fee').length)\r\n\t{\r\n\t\tservice_fee = Number($('#checkout_total-service_fee').html());\r\n\t}\r\n\r\n\tvar delivery_fee = 0;\r\n\tif ($('#checkout_total-delivery_fee').length)\r\n\t{\r\n\t\tdelivery_fee = Number($('#checkout_total-delivery_fee').html());\r\n\t}\r\n\r\n\r\n\tvar totalTax = 0;\r\n\tif ($('#checkout_total-tax').length)\r\n\t{\r\n\t\ttotalTax = Number($('#checkout_total-tax').html());\r\n\t}\r\n\r\n\tvar prediscountFoodTotal = foodCost;\r\n\r\n\t// Note: coupon code and points discount are the only discounts that can affect price\r\n\t// without a page refresh. If there is a change we need to recalculate tax\r\n\tvar couponDiscount = 0;\r\n\tif ($('#checkout_total-coupon').length)\r\n\t{\r\n\t\tcouponDiscount = Number($('#checkout_total-coupon').html());\r\n\t}\r\n\r\n\tvar volumeDiscount = 0;\r\n\tif ($('#checkout_total-volume_discount').length)\r\n\t{\r\n\t\tvolumeDiscount = Number($('#checkout_total-volume_discount').html());\r\n\t}\r\n\r\n\tvar preferredDiscount = 0;\r\n\tif ($('#checkout_total-preferred_discount').length)\r\n\t{\r\n\t\tpreferredDiscount = Number($('#checkout_total-preferred_discount').html());\r\n\t}\r\n\r\n\tvar dreamRewardsDiscount = 0;\r\n\tif ($('#checkout_total-dream_rewards_discount').length)\r\n\t{\r\n\t\tdreamRewardsDiscount = Number($('#checkout_total-dream_rewards_discount').html());\r\n\t}\r\n\r\n\tvar sessionDiscount = 0;\r\n\tif ($('#checkout_total-session_discount_total').length)\r\n\t{\r\n\t\tsessionDiscount = Number($('#checkout_total-session_discount_total').html());\r\n\t}\r\n\r\n\tvar pointsDiscount = 0;\r\n\tif ($('#checkout_total-points_discount_total').length)\r\n\t{\r\n\t\tpointsDiscount = Number($('#checkout_total-points_discount_total').html());\r\n\t}\r\n\r\n\tvar membershipDiscount = 0;\r\n\tif ($('#checkout_total-membership_discount').length)\r\n\t{\r\n\t\tmembershipDiscount = Number($('#checkout_total-membership_discount').html());\r\n\t}\r\n\r\n\tvar bag_fee = 0;\r\n\tif ($('#checkout_total-bag_fee').length)\r\n\t{\r\n\t\tbag_fee = Number($('#checkout_total-bag_fee').html());\r\n\t}\r\n\r\n\tvar customization_fee = 0;\r\n\tif ($('#checkout_total-customization_fee').length)\r\n\t{\r\n\t\tcustomization_fee = Number($('#checkout_total-customization_fee').html());\r\n\t}\r\n\r\n\tvar foodCost = prediscountFoodTotal - (couponDiscount + preferredDiscount + volumeDiscount + dreamRewardsDiscount + sessionDiscount + pointsDiscount + membershipDiscount);\r\n\tvar grand_total = Number(formatAsMoney(foodCost + giftCardCost + service_fee + delivery_fee + bag_fee + totalTax + customization_fee));\r\n\r\n\t$('#sum_checkout_total-subtotal').html(formatAsMoney(grand_total));\r\n\r\n\tvar paymentsTotal = 0;\r\n\t$('[id^=\"checkout_total_payment-\"]').each(function () {\r\n\r\n\t\tif ($(this).is(':visible'))\r\n\t\t{\r\n\t\t\tpaymentsTotal += Number($(this).html());\r\n\t\t}\r\n\t});\r\n\r\n\tif (paymentsTotal > foodCost + service_fee + delivery_fee + bag_fee + totalTax)\r\n\t{\r\n\t\t//more store credit than food cost so we must cap the store credit that can be used\r\n\t\tpaymentsTotal = foodCost + service_fee + delivery_fee+ bag_fee + totalTax;\r\n\t\t$('[id^=\"checkout_total_payment-credits\"]').html(formatAsMoney(paymentsTotal));\r\n\t}\r\n\r\n\tif (giftCardCost > 0)\r\n\t{\r\n\t\t//\t$('[id^=\"gc_checkout_total_adj_payment-creditcard-\"]').html(formatAsMoney(giftCardCost ));\r\n\t}\r\n\r\n\tvar credit_card_food_total = grand_total - paymentsTotal - giftCardCost;\r\n\r\n\tvar round_up_donation = 0;\r\n\r\n\tvar subtotal_round_up = Math.ceil(credit_card_food_total + giftCardCost);\r\n\tvar subtotal_round_up_diff = parseFloat((subtotal_round_up - (credit_card_food_total + giftCardCost)).toFixed(2));\r\n\r\n\tif (subtotal_round_up_diff == 0)\r\n\t{\r\n\t\tsubtotal_round_up_diff = 1.00;\r\n\t}\r\n\r\n\tif ($('#round_up_nearest_dollar').val() != subtotal_round_up_diff)\r\n\t{\r\n\t\t$('#round_up_nearest_dollar').val(subtotal_round_up_diff).text('$ ' + formatAsMoney(subtotal_round_up_diff));\r\n\t\t$('#add_ltd_round_up').trigger('change');\r\n\t}\r\n\r\n\tif ($('#add_ltd_round_up').is(':checked'))\r\n\t{\r\n\t\tif ($('#ltd_round_up_select').find(':selected').attr('id') == 'round_up_nearest_dollar')\r\n\t\t{\r\n\t\t\tround_up_donation = subtotal_round_up_diff;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tround_up_donation = parseFloat($('#ltd_round_up_select').val());\r\n\t\t}\r\n\t}\r\n\r\n\t$('[id^=\"credit_card_amount\"]').html(formatAsMoney(credit_card_food_total + giftCardCost + round_up_donation));\r\n\t$('#debit_credit_card_amount').html(formatAsMoney(credit_card_food_total + giftCardCost + round_up_donation));\r\n\r\n\tvar hasEnoughNonCCFunds = false;\r\n\r\n\tvar isEditOrder = false;\r\n\tif ($('#isEditDeliveredOrder').length)\r\n\t{\r\n\t\tisEditOrder = true;\r\n\t}\r\n\r\n\r\n\tif( isEditOrder ){\r\n\t\tcredit_card_food_total = $('#cc_amount_diff').html();\r\n\r\n\t}\r\n\r\n\tif (credit_card_food_total == 0 && giftCardCost == 0)\r\n\t{\r\n\t\t$('[id^=\"cc\"]').prop('disabled', true);\r\n\t\t$('#billing_postal_code').prop('disabled', true);\r\n\t\t$('#billing_address').prop('disabled', true);\r\n\t\t$('#addCreditCard').prop('disabled', true);\r\n\t\t$('#save_cc_as_ref').prop('disabled', true);\r\n\r\n\t\tif ($('#is_store_specific_flat_rate_delayed_payment1').length)\r\n\t\t{\r\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment1').prop('disabled', true);\r\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment0').prop('disabled', true);\r\n\t\t}\r\n\r\n\t\t$('#enough_funds_alert').show();\r\n\r\n\t\thasEnoughNonCCFunds = true;\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$('[id^=\"cc\"]').prop('disabled', false);\r\n\t\t$('#billing_postal_code').prop('disabled', false);\r\n\t\t$('#billing_address').prop('disabled', false);\r\n\t\t$('#addCreditCard').prop('disabled', false);\r\n\t\t$('#save_cc_as_ref').prop('disabled', false);\r\n\r\n\t\tif ($('#is_store_specific_flat_rate_delayed_payment1').length)\r\n\t\t{\r\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment1').prop('disabled', false);\r\n\t\t\t$('#is_store_specific_flat_rate_delayed_payment0').prop('disabled', false);\r\n\t\t}\r\n\r\n\t\t$('#enough_funds_alert').hide();\r\n\t}\r\n\r\n\t//$('#debit_credit_card_amount').html(formatAsMoney(credit_card_food_total + giftCardCost));\r\n\r\n\tvar cost_per_serving = formatAsMoney(avgCostPerServingEntreeCost / avgCostPerServingEntreeServings);\r\n\r\n\t$('#checkout-cost_per_serving').html(cost_per_serving);\r\n\r\n\t$('#sum_checkout_total-balance').html(formatAsMoney(0));\r\n\r\n\treturn hasEnoughNonCCFunds;\r\n}\r\n\r\nfunction can_checkout()\r\n{\r\n\thandleCardRefChange();\r\n\r\n\tvar hasEnoughNonCCFunds = updateFinancials();\r\n\r\n\tif (is_discounts_page)\r\n\t{\r\n\t\tif (hasEnoughNonCCFunds)\r\n\t\t{\r\n\t\t\t$('#checkoutOption').addClass('show');\r\n\t\t\t$('#toPaymentOption').removeClass('show');\r\n\r\n\t\t\t// if balance is 0 and terms and conditions have been checked, enable checkout\r\n\t\t\tif ($('#customers_terms').is(':checked'))\r\n\t\t\t{\r\n\t\t\t\t$('#complete_order').attr('disabled', false);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$('#complete_order').attr('disabled', true);\r\n\t\t\t}\r\n\r\n\t\t\t$('#customers_terms').attr('required', 'required');\r\n\t\t\t$(\"#to_payment_or_checkout_form\").prop(\"action\", '/main.php?page=checkout');\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#checkoutOption').removeClass('show');\r\n\t\t\t$('#toPaymentOption').addClass('show');\r\n\r\n\t\t\t$(\"#to_payment\").attr('disabled', false);\r\n\r\n\t\t\t$('#customers_terms').attr('required', false);\r\n\t\t\t$(\"#to_payment_or_checkout_form\").prop(\"action\", '/main.php?page=payment');\r\n\r\n\t\t}\r\n\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// if balance is 0 and terms and conditions have been checked, enable checkout\r\n\t\tif ($('#customers_terms').is(':checked'))\r\n\t\t{\r\n\t\t\t$('#complete_order').attr('disabled', false);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('#complete_order').attr('disabled', true);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction remove_item_payment(settings)\r\n{\r\n\tif (settings.item == 'food')\r\n\t{\r\n\t\tremove_food();\r\n\t}\r\n\r\n\tif (settings.item == 'nonfood')\r\n\t{\r\n\t\t// remove_item_nonfood(settings);\r\n\t}\r\n\r\n\tif (settings.item == 'credits')\r\n\t{\r\n\t\tremoveAllStoreCredit(settings);\r\n\t}\r\n\r\n\tif (settings.item == 'coupon')\r\n\t{\r\n\t\tremove_payment_coupon();\r\n\t}\r\n\r\n\tif (settings.item == 'giftcard')\r\n\t{\r\n\t\tremove_payment(settings);\r\n\t}\r\n\r\n\tif (settings.item == 'giftcard_purchase')\r\n\t{\r\n\t\tremove_gift_card_purchase(settings);\r\n\t}\r\n\r\n\tif (settings.item == 'creditcard')\r\n\t{\r\n\t\tremove_payment(settings);\r\n\t}\r\n\r\n\tif (settings.item == 'dinner_dollars')\r\n\t{\r\n\t\tremove_dinner_dollars(settings);\r\n\t}\r\n\r\n\tif (settings.item == 'cc_ref')\r\n\t{\r\n\t\tremove_credit_card_reference(settings);\r\n\t}\r\n\r\n\r\n\tcan_checkout();\r\n}\r\n\r\nfunction remove_food()\r\n{\r\n\tvar runAsGuest = \"false\";\r\n\r\n\tif (allowGuest)\r\n\t{\r\n\t\trunAsGuest = \"true\";\r\n\t}\r\n\r\n\tcreate_and_submit_form({\r\n\t\taction: 'main.php?page=checkout',\r\n\t\tinput: ({\r\n\t\t\tremove: \"food\",\r\n\t\t\trun_as_guest: runAsGuest\r\n\r\n\t\t})\r\n\t});\r\n}\r\n\r\nfunction rewardsCreditClick(obj)\r\n{\r\n\tif (obj.checked)\r\n\t{\r\n\t\tadd_all_store_credit();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar settings = {\r\n\t\t\titem: \"credits\"\r\n\t\t};\r\n\r\n\t\tremoveAllStoreCredit(settings);\r\n\t}\r\n\r\n\tcan_checkout();\r\n}\r\n\r\nfunction remove_gift_card_purchase(settings)\r\n{\r\n\tvar runAsGuest = \"false\";\r\n\r\n\tif (allowGuest)\r\n\t{\r\n\t\trunAsGuest = \"true\";\r\n\t}\r\n\r\n\tcreate_and_submit_form({\r\n\t\taction: 'main.php?page=checkout_gift_card',\r\n\t\tinput: ({\r\n\t\t\tremove: \"gift_card_purchase\",\r\n\t\t\tgcoid: settings.item_number,\r\n\t\t\trun_as_guest: runAsGuest\r\n\t\t})\r\n\t});\r\n}\r\n\r\n\r\nfunction remove_dinner_dollars()\r\n{\r\n\r\n\t$('#plate_points_discount').val(formatAsMoney(0));\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_modify_plate_points_credits',\r\n\t\t\top: 'modify',\r\n\t\t\tnew_credit_value: 0\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\r\n\t\t\t\t// update subtotal\r\n\t\t\t\t$('#sum_checkout_total-subtotal').html(formatAsMoney(json.orderInfo.grand_total));\r\n\r\n\t\t\t\t$('#checkout_total-tax').html(formatAsMoney(json.orderInfo.subtotal_all_taxes));\r\n\r\n\t\t\t\t$('#row-discount_plate_points').hideFlex();\r\n\r\n\t\t\t\t// update coupon total\r\n\t\t\t\t$('#checkout_total-coupon').html(formatAsMoney(json.orderInfo.coupon_code_discount_total));\r\n\r\n\t\t\t\tavgCostPerServingEntreeCost -= json.orderInfo.coupon_code_discount_total;\r\n\r\n\t\t\t\t$(\"#checkout_total-points_discount_total\").html(formatAsMoney(json.orderInfo.points_discount_total));\r\n\t\t\t\t$(\"#checkout_total-membership_discount\").html(formatAsMoney(json.orderInfo.membership_discount));\r\n\r\n\t\t\t\t// calculate the balance\r\n\t\t\t\tcan_checkout();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n\r\nfunction remove_payment_coupon()\r\n{\r\n\r\n\tvar service_fee = Number($('#checkout_total-service_fee').html());\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_remove_payment',\r\n\t\t\tpayment_type: 'coupon',\r\n\t\t\tpage: 'checkout'\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t// restore coupon input\r\n\t\t\t\t$('#add_coupon_code').prop('disabled', false);\r\n\t\t\t\t$('#add_coupon_add').prop('disabled', false);\r\n\t\t\t\t$('#checkout_total-tax').html(json.orderInfo.subtotal_all_taxes);\r\n\r\n\t\t\t\t// update coupon total\r\n\t\t\t\t$('#checkout_title-coupon_code').html('');\r\n\r\n\t\t\t\tif( json.is_edit_order !== 'undefined' && json.is_edit_order == true ) {\r\n\t\t\t\t\tlocation.reload();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar couponAmount = Number($('#checkout_total-coupon').html());\r\n\r\n\t\t\t\tavgCostPerServingEntreeCost += couponAmount;\r\n\r\n\t\t\t\t// update coupon total\r\n\t\t\t\t$('#checkout_total-coupon').html('0.00');\r\n\r\n\t\t\t\t// hide coupon row\r\n\t\t\t\t$('#row-coupon').slideUp();\r\n\r\n\t\t\t\tvar couponCodeVal = $('#add_coupon_code').val().toUpperCase();\r\n\r\n\t\t\t\tif (coupon.limit_to_mfy_fee == '1')\r\n\t\t\t\t{\r\n\t\t\t\t\tmaxPPDeduction += service_fee;\r\n\t\t\t\t\teditSavePlatePointsCredits(true);\r\n\r\n\t\t\t\t\tif (maxPPCredit > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(\"#edit_plate_points\").attr(\"disabled\", false);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcoupon = false;\r\n\r\n\t\t\t\t// can we checkout?\r\n\t\t\t\tcan_checkout();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction update_special_instructions()\r\n{\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_item_processor',\r\n\t\t\top: 'store_inst',\r\n\t\t\tspecial_inst: $('#special_insts').val()\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t// nothing to do\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction update_bag_opt_out()\r\n{\r\n\r\n\tlet opt_out = 0;\r\n\tif (supports_bag_fee)\r\n\t{\r\n\t\tif ($(\"#opted_to_bring_bags\").is(\":checked\"))\r\n\t\t{\r\n\t\t\topt_out = 1;\r\n\t\t}\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_bag_fee',\r\n\t\t\top: 'set_opt_out',\r\n\t\t\topt_out: opt_out,\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t// update subtotal\r\n\t\t\t\t$('#sum_checkout_total-subtotal').html(formatAsMoney(json.orderInfo.grand_total));\r\n\t\t\t\t$('#checkout_total-tax').html(formatAsMoney(json.orderInfo.subtotal_all_taxes));\r\n\r\n\t\t\t\tif ($(\"#opted_to_bring_bags\").is(\":checked\"))\r\n\t\t\t\t{\r\n\t\t\t\t\t$(\"#checkout_total-bag_fee_info\").html(\"(You will provide bags)\");\r\n\t\t\t\t\t$(\"#checkout_total-bag_fee\").html(formatAsMoney(0));\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tbag_fee = default_bag_fee * number_bags_required;\r\n\t\t\t\t\tlet bagLabel = number_bags_required > 1 ? ' bags' :' bag';\r\n\t\t\t\t\tlet cbagLabel = number_bags_required > 1 ? ' Bags' :' Bag';\r\n\r\n\t\t\t\t\t$(\"#checkout_total-bag_fee_info\").html('(' +number_bags_required +bagLabel+\" * $\" + formatAsMoney(default_bag_fee) + ')');\r\n\t\t\t\t\t$(\"#checkout_total-bag_fee\").html(formatAsMoney(bag_fee));\r\n\t\t\t\t\t$(\"#bag_text\").html(number_bags_required + cbagLabel);\r\n\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// calculate the balance\r\n\t\t\t\tcan_checkout();\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\nfunction add_payment_coupon()\r\n{\r\n\tvar add_coupon_code = $('#add_coupon_code').val().toUpperCase();\r\n\tvar service_fee = Number($('#checkout_total-service_fee').html());\r\n\r\n\tif (!add_coupon_code)\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'Please enter a promo code.'\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'cart_add_payment',\r\n\t\t\t\tpayment_type: 'coupon',\r\n\t\t\t\tpage: 'checkout',\r\n\t\t\t\tcoupon_code: add_coupon_code,\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\tcoupon = json.coupon;\r\n\r\n\t\t\t\t\t// disable input form\r\n\t\t\t\t\t$('#add_coupon_code').prop('disabled', true);\r\n\t\t\t\t\t$('#add_coupon_add').prop('disabled', true);\r\n\r\n\t\t\t\t\t// update subtotal\r\n\t\t\t\t\t$('#sum_checkout_total-subtotal').html(json.orderInfo.grand_total);\r\n\r\n\t\t\t\t\tif(typeof json.edit_order_diff !== 'undefined'){\r\n\t\t\t\t\t\t$('#cc_amount_diff').html(json.balance);\r\n\t\t\t\t\t\t$('#original_order_total').html(json.originalOrderInfo.grand_total);\r\n\t\t\t\t\t\t$('.edit-order-field').removeClass( \"collapse\" );\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t$('#checkout_total-tax').html(json.orderInfo.subtotal_all_taxes);\r\n\r\n\t\t\t\t\t// update coupon total\r\n\t\t\t\t\t$('#checkout_title-coupon_code').html(json.coupon_title);\r\n\r\n\t\t\t\t\t// update coupon total\r\n\t\t\t\t\t$('#checkout_total-coupon').html(formatAsMoney(json.orderInfo.coupon_code_discount_total));\r\n\r\n\t\t\t\t\tavgCostPerServingEntreeCost -= json.orderInfo.coupon_code_discount_total;\r\n\r\n\t\t\t\t\t// show coupon row\r\n\t\t\t\t\t$('#row-coupon').showFlex();\r\n\r\n\t\t\t\t\tif (coupon.limit_to_mfy_fee == '1' && maxPPDeduction > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar dd_val = $('#plate_points_discount').val();\r\n\t\t\t\t\t\tif (maxPPDeduction >= service_fee && maxPPDeduction - dd_val < service_fee)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\tmessage: 'The Service fee is already discounted by using Dinner Dollars. If you wish to use this coupon please lower the amount of Dinner Dollars applied.'\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tremove_payment_coupon();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar service_fee = Number($('#checkout_total-service_fee').html());\r\n\r\n\t\t\t\t\t\t\tmaxPPDeduction = maxPPDeduction - service_fee.valueOf();\r\n\t\t\t\t\t\t\tif (maxPPDeduction < 0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tmaxPPDeduction = 0;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tmaxPPDeduction = formatAsMoney(maxPPDeduction);\r\n\t\t\t\t\t\t\teditSavePlatePointsCredits(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// calculate the balance\r\n\t\t\t\t\tcan_checkout();\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction calculateMaxNewGiftCardPayment(newPaymentNumber)\r\n{\r\n\tvar grandtotal = Number($('#sum_checkout_total-subtotal').html());\r\n\tvar existingPaymentTotal = 0;\r\n\r\n\t$('[id^=\"row-giftcard-\"]').each(function () {\r\n\r\n\t\tvar PaymentNumber = $(this).data(\"gc_number\");\r\n\t\tvar PaymentAmount = $(this).data(\"gc_amount\");\r\n\r\n\t\tif (PaymentNumber != newPaymentNumber)\r\n\t\t{\r\n\t\t\texistingPaymentTotal += (Number(formatAsMoney(PaymentAmount)));\r\n\t\t}\r\n\t});\r\n\r\n\tif ($('#checkout_total_payment-credits').length)\r\n\t{\r\n\t\texistingPaymentTotal += (Number($('#checkout_total_payment-credits').html()).valueOf());\r\n\t}\r\n\r\n\tvar maxNewPayment = grandtotal.valueOf() - existingPaymentTotal;\r\n\r\n\treturn maxNewPayment;\r\n\r\n}\r\n\r\nfunction get_gift_card_balance()\r\n{\r\n\tvar gc_number = $('#debit_gift_card_number').val();\r\n\tgc_number = gc_number.trim();\r\n\r\n\tif (!gc_number)\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'Please enter a gift card number.'\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'GET',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'giftCardBalance',\r\n\t\t\t\tcard_number: gc_number,\r\n\t\t\t\toutput: 'json'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Gift Card Balance',\r\n\t\t\t\t\t\tmessage: \"Balance for card number <b>\" + json.card_number + \"</b> is <b>\" + json.card_balance + \"</b>\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Gift Card Balance Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction getGiftCardNumberAndAmount()\r\n{\r\n\tvar gc_number = $('#debit_gift_card_number').val();\r\n\tvar new_amount = $('#debit_gift_card_amount').val();\r\n\r\n\tvar returnData =\r\n\t\t{\r\n\t\t\tdataValid: true,\r\n\t\t\tgc_number: gc_number,\r\n\t\t\tgc_amount: new_amount,\r\n\t\t\tis_update: true\r\n\t\t};\r\n\r\n\tvar didHandleDuplicate = false;\r\n\r\n\t// check if this card number was added already\r\n\t// Note: this is not adequate for handling rapid clicking\r\n\t// Additional checks are done in do_add_gift_card\r\n\t$('#giftcard_container').find('[data-gc_number=\"' + gc_number + '\"]').each(function () {\r\n\r\n\t\tdidHandleDuplicate = true;\r\n\t\treturnData.replacementObj = this;\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Attention',\r\n\t\t\tmessage: 'You have already entered this gift card number. If you proceed the current amount will be replaced by the amount you are now submitting.',\r\n\t\t\tmodal: true,\r\n\t\t\tconfirm: function () {\r\n\t\t\t\tdo_add_gift_card(returnData);\r\n\t\t\t},\r\n\t\t\tcancel: function () {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\tif (!didHandleDuplicate)\r\n\t{\r\n\t\tdo_add_gift_card(returnData);\r\n\t}\r\n}\r\n\r\nfunction do_add_gift_card(transaction_data)\r\n{\r\n\r\n\tvar is_processing = $('#debit_gift_card_number').data('processing');\r\n\r\n\tif (!transaction_data || is_processing)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\tif(transaction_data.gc_number){\r\n\t\ttransaction_data.gc_number = transaction_data.gc_number.trim();\r\n\t}\r\n\r\n\tif (!transaction_data.gc_number)\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'Please enter a gift card number.'\r\n\t\t});\r\n\t}\r\n\telse if (!transaction_data.gc_amount)\r\n\t{\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Error',\r\n\t\t\tmessage: 'Please enter a gift card amount.'\r\n\t\t});\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar replacingID = 0;\r\n\r\n\t\tif (transaction_data.replacementObj)\r\n\t\t{\r\n\t\t\treplacingID = transaction_data.replacementObj.id.split(\"-\")[2];\r\n\t\t}\r\n\r\n\t\t$('#debit_gift_card_number').data('processing', true);\r\n\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'GET',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'giftCardBalance',\r\n\t\t\t\tcard_number: transaction_data.gc_number,\r\n\t\t\t\toutput: 'json'\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\tif (json.card_balance == \"Invalid Card\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Gift Card Error',\r\n\t\t\t\t\t\t\tmessage: 'The card number is invalid.'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ((json.card_balance * 1) < (transaction_data.gc_amount * 1))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\ttitle: 'Gift Card Error',\r\n\t\t\t\t\t\t\tmessage: 'There are not enough funds on the gift card for this amount. Available balance: ' + json.card_balance\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar maxNewPayment = calculateMaxNewGiftCardPayment(transaction_data.gc_number);\r\n\t\t\t\t\t\tif (transaction_data.gc_amount > maxNewPayment)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttransaction_data.gc_amount = maxNewPayment.toString();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\t\ttimeout: 20000,\r\n\t\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tprocessor: 'cart_add_payment',\r\n\t\t\t\t\t\t\t\tpayment_type: 'gift_card',\r\n\t\t\t\t\t\t\t\tcard_number: transaction_data.gc_number,\r\n\t\t\t\t\t\t\t\tamount: transaction_data.gc_amount,\r\n\t\t\t\t\t\t\t\tc_total: $('#sum_checkout_total-subtotal').html(),\r\n\t\t\t\t\t\t\t\tcurrent_subtotal: $('#sum_checkout_total-subtotal').html(),\r\n\t\t\t\t\t\t\t\toriginal_order_total: $('#original_order_total').html(),\r\n\t\t\t\t\t\t\t\tpayment_id: replacingID,\r\n\t\t\t\t\t\t\t\toutput: 'json'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t//var payment_id = json.payment_id;\r\n\t\t\t\t\t\t\t\t\tif (transaction_data.replacementObj)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$(transaction_data.replacementObj).remove();\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t$('#debit_gift_card_number').val('');\r\n\t\t\t\t\t\t\t\t\t$('#debit_gift_card_amount').val('');\r\n\r\n\t\t\t\t\t\t\t\t\t$('#giftcard_container').append(json.html);\r\n\r\n\t\t\t\t\t\t\t\t\t// show coupon row\r\n\t\t\t\t\t\t\t\t\t$('#giftcard_container').slideDown();\r\n\r\n\t\t\t\t\t\t\t\t\tif(typeof json.edit_order_html !== 'undefined' && json.edit_order_html != null){\r\n\t\t\t\t\t\t\t\t\t\t//location.reload();\r\n\t\t\t\t\t\t\t\t\t\t$('#edit-order-total-container').replaceWith(json.edit_order_html);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t// calculate the balance\r\n\t\t\t\t\t\t\t\t\tcan_checkout();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Gift Card Error',\r\n\t\t\t\t\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$('#debit_gift_card_number').data('processing', false);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#debit_gift_card_number').data('processing', false);\r\n\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Gift Card Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\r\n\t\t\t\t$('#debit_gift_card_number').data('processing', false);\r\n\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction add_payment_gift_card()\r\n{\r\n\tgetGiftCardNumberAndAmount();\r\n}\r\n\r\nfunction getDomObjectToRemove(settings)\r\n{\r\n\tvar obj = null;\r\n\tif (settings.item == \"giftcard\")\r\n\t{\r\n\t\tobj = $('#row-giftcard-' + settings.item_number).get();\r\n\r\n\t\treturn obj;\r\n\t}\r\n\tif (settings.item == \"creditcard\")\r\n\t{\r\n\t\tobj = $('#row-creditcard-' + settings.item_number).get();\r\n\r\n\t\treturn obj;\r\n\t}\r\n\tif (settings.item == \"credits\")\r\n\t{\r\n\t\tobj = $('#row-credits').get();\r\n\r\n\t\treturn obj;\r\n\t}\r\n\tif (settings.item == \"cc_ref\")\r\n\t{\r\n\t\tobj = $('#row-cc_ref-' + settings.item_number).get();\r\n\t\treturn obj;\r\n\t}\r\n\r\n\treturn null;\r\n}\r\n\r\nfunction add_all_store_credit()\r\n{\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_add_payment',\r\n\t\t\tpayment_type: 'all_store_credit',\r\n\t\t\tstore_id: store_id_of_order,\r\n\t\t\toutput: 'json'\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$('#row-credits').html(json.html);\r\n\t\t\t\t$('#row-credits').slideDown();\r\n\r\n\t\t\t\t// calculate the balance\r\n\t\t\t\tcan_checkout();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Gift Card Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction removeAllStoreCredit(settings)\r\n{\r\n\tvar domObjectToRemove = getDomObjectToRemove(settings);\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_remove_payment',\r\n\t\t\tpayment_type: 'store_credit',\r\n\t\t\tpayment_number: 'all'\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$(domObjectToRemove).slideUp();\r\n\t\t\t\t$(domObjectToRemove).empty();\r\n\t\t\t\t$('#SC-total').prop(\"checked\", false);\r\n\r\n\t\t\t\tcan_checkout();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction remove_payment(settings)\r\n{\r\n\tvar domObjectToRemove = getDomObjectToRemove(settings);\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_remove_payment',\r\n\t\t\tpayment_type: settings.item,\r\n\t\t\tpayment_number: settings.item_number\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tif (settings.item == 'creditcard')\r\n\t\t\t\t{\r\n\t\t\t\t\t$('[id^=\"cc\"]').prop('disabled', false);\r\n\t\t\t\t\t$('#billing_postal_code').prop('disabled', false);\r\n\t\t\t\t\t$('#billing_address').prop('disabled', false);\r\n\t\t\t\t\t$('#addCreditCard').prop('disabled', false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($('#is_delayed_payment1').length)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#is_delayed_payment1').prop('disabled', false);\r\n\t\t\t\t\t$('#is_delayed_payment0').prop('disabled', false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(domObjectToRemove).slideUp();\r\n\r\n\t\t\t\tif (settings.item == 'creditcard' )\r\n\t\t\t\t{\r\n\t\t\t\t\t$(domObjectToRemove).remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.item == 'giftcard')\r\n\t\t\t\t{\r\n\t\t\t\t\tlocation.reload();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcan_checkout();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction handleNewCardFormShown()\r\n{\r\n\t$('[id^=\"cc_pay_id\"]').prop({'disabled': true, 'checked' : false, 'required': false});\r\n\t$('[id^=\"gc_pay_id\"]').prop({'disabled': true, 'checked' : false, 'required': false});\r\n\r\n\r\n\trequireCreditCardFields();\r\n}\r\n\r\nfunction handleNewCardFormHidden()\r\n{\r\n\t$('[id^=\"cc_pay_id\"]').prop({'disabled': false, 'required': true}).parents('form:first').removeClass('was-validated').find('.form-feedback').hide();\r\n\t$('[id^=\"gc_pay_id\"]').prop({'disabled': false, 'required': true}).parents('form:first').removeClass('was-validated').find('.form-feedback').hide();\r\n\r\n\r\n\tdoNotRequireCreditCardFields();\r\n}\r\n\r\nfunction handleOrderCustomizations(form){\r\n\ttry\r\n\t{\r\n\t\tif (form.attr('id') == 'to_payment_or_checkout_form')\r\n\t\t{\r\n\t\t\tlet requiredOptionSelected = false;\r\n\t\t\tif ($('#apply-customization').is(':checked'))\r\n\t\t\t{\r\n\t\t\t\t$('[data-user_pref_meal][type=checkbox]').each(function () {\r\n\t\t\t\t\tif ($(this).is(':checked'))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trequiredOptionSelected = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (!requiredOptionSelected)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Missing Customization Options',\r\n\t\t\t\t\t\tmessage: \"At least one meal customization option is required if 'Customize this order' is checked.\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$('#to_payment').removeClass('btn-spinning');\r\n\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t$('#to_payment').removeClass('disabled');\r\n\t\t\t\t\t}, 2000);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcatch(error)\r\n\t{\r\n\t\t//not worth failing over\r\n\t\tconsole.log('Issue checking if meal customizations are selected')\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction handleCardRefChange()\r\n{\r\n\tvar selectedRef = false;\r\n\t$('[id^=\"cc_pay_id\"]').each( function() {\r\n\t\tif ($(this).is(':checked')) {\r\n\t\t\tselectedRef = $(this).val();\r\n\t\t}\r\n\t});\r\n\r\n\t$('[id^=\"gc_pay_id\"]').each( function() {\r\n\t\tif ($(this).is(':checked')) {\r\n\t\t\tselectedRef = $(this).val();\r\n\t\t}\r\n\t});\r\n\r\n\tif (selectedRef)\r\n\t{\r\n\t\tdoNotRequireCreditCardFields();\r\n\t}\r\n\r\n}\r\n\r\nfunction requireCreditCardFields()\r\n{\r\n\t$('#ccNameOnCard, #ccType, #ccNumber, #ccMonth, #ccYear, #ccSecurityCode, #billing_address, #billing_postal_code, #billing_city').prop('required', true);\r\n}\r\n\r\nfunction doNotRequireCreditCardFields()\r\n{\r\n\t$('#ccNameOnCard, #ccType, #ccNumber, #ccMonth, #ccYear, #ccSecurityCode, #billing_address, #billing_postal_code, #billing_city').prop('required', false);\r\n}\r\n\r\nfunction remove_credit_card_reference(settings)\r\n{\r\n\tvar domObjectToRemove = getDomObjectToRemove(settings);\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_remove_payment',\r\n\t\t\tpayment_type: 'cc_ref',\r\n\t\t\tcc_ref_id: settings.item_number\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tvar numRefs = $(domObjectToRemove).data('num_cc_refs');\r\n\t\t\t\t$(domObjectToRemove).slideUp();\r\n\t\t\t\t$(domObjectToRemove).remove();\r\n\r\n\t\t\t\tif (numRefs > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('[id^=\"row-cc_ref\"]').data('num_cc_refs', numRefs - 1);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// select add new card and expose - no refs left\r\n\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcan_checkout();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction add_payment_credit_card()\r\n{\r\n\tvar elementsToCheck = $('[id^=\"cc\"]').get();\r\n\r\n\tif (!_check_elements(elementsToCheck))\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\r\n\t$('#addCreditCard').prop('disabled', true);\r\n\r\n\tvar doDelayedPayment = false;\r\n\r\n\tif ($('#is_delayed_payment1').length)\r\n\t{\r\n\t\tif ($('#is_delayed_payment1').attr('checked'))\r\n\t\t{\r\n\t\t\tdoDelayedPayment = true;\r\n\t\t}\r\n\t}\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_add_payment',\r\n\t\t\tpayment_type: 'credit_card',\r\n\t\t\tcard_number: $('#ccNumber').val(),\r\n\t\t\tname_on_card: $('#ccNameOnCard').val(),\r\n\t\t\texp_month: $('#ccMonth').val(),\r\n\t\t\texp_year: $('#ccYear').val(),\r\n\t\t\tsecurity_code: $('#ccSecurityCode').val(),\r\n\t\t\tcard_type: $('#ccType').val(),\r\n\t\t\tbilling_zip: $('#billing_postal_code').val(),\r\n\t\t\tbilling_addr: $('#billing_address').val(),\r\n\t\t\tdo_delayed_payment: doDelayedPayment,\r\n\t\t\toutput: 'json'\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\t$('[id^=\"cc\"]').prop('disabled', true);\r\n\t\t\t\t$('#billing_postal_code').prop('disabled', true);\r\n\t\t\t\t$('#billing_address').prop('disabled', true);\r\n\t\t\t\t$('#addCreditCard').prop('disabled', true);\r\n\r\n\t\t\t\tif ($('#is_delayed_payment1').length)\r\n\t\t\t\t{\r\n\t\t\t\t\t$('#is_delayed_payment1').prop('disabled', true);\r\n\t\t\t\t\t$('#is_delayed_payment0').prop('disabled', true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('#creditcard_container').append(json.html);\r\n\t\t\t\t$('#creditcard_container').slideDown();\r\n\r\n\t\t\t\t// calculate the balance\r\n\t\t\t\tcan_checkout();\r\n\r\n\t\t\t\tif (cart_subtotal == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Alert',\r\n\t\t\t\t\t\tmessage: 'You have added all required payments, you may now submit your order.'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Credit Card Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t\t$('#addCreditCard').prop('disabled', false);\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\r\n\t\t\t$('#addCreditCard').prop('disabled', false);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n$(function () {\r\n\r\n\tif( $('#apply-customization').length && default_meal_customization_to_selected == true)\r\n\t{\r\n\t\t$('#apply-customization').click();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tinitMealCustomizationFields();\r\n\t}\r\n\r\n\r\n\r\n\t$(\"form\").submit( function(e) {\r\n\r\n\t\tlet canContinue = handleOrderCustomizations($(this));\r\n\t\tif ($(this).data('was_submitted') === true || !canContinue)\r\n\t\t{\r\n\t\t\t// Previously submitted - don't submit again\r\n\t\t\te.preventDefault();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(this).data('was_submitted', true);\r\n\t\t}\r\n\t});\r\n\r\n\t$(document).on('click', '.help-cvv', function (e) {\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Help',\r\n\t\t\tmessage: 'The security code is a 3 digit number located on the back of MasterCard, Visa, Discover. On American Express cards, the security code is a group of 4 digits printed on the front.'\r\n\t\t})\r\n\t});\r\n\r\n\t$(document).on('change', '#ccType', function (e) {\r\n\r\n\t\tif ($(this).val() == 'American Express')\r\n\t\t{\r\n\t\t\t$('#ccSecurityCode').prop({'min': '0', 'max': '9999', 'maxlength': '4', 'pattern': '^[0-9]{4}$'});\r\n\t\t}\r\n\t\telse if ($(this).val() != '' && $(this).val() != null)\r\n\t\t{\r\n\t\t\t$('#ccSecurityCode').prop({'min': '0', 'max': '999', 'maxlength': '3', 'pattern': '^[0-9]{3}$'});\r\n\t\t}\r\n\t});\r\n\r\n\tif (USER_PREFERENCES && $('#ccNumber').length)\r\n\t{\r\n\t\t$('#ccNumber').validateCreditCard(function (result) {\r\n\r\n\t\t\t\tvar validatorType = false;\r\n\t\t\t\tif (result.card_type != null && result.card_type.name != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tvalidatorType = result.card_type.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (($('#ccType').val() == '' || $('#ccType').val() == null) && validatorType)\r\n\t\t\t\t{\r\n\t\t\t\t\tswitch (validatorType)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase 'visa':\r\n\t\t\t\t\t\t\t$('#ccType').val('Visa');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'mastercard':\r\n\t\t\t\t\t\t\t$('#ccType').val('Mastercard');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'amex':\r\n\t\t\t\t\t\t\t$('#ccType').val('American Express');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'discover':\r\n\t\t\t\t\t\t\t$('#ccType').val('Discover');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($('#ccType').val() != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t// get validator type name of current type setting\r\n\t\t\t\t\tvar currentTypeWidgetValue = false;\r\n\t\t\t\t\tswitch ($('#ccType').val())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase 'Visa':\r\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'visa';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'Mastercard':\r\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'mastercard';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'American Express':\r\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'amex';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'Discover':\r\n\t\t\t\t\t\t\tcurrentTypeWidgetValue = 'discover';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (currentTypeWidgetValue && currentTypeWidgetValue != validatorType && $(\"#ccNumber\").val().length > 2)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(\".credit_card_warning\").removeClass('collapse');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(\".credit_card_warning\").addClass('collapse');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\taccept: [\r\n\t\t\t\t\t'visa',\r\n\t\t\t\t\t'mastercard',\r\n\t\t\t\t\t'discover',\r\n\t\t\t\t\t'amex'\r\n\t\t\t\t]\r\n\t\t\t});\r\n\t}\r\n\r\n\t// Register click handler for CC logos\r\n\t$(document).on('click', '[data-credit_card_logo]', function (e) {\r\n\t\t$('#ccType').val($(this).data('credit_card_logo')).trigger('change');\r\n\t});\r\n\r\n\t// Click handler for remove items\r\n\t$(document).on('click', '[id^=\"remove-\"]', function (e) {\r\n\t\t// store the id and some of its parts\r\n\t\tvar remove = {\r\n\t\t\tid: this.id,\r\n\t\t\titem: this.id.split(\"-\")[1],\r\n\t\t\titem_number: this.id.split(\"-\")[2],\r\n\t\t\ttype: 'Payment'\r\n\t\t};\r\n\r\n\t\t// figure out if it has multiples like gift cards\r\n\t\tvar multiple = (remove.item_number != undefined) ? '-' + remove.item_number : '';\r\n\r\n\t\t// get the friendly item description to display in the popup\r\n\t\tremove.title = $('#checkout_title-' + remove.item + multiple).text();\r\n\r\n\t\t// it's payment by default, figure out if it is an item\r\n\t\tif (remove.item == 'nonfood' || remove.item == 'food' || remove.item == 'giftcard_purchase')\r\n\t\t{\r\n\t\t\tremove.type = 'Item';\r\n\t\t}\r\n\r\n\t\t// show removal confirmation\r\n\t\tdd_message({\r\n\t\t\ttitle: 'Remove ' + remove.type,\r\n\t\t\tmessage: 'Are you sure you wish to remove ' + remove.title + '.',\r\n\t\t\tconfirm: function () {\r\n\t\t\t\tremove_item_payment(remove);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t// Watch for change on terms checkbox\r\n\t$(document).on('change', '#customers_terms', function (e) {\r\n\t\tcan_checkout();\r\n\t});\r\n\r\n\t// Coupon add handler\r\n\t$(document).on('click', '#add_coupon_add', function (e) {\r\n\t\tadd_payment_coupon();\r\n\t\te.preventDefault();\r\n\t});\r\n\r\n\t// Coupon add enter key\r\n\t$(document).on('keyup', '#add_coupon_code', function (e) {\r\n\t\tif (e.which == 13)\r\n\t\t{\r\n\t\t\tadd_payment_coupon();\r\n\t\t}\r\n\t});\r\n\r\n\t// credit card\r\n\t$(document).on('click', '#addCreditCard', function (e) {\r\n\t\tadd_payment_credit_card();\r\n\t});\r\n\r\n\t//Gift Card Add handler\r\n\t$(document).on('click', '#giftCardBalance', function (e) {\r\n\t\tget_gift_card_balance();\r\n\t\te.preventDefault();\r\n\t});\r\n\r\n\t// Gift Card Button click\r\n\t$(document).on('click', '#giftCardRedeem', function (e) {\r\n\t\tadd_payment_gift_card();\r\n\t\te.preventDefault();\r\n\t});\r\n\r\n\t$(document).on('change', '#shipping_phone_number', function (e) {\r\n\r\n\t\t$('.shipping_phone_number_new_div').hideFlex();\r\n\t\t$('#shipping_phone_number_new').prop('required', false);\r\n\r\n\t\tif ($(this).val() == 'new')\r\n\t\t{\r\n\t\t\t$('.shipping_phone_number_new_div').showFlex();\r\n\t\t\t$('#shipping_phone_number_new').prop('required', true);\r\n\r\n\t\t}\r\n\t});\r\n\r\n\t$(document).on('change', '#address_book_select', function (e) {\r\n\r\n\t\tlet id = $(this).val();\r\n\t\tlet prev_id = (($('#address_book_update_update').val() == 'update') ? '' : $('#address_book_update_update').val());\r\n\r\n\t\tif (id == '')\r\n\t\t{\r\n\t\t\t$('#address_book_update_update').val('update');\r\n\r\n\t\t\t$('#shipping_firstname').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_lastname').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_address_line1').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_address_line2').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_city').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_state_id').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_address_note').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_phone_number').valCheckDiffRemove('');\r\n\t\t\t$('#shipping_gift_email_address').valCheckDiffRemove('');\r\n\r\n\t\t\t$('#shipping_postal_code').valCheckDiffRemove();\r\n\t\t}\r\n\t\telse if (id)\r\n\t\t{\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: 'ddproc.php',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\ttimeout: 20000,\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tprocessor: 'delivered_box',\r\n\t\t\t\t\top: 'update_address',\r\n\t\t\t\t\tid: id\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function (json) {\r\n\t\t\t\t\tif (json.processor_success)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet addy = JSON.parse(json.address);\r\n\r\n\t\t\t\t\t\tswitch (json.status)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcase 'no_inventory':\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\tmessage: json.processor_message,\r\n\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\"Cancel\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t$('#address_book_select').val(prev_id);\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\"Change Address\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\tcreate_and_submit_form({\r\n\t\t\t\t\t\t\t\t\t\t\t\taction: 'main.php?page=box_select',\r\n\t\t\t\t\t\t\t\t\t\t\t\tinput: ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdelivered_zip: addy.postal_code\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 'not_eligible':\r\n\t\t\t\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\t\t\t\tmessage: 'We are sorry, Dream Dinners does not currently ship to ' + addy.postal_code,\r\n\t\t\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\t\t\t\"Close\": function () {\r\n\t\t\t\t\t\t\t\t\t\t\t$('#address_book_select').val(prev_id);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tif (addy.location_type == 'ADDRESS_BOOK')\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('#address_book_update_update').val(addy.id);\r\n\r\n\t\t\t\t\t\t\t\t\t$('#shipping_firstname').valCheckDiff({value : addy.firstname, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_lastname').valCheckDiff({value : addy.lastname, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line1').valCheckDiff({value : addy.address_line1, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line2').valCheckDiff({value : addy.address_line2, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_city').valCheckDiff({value : addy.city, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_state_id').valCheckDiff({value : addy.state_id, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_address_note').valCheckDiff({value : addy.address_note, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_phone_number').valCheckDiff({value : addy.telephone_1, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t\t$('#shipping_gift_email_address').valCheckDiff({value : addy.email_address, group : 'shipaddy'});\r\n\r\n\t\t\t\t\t\t\t\t\t$('#shipping_postal_code').valCheckDiff({value : addy.postal_code, group : 'shipaddy'});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$('#shipping_firstname').val(addy.firstname);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_lastname').val(addy.lastname);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line1').val(addy.address_line1);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_address_line2').val(addy.address_line2);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_city').val(addy.city);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_state_id').val(addy.state_id);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_address_note').val(addy.address_note);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_phone_number').val(addy.telephone_1);\r\n\t\t\t\t\t\t\t\t\t$('#shipping_gift_email_address').val(addy.email_address);\r\n\r\n\t\t\t\t\t\t\t\t\t$('#shipping_postal_code').val(addy.postal_code);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$(document).on('dd:checkdiff', function (e) {\r\n\r\n\t\tlet diffData = $(document).data().checkdiff;\r\n\r\n\t\tif (Object.keys(diffData['shipaddy']).length === 0)\r\n\t\t{\r\n\t\t\t$('.update_contact_row').hideFlex();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$('.update_contact_row').showFlex();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t$(document).on('shown.bs.collapse', '#add_new_cc', function(e) {\r\n\t\thandleNewCardFormShown();\r\n\t});\r\n\r\n\t$(document).on('hidden.bs.collapse', '#add_new_cc', function(e) {\r\n\t\thandleNewCardFormHidden();\r\n\t});\r\n\r\n\t$(document).on('change', '[id^=\"cc_pay_id\"]', function(e) {\r\n\t\thandleCardRefChange();\r\n\t});\r\n\r\n\t$(document).on('change', '[id^=\"gc_pay_id\"]', function(e) {\r\n\t\thandleCardRefChange();\r\n\t});\r\n\r\n\t$(document).on('click', '.box-change-zip', function (e) {\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\tlet href = $(this).attr('href');\r\n\r\n\t\tdd_message({\r\n\t\t\tmessage : 'Menu item availability and taxes may be different for another delivery area. In order to change the zip code, we need to send you through the order process again.',\r\n\t\t\tbuttons: {\r\n\t\t\t\t\"Change Zip\": function () {\r\n\t\t\t\t\tbounce(href);\r\n\t\t\t\t},\r\n\t\t\t\t\"Cancel\": function () {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t});\r\n\r\n\t// Logged in functions\r\n\tif (USER_PREFERENCES)\r\n\t{\r\n\t\thandle_ltd_round_up();\r\n\t\thandle_checkout_delayed_payment();\r\n\t\thandle_special_instructions();\r\n\t\thandleMealCustomizationAccordion();\r\n\r\n\t\t$(document).on('click', '#apply_plate_points', function (e) {\r\n\t\t\teditSavePlatePointsCredits(false);\r\n\t\t});\r\n\r\n\t\t$(document).on('click', '#apply_all_plate_points', function (e) {\r\n\t\t\teditSaveAllPlatePointsCredits(false);\r\n\t\t});\r\n\r\n\t\t/*\r\n\t\t\t\t$(document).on('keyup', '#plate_points_discount', function (e) {\r\n\t\t\t\t\tif (e.which == 13)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$('#edit_plate_points').trigger('click');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t*/\r\n\t\tif ($(\"#apply_plate_points\").length && maxPPDeduction <= 0)\r\n\t\t{\r\n\t\t\t$(\"#apply_plate_points\").attr(\"disabled\", true);\r\n\t\t\t$(\"#apply_all_plate_points\").attr(\"disabled\", true);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tcan_checkout();\r\n\r\n});\r\n\r\nconst checkbox = document.getElementById('opted_to_bring_bags');\r\nif (checkbox)\r\n{\r\n\tcheckbox.addEventListener('click', function handleClick() {\r\n\t\tif (checkbox.checked)\r\n\t\t{\r\n\t\t\t$(\"#bag_text\").hideFlex();\r\n\t\t\t$(\"#opted_to_bring_bags_hidden\").val(\"1\");\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$(\"#bag_text\").showFlex();\r\n\t\t\t$(\"#opted_to_bring_bags_hidden\").val(\"0\");\r\n\t\t}\r\n\t\tupdate_bag_opt_out();\r\n\t});\r\n}\r\n\r\nfunction handleMealCustomizationAccordion()\r\n{\r\n\t$(\"#customization-header\").click(function (e) {\r\n\t\te.preventDefault();\r\n\r\n\t\t$header = $(this);\r\n\t\t$content = $(\"#customization-row\");\r\n\t\t$header.html(function () {\r\n\t\t\treturn \"Meal Customizations\" + ($content.is(\":visible\") ? \" &#8744;\" : \" &#8743;\");\r\n\t\t});\r\n\t\t$content.slideToggle(500, function () {\r\n\t\t});\r\n\r\n\t});\r\n}\r\n\r\nfunction initMealCustomizationFields()\r\n{\r\n\tif(typeof has_meal_customization_selected === 'undefined'){\r\n\t\thas_meal_customization_selected = false;\r\n\t}\r\n\ttoggleMealCustomizationOptions(has_meal_customization_selected);\r\n}\r\n\r\nfunction toggleMealCustomizationOptions(on){\r\n\tif(on){\r\n\t\t$('[data-user_pref_meal][type=checkbox]').removeAttr(\"disabled\");\r\n\t\t$('.customization-readonly-option').removeClass('text-gray-400')\r\n\t}else{\r\n\t\t$('[data-user_pref_meal][type=checkbox]').attr(\"disabled\", true);\r\n\t\t$('.customization-readonly-option').addClass('text-gray-400')\r\n\t}\r\n}\r\n\r\nfunction toggleMealCustomizationMasterCheckbox(on){\r\n\tif(on){\r\n\t\t$('#apply-customization').prop('checked', true);\r\n\t\t$('#apply-customization').attr('checked', true);\r\n\t\thas_meal_customization_selected = true;\r\n\t}else{\r\n\t\t$('#apply-customization').prop('checked', false);\r\n\t\t$('#apply-customization').attr('checked', true);\r\n\t\thas_meal_customization_selected = false;\r\n\t\thandleMealCustomizationMasterCheckbox(false);\r\n\t}\r\n}\r\n\r\nfunction handleMealCustomizationMasterCheckbox(allow_customization){\r\n\thas_meal_customization_selected = allow_customization;\r\n\ttoggleMealCustomizationOptions(allow_customization);\r\n\r\n\t$.ajax({\r\n\t\turl: 'ddproc.php',\r\n\t\ttype: 'POST',\r\n\t\ttimeout: 20000,\r\n\t\tdataType: 'json',\r\n\t\tdata: {\r\n\t\t\tprocessor: 'cart_order_customization_preference',\r\n\t\t\top: 'set_customization_applies_to_order',\r\n\t\t\tallow_customization: allow_customization,\r\n\t\t\tcustomizations: JSON.stringify(meal_customization_preferences)\r\n\t\t},\r\n\t\tsuccess: function (json) {\r\n\t\t\tif (json.processor_success)\r\n\t\t\t{\r\n\t\t\t\tcustomization = json;\r\n\t\t\t\tif(customization.opted_to_customize_recipes == true){\r\n\t\t\t\t\t$('#customization-fee-row').show();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$('#customization-fee-row').hide();\r\n\t\t\t\t}\r\n\t\t\t\t$('#checkout_total-customization_fee').text(formatAsMoney(customization.cost));\r\n\t\t\t\t$('#sum_checkout_total-subtotal').text(formatAsMoney(customization.orderInfo.grand_total));\r\n\t\t\t\t$('#credit_card_amount').text(formatAsMoney(customization.orderInfo.grand_total));\r\n\t\t\t\t$('#checkout_total-tax').text(formatAsMoney(customization.orderInfo.subtotal_all_taxes));\r\n\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\tdd_message({\r\n\t\t\t\ttitle: 'Error',\r\n\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n$(document).on('click', '#apply-customization', function (e) {\r\n\tlet allow_customization = $(this).prop('checked');\r\n\thandleMealCustomizationMasterCheckbox(allow_customization);\r\n});\r\n\r\n\r\nfunction preferenceChangeListener(pref, setting, user_id, callback){\r\n\r\n\tpref = pref.toUpperCase();\r\n\r\n\tif(!pref.includes('MEAL'))\r\n\t{\r\n\t\tset_user_pref(pref, setting, user_id, callback);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tlet pref_value = USER_PREFERENCES[pref].value;\r\n\r\n\t\tif ($.isPlainObject(pref_value) && $.isPlainObject(setting))\r\n\t\t{\r\n\t\t\tsetting = JSON.stringify($.extend(USER_PREFERENCES[pref].value, setting));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tsetting = setting.toString()\r\n\t\t}\r\n\r\n\t\tmeal_customization_preferences[pref].value = setting;\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: 'ddproc.php',\r\n\t\t\ttype: 'POST',\r\n\t\t\ttimeout: 20000,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\tprocessor: 'cart_order_customization_preference',\r\n\t\t\t\top: 'update_order_meal_customization',\r\n\t\t\t\tcustomizations: JSON.stringify(meal_customization_preferences)\r\n\t\t\t},\r\n\t\t\tsuccess: function (json) {\r\n\t\t\t\tif (json.processor_success)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t\tif(json.opted_to_customize_recipes == true){\r\n\t\t\t\t\t\t$('#customization-fee-row').show();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t$('#customization-fee-row').hide();\r\n\t\t\t\t\t\t//toggleMealCustomizationMasterCheckbox(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$('#checkout_total-customization_fee').text(formatAsMoney(json.cost));\r\n\t\t\t\t\t$('#sum_checkout_total-subtotal').text(formatAsMoney(json.orderInfo.grand_total));\r\n\t\t\t\t\t$('#credit_card_amount').text(formatAsMoney(json.orderInfo.grand_total));\r\n\r\n\t\t\t\t\tif(typeof callback !== 'undefined'){\r\n\t\t\t\t\t\tcallback(json);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tdd_message({\r\n\t\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\t\tmessage: json.processor_message\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (objAJAXRequest, strError) {\r\n\t\t\t\tdd_message({\r\n\t\t\t\t\ttitle: 'Error',\r\n\t\t\t\t\tmessage: 'Unexpected error: ' + strError\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n}"],"names":["cart_subtotal","handle_ltd_round_up","$","document","on","e","this","is","prop","USER_PREFERENCES","LTD_AUTO_ROUND_UP","value","cookie","session_id","dd_message","title","message","modal","noOk","closeOnEscape","open","event","ui","parent","find","hide","rup_dialog","rup_value","val","div_id","confirm","remove","set_user_pref","ltd_round_up_value","index","buttons","Yes","trigger","No","Ask Again Later","round_up_val","text","formatAsMoney","slideDown","slideUp","ajax","url","type","timeout","dataType","data","processor","payment_type","success","json","processor_success","processor_message","error","objAJAXRequest","strError","updateFinancials","attr","handle_checkout_delayed_payment","get_user_pref","user_preferences","lang","en","tc","terms_and_conditions","delayed_payment","Agree","unbind","Decline","click","delayed_payment_decline","handle_special_instructions","strip_tags","submit_gift_card_purchase","field","append","submit","submit_order","create_and_submit_form","action","input","special_insts","customers_terms","handlePlatePointsDiscount","inVal","isNaN","cap","maxPPCredit","maxPPDeduction","editSaveAllPlatePointsCredits","editSavePlatePointsCredits","force","html","op","new_credit_value","orderInfo","grand_total","subtotal_all_taxes","showFlex","hideFlex","coupon_code_discount_total","avgCostPerServingEntreeCost","points_discount_total","membership_discount","can_checkout","run_as_guest","foodCost","bag_fee","length","Number","giftCardCost","each","thisCost","service_fee","delivery_fee","totalTax","prediscountFoodTotal","couponDiscount","volumeDiscount","preferredDiscount","dreamRewardsDiscount","sessionDiscount","pointsDiscount","membershipDiscount","customization_fee","paymentsTotal","credit_card_food_total","round_up_donation","subtotal_round_up","Math","ceil","subtotal_round_up_diff","parseFloat","toFixed","hasEnoughNonCCFunds","isEditOrder","show","cost_per_serving","avgCostPerServingEntreeServings","handleCardRefChange","is_discounts_page","addClass","removeClass","remove_item_payment","settings","item","remove_food","removeAllStoreCredit","remove_payment_coupon","remove_payment","remove_gift_card_purchase","remove_dinner_dollars","remove_credit_card_reference","runAsGuest","allowGuest","rewardsCreditClick","obj","checked","add_all_store_credit","gcoid","item_number","page","is_edit_order","location","reload","couponAmount","couponCodeVal","toUpperCase","coupon","limit_to_mfy_fee","update_special_instructions","special_inst","update_bag_opt_out","let","opt_out","supports_bag_fee","default_bag_fee","number_bags_required","bagLabel","cbagLabel","add_payment_coupon","add_coupon_code","coupon_code","edit_order_diff","balance","originalOrderInfo","coupon_title","dd_val","valueOf","calculateMaxNewGiftCardPayment","newPaymentNumber","grandtotal","existingPaymentTotal","PaymentNumber","PaymentAmount","maxNewPayment","get_gift_card_balance","gc_number","trim","card_number","output","card_balance","getGiftCardNumberAndAmount","new_amount","returnData","dataValid","gc_amount","is_update","didHandleDuplicate","replacementObj","do_add_gift_card","cancel","transaction_data","is_processing","replacingID","id","split","toString","amount","c_total","current_subtotal","original_order_total","payment_id","edit_order_html","replaceWith","add_payment_gift_card","getDomObjectToRemove","get","store_id","store_id_of_order","domObjectToRemove","payment_number","empty","handleNewCardFormShown","disabled","required","requireCreditCardFields","handleNewCardFormHidden","parents","doNotRequireCreditCardFields","handleOrderCustomizations","form","requiredOptionSelected","setTimeout","console","log","selectedRef","cc_ref_id","numRefs","add_payment_credit_card","elementsToCheck","_check_elements","doDelayedPayment","name_on_card","exp_month","exp_year","security_code","card_type","billing_zip","billing_addr","do_delayed_payment","default_meal_customization_to_selected","initMealCustomizationFields","canContinue","preventDefault","min","max","maxlength","pattern","validateCreditCard","result","validatorType","name","currentTypeWidgetValue","accept","multiple","undefined","which","prev_id","valCheckDiffRemove","addy","JSON","parse","address","status","Cancel","Change Address","delivered_zip","postal_code","Close","location_type","valCheckDiff","firstname","group","lastname","address_line1","address_line2","city","state_id","address_note","telephone_1","email_address","diffData","checkdiff","Object","keys","href","Change Zip","bounce","handleMealCustomizationAccordion","checkbox","getElementById","addEventListener","handleClick","$header","$content","slideToggle","has_meal_customization_selected","toggleMealCustomizationOptions","removeAttr","toggleMealCustomizationMasterCheckbox","handleMealCustomizationMasterCheckbox","allow_customization","customizations","stringify","meal_customization_preferences","customization","opted_to_customize_recipes","cost","preferenceChangeListener","pref","setting","user_id","callback","includes","pref_value","isPlainObject","extend"],"mappings":"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"}
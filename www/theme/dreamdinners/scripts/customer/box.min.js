let BOX_PROCESSING=false;let BOX_QUEUE=[];function inventoryCheck(e,o){let t;let i=0;let n=0;if(box_info.custom_box.items[e]!=undefined){n=box_info.custom_box.items[e]}if(o=="add"){i=n+1;t=parseInt(menuItemInfo.mid[e].remaining_servings)-parseInt(menuItemInfo.mid[e].servings_per_item*i)}else{i=n-1;t=parseInt(menuItemInfo.mid[e].remaining_servings)+parseInt(menuItemInfo.mid[e].servings_per_item*i)}if(t<0){return false}else{return t}}function incrementBox(e,o){if(o==="add"){if(box_info.custom_box.info.number_items==box_info.number_items_required&&box_info.custom_box.info.number_servings==box_info.number_servings_required){dd_message({message:"The box is full, you may now add the box to your cart.",buttons:{"Add Box":function(){$(".box-add").trigger("click")},"Not Yet":function(){}}});return false}if(typeof box_info.custom_box.items[e]==="undefined"){box_info.custom_box.items[e]=1}else{box_info.custom_box.items[e]+=1}}else{if(typeof box_info.custom_box.items[e]==="undefined"){box_info.custom_box.items[e]=0}else{box_info.custom_box.items[e]-=1}if(box_info.custom_box.items[e]<=0){delete box_info.custom_box.items[e]}}recalculateBox();return true}function recalculateBox(){if(typeof box_info!=="undefined"){if(box_info.box_type=="DELIVERED_FIXED"){$(".progress-box").addClass("box-add").removeClass("progress-bar-striped disabled");$(".progress-box").css({width:"100%"}).attr("aria-valuenow",100).text("Add box to cart");$(".box-add").removeClass("disabled")}else if(box_info.box_type=="DELIVERED_CUSTOM"){let s=0;let d=0;let e=[];$(".box-add").addClass("disabled");$('.box-item-update[data-box_update_action="add"]').removeClass("disabled").find(".title").text("Add item");if(box_info.custom_box.items){let e=box_info.custom_box.items;$.each(e,function(e,o){s+=o;d+=parseInt(menuItemInfo.mid[e].servings_per_item)*o;let t=parseInt(menuItemInfo.mid[e].servings_per_item)*o;let i=parseInt(menuItemInfo.mid[e].remaining_servings)-t;let n=$('.box-item-update[data-box_update_action="add"][data-menu_item_id="'+e+'"]');if(o>=2||i<menuItemInfo.mid[e].servings_per_item){n.addClass("disabled");if(o>=2){n.find(".title").text("Max allowed")}else{n.find(".title").text("Sold out")}}})}box_info.custom_box.info={number_items:s,number_servings:d};let o=box_info.custom_box.info.number_items/box_info.number_items_required*100;let t=o>=100?"Add box to cart":o<=0?"":Math.round(o)+"%";if(o>=100){$(".progress-box").addClass("box-add").removeClass("progress-bar-striped disabled");$(".cart-button").removeClass("fa-box-open").addClass("fa-box");$(".box-add").removeClass("disabled")}else{$(".progress-box").addClass("progress-bar-striped").removeClass("box-add disabled");$(".cart-button").removeClass("fa-box").addClass("fa-box-open")}$(".progress-box").css({width:o+"%"}).attr("aria-valuenow",o).text(t);if(box_info.custom_box.info.number_items==box_info.number_items_required&&box_info.custom_box.info.number_servings==box_info.number_servings_required){$(".box-add").removeClass("disabled")}}}return true}$(function(){recalculateBox();$(document).on("click","[data-select_delivery_day]:not(.disabled)",function(e){e.preventDefault();let o=this.getAttribute("data-select_delivery_day");create_and_submit_form({input:{sid:o}})});$(document).on("click","[data-view_box]:not(.disabled)",function(e){e.preventDefault();let o=this.getAttribute("data-view_box");let t=this.getAttribute("data-view_bundle");create_and_submit_form({action:"main.php?page=box_menu",input:{view_box:o,view_bundle:t}})});$(document).on("click",".box-item-update:not(.disabled)",function(e){e.preventDefault();if(BOX_PROCESSING&&box_info.box_instance_id==0){BOX_QUEUE.push($(this));return false}let o=$(this).data("menu_item_id");let t=$(this).data("box_update_action");if(inventoryCheck(o,t)!==false){if(incrementBox(o,t)){BOX_PROCESSING=true;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"update",menu_item_id:o,box_id:box_info.box_id,box_instance_id:box_info.box_instance_id,bundle_id:box_info.box_bundle_id,qty:box_info.custom_box.items[o]},success:function(e){if(e.processor_success){box_info.box_instance_id=e.cart_box_instance_id;BOX_PROCESSING=false;if(BOX_QUEUE.length!=0){$.each(BOX_QUEUE,function(e,o){$(o).trigger("click");delete BOX_QUEUE[e]})}if($('[data-cart_menu_item="'+o+'"]').length){$('[data-cart_menu_item="'+o+'"]').replaceWith(e.cart_update)}else{$(e.cart_update).appendTo($(".meals-list")).hide().slideDown()}if(!$(".meals-list").html().trim().length){$(".cart-list-div").slideUp("slow",function(){$(".msg_empty_cart").slideDown()})}else{$(".msg_empty_cart").slideUp("slow",function(){$(".cart-list-div").slideDown()})}recalculateBox()}else{}},error:function(e,o){}})}}});$(document).on("click",".box-add:not(.disabled)",function(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"add",box_id:box_info.box_id,bundle_id:box_info.box_bundle_id,box_instance_id:box_info.box_instance_id},success:function(e){if(e.processor_success){bounce("main.php?page=box_select")}else{}},error:function(e,o){}})});$(document).on("click",".box-remove:not(.disabled)",function(e){let t=$(this).data("box_instance_id");$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"remove",box_instance_id:t},success:function(o){if(o.processor_success){let e=$('[data-view_box="'+o.data.box_info.box_id+'"][data-view_bundle="'+o.data.box_info.bundle_id+'"]');if(e.hasClass("disabled")&&o.data.box_info.out_of_stock!="false"){e.removeClass("disabled").text("$"+o.data.box_info.price+" "+o.data.box_info.bundle_name)}$('[data-cart_box_id="'+t+'"]').slideUp(function(e){$(this).remove();$(".cart-total").text(o.data.total_items_price)})}else{}},error:function(e,o){}})});$(document).on("keyup change",".add-coupon-code",function(e){let o=$(this).val();$(".add-coupon-code").val(o)});$(document).on("click",".add-coupon-add:not(.disabled)",function(e){let o=$(this).parent().parent().find(".add-coupon-code").val();if(!o){dd_message({title:"Error",message:"Please enter a promo code."})}else{$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"coupon",coupon_code:o},success:function(e){if(e.processor_success){coupon=e.coupon;$(".add-coupon-code").prop("disabled",true);$(".add-coupon-add").addClass("disabled");$(".coupon-code-title").text(coupon.coupon_code_short_title);$(".coupon-code-total").text(formatAsMoney(coupon.coupon_code_discount_total));$(".coupon-code-row").showFlex()}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,o){dd_message({title:"Error",message:"Unexpected error: "+o})}})}});$(document).on("click",".add-coupon-remove",function(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:"coupon"},success:function(e){if(e.processor_success){$(".add-coupon-code").prop("disabled",false);$(".add-coupon-add").removeClass("disabled");coupon=false;$(".coupon-code-title").text("");$(".coupon-code-total").text(formatAsMoney(0));$(".coupon-code-row").hideFlex()}else{dd_message({title:"Error",message:e.processor_message})}},error:function(e,o){dd_message({title:"Error",message:"Unexpected error: "+o})}})});$(document).on("click","[data-dinner_details]",function(e){e.preventDefault();let o=$(this).data("dinner_details");create_and_submit_form({action:"main.php?page=item&recipe="+o,input:{box_id:box_info.box_id}})})});
//# sourceMappingURL=box.min.js.map
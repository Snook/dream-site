let BOX_PROCESSING=!1,BOX_QUEUE=[];function inventoryCheck(e,o){let t,n=0,i=0;return null!=box_info.custom_box.items[e]&&(i=box_info.custom_box.items[e]),"add"==o?(n=i+1,t=parseInt(menuItemInfo.mid[e].remaining_servings)-parseInt(menuItemInfo.mid[e].servings_per_item*n)):(n=i-1,t=parseInt(menuItemInfo.mid[e].remaining_servings)+parseInt(menuItemInfo.mid[e].servings_per_item*n)),!(t<0)&&t}function incrementBox(e,o){if("add"===o){if(box_info.custom_box.info.number_items==box_info.number_items_required&&box_info.custom_box.info.number_servings==box_info.number_servings_required)return modal_message({message:"The box is full, you may now add the box to your cart.",buttons:{"Add Box":function(){$(".box-add").trigger("click")},"Not Yet":function(){}}}),!1;void 0===box_info.custom_box.items[e]?box_info.custom_box.items[e]=1:box_info.custom_box.items[e]+=1}else void 0===box_info.custom_box.items[e]?box_info.custom_box.items[e]=0:box_info.custom_box.items[e]-=1,box_info.custom_box.items[e]<=0&&delete box_info.custom_box.items[e];return recalculateBox(),!0}function recalculateBox(){if("undefined"!=typeof box_info)if("DELIVERED_FIXED"==box_info.box_type)$(".progress-box").addClass("box-add").removeClass("progress-bar-striped disabled"),$(".progress-box").css({width:"100%"}).attr("aria-valuenow",100).text("Add box to cart"),$(".box-add").removeClass("disabled");else if("DELIVERED_CUSTOM"==box_info.box_type){let e=0,o=0;if($(".box-add").addClass("disabled"),$('.box-item-update[data-box_update_action="add"]').removeClass("disabled").find(".title").text("Add item"),box_info.custom_box.items){let t=box_info.custom_box.items;$.each(t,(function(t,n){e+=n,o+=parseInt(menuItemInfo.mid[t].servings_per_item)*n;let i=parseInt(menuItemInfo.mid[t].servings_per_item)*n,s=parseInt(menuItemInfo.mid[t].remaining_servings)-i,a=$('.box-item-update[data-box_update_action="add"][data-menu_item_id="'+t+'"]');(n>=2||s<menuItemInfo.mid[t].servings_per_item)&&(a.addClass("disabled"),n>=2?a.find(".title").text("Max allowed"):a.find(".title").text("Sold out"))}))}box_info.custom_box.info={number_items:e,number_servings:o};let t=box_info.custom_box.info.number_items/box_info.number_items_required*100,n=t>=100?"Add box to cart":t<=0?"":Math.round(t)+"%";t>=100?($(".progress-box").addClass("box-add").removeClass("progress-bar-striped disabled"),$(".cart-button").removeClass("fa-box-open").addClass("fa-box"),$(".box-add").removeClass("disabled")):($(".progress-box").addClass("progress-bar-striped").removeClass("box-add disabled"),$(".cart-button").removeClass("fa-box").addClass("fa-box-open")),$(".progress-box").css({width:t+"%"}).attr("aria-valuenow",t).text(n),box_info.custom_box.info.number_items==box_info.number_items_required&&box_info.custom_box.info.number_servings==box_info.number_servings_required&&$(".box-add").removeClass("disabled")}return!0}$((function(){recalculateBox(),$(document).on("click","[data-select_delivery_day]:not(.disabled)",(function(e){e.preventDefault();let o=this.getAttribute("data-select_delivery_day");create_and_submit_form({input:{sid:o}})})),$(document).on("click","[data-view_box]:not(.disabled)",(function(e){e.preventDefault();let o=this.getAttribute("data-view_box"),t=this.getAttribute("data-view_bundle");create_and_submit_form({action:"/box-menu",input:{view_box:o,view_bundle:t}})})),$(document).on("click",".box-item-update:not(.disabled)",(function(e){if(e.preventDefault(),BOX_PROCESSING&&0==box_info.box_instance_id)return BOX_QUEUE.push($(this)),!1;let o=$(this).data("menu_item_id"),t=$(this).data("box_update_action");!1!==inventoryCheck(o,t)&&incrementBox(o,t)&&(BOX_PROCESSING=!0,$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"update",menu_item_id:o,box_id:box_info.box_id,box_instance_id:box_info.box_instance_id,bundle_id:box_info.box_bundle_id,qty:box_info.custom_box.items[o]},success:function(e){e.processor_success&&(box_info.box_instance_id=e.cart_box_instance_id,BOX_PROCESSING=!1,0!=BOX_QUEUE.length&&$.each(BOX_QUEUE,(function(e,o){$(o).trigger("click"),delete BOX_QUEUE[e]})),$('[data-cart_menu_item="'+o+'"]').length?$('[data-cart_menu_item="'+o+'"]').replaceWith(e.cart_update):$(e.cart_update).appendTo($(".meals-list")).hide().slideDown(),$(".meals-list").html().trim().length?$(".msg_empty_cart").slideUp("slow",(function(){$(".cart-list-div").slideDown()})):$(".cart-list-div").slideUp("slow",(function(){$(".msg_empty_cart").slideDown()})),recalculateBox())},error:function(e,o){}}))})),$(document).on("click",".box-add:not(.disabled)",(function(e){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"add",box_id:box_info.box_id,bundle_id:box_info.box_bundle_id,box_instance_id:box_info.box_instance_id},success:function(e){e.processor_success&&bounce("/box-select")},error:function(e,o){}})})),$(document).on("click",".box-remove:not(.disabled)",(function(e){let o=$(this).data("box_instance_id");$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"remove",box_instance_id:o},success:function(e){if(e.processor_success){let t=$('[data-view_box="'+e.data.box_info.box_id+'"][data-view_bundle="'+e.data.box_info.bundle_id+'"]');t.hasClass("disabled")&&"false"!=e.data.box_info.out_of_stock&&t.removeClass("disabled").text("$"+e.data.box_info.price+" "+e.data.box_info.bundle_name),$('[data-cart_box_id="'+o+'"]').slideUp((function(o){$(this).remove(),$(".cart-total").text(e.data.total_items_price)}))}},error:function(e,o){}})})),$(document).on("keyup change",".add-coupon-code",(function(e){let o=$(this).val();$(".add-coupon-code").val(o)})),$(document).on("click",".add-coupon-add:not(.disabled)",(function(e){let o=$(this).parent().parent().find(".add-coupon-code").val();o?$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"coupon",coupon_code:o},success:function(e){e.processor_success?(coupon=e.coupon,$(".add-coupon-code").prop("disabled",!0),$(".add-coupon-add").addClass("disabled"),$(".coupon-code-title").text(coupon.coupon_code_short_title),$(".coupon-code-total").text(formatAsMoney(coupon.coupon_code_discount_total)),$(".coupon-code-row").showFlex()):modal_message({title:"Error",message:e.processor_message})},error:function(e,o){modal_message({title:"Error",message:"Unexpected error: "+o})}}):modal_message({title:"Error",message:"Please enter a promo code."})})),$(document).on("click",".add-coupon-remove",(function(e){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:"coupon"},success:function(e){e.processor_success?($(".add-coupon-code").prop("disabled",!1),$(".add-coupon-add").removeClass("disabled"),coupon=!1,$(".coupon-code-title").text(""),$(".coupon-code-total").text(formatAsMoney(0)),$(".coupon-code-row").hideFlex()):modal_message({title:"Error",message:e.processor_message})},error:function(e,o){modal_message({title:"Error",message:"Unexpected error: "+o})}})})),$(document).on("click","[data-dinner_details]",(function(e){e.preventDefault();let o=$(this).data("dinner_details");create_and_submit_form({action:"/item?recipe="+o,input:{box_id:box_info.box_id}})}))}));
//# sourceMappingURL=box.min.js.map
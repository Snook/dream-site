var g_lastSearch="";function handle_browser_location(){getQueryVariable("state")||getQueryVariable("zip")||!$("#zipsearch_zipcode_only").length||address_location((function(e,s){"ok"==e?(latitude=s[0].geometry.location.lat(),longitude=s[0].geometry.location.lng(),addressArray=address_components(s),szZip=addressArray.postal_code.long_name,$("#zipsearch_zipcode_only").val(addressArray.postal_code.long_name),retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},!1)):"error"==e||"no_result"==e?modal_message({message:s}):dd_console_log(s)}))}function address_components(e){return addressArray=[],$.each(e[0].address_components,(function(){addressArray[this.types[0]]=this})),addressArray}function handle_address_search(){return $("#zipsearch_zipcode").getVal()||$("#zipsearch_city").getVal()||$("#zipsearch_state_id").getVal()?!$("#zipsearch_zipcode").getVal()&&($("#zipsearch_city").getVal()&&!$("#zipsearch_state_id").getVal()||!$("#zipsearch_city").getVal()&&$("#zipsearch_state_id").getVal())?(modal_message({message:"City & State required"}),!1):(address_search="",$("#zipsearch_address").getVal()&&(address_search+=$("#zipsearch_address").getVal()),$("#zipsearch_city").getVal()&&(address_search+=", "+$("#zipsearch_city").getVal()),$("#zipsearch_state_id").getVal()&&(address_search+=" "+$("#zipsearch_state_id").getVal()),$("#zipsearch_zipcode").getVal()&&(address_search+=" "+$("#zipsearch_zipcode").getVal()),void address_location({address:address_search},(function(e,s){"ok"==e?(latitude=s[0].geometry.location.lat(),longitude=s[0].geometry.location.lng(),addressArray=address_components(s),void 0===addressArray.postal_code?address_location({latlong:latitude+","+longitude},(function(e,s){"ok"==e?(latitude=s[0].geometry.location.lat(),longitude=s[0].geometry.location.lng(),addressArray=address_components(s),szZip="",void 0!==addressArray.postal_code&&(szZip=addressArray.postal_code.long_name),retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},!0)):"error"==e||"no_results"==e?modal_message({message:s}):dd_console_log(s)})):(szZip=addressArray.postal_code.long_name,retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},!0))):"error"==e||"no_result"==e?($("#store_search_results").empty(),$("#store_search_results").html("<text>No local stores near you.</text>")):dd_console_log(s)}))):(modal_message({message:"Zip code or City & State required"}),!1)}function handle_zipcode_search(){if(address_search="",""==$("#zipsearch_zipcode_only").getVal())return modal_message({message:"Zip code required"}),!1;address_search+=" "+$("#zipsearch_zipcode_only").getVal(),address_location({address:address_search},(function(e,s){"ok"==e?(latitude=s[0].geometry.location.lat(),longitude=s[0].geometry.location.lng(),addressArray=address_components(s),szZip=addressArray.postal_code.long_name,retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},!0),$("#zipsearch_zipcode_errorMessage").addClass("collapse"),$("#zipsearch_zipcode_only").removeClass("border-red")):"error"==e||"no_result"==e?($("#store_search_results").empty(),$("#zipsearch_zipcode_errorMessage").removeClass("collapse"),$("#zipsearch_zipcode_only").addClass("border-red"),$("#zipsearch_search_btn").removeClass("btn-spinner"),$("#zipsearch_search_btn").removeClass("btn-spinning"),$("#zipsearch_search_btn").addClass("btn-spinner")):dd_console_log(s)}))}function retrieve_stores_for_address(e){e.address||dd_console_log("retrieve_stores_for_address() requires settings.address"),$.extend({address:!1,compact:!1},e),address_location(e,(function(s,t){if("ok"==s){let s="";for(key in latitude=t[0].geometry.location.ob,longitude=t[0].geometry.location.pb,t[0].address_components)"postal_code"==t[0].address_components[key].types[0]&&(s=t[0].address_components[key].long_name);""!=s?retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:s,compact:e.compact},!1):($("#store_search_results").empty(),$("#store_search_results").html("<text>No local stores near you.</text>"))}else"error"==s||"no_result"==s?($("#store_search_results").empty(),$("#store_search_results").html("<text>No local stores near you.</text>")):dd_console_log(t)}))}function retrieve_stores_for_lat_long(e,s){$.extend({compact:!1,callBack:!1},e),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"location_search",op:"json",latitude:e.latitude,longitude:e.longitude,zip:e.zip,compact:e.compact},success:function(t){0==e.callBack?($("#store_search_results").html(t.html),s&&($("html, body").animate({scrollTop:$("#store_search_results").offset().top},2e3),$("#zipsearch_search_btn").removeClass("btn-spinner"),$("#zipsearch_search_btn").removeClass("btn-spinning"),$("#zipsearch_search_btn").addClass("btn-spinner")),select_location_click_handler(),"locations"==getQueryVariable("page")&&($("#back_url_top").val("/locations?zip="+szZip),historyPush({url:"/locations?zip="+szZip,title:szZip+" "+document.title}))):e.callBack(t)},error:function(e,s){response="Unexpected error"}})}function getStoresForState(e,s){if(void 0!==s&&0==s||$("html, body").animate({scrollTop:$("#zipsearch_zipcode_only").offset().top},2e3),g_lastSearch==e)return!1;$("#store_search_results").slideUp(),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"location_search",op:"json",state:e},success:function(s){$("#store_search_results").html(s.html),$("#store_search_results").slideDown(),select_location_click_handler(),g_lastSearch=e,$("#zipsearch_state_id").val(e),$("#zipsearch_zipcode, #zipsearch_address, #zipsearch_city").val("").blur(),"locations"==getQueryVariable("page")&&($("#back_url_top").val("/locations?state="+e),historyPush({url:"/locations?state="+e,title:e+" "+document.title}))},error:function(e,s){response="Unexpected error"}})}$((function(){$(document).on("click","[data-linear_address]",(function(e){e.preventDefault(),showMap($(this).data("linear_address"))})),$(document).on("click",'[id^="locations_state-"]',(function(e){getStoresForState(this.id.split("-")[1]),e.preventDefault()})),$(document).on("click","#zipsearch_search_btn",(function(e){e.preventDefault(),handle_zipcode_search(),$(this).addClass("")})),$(document).on("click","#full_addr_search_btn",(function(e){e.preventDefault(),!1!==handle_address_search()&&$("html, body").animate({scrollTop:$("#store_search_results").offset().top},2e3)})),$(document).on("keypress","#zipsearch_zipcode",(function(e){$("#zipsearch_city").getVal()||$("#zipsearch_state_id").getVal(""),13==e.which&&$("#zipsearch_search_btn").trigger("click")})),$(document).on("click",".btn-shipping-search",(function(e){e.preventDefault(),$(".shipping-available, .shipping-not-available, .shipping-has-inventory, .shipping-has-no-inventory").hideFlex();let s=null;if(""==$(".form-shipping-search").getVal())return modal_message({message:"Zip code required"}),!1;s=$(".form-shipping-search").getVal(),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"location_search",op:"shipping",zip:s},success:function(e){e.delivered_store?e.shipping_has_inventory?create_and_submit_form({action:"/box-select",input:{delivered_zip:s}}):bootbox.dialog({title:"Out of stock",message:"We can ship to you, but our fridge is currently empty. We are busy prepping our new menu. Check back soon for a new selection of meals.",centerVertical:!0,buttons:{locations:{label:"Search all locations",callback:function(){create_and_submit_form({action:"/locations",input:{zip:s}})}},cancel:{label:"Close"}}}):bootbox.dialog({title:"Shipping not available",message:"We do not ship to the zip code provided.",centerVertical:!0,buttons:{locations:{label:"Search all locations",callback:function(){create_and_submit_form({action:"/locations",input:{zip:s}})}},cancel:{label:"Close"}}})},error:function(e,s){response="Unexpected error"}})})),cookieCheck(),handle_browser_location(),"undefined"!=typeof simplemaps_usmap&&(simplemaps_usmap.hooks.zoomable_click_state=function(e){getStoresForState(e,!1)},simplemaps_usmap.hooks.click_state=function(e){getStoresForState(e,!0)})}));
//# sourceMappingURL=locations.min.js.map
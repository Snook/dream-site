var g_lastSearch="";function waitForElement(){if(typeof someVariable!=="undefined"){}else{setTimeout(waitForElement,250)}}function handle_store_select(){$("body").change(function(){var t=$(".locations-button").not("locations-button-selected").first().html();$(".locations-button").on("click",function(e){e.preventDefault();if($(this).hasClass("locations-button-selected")){$(this).removeClass("locations-button-selected");if($(this).hasClass("btn-select-checked")){$(this).html(t)}}else{$(".locations-button-selected").removeClass("locations-button-selected");$(".btn-select-checked").each(function(){$(this).html(t)});$(this).addClass("locations-button-selected");if($(this).hasClass("btn-select-checked")){$(this).html("&nbsp;")}}if($(".locations-button-selected").length>0){$("#btn-next").prop("disabled",false);var s=$(".locations-button-selected").parent().parent().find("h3").first().text();$("#selected-location-marker").removeClass("marker-disabled").text(s)}else{$("#btn-next").prop("disabled",true);$("#selected-location-marker").addClass("marker-disabled").text("&nbsp;")}})}).change()}function handle_browser_location(){if(!getQueryVariable("state")&&!getQueryVariable("zip")&&$("#zipsearch_zipcode_only").length){address_location(function(e,s){if(e=="ok"){latitude=s[0].geometry.location.lat();longitude=s[0].geometry.location.lng();addressArray=address_components(s);szZip=addressArray["postal_code"].long_name;$("#zipsearch_zipcode_only").val(addressArray["postal_code"].long_name);retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},false)}else if(e=="error"||e=="no_result"){dd_message({message:s})}else{dd_console_log(s)}})}}function address_components(e){addressArray=[];$.each(e[0].address_components,function(){addressArray[this.types[0]]=this});return addressArray}function handle_address_search(){if(!$("#zipsearch_zipcode").getVal()&&(!$("#zipsearch_city").getVal()&&!$("#zipsearch_state_id").getVal())){dd_message({message:"Zip code or City & State required"});return false}if(!$("#zipsearch_zipcode").getVal()&&($("#zipsearch_city").getVal()&&!$("#zipsearch_state_id").getVal()||!$("#zipsearch_city").getVal()&&$("#zipsearch_state_id").getVal())){dd_message({message:"City & State required"});return false}address_search="";if($("#zipsearch_address").getVal()){address_search+=$("#zipsearch_address").getVal()}if($("#zipsearch_city").getVal()){address_search+=", "+$("#zipsearch_city").getVal()}if($("#zipsearch_state_id").getVal()){address_search+=" "+$("#zipsearch_state_id").getVal()}if($("#zipsearch_zipcode").getVal()){address_search+=" "+$("#zipsearch_zipcode").getVal()}address_location({address:address_search},function(e,s){if(e=="ok"){latitude=s[0].geometry.location.lat();longitude=s[0].geometry.location.lng();addressArray=address_components(s);if(typeof addressArray["postal_code"]==="undefined"){address_location({latlong:latitude+","+longitude},function(e,s){if(e=="ok"){latitude=s[0].geometry.location.lat();longitude=s[0].geometry.location.lng();addressArray=address_components(s);szZip="";if(typeof addressArray["postal_code"]!=="undefined"){szZip=addressArray["postal_code"].long_name}retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},true)}else if(e=="error"||e=="no_results"){dd_message({message:s})}else{dd_console_log(s)}})}else{szZip=addressArray["postal_code"].long_name;retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},true)}}else if(e=="error"||e=="no_result"){$("#store_search_results").empty();$("#store_search_results").html("<text>No local stores near you.</text>")}else{dd_console_log(s)}})}function handle_zipcode_search(){address_search="";if($("#zipsearch_zipcode_only").getVal()==""){dd_message({message:"Zip code required"});return false}else{address_search+=" "+$("#zipsearch_zipcode_only").getVal()}address_location({address:address_search},function(e,s){if(e=="ok"){latitude=s[0].geometry.location.lat();longitude=s[0].geometry.location.lng();addressArray=address_components(s);szZip=addressArray["postal_code"].long_name;retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:szZip},true);$("#zipsearch_zipcode_errorMessage").addClass("collapse");$("#zipsearch_zipcode_only").removeClass("border-red")}else if(e=="error"||e=="no_result"){$("#store_search_results").empty();$("#zipsearch_zipcode_errorMessage").removeClass("collapse");$("#zipsearch_zipcode_only").addClass("border-red");$("#zipsearch_search_btn").removeClass("btn-spinner");$("#zipsearch_search_btn").removeClass("btn-spinning");$("#zipsearch_search_btn").addClass("btn-spinner")}else{dd_console_log(s)}})}function retrieve_stores_for_address(t){var e={address:false,compact:false};if(!t.address){dd_console_log("retrieve_stores_for_address() requires settings.address")}$.extend(e,t);address_location(t,function(e,s){if(e=="ok"){let e="";latitude=s[0].geometry.location.ob;longitude=s[0].geometry.location.pb;for(key in s[0].address_components){if(s[0].address_components[key].types[0]=="postal_code"){e=s[0].address_components[key].long_name}}if(e!=""){retrieve_stores_for_lat_long({latitude:latitude,longitude:longitude,zip:e,compact:t.compact},false)}else{$("#store_search_results").empty();$("#store_search_results").html("<text>No local stores near you.</text>")}}else if(e=="error"||e=="no_result"){$("#store_search_results").empty();$("#store_search_results").html("<text>No local stores near you.</text>")}else{dd_console_log(s)}})}function retrieve_stores_for_lat_long(e,s){var t={compact:false};$.extend(t,e);$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"location_search",op:"json",latitude:e.latitude,longitude:e.longitude,zip:e.zip,compact:e.compact},success:function(e){$("#store_search_results").html(e.html);if(s){$("html, body").animate({scrollTop:$("#store_search_results").offset().top},2e3);$("#zipsearch_search_btn").removeClass("btn-spinner");$("#zipsearch_search_btn").removeClass("btn-spinning");$("#zipsearch_search_btn").addClass("btn-spinner")}select_location_click_handler();if(getQueryVariable("page")=="locations"){$("#back_url_top").val("main.php?page=locations&zip="+szZip);historyPush({url:"main.php?page=locations&zip="+szZip,title:szZip+" "+document.title})}},error:function(e,s){response="Unexpected error"}})}function getStoresForState(s,e){if(typeof e=="undefined"||e!=false){$("html, body").animate({scrollTop:$("#zipsearch_zipcode_only").offset().top},2e3)}if(g_lastSearch==s){return false}$("#store_search_results").slideUp();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"location_search",op:"json",state:s},success:function(e){$("#store_search_results").html(e.html);$("#store_search_results").slideDown();select_location_click_handler();g_lastSearch=s;$("#zipsearch_state_id").val(s);$("#zipsearch_zipcode, #zipsearch_address, #zipsearch_city").val("").blur();if(getQueryVariable("page")=="locations"){$("#back_url_top").val("main.php?page=locations&state="+s);historyPush({url:"main.php?page=locations&state="+s,title:s+" "+document.title})}},error:function(e,s){response="Unexpected error"}})}$(function(){$(document).on("click",".location_state",function(e){e.preventDefault();getStoresForState($(this).data("state"))});$(document).on("click","[data-linear_address]",function(e){e.preventDefault();showMap($(this).data("linear_address"))});$(document).on("click",'[id^="locations_state-"]',function(e){getStoresForState(this.id.split("-")[1]);e.preventDefault()});$("#zipsearch_search_btn").on("click",function(){handle_zipcode_search();$(this).addClass("")});$("#full_addr_search_btn").on("click",function(){if(handle_address_search()!==false){$("html, body").animate({scrollTop:$("#store_search_results").offset().top},2e3)}});$("#zipsearch_zipcode").keypress(function(e){if(!$("#zipsearch_city").getVal()){$("#zipsearch_state_id").getVal("")}if(e.which==13){$("#zipsearch_search_btn").trigger("click")}});cookieCheck();handle_browser_location();handle_store_select();if(typeof simplemaps_usmap!="undefined"){simplemaps_usmap.hooks.zoomable_click_state=function(e){getStoresForState(e,false)};simplemaps_usmap.hooks.click_state=function(e){getStoresForState(e,true)}}});
//# sourceMappingURL=locations.min.js.map
function handle_ltd_round_up(){$(document).on("change","#add_ltd_round_up",(function(e){$(this).is(":checked")?($("#ltd_round_up_select").prop("disabled",!1),""!=USER_PREFERENCES.LTD_AUTO_ROUND_UP.value||$.cookie("ltdru")&&$.cookie("ltdru")==session_id||modal_message({title:"My Preferences",message:'Would you like to automatically round up every time you order? You can edit this setting any time in <span class="font-weight-bold">My Preferences</span>.<div class="text-center; mt-1"><select id="ltd-round_up_opt_in"><option>Select a Round Up value</option><option value="1">Nearest Dollar</option><option value="2">2 Dollars</option><option value="5">5 Dollars</option><option value="10">10 Dollars</option><option value="35">35 Dollars</option><option value="54">54 Dollars</option></select></div>',modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide();var o=$(this);$("#ltd-round_up_opt_in").on("change",(function(e){var t=$(this).val();t>0&&modal_message({div_id:"rup_confirm",title:"My Preferences",message:"You have chosen to set your auto Round Up to "+(1==t?"the nearest dollar.":"$"+t),confirm:function(){$(o).remove(),set_user_pref("LTD_AUTO_ROUND_UP",t),(0==ltd_round_up_value&&1!=t||0==$("#ltd_round_up_select option:selected").index()&&!$.cookie("ltdru"))&&modal_message({title:"My Preferences",message:"Preference saved. Would you like to use your selected Round Up value on this order? This can be reviewed and edited.",modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{Yes:function(){1==t?$("#ltd_round_up_select option:eq(0)").prop("selected",!0).trigger("change"):$("#ltd_round_up_select").val(t).trigger("change")},No:function(){}}})}})}))},buttons:{No:function(){set_user_pref("LTD_AUTO_ROUND_UP",0)},"Ask Again Later":function(){$.cookie("ltdru",session_id)}}})):$("#ltd_round_up_select").prop("disabled",!0),$("#ltd_round_up_select").trigger("change")})),$("#ltd_round_up_select").on("change",(function(e){var t=$(this).val();null!=t&&($("#checkout_total-roundup_donation").text(formatAsMoney(t)),$("#add_ltd_round_up").is(":checked")?$("#ltd_round_up_div").slideDown():($("#ltd_round_up_div").slideUp(),t=0),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"ltd_round_up",ltd_round_up_value:t},success:function(e){e.processor_success||modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})),updateFinancials()})),!$("#add_ltd_round_up").is(":checked")&&USER_PREFERENCES.LTD_AUTO_ROUND_UP.value>0&&null==ltd_round_up_value?($("#add_ltd_round_up").prop("checked",!0),USER_PREFERENCES.LTD_AUTO_ROUND_UP.value>1?$("#ltd_round_up_select").val(USER_PREFERENCES.LTD_AUTO_ROUND_UP.value).prop("disabled",!1).trigger("change"):($("#ltd_round_up_select option:first-child").attr("selected",!0),$("#ltd_round_up_select").prop("disabled",!1).trigger("change"))):$("#add_ltd_round_up").is(":checked")&&$("#ltd_round_up_select").prop("disabled",!1).trigger("change")}function handle_checkout_delayed_payment(){USER_PREFERENCES&&get_user_pref("TC_DELAYED_PAYMENT_AGREE",null,(function(e){1!=e.user_preferences.TC_DELAYED_PAYMENT_AGREE.value&&"1"!=e.user_preferences.TC_DELAYED_PAYMENT_AGREE.value&&$("#is_store_specific_flat_rate_delayed_payment1, #is_flat_rate_delayed_payment1, #is_delayed_payment1").on("click",(function(e){modal_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment,modal:!0,noOk:!0,closeOnEscape:!1,open:function(e,t){$(this).parent().find(".ui-dialog-titlebar-close").hide()},buttons:{Agree:function(){$("#is_store_specific_flat_rate_delayed_payment1, #is_flat_rate_delayed_payment1, #is_delayed_payment1").unbind("click"),set_user_pref("TC_DELAYED_PAYMENT_AGREE",1)},Decline:function(){$("#is_store_specific_flat_rate_delayed_payment0, #is_flat_rate_delayed_payment0, #is_delayed_payment0").click(),modal_message({title:lang.en.tc.terms_and_conditions,message:lang.en.tc.delayed_payment_decline}),set_user_pref("TC_DELAYED_PAYMENT_AGREE",0)}}})}))}))}function handle_special_instructions(){$(document).on("keyup","#special_insts",(function(e){$(this).val()!=strip_tags($(this).val())&&$(this).val(strip_tags($(this).val()))}))}function submit_gift_card_purchase(){var e=$("<input></input>");e.attr("type","hidden"),e.attr("name","checkout_submit"),e.attr("value","true"),$("#gift_card_checkout").append(e),$("#gift_card_checkout").submit()}function submit_order(){create_and_submit_form({action:"/checkout",input:{special_insts:$("#special_insts").val(),customers_terms:$("#customers_terms").val()}})}function handlePlatePointsDiscount(e){inVal=e,(isNaN(e)||e<=0)&&"."!=e&&(e=0);var t=maxPPCredit;t>maxPPDeduction&&(t=maxPPDeduction),e>t&&(e=t),e<0&&(e=0),(e!=inVal||isNaN(inVal)||""==inVal)&&$("#plate_points_discount").val(e)}function editSaveAllPlatePointsCredits(){$("#plate_points_discount").val(formatAsMoney(maxPPDeduction)),editSavePlatePointsCredits(!1)}function editSavePlatePointsCredits(e){e&&$("#max_plate_points_deduction").html(maxPPDeduction);var t=$("#plate_points_discount").val();if(void 0!==t){var o=maxPPCredit;o>maxPPDeduction&&(o=maxPPDeduction),t>o&&(t=o),t<0&&(t=0),$("#plate_points_discount").val(formatAsMoney(t)),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_modify_plate_points_credits",op:"modify",new_credit_value:t},success:function(e){e.processor_success?($("#sum_checkout_total-subtotal").html(formatAsMoney(e.orderInfo.grand_total)),$("#checkout_total-tax").html(formatAsMoney(e.orderInfo.subtotal_all_taxes)),t>0?$("#row-discount_plate_points").showFlex():$("#row-discount_plate_points").hideFlex(),$("#checkout_total-coupon").html(formatAsMoney(e.orderInfo.coupon_code_discount_total)),avgCostPerServingEntreeCost-=e.orderInfo.coupon_code_discount_total,$("#checkout_total-points_discount_total").html(formatAsMoney(e.orderInfo.points_discount_total)),$("#checkout_total-membership_discount").html(formatAsMoney(e.orderInfo.membership_discount)),can_checkout()):modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}}function run_as_guest(){create_and_submit_form({action:"/checkout",input:{run_as_guest:"true"}})}function updateFinancials(){var e=0,t=0;$("#checkout_total-food").length&&(e=Number($("#checkout_total-food").html()));var o=0;$('[id^="checkout_total-giftcard_purchase"]').each((function(){var e=Number($(this).html());o+=e}));var a=0;$("#checkout_total-service_fee").length&&(a=Number($("#checkout_total-service_fee").html()));var r=0;$("#checkout_total-delivery_fee").length&&(r=Number($("#checkout_total-delivery_fee").html()));var s=0;$(".checkout_total-delivery_tip").length&&(s=Number($(".checkout_total-delivery_tip").html()));var i=0;$("#checkout_total-tax").length&&(i=Number($("#checkout_total-tax").html()));var c=e,n=0;$("#checkout_total-coupon").length&&(n=Number($("#checkout_total-coupon").html()));var d=0;$("#checkout_total-volume_discount").length&&(d=Number($("#checkout_total-volume_discount").html()));var _=0;$("#checkout_total-preferred_discount").length&&(_=Number($("#checkout_total-preferred_discount").html()));var l=0;$("#checkout_total-dream_rewards_discount").length&&(l=Number($("#checkout_total-dream_rewards_discount").html()));var u=0;$("#checkout_total-session_discount_total").length&&(u=Number($("#checkout_total-session_discount_total").html()));var m=0;$("#checkout_total-points_discount_total").length&&(m=Number($("#checkout_total-points_discount_total").html()));var p=0;$("#checkout_total-membership_discount").length&&(p=Number($("#checkout_total-membership_discount").html()));t=0;$("#checkout_total-bag_fee").length&&(t=Number($("#checkout_total-bag_fee").html()));var h=0;$("#checkout_total-customization_fee").length&&(h=Number($("#checkout_total-customization_fee").html()));e=c-(n+_+d+l+u+m+p);var f=Number(formatAsMoney(e+o+a+r+s+t+i+h));$("#sum_checkout_total-subtotal").html(formatAsMoney(f));var g=0;$('[id^="checkout_total_payment-"]').each((function(){$(this).is(":visible")&&(g+=Number($(this).html()))})),g>e+a+r+s+t+i&&(g=e+a+r+s+t+i,$('[id^="checkout_total_payment-credits"]').html(formatAsMoney(g)));var y=f-g-o,v=0,b=Math.ceil(y+o),k=parseFloat((b-(y+o)).toFixed(2));0==k&&(k=1),$("#round_up_nearest_dollar").val()!=k&&($("#round_up_nearest_dollar").val(k).text("$ "+formatAsMoney(k)),$("#add_ltd_round_up").trigger("change")),$("#add_ltd_round_up").is(":checked")&&(v="round_up_nearest_dollar"==$("#ltd_round_up_select").find(":selected").attr("id")?k:parseFloat($("#ltd_round_up_select").val())),$('[id^="credit_card_amount"]').html(formatAsMoney(y+o+v)),$("#debit_credit_card_amount").html(formatAsMoney(y+o+v));var C=!1,x=!1;$("#isEditDeliveredOrder").length&&(x=!0),x&&(y=$("#cc_amount_diff").html()),0==y&&0==o?($('[id^="cc"]').prop("disabled",!0),$("#billing_postal_code").prop("disabled",!0),$("#billing_address").prop("disabled",!0),$("#addCreditCard").prop("disabled",!0),$("#save_cc_as_ref").prop("disabled",!0),$("#is_store_specific_flat_rate_delayed_payment1").length&&($("#is_store_specific_flat_rate_delayed_payment1").prop("disabled",!0),$("#is_store_specific_flat_rate_delayed_payment0").prop("disabled",!0)),$("#enough_funds_alert").show(),C=!0):($('[id^="cc"]').prop("disabled",!1),$("#billing_postal_code").prop("disabled",!1),$("#billing_address").prop("disabled",!1),$("#addCreditCard").prop("disabled",!1),$("#save_cc_as_ref").prop("disabled",!1),$("#is_store_specific_flat_rate_delayed_payment1").length&&($("#is_store_specific_flat_rate_delayed_payment1").prop("disabled",!1),$("#is_store_specific_flat_rate_delayed_payment0").prop("disabled",!1)),$("#enough_funds_alert").hide());var E=formatAsMoney(avgCostPerServingEntreeCost/avgCostPerServing);return $("#checkout-cost_per_serving").html(E),$("#sum_checkout_total-balance").html(formatAsMoney(0)),C}function can_checkout(){handleCardRefChange();var e=updateFinancials();is_discounts_page?e?($("#checkoutOption").addClass("show"),$("#toPaymentOption").removeClass("show"),$("#customers_terms").is(":checked")?$("#complete_order").attr("disabled",!1):$("#complete_order").attr("disabled",!0),$("#customers_terms").attr("required","required"),$("#to_payment_or_checkout_form").prop("action","/checkout")):($("#checkoutOption").removeClass("show"),$("#toPaymentOption").addClass("show"),$("#to_payment").attr("disabled",!1),$("#customers_terms").attr("required",!1),$("#to_payment_or_checkout_form").prop("action","/payment")):$("#customers_terms").is(":checked")?$("#complete_order").attr("disabled",!1):$("#complete_order").attr("disabled",!0)}function remove_item_payment(e){"food"==e.item&&remove_food(),e.item,"credits"==e.item&&removeAllStoreCredit(e),"coupon"==e.item&&remove_payment_coupon(),"giftcard"==e.item&&remove_payment(e),"giftcard_purchase"==e.item&&remove_gift_card_purchase(e),"creditcard"==e.item&&remove_payment(e),"dinner_dollars"==e.item&&remove_dinner_dollars(e),"cc_ref"==e.item&&remove_credit_card_reference(e),can_checkout()}function remove_food(){var e="false";allowGuest&&(e="true"),create_and_submit_form({action:"/checkout",input:{remove:"food",run_as_guest:e}})}function rewardsCreditClick(e){if(e.checked)add_all_store_credit();else{removeAllStoreCredit({item:"credits"})}can_checkout()}function remove_gift_card_purchase(e){var t="false";allowGuest&&(t="true"),create_and_submit_form({action:"/checkout-gift-card",input:{remove:"gift_card_purchase",gcoid:e.item_number,run_as_guest:t}})}function remove_dinner_dollars(){$("#plate_points_discount").val(formatAsMoney(0)),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_modify_plate_points_credits",op:"modify",new_credit_value:0},success:function(e){e.processor_success?($("#sum_checkout_total-subtotal").html(formatAsMoney(e.orderInfo.grand_total)),$("#checkout_total-tax").html(formatAsMoney(e.orderInfo.subtotal_all_taxes)),$("#row-discount_plate_points").hideFlex(),$("#checkout_total-coupon").html(formatAsMoney(e.orderInfo.coupon_code_discount_total)),avgCostPerServingEntreeCost-=e.orderInfo.coupon_code_discount_total,$("#checkout_total-points_discount_total").html(formatAsMoney(e.orderInfo.points_discount_total)),$("#checkout_total-membership_discount").html(formatAsMoney(e.orderInfo.membership_discount)),can_checkout()):modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function remove_payment_coupon(){var e=Number($("#checkout_total-service_fee").html());$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:"coupon",page:"checkout"},success:function(t){if(t.processor_success){$("#add_coupon_code").prop("disabled",!1),$("#add_coupon_add").prop("disabled",!1),$("#checkout_total-tax").html(t.orderInfo.subtotal_all_taxes),$("#checkout_title-coupon_code").html(""),"undefined"!==t.is_edit_order&&1==t.is_edit_order&&location.reload();var o=Number($("#checkout_total-coupon").html());avgCostPerServingEntreeCost+=o,$("#checkout_total-coupon").html("0.00"),$("#row-coupon").hideFlex();$("#add_coupon_code").val().toUpperCase();"1"==coupon.limit_to_mfy_fee&&(maxPPDeduction+=e,editSavePlatePointsCredits(!0),maxPPCredit>0&&$("#edit_plate_points").attr("disabled",!1)),coupon=!1,can_checkout()}else modal_message({title:"Error",message:t.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function update_special_instructions(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_item_processor",op:"store_inst",special_inst:$("#special_insts").val()},success:function(e){e.processor_success||modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function update_bag_opt_out(){let e=0;supports_bag_fee&&$("#opted_to_bring_bags").is(":checked")&&(e=1),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_bag_fee",op:"set_opt_out",opt_out:e},success:function(e){if(e.processor_success){if($("#sum_checkout_total-subtotal").html(formatAsMoney(e.orderInfo.grand_total)),$("#checkout_total-tax").html(formatAsMoney(e.orderInfo.subtotal_all_taxes)),$("#opted_to_bring_bags").is(":checked"))$("#checkout_total-bag_fee_info").html("(You will provide bags)"),$("#checkout_total-bag_fee").html(formatAsMoney(0));else{bag_fee=default_bag_fee*number_bags_required;let e=number_bags_required>1?" bags":" bag",t=number_bags_required>1?" Bags":" Bag";$("#checkout_total-bag_fee_info").html("("+number_bags_required+e+" * $"+formatAsMoney(default_bag_fee)+")"),$("#checkout_total-bag_fee").html(formatAsMoney(bag_fee)),$("#bag_text").html(number_bags_required+t)}can_checkout()}else modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function add_payment_coupon(){var e=$("#add_coupon_code").val().toUpperCase();Number($("#checkout_total-service_fee").html());e?$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"coupon",page:"checkout",coupon_code:e},success:function(e){if(e.processor_success){if(coupon=e.coupon,$("#add_coupon_code").prop("disabled",!0),$("#add_coupon_add").prop("disabled",!0),$("#sum_checkout_total-subtotal").html(e.orderInfo.grand_total),void 0!==e.edit_order_diff&&($("#cc_amount_diff").html(e.balance),$("#original_order_total").html(e.originalOrderInfo.grand_total),$(".edit-order-field").removeClass("collapse")),$("#checkout_total-tax").html(e.orderInfo.subtotal_all_taxes),$("#checkout_title-coupon_code").html(e.coupon_title),$("#checkout_total-coupon").html(formatAsMoney(e.orderInfo.coupon_code_discount_total)),avgCostPerServingEntreeCost-=e.orderInfo.coupon_code_discount_total,$("#row-coupon").showFlex(),"1"==coupon.limit_to_mfy_fee&&maxPPDeduction>0){var t=$("#plate_points_discount").val();if(maxPPDeduction>=o&&maxPPDeduction-t<o)modal_message({title:"Error",message:"The Service fee is already discounted by using Dinner Dollars. If you wish to use this coupon please lower the amount of Dinner Dollars applied."}),remove_payment_coupon();else{var o=Number($("#checkout_total-service_fee").html());maxPPDeduction-=o.valueOf(),maxPPDeduction<0&&(maxPPDeduction=0),maxPPDeduction=formatAsMoney(maxPPDeduction),editSavePlatePointsCredits(!0)}}can_checkout()}else modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}}):modal_message({title:"Error",message:"Please enter a promo code."})}function calculateMaxNewGiftCardPayment(e){var t=Number($("#sum_checkout_total-subtotal").html()),o=0;return $('[id^="row-giftcard-"]').each((function(){var t=$(this).data("gc_number"),a=$(this).data("gc_amount");t!=e&&(o+=Number(formatAsMoney(a)))})),$("#checkout_total_payment-credits").length&&(o+=Number($("#checkout_total_payment-credits").html()).valueOf()),t.valueOf()-o}function get_gift_card_balance(){var e=$("#debit_gift_card_number").val();(e=e.trim())?$.ajax({url:"/processor",type:"GET",timeout:2e4,dataType:"json",data:{processor:"giftCardBalance",card_number:e,output:"json"},success:function(e){e.processor_success?modal_message({title:"Gift Card Balance",message:"Balance for card number <b>"+e.card_number+"</b> is <b>"+e.card_balance+"</b>"}):modal_message({title:"Gift Card Balance Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}}):modal_message({title:"Error",message:"Please enter a gift card number."})}function getGiftCardNumberAndAmount(){var e=$("#debit_gift_card_number").val(),t={dataValid:!0,gc_number:e,gc_amount:$("#debit_gift_card_amount").val(),is_update:!0},o=!1;$("#giftcard_container").find('[data-gc_number="'+e+'"]').each((function(){o=!0,t.replacementObj=this,modal_message({title:"Attention",message:"You have already entered this gift card number. If you proceed the current amount will be replaced by the amount you are now submitting.",modal:!0,confirm:function(){do_add_gift_card(t)},cancel:function(){return $("#giftCardRedeem").removeClass("disabled"),null}})})),o||do_add_gift_card(t)}function do_add_gift_card(e){var t=$("#debit_gift_card_number").data("processing");if(e&&!t)if(e.gc_number&&(e.gc_number=e.gc_number.trim()),e.gc_number)if(e.gc_amount){var o=0;e.replacementObj&&(o=e.replacementObj.id.split("-")[2]),$("#debit_gift_card_number").data("processing",!0),$.ajax({url:"/processor",type:"GET",timeout:2e4,dataType:"json",data:{processor:"giftCardBalance",card_number:e.gc_number,output:"json"},success:function(t){if(t.processor_success){if($("#giftCardRedeem").removeClass("disabled"),"Invalid Card"==t.card_balance)modal_message({title:"Gift Card Error",message:"The card number is invalid."});else if(1*t.card_balance<1*e.gc_amount)modal_message({title:"Gift Card Error",message:"There are not enough funds on the gift card for this amount. Available balance: "+t.card_balance});else{var a=calculateMaxNewGiftCardPayment(e.gc_number);e.gc_amount>a&&(e.gc_amount=a.toString()),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"gift_card",card_number:e.gc_number,amount:e.gc_amount,c_total:$("#sum_checkout_total-subtotal").html(),current_subtotal:$("#sum_checkout_total-subtotal").html(),original_order_total:$("#original_order_total").html(),payment_id:o,output:"json"},success:function(t){t.processor_success?(e.replacementObj&&$(e.replacementObj).remove(),$("#debit_gift_card_number").val(""),$("#debit_gift_card_amount").val(""),$("#giftcard_container").append(t.html),$("#giftcard_container").slideDown(),void 0!==t.edit_order_html&&null!=t.edit_order_html&&$("#edit-order-total-container").replaceWith(t.edit_order_html),can_checkout()):modal_message({title:"Gift Card Error",message:t.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}$("#debit_gift_card_number").data("processing",!1)}else $("#debit_gift_card_number").data("processing",!1),modal_message({title:"Gift Card Error",message:t.processor_message})},error:function(e,t){$("#debit_gift_card_number").data("processing",!1),modal_message({title:"Error",message:"Unexpected error: "+t})}})}else modal_message({title:"Error",message:"Please enter a gift card amount."});else modal_message({title:"Error",message:"Please enter a gift card number."})}function add_payment_gift_card(){getGiftCardNumberAndAmount()}function getDomObjectToRemove(e){return"giftcard"==e.item?$("#row-giftcard-"+e.item_number).get():"creditcard"==e.item?$("#row-creditcard-"+e.item_number).get():"credits"==e.item?$("#row-credits").get():"cc_ref"==e.item?$("#row-cc_ref-"+e.item_number).get():null}function add_all_store_credit(){$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"all_store_credit",store_id:store_id_of_order,output:"json"},success:function(e){e.processor_success?($("#row-credits").html(e.html),$("#row-credits").slideDown(),can_checkout()):modal_message({title:"Gift Card Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function removeAllStoreCredit(e){var t=getDomObjectToRemove(e);$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:"store_credit",payment_number:"all"},success:function(e){e.processor_success?($(t).slideUp(),$(t).empty(),$("#SC-total").prop("checked",!1),can_checkout()):modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function remove_payment(e){var t=getDomObjectToRemove(e);$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:e.item,payment_number:e.item_number},success:function(o){o.processor_success?("creditcard"==e.item&&($('[id^="cc"]').prop("disabled",!1),$("#billing_postal_code").prop("disabled",!1),$("#billing_address").prop("disabled",!1),$("#addCreditCard").prop("disabled",!1)),$("#is_delayed_payment1").length&&($("#is_delayed_payment1").prop("disabled",!1),$("#is_delayed_payment0").prop("disabled",!1)),$(t).slideUp(),"creditcard"==e.item&&$(t).remove(),"giftcard"==e.item&&location.reload(),can_checkout()):modal_message({title:"Error",message:o.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function handleNewCardFormShown(){$('[id^="cc_pay_id"]').prop({disabled:!0,checked:!1,required:!1}),$('[id^="gc_pay_id"]').prop({disabled:!0,checked:!1,required:!1}),requireCreditCardFields()}function handleNewCardFormHidden(){$('[id^="cc_pay_id"]').prop({disabled:!1,required:!0}).parents("form:first").removeClass("was-validated").find(".form-feedback").hide(),$('[id^="gc_pay_id"]').prop({disabled:!1,required:!0}).parents("form:first").removeClass("was-validated").find(".form-feedback").hide(),doNotRequireCreditCardFields()}function handleOrderCustomizations(e){try{if("to_payment_or_checkout_form"==e.attr("id")){let e=!1;if($("#apply-customization").is(":checked")&&($("[data-user_pref_meal][type=checkbox]").each((function(){$(this).is(":checked")&&(e=!0)})),!e))return modal_message({title:"Missing Customization Options",message:"At least one meal customization option is required if 'Customize this order' is checked."}),$("#to_payment").removeClass("btn-spinning"),setTimeout((function(){$("#to_payment").removeClass("disabled")}),2e3),!1}}catch(e){console.log("Issue checking if meal customizations are selected")}return!0}function handleCardRefChange(){var e=!1;$('[id^="cc_pay_id"]').each((function(){$(this).is(":checked")&&(e=$(this).val())})),$('[id^="gc_pay_id"]').each((function(){$(this).is(":checked")&&(e=$(this).val())})),e&&doNotRequireCreditCardFields()}function requireCreditCardFields(){$("#ccNameOnCard, #ccType, #ccNumber, #ccMonth, #ccYear, #ccSecurityCode, #billing_address, #billing_postal_code, #billing_city").prop("required",!0)}function doNotRequireCreditCardFields(){$("#ccNameOnCard, #ccType, #ccNumber, #ccMonth, #ccYear, #ccSecurityCode, #billing_address, #billing_postal_code, #billing_city").prop("required",!1)}function remove_credit_card_reference(e){var t=getDomObjectToRemove(e);$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:"cc_ref",cc_ref_id:e.item_number},success:function(e){if(e.processor_success){var o=$(t).data("num_cc_refs");$(t).slideUp(),$(t).remove(),o>1&&$('[id^="row-cc_ref"]').data("num_cc_refs",o-1),can_checkout()}else modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function add_payment_credit_card(){var e=$('[id^="cc"]').get();if(_check_elements(e)){$("#addCreditCard").prop("disabled",!0);var t=!1;$("#is_delayed_payment1").length&&$("#is_delayed_payment1").attr("checked")&&(t=!0),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"credit_card",card_number:$("#ccNumber").val(),name_on_card:$("#ccNameOnCard").val(),exp_month:$("#ccMonth").val(),exp_year:$("#ccYear").val(),security_code:$("#ccSecurityCode").val(),card_type:$("#ccType").val(),billing_zip:$("#billing_postal_code").val(),billing_addr:$("#billing_address").val(),do_delayed_payment:t,output:"json"},success:function(e){e.processor_success?($('[id^="cc"]').prop("disabled",!0),$("#billing_postal_code").prop("disabled",!0),$("#billing_address").prop("disabled",!0),$("#addCreditCard").prop("disabled",!0),$("#is_delayed_payment1").length&&($("#is_delayed_payment1").prop("disabled",!0),$("#is_delayed_payment0").prop("disabled",!0)),$("#creditcard_container").append(e.html),$("#creditcard_container").slideDown(),can_checkout(),0==cart_subtotal&&modal_message({title:"Alert",message:"You have added all required payments, you may now submit your order."})):(modal_message({title:"Credit Card Error",message:e.processor_message}),$("#addCreditCard").prop("disabled",!1))},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t}),$("#addCreditCard").prop("disabled",!1)}})}}cart_subtotal=0,$((function(){$("#apply-customization").length&&1==default_meal_customization_to_selected?$("#apply-customization").click():initMealCustomizationFields(),$("form").submit((function(e){let t=handleOrderCustomizations($(this));!0!==$(this).data("was_submitted")&&t?$(this).data("was_submitted",!0):e.preventDefault()})),$(document).on("click",".help-cvv",(function(e){modal_message({title:"Help",message:"The security code is a 3 digit number located on the back of MasterCard, Visa, Discover. On American Express cards, the security code is a group of 4 digits printed on the front."})})),$(document).on("change","#ccType",(function(e){"American Express"==$(this).val()?$("#ccSecurityCode").prop({min:"0",max:"9999",maxlength:"4",pattern:"^[0-9]{4}$"}):""!=$(this).val()&&null!=$(this).val()&&$("#ccSecurityCode").prop({min:"0",max:"999",maxlength:"3",pattern:"^[0-9]{3}$"})})),USER_PREFERENCES&&$("#ccNumber").length&&$("#ccNumber").validateCreditCard((function(e){var t=!1;if(null!=e.card_type&&null!=e.card_type.name&&(t=e.card_type.name),(""==$("#ccType").val()||null==$("#ccType").val())&&t)switch(t){case"visa":$("#ccType").val("Visa");break;case"mastercard":$("#ccType").val("Mastercard");break;case"amex":$("#ccType").val("American Express");break;case"discover":$("#ccType").val("Discover")}if(""!=$("#ccType").val()){var o=!1;switch($("#ccType").val()){case"Visa":o="visa";break;case"Mastercard":o="mastercard";break;case"American Express":o="amex";break;case"Discover":o="discover"}o&&o!=t&&$("#ccNumber").val().length>2?$(".credit_card_warning").removeClass("collapse"):$(".credit_card_warning").addClass("collapse")}}),{accept:["visa","mastercard","discover","amex"]}),$(document).on("click","[data-credit_card_logo]",(function(e){$("#ccType").val($(this).data("credit_card_logo")).trigger("change")})),$(document).on("click",'[id^="remove-"]',(function(e){var t={id:this.id,item:this.id.split("-")[1],item_number:this.id.split("-")[2],type:"Payment"},o=null!=t.item_number?"-"+t.item_number:"";t.title=$("#checkout_title-"+t.item+o).text(),"nonfood"!=t.item&&"food"!=t.item&&"giftcard_purchase"!=t.item||(t.type="Item"),modal_message({title:"Remove "+t.type,message:"Are you sure you wish to remove "+t.title+".",confirm:function(){remove_item_payment(t)}})})),$(document).on("change","#customers_terms",(function(e){can_checkout()})),$(document).on("click","#add_coupon_add",(function(e){add_payment_coupon(),e.preventDefault()})),$(document).on("keyup","#add_coupon_code",(function(e){13==e.which&&add_payment_coupon()})),$(document).on("click","#addCreditCard",(function(e){add_payment_credit_card()})),$(document).on("click","#giftCardBalance",(function(e){e.preventDefault(),get_gift_card_balance()})),$(document).on("click","#giftCardRedeem:not(.disabled)",(function(e){e.preventDefault(),$(this).addClass("disabled"),add_payment_gift_card()})),$(document).on("change","#shipping_phone_number",(function(e){$(".shipping_phone_number_new_div").hideFlex(),$("#shipping_phone_number_new").prop("required",!1),"new"==$(this).val()&&($(".shipping_phone_number_new_div").showFlex(),$("#shipping_phone_number_new").prop("required",!0))})),$(document).on("change","#address_book_select",(function(e){let t=$(this).val(),o="update"==$("#address_book_update_update").val()?"":$("#address_book_update_update").val();""==t?($("#address_book_update_update").val("update"),$("#shipping_firstname").valCheckDiffRemove(""),$("#shipping_lastname").valCheckDiffRemove(""),$("#shipping_address_line1").valCheckDiffRemove(""),$("#shipping_address_line2").valCheckDiffRemove(""),$("#shipping_city").valCheckDiffRemove(""),$("#shipping_state_id").valCheckDiffRemove(""),$("#shipping_address_note").valCheckDiffRemove(""),$("#shipping_phone_number").valCheckDiffRemove(""),$("#shipping_gift_email_address").valCheckDiffRemove(""),$("#shipping_postal_code").valCheckDiffRemove()):t&&$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"delivered_box",op:"update_address",id:t},success:function(e){if(e.processor_success){let t=JSON.parse(e.address);switch(e.status){case"no_inventory":modal_message({message:e.processor_message,buttons:{Cancel:function(){$("#address_book_select").val(o)},"Change Address":function(){create_and_submit_form({action:"/box-select",input:{delivered_zip:t.postal_code}})}}});break;case"not_eligible":modal_message({message:"We are sorry, Dream Dinners does not currently ship to "+t.postal_code,buttons:{Close:function(){$("#address_book_select").val(o)}}});break;default:"ADDRESS_BOOK"==t.location_type?($("#address_book_update_update").val(t.id),$("#shipping_firstname").valCheckDiff({value:t.firstname,group:"shipaddy"}),$("#shipping_lastname").valCheckDiff({value:t.lastname,group:"shipaddy"}),$("#shipping_address_line1").valCheckDiff({value:t.address_line1,group:"shipaddy"}),$("#shipping_address_line2").valCheckDiff({value:t.address_line2,group:"shipaddy"}),$("#shipping_city").valCheckDiff({value:t.city,group:"shipaddy"}),$("#shipping_state_id").valCheckDiff({value:t.state_id,group:"shipaddy"}),$("#shipping_address_note").valCheckDiff({value:t.address_note,group:"shipaddy"}),$("#shipping_phone_number").valCheckDiff({value:t.telephone_1,group:"shipaddy"}),$("#shipping_gift_email_address").valCheckDiff({value:t.email_address,group:"shipaddy"}),$("#shipping_postal_code").valCheckDiff({value:t.postal_code,group:"shipaddy"})):($("#shipping_firstname").val(t.firstname),$("#shipping_lastname").val(t.lastname),$("#shipping_address_line1").val(t.address_line1),$("#shipping_address_line2").val(t.address_line2),$("#shipping_city").val(t.city),$("#shipping_state_id").val(t.state_id),$("#shipping_address_note").val(t.address_note),$("#shipping_phone_number").val(t.telephone_1),$("#shipping_gift_email_address").val(t.email_address),$("#shipping_postal_code").val(t.postal_code))}}},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})})),$(document).on("dd:checkdiff",(function(e){let t=$(document).data().checkdiff;0===Object.keys(t.shipaddy).length?$(".update_contact_row").hideFlex():$(".update_contact_row").showFlex()})),$(document).on("shown.bs.collapse","#add_new_cc",(function(e){handleNewCardFormShown()})),$(document).on("hidden.bs.collapse","#add_new_cc",(function(e){handleNewCardFormHidden()})),$(document).on("change",'[id^="cc_pay_id"]',(function(e){handleCardRefChange()})),$(document).on("change",'[id^="gc_pay_id"]',(function(e){handleCardRefChange()})),$(document).on("click",".box-change-zip",(function(e){e.preventDefault();let t=$(this).attr("href");modal_message({message:"Menu item availability and taxes may be different for another delivery area. In order to change the zip code, we need to send you through the order process again.",buttons:{"Change Zip":function(){bounce(t)},Cancel:function(){}}})})),USER_PREFERENCES&&(handle_ltd_round_up(),handle_checkout_delayed_payment(),handle_special_instructions(),handleMealCustomizationAccordion(),$(document).on("click","#apply_plate_points",(function(e){editSavePlatePointsCredits(!1)})),$(document).on("click","#apply_all_plate_points",(function(e){editSaveAllPlatePointsCredits(!1)})),$("#apply_plate_points").length&&maxPPDeduction<=0&&($("#apply_plate_points").attr("disabled",!0),$("#apply_all_plate_points").attr("disabled",!0))),can_checkout()}));const checkbox=document.getElementById("opted_to_bring_bags");function handleMealCustomizationAccordion(){$("#customization-header").click((function(e){e.preventDefault(),$header=$(this),$content=$("#customization-row"),$header.html((function(){return"Meal Customizations"+($content.is(":visible")?" &#8744;":" &#8743;")})),$content.slideToggle(500,(function(){}))}))}function initMealCustomizationFields(){"undefined"==typeof has_meal_customization_selected&&(has_meal_customization_selected=!1),toggleMealCustomizationOptions(has_meal_customization_selected)}function toggleMealCustomizationOptions(e){e?($("[data-user_pref_meal][type=checkbox]").removeAttr("disabled"),$(".customization-readonly-option").removeClass("text-gray-400")):($("[data-user_pref_meal][type=checkbox]").attr("disabled",!0),$(".customization-readonly-option").addClass("text-gray-400"))}function toggleMealCustomizationMasterCheckbox(e){e?($("#apply-customization").prop("checked",!0),$("#apply-customization").attr("checked",!0),has_meal_customization_selected=!0):($("#apply-customization").prop("checked",!1),$("#apply-customization").attr("checked",!0),has_meal_customization_selected=!1,handleMealCustomizationMasterCheckbox(!1))}function handleMealCustomizationMasterCheckbox(e){has_meal_customization_selected=e,toggleMealCustomizationOptions(e),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"JSON",data:{processor:"cart_order_customization_preference",op:"set_customization_applies_to_order",allow_customization:e,customizations:JSON.stringify(meal_customization_preferences)},success:function(e){e.processor_success?(customization=e,1==customization.opted_to_customize_recipes?$("#customization-fee-row").show():$("#customization-fee-row").hide(),$("#checkout_total-customization_fee").text(formatAsMoney(customization.cost)),$("#sum_checkout_total-subtotal").text(formatAsMoney(customization.orderInfo.grand_total)),$("#credit_card_amount").text(formatAsMoney(customization.orderInfo.grand_total)),$("#checkout_total-tax").text(formatAsMoney(customization.orderInfo.subtotal_all_taxes))):modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}function preferenceChangeListener(e,t,o,a){if((e=e.toUpperCase()).includes("MEAL")){let o=USER_PREFERENCES[e].value;t=$.isPlainObject(o)&&$.isPlainObject(t)?JSON.stringify($.extend(USER_PREFERENCES[e].value,t)):t.toString(),meal_customization_preferences[e].value=t,$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_order_customization_preference",op:"update_order_meal_customization",customizations:JSON.stringify(meal_customization_preferences)},success:function(e){e.processor_success?(1==e.opted_to_customize_recipes?$("#customization-fee-row").show():$("#customization-fee-row").hide(),$("#checkout_total-customization_fee").text(formatAsMoney(e.cost)),$("#sum_checkout_total-subtotal").text(formatAsMoney(e.orderInfo.grand_total)),$("#credit_card_amount").text(formatAsMoney(e.orderInfo.grand_total)),void 0!==a&&a(e)):modal_message({title:"Error",message:e.processor_message})},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})}else set_user_pref(e,t,o,a)}checkbox&&checkbox.addEventListener("click",(function(){checkbox.checked?($("#bag_text").hideFlex(),$("#opted_to_bring_bags_hidden").val("1")):($("#bag_text").showFlex(),$("#opted_to_bring_bags_hidden").val("0")),update_bag_opt_out()})),$(document).on("click",".checkout-edit-delivery-tip:not(.disabled)",(function(e){e.preventDefault();let t=""==$("#delivery_tip").val()?0:$("#delivery_tip").val();$("#delivery_tip").data("editing")?($("#delivery_tip").prop({readonly:!0}).data("editing",!1),$(this).addClass("disabled").text("Updating"),$.ajax({url:"/processor",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_add_payment",payment_type:"delivery_tip",value:t},success:function(e){$(".checkout-edit-delivery-tip").removeClass("disabled").text("Edit"),e.processor_success?($(".checkout_total-delivery_tip").text(formatAsMoney(e.delivery_tip)),$("#sum_checkout_total-subtotal, #credit_card_amount").text(formatAsMoney(e.grand_total)),e.delivery_tip>0?$(".row-delivery_tip").showFlex():$(".row-delivery_tip").hideFlex()):modal_message({title:"Error",message:e.processor_message}),can_checkout()},error:function(e,t){modal_message({title:"Error",message:"Unexpected error: "+t})}})):($("#delivery_tip").prop({readonly:!1}).data("editing",!0,"org-val",t),$(this).text("Apply"))})),$(document).on("click","#apply-customization",(function(e){handleMealCustomizationMasterCheckbox($(this).prop("checked"))}));
//# sourceMappingURL=checkout.min.js.map
function emailIsNew(a){var s=true;$.each(eventReferrals,function(e,t){if(t.referred_user_email===a){s=false}});return s}function updateEmailCounter(){var a=0;$.each(eventReferrals,function(e,t){if(t.referred_user_send_email==true){a++}});$("#number_of_emails").text("");$(".send-event-emails").addClass("disabled");if(a>0){$("#number_of_emails_plural").show();if(a==1){$("#number_of_emails_plural").hide()}$("#number_of_emails").text(a);$(".send-event-emails").removeClass("disabled")}}function setEventReferral(a,e){if(typeof eventReferrals[a]=="undefined"){eventReferrals[a]=e}else{$.each(e,function(e,t){eventReferrals[a][e]=t})}updateEmailCounter()}function unsetEventReferral(e){if(typeof eventReferrals[e]!="undefined"){delete eventReferrals[e]}updateEmailCounter()}function add_contact(e,t){if(!$('[data-email-address-div="'+t+'"]').length){var a=$(".add-event-contact-div").clone();$(a).find(".add-contact-email").removeClass("add-contact-email is-invalid").attr("disabled",true).val(t);$(a).find(".add-contact-name").removeClass("add-contact-name").attr("disabled",true).val(e);$(a).removeClass("add-event-contact-div").attr("data-email-address-div",t);$(a).find(".add-event-contact").data("email-address",t).removeClass("add-event-contact disabled btn-primary").addClass("remove-event-contact btn-warning").find(".fas").removeClass("fa-plus").addClass("fa-minus");$(a).insertBefore(".add-event-contact-div");setEventReferral(t,{referred_user_name:e,referred_user_email:t,referred_user_send_email:true})}}function list_contacts(e){if(e.length>0){bootbox.dialog({scrollable:true,title:"Select Contacts",message:e,buttons:{add:{label:"Add selected",className:"btn-primary",callback:function(){$('[id^="import_id-"]').each(function(e){if($(this).is(":checked")){var t=$(this).data("name");var a=$(this).data("email");add_contact(t,a)}})}}}})}else{dd_message({title:"Error",message:"No email addresses found in address book."})}}$(function(){$(document).on("change keyup",".add-contact-email",function(e){var a=$(this).val().trim();var t=emailIsNew(a);$(this).removeClass("is-invalid");if(!t){$(this).addClass("is-invalid")}if(t&&a!=""){var s=e.which;if(s==13){$(".add-event-contact").trigger("click");return false}$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"data_lookup",type:"valid_email",check:"email",rules:{not_self:true},email:a},success:function(e,t){if(e.processor_success&&emailIsNew(a)){$(".add-event-contact").removeClass("disabled")}else{$(".add-event-contact").addClass("disabled")}},error:function(e,t){response="Unexpected error"}})}else{$(".add-event-contact").addClass("disabled")}});$(document).on("change keyup","#session_message, #session_host",function(e){$(".save-event-details").removeClass("disabled")});$(document).on("click",".save-event-details",function(e){var t=$("#session_host").val();var a=$("#session_message").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"save_details",event_id:manageEventID,message:a,host:t},success:function(e,t){if(e.processor_success){$(".save-event-details").addClass("disabled");$(".btn-spinning").removeClass("btn-spinning");$(".ld-spin").remove()}else{}},error:function(e,t){response="Unexpected error"}})});$(document).on("click",".add-event-contact:not(.disabled)",function(e){var t=$(".add-event-contact-div").find(".add-contact-name").val().trim();var a=$(".add-event-contact-div").find(".add-contact-email").val().trim();var s=emailIsNew(a);if(s){if(t==""){t=a;$(".add-event-contact-div").find(".add-contact-name").val(t)}$(".add-event-contact-div").find(".add-contact-email").removeClass("add-contact-email is-invalid").attr("disabled",true);$(".add-event-contact-div").find(".add-contact-name").removeClass("add-contact-name").attr("disabled",true);$(".add-event-contact-div").removeClass("add-event-contact-div").attr("data-email-address-div",a);$(this).data("email-address",a).removeClass("add-event-contact btn-primary").addClass("remove-event-contact btn-warning").find(".fas").removeClass("fa-plus").addClass("fa-minus");setEventReferral(a,{referred_user_name:t,referred_user_email:a,referred_user_send_email:true});$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"get_template",template:"manage_invites"},success:function(e,t){if(e.processor_success){$(".event-referrals-div").append(e.html);var a=window.matchMedia("only screen and (max-width: 760px)").matches;if(!a){$(".add-event-contact-div").find(".add-contact-name").focus()}}else{}},error:function(e,t){response="Unexpected error"}})}else{$(this).addClass("disabled")}});$(document).on("change",".referred_user_send_email",function(e){var t=$(this).data("referral_id");setEventReferral(t,{referred_user_send_email:false});if($(this).is(":checked")){setEventReferral(t,{referred_user_send_email:true})}});$(document).on("click",".remove-event-contact",function(e){var t=$(this).data("email-address");unsetEventReferral(t);$('[data-email-address-div="'+t+'"]').slideUp("normal",function(){$(this).remove()})});$(document).on("click",".send-event-emails:not(.disabled)",function(e){$(".save-event-details").trigger("click");var t=$("#session_message").val().trim();var a=$("#session_host").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"send_invites",event_id:manageEventID,message:t,name:a,emails:JSON.stringify(eventReferrals)},success:function(e,t){if(e.processor_success){eventReferrals=$.parseJSON(e.eventReferralsJS);$(".event-referrals-div").html(e.html);$(".btn-spinning").removeClass("btn-spinning");$(".ld-spin").remove();updateEmailCounter()}else{}},error:function(e,t){response="Unexpected error"}})});$(document).on("click",".import_contacts_previous",function(e){e.preventDefault();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"import_contacts",client:"previous"},success:function(e,t){if(e.processor_success){list_contacts(e.html)}else{}},error:function(e,t){response="Unexpected error"}})});$(document).on("click",".import_contacts_outlook",function(e){e.preventDefault();getGraphContacts(function(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"import_contacts",client:"msgraph",contacts:JSON.stringify(e)},success:function(e,t){if(e.processor_success){list_contacts(e.html)}else{}},error:function(e,t){response="Unexpected error"}})})});$(document).on("click",".import_contacts_google",function(e){e.preventDefault();gapi.client.setApiKey(CLIENT.google.api);gapi.auth.authorize({client_id:CLIENT.google.id,scope:"https://www.googleapis.com/auth/contacts.readonly",immediate:false},t)});function t(e){if(e&&!e.error){$.ajax({url:"https://www.google.com/m8/feeds/contacts/default/thin?access_token="+e.access_token+"&alt=json&max-results=10000",dataType:"json",success:function(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"import_contacts",client:"google",contacts:JSON.stringify(e)},success:function(e,t){if(e.processor_success){list_contacts(e.html)}else{}},error:function(e,t){response="Unexpected error"}})}})}}});
//# sourceMappingURL=my_events.min.js.map
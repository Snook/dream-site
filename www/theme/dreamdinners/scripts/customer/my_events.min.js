function emailIsNew(e){var t=!0;return $.each(eventReferrals,(function(a,s){s.referred_user_email===e&&(t=!1)})),t}function updateEmailCounter(){var e=0;$.each(eventReferrals,(function(t,a){1==a.referred_user_send_email&&e++})),$("#number_of_emails").text(""),$(".send-event-emails").addClass("disabled"),e>0&&($("#number_of_emails_plural").show(),1==e&&$("#number_of_emails_plural").hide(),$("#number_of_emails").text(e),$(".send-event-emails").removeClass("disabled"))}function setEventReferral(e,t){void 0===eventReferrals[e]?eventReferrals[e]=t:$.each(t,(function(t,a){eventReferrals[e][t]=a})),updateEmailCounter()}function unsetEventReferral(e){void 0!==eventReferrals[e]&&delete eventReferrals[e],updateEmailCounter()}function add_contact(e,t){if(!$('[data-email-address-div="'+t+'"]').length){var a=$(".add-event-contact-div").clone();$(a).find(".add-contact-email").removeClass("add-contact-email is-invalid").attr("disabled",!0).val(t),$(a).find(".add-contact-name").removeClass("add-contact-name").attr("disabled",!0).val(e),$(a).removeClass("add-event-contact-div").attr("data-email-address-div",t),$(a).find(".add-event-contact").data("email-address",t).removeClass("add-event-contact disabled btn-primary").addClass("remove-event-contact btn-warning").find(".fas").removeClass("fa-plus").addClass("fa-minus"),$(a).insertBefore(".add-event-contact-div"),setEventReferral(t,{referred_user_name:e,referred_user_email:t,referred_user_send_email:!0})}}function list_contacts(e){e.length>0?bootbox.dialog({scrollable:!0,title:"Select Contacts",message:e,buttons:{add:{label:"Add selected",className:"btn-primary",callback:function(){$('[id^="import_id-"]').each((function(e){$(this).is(":checked")&&add_contact($(this).data("name"),$(this).data("email"))}))}}}}):modal_message({title:"Error",message:"No email addresses found in address book."})}$((function(){function e(e){e&&!e.error&&$.ajax({url:"https://www.google.com/m8/feeds/contacts/default/thin?access_token="+e.access_token+"&alt=json&max-results=10000",dataType:"json",success:function(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"import_contacts",client:"google",contacts:JSON.stringify(e)},success:function(e,t){e.processor_success&&list_contacts(e.html)},error:function(e,t){response="Unexpected error"}})}})}$(document).on("change keyup",".add-contact-email",(function(e){var t=$(this).val().trim(),a=emailIsNew(t);if($(this).removeClass("is-invalid"),a||$(this).addClass("is-invalid"),a&&""!=t){if(13==e.which)return $(".add-event-contact").trigger("click"),!1;$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"data_lookup",type:"valid_email",check:"email",rules:{not_self:!0},email:t},success:function(e,a){e.processor_success&&emailIsNew(t)?$(".add-event-contact").removeClass("disabled"):$(".add-event-contact").addClass("disabled")},error:function(e,t){response="Unexpected error"}})}else $(".add-event-contact").addClass("disabled")})),$(document).on("change keyup","#session_message, #session_host",(function(e){$(".save-event-details").removeClass("disabled")})),$(document).on("click",".save-event-details",(function(e){var t=$("#session_host").val(),a=$("#session_message").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"save_details",event_id:manageEventID,message:a,host:t},success:function(e,t){e.processor_success&&($(".save-event-details").addClass("disabled"),$(".btn-spinning").removeClass("btn-spinning"),$(".ld-spin").remove())},error:function(e,t){response="Unexpected error"}})})),$(document).on("click",".add-event-contact:not(.disabled)",(function(e){var t=$(".add-event-contact-div").find(".add-contact-name").val().trim(),a=$(".add-event-contact-div").find(".add-contact-email").val().trim();emailIsNew(a)?(""==t&&(t=a,$(".add-event-contact-div").find(".add-contact-name").val(t)),$(".add-event-contact-div").find(".add-contact-email").removeClass("add-contact-email is-invalid").attr("disabled",!0),$(".add-event-contact-div").find(".add-contact-name").removeClass("add-contact-name").attr("disabled",!0),$(".add-event-contact-div").removeClass("add-event-contact-div").attr("data-email-address-div",a),$(this).data("email-address",a).removeClass("add-event-contact btn-primary").addClass("remove-event-contact btn-warning").find(".fas").removeClass("fa-plus").addClass("fa-minus"),setEventReferral(a,{referred_user_name:t,referred_user_email:a,referred_user_send_email:!0}),$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"get_template",template:"manage_invites"},success:function(e,t){e.processor_success&&($(".event-referrals-div").append(e.html),window.matchMedia("only screen and (max-width: 760px)").matches||$(".add-event-contact-div").find(".add-contact-name").focus())},error:function(e,t){response="Unexpected error"}})):$(this).addClass("disabled")})),$(document).on("change",".referred_user_send_email",(function(e){var t=$(this).data("referral_id");setEventReferral(t,{referred_user_send_email:!1}),$(this).is(":checked")&&setEventReferral(t,{referred_user_send_email:!0})})),$(document).on("click",".remove-event-contact",(function(e){var t=$(this).data("email-address");unsetEventReferral(t),$('[data-email-address-div="'+t+'"]').slideUp("normal",(function(){$(this).remove()}))})),$(document).on("click",".send-event-emails:not(.disabled)",(function(e){$(".save-event-details").trigger("click");var t=$("#session_message").val().trim(),a=$("#session_host").val();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"send_invites",event_id:manageEventID,message:t,name:a,emails:JSON.stringify(eventReferrals)},success:function(e,t){e.processor_success&&(eventReferrals=$.parseJSON(e.eventReferralsJS),$(".event-referrals-div").html(e.html),$(".btn-spinning").removeClass("btn-spinning"),$(".ld-spin").remove(),updateEmailCounter())},error:function(e,t){response="Unexpected error"}})})),$(document).on("click",".import_contacts_previous",(function(e){e.preventDefault(),$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"import_contacts",client:"previous"},success:function(e,t){e.processor_success&&list_contacts(e.html)},error:function(e,t){response="Unexpected error"}})})),$(document).on("click",".import_contacts_outlook",(function(e){e.preventDefault(),getGraphContacts((function(e){$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"my_events",op:"import_contacts",client:"msgraph",contacts:JSON.stringify(e)},success:function(e,t){e.processor_success&&list_contacts(e.html)},error:function(e,t){response="Unexpected error"}})}))})),$(document).on("click",".import_contacts_google",(function(t){t.preventDefault(),gapi.client.setApiKey(CLIENT.google.api),gapi.auth.authorize({client_id:CLIENT.google.id,scope:"https://www.googleapis.com/auth/contacts.readonly",immediate:!1},e)}))}));
//# sourceMappingURL=my_events.min.js.map
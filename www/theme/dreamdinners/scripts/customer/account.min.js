var timeout=1,g_lastSearch="",g_referralCheck="";function handle_account_form_validation(){$("#birthday_year").mousedown((function(e){if(e.target[1]){var r=e.target[1].value;r-=23,""==$("#birthday_year").val()&&$("#birthday_year").val(r)}})),$("#customers_terms").change((function(){$("#customers_terms").is(":checked")?$("#submit_account").removeClass("disabled").removeAttr("disabled"):$("#submit_account").addClass("disabled").attr("disabled","disabled")})),$('[data-required_checkbox="preferred_sessions"]').change((function(){monthly_dine=!1,$('[data-required_checkbox="preferred_sessions"]').each((function(){if($(this).is(":checked"))return monthly_dine=!0,!0}))})),referral_update_init(),$("#customers_terms").change((function(){})),$("#refer_chk-customer_referral").is(":checked")&&$("#customer_referral_email").val().length>0&&check_email_address("customer_referral_email"),$("#password").length&&$("#password").attr("data-message_min","A password must have a least 6 characters.")}function handle_home_store_search(){USER_PREFERENCES||($("#postal_code").bind("change keyup",(function(){5==$(this).val().length&&home_store_address_search()})),void 0!==$("#postal_code").val()&&5==$("#postal_code").val().length&&home_store_address_search())}function passedReferral(){return check_result=$("#refer_chk-customer_referral").is(":checked"),!check_result||!1!==g_referralCheck}function referral_update_init(){$("#customer_referral_email").unbind("keyup change").bind("keyup change",(function(e){this.check_referral_email&&clearTimeout(this.check_referral_email),this.check_referral_email=setTimeout('check_email_address("customer_referral_email")',1e3*timeout)})),$("#refer_chk-customer_referral").bind("click",(function(e){$("#refer_chk-customer_referral").is(":checked")||$("#customer_referral_result").html("@")}))}function check_email_address(e){var r=$("#"+e).val().trim();""!=r&&$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"data_lookup",type:"user",check:"email",email:r},success:function(e,r){e.processor_success?($("#customer_referral_result").html('<img src="'+PATH.image+'/icon/accept.png" class="img-fluid"  />'),$("#customer_referral_email").find(".temp_break").remove(),$("#customer_referral_email").removeClass("input_in_error"),$("#customer_referral_email_erm").remove(),g_referralCheck=!0):($("#customer_referral_result").html('<img src="'+PATH.image+'/icon/error.png" data-toggle="tooltip" data-placement="top" title="Email Not Found" class="img-fluid" />'),$('[data-toggle="tooltip"]').tooltip(),g_referralCheck=!1)},error:function(e,r){response="Unexpected error"}})}function Edit(e){create_and_submit_form({action:"main.php?page=order_mgr",input:{order_id:e}})}function home_store_address_search(){var e="",r="",t="",a="";$("#address_line1").val()&&(e=$("#address_line1").val()+", "),$("#city").val()&&(r=$("#city").val()+", "),$("#state_id").val()&&(t=$("#state_id").val()+" "),$("#postal_code").val()&&(a=$("#postal_code").val()),address_search=e+r+t+a,retrieve_stores_for_address({address:address_search,compact:!0})}function setUpExistingReferrralSource(){"OTHER"==$("#referral_source").val()?$("#referral_source_details_div").showFlex():"CUSTOMER_REFERRAL"==$("#referral_source").val()?$("#customer_referral_email_div").showFlex():"VIRTUAL_PARTY"==$("#referral_source").val()&&$("#virtual_party_source_details_div").showFlex()}function remove_credit_card_reference(e){var r=$("#row-cc_ref-"+e.item_number).get();$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"cart_remove_payment",payment_type:"cc_ref",cc_ref_id:e.item_number},success:function(e){if(e.processor_success){var t=$(r).data("num_cc_refs");$(r).slideUp(),$(r).remove(),t>1&&$('[id^="row-cc_ref"]').data("num_cc_refs",t-1)}else dd_message({title:"Error",message:e.processor_message})},error:function(e,r){dd_message({title:"Error",message:"Unexpected error: "+r})}})}$(document).on("click",'[id^="select_location-"]',(function(e){$("#store_id").val(this.id.split("-")[1]),e.preventDefault()})),$(document).on("click",".toggle-update_mobile_number",(function(e){e.preventDefault(),$("[data-sms_dlog_comp=true]").slideToggle((function(){$(this).is(":hidden")?($("form#add_mobile_number").trigger("reset"),$("#new_mobile_number_div").slideUp()):$("[data-sms_pref=true]").attr("disabled",!1)}))})),$(document).on("click",'[name="add_method"]',(function(e){"new"==$("input[name='add_method']:checked").val()?($("#new_mobile_number_div").slideDown(),$("#new_mobile_number").prop("required",!0)):($("#new_mobile_number_div").slideUp(),$("#new_mobile_number").prop("required",!1))})),$(document).on("click",".account-request-data:not(.disabled)",(function(e){bootbox.confirm({message:"Are you sure you wish to create a support ticket to request your account information?",buttons:{confirm:{label:"Yes"},cancel:{label:"No"}},callback:function(e){e&&$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"account",op:"request_data"},success:function(e){e.processor_success?dd_message({title:"Account Data Management",message:"The request for a copy of your account information has been submitted."}):dd_message({title:"Processing Error",message:e.processor_message})},error:function(e,r){dd_message({title:"Error",message:response="Unexpected error:"+r})}})}})})),$(document).on("click",".account-request-delete:not(.disabled)",(function(e){bootbox.prompt({title:"Account Deletion Request Notice",message:"<div class='font-size-small'><p>By submitting your password below, you are agreeing to the following terms and understand that this action cannot be undone.</p><ul><li>If you are enrolled in PLATEPOINTS, you will be unenrolled. Your current points, history, and badge status will be erased.</li><li>Any available store credits will be voided</li><li>Any available Dinner Dollars will be voided</li><li>Any available gift card credit will be voided</li><li>Any available or outstanding referral credit will be voided</li><li>Your account and order history will be removed</li></ul><p>Note: If you have a future order scheduled or an outstanding balance owed in your account, you will not be able to request deletion until the account is in good standing or your future order is cancelled. Please contact your store for help. Once those are resolved, you may request to have your account deleted.</p></div>",inputType:"password",buttons:{confirm:{label:"I Agree to the Terms. Delete My Account.",className:"btn-danger"},cancel:{label:"Cancel"}},callback:function(e){e&&$.ajax({url:"ddproc.php",type:"POST",timeout:2e4,dataType:"json",data:{processor:"account",challenge:e,op:"request_delete"},success:function(e){e.processor_success?e.delete_success?bounce("/"):dd_message({title:"Error",message:e.processor_message}):dd_message({title:"Processing Error",message:e.processor_message})},error:function(e,r){dd_message({title:"Error",message:response="Unexpected error:"+r})}})}})})),$(document).on("change","#referral_source",(function(e){$("#customer_referral_result").text("@"),$("#referral_source_details_div").hideFlex(),$("#referral_source_details").prop({disabled:!0,required:!1}).val(""),$("#virtual_party_source_details_div").hideFlex(),$("#virtual_party_source_details").prop({disabled:!0,required:!1}).val(""),$("#customer_referral_email_div").hideFlex(),$("#customer_referral_email").prop({disabled:!0,required:!1}).val(""),"OTHER"==$(this).val()?($("#referral_source_details_div").showFlex(),$("#referral_source_details").prop({disabled:!1,required:!0}).val("")):"CUSTOMER_REFERRAL"==$(this).val()?($("#customer_referral_email_div").showFlex(),$("#customer_referral_email").prop({disabled:!1,required:!0}).val("")):"VIRTUAL_PARTY"==$(this).val()&&($("#virtual_party_source_details_div").showFlex(),$("#virtual_party_source_details").prop({disabled:!1,required:!0}).val(""))})),$(document).on("submit","#add_mobile_number",(function(e){if(e.preventDefault(),!1!==$(this)[0].checkValidity()){var r=!1,t=$("input[name='add_method']:checked").val(),a={},o=!1;if($("[data-sms_pref=true]").each((function(){$(this).is(":checked")&&(o=!0,a[$(this).attr("id")]=1)})),!o&&"delete"!=t)return $("#add_mobile_number").removeClass("was-validated"),$("#confirm_number_update").removeSpinner(),bootbox.alert({size:"small",title:"Error",message:"Please opt into at least one type of message."}),!1;if("new"==t){if(!$("#new_mobile_number").val().match(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/))return $("#add_mobile_number").removeClass("was-validated"),$("#confirm_number_update").removeSpinner(),bootbox.alert({size:"small",title:"Error",message:"Please enter a valid phone number (xxx-xxx-xxxx)."}),!1;r=$("#new_mobile_number").val()}else if("delete"==t)return $.ajax({url:"ddproc.php",type:"POST",timeout:1e8,dataType:"json",data:{processor:"account",op:"remove_cur_number"},success:function(e,r){return $("#confirm_number_update").removeSpinner(),$("#add_mobile_number").removeClass("was-validated"),e.processor_success?($("#current_mobile_target").html("Current Mobile number: "),$("[data-sms_pref=true]").prop("checked",!1),$("[data-sms_pref=true]").attr("disabled","disabled"),$("#add_update_mobile_number").html("Add Mobile Number"),$("#add_update_mobile_number").data("op","add"),$("#remove_mobile_number_div").slideUp(),$("[data-sms_dlog_comp=true]").slideUp(),$("#add_update_mobile_number").attr("disabled",!1),bootbox.alert({size:"small",title:"Success",message:"Your SMS phone number has been removed. You will no longer receive text messages. (Note: It may take 60 minutes for the change to complete.)"}),!1):($("#confirm_number_update").removeSpinner(),$("#add_mobile_number").removeClass("was-validated"),bootbox.alert({size:"small",title:"Error",message:e.processor_message}),!1)},error:function(e,r){return $("#add_update_mobile_number").removeSpinner(),$("#add_update_mobile_number").attr("disabled",!1),$("#add_mobile_number").removeClass("was-validated"),bootbox.alert({size:"small",title:"Error",message:"Unexpected Error"}),!1}}),$("#add_update_mobile_number").removeSpinner(),$("#add_update_mobile_number").attr("disabled",!1),$("#add_mobile_number").removeClass("was-validated"),!1;$.ajax({url:"ddproc.php",type:"POST",timeout:1e8,dataType:"json",data:{processor:"account",op:"add_or_change_sms_number",method:t,number:r,selectedCategories:a,special_case:sms_special_case},success:function(e,r){if($("#confirm_number_update").removeSpinner(),e.processor_success){$("#current_mobile_target").html("Current Mobile number: "+e.new_number),$("[data-sms_pref=true]").attr("disabled",!1),$("#add_update_mobile_number").html("Update or Remove Mobile Number"),$("#add_update_mobile_number").data("op","update"),$("#remove_mobile_number_div").slideDown(),$("#add_mobile_number").removeClass("was-validated"),$.each(e.newPrefsState,(function(e,r){$("#"+e).attr("checked",r)}));var t="Your SMS phone number is updated.";return e.override_message&&(t=e.override_message),bootbox.alert({size:"small",title:"Success",message:t}),$("[data-sms_dlog_comp=true]").slideUp(),$("#add_update_mobile_number").attr("disabled",!1),!1}return bootbox.alert({size:"small",title:"Error",message:e.processor_message}),!1},error:function(e,r){return bootbox.alert({size:"small",title:"Error",message:"Unexpected Error"}),$("#add_update_mobile_number").removeSpinner(),!1}})}})),$((function(){handle_account_form_validation(),handle_home_store_search(),setUpExistingReferrralSource(),getQueryVariable("pp_enroll")&&$("#enroll_in_plate_points").length&&($("#enroll_in_plate_points").prop("checked",!0).triggerHandler("click"),"undefined"!=typeof is_create&&is_create||$("html, body").animate({scrollTop:$("#enroll_in_plate_points_head").offset().top-60},2e3)),""!=scroll&&scroll.length>0&&$("html, body").animate({scrollTop:$("#"+scroll).offset().top-60},2e3),$(document).on("click",'[id^="remove-cc_ref"]',(function(e){var r={id:this.id,item:this.id.split("-")[1],item_number:this.id.split("-")[2]};r.title=$("#checkout_title-"+r.item+"-"+r.item_number).text(),r.type="Item",dd_message({title:"Remove "+r.type,message:"Are you sure you wish to remove "+r.title+".",confirm:function(){remove_credit_card_reference(r)}})}))}));
//# sourceMappingURL=account.min.js.map